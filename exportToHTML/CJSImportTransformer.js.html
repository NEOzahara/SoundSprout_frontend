<html>
<head>
<title>CJSImportTransformer.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #2aacb8;}
.s6 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
CJSImportTransformer.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span><span class="s2">value</span><span class="s1">: </span><span class="s3">true</span><span class="s1">}); </span><span class="s3">function </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">? </span><span class="s2">obj </span><span class="s1">: { </span><span class="s3">default</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; }</span>


<span class="s3">var </span><span class="s2">_tokenizer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../parser/tokenizer'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_keywords </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../parser/tokenizer/keywords'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_types </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../parser/tokenizer/types'</span><span class="s1">);</span>

<span class="s3">var </span><span class="s2">_elideImportEquals </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/elideImportEquals'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_elideImportEquals2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_elideImportEquals</span><span class="s1">);</span>



<span class="s3">var </span><span class="s2">_getDeclarationInfo </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/getDeclarationInfo'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_getDeclarationInfo2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_getDeclarationInfo</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_getImportExportSpecifierInfo </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/getImportExportSpecifierInfo'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_getImportExportSpecifierInfo2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_getImportExportSpecifierInfo</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_isExportFrom </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/isExportFrom'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_isExportFrom2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_isExportFrom</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_removeMaybeImportAttributes </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/removeMaybeImportAttributes'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_shouldElideDefaultExport </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/shouldElideDefaultExport'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_shouldElideDefaultExport2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_shouldElideDefaultExport</span><span class="s1">);</span>


<span class="s3">var </span><span class="s2">_Transformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./Transformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_Transformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_Transformer</span><span class="s1">);</span>

<span class="s4">/**</span>
 <span class="s4">* Class for editing import statements when we are transforming to commonjs.</span>
 <span class="s4">*/</span>
 <span class="s3">class </span><span class="s2">CJSImportTransformer </span><span class="s3">extends </span><span class="s2">_Transformer2</span><span class="s1">.</span><span class="s2">default </span><span class="s1">{</span>
   <span class="s2">__init</span><span class="s1">() {</span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadExport </span><span class="s1">= </span><span class="s3">false</span><span class="s1">}</span>
   <span class="s2">__init2</span><span class="s1">() {</span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadNamedExport </span><span class="s1">= </span><span class="s3">false</span><span class="s1">}</span>
   <span class="s2">__init3</span><span class="s1">() {</span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadDefaultExport </span><span class="s1">= </span><span class="s3">false</span><span class="s1">}</span>
  

  <span class="s2">constructor</span><span class="s1">(</span>
     <span class="s2">rootTransformer</span><span class="s1">,</span>
     <span class="s2">tokens</span><span class="s1">,</span>
     <span class="s2">importProcessor</span><span class="s1">,</span>
     <span class="s2">nameManager</span><span class="s1">,</span>
     <span class="s2">helperManager</span><span class="s1">,</span>
     <span class="s2">reactHotLoaderTransformer</span><span class="s1">,</span>
     <span class="s2">enableLegacyBabel5ModuleInterop</span><span class="s1">,</span>
     <span class="s2">enableLegacyTypeScriptModuleInterop</span><span class="s1">,</span>
     <span class="s2">isTypeScriptTransformEnabled</span><span class="s1">,</span>
     <span class="s2">isFlowTransformEnabled</span><span class="s1">,</span>
     <span class="s2">preserveDynamicImport</span><span class="s1">,</span>
     <span class="s2">keepUnusedImports</span><span class="s1">,</span>
  <span class="s1">) {</span>
    <span class="s3">super</span><span class="s1">();</span><span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer </span><span class="s1">= </span><span class="s2">rootTransformer</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens </span><span class="s1">= </span><span class="s2">tokens</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor </span><span class="s1">= </span><span class="s2">importProcessor</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager </span><span class="s1">= </span><span class="s2">nameManager</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager </span><span class="s1">= </span><span class="s2">helperManager</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">reactHotLoaderTransformer </span><span class="s1">= </span><span class="s2">reactHotLoaderTransformer</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">enableLegacyBabel5ModuleInterop </span><span class="s1">= </span><span class="s2">enableLegacyBabel5ModuleInterop</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">enableLegacyTypeScriptModuleInterop </span><span class="s1">= </span><span class="s2">enableLegacyTypeScriptModuleInterop</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isTypeScriptTransformEnabled </span><span class="s1">= </span><span class="s2">isTypeScriptTransformEnabled</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isFlowTransformEnabled </span><span class="s1">= </span><span class="s2">isFlowTransformEnabled</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">preserveDynamicImport </span><span class="s1">= </span><span class="s2">preserveDynamicImport</span><span class="s1">;</span><span class="s3">this</span><span class="s1">.</span><span class="s2">keepUnusedImports </span><span class="s1">= </span><span class="s2">keepUnusedImports</span><span class="s1">;</span><span class="s2">CJSImportTransformer</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">__init</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span><span class="s2">CJSImportTransformer</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">__init2</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span><span class="s2">CJSImportTransformer</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">__init3</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">declarationInfo </span><span class="s1">= </span><span class="s2">isTypeScriptTransformEnabled</span>
      <span class="s1">? </span><span class="s2">_getDeclarationInfo2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s2">tokens</span><span class="s1">)</span>
      <span class="s1">: </span><span class="s2">_getDeclarationInfo</span><span class="s1">.</span><span class="s2">EMPTY_DECLARATION_INFO</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">getPrefixCode</span><span class="s1">() {</span>
    <span class="s3">let </span><span class="s2">prefix </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadExport</span><span class="s1">) {</span>
      <span class="s2">prefix </span><span class="s1">+= </span><span class="s0">'Object.defineProperty(exports, &quot;__esModule&quot;, {value: true});'</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s2">prefix</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">getSuffixCode</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">enableLegacyBabel5ModuleInterop </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadDefaultExport </span><span class="s1">&amp;&amp; !</span><span class="s3">this</span><span class="s1">.</span><span class="s2">hadNamedExport</span><span class="s1">) {</span>
      <span class="s3">return </span><span class="s0">&quot;</span><span class="s3">\n</span><span class="s0">module.exports = exports.default;</span><span class="s3">\n</span><span class="s0">&quot;</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">process</span><span class="s1">() {</span>
    <span class="s6">// TypeScript `import foo = require('foo');` should always just be translated to plain require.</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_import</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processImportEquals</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_import</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processImport</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">&quot;module.exports&quot;</span><span class="s1">);</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">) &amp;&amp; !</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">hadExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processExport</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">postIncDec</span><span class="s1">)) {</span>
      <span class="s6">// Fall through to normal identifier matching if this doesn't apply.</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">processPostIncDec</span><span class="s1">()) {</span>
        <span class="s3">return true</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">jsxName</span><span class="s1">)) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processIdentifier</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processAssignment</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">assign</span><span class="s1">)) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processComplexAssignment</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">preIncDec</span><span class="s1">)) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processPreIncDec</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>

   <span class="s2">processImportEquals</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">importName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameAtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">shouldAutomaticallyElideImportedName</span><span class="s1">(</span><span class="s2">importName</span><span class="s1">)) {</span>
      <span class="s6">// If this name is only used as a type, elide the whole import.</span>
      <span class="s2">_elideImportEquals2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s6">// Otherwise, switch `import` to `const`.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">&quot;const&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform this:</span>
   <span class="s4">* import foo, {bar} from 'baz';</span>
   <span class="s4">* into</span>
   <span class="s4">* var _baz = require('baz'); var _baz2 = _interopRequireDefault(_baz);</span>
   <span class="s4">*</span>
   <span class="s4">* The import code was already generated in the import preprocessing step, so</span>
   <span class="s4">* we just need to look it up.</span>
   <span class="s4">*/</span>
   <span class="s2">processImport</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_import</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">preserveDynamicImport</span><span class="s1">) {</span>
        <span class="s6">// Bail out, only making progress for this one token.</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
        <span class="s3">return</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">const </span><span class="s2">requireWrapper </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">enableLegacyTypeScriptModuleInterop</span>
        <span class="s1">? </span><span class="s0">&quot;&quot;</span>
        <span class="s1">: </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager</span><span class="s1">.</span><span class="s2">getHelperName</span><span class="s1">(</span><span class="s0">&quot;interopRequireWildcard&quot;</span><span class="s1">)}</span><span class="s0">(`</span><span class="s1">;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`Promise.resolve().then(() =&gt; </span><span class="s2">$</span><span class="s1">{</span><span class="s2">requireWrapper</span><span class="s1">}</span><span class="s0">require`</span><span class="s1">);</span>
      <span class="s3">const </span><span class="s2">contextId </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">contextId</span><span class="s1">;</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">contextId </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected context ID on dynamic import invocation.&quot;</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextIdAndLabel</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">, </span><span class="s2">contextId</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s2">requireWrapper </span><span class="s1">? </span><span class="s0">&quot;)))&quot; </span><span class="s1">: </span><span class="s0">&quot;))&quot;</span><span class="s1">);</span>
      <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">const </span><span class="s2">shouldElideImport </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">removeImportAndDetectIfShouldElide</span><span class="s1">();</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">shouldElideImport</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">const </span><span class="s2">path </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">stringValue</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceTokenTrimmingLeftWhitespace</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">claimImportCode</span><span class="s1">(</span><span class="s2">path</span><span class="s1">));</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">claimImportCode</span><span class="s1">(</span><span class="s2">path</span><span class="s1">));</span>
    <span class="s1">}</span>
    <span class="s2">_removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">semi</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Erase this import (since any CJS output would be completely different), and</span>
   <span class="s4">* return true if this import is should be elided due to being a type-only</span>
   <span class="s4">* import. Such imports will not be emitted at all to avoid side effects.</span>
   <span class="s4">*</span>
   <span class="s4">* Import elision only happens with the TypeScript or Flow transforms enabled.</span>
   <span class="s4">*</span>
   <span class="s4">* TODO: This function has some awkward overlap with</span>
   <span class="s4">*  CJSImportProcessor.pruneTypeOnlyImports , and the two should be unified.</span>
   <span class="s4">*  That function handles TypeScript implicit import name elision, and removes</span>
   <span class="s4">*  an import if all typical imported names (without `type`) are removed due</span>
   <span class="s4">*  to being type-only imports. This function handles Flow import removal and</span>
   <span class="s4">*  properly distinguishes `import 'foo'` from `import {} from 'foo'` for TS</span>
   <span class="s4">*  purposes.</span>
   <span class="s4">*</span>
   <span class="s4">* The position should end at the import string.</span>
   <span class="s4">*/</span>
   <span class="s2">removeImportAndDetectIfShouldElide</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextual</span><span class="s1">(</span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_type</span><span class="s1">) &amp;&amp;</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">) &amp;&amp;</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextualAtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">, </span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_from</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s6">// This is an &quot;import type&quot; statement, so exit early.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">removeRemainingImport</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">star</span><span class="s1">)) {</span>
      <span class="s6">// We have a default import or namespace import, so there must be some</span>
      <span class="s6">// non-type import.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">removeRemainingImport</span><span class="s1">();</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">)) {</span>
      <span class="s6">// This is a bare import, so we should proceed with the import.</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">let </span><span class="s2">foundNonTypeImport </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s2">foundAnyNamedImport </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">)) {</span>
      <span class="s6">// Check if any named imports are of the form &quot;foo&quot; or &quot;foo as bar&quot;, with</span>
      <span class="s6">// no leading &quot;type&quot;.</span>
      <span class="s3">if </span><span class="s1">(</span>
        <span class="s1">(!</span><span class="s2">foundNonTypeImport </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">)) ||</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">)</span>
      <span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
          <span class="s2">foundAnyNamedImport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">) ||</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">) ||</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches4</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">) ||</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches4</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)</span>
        <span class="s1">) {</span>
          <span class="s2">foundNonTypeImport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">keepUnusedImports</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isTypeScriptTransformEnabled</span><span class="s1">) {</span>
      <span class="s3">return </span><span class="s1">!</span><span class="s2">foundNonTypeImport</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isFlowTransformEnabled</span><span class="s1">) {</span>
      <span class="s6">// In Flow, unlike TS, `import {} from 'foo';` preserves the import.</span>
      <span class="s3">return </span><span class="s2">foundAnyNamedImport </span><span class="s1">&amp;&amp; !</span><span class="s2">foundNonTypeImport</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">removeRemainingImport</span><span class="s1">() {</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">processIdentifier</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">token </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">();</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">token</span><span class="s1">.</span><span class="s2">shadowsGlobal</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">token</span><span class="s1">.</span><span class="s2">identifierRole </span><span class="s1">=== </span><span class="s2">_tokenizer</span><span class="s1">.</span><span class="s2">IdentifierRole</span><span class="s1">.</span><span class="s2">ObjectShorthand</span><span class="s1">) {</span>
      <span class="s3">return this</span><span class="s1">.</span><span class="s2">processObjectShorthand</span><span class="s1">();</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">token</span><span class="s1">.</span><span class="s2">identifierRole </span><span class="s1">!== </span><span class="s2">_tokenizer</span><span class="s1">.</span><span class="s2">IdentifierRole</span><span class="s1">.</span><span class="s2">Access</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">replacement </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">getIdentifierReplacement</span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameForToken</span><span class="s1">(</span><span class="s2">token</span><span class="s1">),</span>
    <span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">replacement</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s6">// Tolerate any number of closing parens while looking for an opening paren</span>
    <span class="s6">// that indicates a function call.</span>
    <span class="s3">let </span><span class="s2">possibleOpenParenIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(</span>
      <span class="s2">possibleOpenParenIndex </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">possibleOpenParenIndex</span><span class="s1">].</span><span class="s2">type </span><span class="s1">=== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span>
    <span class="s1">) {</span>
      <span class="s2">possibleOpenParenIndex</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s6">// Avoid treating imported functions as methods of their `exports` object</span>
    <span class="s6">// by using `(0, f)` when the identifier is in a paren expression. Else</span>
    <span class="s6">// use `Function.prototype.call` when the identifier is a guaranteed</span>
    <span class="s6">// function call. When using `call`, pass undefined as the context.</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">possibleOpenParenIndex</span><span class="s1">].</span><span class="s2">type </span><span class="s1">=== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokenAtRelativeIndex</span><span class="s1">(</span><span class="s5">1</span><span class="s1">).</span><span class="s2">type </span><span class="s1">=== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL </span><span class="s1">&amp;&amp;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokenAtRelativeIndex</span><span class="s1">(-</span><span class="s5">1</span><span class="s1">).</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_new</span>
      <span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">replacement</span><span class="s1">}</span><span class="s0">.call(void 0, `</span><span class="s1">);</span>
        <span class="s6">// Remove the old paren.</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s6">// Balance out the new paren.</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s6">// See here: http://2ality.com/2015/12/references.html</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`(0, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">replacement</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">);</span>
      <span class="s1">}</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s2">replacement</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">processObjectShorthand</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">identifier </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierName</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">replacement </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">getIdentifierReplacement</span><span class="s1">(</span><span class="s2">identifier</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">replacement</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">identifier</span><span class="s1">}</span><span class="s0">: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">replacement</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">processExport</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_enum</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_const</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_enum</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">hadNamedExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
      <span class="s6">// Let the TypeScript transform handle it.</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_enum</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">hadDefaultExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s6">// Flow export default enums need some special handling, so handle them</span>
        <span class="s6">// in that tranform rather than this one.</span>
        <span class="s3">return false</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportDefault</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportBindings</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) &amp;&amp;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextualAtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">, </span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_type</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s6">// export type {a};</span>
      <span class="s6">// export type {a as b};</span>
      <span class="s6">// export type {a} from './b';</span>
      <span class="s6">// export type * from './b';</span>
      <span class="s6">// export type * as ns from './b';</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">)) {</span>
        <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s6">// *</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_as</span><span class="s1">)) {</span>
          <span class="s6">// as</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
          <span class="s6">// ns</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
      <span class="s6">// Remove type re-export `... } from './T'`</span>
      <span class="s3">if </span><span class="s1">(</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextual</span><span class="s1">(</span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_from</span><span class="s1">) &amp;&amp;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">1</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">)</span>
      <span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s2">_removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">hadNamedExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_var</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_let</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_const</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportVar</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">) ||</span>
      <span class="s6">// export async function</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportFunction</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_abstract</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">at</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportClass</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">star</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processExportStar</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Unrecognized export syntax.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">processAssignment</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">index </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">identifierToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index </span><span class="s1">- </span><span class="s5">1</span><span class="s1">];</span>
    <span class="s6">// If the LHS is a type identifier, this must be a declaration like `let a: b = c;`,</span>
    <span class="s6">// with `b` as the identifier, so nothing needs to be done in that case.</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">isType </span><span class="s1">|| </span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">shadowsGlobal</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">index </span><span class="s1">&gt;= </span><span class="s5">2 </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">- </span><span class="s5">2</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">)) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">index </span><span class="s1">&gt;= </span><span class="s5">2 </span><span class="s1">&amp;&amp; [</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_var</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_let</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_const</span><span class="s1">].</span><span class="s2">includes</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index </span><span class="s1">- </span><span class="s5">2</span><span class="s1">].</span><span class="s2">type</span><span class="s1">)) {</span>
      <span class="s6">// Declarations don't need an extra assignment. This doesn't avoid the</span>
      <span class="s6">// assignment for comma-separated declarations, but it's still correct</span>
      <span class="s6">// since the assignment is just redundant.</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">assignmentSnippet </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">resolveExportBinding</span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameForToken</span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">),</span>
    <span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">assignmentSnippet</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` </span><span class="s2">$</span><span class="s1">{</span><span class="s2">assignmentSnippet</span><span class="s1">} </span><span class="s0">=`</span><span class="s1">);</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Process something like `a += 3`, where `a` might be an exported value.</span>
   <span class="s4">*/</span>
   <span class="s2">processComplexAssignment</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">index </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">identifierToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index </span><span class="s1">- </span><span class="s5">1</span><span class="s1">];</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">shadowsGlobal</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">index </span><span class="s1">&gt;= </span><span class="s5">2 </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">- </span><span class="s5">2</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">)) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">assignmentSnippet </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">resolveExportBinding</span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameForToken</span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">),</span>
    <span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">assignmentSnippet</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` = </span><span class="s2">$</span><span class="s1">{</span><span class="s2">assignmentSnippet</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Process something like `++a`, where `a` might be an exported value.</span>
   <span class="s4">*/</span>
   <span class="s2">processPreIncDec</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">index </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">identifierToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index </span><span class="s1">+ </span><span class="s5">1</span><span class="s1">];</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">shadowsGlobal</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s6">// Ignore things like ++a.b and ++a[b] and ++a().b.</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s2">index </span><span class="s1">+ </span><span class="s5">2 </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp;</span>
      <span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">+ </span><span class="s5">2</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">) ||</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">+ </span><span class="s5">2</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">bracketL</span><span class="s1">) ||</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">+ </span><span class="s5">2</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">))</span>
    <span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">identifierName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameForToken</span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s2">assignmentSnippet </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">resolveExportBinding</span><span class="s1">(</span><span class="s2">identifierName</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">assignmentSnippet</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">assignmentSnippet</span><span class="s1">} </span><span class="s0">= `</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Process something like `a++`, where `a` might be an exported value.</span>
   <span class="s4">* This starts at the `a`, not at the `++`.</span>
   <span class="s4">*/</span>
   <span class="s2">processPostIncDec</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">index </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">identifierToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index</span><span class="s1">];</span>
    <span class="s3">const </span><span class="s2">operatorToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">index </span><span class="s1">+ </span><span class="s5">1</span><span class="s1">];</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">.</span><span class="s2">shadowsGlobal</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">index </span><span class="s1">&gt;= </span><span class="s5">1 </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">index </span><span class="s1">- </span><span class="s5">1</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">)) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">identifierName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameForToken</span><span class="s1">(</span><span class="s2">identifierToken</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s2">assignmentSnippet </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">resolveExportBinding</span><span class="s1">(</span><span class="s2">identifierName</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s2">assignmentSnippet</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">operatorCode </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">rawCodeForToken</span><span class="s1">(</span><span class="s2">operatorToken</span><span class="s1">);</span>
    <span class="s6">// We might also replace the identifier with something like exports.x, so</span>
    <span class="s6">// do that replacement here as well.</span>
    <span class="s3">const </span><span class="s2">base </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">getIdentifierReplacement</span><span class="s1">(</span><span class="s2">identifierName</span><span class="s1">) || </span><span class="s2">identifierName</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">operatorCode </span><span class="s1">=== </span><span class="s0">&quot;++&quot;</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">assignmentSnippet</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">+ 1, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">- 1)`</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">operatorCode </span><span class="s1">=== </span><span class="s0">&quot;--&quot;</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`(</span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">assignmentSnippet</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">- 1, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">base</span><span class="s1">} </span><span class="s0">+ 1)`</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Unexpected operator: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">operatorCode</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

   <span class="s2">processExportDefault</span><span class="s1">() {</span>
    <span class="s3">let </span><span class="s2">exportedRuntimeValue </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches4</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) ||</span>
      <span class="s6">// export default async function</span>
      <span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches5</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) &amp;&amp;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextualAtIndex</span><span class="s1">(</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s5">2</span><span class="s1">,</span>
          <span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_async</span><span class="s1">,</span>
        <span class="s1">))</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s6">// Named function export case: change it to a top-level function</span>
      <span class="s6">// declaration followed by exports statement.</span>
      <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">processNamedFunction</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` exports.default = </span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches4</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches5</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_abstract</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) ||</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches3</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_export</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_default</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">at</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">copyDecorators</span><span class="s1">();</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_abstract</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processNamedClass</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` exports.default = </span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">);</span>
      <span class="s6">// After this point, this is a plain &quot;export default E&quot; statement.</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
      <span class="s2">_shouldElideDefaultExport2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">isTypeScriptTransformEnabled</span><span class="s1">,</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">keepUnusedImports</span><span class="s1">,</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">,</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">declarationInfo</span><span class="s1">,</span>
      <span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s6">// If the exported value is just an identifier and should be elided by TypeScript</span>
      <span class="s6">// rules, then remove it entirely. It will always have the form `export default e`,</span>
      <span class="s6">// where `e` is an identifier.</span>
      <span class="s2">exportedRuntimeValue </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">reactHotLoaderTransformer</span><span class="s1">) {</span>
      <span class="s6">// We need to assign E to a variable. Change &quot;export default E&quot; to</span>
      <span class="s6">// &quot;let _default; exports.default = _default = E&quot;</span>
      <span class="s3">const </span><span class="s2">defaultVarName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">.</span><span class="s2">claimFreeName</span><span class="s1">(</span><span class="s0">&quot;_default&quot;</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">`let </span><span class="s2">$</span><span class="s1">{</span><span class="s2">defaultVarName</span><span class="s1">}</span><span class="s0">; exports.`</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` = </span><span class="s2">$</span><span class="s1">{</span><span class="s2">defaultVarName</span><span class="s1">} </span><span class="s0">=`</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">reactHotLoaderTransformer</span><span class="s1">.</span><span class="s2">setExtractedDefaultExportName</span><span class="s1">(</span><span class="s2">defaultVarName</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s6">// Change &quot;export default E&quot; to &quot;exports.default = E&quot;</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">&quot;exports.&quot;</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">&quot; =&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">exportedRuntimeValue</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">hadDefaultExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">copyDecorators</span><span class="s1">() {</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">at</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">)) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dot</span><span class="s1">);</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">)) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">);</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">);</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform a declaration like `export var`, `export let`, or `export const`.</span>
   <span class="s4">*/</span>
   <span class="s2">processExportVar</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isSimpleExportVar</span><span class="s1">()) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processSimpleExportVar</span><span class="s1">();</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processComplexExportVar</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Determine if the export is of the form:</span>
   <span class="s4">* export var/let/const [varName] = [expr];</span>
   <span class="s4">* In other words, determine if function name inference might apply.</span>
   <span class="s4">*/</span>
   <span class="s2">isSimpleExportVar</span><span class="s1">() {</span>
    <span class="s3">let </span><span class="s2">tokenIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">();</span>
    <span class="s6">// export</span>
    <span class="s2">tokenIndex</span><span class="s1">++;</span>
    <span class="s6">// var/let/const</span>
    <span class="s2">tokenIndex</span><span class="s1">++;</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">tokenIndex</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s2">tokenIndex</span><span class="s1">++;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s2">tokenIndex </span><span class="s1">&lt; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">tokenIndex</span><span class="s1">].</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s2">tokenIndex</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">tokenIndex</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return true</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform an `export var` declaration initializing a single variable.</span>
   <span class="s4">*</span>
   <span class="s4">* For example, this:</span>
   <span class="s4">* export const f = () =&gt; {};</span>
   <span class="s4">* becomes this:</span>
   <span class="s4">* const f = () =&gt; {}; exports.f = f;</span>
   <span class="s4">*</span>
   <span class="s4">* The variable is unused (e.g. exports.f has the true value of the export).</span>
   <span class="s4">* We need to produce an assignment of this form so that the function will</span>
   <span class="s4">* have an inferred name of &quot;f&quot;, which wouldn't happen in the more general</span>
   <span class="s4">* case below.</span>
   <span class="s4">*/</span>
   <span class="s2">processSimpleExportVar</span><span class="s1">() {</span>
    <span class="s6">// export</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s6">// var/let/const</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">varName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierName</span><span class="s1">();</span>
    <span class="s6">// x: number  -&gt;  x</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">endIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">rhsEndIndex</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">endIndex </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected = token with an end index.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">endIndex</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">`; exports.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">varName</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">varName</span><span class="s1">}</span><span class="s0">`</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform normal declaration exports, including handling destructuring.</span>
   <span class="s4">* For example, this:</span>
   <span class="s4">* export const {x: [a = 2, b], c} = d;</span>
   <span class="s4">* becomes this:</span>
   <span class="s4">* ({x: [exports.a = 2, exports.b], c: exports.c} = d;)</span>
   <span class="s4">*/</span>
   <span class="s2">processComplexExportVar</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">needsParens </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">needsParens</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">&quot;(&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">let </span><span class="s2">depth </span><span class="s1">= </span><span class="s5">0</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">true</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">) ||</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dollarBraceL</span><span class="s1">) ||</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">bracketL</span><span class="s1">)</span>
      <span class="s1">) {</span>
        <span class="s2">depth</span><span class="s1">++;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">) || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">bracketR</span><span class="s1">)) {</span>
        <span class="s2">depth</span><span class="s1">--;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
        <span class="s2">depth </span><span class="s1">=== </span><span class="s5">0 </span><span class="s1">&amp;&amp;</span>
        <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">) &amp;&amp;</span>
        <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span>
      <span class="s1">) {</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">eq</span><span class="s1">)) {</span>
        <span class="s6">// Default values might have assignments in the RHS that we want to ignore, so skip past</span>
        <span class="s6">// them.</span>
        <span class="s3">const </span><span class="s2">endIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">rhsEndIndex</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">endIndex </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
          <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected = token with an end index.&quot;</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">endIndex</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
        <span class="s1">}</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">const </span><span class="s2">token </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">_tokenizer</span><span class="s1">.</span><span class="s2">isDeclaration</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s2">token</span><span class="s1">)) {</span>
          <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierName</span><span class="s1">();</span>
          <span class="s3">let </span><span class="s2">replacement </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">getIdentifierReplacement</span><span class="s1">(</span><span class="s2">name</span><span class="s1">);</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">replacement </span><span class="s1">=== </span><span class="s3">null</span><span class="s1">) {</span>
            <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Expected a replacement for </span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">} </span><span class="s0">in </span><span class="s3">\`</span><span class="s0">export var</span><span class="s3">\` </span><span class="s0">syntax.`</span><span class="s1">);</span>
          <span class="s1">}</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">_tokenizer</span><span class="s1">.</span><span class="s2">isObjectShorthandDeclaration</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s2">token</span><span class="s1">)) {</span>
            <span class="s2">replacement </span><span class="s1">= </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">replacement</span><span class="s1">}</span><span class="s0">`</span><span class="s1">;</span>
          <span class="s1">}</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s2">replacement</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
        <span class="s1">}</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">needsParens</span><span class="s1">) {</span>
      <span class="s6">// Seek to the end of the RHS.</span>
      <span class="s3">const </span><span class="s2">endIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">rhsEndIndex</span><span class="s1">;</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">endIndex </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected = token with an end index.&quot;</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">endIndex</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">&quot;)&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform this:</span>
   <span class="s4">* export function foo() {}</span>
   <span class="s4">* into this:</span>
   <span class="s4">* function foo() {} exports.foo = foo;</span>
   <span class="s4">*/</span>
   <span class="s2">processExportFunction</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">);</span>
    <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">processNamedFunction</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` exports.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Skip past a function with a name and return that name.</span>
   <span class="s4">*/</span>
   <span class="s2">processNamedFunction</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_function</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextual</span><span class="s1">(</span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_async</span><span class="s1">)) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected async keyword in function export.&quot;</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">star</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected identifier for exported function name.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierName</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processPossibleTypeRange</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">);</span>
    <span class="s3">return </span><span class="s2">name</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform this:</span>
   <span class="s4">* export class A {}</span>
   <span class="s4">* into this:</span>
   <span class="s4">* class A {} exports.A = A;</span>
   <span class="s4">*/</span>
   <span class="s2">processExportClass</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">copyDecorators</span><span class="s1">();</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_abstract</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">rootTransformer</span><span class="s1">.</span><span class="s2">processNamedClass</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` exports.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s4">/**</span>
   <span class="s4">* Transform this:</span>
   <span class="s4">* export {a, b as c};</span>
   <span class="s4">* into this:</span>
   <span class="s4">* exports.a = a; exports.c = b;</span>
   <span class="s4">*</span>
   <span class="s4">* OR</span>
   <span class="s4">*</span>
   <span class="s4">* Transform this:</span>
   <span class="s4">* export {a, b as c} from './foo';</span>
   <span class="s4">* into the pre-generated Object.defineProperty code from the ImportProcessor.</span>
   <span class="s4">*</span>
   <span class="s4">* For the first case, if the TypeScript transform is enabled, we need to skip</span>
   <span class="s4">* exports that are only defined as types.</span>
   <span class="s4">*/</span>
   <span class="s2">processExportBindings</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>

    <span class="s3">const </span><span class="s2">isReExport </span><span class="s1">= </span><span class="s2">_isExportFrom2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>

    <span class="s3">const </span><span class="s2">exportStatements </span><span class="s1">= [];</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">true</span><span class="s1">) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s1">}</span>

      <span class="s3">const </span><span class="s2">specifierInfo </span><span class="s1">= </span><span class="s2">_getImportExportSpecifierInfo2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>

      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">specifierInfo</span><span class="s1">.</span><span class="s2">endIndex</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">}</span>

      <span class="s3">const </span><span class="s2">shouldRemoveExport </span><span class="s1">=</span>
        <span class="s2">specifierInfo</span><span class="s1">.</span><span class="s2">isType </span><span class="s1">||</span>
        <span class="s1">(!</span><span class="s2">isReExport </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">shouldElideExportedIdentifier</span><span class="s1">(</span><span class="s2">specifierInfo</span><span class="s1">.</span><span class="s2">leftName</span><span class="s1">));</span>
      <span class="s3">if </span><span class="s1">(!</span><span class="s2">shouldRemoveExport</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">exportedName </span><span class="s1">= </span><span class="s2">specifierInfo</span><span class="s1">.</span><span class="s2">rightName</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">exportedName </span><span class="s1">=== </span><span class="s0">&quot;default&quot;</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">hadDefaultExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">hadNamedExport </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s3">const </span><span class="s2">localName </span><span class="s1">= </span><span class="s2">specifierInfo</span><span class="s1">.</span><span class="s2">leftName</span><span class="s1">;</span>
        <span class="s3">const </span><span class="s2">newLocalName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">getIdentifierReplacement</span><span class="s1">(</span><span class="s2">localName</span><span class="s1">);</span>
        <span class="s2">exportStatements</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s0">`exports.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">exportedName</span><span class="s1">} </span><span class="s0">= </span><span class="s2">$</span><span class="s1">{</span><span class="s2">newLocalName </span><span class="s1">|| </span><span class="s2">localName</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">);</span>
      <span class="s1">}</span>

      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s3">break</span><span class="s1">;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">comma</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">`Unexpected token: </span><span class="s2">$</span><span class="s1">{</span><span class="s2">JSON</span><span class="s1">.</span><span class="s2">stringify</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">())}</span><span class="s0">`</span><span class="s1">);</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextual</span><span class="s1">(</span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_from</span><span class="s1">)) {</span>
      <span class="s6">// This is an export...from, so throw away the normal named export code</span>
      <span class="s6">// and use the Object.defineProperty code from ImportProcessor.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s3">const </span><span class="s2">path </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">stringValue</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceTokenTrimmingLeftWhitespace</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">claimImportCode</span><span class="s1">(</span><span class="s2">path</span><span class="s1">));</span>
      <span class="s2">_removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s6">// This is a normal named export, so use that.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s2">exportStatements</span><span class="s1">.</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">));</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">semi</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">processExportStar</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">path </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">stringValue</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceTokenTrimmingLeftWhitespace</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">importProcessor</span><span class="s1">.</span><span class="s2">claimImportCode</span><span class="s1">(</span><span class="s2">path</span><span class="s1">));</span>
    <span class="s2">_removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">removeMaybeImportAttributes</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s5">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">semi</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

   <span class="s2">shouldElideExportedIdentifier</span><span class="s1">(</span><span class="s2">name</span><span class="s1">) {</span>
    <span class="s3">return </span><span class="s1">(</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">isTypeScriptTransformEnabled </span><span class="s1">&amp;&amp;</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">keepUnusedImports </span><span class="s1">&amp;&amp;</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">declarationInfo</span><span class="s1">.</span><span class="s2">valueDeclarations</span><span class="s1">.</span><span class="s2">has</span><span class="s1">(</span><span class="s2">name</span><span class="s1">)</span>
    <span class="s1">);</span>
  <span class="s1">}</span>
<span class="s1">} </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">default </span><span class="s1">= </span><span class="s2">CJSImportTransformer</span><span class="s1">;</span>
</pre>
</body>
</html>