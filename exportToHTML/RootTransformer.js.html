<html>
<head>
<title>RootTransformer.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #5f826b; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
RootTransformer.js</font>
</center></td></tr></table>
<pre><span class="s0">&quot;use strict&quot;</span><span class="s1">;</span><span class="s2">Object</span><span class="s1">.</span><span class="s2">defineProperty</span><span class="s1">(</span><span class="s2">exports</span><span class="s1">, </span><span class="s0">&quot;__esModule&quot;</span><span class="s1">, {</span><span class="s2">value</span><span class="s1">: </span><span class="s3">true</span><span class="s1">}); </span><span class="s3">function </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">obj</span><span class="s1">) { </span><span class="s3">return </span><span class="s2">obj </span><span class="s1">&amp;&amp; </span><span class="s2">obj</span><span class="s1">.</span><span class="s2">__esModule </span><span class="s1">? </span><span class="s2">obj </span><span class="s1">: { </span><span class="s3">default</span><span class="s1">: </span><span class="s2">obj </span><span class="s1">}; }</span>


<span class="s3">var </span><span class="s2">_keywords </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../parser/tokenizer/keywords'</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_types </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../parser/tokenizer/types'</span><span class="s1">);</span>

<span class="s3">var </span><span class="s2">_getClassInfo </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'../util/getClassInfo'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_getClassInfo2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_getClassInfo</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_CJSImportTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./CJSImportTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_CJSImportTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_CJSImportTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_ESMImportTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./ESMImportTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_ESMImportTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_ESMImportTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_FlowTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./FlowTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_FlowTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_FlowTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_JestHoistTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./JestHoistTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_JestHoistTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_JestHoistTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_JSXTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./JSXTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_JSXTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_JSXTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_NumericSeparatorTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./NumericSeparatorTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_NumericSeparatorTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_NumericSeparatorTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_OptionalCatchBindingTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./OptionalCatchBindingTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_OptionalCatchBindingTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_OptionalCatchBindingTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_OptionalChainingNullishTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./OptionalChainingNullishTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_OptionalChainingNullishTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_OptionalChainingNullishTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_ReactDisplayNameTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./ReactDisplayNameTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_ReactDisplayNameTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_ReactDisplayNameTransformer</span><span class="s1">);</span>
<span class="s3">var </span><span class="s2">_ReactHotLoaderTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./ReactHotLoaderTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_ReactHotLoaderTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_ReactHotLoaderTransformer</span><span class="s1">);</span>

<span class="s3">var </span><span class="s2">_TypeScriptTransformer </span><span class="s1">= </span><span class="s2">require</span><span class="s1">(</span><span class="s0">'./TypeScriptTransformer'</span><span class="s1">); </span><span class="s3">var </span><span class="s2">_TypeScriptTransformer2 </span><span class="s1">= </span><span class="s2">_interopRequireDefault</span><span class="s1">(</span><span class="s2">_TypeScriptTransformer</span><span class="s1">);</span>








 <span class="s3">class </span><span class="s2">RootTransformer </span><span class="s1">{</span>
   <span class="s2">__init</span><span class="s1">() {</span><span class="s3">this</span><span class="s1">.</span><span class="s2">transformers </span><span class="s1">= []}</span>
  
  
   <span class="s2">__init2</span><span class="s1">() {</span><span class="s3">this</span><span class="s1">.</span><span class="s2">generatedVariables </span><span class="s1">= []}</span>
  
  
  
  

  <span class="s2">constructor</span><span class="s1">(</span>
    <span class="s2">sucraseContext</span><span class="s1">,</span>
    <span class="s2">transforms</span><span class="s1">,</span>
    <span class="s2">enableLegacyBabel5ModuleInterop</span><span class="s1">,</span>
    <span class="s2">options</span><span class="s1">,</span>
  <span class="s1">) {;</span><span class="s2">RootTransformer</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">__init</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span><span class="s2">RootTransformer</span><span class="s1">.</span><span class="s2">prototype</span><span class="s1">.</span><span class="s2">__init2</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">this</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager </span><span class="s1">= </span><span class="s2">sucraseContext</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager </span><span class="s1">= </span><span class="s2">sucraseContext</span><span class="s1">.</span><span class="s2">helperManager</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s1">{</span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">importProcessor</span><span class="s1">} = </span><span class="s2">sucraseContext</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens </span><span class="s1">= </span><span class="s2">tokenProcessor</span><span class="s1">;</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">isImportsTransformEnabled </span><span class="s1">= </span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;imports&quot;</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">isReactHotLoaderTransformEnabled </span><span class="s1">= </span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;react-hot-loader&quot;</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">disableESTransforms </span><span class="s1">= </span><span class="s2">Boolean</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">disableESTransforms</span><span class="s1">);</span>

    <span class="s3">if </span><span class="s1">(!</span><span class="s2">options</span><span class="s1">.</span><span class="s2">disableESTransforms</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_OptionalChainingNullishTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">),</span>
      <span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_NumericSeparatorTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s2">tokenProcessor</span><span class="s1">));</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_OptionalCatchBindingTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">));</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;jsx&quot;</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">jsxRuntime </span><span class="s1">!== </span><span class="s0">&quot;preserve&quot;</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
          <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_JSXTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">importProcessor</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">, </span><span class="s2">options</span><span class="s1">),</span>
        <span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_ReactDisplayNameTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">importProcessor</span><span class="s1">, </span><span class="s2">options</span><span class="s1">),</span>
      <span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">let </span><span class="s2">reactHotLoaderTransformer </span><span class="s1">= </span><span class="s3">null</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;react-hot-loader&quot;</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(!</span><span class="s2">options</span><span class="s1">.</span><span class="s2">filePath</span><span class="s1">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;filePath is required when using the react-hot-loader transform.&quot;</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s2">reactHotLoaderTransformer </span><span class="s1">= </span><span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_ReactHotLoaderTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">options</span><span class="s1">.</span><span class="s2">filePath</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">reactHotLoaderTransformer</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s5">// Note that we always want to enable the imports transformer, even when the import transform</span>
    <span class="s5">// itself isn't enabled, since we need to do type-only import pruning for both Flow and</span>
    <span class="s5">// TypeScript.</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;imports&quot;</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">importProcessor </span><span class="s1">=== </span><span class="s3">null</span><span class="s1">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected non-null importProcessor with imports transform enabled.&quot;</span><span class="s1">);</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_CJSImportTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span>
          <span class="s3">this</span><span class="s1">,</span>
          <span class="s2">tokenProcessor</span><span class="s1">,</span>
          <span class="s2">importProcessor</span><span class="s1">,</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">,</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager</span><span class="s1">,</span>
          <span class="s2">reactHotLoaderTransformer</span><span class="s1">,</span>
          <span class="s2">enableLegacyBabel5ModuleInterop</span><span class="s1">,</span>
          <span class="s2">Boolean</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">enableLegacyTypeScriptModuleInterop</span><span class="s1">),</span>
          <span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;typescript&quot;</span><span class="s1">),</span>
          <span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;flow&quot;</span><span class="s1">),</span>
          <span class="s2">Boolean</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">preserveDynamicImport</span><span class="s1">),</span>
          <span class="s2">Boolean</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">keepUnusedImports</span><span class="s1">),</span>
        <span class="s1">),</span>
      <span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_ESMImportTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span>
          <span class="s2">tokenProcessor</span><span class="s1">,</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">,</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager</span><span class="s1">,</span>
          <span class="s2">reactHotLoaderTransformer</span><span class="s1">,</span>
          <span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;typescript&quot;</span><span class="s1">),</span>
          <span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;flow&quot;</span><span class="s1">),</span>
          <span class="s2">Boolean</span><span class="s1">(</span><span class="s2">options</span><span class="s1">.</span><span class="s2">keepUnusedImports</span><span class="s1">),</span>
          <span class="s2">options</span><span class="s1">,</span>
        <span class="s1">),</span>
      <span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;flow&quot;</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_FlowTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;imports&quot;</span><span class="s1">)),</span>
      <span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;typescript&quot;</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_TypeScriptTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;imports&quot;</span><span class="s1">)),</span>
      <span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">transforms</span><span class="s1">.</span><span class="s2">includes</span><span class="s1">(</span><span class="s0">&quot;jest&quot;</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span>
        <span class="s3">new </span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">_JestHoistTransformer2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">)(</span><span class="s3">this</span><span class="s1">, </span><span class="s2">tokenProcessor</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">, </span><span class="s2">importProcessor</span><span class="s1">),</span>
      <span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">transform</span><span class="s1">() {</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">reset</span><span class="s1">();</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">shouldAddUseStrict </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">isImportsTransformEnabled</span><span class="s1">;</span>
    <span class="s5">// &quot;use strict&quot; always needs to be first, so override the normal transformer order.</span>
    <span class="s3">let </span><span class="s2">prefix </span><span class="s1">= </span><span class="s2">shouldAddUseStrict </span><span class="s1">? </span><span class="s0">'&quot;use strict&quot;;' </span><span class="s1">: </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">transformer of </span><span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">) {</span>
      <span class="s2">prefix </span><span class="s1">+= </span><span class="s2">transformer</span><span class="s1">.</span><span class="s2">getPrefixCode</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s2">prefix </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">helperManager</span><span class="s1">.</span><span class="s2">emitHelpers</span><span class="s1">();</span>
    <span class="s2">prefix </span><span class="s1">+= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">generatedVariables</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">v</span><span class="s1">) =&gt; </span><span class="s0">` var </span><span class="s2">$</span><span class="s1">{</span><span class="s2">v</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">);</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">transformer of </span><span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">) {</span>
      <span class="s2">prefix </span><span class="s1">+= </span><span class="s2">transformer</span><span class="s1">.</span><span class="s2">getHoistedCode</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">let </span><span class="s2">suffix </span><span class="s1">= </span><span class="s0">&quot;&quot;</span><span class="s1">;</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">transformer of </span><span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">) {</span>
      <span class="s2">suffix </span><span class="s1">+= </span><span class="s2">transformer</span><span class="s1">.</span><span class="s2">getSuffixCode</span><span class="s1">();</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">result </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">finish</span><span class="s1">();</span>
    <span class="s3">let </span><span class="s1">{</span><span class="s2">code</span><span class="s1">} = </span><span class="s2">result</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">code</span><span class="s1">.</span><span class="s2">startsWith</span><span class="s1">(</span><span class="s0">&quot;#!&quot;</span><span class="s1">)) {</span>
      <span class="s3">let </span><span class="s2">newlineIndex </span><span class="s1">= </span><span class="s2">code</span><span class="s1">.</span><span class="s2">indexOf</span><span class="s1">(</span><span class="s0">&quot;</span><span class="s3">\n</span><span class="s0">&quot;</span><span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">newlineIndex </span><span class="s1">=== -</span><span class="s4">1</span><span class="s1">) {</span>
        <span class="s2">newlineIndex </span><span class="s1">= </span><span class="s2">code</span><span class="s1">.</span><span class="s2">length</span><span class="s1">;</span>
        <span class="s2">code </span><span class="s1">+= </span><span class="s0">&quot;</span><span class="s3">\n</span><span class="s0">&quot;</span><span class="s1">;</span>
      <span class="s1">}</span>
      <span class="s3">return </span><span class="s1">{</span>
        <span class="s2">code</span><span class="s1">: </span><span class="s2">code</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s4">0</span><span class="s1">, </span><span class="s2">newlineIndex </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">) + </span><span class="s2">prefix </span><span class="s1">+ </span><span class="s2">code</span><span class="s1">.</span><span class="s2">slice</span><span class="s1">(</span><span class="s2">newlineIndex </span><span class="s1">+ </span><span class="s4">1</span><span class="s1">) + </span><span class="s2">suffix</span><span class="s1">,</span>
        <span class="s5">// The hashbang line has no tokens, so shifting the tokens to account</span>
        <span class="s5">// for prefix can happen normally.</span>
        <span class="s2">mappings</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">shiftMappings</span><span class="s1">(</span><span class="s2">result</span><span class="s1">.</span><span class="s2">mappings</span><span class="s1">, </span><span class="s2">prefix</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span>
      <span class="s1">};</span>
    <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
      <span class="s3">return </span><span class="s1">{</span>
        <span class="s2">code</span><span class="s1">: </span><span class="s2">prefix </span><span class="s1">+ </span><span class="s2">code </span><span class="s1">+ </span><span class="s2">suffix</span><span class="s1">,</span>
        <span class="s2">mappings</span><span class="s1">: </span><span class="s3">this</span><span class="s1">.</span><span class="s2">shiftMappings</span><span class="s1">(</span><span class="s2">result</span><span class="s1">.</span><span class="s2">mappings</span><span class="s1">, </span><span class="s2">prefix</span><span class="s1">.</span><span class="s2">length</span><span class="s1">),</span>
      <span class="s1">};</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">processBalancedCode</span><span class="s1">() {</span>
    <span class="s3">let </span><span class="s2">braceDepth </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s2">parenDepth </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">isAtEnd</span><span class="s1">()) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">) || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">dollarBraceL</span><span class="s1">)) {</span>
        <span class="s2">braceDepth</span><span class="s1">++;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">)) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">braceDepth </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">) {</span>
          <span class="s3">return</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">braceDepth</span><span class="s1">--;</span>
      <span class="s1">}</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">)) {</span>
        <span class="s2">parenDepth</span><span class="s1">++;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">)) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">parenDepth </span><span class="s1">=== </span><span class="s4">0</span><span class="s1">) {</span>
          <span class="s3">return</span><span class="s1">;</span>
        <span class="s1">}</span>
        <span class="s2">parenDepth</span><span class="s1">--;</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s2">processToken</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processClass</span><span class="s1">();</span>
      <span class="s3">return</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">const </span><span class="s2">transformer of </span><span class="s3">this</span><span class="s1">.</span><span class="s2">transformers</span><span class="s1">) {</span>
      <span class="s3">const </span><span class="s2">wasProcessed </span><span class="s1">= </span><span class="s2">transformer</span><span class="s1">.</span><span class="s2">process</span><span class="s1">();</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">wasProcessed</span><span class="s1">) {</span>
        <span class="s3">return</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* Skip past a class with a name and return that name.</span>
   <span class="s6">*/</span>
  <span class="s2">processNamedClass</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">name</span><span class="s1">)) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected identifier for exported class name.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">name </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">identifierNameAtIndex</span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s4">1</span><span class="s1">);</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">processClass</span><span class="s1">();</span>
    <span class="s3">return </span><span class="s2">name</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">processClass</span><span class="s1">() {</span>
    <span class="s3">const </span><span class="s2">classInfo </span><span class="s1">= </span><span class="s2">_getClassInfo2</span><span class="s1">.</span><span class="s2">default</span><span class="s1">.</span><span class="s2">call</span><span class="s1">(</span><span class="s3">void </span><span class="s4">0</span><span class="s1">, </span><span class="s3">this</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">, </span><span class="s3">this</span><span class="s1">.</span><span class="s2">disableESTransforms</span><span class="s1">);</span>

    <span class="s5">// Both static and instance initializers need a class name to use to invoke the initializer, so</span>
    <span class="s5">// assign to one if necessary.</span>
    <span class="s3">const </span><span class="s2">needsCommaExpression </span><span class="s1">=</span>
      <span class="s1">(</span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">headerInfo</span><span class="s1">.</span><span class="s2">isExpression </span><span class="s1">|| !</span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">headerInfo</span><span class="s1">.</span><span class="s2">className</span><span class="s1">) &amp;&amp;</span>
      <span class="s2">classInfo</span><span class="s1">.</span><span class="s2">staticInitializerNames</span><span class="s1">.</span><span class="s2">length </span><span class="s1">+ </span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">instanceInitializerNames</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&gt; </span><span class="s4">0</span><span class="s1">;</span>

    <span class="s3">let </span><span class="s2">className </span><span class="s1">= </span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">headerInfo</span><span class="s1">.</span><span class="s2">className</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">needsCommaExpression</span><span class="s1">) {</span>
      <span class="s2">className </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">.</span><span class="s2">claimFreeName</span><span class="s1">(</span><span class="s0">&quot;_class&quot;</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">generatedVariables</span><span class="s1">.</span><span class="s2">push</span><span class="s1">(</span><span class="s2">className</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` (</span><span class="s2">$</span><span class="s1">{</span><span class="s2">className</span><span class="s1">} </span><span class="s0">=`</span><span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">const </span><span class="s2">classToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">();</span>
    <span class="s3">const </span><span class="s2">contextId </span><span class="s1">= </span><span class="s2">classToken</span><span class="s1">.</span><span class="s2">contextId</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">contextId </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected class to have a context ID.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_class</span><span class="s1">);</span>
    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextIdAndLabel</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">, </span><span class="s2">contextId</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
    <span class="s1">}</span>

    <span class="s3">this</span><span class="s1">.</span><span class="s2">processClassBody</span><span class="s1">(</span><span class="s2">classInfo</span><span class="s1">, </span><span class="s2">className</span><span class="s1">);</span>

    <span class="s3">const </span><span class="s2">staticInitializerStatements </span><span class="s1">= </span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">staticInitializerNames</span><span class="s1">.</span><span class="s2">map</span><span class="s1">(</span>
      <span class="s1">(</span><span class="s2">name</span><span class="s1">) =&gt; </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">className</span><span class="s1">}</span><span class="s0">.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">()`</span><span class="s1">,</span>
    <span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">needsCommaExpression</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span>
        <span class="s0">`, </span><span class="s2">$</span><span class="s1">{</span><span class="s2">staticInitializerStatements</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">s</span><span class="s1">) =&gt; </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">, `</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;&quot;</span><span class="s1">)}</span><span class="s2">$</span><span class="s1">{</span><span class="s2">className</span><span class="s1">}</span><span class="s0">)`</span><span class="s1">,</span>
      <span class="s1">);</span>
    <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s2">classInfo</span><span class="s1">.</span><span class="s2">staticInitializerNames</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&gt; </span><span class="s4">0</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">` </span><span class="s2">$</span><span class="s1">{</span><span class="s2">staticInitializerStatements</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">s</span><span class="s1">) =&gt; </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">s</span><span class="s1">}</span><span class="s0">;`</span><span class="s1">).</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot; &quot;</span><span class="s1">)}</span><span class="s0">`</span><span class="s1">);</span>
    <span class="s1">}</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* We want to just handle class fields in all contexts, since TypeScript supports them. Later,</span>
   <span class="s6">* when some JS implementations support class fields, this should be made optional.</span>
   <span class="s6">*/</span>
  <span class="s2">processClassBody</span><span class="s1">(</span><span class="s2">classInfo</span><span class="s1">, </span><span class="s2">className</span><span class="s1">) {</span>
    <span class="s3">const </span><span class="s1">{</span>
      <span class="s2">headerInfo</span><span class="s1">,</span>
      <span class="s2">constructorInsertPos</span><span class="s1">,</span>
      <span class="s2">constructorInitializerStatements</span><span class="s1">,</span>
      <span class="s2">fields</span><span class="s1">,</span>
      <span class="s2">instanceInitializerNames</span><span class="s1">,</span>
      <span class="s2">rangesToRemove</span><span class="s1">,</span>
    <span class="s1">} = </span><span class="s2">classInfo</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s2">fieldIndex </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">let </span><span class="s2">rangeToRemoveIndex </span><span class="s1">= </span><span class="s4">0</span><span class="s1">;</span>
    <span class="s3">const </span><span class="s2">classContextId </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">contextId</span><span class="s1">;</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">classContextId </span><span class="s1">== </span><span class="s3">null</span><span class="s1">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s1">(</span><span class="s0">&quot;Expected non-null context ID on class.&quot;</span><span class="s1">);</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceL</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">isReactHotLoaderTransformEnabled</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span>
        <span class="s0">&quot;__reactstandin__regenerateByEval(key, code) {this[key] = eval(code);}&quot;</span><span class="s1">,</span>
      <span class="s1">);</span>
    <span class="s1">}</span>

    <span class="s3">const </span><span class="s2">needsConstructorInit </span><span class="s1">=</span>
      <span class="s2">constructorInitializerStatements</span><span class="s1">.</span><span class="s2">length </span><span class="s1">+ </span><span class="s2">instanceInitializerNames</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&gt; </span><span class="s4">0</span><span class="s1">;</span>

    <span class="s3">if </span><span class="s1">(</span><span class="s2">constructorInsertPos </span><span class="s1">=== </span><span class="s3">null </span><span class="s1">&amp;&amp; </span><span class="s2">needsConstructorInit</span><span class="s1">) {</span>
      <span class="s3">const </span><span class="s2">constructorInitializersCode </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">makeConstructorInitCode</span><span class="s1">(</span>
        <span class="s2">constructorInitializerStatements</span><span class="s1">,</span>
        <span class="s2">instanceInitializerNames</span><span class="s1">,</span>
        <span class="s2">className</span><span class="s1">,</span>
      <span class="s1">);</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">headerInfo</span><span class="s1">.</span><span class="s2">hasSuperclass</span><span class="s1">) {</span>
        <span class="s3">const </span><span class="s2">argsName </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">nameManager</span><span class="s1">.</span><span class="s2">claimFreeName</span><span class="s1">(</span><span class="s0">&quot;args&quot;</span><span class="s1">);</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span>
          <span class="s0">`constructor(...</span><span class="s2">$</span><span class="s1">{</span><span class="s2">argsName</span><span class="s1">}</span><span class="s0">) { super(...</span><span class="s2">$</span><span class="s1">{</span><span class="s2">argsName</span><span class="s1">}</span><span class="s0">); </span><span class="s2">$</span><span class="s1">{</span><span class="s2">constructorInitializersCode</span><span class="s1">}</span><span class="s0">; }`</span><span class="s1">,</span>
        <span class="s1">);</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">`constructor() { </span><span class="s2">$</span><span class="s1">{</span><span class="s2">constructorInitializersCode</span><span class="s1">}</span><span class="s0">; }`</span><span class="s1">);</span>
      <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">while </span><span class="s1">(!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextIdAndLabel</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">, </span><span class="s2">classContextId</span><span class="s1">)) {</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">fieldIndex </span><span class="s1">&lt; </span><span class="s2">fields</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() === </span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">start</span><span class="s1">) {</span>
        <span class="s3">let </span><span class="s2">needsCloseBrace </span><span class="s1">= </span><span class="s3">false</span><span class="s1">;</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">bracketL</span><span class="s1">)) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyTokenWithPrefix</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">initializerName</span><span class="s1">}</span><span class="s0">() {this`</span><span class="s1">);</span>
        <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">string</span><span class="s1">) || </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">num</span><span class="s1">)) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyTokenWithPrefix</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">initializerName</span><span class="s1">}</span><span class="s0">() {this[`</span><span class="s1">);</span>
          <span class="s2">needsCloseBrace </span><span class="s1">= </span><span class="s3">true</span><span class="s1">;</span>
        <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyTokenWithPrefix</span><span class="s1">(</span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">initializerName</span><span class="s1">}</span><span class="s0">() {this.`</span><span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">end</span><span class="s1">) {</span>
          <span class="s3">if </span><span class="s1">(</span><span class="s2">needsCloseBrace </span><span class="s1">&amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() === </span><span class="s2">fields</span><span class="s1">[</span><span class="s2">fieldIndex</span><span class="s1">].</span><span class="s2">equalsIndex</span><span class="s1">) {</span>
            <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">&quot;]&quot;</span><span class="s1">);</span>
          <span class="s1">}</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span><span class="s0">&quot;}&quot;</span><span class="s1">);</span>
        <span class="s2">fieldIndex</span><span class="s1">++;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span>
        <span class="s2">rangeToRemoveIndex </span><span class="s1">&lt; </span><span class="s2">rangesToRemove</span><span class="s1">.</span><span class="s2">length </span><span class="s1">&amp;&amp;</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &gt;= </span><span class="s2">rangesToRemove</span><span class="s1">[</span><span class="s2">rangeToRemoveIndex</span><span class="s1">].</span><span class="s2">start</span>
      <span class="s1">) {</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">rangesToRemove</span><span class="s1">[</span><span class="s2">rangeToRemoveIndex</span><span class="s1">].</span><span class="s2">end</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">rangesToRemove</span><span class="s1">[</span><span class="s2">rangeToRemoveIndex</span><span class="s1">].</span><span class="s2">end</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s2">rangeToRemoveIndex</span><span class="s1">++;</span>
      <span class="s1">} </span><span class="s3">else if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() === </span><span class="s2">constructorInsertPos</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyToken</span><span class="s1">();</span>
        <span class="s3">if </span><span class="s1">(</span><span class="s2">needsConstructorInit</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">appendCode</span><span class="s1">(</span>
            <span class="s0">`;</span><span class="s2">$</span><span class="s1">{</span><span class="s3">this</span><span class="s1">.</span><span class="s2">makeConstructorInitCode</span><span class="s1">(</span>
              <span class="s2">constructorInitializerStatements</span><span class="s1">,</span>
              <span class="s2">instanceInitializerNames</span><span class="s1">,</span>
              <span class="s2">className</span><span class="s1">,</span>
            <span class="s1">)}</span><span class="s0">;`</span><span class="s1">,</span>
          <span class="s1">);</span>
        <span class="s1">}</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
      <span class="s1">} </span><span class="s3">else </span><span class="s1">{</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">copyExpectedToken</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">braceR</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s2">makeConstructorInitCode</span><span class="s1">(</span>
    <span class="s2">constructorInitializerStatements</span><span class="s1">,</span>
    <span class="s2">instanceInitializerNames</span><span class="s1">,</span>
    <span class="s2">className</span><span class="s1">,</span>
  <span class="s1">) {</span>
    <span class="s3">return </span><span class="s1">[</span>
      <span class="s2">...constructorInitializerStatements</span><span class="s1">,</span>
      <span class="s2">...instanceInitializerNames</span><span class="s1">.</span><span class="s2">map</span><span class="s1">((</span><span class="s2">name</span><span class="s1">) =&gt; </span><span class="s0">`</span><span class="s2">$</span><span class="s1">{</span><span class="s2">className</span><span class="s1">}</span><span class="s0">.prototype.</span><span class="s2">$</span><span class="s1">{</span><span class="s2">name</span><span class="s1">}</span><span class="s0">.call(this)`</span><span class="s1">),</span>
    <span class="s1">].</span><span class="s2">join</span><span class="s1">(</span><span class="s0">&quot;;&quot;</span><span class="s1">);</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* Normally it's ok to simply remove type tokens, but we need to be more careful when dealing with</span>
   <span class="s6">* arrow function return types since they can confuse the parser. In that case, we want to move</span>
   <span class="s6">* the close-paren to the same line as the arrow.</span>
   <span class="s6">*</span>
   <span class="s6">* See https://github.com/alangpierce/sucrase/issues/391 for more details.</span>
   <span class="s6">*/</span>
  <span class="s2">processPossibleArrowParamEnd</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches2</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenR</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">colon</span><span class="s1">) &amp;&amp; </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokenAtRelativeIndex</span><span class="s1">(</span><span class="s4">1</span><span class="s1">).</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s3">let </span><span class="s2">nextNonTypeIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s4">1</span><span class="s1">;</span>
      <span class="s5">// Look ahead to see if this is an arrow function or something else.</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">nextNonTypeIndex</span><span class="s1">].</span><span class="s2">isType</span><span class="s1">) {</span>
        <span class="s2">nextNonTypeIndex</span><span class="s1">++;</span>
      <span class="s1">}</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">nextNonTypeIndex</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">arrow</span><span class="s1">)) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
        <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">nextNonTypeIndex</span><span class="s1">) {</span>
          <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
        <span class="s1">}</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceTokenTrimmingLeftWhitespace</span><span class="s1">(</span><span class="s0">&quot;) =&gt;&quot;</span><span class="s1">);</span>
        <span class="s3">return true</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s6">/**</span>
   <span class="s6">* An async arrow function might be of the form:</span>
   <span class="s6">*</span>
   <span class="s6">* async &lt;</span>
   <span class="s6">*   T</span>
   <span class="s6">* &gt;() =&gt; {}</span>
   <span class="s6">*</span>
   <span class="s6">* in which case, removing the type parameters will cause a syntax error. Detect this case and</span>
   <span class="s6">* move the open-paren earlier.</span>
   <span class="s6">*/</span>
  <span class="s2">processPossibleAsyncArrowWithTypeParams</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matchesContextual</span><span class="s1">(</span><span class="s2">_keywords</span><span class="s1">.</span><span class="s2">ContextualKeyword</span><span class="s1">.</span><span class="s2">_async</span><span class="s1">) &amp;&amp;</span>
      <span class="s1">!</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1</span><span class="s1">(</span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">_async</span><span class="s1">)</span>
    <span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">const </span><span class="s2">nextToken </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokenAtRelativeIndex</span><span class="s1">(</span><span class="s4">1</span><span class="s1">);</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s2">nextToken</span><span class="s1">.</span><span class="s2">type </span><span class="s1">!== </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">lessThan </span><span class="s1">|| !</span><span class="s2">nextToken</span><span class="s1">.</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s3">return false</span><span class="s1">;</span>
    <span class="s1">}</span>

    <span class="s3">let </span><span class="s2">nextNonTypeIndex </span><span class="s1">= </span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() + </span><span class="s4">1</span><span class="s1">;</span>
    <span class="s5">// Look ahead to see if this is an arrow function or something else.</span>
    <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">[</span><span class="s2">nextNonTypeIndex</span><span class="s1">].</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s2">nextNonTypeIndex</span><span class="s1">++;</span>
    <span class="s1">}</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">matches1AtIndex</span><span class="s1">(</span><span class="s2">nextNonTypeIndex</span><span class="s1">, </span><span class="s2">_types</span><span class="s1">.</span><span class="s2">TokenType</span><span class="s1">.</span><span class="s2">parenL</span><span class="s1">)) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">replaceToken</span><span class="s1">(</span><span class="s0">&quot;async (&quot;</span><span class="s1">);</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentIndex</span><span class="s1">() &lt; </span><span class="s2">nextNonTypeIndex</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s5">// We ate a ( token, so we need to process the tokens in between and then the ) token so that</span>
      <span class="s5">// we remain balanced.</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processBalancedCode</span><span class="s1">();</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">processToken</span><span class="s1">();</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">processPossibleTypeRange</span><span class="s1">() {</span>
    <span class="s3">if </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span><span class="s1">) {</span>
      <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeInitialToken</span><span class="s1">();</span>
      <span class="s3">while </span><span class="s1">(</span><span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">currentToken</span><span class="s1">().</span><span class="s2">isType</span><span class="s1">) {</span>
        <span class="s3">this</span><span class="s1">.</span><span class="s2">tokens</span><span class="s1">.</span><span class="s2">removeToken</span><span class="s1">();</span>
      <span class="s1">}</span>
      <span class="s3">return true</span><span class="s1">;</span>
    <span class="s1">}</span>
    <span class="s3">return false</span><span class="s1">;</span>
  <span class="s1">}</span>

  <span class="s2">shiftMappings</span><span class="s1">(</span>
    <span class="s2">mappings</span><span class="s1">,</span>
    <span class="s2">prefixLength</span><span class="s1">,</span>
  <span class="s1">) {</span>
    <span class="s3">for </span><span class="s1">(</span><span class="s3">let </span><span class="s2">i </span><span class="s1">= </span><span class="s4">0</span><span class="s1">; </span><span class="s2">i </span><span class="s1">&lt; </span><span class="s2">mappings</span><span class="s1">.</span><span class="s2">length</span><span class="s1">; </span><span class="s2">i</span><span class="s1">++) {</span>
      <span class="s3">const </span><span class="s2">mapping </span><span class="s1">= </span><span class="s2">mappings</span><span class="s1">[</span><span class="s2">i</span><span class="s1">];</span>
      <span class="s3">if </span><span class="s1">(</span><span class="s2">mapping </span><span class="s1">!== </span><span class="s2">undefined</span><span class="s1">) {</span>
        <span class="s2">mappings</span><span class="s1">[</span><span class="s2">i</span><span class="s1">] = </span><span class="s2">mapping </span><span class="s1">+ </span><span class="s2">prefixLength</span><span class="s1">;</span>
      <span class="s1">}</span>
    <span class="s1">}</span>
    <span class="s3">return </span><span class="s2">mappings</span><span class="s1">;</span>
  <span class="s1">}</span>
<span class="s1">} </span><span class="s2">exports</span><span class="s1">.</span><span class="s2">default </span><span class="s1">= </span><span class="s2">RootTransformer</span><span class="s1">;</span>
</pre>
</body>
</html>