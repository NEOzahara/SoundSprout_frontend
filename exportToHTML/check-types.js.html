<html>
<head>
<title>check-types.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #5f826b; font-style: italic;}
.s6 { color: #2aacb8;}
.s7 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
check-types.js</font>
</center></td></tr></table>
<pre><span class="s0">/*globals define, module, Symbol, Map, Set */</span>
<span class="s0">/*jshint -W056 */</span>

<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">globals</span><span class="s2">) {</span>
  <span class="s4">'use strict'</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">messages</span><span class="s2">, </span><span class="s1">predicates</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">, </span><span class="s1">not</span><span class="s2">, </span><span class="s1">maybe</span><span class="s2">, </span><span class="s1">collections</span><span class="s2">,</span>
     <span class="s1">hasOwnProperty</span><span class="s2">, </span><span class="s1">toString</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">, </span><span class="s1">slice</span><span class="s2">, </span><span class="s1">isArray</span><span class="s2">, </span><span class="s1">neginf</span><span class="s2">, </span><span class="s1">posinf</span><span class="s2">,</span>
     <span class="s1">haveSymbols</span><span class="s2">, </span><span class="s1">haveMaps</span><span class="s2">, </span><span class="s1">haveSets</span><span class="s2">;</span>

  <span class="s1">messages </span><span class="s2">= {};</span>
  <span class="s1">predicates </span><span class="s2">= {};</span>

  <span class="s2">[</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'equal'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">equal</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'equal {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'undefined'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">isUndefined</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be undefined' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'null'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">isNull</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be null' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'assigned'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">assigned</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be assigned' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'primitive'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">primitive</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be primitive type' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'contains'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">contains</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'contain {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'in'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">isIn</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be in {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'containsKey'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">containsKey</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'contain key {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'keyIn'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">keyIn</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be key in {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'zero'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">zero</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be 0' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'one'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">one</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be 1' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'infinity'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">infinity</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be infinity' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'number'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">number</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be Number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'integer'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">integer</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be integer' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'float'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">float</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be non-integer number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'even'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">even</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be even number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'odd'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">odd</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be odd number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'greater'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">greater</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be greater than {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'less'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">less</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be less than {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'between'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">between</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be between {e} and {e2}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'greaterOrEqual'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">greaterOrEqual</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be greater than or equal to {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'lessOrEqual'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">lessOrEqual</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be less than or equal to {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'inRange'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">inRange</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be in the range {e} to {e2}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'positive'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">positive</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be positive number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'negative'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">negative</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be negative number' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'string'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">string</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be String' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'emptyString'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">emptyString</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be empty string' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'nonEmptyString'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">nonEmptyString</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be non-empty string' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'match'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">match</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'match {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'boolean'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">boolean</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be Boolean' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'object'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">object</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be Object' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'emptyObject'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">emptyObject</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be empty object' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'nonEmptyObject'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">nonEmptyObject</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be non-empty object' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'instanceStrict'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">instanceStrict</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be instanceof {t}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'thenable'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">thenable</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be promise-like' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'instance'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">instance</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be {t}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'like'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">like</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be like {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'identical'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">identical</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be identical to {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'array'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">array</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be Array' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'emptyArray'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">emptyArray</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be empty array' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'nonEmptyArray'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">nonEmptyArray</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be non-empty array' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'arrayLike'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">arrayLike</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be array-like' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'iterable'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">iterable</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be iterable' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'date'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">date</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be valid Date' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'function'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">isFunction</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'be Function' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'hasLength'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">hasLength</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'have length {e}' </span><span class="s2">},</span>
    <span class="s2">{ </span><span class="s1">n</span><span class="s2">: </span><span class="s4">'throws'</span><span class="s2">, </span><span class="s1">f</span><span class="s2">: </span><span class="s1">throws</span><span class="s2">, </span><span class="s1">s</span><span class="s2">: </span><span class="s4">'throw' </span><span class="s2">}</span>
  <span class="s2">].</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">n </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">n</span><span class="s2">;</span>
    <span class="s1">messages</span><span class="s2">[</span><span class="s1">n</span><span class="s2">] = </span><span class="s4">'assert failed: expected {a} to ' </span><span class="s2">+ </span><span class="s1">data</span><span class="s2">.</span><span class="s1">s</span><span class="s2">;</span>
    <span class="s1">predicates</span><span class="s2">[</span><span class="s1">n</span><span class="s2">] = </span><span class="s1">data</span><span class="s2">.</span><span class="s1">f</span><span class="s2">;</span>
  <span class="s2">});</span>

  <span class="s1">functions </span><span class="s2">= {</span>
    <span class="s1">map</span><span class="s2">: </span><span class="s1">map</span><span class="s2">,</span>
    <span class="s1">all</span><span class="s2">: </span><span class="s1">all</span><span class="s2">,</span>
    <span class="s1">any</span><span class="s2">: </span><span class="s1">any</span>
  <span class="s2">};</span>

  <span class="s1">collections </span><span class="s2">= [ </span><span class="s4">'array'</span><span class="s2">, </span><span class="s4">'arrayLike'</span><span class="s2">, </span><span class="s4">'iterable'</span><span class="s2">, </span><span class="s4">'object' </span><span class="s2">];</span>
  <span class="s1">hasOwnProperty </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">;</span>
  <span class="s1">toString </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">;</span>
  <span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">;</span>
  <span class="s1">slice </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">;</span>
  <span class="s1">isArray </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">;</span>
  <span class="s1">neginf </span><span class="s2">= </span><span class="s1">Number</span><span class="s2">.</span><span class="s1">NEGATIVE_INFINITY</span><span class="s2">;</span>
  <span class="s1">posinf </span><span class="s2">= </span><span class="s1">Number</span><span class="s2">.</span><span class="s1">POSITIVE_INFINITY</span><span class="s2">;</span>
  <span class="s1">haveSymbols </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">Symbol </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>
  <span class="s1">haveMaps </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">Map </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>
  <span class="s1">haveSets </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">Set </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>

  <span class="s1">functions </span><span class="s2">= </span><span class="s1">mixin</span><span class="s2">(</span><span class="s1">functions</span><span class="s2">, </span><span class="s1">predicates</span><span class="s2">);</span>
  <span class="s1">assert </span><span class="s2">= </span><span class="s1">createModifiedPredicates</span><span class="s2">(</span><span class="s1">assertModifier</span><span class="s2">, </span><span class="s1">assertImpl</span><span class="s2">);</span>
  <span class="s1">not </span><span class="s2">= </span><span class="s1">createModifiedPredicates</span><span class="s2">(</span><span class="s1">notModifier</span><span class="s2">, </span><span class="s1">notImpl</span><span class="s2">);</span>
  <span class="s1">maybe </span><span class="s2">= </span><span class="s1">createModifiedPredicates</span><span class="s2">(</span><span class="s1">maybeModifier</span><span class="s2">, </span><span class="s1">maybeImpl</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">not </span><span class="s2">= </span><span class="s1">createModifiedModifier</span><span class="s2">(</span><span class="s1">assertModifier</span><span class="s2">, </span><span class="s1">not</span><span class="s2">, </span><span class="s4">'not '</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">maybe </span><span class="s2">= </span><span class="s1">createModifiedModifier</span><span class="s2">(</span><span class="s1">assertModifier</span><span class="s2">, </span><span class="s1">maybe</span><span class="s2">, </span><span class="s4">'maybe '</span><span class="s2">);</span>

  <span class="s1">collections</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">createOfPredicates</span><span class="s2">);</span>
  <span class="s1">createOfModifiers</span><span class="s2">(</span><span class="s1">assert</span><span class="s2">, </span><span class="s1">assertModifier</span><span class="s2">);</span>
  <span class="s1">createOfModifiers</span><span class="s2">(</span><span class="s1">not</span><span class="s2">, </span><span class="s1">notModifier</span><span class="s2">);</span>
  <span class="s1">collections</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s1">createMaybeOfModifiers</span><span class="s2">);</span>

  <span class="s1">exportFunctions</span><span class="s2">(</span><span class="s1">mixin</span><span class="s2">(</span><span class="s1">functions</span><span class="s2">, {</span>
    <span class="s1">assert</span><span class="s2">: </span><span class="s1">assert</span><span class="s2">,</span>
    <span class="s1">not</span><span class="s2">: </span><span class="s1">not</span><span class="s2">,</span>
    <span class="s1">maybe</span><span class="s2">: </span><span class="s1">maybe</span>
  <span class="s2">}));</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `equal`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `lhs` and `rhs` are strictly equal, without coercion.</span>
   <span class="s5">* Returns false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">equal </span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">, </span><span class="s1">rhs</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">lhs </span><span class="s2">=== </span><span class="s1">rhs</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `undefined`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is undefined, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">isUndefined </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s1">undefined</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `null`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is null, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">isNull </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `assigned`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is not null or undefined, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">assigned </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">!== </span><span class="s1">undefined </span><span class="s2">&amp;&amp; </span><span class="s1">data </span><span class="s2">!== </span><span class="s3">null</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `primitive`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a primitive type, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">primitive </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">type</span><span class="s2">;</span>

    <span class="s3">switch </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">case null</span><span class="s2">:</span>
      <span class="s3">case </span><span class="s1">undefined</span><span class="s2">:</span>
      <span class="s3">case false</span><span class="s2">:</span>
      <span class="s3">case true</span><span class="s2">:</span>
        <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">type </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">data</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">|| </span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'number' </span><span class="s2">|| (</span><span class="s1">haveSymbols </span><span class="s2">&amp;&amp; </span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'symbol'</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `zero`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is zero, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">zero </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `one`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is one, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">one </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s6">1</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `infinity`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is positive or negative infinity, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">infinity </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s1">neginf </span><span class="s2">|| </span><span class="s1">data </span><span class="s2">=== </span><span class="s1">posinf</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `number`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">number </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'number' </span><span class="s2">&amp;&amp; </span><span class="s1">data </span><span class="s2">&gt; </span><span class="s1">neginf </span><span class="s2">&amp;&amp; </span><span class="s1">data </span><span class="s2">&lt; </span><span class="s1">posinf</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `integer`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an integer, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">integer </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'number' </span><span class="s2">&amp;&amp; </span><span class="s1">data </span><span class="s2">% </span><span class="s6">1 </span><span class="s2">=== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `float`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a non-integer number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">float </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">number</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">% </span><span class="s6">1 </span><span class="s2">!== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `even`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an even number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">even </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'number' </span><span class="s2">&amp;&amp; </span><span class="s1">data </span><span class="s2">% </span><span class="s6">2 </span><span class="s2">=== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `odd`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an odd number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">odd </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">% </span><span class="s6">2 </span><span class="s2">!== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `greater`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `lhs` is a number greater than `rhs`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">greater </span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">, </span><span class="s1">rhs</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">number</span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">) &amp;&amp; </span><span class="s1">lhs </span><span class="s2">&gt; </span><span class="s1">rhs</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `less`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `lhs` is a number less than `rhs`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">less </span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">, </span><span class="s1">rhs</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">number</span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">) &amp;&amp; </span><span class="s1">lhs </span><span class="s2">&lt; </span><span class="s1">rhs</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `between`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a number between `x` and `y`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">between </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">y</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">greater</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">&lt; </span><span class="s1">y</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">less</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">&gt; </span><span class="s1">y</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `greaterOrEqual`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `lhs` is a number greater than or equal to `rhs`, false</span>
   <span class="s5">* otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">greaterOrEqual </span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">, </span><span class="s1">rhs</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">number</span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">) &amp;&amp; </span><span class="s1">lhs </span><span class="s2">&gt;= </span><span class="s1">rhs</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `lessOrEqual`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `lhs` is a number less than or equal to `rhs`, false</span>
   <span class="s5">* otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">lessOrEqual </span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">, </span><span class="s1">rhs</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">number</span><span class="s2">(</span><span class="s1">lhs</span><span class="s2">) &amp;&amp; </span><span class="s1">lhs </span><span class="s2">&lt;= </span><span class="s1">rhs</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `inRange`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a number in the range `x..y`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">inRange </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">, </span><span class="s1">y</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">x </span><span class="s2">&lt; </span><span class="s1">y</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">greaterOrEqual</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">&lt;= </span><span class="s1">y</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">lessOrEqual</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">x</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">&gt;= </span><span class="s1">y</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `positive`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a positive number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">positive </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">greater</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s6">0</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `negative`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a negative number, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">negative </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">less</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s6">0</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `string`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a string, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">string </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `emptyString`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is the empty string, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">emptyString </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `nonEmptyString`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a non-empty string, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">nonEmptyString </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">string</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data </span><span class="s2">!== </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `match`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a string that matches `regex`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">match </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">regex</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">string</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; !! </span><span class="s1">data</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s1">regex</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `boolean`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a boolean value, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">boolean </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s3">false </span><span class="s2">|| </span><span class="s1">data </span><span class="s2">=== </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `object`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a plain-old JS object, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">object </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) === </span><span class="s4">'[object Object]'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `emptyObject`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an empty object, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">emptyObject </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; ! </span><span class="s1">some</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">some </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">predicate</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])) {</span>
          <span class="s3">return true</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `nonEmptyObject`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a non-empty object, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">nonEmptyObject </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">some</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `thenable`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` has a `then` method.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">thenable </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">then</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `instanceStrict`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an instance of `prototype`, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">instanceStrict </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">prototype</span><span class="s2">) {</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">data </span><span class="s3">instanceof </span><span class="s1">prototype</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `instance`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an instance of `prototype`, false otherwise.</span>
   <span class="s5">* Falls back to testing constructor.name and Object.prototype.toString</span>
   <span class="s5">* if the initial instanceof test fails.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">instance </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">prototype</span><span class="s2">) {</span>
    <span class="s3">try </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">instanceStrict</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">prototype</span><span class="s2">) ||</span>
        <span class="s1">data</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">name </span><span class="s2">=== </span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">name </span><span class="s2">||</span>
        <span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) === </span><span class="s4">'[object ' </span><span class="s2">+ </span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">']'</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `like`.</span>
   <span class="s5">*</span>
   <span class="s5">* Tests whether `data` 'quacks like a duck'. Returns true if `data` has all</span>
   <span class="s5">* of the properties of `archetype` (the 'duck'), false otherwise. Interrogates</span>
   <span class="s5">* objects recursively, to arbitrary depth.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">like </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">archetype</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">name</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) || ! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s1">archetype</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">archetype</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
        <span class="s3">if </span><span class="s2">(! </span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">name</span><span class="s2">) || </span><span class="s3">typeof </span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] !== </span><span class="s3">typeof </span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) &amp;&amp; ! </span><span class="s1">like</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return true</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `identical`.</span>
   <span class="s5">*</span>
   <span class="s5">* Tests whether `data` has all of the same properties and values as `archetype`.</span>
   <span class="s5">* Interrogates objects recursively, to arbitrary depth.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">identical </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">archetype</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">name</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) || ! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">data </span><span class="s2">=== </span><span class="s1">archetype</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">archetype</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
        <span class="s3">if </span><span class="s2">(! </span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])) {</span>
          <span class="s3">if </span><span class="s2">(! </span><span class="s1">identical</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])) {</span>
            <span class="s3">return false</span><span class="s2">;</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] !== </span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
        <span class="s3">if </span><span class="s2">(! </span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">, </span><span class="s1">name</span><span class="s2">)) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])) {</span>
          <span class="s3">if </span><span class="s2">(! </span><span class="s1">identical</span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">], </span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">])) {</span>
            <span class="s3">return false</span><span class="s2">;</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">archetype</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] !== </span><span class="s1">data</span><span class="s2">[</span><span class="s1">name</span><span class="s2">]) {</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return true</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `array`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an array, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">array </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `emptyArray`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an empty array, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">emptyArray </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `nonEmptyArray`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a non-empty array, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">nonEmptyArray </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `arrayLike`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an array-like object, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">arrayLike </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s6">0</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `iterable`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is an iterable, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">iterable </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(! </span><span class="s1">haveSymbols</span><span class="s2">) {</span>
      <span class="s0">// Fall back to `arrayLike` predicate in pre-ES6 environments.</span>
      <span class="s3">return </span><span class="s1">arrayLike</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">Symbol</span><span class="s2">.</span><span class="s1">iterator</span><span class="s2">]);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `contains`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` contains `value`, false otherwise.</span>
   <span class="s5">* Works with objects, arrays and array-likes (including strings).</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">contains </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">iterator</span><span class="s2">, </span><span class="s1">iteration</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">haveSets </span><span class="s2">&amp;&amp; </span><span class="s1">instanceStrict</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">Set</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">data</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">string</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">data</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) !== -</span><span class="s6">1</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">haveSymbols </span><span class="s2">&amp;&amp; </span><span class="s1">data</span><span class="s2">[</span><span class="s1">Symbol</span><span class="s2">.</span><span class="s1">iterator</span><span class="s2">] &amp;&amp; </span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">values</span><span class="s2">)) {</span>
      <span class="s1">iterator </span><span class="s2">= </span><span class="s1">data</span><span class="s2">.</span><span class="s1">values</span><span class="s2">();</span>

      <span class="s3">do </span><span class="s2">{</span>
        <span class="s1">iteration </span><span class="s2">= </span><span class="s1">iterator</span><span class="s2">.</span><span class="s1">next</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">iteration</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">value</span><span class="s2">) {</span>
          <span class="s3">return true</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s3">while </span><span class="s2">(! </span><span class="s1">iteration</span><span class="s2">.</span><span class="s1">done</span><span class="s2">);</span>

      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">some</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">dataValue</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">dataValue </span><span class="s2">=== </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `in`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `value` is in `data`, false otherwise.</span>
   <span class="s5">* Like `contains`, but with arguments flipped.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">isIn </span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">contains</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `containsKey`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` contains key `key`, false otherwise.</span>
   <span class="s5">* Works with objects, arrays and array-likes (including strings).</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">containsKey </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">haveMaps </span><span class="s2">&amp;&amp; </span><span class="s1">instanceStrict</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">Map</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">data</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">iterable</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; ! </span><span class="s1">number</span><span class="s2">(+</span><span class="s1">key</span><span class="s2">)) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">!! </span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `keyIn`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if key `key` is in `data`, false otherwise.</span>
   <span class="s5">* Like `contains`, but with arguments flipped.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">keyIn </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">containsKey</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">key</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `hasLength`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` has a length property that equals `length`, false</span>
   <span class="s5">* otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">hasLength </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">length</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">) &amp;&amp; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s1">length</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `date`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a valid date, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">date </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">instanceStrict</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">Date</span><span class="s2">) &amp;&amp; </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">data</span><span class="s2">.</span><span class="s1">getTime</span><span class="s2">());</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `function`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a function, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">isFunction </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">return typeof </span><span class="s1">data </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `throws`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if `data` is a function that throws, false otherwise.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">throws </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(! </span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">try </span><span class="s2">{</span>
      <span class="s1">data</span><span class="s2">();</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">error</span><span class="s2">) {</span>
      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `map`.</span>
   <span class="s5">*</span>
   <span class="s5">* Maps each value from `data` to the corresponding predicate and returns</span>
   <span class="s5">* the results. If the same function is to be applied across all of the data,</span>
   <span class="s5">* a single predicate function may be passed in.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">map </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">predicates</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">result</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s1">result </span><span class="s2">= [];</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">result </span><span class="s2">= {};</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">predicates</span><span class="s2">)) {</span>
      <span class="s1">forEach</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s1">result</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">predicates</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">if </span><span class="s2">(! </span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">predicates</span><span class="s2">)) {</span>
        <span class="s1">assert</span><span class="s2">.</span><span class="s1">object</span><span class="s2">(</span><span class="s1">predicates</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">var </span><span class="s1">dataKeys </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">(</span><span class="s1">data </span><span class="s2">|| {});</span>

      <span class="s1">forEach</span><span class="s2">(</span><span class="s1">predicates</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">predicate</span><span class="s2">) {</span>
        <span class="s1">dataKeys</span><span class="s2">.</span><span class="s1">some</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">dataKey</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">dataKey </span><span class="s2">=== </span><span class="s1">key</span><span class="s2">) {</span>
            <span class="s1">dataKeys</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s6">1</span><span class="s2">);</span>
            <span class="s3">return true</span><span class="s2">;</span>
          <span class="s2">}</span>
          <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">});</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">)) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">not</span><span class="s2">.</span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
            <span class="s1">result</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = !! </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">m</span><span class="s2">;</span>
          <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">result</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">predicate</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]);</span>
          <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">result</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">map</span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">predicate</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">result</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">forEach </span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">action</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">object</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
        <span class="s1">action</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">object</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]);</span>
      <span class="s2">}</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `all`</span>
   <span class="s5">*</span>
   <span class="s5">* Check that all boolean values are true</span>
   <span class="s5">* in an array or object returned from `map`.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">all </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">testArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">assert</span><span class="s2">.</span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">testObject</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">false</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">testArray </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">i</span><span class="s2">;</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">data</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">+= </span><span class="s6">1</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">data</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] === </span><span class="s1">result</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">result</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">! </span><span class="s1">result</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">testObject </span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s1">key </span><span class="s3">in </span><span class="s1">data</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">data</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">object</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) &amp;&amp; </span><span class="s1">testObject</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">result</span><span class="s2">) === </span><span class="s1">result</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">result</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">result</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">result</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s2">! </span><span class="s1">result</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public function `any`</span>
   <span class="s5">*</span>
   <span class="s5">* Check that at least one boolean value is true</span>
   <span class="s5">* in an array or object returned from `map`.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">any </span><span class="s2">(</span><span class="s1">data</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">testArray</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">assert</span><span class="s2">.</span><span class="s1">object</span><span class="s2">(</span><span class="s1">data</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">testObject</span><span class="s2">(</span><span class="s1">data</span><span class="s2">, </span><span class="s3">true</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">mixin </span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">source</span><span class="s2">) {</span>
    <span class="s1">forEach</span><span class="s2">(</span><span class="s1">source</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
      <span class="s1">target</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">target</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public modifier `assert`.</span>
   <span class="s5">*</span>
   <span class="s5">* Throws if `predicate` returns false.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">assertModifier </span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">, </span><span class="s1">defaultMessage</span><span class="s2">) {</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">argCount </span><span class="s2">= </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">l </span><span class="s2">|| </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s1">argCount</span><span class="s2">];</span>
      <span class="s3">var </span><span class="s1">ErrorType </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s1">argCount </span><span class="s2">+ </span><span class="s6">1</span><span class="s2">];</span>

      <span class="s1">assertImpl</span><span class="s2">(</span>
        <span class="s1">predicate</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">args</span><span class="s2">),</span>
        <span class="s1">nonEmptyString</span><span class="s2">(</span><span class="s1">message</span><span class="s2">) ? </span><span class="s1">message </span><span class="s2">: </span><span class="s1">defaultMessage</span>
          <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'{a}'</span><span class="s2">, </span><span class="s1">messageFormatter</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s6">0</span><span class="s2">]))</span>
          <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'{e}'</span><span class="s2">, </span><span class="s1">messageFormatter</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s6">1</span><span class="s2">]))</span>
          <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'{e2}'</span><span class="s2">, </span><span class="s1">messageFormatter</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s6">2</span><span class="s2">]))</span>
          <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'{t}'</span><span class="s2">, </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">var </span><span class="s1">arg </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s6">1</span><span class="s2">];</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">arg </span><span class="s2">&amp;&amp; </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">name</span><span class="s2">) {</span>
              <span class="s3">return </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">arg</span><span class="s2">;</span>
          <span class="s2">}),</span>
        <span class="s1">isFunction</span><span class="s2">(</span><span class="s1">ErrorType</span><span class="s2">) ? </span><span class="s1">ErrorType </span><span class="s2">: </span><span class="s1">TypeError</span>
      <span class="s2">);</span>

      <span class="s3">return </span><span class="s1">args</span><span class="s2">[</span><span class="s6">0</span><span class="s2">];</span>
    <span class="s2">};</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">messageFormatter </span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
    <span class="s3">return function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">string</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">)) {</span>
        <span class="s3">return </span><span class="s4">'&quot;' </span><span class="s2">+ </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/\\/g</span><span class="s2">, </span><span class="s4">'</span><span class="s3">\\\\</span><span class="s4">'</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s7">/&quot;/g</span><span class="s2">, </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">&quot;'</span><span class="s2">) + </span><span class="s4">'&quot;'</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">arg </span><span class="s2">&amp;&amp; </span><span class="s1">arg </span><span class="s2">!== </span><span class="s3">true </span><span class="s2">&amp;&amp; </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">&amp;&amp; ! </span><span class="s1">instanceStrict</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">, </span><span class="s1">RegExp</span><span class="s2">) &amp;&amp; </span><span class="s3">typeof </span><span class="s1">arg </span><span class="s2">!== </span><span class="s4">'number'</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">arg</span><span class="s2">;</span>
    <span class="s2">};</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">assertImpl </span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">ErrorType</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">throw new </span><span class="s2">(</span><span class="s1">ErrorType </span><span class="s2">|| </span><span class="s1">Error</span><span class="s2">)(</span><span class="s1">message </span><span class="s2">|| </span><span class="s4">'assert failed'</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public modifier `not`.</span>
   <span class="s5">*</span>
   <span class="s5">* Negates `predicate`.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">notModifier </span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">modifiedPredicate </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">notImpl</span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">));</span>
    <span class="s2">};</span>
    <span class="s1">modifiedPredicate</span><span class="s2">.</span><span class="s1">l </span><span class="s2">= </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">modifiedPredicate</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">notImpl </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">! </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public modifier `maybe`.</span>
   <span class="s5">*</span>
   <span class="s5">* Returns true if predicate argument is  null or undefined,</span>
   <span class="s5">* otherwise propagates the return value from `predicate`.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">maybeModifier </span><span class="s2">(</span><span class="s1">predicate</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">modifiedPredicate </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">not</span><span class="s2">.</span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">[</span><span class="s6">0</span><span class="s2">])) {</span>
        <span class="s3">return true</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
    <span class="s2">};</span>
    <span class="s1">modifiedPredicate</span><span class="s2">.</span><span class="s1">l </span><span class="s2">= </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>

    <span class="s0">// Hackishly indicate that this is a maybe.xxx predicate.</span>
    <span class="s0">// Without this flag, the alternative would be to iterate</span>
    <span class="s0">// through the maybe predicates or use indexOf to check,</span>
    <span class="s0">// which would be time-consuming.</span>
    <span class="s1">modifiedPredicate</span><span class="s2">.</span><span class="s1">m </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

    <span class="s3">return </span><span class="s1">modifiedPredicate</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">maybeImpl </span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(! </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s5">/**</span>
   <span class="s5">* Public modifier `of`.</span>
   <span class="s5">*</span>
   <span class="s5">* Applies the chained predicate to members of the collection.</span>
   <span class="s5">*/</span>
  <span class="s3">function </span><span class="s1">ofModifier </span><span class="s2">(</span><span class="s1">target</span><span class="s2">, </span><span class="s1">type</span><span class="s2">, </span><span class="s1">predicate</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">modifiedPredicate </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
      <span class="s3">var </span><span class="s1">collection</span><span class="s2">, </span><span class="s1">args</span><span class="s2">;</span>

      <span class="s1">collection </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">[</span><span class="s6">0</span><span class="s2">];</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">target </span><span class="s2">=== </span><span class="s4">'maybe' </span><span class="s2">&amp;&amp; </span><span class="s1">not</span><span class="s2">.</span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">collection</span><span class="s2">)) {</span>
        <span class="s3">return true</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">if </span><span class="s2">(! </span><span class="s1">type</span><span class="s2">(</span><span class="s1">collection</span><span class="s2">)) {</span>
        <span class="s3">return false</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s1">collection </span><span class="s2">= </span><span class="s1">coerceCollection</span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">collection</span><span class="s2">);</span>
      <span class="s1">args </span><span class="s2">= </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s6">1</span><span class="s2">);</span>

      <span class="s3">try </span><span class="s2">{</span>
        <span class="s1">collection</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">item</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span>
            <span class="s2">(</span><span class="s1">target </span><span class="s2">!== </span><span class="s4">'maybe' </span><span class="s2">|| </span><span class="s1">assigned</span><span class="s2">(</span><span class="s1">item</span><span class="s2">)) &amp;&amp;</span>
            <span class="s2">! </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, [ </span><span class="s1">item </span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">args</span><span class="s2">))</span>
          <span class="s2">) {</span>
            <span class="s0">// TODO: Replace with for...of when ES6 is required.</span>
            <span class="s3">throw </span><span class="s6">0</span><span class="s2">;</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">ignore</span><span class="s2">) {</span>
        <span class="s3">return false</span><span class="s2">;</span>
      <span class="s2">}</span>

      <span class="s3">return true</span><span class="s2">;</span>
    <span class="s2">};</span>
    <span class="s1">modifiedPredicate</span><span class="s2">.</span><span class="s1">l </span><span class="s2">= </span><span class="s1">predicate</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">modifiedPredicate</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">coerceCollection </span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">collection</span><span class="s2">) {</span>
    <span class="s3">switch </span><span class="s2">(</span><span class="s1">type</span><span class="s2">) {</span>
      <span class="s3">case </span><span class="s1">arrayLike</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">collection</span><span class="s2">);</span>
      <span class="s3">case </span><span class="s1">object</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">keys</span><span class="s2">(</span><span class="s1">collection</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s1">collection</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
        <span class="s2">});</span>
      <span class="s3">default</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">collection</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createModifiedPredicates </span><span class="s2">(</span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">object</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">createModifiedFunctions</span><span class="s2">([ </span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">predicates</span><span class="s2">, </span><span class="s1">object</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">]);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createModifiedFunctions </span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">messageModifier</span><span class="s2">, </span><span class="s1">object</span><span class="s2">, </span><span class="s1">functions</span><span class="s2">;</span>

    <span class="s1">modifier </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">();</span>
    <span class="s1">messageModifier </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s1">object </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s1">functions </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>

    <span class="s1">forEach</span><span class="s2">(</span><span class="s1">functions</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">message </span><span class="s2">= </span><span class="s1">messages</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">message </span><span class="s2">&amp;&amp; </span><span class="s1">messageModifier</span><span class="s2">) {</span>
        <span class="s1">message </span><span class="s2">= </span><span class="s1">message</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'to'</span><span class="s2">, </span><span class="s1">messageModifier </span><span class="s2">+ </span><span class="s4">'to'</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s1">Object</span><span class="s2">.</span><span class="s1">defineProperty</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, {</span>
        <span class="s1">configurable</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
        <span class="s1">enumerable</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s1">writable</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
        <span class="s1">value</span><span class="s2">: </span><span class="s1">modifier</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">args</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">, </span><span class="s1">message</span><span class="s2">))</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">object</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createModifiedModifier </span><span class="s2">(</span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">modified</span><span class="s2">, </span><span class="s1">messageModifier</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">createModifiedFunctions</span><span class="s2">([ </span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">modified</span><span class="s2">, {}, </span><span class="s1">messageModifier </span><span class="s2">]);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createOfPredicates </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s1">predicates</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of </span><span class="s2">= </span><span class="s1">createModifiedFunctions</span><span class="s2">(</span>
      <span class="s2">[ </span><span class="s1">ofModifier</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s3">null</span><span class="s2">), </span><span class="s1">predicates</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">predicates</span><span class="s2">, {}, </span><span class="s4">'' </span><span class="s2">]</span>
    <span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createOfModifiers </span><span class="s2">(</span><span class="s1">base</span><span class="s2">, </span><span class="s1">modifier</span><span class="s2">) {</span>
    <span class="s1">collections</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s1">base</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of </span><span class="s2">= </span><span class="s1">createModifiedModifier</span><span class="s2">(</span><span class="s1">modifier</span><span class="s2">, </span><span class="s1">predicates</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">createMaybeOfModifiers </span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s1">maybe</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of </span><span class="s2">= </span><span class="s1">createModifiedFunctions</span><span class="s2">(</span>
      <span class="s2">[ </span><span class="s1">ofModifier</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s4">'maybe'</span><span class="s2">), </span><span class="s1">predicates</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">predicates</span><span class="s2">, {}, </span><span class="s4">'' </span><span class="s2">]</span>
    <span class="s2">);</span>
    <span class="s1">assert</span><span class="s2">.</span><span class="s1">maybe</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of </span><span class="s2">= </span><span class="s1">createModifiedModifier</span><span class="s2">(</span><span class="s1">assertModifier</span><span class="s2">, </span><span class="s1">maybe</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of</span><span class="s2">);</span>
    <span class="s1">assert</span><span class="s2">.</span><span class="s1">not</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of </span><span class="s2">= </span><span class="s1">createModifiedModifier</span><span class="s2">(</span><span class="s1">assertModifier</span><span class="s2">, </span><span class="s1">not</span><span class="s2">[</span><span class="s1">key</span><span class="s2">].</span><span class="s1">of</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">function </span><span class="s1">exportFunctions </span><span class="s2">(</span><span class="s1">functions</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">) {</span>
      <span class="s1">define</span><span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">return </span><span class="s1">functions</span><span class="s2">;</span>
      <span class="s2">});</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">module </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">&amp;&amp; </span><span class="s1">module </span><span class="s2">!== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">) {</span>
      <span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">functions</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">globals</span><span class="s2">.</span><span class="s1">check </span><span class="s2">= </span><span class="s1">functions</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">}(</span><span class="s3">this</span><span class="s2">));</span>
</pre>
</body>
</html>