<html>
<head>
<title>chunk-CVXGOGHQ.mjs</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #bcbec4;}
.s5 { color: #6aab73;}
.s6 { color: #7a7e85;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
chunk-CVXGOGHQ.mjs</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* react-router v7.6.0</span>
 <span class="s0">*</span>
 <span class="s0">* Copyright (c) Remix Software Inc.</span>
 <span class="s0">*</span>
 <span class="s0">* This source code is licensed under the MIT license found in the</span>
 <span class="s0">* LICENSE.md file in the root directory of this source tree.</span>
 <span class="s0">*</span>
 <span class="s0">* </span><span class="s1">@license </span><span class="s0">MIT</span>
 <span class="s0">*/</span>
<span class="s3">var </span><span class="s2">__typeError </span><span class="s4">= (</span><span class="s2">msg</span><span class="s4">) =&gt; {</span>
  <span class="s3">throw </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s2">msg</span><span class="s4">);</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">__accessCheck </span><span class="s4">= (</span><span class="s2">obj</span><span class="s4">, </span><span class="s2">member</span><span class="s4">, </span><span class="s2">msg</span><span class="s4">) =&gt; </span><span class="s2">member</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">) || </span><span class="s2">__typeError</span><span class="s4">(</span><span class="s5">&quot;Cannot &quot; </span><span class="s4">+ </span><span class="s2">msg</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">__privateGet </span><span class="s4">= (</span><span class="s2">obj</span><span class="s4">, </span><span class="s2">member</span><span class="s4">, </span><span class="s2">getter</span><span class="s4">) =&gt; (</span><span class="s2">__accessCheck</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">, </span><span class="s2">member</span><span class="s4">, </span><span class="s5">&quot;read from private field&quot;</span><span class="s4">), </span><span class="s2">getter </span><span class="s4">? </span><span class="s2">getter</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">) : </span><span class="s2">member</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">));</span>
<span class="s3">var </span><span class="s2">__privateAdd </span><span class="s4">= (</span><span class="s2">obj</span><span class="s4">, </span><span class="s2">member</span><span class="s4">, </span><span class="s2">value</span><span class="s4">) =&gt; </span><span class="s2">member</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">) ? </span><span class="s2">__typeError</span><span class="s4">(</span><span class="s5">&quot;Cannot add the same private member more than once&quot;</span><span class="s4">) : </span><span class="s2">member </span><span class="s3">instanceof </span><span class="s2">WeakSet </span><span class="s4">? </span><span class="s2">member</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">) : </span><span class="s2">member</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>

<span class="s6">// lib/router/history.ts</span>
<span class="s3">var </span><span class="s2">Action </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s4">((</span><span class="s2">Action2</span><span class="s4">) =&gt; {</span>
  <span class="s2">Action2</span><span class="s4">[</span><span class="s5">&quot;Pop&quot;</span><span class="s4">] = </span><span class="s5">&quot;POP&quot;</span><span class="s4">;</span>
  <span class="s2">Action2</span><span class="s4">[</span><span class="s5">&quot;Push&quot;</span><span class="s4">] = </span><span class="s5">&quot;PUSH&quot;</span><span class="s4">;</span>
  <span class="s2">Action2</span><span class="s4">[</span><span class="s5">&quot;Replace&quot;</span><span class="s4">] = </span><span class="s5">&quot;REPLACE&quot;</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">Action2</span><span class="s4">;</span>
<span class="s4">})(</span><span class="s2">Action </span><span class="s4">|| {});</span>
<span class="s3">var </span><span class="s2">PopStateEventType </span><span class="s4">= </span><span class="s5">&quot;popstate&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">createMemoryHistory</span><span class="s4">(</span><span class="s2">options </span><span class="s4">= {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">initialEntries </span><span class="s4">= [</span><span class="s5">&quot;/&quot;</span><span class="s4">], </span><span class="s2">initialIndex</span><span class="s4">, </span><span class="s2">v5Compat </span><span class="s4">= </span><span class="s3">false </span><span class="s4">} = </span><span class="s2">options</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">entries</span><span class="s4">;</span>
  <span class="s2">entries </span><span class="s4">= </span><span class="s2">initialEntries</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">entry</span><span class="s4">, </span><span class="s2">index2</span><span class="s4">) =&gt; </span><span class="s2">createMemoryLocation</span><span class="s4">(</span>
      <span class="s2">entry</span><span class="s4">,</span>
      <span class="s3">typeof </span><span class="s2">entry </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s3">null </span><span class="s4">: </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">state</span><span class="s4">,</span>
      <span class="s2">index2 </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">? </span><span class="s5">&quot;default&quot; </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">index </span><span class="s4">= </span><span class="s2">clampIndex</span><span class="s4">(</span>
    <span class="s2">initialIndex </span><span class="s4">== </span><span class="s3">null </span><span class="s4">? </span><span class="s2">entries</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1 </span><span class="s4">: </span><span class="s2">initialIndex</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">listener </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">function </span><span class="s2">clampIndex</span><span class="s4">(</span><span class="s2">n</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">Math</span><span class="s4">.</span><span class="s2">min</span><span class="s4">(</span><span class="s2">Math</span><span class="s4">.</span><span class="s2">max</span><span class="s4">(</span><span class="s2">n</span><span class="s4">, </span><span class="s7">0</span><span class="s4">), </span><span class="s2">entries</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getCurrentLocation</span><span class="s4">() {</span>
    <span class="s3">return </span><span class="s2">entries</span><span class="s4">[</span><span class="s2">index</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">createMemoryLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state </span><span class="s4">= </span><span class="s3">null</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span>
      <span class="s2">entries </span><span class="s4">? </span><span class="s2">getCurrentLocation</span><span class="s4">().</span><span class="s2">pathname </span><span class="s4">: </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
      <span class="s2">to</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">key</span>
    <span class="s4">);</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">) === </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
      <span class="s5">`relative pathnames are not supported in memory history: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
        <span class="s2">to</span>
      <span class="s4">)}</span><span class="s5">`</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">location</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">createHref2</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
    <span class="s3">return typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">history </span><span class="s4">= {</span>
    <span class="s2">get index</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">index</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get action</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">action</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get location</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">getCurrentLocation</span><span class="s4">();</span>
    <span class="s4">},</span>
    <span class="s2">createHref</span><span class="s4">: </span><span class="s2">createHref2</span><span class="s4">,</span>
    <span class="s2">createURL</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">return new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">createHref2</span><span class="s4">(</span><span class="s2">to</span><span class="s4">), </span><span class="s5">&quot;http://localhost&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) : </span><span class="s2">to</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s2">search</span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s2">hash</span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">push</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
      <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">nextLocation </span><span class="s4">= </span><span class="s2">createMemoryLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">);</span>
      <span class="s2">index </span><span class="s4">+= </span><span class="s7">1</span><span class="s4">;</span>
      <span class="s2">entries</span><span class="s4">.</span><span class="s2">splice</span><span class="s4">(</span><span class="s2">index</span><span class="s4">, </span><span class="s2">entries</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">nextLocation</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">v5Compat </span><span class="s4">&amp;&amp; </span><span class="s2">listener</span><span class="s4">) {</span>
        <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">nextLocation</span><span class="s4">, </span><span class="s2">delta</span><span class="s4">: </span><span class="s7">1 </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s2">replace</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
      <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">nextLocation </span><span class="s4">= </span><span class="s2">createMemoryLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">);</span>
      <span class="s2">entries</span><span class="s4">[</span><span class="s2">index</span><span class="s4">] = </span><span class="s2">nextLocation</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">v5Compat </span><span class="s4">&amp;&amp; </span><span class="s2">listener</span><span class="s4">) {</span>
        <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">nextLocation</span><span class="s4">, </span><span class="s2">delta</span><span class="s4">: </span><span class="s7">0 </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s2">go</span><span class="s4">(</span><span class="s2">delta</span><span class="s4">) {</span>
      <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">nextIndex </span><span class="s4">= </span><span class="s2">clampIndex</span><span class="s4">(</span><span class="s2">index </span><span class="s4">+ </span><span class="s2">delta</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">nextLocation </span><span class="s4">= </span><span class="s2">entries</span><span class="s4">[</span><span class="s2">nextIndex</span><span class="s4">];</span>
      <span class="s2">index </span><span class="s4">= </span><span class="s2">nextIndex</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">listener</span><span class="s4">) {</span>
        <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">nextLocation</span><span class="s4">, </span><span class="s2">delta </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s2">listen</span><span class="s4">(</span><span class="s2">fn</span><span class="s4">) {</span>
      <span class="s2">listener </span><span class="s4">= </span><span class="s2">fn</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s4">() =&gt; {</span>
        <span class="s2">listener </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">history</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createBrowserHistory</span><span class="s4">(</span><span class="s2">options </span><span class="s4">= {}) {</span>
  <span class="s3">function </span><span class="s2">createBrowserLocation</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">globalHistory</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">search</span><span class="s4">, </span><span class="s2">hash </span><span class="s4">} = </span><span class="s2">window2</span><span class="s4">.</span><span class="s2">location</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">createLocation</span><span class="s4">(</span>
      <span class="s5">&quot;&quot;</span><span class="s4">,</span>
      <span class="s4">{ </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">search</span><span class="s4">, </span><span class="s2">hash </span><span class="s4">},</span>
      <span class="s6">// state defaults to `null` because `window.history.state` does</span>
      <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state </span><span class="s4">&amp;&amp; </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">usr </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state </span><span class="s4">&amp;&amp; </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">key </span><span class="s4">|| </span><span class="s5">&quot;default&quot;</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">createBrowserHref</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">to</span><span class="s4">) {</span>
    <span class="s3">return typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">getUrlBasedHistory</span><span class="s4">(</span>
    <span class="s2">createBrowserLocation</span><span class="s4">,</span>
    <span class="s2">createBrowserHref</span><span class="s4">,</span>
    <span class="s3">null</span><span class="s4">,</span>
    <span class="s2">options</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createHashHistory</span><span class="s4">(</span><span class="s2">options </span><span class="s4">= {}) {</span>
  <span class="s3">function </span><span class="s2">createHashLocation</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">globalHistory</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s4">{</span>
      <span class="s2">pathname </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
      <span class="s2">search </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
      <span class="s2">hash </span><span class="s4">= </span><span class="s5">&quot;&quot;</span>
    <span class="s4">} = </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">.</span><span class="s2">substring</span><span class="s4">(</span><span class="s7">1</span><span class="s4">));</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) &amp;&amp; !</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;.&quot;</span><span class="s4">)) {</span>
      <span class="s2">pathname </span><span class="s4">= </span><span class="s5">&quot;/&quot; </span><span class="s4">+ </span><span class="s2">pathname</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">createLocation</span><span class="s4">(</span>
      <span class="s5">&quot;&quot;</span><span class="s4">,</span>
      <span class="s4">{ </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">search</span><span class="s4">, </span><span class="s2">hash </span><span class="s4">},</span>
      <span class="s6">// state defaults to `null` because `window.history.state` does</span>
      <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state </span><span class="s4">&amp;&amp; </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">usr </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state </span><span class="s4">&amp;&amp; </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">key </span><span class="s4">|| </span><span class="s5">&quot;default&quot;</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">createHashHref</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">to</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">base </span><span class="s4">= </span><span class="s2">window2</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">querySelector</span><span class="s4">(</span><span class="s5">&quot;base&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">href2 </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">base </span><span class="s4">&amp;&amp; </span><span class="s2">base</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;href&quot;</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">window2</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">href</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">hashIndex </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">);</span>
      <span class="s2">href2 </span><span class="s4">= </span><span class="s2">hashIndex </span><span class="s4">=== -</span><span class="s7">1 </span><span class="s4">? </span><span class="s2">url </span><span class="s4">: </span><span class="s2">url</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">hashIndex</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">href2 </span><span class="s4">+ </span><span class="s5">&quot;#&quot; </span><span class="s4">+ (</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">validateHashLocation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">to</span><span class="s4">) {</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">) === </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
      <span class="s5">`relative pathnames are not supported in hash history.push(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
        <span class="s2">to</span>
      <span class="s4">)}</span><span class="s5">)`</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">getUrlBasedHistory</span><span class="s4">(</span>
    <span class="s2">createHashLocation</span><span class="s4">,</span>
    <span class="s2">createHashHref</span><span class="s4">,</span>
    <span class="s2">validateHashLocation</span><span class="s4">,</span>
    <span class="s2">options</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">invariant</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">=== </span><span class="s3">false </span><span class="s4">|| </span><span class="s2">value </span><span class="s4">=== </span><span class="s3">null </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">warning</span><span class="s4">(</span><span class="s2">cond</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">cond</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">console </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) </span><span class="s2">console</span><span class="s4">.</span><span class="s2">warn</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createKey</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">Math</span><span class="s4">.</span><span class="s2">random</span><span class="s4">().</span><span class="s2">toString</span><span class="s4">(</span><span class="s7">36</span><span class="s4">).</span><span class="s2">substring</span><span class="s4">(</span><span class="s7">2</span><span class="s4">, </span><span class="s7">10</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getHistoryState</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">usr</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">state</span><span class="s4">,</span>
    <span class="s2">key</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">key</span><span class="s4">,</span>
    <span class="s2">idx</span><span class="s4">: </span><span class="s2">index</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s2">current</span><span class="s4">, </span><span class="s2">to</span><span class="s4">, </span><span class="s2">state </span><span class="s4">= </span><span class="s3">null</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= {</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s3">typeof </span><span class="s2">current </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">current </span><span class="s4">: </span><span class="s2">current</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">search</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">hash</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">...</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) : </span><span class="s2">to</span><span class="s4">,</span>
    <span class="s2">state</span><span class="s4">,</span>
    <span class="s6">// TODO: This could be cleaned up.  push/replace should probably just take</span>
    <span class="s6">// full Locations now and avoid the need to run through this flow at all</span>
    <span class="s6">// But that's a pretty big refactor to the current test suite so going to</span>
    <span class="s6">// keep as is for the time being and just let any incoming keys take precedence</span>
    <span class="s2">key</span><span class="s4">: </span><span class="s2">to </span><span class="s4">&amp;&amp; </span><span class="s2">to</span><span class="s4">.</span><span class="s2">key </span><span class="s4">|| </span><span class="s2">key </span><span class="s4">|| </span><span class="s2">createKey</span><span class="s4">()</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">location</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createPath</span><span class="s4">({</span>
  <span class="s2">pathname </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
  <span class="s2">search </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
  <span class="s2">hash </span><span class="s4">= </span><span class="s5">&quot;&quot;</span>
<span class="s4">}) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">search </span><span class="s4">&amp;&amp; </span><span class="s2">search </span><span class="s4">!== </span><span class="s5">&quot;?&quot;</span><span class="s4">)</span>
    <span class="s2">pathname </span><span class="s4">+= </span><span class="s2">search</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">) === </span><span class="s5">&quot;?&quot; </span><span class="s4">? </span><span class="s2">search </span><span class="s4">: </span><span class="s5">&quot;?&quot; </span><span class="s4">+ </span><span class="s2">search</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">hash </span><span class="s4">&amp;&amp; </span><span class="s2">hash </span><span class="s4">!== </span><span class="s5">&quot;#&quot;</span><span class="s4">)</span>
    <span class="s2">pathname </span><span class="s4">+= </span><span class="s2">hash</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">) === </span><span class="s5">&quot;#&quot; </span><span class="s4">? </span><span class="s2">hash </span><span class="s4">: </span><span class="s5">&quot;#&quot; </span><span class="s4">+ </span><span class="s2">hash</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">pathname</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">parsedPath </span><span class="s4">= {};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">path</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">hashIndex </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">hashIndex </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">substring</span><span class="s4">(</span><span class="s2">hashIndex</span><span class="s4">);</span>
      <span class="s2">path </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">substring</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">hashIndex</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">searchIndex </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">searchIndex </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">substring</span><span class="s4">(</span><span class="s2">searchIndex</span><span class="s4">);</span>
      <span class="s2">path </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">substring</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">searchIndex</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">path</span><span class="s4">) {</span>
      <span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">parsedPath</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getUrlBasedHistory</span><span class="s4">(</span><span class="s2">getLocation</span><span class="s4">, </span><span class="s2">createHref2</span><span class="s4">, </span><span class="s2">validateLocation</span><span class="s4">, </span><span class="s2">options </span><span class="s4">= {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">window</span><span class="s4">: </span><span class="s2">window2 </span><span class="s4">= </span><span class="s2">document</span><span class="s4">.</span><span class="s2">defaultView</span><span class="s4">, </span><span class="s2">v5Compat </span><span class="s4">= </span><span class="s3">false </span><span class="s4">} = </span><span class="s2">options</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">globalHistory </span><span class="s4">= </span><span class="s2">window2</span><span class="s4">.</span><span class="s2">history</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">listener </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">index </span><span class="s4">= </span><span class="s2">getIndex</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">index </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">index </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">replaceState</span><span class="s4">({ </span><span class="s2">...globalHistory</span><span class="s4">.</span><span class="s2">state</span><span class="s4">, </span><span class="s2">idx</span><span class="s4">: </span><span class="s2">index </span><span class="s4">}, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getIndex</span><span class="s4">() {</span>
    <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">state </span><span class="s4">|| { </span><span class="s2">idx</span><span class="s4">: </span><span class="s3">null </span><span class="s4">};</span>
    <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">idx</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">handlePop</span><span class="s4">() {</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">nextIndex </span><span class="s4">= </span><span class="s2">getIndex</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">delta </span><span class="s4">= </span><span class="s2">nextIndex </span><span class="s4">== </span><span class="s3">null </span><span class="s4">? </span><span class="s3">null </span><span class="s4">: </span><span class="s2">nextIndex </span><span class="s4">- </span><span class="s2">index</span><span class="s4">;</span>
    <span class="s2">index </span><span class="s4">= </span><span class="s2">nextIndex</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">listener</span><span class="s4">) {</span>
      <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">delta </span><span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">push</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">validateLocation</span><span class="s4">) </span><span class="s2">validateLocation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">to</span><span class="s4">);</span>
    <span class="s2">index </span><span class="s4">= </span><span class="s2">getIndex</span><span class="s4">() + </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">historyState </span><span class="s4">= </span><span class="s2">getHistoryState</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">history</span><span class="s4">.</span><span class="s2">createHref</span><span class="s4">(</span><span class="s2">location</span><span class="s4">);</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">pushState</span><span class="s4">(</span><span class="s2">historyState</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">url</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">DOMException </span><span class="s4">&amp;&amp; </span><span class="s2">error</span><span class="s4">.</span><span class="s2">name </span><span class="s4">=== </span><span class="s5">&quot;DataCloneError&quot;</span><span class="s4">) {</span>
        <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">window2</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">url</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">v5Compat </span><span class="s4">&amp;&amp; </span><span class="s2">listener</span><span class="s4">) {</span>
      <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">delta</span><span class="s4">: </span><span class="s7">1 </span><span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">replace2</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">to</span><span class="s4">, </span><span class="s2">state</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">validateLocation</span><span class="s4">) </span><span class="s2">validateLocation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">to</span><span class="s4">);</span>
    <span class="s2">index </span><span class="s4">= </span><span class="s2">getIndex</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">historyState </span><span class="s4">= </span><span class="s2">getHistoryState</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">history</span><span class="s4">.</span><span class="s2">createHref</span><span class="s4">(</span><span class="s2">location</span><span class="s4">);</span>
    <span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">replaceState</span><span class="s4">(</span><span class="s2">historyState</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">url</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">v5Compat </span><span class="s4">&amp;&amp; </span><span class="s2">listener</span><span class="s4">) {</span>
      <span class="s2">listener</span><span class="s4">({ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">delta</span><span class="s4">: </span><span class="s7">0 </span><span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">createURL</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">createBrowserURLImpl</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">history </span><span class="s4">= {</span>
    <span class="s2">get action</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">action</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get location</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">getLocation</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">globalHistory</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">listen</span><span class="s4">(</span><span class="s2">fn</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">listener</span><span class="s4">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;A history only accepts one active listener&quot;</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">window2</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s2">PopStateEventType</span><span class="s4">, </span><span class="s2">handlePop</span><span class="s4">);</span>
      <span class="s2">listener </span><span class="s4">= </span><span class="s2">fn</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s4">() =&gt; {</span>
        <span class="s2">window2</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span><span class="s2">PopStateEventType</span><span class="s4">, </span><span class="s2">handlePop</span><span class="s4">);</span>
        <span class="s2">listener </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">createHref</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">createHref2</span><span class="s4">(</span><span class="s2">window2</span><span class="s4">, </span><span class="s2">to</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">createURL</span><span class="s4">,</span>
    <span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">createURL</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">search</span><span class="s4">: </span><span class="s2">url</span><span class="s4">.</span><span class="s2">search</span><span class="s4">,</span>
        <span class="s2">hash</span><span class="s4">: </span><span class="s2">url</span><span class="s4">.</span><span class="s2">hash</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">push</span><span class="s4">,</span>
    <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
    <span class="s2">go</span><span class="s4">(</span><span class="s2">n</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">globalHistory</span><span class="s4">.</span><span class="s2">go</span><span class="s4">(</span><span class="s2">n</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">history</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createBrowserURLImpl</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">isAbsolute </span><span class="s4">= </span><span class="s3">false</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">base </span><span class="s4">= </span><span class="s5">&quot;http://localhost&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">window </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s2">base </span><span class="s4">= </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">!== </span><span class="s5">&quot;null&quot; </span><span class="s4">? </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">: </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">href</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">base</span><span class="s4">, </span><span class="s5">&quot;No window.location.(origin|href) available to create URL&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">href2 </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
  <span class="s2">href2 </span><span class="s4">= </span><span class="s2">href2</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/ $/</span><span class="s4">, </span><span class="s5">&quot;%20&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">isAbsolute </span><span class="s4">&amp;&amp; </span><span class="s2">href2</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;//&quot;</span><span class="s4">)) {</span>
    <span class="s2">href2 </span><span class="s4">= </span><span class="s2">base </span><span class="s4">+ </span><span class="s2">href2</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">href2</span><span class="s4">, </span><span class="s2">base</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/router/utils.ts</span>
<span class="s3">function </span><span class="s2">unstable_createContext</span><span class="s4">(</span><span class="s2">defaultValue</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">defaultValue </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">_map</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">unstable_RouterContextProvider </span><span class="s4">= </span><span class="s3">class </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">init</span><span class="s4">) {</span>
    <span class="s2">__privateAdd</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">_map</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">());</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">init</span><span class="s4">) {</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">context</span><span class="s4">, </span><span class="s2">value</span><span class="s4">] </span><span class="s2">of init</span><span class="s4">) {</span>
        <span class="s3">this</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">context</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">get</span><span class="s4">(</span><span class="s2">context</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">__privateGet</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">_map</span><span class="s4">).</span><span class="s2">has</span><span class="s4">(</span><span class="s2">context</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">__privateGet</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">_map</span><span class="s4">).</span><span class="s2">get</span><span class="s4">(</span><span class="s2">context</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">defaultValue </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">context</span><span class="s4">.</span><span class="s2">defaultValue</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;No value found for context&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">set</span><span class="s4">(</span><span class="s2">context</span><span class="s4">, </span><span class="s2">value</span><span class="s4">) {</span>
    <span class="s2">__privateGet</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">_map</span><span class="s4">).</span><span class="s2">set</span><span class="s4">(</span><span class="s2">context</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s2">_map </span><span class="s4">= </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s4">();</span>
<span class="s3">var </span><span class="s2">unsupportedLazyRouteObjectKeys </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span>
  <span class="s5">&quot;lazy&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;caseSensitive&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;path&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;id&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;index&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;children&quot;</span>
<span class="s4">]);</span>
<span class="s3">function </span><span class="s2">isUnsupportedLazyRouteObjectKey</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">unsupportedLazyRouteObjectKeys</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span>
    <span class="s2">key</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">unsupportedLazyRouteFunctionKeys </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span>
  <span class="s5">&quot;lazy&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;caseSensitive&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;path&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;id&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;index&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;unstable_middleware&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;children&quot;</span>
<span class="s4">]);</span>
<span class="s3">function </span><span class="s2">isUnsupportedLazyRouteFunctionKey</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">unsupportedLazyRouteFunctionKeys</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span>
    <span class="s2">key</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isIndexRoute</span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">parentPath </span><span class="s4">= [], </span><span class="s2">manifest </span><span class="s4">= {}) {</span>
  <span class="s3">return </span><span class="s2">routes</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">treePath </span><span class="s4">= [</span><span class="s2">...parentPath</span><span class="s4">, </span><span class="s2">String</span><span class="s4">(</span><span class="s2">index</span><span class="s4">)];</span>
    <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">: </span><span class="s2">treePath</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;-&quot;</span><span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">!== </span><span class="s3">true </span><span class="s4">|| !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">,</span>
      <span class="s5">`Cannot specify children on an index route`</span>
    <span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">id</span><span class="s4">],</span>
      <span class="s5">`Found a route id collision on id &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id</span><span class="s4">}</span><span class="s5">&quot;.  Route id's must be globally unique within Data Router usages`</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isIndexRoute</span><span class="s4">(</span><span class="s2">route</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">indexRoute </span><span class="s4">= {</span>
        <span class="s2">...route</span><span class="s4">,</span>
        <span class="s2">...mapRouteProperties2</span><span class="s4">(</span><span class="s2">route</span><span class="s4">),</span>
        <span class="s2">id</span>
      <span class="s4">};</span>
      <span class="s2">manifest</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">indexRoute</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">indexRoute</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">pathOrLayoutRoute </span><span class="s4">= {</span>
        <span class="s2">...route</span><span class="s4">,</span>
        <span class="s2">...mapRouteProperties2</span><span class="s4">(</span><span class="s2">route</span><span class="s4">),</span>
        <span class="s2">id</span><span class="s4">,</span>
        <span class="s2">children</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">};</span>
      <span class="s2">manifest</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">pathOrLayoutRoute</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">) {</span>
        <span class="s2">pathOrLayoutRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
          <span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">,</span>
          <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
          <span class="s2">treePath</span><span class="s4">,</span>
          <span class="s2">manifest</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">pathOrLayoutRoute</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">, </span><span class="s2">basename </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">matchRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s3">false</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">matchRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">allowPartial</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">locationArg </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">locationArg</span><span class="s4">) : </span><span class="s2">locationArg</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">pathname </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">branches </span><span class="s4">= </span><span class="s2">flattenRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">);</span>
  <span class="s2">rankRouteBranches</span><span class="s4">(</span><span class="s2">branches</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">matches </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">branches</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; ++</span><span class="s2">i</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">decoded </span><span class="s4">= </span><span class="s2">decodePath</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">);</span>
    <span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRouteBranch</span><span class="s4">(</span>
      <span class="s2">branches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">],</span>
      <span class="s2">decoded</span><span class="s4">,</span>
      <span class="s2">allowPartial</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">convertRouteMatchToUiMatch</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">route</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">params </span><span class="s4">} = </span><span class="s2">match</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
    <span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">params</span><span class="s4">,</span>
    <span class="s2">data</span><span class="s4">: </span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">],</span>
    <span class="s2">handle</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">handle</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">flattenRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">branches </span><span class="s4">= [], </span><span class="s2">parentsMeta </span><span class="s4">= [], </span><span class="s2">parentPath </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">flattenRoute </span><span class="s4">= (</span><span class="s2">route</span><span class="s4">, </span><span class="s2">index</span><span class="s4">, </span><span class="s2">relativePath</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">meta </span><span class="s4">= {</span>
      <span class="s2">relativePath</span><span class="s4">: </span><span class="s2">relativePath </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path </span><span class="s4">|| </span><span class="s5">&quot;&quot; </span><span class="s4">: </span><span class="s2">relativePath</span><span class="s4">,</span>
      <span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">caseSensitive </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">childrenIndex</span><span class="s4">: </span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">route</span>
    <span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">)) {</span>
      <span class="s2">invariant</span><span class="s4">(</span>
        <span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s2">parentPath</span><span class="s4">),</span>
        <span class="s5">`Absolute route path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">}</span><span class="s5">&quot; nested under path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPath</span><span class="s4">}</span><span class="s5">&quot; is not valid. An absolute child route path must start with the combined path of all its parent routes.`</span>
      <span class="s4">);</span>
      <span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath </span><span class="s4">= </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">parentPath</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">parentPath</span><span class="s4">, </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">]);</span>
    <span class="s3">let </span><span class="s2">routesMeta </span><span class="s4">= </span><span class="s2">parentsMeta</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">meta</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">invariant</span><span class="s4">(</span>
        <span class="s6">// Our types know better, but runtime JS may not!</span>
        <span class="s6">// @ts-expect-error</span>
        <span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">!== </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s5">`Index routes must not have child routes. Please remove all child routes from route path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">}</span><span class="s5">&quot;.`</span>
      <span class="s4">);</span>
      <span class="s2">flattenRoutes</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">, </span><span class="s2">branches</span><span class="s4">, </span><span class="s2">routesMeta</span><span class="s4">, </span><span class="s2">path</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">branches</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">score</span><span class="s4">: </span><span class="s2">computeScore</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">),</span>
      <span class="s2">routesMeta</span>
    <span class="s4">});</span>
  <span class="s4">};</span>
  <span class="s2">routes</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">route</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">|| !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">?.</span><span class="s2">includes</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">)) {</span>
      <span class="s2">flattenRoute</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">exploded of explodeOptionalSegments</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">)) {</span>
        <span class="s2">flattenRoute</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">index</span><span class="s4">, </span><span class="s2">exploded</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">branches</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">explodeOptionalSegments</span><span class="s4">(</span><span class="s2">path</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">segments</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) </span><span class="s3">return </span><span class="s4">[];</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">first</span><span class="s4">, </span><span class="s2">...rest</span><span class="s4">] = </span><span class="s2">segments</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">isOptional </span><span class="s4">= </span><span class="s2">first</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">required </span><span class="s4">= </span><span class="s2">first</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\?$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">isOptional </span><span class="s4">? [</span><span class="s2">required</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">] : [</span><span class="s2">required</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">restExploded </span><span class="s4">= </span><span class="s2">explodeOptionalSegments</span><span class="s4">(</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= [];</span>
  <span class="s2">result</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span>
    <span class="s2">...restExploded</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">subpath</span><span class="s4">) =&gt; </span><span class="s2">subpath </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">? </span><span class="s2">required </span><span class="s4">: [</span><span class="s2">required</span><span class="s4">, </span><span class="s2">subpath</span><span class="s4">].</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">)</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isOptional</span><span class="s4">) {</span>
    <span class="s2">result</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...restExploded</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">exploded</span><span class="s4">) =&gt; </span><span class="s2">path</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">exploded </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">? </span><span class="s5">&quot;/&quot; </span><span class="s4">: </span><span class="s2">exploded</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">rankRouteBranches</span><span class="s4">(</span><span class="s2">branches</span><span class="s4">) {</span>
  <span class="s2">branches</span><span class="s4">.</span><span class="s2">sort</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">a</span><span class="s4">, </span><span class="s2">b</span><span class="s4">) =&gt; </span><span class="s2">a</span><span class="s4">.</span><span class="s2">score </span><span class="s4">!== </span><span class="s2">b</span><span class="s4">.</span><span class="s2">score </span><span class="s4">? </span><span class="s2">b</span><span class="s4">.</span><span class="s2">score </span><span class="s4">- </span><span class="s2">a</span><span class="s4">.</span><span class="s2">score </span><span class="s4">: </span><span class="s2">compareIndexes</span><span class="s4">(</span>
      <span class="s2">a</span><span class="s4">.</span><span class="s2">routesMeta</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">meta</span><span class="s4">) =&gt; </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">childrenIndex</span><span class="s4">),</span>
      <span class="s2">b</span><span class="s4">.</span><span class="s2">routesMeta</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">meta</span><span class="s4">) =&gt; </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">childrenIndex</span><span class="s4">)</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">paramRe </span><span class="s4">= </span><span class="s8">/^:[\w-]+$/</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">dynamicSegmentValue </span><span class="s4">= </span><span class="s7">3</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">indexRouteValue </span><span class="s4">= </span><span class="s7">2</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">emptySegmentValue </span><span class="s4">= </span><span class="s7">1</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">staticSegmentValue </span><span class="s4">= </span><span class="s7">10</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">splatPenalty </span><span class="s4">= -</span><span class="s7">2</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">isSplat </span><span class="s4">= (</span><span class="s2">s</span><span class="s4">) =&gt; </span><span class="s2">s </span><span class="s4">=== </span><span class="s5">&quot;*&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">computeScore</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">initialScore </span><span class="s4">= </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">length</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">segments</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span><span class="s2">isSplat</span><span class="s4">)) {</span>
    <span class="s2">initialScore </span><span class="s4">+= </span><span class="s2">splatPenalty</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">index</span><span class="s4">) {</span>
    <span class="s2">initialScore </span><span class="s4">+= </span><span class="s2">indexRouteValue</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">s</span><span class="s4">) =&gt; !</span><span class="s2">isSplat</span><span class="s4">(</span><span class="s2">s</span><span class="s4">)).</span><span class="s2">reduce</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">score</span><span class="s4">, </span><span class="s2">segment</span><span class="s4">) =&gt; </span><span class="s2">score </span><span class="s4">+ (</span><span class="s2">paramRe</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">segment</span><span class="s4">) ? </span><span class="s2">dynamicSegmentValue </span><span class="s4">: </span><span class="s2">segment </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">? </span><span class="s2">emptySegmentValue </span><span class="s4">: </span><span class="s2">staticSegmentValue</span><span class="s4">),</span>
    <span class="s2">initialScore</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">compareIndexes</span><span class="s4">(</span><span class="s2">a</span><span class="s4">, </span><span class="s2">b</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">siblings </span><span class="s4">= </span><span class="s2">a</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s2">b</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&amp;&amp; </span><span class="s2">a</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, -</span><span class="s7">1</span><span class="s4">).</span><span class="s2">every</span><span class="s4">((</span><span class="s2">n</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; </span><span class="s2">n </span><span class="s4">=== </span><span class="s2">b</span><span class="s4">[</span><span class="s2">i</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s2">siblings </span><span class="s4">? (</span>
    <span class="s6">// If two routes are siblings, we should try to match the earlier sibling</span>
    <span class="s6">// first. This allows people to have fine-grained control over the matching</span>
    <span class="s6">// behavior by simply putting routes with identical paths in the order they</span>
    <span class="s6">// want them tried.</span>
    <span class="s2">a</span><span class="s4">[</span><span class="s2">a</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">] - </span><span class="s2">b</span><span class="s4">[</span><span class="s2">b</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">]</span>
  <span class="s4">) : (</span>
    <span class="s6">// Otherwise, it doesn't really make sense to rank non-siblings by index,</span>
    <span class="s6">// so they sort equally.</span>
    <span class="s7">0</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">matchRouteBranch</span><span class="s4">(</span><span class="s2">branch</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">allowPartial </span><span class="s4">= </span><span class="s3">false</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">routesMeta </span><span class="s4">} = </span><span class="s2">branch</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">matchedParams </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">matchedPathname </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= [];</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">routesMeta</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; ++</span><span class="s2">i</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">meta </span><span class="s4">= </span><span class="s2">routesMeta</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">end </span><span class="s4">= </span><span class="s2">i </span><span class="s4">=== </span><span class="s2">routesMeta</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">remainingPathname </span><span class="s4">= </span><span class="s2">matchedPathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">pathname </span><span class="s4">: </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">matchedPathname</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) || </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">match </span><span class="s4">= </span><span class="s2">matchPath</span><span class="s4">(</span>
      <span class="s4">{ </span><span class="s2">path</span><span class="s4">: </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">, </span><span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">, </span><span class="s2">end </span><span class="s4">},</span>
      <span class="s2">remainingPathname</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">route</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">match </span><span class="s4">&amp;&amp; </span><span class="s2">end </span><span class="s4">&amp;&amp; </span><span class="s2">allowPartial </span><span class="s4">&amp;&amp; !</span><span class="s2">routesMeta</span><span class="s4">[</span><span class="s2">routesMeta</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">) {</span>
      <span class="s2">match </span><span class="s4">= </span><span class="s2">matchPath</span><span class="s4">(</span>
        <span class="s4">{</span>
          <span class="s2">path</span><span class="s4">: </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">relativePath</span><span class="s4">,</span>
          <span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">,</span>
          <span class="s2">end</span><span class="s4">: </span><span class="s3">false</span>
        <span class="s4">},</span>
        <span class="s2">remainingPathname</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) {</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">matchedParams</span><span class="s4">, </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">);</span>
    <span class="s2">matches</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
      <span class="s6">// TODO: Can this as be avoided?</span>
      <span class="s2">params</span><span class="s4">: </span><span class="s2">matchedParams</span><span class="s4">,</span>
      <span class="s2">pathname</span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">matchedPathname</span><span class="s4">, </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">]),</span>
      <span class="s2">pathnameBase</span><span class="s4">: </span><span class="s2">normalizePathname</span><span class="s4">(</span>
        <span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">matchedPathname</span><span class="s4">, </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase</span><span class="s4">])</span>
      <span class="s4">),</span>
      <span class="s2">route</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
      <span class="s2">matchedPathname </span><span class="s4">= </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">matchedPathname</span><span class="s4">, </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase</span><span class="s4">]);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">generatePath</span><span class="s4">(</span><span class="s2">originalPath</span><span class="s4">, </span><span class="s2">params </span><span class="s4">= {}) {</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">originalPath</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">path </span><span class="s4">!== </span><span class="s5">&quot;*&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">path</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/*&quot;</span><span class="s4">)) {</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s5">`Route path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">}</span><span class="s5">&quot; will be treated as if it were &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\*$/</span><span class="s4">, </span><span class="s5">&quot;/*&quot;</span><span class="s4">)}</span><span class="s5">&quot; because the </span><span class="s3">\`</span><span class="s5">*</span><span class="s3">\` </span><span class="s5">character must always follow a </span><span class="s3">\`</span><span class="s5">/</span><span class="s3">\` </span><span class="s5">in the pattern. To get rid of this warning, please change the route path to &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\*$/</span><span class="s4">, </span><span class="s5">&quot;/*&quot;</span><span class="s4">)}</span><span class="s5">&quot;.`</span>
    <span class="s4">);</span>
    <span class="s2">path </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\*$/</span><span class="s4">, </span><span class="s5">&quot;/*&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">const </span><span class="s2">prefix </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) ? </span><span class="s5">&quot;/&quot; </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">stringify2 </span><span class="s4">= (</span><span class="s2">p</span><span class="s4">) =&gt; </span><span class="s2">p </span><span class="s4">== </span><span class="s3">null </span><span class="s4">? </span><span class="s5">&quot;&quot; </span><span class="s4">: </span><span class="s3">typeof </span><span class="s2">p </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">p </span><span class="s4">: </span><span class="s2">String</span><span class="s4">(</span><span class="s2">p</span><span class="s4">);</span>
  <span class="s3">const </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s8">/\/+/</span><span class="s4">).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">segment</span><span class="s4">, </span><span class="s2">index</span><span class="s4">, </span><span class="s2">array</span><span class="s4">) =&gt; {</span>
    <span class="s3">const </span><span class="s2">isLastSegment </span><span class="s4">= </span><span class="s2">index </span><span class="s4">=== </span><span class="s2">array</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isLastSegment </span><span class="s4">&amp;&amp; </span><span class="s2">segment </span><span class="s4">=== </span><span class="s5">&quot;*&quot;</span><span class="s4">) {</span>
      <span class="s3">const </span><span class="s2">star </span><span class="s4">= </span><span class="s5">&quot;*&quot;</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">stringify2</span><span class="s4">(</span><span class="s2">params</span><span class="s4">[</span><span class="s2">star</span><span class="s4">]);</span>
    <span class="s4">}</span>
    <span class="s3">const </span><span class="s2">keyMatch </span><span class="s4">= </span><span class="s2">segment</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s8">/^:([\w-]+)(\??)$/</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">keyMatch</span><span class="s4">) {</span>
      <span class="s3">const </span><span class="s4">[, </span><span class="s2">key</span><span class="s4">, </span><span class="s2">optional</span><span class="s4">] = </span><span class="s2">keyMatch</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">param </span><span class="s4">= </span><span class="s2">params</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
      <span class="s2">invariant</span><span class="s4">(</span><span class="s2">optional </span><span class="s4">=== </span><span class="s5">&quot;?&quot; </span><span class="s4">|| </span><span class="s2">param </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">, </span><span class="s5">`Missing &quot;:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s5">&quot; param`</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">stringify2</span><span class="s4">(</span><span class="s2">param</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">segment</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\?$/g</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
  <span class="s4">}).</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">segment</span><span class="s4">) =&gt; !!</span><span class="s2">segment</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">prefix </span><span class="s4">+ </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">matchPath</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">pattern </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
    <span class="s2">pattern </span><span class="s4">= { </span><span class="s2">path</span><span class="s4">: </span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">caseSensitive</span><span class="s4">: </span><span class="s3">false</span><span class="s4">, </span><span class="s2">end</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">matcher</span><span class="s4">, </span><span class="s2">compiledParams</span><span class="s4">] = </span><span class="s2">compilePath</span><span class="s4">(</span>
    <span class="s2">pattern</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
    <span class="s2">pattern</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">,</span>
    <span class="s2">pattern</span><span class="s4">.</span><span class="s2">end</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">match </span><span class="s4">= </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">matcher</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">matchedPathname </span><span class="s4">= </span><span class="s2">match</span><span class="s4">[</span><span class="s7">0</span><span class="s4">];</span>
  <span class="s3">let </span><span class="s2">pathnameBase </span><span class="s4">= </span><span class="s2">matchedPathname</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/(.)\/+$/</span><span class="s4">, </span><span class="s5">&quot;$1&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">captureGroups </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">params </span><span class="s4">= </span><span class="s2">compiledParams</span><span class="s4">.</span><span class="s2">reduce</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">memo2</span><span class="s4">, { </span><span class="s2">paramName</span><span class="s4">, </span><span class="s2">isOptional </span><span class="s4">}, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">paramName </span><span class="s4">=== </span><span class="s5">&quot;*&quot;</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">splatValue </span><span class="s4">= </span><span class="s2">captureGroups</span><span class="s4">[</span><span class="s2">index</span><span class="s4">] || </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
        <span class="s2">pathnameBase </span><span class="s4">= </span><span class="s2">matchedPathname</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">matchedPathname</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s2">splatValue</span><span class="s4">.</span><span class="s2">length</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/(.)\/+$/</span><span class="s4">, </span><span class="s5">&quot;$1&quot;</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">captureGroups</span><span class="s4">[</span><span class="s2">index</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isOptional </span><span class="s4">&amp;&amp; !</span><span class="s2">value</span><span class="s4">) {</span>
        <span class="s2">memo2</span><span class="s4">[</span><span class="s2">paramName</span><span class="s4">] = </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">memo2</span><span class="s4">[</span><span class="s2">paramName</span><span class="s4">] = (</span><span class="s2">value </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/%2F/g</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">memo2</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s4">{}</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">params</span><span class="s4">,</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s2">matchedPathname</span><span class="s4">,</span>
    <span class="s2">pathnameBase</span><span class="s4">,</span>
    <span class="s2">pattern</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">compilePath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">caseSensitive </span><span class="s4">= </span><span class="s3">false</span><span class="s4">, </span><span class="s2">end </span><span class="s4">= </span><span class="s3">true</span><span class="s4">) {</span>
  <span class="s2">warning</span><span class="s4">(</span>
    <span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;*&quot; </span><span class="s4">|| !</span><span class="s2">path</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">) || </span><span class="s2">path</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/*&quot;</span><span class="s4">),</span>
    <span class="s5">`Route path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">}</span><span class="s5">&quot; will be treated as if it were &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\*$/</span><span class="s4">, </span><span class="s5">&quot;/*&quot;</span><span class="s4">)}</span><span class="s5">&quot; because the </span><span class="s3">\`</span><span class="s5">*</span><span class="s3">\` </span><span class="s5">character must always follow a </span><span class="s3">\`</span><span class="s5">/</span><span class="s3">\` </span><span class="s5">in the pattern. To get rid of this warning, please change the route path to &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\*$/</span><span class="s4">, </span><span class="s5">&quot;/*&quot;</span><span class="s4">)}</span><span class="s5">&quot;.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">params </span><span class="s4">= [];</span>
  <span class="s3">let </span><span class="s2">regexpSource </span><span class="s4">= </span><span class="s5">&quot;^&quot; </span><span class="s4">+ </span><span class="s2">path</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/*\*?$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\/*/</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/[\\.*+^${}|()[\]]/g</span><span class="s4">, </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">$&amp;&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span>
    <span class="s8">/\/:([\w-]+)(\?)?/g</span><span class="s4">,</span>
    <span class="s4">(</span><span class="s2">_</span><span class="s4">, </span><span class="s2">paramName</span><span class="s4">, </span><span class="s2">isOptional</span><span class="s4">) =&gt; {</span>
      <span class="s2">params</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">paramName</span><span class="s4">, </span><span class="s2">isOptional</span><span class="s4">: </span><span class="s2">isOptional </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">});</span>
      <span class="s3">return </span><span class="s2">isOptional </span><span class="s4">? </span><span class="s5">&quot;/?([^</span><span class="s3">\\</span><span class="s5">/]+)?&quot; </span><span class="s4">: </span><span class="s5">&quot;/([^</span><span class="s3">\\</span><span class="s5">/]+)&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">)) {</span>
    <span class="s2">params</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">paramName</span><span class="s4">: </span><span class="s5">&quot;*&quot; </span><span class="s4">});</span>
    <span class="s2">regexpSource </span><span class="s4">+= </span><span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;*&quot; </span><span class="s4">|| </span><span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;/*&quot; </span><span class="s4">? </span><span class="s5">&quot;(.*)$&quot; </span><span class="s4">: </span><span class="s5">&quot;(?:</span><span class="s3">\\</span><span class="s5">/(.+)|</span><span class="s3">\\</span><span class="s5">/*)$&quot;</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">end</span><span class="s4">) {</span>
    <span class="s2">regexpSource </span><span class="s4">+= </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">/*$&quot;</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">path </span><span class="s4">!== </span><span class="s5">&quot;&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">path </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">regexpSource </span><span class="s4">+= </span><span class="s5">&quot;(?:(?=</span><span class="s3">\\</span><span class="s5">/|$))&quot;</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">matcher </span><span class="s4">= </span><span class="s3">new </span><span class="s2">RegExp</span><span class="s4">(</span><span class="s2">regexpSource</span><span class="s4">, </span><span class="s2">caseSensitive </span><span class="s4">? </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">: </span><span class="s5">&quot;i&quot;</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">[</span><span class="s2">matcher</span><span class="s4">, </span><span class="s2">params</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">decodePath</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">return </span><span class="s2">value</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">decodeURIComponent</span><span class="s4">(</span><span class="s2">v</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\//g</span><span class="s4">, </span><span class="s5">&quot;%2F&quot;</span><span class="s4">)).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s5">`The URL path &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">value</span><span class="s4">}</span><span class="s5">&quot; could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">}</span><span class="s5">).`</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">value</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">=== </span><span class="s5">&quot;/&quot;</span><span class="s4">) </span><span class="s3">return </span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">().</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s2">basename</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">())) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">startIndex </span><span class="s4">= </span><span class="s2">basename</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) ? </span><span class="s2">basename</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1 </span><span class="s4">: </span><span class="s2">basename</span><span class="s4">.</span><span class="s2">length</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">nextChar </span><span class="s4">= </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">startIndex</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">nextChar </span><span class="s4">&amp;&amp; </span><span class="s2">nextChar </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">startIndex</span><span class="s4">) || </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">resolvePath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">fromPathname </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s2">toPathname</span><span class="s4">,</span>
    <span class="s2">search </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">hash </span><span class="s4">= </span><span class="s5">&quot;&quot;</span>
  <span class="s4">} = </span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) : </span><span class="s2">to</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">toPathname </span><span class="s4">? </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) ? </span><span class="s2">toPathname </span><span class="s4">: </span><span class="s2">resolvePathname</span><span class="s4">(</span><span class="s2">toPathname</span><span class="s4">, </span><span class="s2">fromPathname</span><span class="s4">) : </span><span class="s2">fromPathname</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">search</span><span class="s4">: </span><span class="s2">normalizeSearch</span><span class="s4">(</span><span class="s2">search</span><span class="s4">),</span>
    <span class="s2">hash</span><span class="s4">: </span><span class="s2">normalizeHash</span><span class="s4">(</span><span class="s2">hash</span><span class="s4">)</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">resolvePathname</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">, </span><span class="s2">fromPathname</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">fromPathname</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/+$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">relativeSegments </span><span class="s4">= </span><span class="s2">relativePath</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s2">relativeSegments</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">segment</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">segment </span><span class="s4">=== </span><span class="s5">&quot;..&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">segments</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">1</span><span class="s4">) </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">();</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">segment </span><span class="s4">!== </span><span class="s5">&quot;.&quot;</span><span class="s4">) {</span>
      <span class="s2">segments</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">segment</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">1 </span><span class="s4">? </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) : </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getInvalidPathError</span><span class="s4">(</span><span class="s2">char</span><span class="s4">, </span><span class="s2">field</span><span class="s4">, </span><span class="s2">dest</span><span class="s4">, </span><span class="s2">path</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s5">`Cannot include a '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">char</span><span class="s4">}</span><span class="s5">' character in a manually specified </span><span class="s3">\`</span><span class="s5">to.</span><span class="s2">$</span><span class="s4">{</span><span class="s2">field</span><span class="s4">}</span><span class="s3">\` </span><span class="s5">field [</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
    <span class="s2">path</span>
  <span class="s4">)}</span><span class="s5">].  Please separate it out to the </span><span class="s3">\`</span><span class="s5">to.</span><span class="s2">$</span><span class="s4">{</span><span class="s2">dest</span><span class="s4">}</span><span class="s3">\` </span><span class="s5">field. Alternatively you may provide the full path as a string in &lt;Link to=&quot;...&quot;&gt; and the router will parse it for you.`</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getPathContributingMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; </span><span class="s2">index </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path </span><span class="s4">&amp;&amp; </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getResolveToMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">pathMatches </span><span class="s4">= </span><span class="s2">getPathContributingMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">pathMatches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">idx</span><span class="s4">) =&gt; </span><span class="s2">idx </span><span class="s4">=== </span><span class="s2">pathMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1 </span><span class="s4">? </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">resolveTo</span><span class="s4">(</span><span class="s2">toArg</span><span class="s4">, </span><span class="s2">routePathnames</span><span class="s4">, </span><span class="s2">locationPathname</span><span class="s4">, </span><span class="s2">isPathRelative </span><span class="s4">= </span><span class="s3">false</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">to</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">toArg </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
    <span class="s2">to </span><span class="s4">= </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">toArg</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">to </span><span class="s4">= { </span><span class="s2">...toArg </span><span class="s4">};</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| !</span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">),</span>
      <span class="s2">getInvalidPathError</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">, </span><span class="s5">&quot;pathname&quot;</span><span class="s4">, </span><span class="s5">&quot;search&quot;</span><span class="s4">, </span><span class="s2">to</span><span class="s4">)</span>
    <span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| !</span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">),</span>
      <span class="s2">getInvalidPathError</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">, </span><span class="s5">&quot;pathname&quot;</span><span class="s4">, </span><span class="s5">&quot;hash&quot;</span><span class="s4">, </span><span class="s2">to</span><span class="s4">)</span>
    <span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">to</span><span class="s4">.</span><span class="s2">search </span><span class="s4">|| !</span><span class="s2">to</span><span class="s4">.</span><span class="s2">search</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">),</span>
      <span class="s2">getInvalidPathError</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">, </span><span class="s5">&quot;search&quot;</span><span class="s4">, </span><span class="s5">&quot;hash&quot;</span><span class="s4">, </span><span class="s2">to</span><span class="s4">)</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">isEmptyPath </span><span class="s4">= </span><span class="s2">toArg </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">|| </span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">toPathname </span><span class="s4">= </span><span class="s2">isEmptyPath </span><span class="s4">? </span><span class="s5">&quot;/&quot; </span><span class="s4">: </span><span class="s2">to</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">from</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">toPathname </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">from </span><span class="s4">= </span><span class="s2">locationPathname</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">routePathnameIndex </span><span class="s4">= </span><span class="s2">routePathnames</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isPathRelative </span><span class="s4">&amp;&amp; </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;..&quot;</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">toSegments </span><span class="s4">= </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
      <span class="s3">while </span><span class="s4">(</span><span class="s2">toSegments</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] === </span><span class="s5">&quot;..&quot;</span><span class="s4">) {</span>
        <span class="s2">toSegments</span><span class="s4">.</span><span class="s2">shift</span><span class="s4">();</span>
        <span class="s2">routePathnameIndex </span><span class="s4">-= </span><span class="s7">1</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">to</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">toSegments</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">from </span><span class="s4">= </span><span class="s2">routePathnameIndex </span><span class="s4">&gt;= </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">routePathnames</span><span class="s4">[</span><span class="s2">routePathnameIndex</span><span class="s4">] : </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">resolvePath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">from</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">hasExplicitTrailingSlash </span><span class="s4">= </span><span class="s2">toPathname </span><span class="s4">&amp;&amp; </span><span class="s2">toPathname </span><span class="s4">!== </span><span class="s5">&quot;/&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">hasCurrentTrailingSlash </span><span class="s4">= (</span><span class="s2">isEmptyPath </span><span class="s4">|| </span><span class="s2">toPathname </span><span class="s4">=== </span><span class="s5">&quot;.&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">locationPathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) &amp;&amp; (</span><span class="s2">hasExplicitTrailingSlash </span><span class="s4">|| </span><span class="s2">hasCurrentTrailingSlash</span><span class="s4">)) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+= </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">path</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">joinPaths </span><span class="s4">= (</span><span class="s2">paths</span><span class="s4">) =&gt; </span><span class="s2">paths</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/\/+/g</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">normalizePathname </span><span class="s4">= (</span><span class="s2">pathname</span><span class="s4">) =&gt; </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/+$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\/*/</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">normalizeSearch </span><span class="s4">= (</span><span class="s2">search</span><span class="s4">) =&gt; !</span><span class="s2">search </span><span class="s4">|| </span><span class="s2">search </span><span class="s4">=== </span><span class="s5">&quot;?&quot; </span><span class="s4">? </span><span class="s5">&quot;&quot; </span><span class="s4">: </span><span class="s2">search</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;?&quot;</span><span class="s4">) ? </span><span class="s2">search </span><span class="s4">: </span><span class="s5">&quot;?&quot; </span><span class="s4">+ </span><span class="s2">search</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">normalizeHash </span><span class="s4">= (</span><span class="s2">hash</span><span class="s4">) =&gt; !</span><span class="s2">hash </span><span class="s4">|| </span><span class="s2">hash </span><span class="s4">=== </span><span class="s5">&quot;#&quot; </span><span class="s4">? </span><span class="s5">&quot;&quot; </span><span class="s4">: </span><span class="s2">hash</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;#&quot;</span><span class="s4">) ? </span><span class="s2">hash </span><span class="s4">: </span><span class="s5">&quot;#&quot; </span><span class="s4">+ </span><span class="s2">hash</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">DataWithResponseInit </span><span class="s4">= </span><span class="s3">class </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">init</span><span class="s4">) {</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">type </span><span class="s4">= </span><span class="s5">&quot;DataWithResponseInit&quot;</span><span class="s4">;</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">data </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">;</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">init </span><span class="s4">= </span><span class="s2">init </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">data</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">init</span><span class="s4">) {</span>
  <span class="s3">return new </span><span class="s2">DataWithResponseInit</span><span class="s4">(</span>
    <span class="s2">data2</span><span class="s4">,</span>
    <span class="s3">typeof </span><span class="s2">init </span><span class="s4">=== </span><span class="s5">&quot;number&quot; </span><span class="s4">? { </span><span class="s2">status</span><span class="s4">: </span><span class="s2">init </span><span class="s4">} : </span><span class="s2">init</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">redirect </span><span class="s4">= (</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init </span><span class="s4">= </span><span class="s7">302</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">responseInit </span><span class="s4">= </span><span class="s2">init</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">responseInit </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
    <span class="s2">responseInit </span><span class="s4">= { </span><span class="s2">status</span><span class="s4">: </span><span class="s2">responseInit </span><span class="s4">};</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">responseInit</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s2">responseInit</span><span class="s4">.</span><span class="s2">status </span><span class="s4">= </span><span class="s7">302</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">responseInit</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">);</span>
  <span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">, </span><span class="s2">url</span><span class="s4">);</span>
  <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, { </span><span class="s2">...responseInit</span><span class="s4">, </span><span class="s2">headers </span><span class="s4">});</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">redirectDocument </span><span class="s4">= (</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s2">redirect</span><span class="s4">(</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
  <span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">, </span><span class="s5">&quot;true&quot;</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">replace </span><span class="s4">= (</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s2">redirect</span><span class="s4">(</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
  <span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Replace&quot;</span><span class="s4">, </span><span class="s5">&quot;true&quot;</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">ErrorResponseImpl </span><span class="s4">= </span><span class="s3">class </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">status</span><span class="s4">, </span><span class="s2">statusText</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">internal </span><span class="s4">= </span><span class="s3">false</span><span class="s4">) {</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">= </span><span class="s2">status</span><span class="s4">;</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">statusText </span><span class="s4">= </span><span class="s2">statusText </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">internal </span><span class="s4">= </span><span class="s2">internal</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">data2 </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">data </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">();</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">error </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">data </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">error </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s5">&quot;number&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">error</span><span class="s4">.</span><span class="s2">statusText </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">error</span><span class="s4">.</span><span class="s2">internal </span><span class="s4">=== </span><span class="s5">&quot;boolean&quot; </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;data&quot; </span><span class="s3">in </span><span class="s2">error</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/router/router.ts</span>
<span class="s3">var </span><span class="s2">validMutationMethodsArr </span><span class="s4">= [</span>
  <span class="s5">&quot;POST&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;PUT&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;PATCH&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;DELETE&quot;</span>
<span class="s4">];</span>
<span class="s3">var </span><span class="s2">validMutationMethods </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span>
  <span class="s2">validMutationMethodsArr</span>
<span class="s4">);</span>
<span class="s3">var </span><span class="s2">validRequestMethodsArr </span><span class="s4">= [</span>
  <span class="s5">&quot;GET&quot;</span><span class="s4">,</span>
  <span class="s2">...validMutationMethodsArr</span>
<span class="s4">];</span>
<span class="s3">var </span><span class="s2">validRequestMethods </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">validRequestMethodsArr</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">redirectStatusCodes </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s7">301</span><span class="s4">, </span><span class="s7">302</span><span class="s4">, </span><span class="s7">303</span><span class="s4">, </span><span class="s7">307</span><span class="s4">, </span><span class="s7">308</span><span class="s4">]);</span>
<span class="s3">var </span><span class="s2">redirectPreserveMethodStatusCodes </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s7">307</span><span class="s4">, </span><span class="s7">308</span><span class="s4">]);</span>
<span class="s3">var </span><span class="s2">IDLE_NAVIGATION </span><span class="s4">= {</span>
  <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
  <span class="s2">location</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formMethod</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formAction</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formEncType</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">IDLE_FETCHER </span><span class="s4">= {</span>
  <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
  <span class="s2">data</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formMethod</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formAction</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formEncType</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">IDLE_BLOCKER </span><span class="s4">= {</span>
  <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;unblocked&quot;</span><span class="s4">,</span>
  <span class="s2">proceed</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">reset</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
  <span class="s2">location</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">ABSOLUTE_URL_REGEX </span><span class="s4">= </span><span class="s8">/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">defaultMapRouteProperties </span><span class="s4">= (</span><span class="s2">route</span><span class="s4">) =&gt; ({</span>
  <span class="s2">hasErrorBoundary</span><span class="s4">: </span><span class="s2">Boolean</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasErrorBoundary</span><span class="s4">)</span>
<span class="s4">});</span>
<span class="s3">var </span><span class="s2">TRANSITIONS_STORAGE_KEY </span><span class="s4">= </span><span class="s5">&quot;remix-router-transitions&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">ResetLoaderDataSymbol </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">(</span><span class="s5">&quot;ResetLoaderData&quot;</span><span class="s4">);</span>
<span class="s3">function </span><span class="s2">createRouter</span><span class="s4">(</span><span class="s2">init</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s2">routerWindow </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">window </span><span class="s4">? </span><span class="s2">init</span><span class="s4">.</span><span class="s2">window </span><span class="s4">: </span><span class="s3">typeof </span><span class="s2">window </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">? </span><span class="s2">window </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">isBrowser2 </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">routerWindow </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">document </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">createElement </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">;</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s5">&quot;You must provide a non-empty routes array to createRouter&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">hydrationRouteProperties2 </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationRouteProperties </span><span class="s4">|| [];</span>
  <span class="s3">let </span><span class="s2">mapRouteProperties2 </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">mapRouteProperties </span><span class="s4">|| </span><span class="s2">defaultMapRouteProperties</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">manifest </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">dataRoutes </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
    <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">manifest</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">inFlightDataRoutes</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">basename </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">basename </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">dataStrategyImpl </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s2">defaultDataStrategyWithMiddleware</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">future </span><span class="s4">= {</span>
    <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">...init</span><span class="s4">.</span><span class="s2">future</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">unlistenHistory </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">subscribers </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">savedScrollPositions2 </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">getScrollRestorationKey2 </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">getScrollPosition </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">initialScrollRestored </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">initialMatches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">, </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">initialMatchesIsFOW </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">initialErrors </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">initialized</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">initialMatches </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; !</span><span class="s2">init</span><span class="s4">.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, {</span>
      <span class="s2">pathname</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
    <span class="s4">});</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">getShortCircuitMatches</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">);</span>
    <span class="s2">initialized </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">initialMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s2">initialErrors </span><span class="s4">= { [</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error </span><span class="s4">};</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">initialMatches </span><span class="s4">&amp;&amp; !</span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">fogOfWar </span><span class="s4">= </span><span class="s2">checkFogOfWar</span><span class="s4">(</span>
        <span class="s2">initialMatches</span><span class="s4">,</span>
        <span class="s2">dataRoutes</span><span class="s4">,</span>
        <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active</span><span class="s4">) {</span>
        <span class="s2">initialMatches </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">initialMatches</span><span class="s4">) {</span>
      <span class="s2">initialized </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s2">initialMatches </span><span class="s4">= [];</span>
      <span class="s3">let </span><span class="s2">fogOfWar </span><span class="s4">= </span><span class="s2">checkFogOfWar</span><span class="s4">(</span>
        <span class="s3">null</span><span class="s4">,</span>
        <span class="s2">dataRoutes</span><span class="s4">,</span>
        <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active </span><span class="s4">&amp;&amp; </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s2">initialMatchesIsFOW </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
        <span class="s2">initialMatches </span><span class="s4">= </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">initialMatches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">)) {</span>
      <span class="s2">initialized </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">initialMatches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">)) {</span>
      <span class="s2">initialized </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">loaderData </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">? </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">: </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">errors </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">? </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">: </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">idx </span><span class="s4">= </span><span class="s2">initialMatches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">(</span>
          <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] !== </span><span class="s3">void </span><span class="s7">0</span>
        <span class="s4">);</span>
        <span class="s2">initialized </span><span class="s4">= </span><span class="s2">initialMatches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">idx </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">).</span><span class="s2">every</span><span class="s4">(</span>
          <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; !</span><span class="s2">shouldLoadRouteOnHydration</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">)</span>
        <span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">initialized </span><span class="s4">= </span><span class="s2">initialMatches</span><span class="s4">.</span><span class="s2">every</span><span class="s4">(</span>
          <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; !</span><span class="s2">shouldLoadRouteOnHydration</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">)</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">router</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= {</span>
    <span class="s2">historyAction</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
    <span class="s2">matches</span><span class="s4">: </span><span class="s2">initialMatches</span><span class="s4">,</span>
    <span class="s2">initialized</span><span class="s4">,</span>
    <span class="s2">navigation</span><span class="s4">: </span><span class="s2">IDLE_NAVIGATION</span><span class="s4">,</span>
    <span class="s6">// Don't restore on initial updateState() if we were SSR'd</span>
    <span class="s2">restoreScrollPosition</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s3">false </span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">revalidation</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
    <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">&amp;&amp; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">|| {},</span>
    <span class="s2">actionData</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">&amp;&amp; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s2">errors</span><span class="s4">: </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData </span><span class="s4">&amp;&amp; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">|| </span><span class="s2">initialErrors</span><span class="s4">,</span>
    <span class="s2">fetchers</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(),</span>
    <span class="s2">blockers</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">()</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">pendingAction </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pendingPreventScrollReset </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pendingNavigationController</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pendingViewTransitionEnabled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">appliedViewTransitions </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">removePageHideEventListener </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">isUninterruptedRevalidation </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">isRevalidationRequired </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">cancelledFetcherLoads </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">fetchControllers </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">incrementingLoadId </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pendingNavigationLoadId </span><span class="s4">= -</span><span class="s7">1</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">fetchReloadIds </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">fetchRedirectIds </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">fetchLoadMatches </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">activeFetchers </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">fetchersQueuedForDeletion </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">blockerFunctions </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">unblockBlockerHistoryUpdate </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">pendingRevalidationDfd </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">function </span><span class="s2">initialize</span><span class="s4">() {</span>
    <span class="s2">unlistenHistory </span><span class="s4">= </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">listen</span><span class="s4">(</span>
      <span class="s4">({ </span><span class="s2">action</span><span class="s4">: </span><span class="s2">historyAction</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">delta </span><span class="s4">}) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">unblockBlockerHistoryUpdate</span><span class="s4">) {</span>
          <span class="s2">unblockBlockerHistoryUpdate</span><span class="s4">();</span>
          <span class="s2">unblockBlockerHistoryUpdate </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s2">warning</span><span class="s4">(</span>
          <span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">size </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">|| </span><span class="s2">delta </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
          <span class="s5">&quot;You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.&quot;</span>
        <span class="s4">);</span>
        <span class="s3">let </span><span class="s2">blockerKey </span><span class="s4">= </span><span class="s2">shouldBlockNavigation</span><span class="s4">({</span>
          <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
          <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">location</span><span class="s4">,</span>
          <span class="s2">historyAction</span>
        <span class="s4">});</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerKey </span><span class="s4">&amp;&amp; </span><span class="s2">delta </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">nextHistoryUpdatePromise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">) =&gt; {</span>
            <span class="s2">unblockBlockerHistoryUpdate </span><span class="s4">= </span><span class="s2">resolve</span><span class="s4">;</span>
          <span class="s4">});</span>
          <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">go</span><span class="s4">(</span><span class="s2">delta </span><span class="s4">* -</span><span class="s7">1</span><span class="s4">);</span>
          <span class="s2">updateBlocker</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, {</span>
            <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;blocked&quot;</span><span class="s4">,</span>
            <span class="s2">location</span><span class="s4">,</span>
            <span class="s2">proceed</span><span class="s4">() {</span>
              <span class="s2">updateBlocker</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, {</span>
                <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;proceeding&quot;</span><span class="s4">,</span>
                <span class="s2">proceed</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
                <span class="s2">reset</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
                <span class="s2">location</span>
              <span class="s4">});</span>
              <span class="s2">nextHistoryUpdatePromise</span><span class="s4">.</span><span class="s2">then</span><span class="s4">(() =&gt; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">go</span><span class="s4">(</span><span class="s2">delta</span><span class="s4">));</span>
            <span class="s4">},</span>
            <span class="s2">reset</span><span class="s4">() {</span>
              <span class="s3">let </span><span class="s2">blockers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">);</span>
              <span class="s2">blockers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">IDLE_BLOCKER</span><span class="s4">);</span>
              <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">blockers </span><span class="s4">});</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">return </span><span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">historyAction</span><span class="s4">, </span><span class="s2">location</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isBrowser2</span><span class="s4">) {</span>
      <span class="s2">restoreAppliedTransitions</span><span class="s4">(</span><span class="s2">routerWindow</span><span class="s4">, </span><span class="s2">appliedViewTransitions</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">_saveAppliedTransitions </span><span class="s4">= () =&gt; </span><span class="s2">persistAppliedTransitions</span><span class="s4">(</span><span class="s2">routerWindow</span><span class="s4">, </span><span class="s2">appliedViewTransitions</span><span class="s4">);</span>
      <span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;pagehide&quot;</span><span class="s4">, </span><span class="s2">_saveAppliedTransitions</span><span class="s4">);</span>
      <span class="s2">removePageHideEventListener </span><span class="s4">= () =&gt; </span><span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span><span class="s5">&quot;pagehide&quot;</span><span class="s4">, </span><span class="s2">_saveAppliedTransitions</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">state</span><span class="s4">.</span><span class="s2">initialized</span><span class="s4">) {</span>
      <span class="s2">startNavigation</span><span class="s4">(</span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, {</span>
        <span class="s2">initialHydration</span><span class="s4">: </span><span class="s3">true</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">router</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">dispose</span><span class="s4">() {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">unlistenHistory</span><span class="s4">) {</span>
      <span class="s2">unlistenHistory</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">removePageHideEventListener</span><span class="s4">) {</span>
      <span class="s2">removePageHideEventListener</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s2">subscribers</span><span class="s4">.</span><span class="s2">clear</span><span class="s4">();</span>
    <span class="s2">pendingNavigationController </span><span class="s4">&amp;&amp; </span><span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">abort</span><span class="s4">();</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; </span><span class="s2">deleteFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; </span><span class="s2">deleteBlocker</span><span class="s4">(</span><span class="s2">key</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">subscribe</span><span class="s4">(</span><span class="s2">fn</span><span class="s4">) {</span>
    <span class="s2">subscribers</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">fn</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; </span><span class="s2">subscribers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">fn</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">updateState</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
    <span class="s2">state </span><span class="s4">= {</span>
      <span class="s2">...state</span><span class="s4">,</span>
      <span class="s2">...newState</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">unmountedFetchers </span><span class="s4">= [];</span>
    <span class="s3">let </span><span class="s2">mountedFetchers </span><span class="s4">= [];</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">fetcher</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;idle&quot;</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
          <span class="s2">unmountedFetchers</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">mountedFetchers</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
    <span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">key</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) &amp;&amp; !</span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
        <span class="s2">unmountedFetchers</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
    <span class="s4">[</span><span class="s2">...subscribers</span><span class="s4">].</span><span class="s2">forEach</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">subscriber</span><span class="s4">) =&gt; </span><span class="s2">subscriber</span><span class="s4">(</span><span class="s2">state</span><span class="s4">, {</span>
        <span class="s2">deletedFetchers</span><span class="s4">: </span><span class="s2">unmountedFetchers</span><span class="s4">,</span>
        <span class="s2">viewTransitionOpts</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">viewTransitionOpts</span><span class="s4">,</span>
        <span class="s2">flushSync</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync </span><span class="s4">=== </span><span class="s3">true</span>
      <span class="s4">})</span>
    <span class="s4">);</span>
    <span class="s2">unmountedFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">key</span><span class="s4">) =&gt; </span><span class="s2">deleteFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s2">mountedFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">key</span><span class="s4">) =&gt; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">completeNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">newState</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">} = {}) {</span>
    <span class="s3">let </span><span class="s2">isActionReload </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">formMethod </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">) &amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;loading&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">location</span><span class="s4">.</span><span class="s2">state</span><span class="s4">?.</span><span class="s2">_isRedirect </span><span class="s4">!== </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">actionData</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">newState</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">).</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s2">actionData </span><span class="s4">= </span><span class="s2">newState</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">actionData </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isActionReload</span><span class="s4">) {</span>
      <span class="s2">actionData </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">actionData </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">loaderData </span><span class="s4">= </span><span class="s2">newState</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">? </span><span class="s2">mergeLoaderData</span><span class="s4">(</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">newState</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">newState</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">|| [],</span>
      <span class="s2">newState</span><span class="s4">.</span><span class="s2">errors</span>
    <span class="s4">) : </span><span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">blockers </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">blockers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">blockers</span><span class="s4">);</span>
      <span class="s2">blockers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">k</span><span class="s4">) =&gt; </span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">k</span><span class="s4">, </span><span class="s2">IDLE_BLOCKER</span><span class="s4">));</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">preventScrollReset </span><span class="s4">= </span><span class="s2">pendingPreventScrollReset </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">formMethod </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">) &amp;&amp; </span><span class="s2">location</span><span class="s4">.</span><span class="s2">state</span><span class="s4">?.</span><span class="s2">_isRedirect </span><span class="s4">!== </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">inFlightDataRoutes</span><span class="s4">) {</span>
      <span class="s2">dataRoutes </span><span class="s4">= </span><span class="s2">inFlightDataRoutes</span><span class="s4">;</span>
      <span class="s2">inFlightDataRoutes </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isUninterruptedRevalidation</span><span class="s4">) {</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">pendingAction </span><span class="s4">=== </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">) {</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">pendingAction </span><span class="s4">=== </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">location</span><span class="s4">.</span><span class="s2">state</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">pendingAction </span><span class="s4">=== </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">location</span><span class="s4">.</span><span class="s2">state</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">viewTransitionOpts</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingAction </span><span class="s4">=== </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">priorPaths </span><span class="s4">= </span><span class="s2">appliedViewTransitions</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">priorPaths </span><span class="s4">&amp;&amp; </span><span class="s2">priorPaths</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">)) {</span>
        <span class="s2">viewTransitionOpts </span><span class="s4">= {</span>
          <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
          <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">location</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">appliedViewTransitions</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">)) {</span>
        <span class="s2">viewTransitionOpts </span><span class="s4">= {</span>
          <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">location</span><span class="s4">,</span>
          <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span>
        <span class="s4">};</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">pendingViewTransitionEnabled</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">toPaths </span><span class="s4">= </span><span class="s2">appliedViewTransitions</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">toPaths</span><span class="s4">) {</span>
        <span class="s2">toPaths</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">toPaths </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">]);</span>
        <span class="s2">appliedViewTransitions</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">toPaths</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">viewTransitionOpts </span><span class="s4">= {</span>
        <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
        <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">location</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s2">updateState</span><span class="s4">(</span>
      <span class="s4">{</span>
        <span class="s2">...newState</span><span class="s4">,</span>
        <span class="s6">// matches, errors, fetchers go through as-is</span>
        <span class="s2">actionData</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">,</span>
        <span class="s2">historyAction</span><span class="s4">: </span><span class="s2">pendingAction</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">initialized</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">navigation</span><span class="s4">: </span><span class="s2">IDLE_NAVIGATION</span><span class="s4">,</span>
        <span class="s2">revalidation</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
        <span class="s2">restoreScrollPosition</span><span class="s4">: </span><span class="s2">getSavedScrollPosition</span><span class="s4">(</span>
          <span class="s2">location</span><span class="s4">,</span>
          <span class="s2">newState</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span>
        <span class="s4">),</span>
        <span class="s2">preventScrollReset</span><span class="s4">,</span>
        <span class="s2">blockers</span>
      <span class="s4">},</span>
      <span class="s4">{</span>
        <span class="s2">viewTransitionOpts</span><span class="s4">,</span>
        <span class="s2">flushSync</span><span class="s4">: </span><span class="s2">flushSync </span><span class="s4">=== </span><span class="s3">true</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s2">pendingAction </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
    <span class="s2">pendingPreventScrollReset </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s2">pendingViewTransitionEnabled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s2">isUninterruptedRevalidation </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s2">isRevalidationRequired </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s2">pendingRevalidationDfd</span><span class="s4">?.</span><span class="s2">resolve</span><span class="s4">();</span>
    <span class="s2">pendingRevalidationDfd </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">go</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">normalizeTo</span><span class="s4">(</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">to</span><span class="s4">,</span>
      <span class="s2">opts</span><span class="s4">?.</span><span class="s2">fromRouteId</span><span class="s4">,</span>
      <span class="s2">opts</span><span class="s4">?.</span><span class="s2">relative</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">path</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">, </span><span class="s2">error </span><span class="s4">} = </span><span class="s2">normalizeNavigateOptions</span><span class="s4">(</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s2">normalizedPath</span><span class="s4">,</span>
      <span class="s2">opts</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">currentLocation </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">nextLocation </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">state</span><span class="s4">);</span>
    <span class="s2">nextLocation </span><span class="s4">= {</span>
      <span class="s2">...nextLocation</span><span class="s4">,</span>
      <span class="s2">...init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">nextLocation</span><span class="s4">)</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">userReplace </span><span class="s4">= </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">historyAction </span><span class="s4">= </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">userReplace </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">) {</span>
      <span class="s2">historyAction </span><span class="s4">= </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">userReplace </span><span class="s4">=== </span><span class="s3">false</span><span class="s4">) {</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">submission </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">) &amp;&amp; </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formAction </span><span class="s4">=== </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">) {</span>
      <span class="s2">historyAction </span><span class="s4">= </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">preventScrollReset </span><span class="s4">= </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;preventScrollReset&quot; </span><span class="s3">in </span><span class="s2">opts </span><span class="s4">? </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">preventScrollReset </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">flushSync </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">blockerKey </span><span class="s4">= </span><span class="s2">shouldBlockNavigation</span><span class="s4">({</span>
      <span class="s2">currentLocation</span><span class="s4">,</span>
      <span class="s2">nextLocation</span><span class="s4">,</span>
      <span class="s2">historyAction</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">) {</span>
      <span class="s2">updateBlocker</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, {</span>
        <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;blocked&quot;</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">: </span><span class="s2">nextLocation</span><span class="s4">,</span>
        <span class="s2">proceed</span><span class="s4">() {</span>
          <span class="s2">updateBlocker</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, {</span>
            <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;proceeding&quot;</span><span class="s4">,</span>
            <span class="s2">proceed</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
            <span class="s2">reset</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
            <span class="s2">location</span><span class="s4">: </span><span class="s2">nextLocation</span>
          <span class="s4">});</span>
          <span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
        <span class="s4">},</span>
        <span class="s2">reset</span><span class="s4">() {</span>
          <span class="s3">let </span><span class="s2">blockers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">);</span>
          <span class="s2">blockers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">IDLE_BLOCKER</span><span class="s4">);</span>
          <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">blockers </span><span class="s4">});</span>
        <span class="s4">}</span>
      <span class="s4">});</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">await </span><span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">historyAction</span><span class="s4">, </span><span class="s2">nextLocation</span><span class="s4">, {</span>
      <span class="s2">submission</span><span class="s4">,</span>
      <span class="s6">// Send through the formData serialization error if we have one so we can</span>
      <span class="s6">// render at the right error boundary after we match routes</span>
      <span class="s2">pendingError</span><span class="s4">: </span><span class="s2">error</span><span class="s4">,</span>
      <span class="s2">preventScrollReset</span><span class="s4">,</span>
      <span class="s2">replace</span><span class="s4">: </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">,</span>
      <span class="s2">enableViewTransition</span><span class="s4">: </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">viewTransition</span><span class="s4">,</span>
      <span class="s2">flushSync</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">revalidate</span><span class="s4">() {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">pendingRevalidationDfd</span><span class="s4">) {</span>
      <span class="s2">pendingRevalidationDfd </span><span class="s4">= </span><span class="s2">createDeferred</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s2">interruptActiveLoads</span><span class="s4">();</span>
    <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">revalidation</span><span class="s4">: </span><span class="s5">&quot;loading&quot; </span><span class="s4">});</span>
    <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s2">pendingRevalidationDfd</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;submitting&quot;</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">promise</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;idle&quot;</span><span class="s4">) {</span>
      <span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">historyAction</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, {</span>
        <span class="s2">startUninterruptedRevalidation</span><span class="s4">: </span><span class="s3">true</span>
      <span class="s4">});</span>
      <span class="s3">return </span><span class="s2">promise</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">startNavigation</span><span class="s4">(</span>
      <span class="s2">pendingAction </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">historyAction</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">overrideNavigation</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">,</span>
        <span class="s6">// Proxy through any rending view transition</span>
        <span class="s2">enableViewTransition</span><span class="s4">: </span><span class="s2">pendingViewTransitionEnabled </span><span class="s4">=== </span><span class="s3">true</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">promise</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">historyAction</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
    <span class="s2">pendingNavigationController </span><span class="s4">&amp;&amp; </span><span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">abort</span><span class="s4">();</span>
    <span class="s2">pendingNavigationController </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s2">pendingAction </span><span class="s4">= </span><span class="s2">historyAction</span><span class="s4">;</span>
    <span class="s2">isUninterruptedRevalidation </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">startUninterruptedRevalidation</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">saveScrollPosition</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">);</span>
    <span class="s2">pendingPreventScrollReset </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">preventScrollReset</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">pendingViewTransitionEnabled </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">enableViewTransition</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">loadingNavigation </span><span class="s4">= </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">overrideNavigation</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">initialHydration </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">&amp;&amp; !</span><span class="s2">initialMatchesIsFOW </span><span class="s4">? (</span>
      <span class="s6">// `matchRoutes()` has already been called if we're in here via `router.initialize()`</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span>
    <span class="s4">) : </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">flushSync </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">initialized </span><span class="s4">&amp;&amp; !</span><span class="s2">isRevalidationRequired </span><span class="s4">&amp;&amp; </span><span class="s2">isHashChangeOnly</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">location</span><span class="s4">) &amp;&amp; !(</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">))) {</span>
      <span class="s2">completeNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, { </span><span class="s2">matches </span><span class="s4">}, { </span><span class="s2">flushSync </span><span class="s4">});</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">fogOfWar </span><span class="s4">= </span><span class="s2">checkFogOfWar</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active </span><span class="s4">&amp;&amp; </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s2">matches </span><span class="s4">= </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">error</span><span class="s4">, </span><span class="s2">notFoundMatches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">handleNavigational404</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
      <span class="s4">);</span>
      <span class="s2">completeNavigation</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">notFoundMatches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s2">errors</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error</span>
          <span class="s4">}</span>
        <span class="s4">},</span>
        <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
      <span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">pendingNavigationController </span><span class="s4">= </span><span class="s3">new </span><span class="s2">AbortController</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">request </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
      <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">scopedContext </span><span class="s4">= </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">unstable_getContext </span><span class="s4">? </span><span class="s3">await </span><span class="s2">init</span><span class="s4">.</span><span class="s2">unstable_getContext</span><span class="s4">() : </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">pendingActionResult</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">pendingError</span><span class="s4">) {</span>
      <span class="s2">pendingActionResult </span><span class="s4">= [</span>
        <span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">).</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
        <span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">, </span><span class="s2">error</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">pendingError </span><span class="s4">}</span>
      <span class="s4">];</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">actionResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handleAction</span><span class="s4">(</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">scopedContext</span><span class="s4">,</span>
        <span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active</span><span class="s4">,</span>
        <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">initialHydration </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s4">{ </span><span class="s2">replace</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">, </span><span class="s2">flushSync </span><span class="s4">}</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">shortCircuited</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">result</span><span class="s4">] = </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">pendingActionResult</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) &amp;&amp; </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) &amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">404</span><span class="s4">) {</span>
          <span class="s2">pendingNavigationController </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
          <span class="s2">completeNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, {</span>
            <span class="s2">matches</span><span class="s4">: </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">loaderData</span><span class="s4">: {},</span>
            <span class="s2">errors</span><span class="s4">: {</span>
              <span class="s4">[</span><span class="s2">routeId</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s2">matches </span><span class="s4">= </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">|| </span><span class="s2">matches</span><span class="s4">;</span>
      <span class="s2">pendingActionResult </span><span class="s4">= </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">pendingActionResult</span><span class="s4">;</span>
      <span class="s2">loadingNavigation </span><span class="s4">= </span><span class="s2">getLoadingNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span><span class="s4">);</span>
      <span class="s2">flushSync </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s2">request </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
        <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s4">{</span>
      <span class="s2">shortCircuited</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">: </span><span class="s2">updatedMatches</span><span class="s4">,</span>
      <span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">errors</span>
    <span class="s4">} = </span><span class="s3">await </span><span class="s2">handleLoaders</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active</span><span class="s4">,</span>
      <span class="s2">loadingNavigation</span><span class="s4">,</span>
      <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">submission</span><span class="s4">,</span>
      <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">fetcherSubmission</span><span class="s4">,</span>
      <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">,</span>
      <span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">initialHydration </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">flushSync</span><span class="s4">,</span>
      <span class="s2">pendingActionResult</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">shortCircuited</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">pendingNavigationController </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s2">completeNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, {</span>
      <span class="s2">matches</span><span class="s4">: </span><span class="s2">updatedMatches </span><span class="s4">|| </span><span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">...getActionDataForCommit</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">),</span>
      <span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">errors</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">handleAction</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">isFogOfWar</span><span class="s4">, </span><span class="s2">initialHydration</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
    <span class="s2">interruptActiveLoads</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">navigation </span><span class="s4">= </span><span class="s2">getSubmittingNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">);</span>
    <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">navigation </span><span class="s4">}, { </span><span class="s2">flushSync</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isFogOfWar</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">discoverResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">discoverRoutes</span><span class="s4">(</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;aborted&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot;</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">boundaryId </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">partialMatches</span><span class="s4">).</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">partialMatches</span><span class="s4">,</span>
          <span class="s2">pendingActionResult</span><span class="s4">: [</span>
            <span class="s2">boundaryId</span><span class="s4">,</span>
            <span class="s4">{</span>
              <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
              <span class="s2">error</span><span class="s4">: </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">error</span>
            <span class="s4">}</span>
          <span class="s4">]</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s4">{ </span><span class="s2">notFoundMatches</span><span class="s4">, </span><span class="s2">error</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">handleNavigational404</span><span class="s4">(</span>
          <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">);</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">notFoundMatches</span><span class="s4">,</span>
          <span class="s2">pendingActionResult</span><span class="s4">: [</span>
            <span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
            <span class="s4">{</span>
              <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
              <span class="s2">error</span>
            <span class="s4">}</span>
          <span class="s4">]</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">matches </span><span class="s4">= </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">result</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">actionMatch </span><span class="s4">= </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">location</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">&amp;&amp; !</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
      <span class="s2">result </span><span class="s4">= {</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
        <span class="s2">error</span><span class="s4">: </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, {</span>
          <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
          <span class="s2">routeId</span><span class="s4">: </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
        <span class="s4">})</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
        <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">actionMatch</span><span class="s4">,</span>
        <span class="s2">initialHydration </span><span class="s4">? [] : </span><span class="s2">hydrationRouteProperties2</span><span class="s4">,</span>
        <span class="s2">scopedContext</span>
      <span class="s4">);</span>
      <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">dsMatches</span><span class="s4">,</span>
        <span class="s2">scopedContext</span><span class="s4">,</span>
        <span class="s3">null</span>
      <span class="s4">);</span>
      <span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">result</span><span class="s4">) {</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of matches</span><span class="s4">) {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">results</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]) {</span>
            <span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
            <span class="s3">break</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">replace2</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s2">replace2 </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">location2 </span><span class="s4">= </span><span class="s2">normalizeRedirectLocation</span><span class="s4">(</span>
          <span class="s2">result</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">),</span>
          <span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">),</span>
          <span class="s2">basename</span>
        <span class="s4">);</span>
        <span class="s2">replace2 </span><span class="s4">= </span><span class="s2">location2 </span><span class="s4">=== </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">await </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">result</span><span class="s4">, </span><span class="s3">true</span><span class="s4">, {</span>
        <span class="s2">submission</span><span class="s4">,</span>
        <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span>
      <span class="s4">});</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">((</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">) !== </span><span class="s3">true</span><span class="s4">) {</span>
        <span class="s2">pendingAction </span><span class="s4">= </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">pendingActionResult</span><span class="s4">: [</span>
          <span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
          <span class="s2">result</span><span class="s4">,</span>
          <span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
        <span class="s4">]</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">pendingActionResult</span><span class="s4">: [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">, </span><span class="s2">result</span><span class="s4">]</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">handleLoaders</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">isFogOfWar</span><span class="s4">, </span><span class="s2">overrideNavigation</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">, </span><span class="s2">fetcherSubmission</span><span class="s4">, </span><span class="s2">replace2</span><span class="s4">, </span><span class="s2">initialHydration</span><span class="s4">, </span><span class="s2">flushSync</span><span class="s4">, </span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">loadingNavigation </span><span class="s4">= </span><span class="s2">overrideNavigation </span><span class="s4">|| </span><span class="s2">getLoadingNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">activeSubmission </span><span class="s4">= </span><span class="s2">submission </span><span class="s4">|| </span><span class="s2">fetcherSubmission </span><span class="s4">|| </span><span class="s2">getSubmissionFromNavigation</span><span class="s4">(</span><span class="s2">loadingNavigation</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">shouldUpdateNavigationState </span><span class="s4">= !</span><span class="s2">isUninterruptedRevalidation </span><span class="s4">&amp;&amp; !</span><span class="s2">initialHydration</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isFogOfWar</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">shouldUpdateNavigationState</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">actionData </span><span class="s4">= </span><span class="s2">getUpdatedActionData</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">);</span>
        <span class="s2">updateState</span><span class="s4">(</span>
          <span class="s4">{</span>
            <span class="s2">navigation</span><span class="s4">: </span><span class="s2">loadingNavigation</span><span class="s4">,</span>
            <span class="s2">...actionData </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? { </span><span class="s2">actionData </span><span class="s4">} : {}</span>
          <span class="s4">},</span>
          <span class="s4">{</span>
            <span class="s2">flushSync</span>
          <span class="s4">}</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">discoverResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">discoverRoutes</span><span class="s4">(</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;aborted&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot;</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">boundaryId </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">partialMatches</span><span class="s4">).</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">partialMatches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s2">errors</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">boundaryId</span><span class="s4">]: </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">error</span>
          <span class="s4">}</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s4">{ </span><span class="s2">error</span><span class="s4">, </span><span class="s2">notFoundMatches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">handleNavigational404</span><span class="s4">(</span>
          <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">);</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">notFoundMatches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s2">errors</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error</span>
          <span class="s4">}</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">matches </span><span class="s4">= </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">dsMatches</span><span class="s4">, </span><span class="s2">revalidatingFetchers </span><span class="s4">} = </span><span class="s2">getMatchesToLoad</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">activeSubmission</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">initialHydration </span><span class="s4">? [] : </span><span class="s2">hydrationRouteProperties2</span><span class="s4">,</span>
      <span class="s2">initialHydration </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">isRevalidationRequired</span><span class="s4">,</span>
      <span class="s2">cancelledFetcherLoads</span><span class="s4">,</span>
      <span class="s2">fetchersQueuedForDeletion</span><span class="s4">,</span>
      <span class="s2">fetchLoadMatches</span><span class="s4">,</span>
      <span class="s2">fetchRedirectIds</span><span class="s4">,</span>
      <span class="s2">routesToUse</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">pendingActionResult</span>
    <span class="s4">);</span>
    <span class="s2">pendingNavigationLoadId </span><span class="s4">= ++</span><span class="s2">incrementingLoadId</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">init</span><span class="s4">.</span><span class="s2">dataStrategy </span><span class="s4">&amp;&amp; !</span><span class="s2">dsMatches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">shouldLoad</span><span class="s4">) &amp;&amp; </span><span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">updatedFetchers2 </span><span class="s4">= </span><span class="s2">markFetchRedirectsDone</span><span class="s4">();</span>
      <span class="s2">completeNavigation</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s4">{</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s6">// Commit pending error if we're short circuiting</span>
          <span class="s2">errors</span><span class="s4">: </span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? { [</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]]: </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">error </span><span class="s4">} : </span><span class="s3">null</span><span class="s4">,</span>
          <span class="s2">...getActionDataForCommit</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">),</span>
          <span class="s2">...updatedFetchers2 </span><span class="s4">? { </span><span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">) } : {}</span>
        <span class="s4">},</span>
        <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">shouldUpdateNavigationState</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">updates </span><span class="s4">= {};</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">isFogOfWar</span><span class="s4">) {</span>
        <span class="s2">updates</span><span class="s4">.</span><span class="s2">navigation </span><span class="s4">= </span><span class="s2">loadingNavigation</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s2">actionData </span><span class="s4">= </span><span class="s2">getUpdatedActionData</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">actionData </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s2">updates</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">= </span><span class="s2">actionData</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s2">updates</span><span class="s4">.</span><span class="s2">fetchers </span><span class="s4">= </span><span class="s2">getUpdatedRevalidatingFetchers</span><span class="s4">(</span><span class="s2">revalidatingFetchers</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">updateState</span><span class="s4">(</span><span class="s2">updates</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; {</span>
      <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">controller</span><span class="s4">) {</span>
        <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">, </span><span class="s2">rf</span><span class="s4">.</span><span class="s2">controller</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
    <span class="s3">let </span><span class="s2">abortPendingFetchRevalidations </span><span class="s4">= () =&gt; </span><span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">f</span><span class="s4">) =&gt; </span><span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">f</span><span class="s4">.</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingNavigationController</span><span class="s4">) {</span>
      <span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span>
        <span class="s5">&quot;abort&quot;</span><span class="s4">,</span>
        <span class="s2">abortPendingFetchRevalidations</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderResults</span><span class="s4">, </span><span class="s2">fetcherResults </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">callLoadersAndMaybeResolveData</span><span class="s4">(</span>
      <span class="s2">dsMatches</span><span class="s4">,</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">,</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">scopedContext</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingNavigationController</span><span class="s4">) {</span>
      <span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span>
        <span class="s5">&quot;abort&quot;</span><span class="s4">,</span>
        <span class="s2">abortPendingFetchRevalidations</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; </span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s3">let </span><span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">findRedirect</span><span class="s4">(</span><span class="s2">loaderResults</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">) {</span>
      <span class="s3">await </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">result</span><span class="s4">, </span><span class="s3">true</span><span class="s4">, {</span>
        <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span>
      <span class="s4">});</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">findRedirect</span><span class="s4">(</span><span class="s2">fetcherResults</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">) {</span>
      <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s3">await </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">result</span><span class="s4">, </span><span class="s3">true</span><span class="s4">, {</span>
        <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span>
      <span class="s4">});</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">shortCircuited</span><span class="s4">: </span><span class="s3">true </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors </span><span class="s4">} = </span><span class="s2">processLoaderData</span><span class="s4">(</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">loaderResults</span><span class="s4">,</span>
      <span class="s2">pendingActionResult</span><span class="s4">,</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">,</span>
      <span class="s2">fetcherResults</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">initialHydration </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
      <span class="s2">errors </span><span class="s4">= { </span><span class="s2">...state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">...errors </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">updatedFetchers </span><span class="s4">= </span><span class="s2">markFetchRedirectsDone</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">didAbortFetchLoads </span><span class="s4">= </span><span class="s2">abortStaleFetchLoads</span><span class="s4">(</span><span class="s2">pendingNavigationLoadId</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">shouldUpdateFetchers </span><span class="s4">= </span><span class="s2">updatedFetchers </span><span class="s4">|| </span><span class="s2">didAbortFetchLoads </span><span class="s4">|| </span><span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">errors</span><span class="s4">,</span>
      <span class="s2">...shouldUpdateFetchers </span><span class="s4">? { </span><span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">) } : {}</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getUpdatedActionData</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; !</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">])) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s4">[</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]]: </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">data</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">).</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s3">return null</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getUpdatedRevalidatingFetchers</span><span class="s4">(</span><span class="s2">revalidatingFetchers</span><span class="s4">) {</span>
    <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">revalidatingFetcher </span><span class="s4">= </span><span class="s2">getLoadingFetcher</span><span class="s4">(</span>
        <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">fetcher </span><span class="s4">? </span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">data </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">);</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">, </span><span class="s2">revalidatingFetcher</span><span class="s4">);</span>
    <span class="s4">});</span>
    <span class="s3">return new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">fetch2</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
    <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">flushSync </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">normalizeTo</span><span class="s4">(</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">href2</span><span class="s4">,</span>
      <span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">opts</span><span class="s4">?.</span><span class="s2">relative</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">normalizedPath</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">fogOfWar </span><span class="s4">= </span><span class="s2">checkFogOfWar</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">normalizedPath</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active </span><span class="s4">&amp;&amp; </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s2">matches </span><span class="s4">= </span><span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s2">setFetcherError</span><span class="s4">(</span>
        <span class="s2">key</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">,</span>
        <span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">normalizedPath </span><span class="s4">}),</span>
        <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
      <span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">path</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">, </span><span class="s2">error </span><span class="s4">} = </span><span class="s2">normalizeNavigateOptions</span><span class="s4">(</span>
      <span class="s3">true</span><span class="s4">,</span>
      <span class="s2">normalizedPath</span><span class="s4">,</span>
      <span class="s2">opts</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">});</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">match </span><span class="s4">= </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">path</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">scopedContext </span><span class="s4">= </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">unstable_getContext </span><span class="s4">? </span><span class="s3">await </span><span class="s2">init</span><span class="s4">.</span><span class="s2">unstable_getContext</span><span class="s4">() : </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">preventScrollReset </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">preventScrollReset</span><span class="s4">) === </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">submission </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
      <span class="s3">await </span><span class="s2">handleFetcherAction</span><span class="s4">(</span>
        <span class="s2">key</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">,</span>
        <span class="s2">path</span><span class="s4">,</span>
        <span class="s2">match</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">scopedContext</span><span class="s4">,</span>
        <span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active</span><span class="s4">,</span>
        <span class="s2">flushSync</span><span class="s4">,</span>
        <span class="s2">preventScrollReset</span><span class="s4">,</span>
        <span class="s2">submission</span>
      <span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">fetchLoadMatches</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, { </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">path </span><span class="s4">});</span>
    <span class="s3">await </span><span class="s2">handleFetcherLoader</span><span class="s4">(</span>
      <span class="s2">key</span><span class="s4">,</span>
      <span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">fogOfWar</span><span class="s4">.</span><span class="s2">active</span><span class="s4">,</span>
      <span class="s2">flushSync</span><span class="s4">,</span>
      <span class="s2">preventScrollReset</span><span class="s4">,</span>
      <span class="s2">submission</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">handleFetcherAction</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">requestMatches</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">isFogOfWar</span><span class="s4">, </span><span class="s2">flushSync</span><span class="s4">, </span><span class="s2">preventScrollReset</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">) {</span>
    <span class="s2">interruptActiveLoads</span><span class="s4">();</span>
    <span class="s2">fetchLoadMatches</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">function </span><span class="s2">detectAndHandle405Error</span><span class="s4">(</span><span class="s2">m</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">&amp;&amp; !</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, {</span>
          <span class="s2">method</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">: </span><span class="s2">path</span><span class="s4">,</span>
          <span class="s2">routeId</span>
        <span class="s4">});</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">});</span>
        <span class="s3">return true</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">return false</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isFogOfWar </span><span class="s4">&amp;&amp; </span><span class="s2">detectAndHandle405Error</span><span class="s4">(</span><span class="s2">match</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">existingFetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getSubmittingFetcher</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">, </span><span class="s2">existingFetcher</span><span class="s4">), {</span>
      <span class="s2">flushSync</span>
    <span class="s4">});</span>
    <span class="s3">let </span><span class="s2">abortController </span><span class="s4">= </span><span class="s3">new </span><span class="s2">AbortController</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">fetchRequest </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
      <span class="s2">submission</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isFogOfWar</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">discoverResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">discoverRoutes</span><span class="s4">(</span>
        <span class="s2">requestMatches</span><span class="s4">,</span>
        <span class="s2">path</span><span class="s4">,</span>
        <span class="s2">fetchRequest</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
        <span class="s2">key</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;aborted&quot;</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot;</span><span class="s4">) {</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">});</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span>
          <span class="s2">key</span><span class="s4">,</span>
          <span class="s2">routeId</span><span class="s4">,</span>
          <span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">path </span><span class="s4">}),</span>
          <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
        <span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">requestMatches </span><span class="s4">= </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
        <span class="s2">match </span><span class="s4">= </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">requestMatches</span><span class="s4">, </span><span class="s2">path</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">detectAndHandle405Error</span><span class="s4">(</span><span class="s2">match</span><span class="s4">)) {</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">abortController</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">originatingLoadId </span><span class="s4">= </span><span class="s2">incrementingLoadId</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">fetchMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">fetchRequest</span><span class="s4">,</span>
      <span class="s2">requestMatches</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s2">hydrationRouteProperties2</span><span class="s4">,</span>
      <span class="s2">scopedContext</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">actionResults </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
      <span class="s2">fetchRequest</span><span class="s4">,</span>
      <span class="s2">fetchMatches</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">key</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">actionResult </span><span class="s4">= </span><span class="s2">actionResults</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchRequest</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) === </span><span class="s2">abortController</span><span class="s4">) {</span>
        <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">) || </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">)) {</span>
        <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">));</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">)) {</span>
        <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingNavigationLoadId </span><span class="s4">&gt; </span><span class="s2">originatingLoadId</span><span class="s4">) {</span>
          <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">));</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
          <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getLoadingFetcher</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">));</span>
          <span class="s3">return </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">fetchRequest</span><span class="s4">, </span><span class="s2">actionResult</span><span class="s4">, </span><span class="s3">false</span><span class="s4">, {</span>
            <span class="s2">fetcherSubmission</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">,</span>
            <span class="s2">preventScrollReset</span>
          <span class="s4">});</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">)) {</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">nextLocation </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">revalidationRequest </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">nextLocation</span><span class="s4">,</span>
      <span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">!== </span><span class="s5">&quot;idle&quot; </span><span class="s4">? </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) : </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s2">invariant</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s5">&quot;Didn't find any matches after fetcher action&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">loadId </span><span class="s4">= ++</span><span class="s2">incrementingLoadId</span><span class="s4">;</span>
    <span class="s2">fetchReloadIds</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">loadId</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">loadFetcher </span><span class="s4">= </span><span class="s2">getLoadingFetcher</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">, </span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">loadFetcher</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">dsMatches</span><span class="s4">, </span><span class="s2">revalidatingFetchers </span><span class="s4">} = </span><span class="s2">getMatchesToLoad</span><span class="s4">(</span>
      <span class="s2">revalidationRequest</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">submission</span><span class="s4">,</span>
      <span class="s2">nextLocation</span><span class="s4">,</span>
      <span class="s2">hydrationRouteProperties2</span><span class="s4">,</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s2">isRevalidationRequired</span><span class="s4">,</span>
      <span class="s2">cancelledFetcherLoads</span><span class="s4">,</span>
      <span class="s2">fetchersQueuedForDeletion</span><span class="s4">,</span>
      <span class="s2">fetchLoadMatches</span><span class="s4">,</span>
      <span class="s2">fetchRedirectIds</span><span class="s4">,</span>
      <span class="s2">routesToUse</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">, </span><span class="s2">actionResult</span><span class="s4">]</span>
    <span class="s4">);</span>
    <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; </span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key </span><span class="s4">!== </span><span class="s2">key</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">staleKey </span><span class="s4">= </span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">existingFetcher2 </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">staleKey</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">revalidatingFetcher </span><span class="s4">= </span><span class="s2">getLoadingFetcher</span><span class="s4">(</span>
        <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">existingFetcher2 </span><span class="s4">? </span><span class="s2">existingFetcher2</span><span class="s4">.</span><span class="s2">data </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">);</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">staleKey</span><span class="s4">, </span><span class="s2">revalidatingFetcher</span><span class="s4">);</span>
      <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">staleKey</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">controller</span><span class="s4">) {</span>
        <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">staleKey</span><span class="s4">, </span><span class="s2">rf</span><span class="s4">.</span><span class="s2">controller</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
    <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">) });</span>
    <span class="s3">let </span><span class="s2">abortPendingFetchRevalidations </span><span class="s4">= () =&gt; </span><span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; </span><span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">rf</span><span class="s4">.</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span>
      <span class="s5">&quot;abort&quot;</span><span class="s4">,</span>
      <span class="s2">abortPendingFetchRevalidations</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderResults</span><span class="s4">, </span><span class="s2">fetcherResults </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">callLoadersAndMaybeResolveData</span><span class="s4">(</span>
      <span class="s2">dsMatches</span><span class="s4">,</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">,</span>
      <span class="s2">revalidationRequest</span><span class="s4">,</span>
      <span class="s2">scopedContext</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span>
      <span class="s5">&quot;abort&quot;</span><span class="s4">,</span>
      <span class="s2">abortPendingFetchRevalidations</span>
    <span class="s4">);</span>
    <span class="s2">fetchReloadIds</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">r</span><span class="s4">) =&gt; </span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">r</span><span class="s4">.</span><span class="s2">key</span><span class="s4">));</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">doneFetcher </span><span class="s4">= </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s2">actionResult</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">doneFetcher</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">findRedirect</span><span class="s4">(</span><span class="s2">loaderResults</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span>
        <span class="s2">revalidationRequest</span><span class="s4">,</span>
        <span class="s2">redirect2</span><span class="s4">.</span><span class="s2">result</span><span class="s4">,</span>
        <span class="s3">false</span><span class="s4">,</span>
        <span class="s4">{ </span><span class="s2">preventScrollReset </span><span class="s4">}</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">findRedirect</span><span class="s4">(</span><span class="s2">fetcherResults</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">) {</span>
      <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span>
        <span class="s2">revalidationRequest</span><span class="s4">,</span>
        <span class="s2">redirect2</span><span class="s4">.</span><span class="s2">result</span><span class="s4">,</span>
        <span class="s3">false</span><span class="s4">,</span>
        <span class="s4">{ </span><span class="s2">preventScrollReset </span><span class="s4">}</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors </span><span class="s4">} = </span><span class="s2">processLoaderData</span><span class="s4">(</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">loaderResults</span><span class="s4">,</span>
      <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">,</span>
      <span class="s2">fetcherResults</span>
    <span class="s4">);</span>
    <span class="s2">abortStaleFetchLoads</span><span class="s4">(</span><span class="s2">loadId</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;loading&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">loadId </span><span class="s4">&gt; </span><span class="s2">pendingNavigationLoadId</span><span class="s4">) {</span>
      <span class="s2">invariant</span><span class="s4">(</span><span class="s2">pendingAction</span><span class="s4">, </span><span class="s5">&quot;Expected pending action&quot;</span><span class="s4">);</span>
      <span class="s2">pendingNavigationController </span><span class="s4">&amp;&amp; </span><span class="s2">pendingNavigationController</span><span class="s4">.</span><span class="s2">abort</span><span class="s4">();</span>
      <span class="s2">completeNavigation</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, {</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">,</span>
        <span class="s2">errors</span><span class="s4">,</span>
        <span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">)</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">updateState</span><span class="s4">({</span>
        <span class="s2">errors</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">mergeLoaderData</span><span class="s4">(</span>
          <span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">,</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">errors</span>
        <span class="s4">),</span>
        <span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">)</span>
      <span class="s4">});</span>
      <span class="s2">isRevalidationRequired </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">handleFetcherLoader</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">isFogOfWar</span><span class="s4">, </span><span class="s2">flushSync</span><span class="s4">, </span><span class="s2">preventScrollReset</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">existingFetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">updateFetcherState</span><span class="s4">(</span>
      <span class="s2">key</span><span class="s4">,</span>
      <span class="s2">getLoadingFetcher</span><span class="s4">(</span>
        <span class="s2">submission</span><span class="s4">,</span>
        <span class="s2">existingFetcher </span><span class="s4">? </span><span class="s2">existingFetcher</span><span class="s4">.</span><span class="s2">data </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">),</span>
      <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">abortController </span><span class="s4">= </span><span class="s3">new </span><span class="s2">AbortController</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">fetchRequest </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">abortController</span><span class="s4">.</span><span class="s2">signal</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isFogOfWar</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">discoverResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">discoverRoutes</span><span class="s4">(</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">path</span><span class="s4">,</span>
        <span class="s2">fetchRequest</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
        <span class="s2">key</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;aborted&quot;</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot;</span><span class="s4">) {</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">, { </span><span class="s2">flushSync </span><span class="s4">});</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s2">setFetcherError</span><span class="s4">(</span>
          <span class="s2">key</span><span class="s4">,</span>
          <span class="s2">routeId</span><span class="s4">,</span>
          <span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">path </span><span class="s4">}),</span>
          <span class="s4">{ </span><span class="s2">flushSync </span><span class="s4">}</span>
        <span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">matches </span><span class="s4">= </span><span class="s2">discoverResult</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
        <span class="s2">match </span><span class="s4">= </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">path</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">abortController</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">originatingLoadId </span><span class="s4">= </span><span class="s2">incrementingLoadId</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">fetchRequest</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s2">hydrationRouteProperties2</span><span class="s4">,</span>
      <span class="s2">scopedContext</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
      <span class="s2">fetchRequest</span><span class="s4">,</span>
      <span class="s2">dsMatches</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">key</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) === </span><span class="s2">abortController</span><span class="s4">) {</span>
      <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchRequest</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">));</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingNavigationLoadId </span><span class="s4">&gt; </span><span class="s2">originatingLoadId</span><span class="s4">) {</span>
        <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">));</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s3">await </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">fetchRequest</span><span class="s4">, </span><span class="s2">result</span><span class="s4">, </span><span class="s3">false</span><span class="s4">, {</span>
          <span class="s2">preventScrollReset</span>
        <span class="s4">});</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">startRedirectNavigation</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">redirect2</span><span class="s4">, </span><span class="s2">isNavigation</span><span class="s4">, {</span>
    <span class="s2">submission</span><span class="s4">,</span>
    <span class="s2">fetcherSubmission</span><span class="s4">,</span>
    <span class="s2">preventScrollReset</span><span class="s4">,</span>
    <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span>
  <span class="s4">} = {}) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Revalidate&quot;</span><span class="s4">)) {</span>
      <span class="s2">isRevalidationRequired </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s5">&quot;Expected a Location header on the redirect Response&quot;</span><span class="s4">);</span>
    <span class="s2">location </span><span class="s4">= </span><span class="s2">normalizeRedirectLocation</span><span class="s4">(</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">),</span>
      <span class="s2">basename</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">redirectLocation </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, {</span>
      <span class="s2">_isRedirect</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isBrowser2</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">isDocumentReload </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">)) {</span>
        <span class="s2">isDocumentReload </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">ABSOLUTE_URL_REGEX</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">location</span><span class="s4">)) {</span>
        <span class="s3">const </span><span class="s2">url </span><span class="s4">= </span><span class="s2">createBrowserURLImpl</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s3">true</span><span class="s4">);</span>
        <span class="s2">isDocumentReload </span><span class="s4">= </span><span class="s6">// Hard reload if it's an absolute URL to a new origin</span>
        <span class="s2">url</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">!== </span><span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">|| </span><span class="s6">// Hard reload if it's an absolute URL that does not match our basename</span>
        <span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) == </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isDocumentReload</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">replace2</span><span class="s4">) {</span>
          <span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">location</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">routerWindow</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">location</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">pendingNavigationController </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">redirectNavigationType </span><span class="s4">= </span><span class="s2">replace2 </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">|| </span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Replace&quot;</span><span class="s4">) ? </span><span class="s5">&quot;REPLACE&quot; </span><span class="s6">/* Replace */ </span><span class="s4">: </span><span class="s5">&quot;PUSH&quot; </span><span class="s6">/* Push */</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">formMethod</span><span class="s4">, </span><span class="s2">formAction</span><span class="s4">, </span><span class="s2">formEncType </span><span class="s4">} = </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">submission </span><span class="s4">&amp;&amp; !</span><span class="s2">fetcherSubmission </span><span class="s4">&amp;&amp; </span><span class="s2">formMethod </span><span class="s4">&amp;&amp; </span><span class="s2">formAction </span><span class="s4">&amp;&amp; </span><span class="s2">formEncType</span><span class="s4">) {</span>
      <span class="s2">submission </span><span class="s4">= </span><span class="s2">getSubmissionFromNavigation</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">activeSubmission </span><span class="s4">= </span><span class="s2">submission </span><span class="s4">|| </span><span class="s2">fetcherSubmission</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">redirectPreserveMethodStatusCodes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">status</span><span class="s4">) &amp;&amp; </span><span class="s2">activeSubmission </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">activeSubmission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
      <span class="s3">await </span><span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">redirectNavigationType</span><span class="s4">, </span><span class="s2">redirectLocation</span><span class="s4">, {</span>
        <span class="s2">submission</span><span class="s4">: {</span>
          <span class="s2">...activeSubmission</span><span class="s4">,</span>
          <span class="s2">formAction</span><span class="s4">: </span><span class="s2">location</span>
        <span class="s4">},</span>
        <span class="s6">// Preserve these flags across redirects</span>
        <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">preventScrollReset </span><span class="s4">|| </span><span class="s2">pendingPreventScrollReset</span><span class="s4">,</span>
        <span class="s2">enableViewTransition</span><span class="s4">: </span><span class="s2">isNavigation </span><span class="s4">? </span><span class="s2">pendingViewTransitionEnabled </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">overrideNavigation </span><span class="s4">= </span><span class="s2">getLoadingNavigation</span><span class="s4">(</span>
        <span class="s2">redirectLocation</span><span class="s4">,</span>
        <span class="s2">submission</span>
      <span class="s4">);</span>
      <span class="s3">await </span><span class="s2">startNavigation</span><span class="s4">(</span><span class="s2">redirectNavigationType</span><span class="s4">, </span><span class="s2">redirectLocation</span><span class="s4">, {</span>
        <span class="s2">overrideNavigation</span><span class="s4">,</span>
        <span class="s6">// Send fetcher submissions through for shouldRevalidate</span>
        <span class="s2">fetcherSubmission</span><span class="s4">,</span>
        <span class="s6">// Preserve these flags across redirects</span>
        <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">preventScrollReset </span><span class="s4">|| </span><span class="s2">pendingPreventScrollReset</span><span class="s4">,</span>
        <span class="s2">enableViewTransition</span><span class="s4">: </span><span class="s2">isNavigation </span><span class="s4">? </span><span class="s2">pendingViewTransitionEnabled </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">callDataStrategy</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">fetcherKey</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">results</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">dataResults </span><span class="s4">= {};</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategyImpl</span><span class="s4">(</span>
        <span class="s2">dataStrategyImpl</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">fetcherKey</span><span class="s4">,</span>
        <span class="s2">scopedContext</span><span class="s4">,</span>
        <span class="s3">false</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s2">matches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">shouldLoad</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; {</span>
        <span class="s2">dataResults</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = {</span>
          <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
          <span class="s2">error</span><span class="s4">: </span><span class="s2">e</span>
        <span class="s4">};</span>
      <span class="s4">});</span>
      <span class="s3">return </span><span class="s2">dataResults</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">dataResults</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">result</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">results</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectDataStrategyResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
        <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">;</span>
        <span class="s2">dataResults</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = {</span>
          <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;redirect&quot; </span><span class="s6">/* redirect */</span><span class="s4">,</span>
          <span class="s2">response</span><span class="s4">: </span><span class="s2">normalizeRelativeRoutingRedirectResponse</span><span class="s4">(</span>
            <span class="s2">response</span><span class="s4">,</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">routeId</span><span class="s4">,</span>
            <span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">basename</span>
          <span class="s4">)</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">dataResults</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = </span><span class="s3">await </span><span class="s2">convertDataStrategyResultToDataResult</span><span class="s4">(</span>
          <span class="s2">result</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">dataResults</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">callLoadersAndMaybeResolveData</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">fetchersToLoad</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">loaderResultsPromise </span><span class="s4">= </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s3">null</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">fetcherResultsPromise </span><span class="s4">= </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
      <span class="s2">fetchersToLoad</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">f</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">f</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">f</span><span class="s4">.</span><span class="s2">match </span><span class="s4">&amp;&amp; </span><span class="s2">f</span><span class="s4">.</span><span class="s2">request </span><span class="s4">&amp;&amp; </span><span class="s2">f</span><span class="s4">.</span><span class="s2">controller</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
            <span class="s2">f</span><span class="s4">.</span><span class="s2">request</span><span class="s4">,</span>
            <span class="s2">f</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">scopedContext</span><span class="s4">,</span>
            <span class="s2">f</span><span class="s4">.</span><span class="s2">key</span>
          <span class="s4">);</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">f</span><span class="s4">.</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
          <span class="s3">return </span><span class="s4">{ [</span><span class="s2">f</span><span class="s4">.</span><span class="s2">key</span><span class="s4">]: </span><span class="s2">result </span><span class="s4">};</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s3">return </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">({</span>
            <span class="s4">[</span><span class="s2">f</span><span class="s4">.</span><span class="s2">key</span><span class="s4">]: {</span>
              <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
              <span class="s2">error</span><span class="s4">: </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, {</span>
                <span class="s2">pathname</span><span class="s4">: </span><span class="s2">f</span><span class="s4">.</span><span class="s2">path</span>
              <span class="s4">})</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
        <span class="s4">}</span>
      <span class="s4">})</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">loaderResults </span><span class="s4">= </span><span class="s3">await </span><span class="s2">loaderResultsPromise</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">fetcherResults </span><span class="s4">= (</span><span class="s3">await </span><span class="s2">fetcherResultsPromise</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">acc</span><span class="s4">, </span><span class="s2">r</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">acc</span><span class="s4">, </span><span class="s2">r</span><span class="s4">),</span>
      <span class="s4">{}</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">loaderResults</span><span class="s4">,</span>
      <span class="s2">fetcherResults</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">interruptActiveLoads</span><span class="s4">() {</span>
    <span class="s2">isRevalidationRequired </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">fetchLoadMatches</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
        <span class="s2">cancelledFetcherLoads</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">updateFetcherState</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fetcher</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fetcher</span><span class="s4">);</span>
    <span class="s2">updateState</span><span class="s4">(</span>
      <span class="s4">{ </span><span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">) },</span>
      <span class="s4">{ </span><span class="s2">flushSync</span><span class="s4">: (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) === </span><span class="s3">true </span><span class="s4">}</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">setFetcherError</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
    <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">);</span>
    <span class="s2">deleteFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">updateState</span><span class="s4">(</span>
      <span class="s4">{</span>
        <span class="s2">errors</span><span class="s4">: {</span>
          <span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error</span>
        <span class="s4">},</span>
        <span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">)</span>
      <span class="s4">},</span>
      <span class="s4">{ </span><span class="s2">flushSync</span><span class="s4">: (</span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) === </span><span class="s3">true </span><span class="s4">}</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s2">activeFetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, (</span><span class="s2">activeFetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) || </span><span class="s7">0</span><span class="s4">) + </span><span class="s7">1</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) || </span><span class="s2">IDLE_FETCHER</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">deleteFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) &amp;&amp; !(</span><span class="s2">fetcher </span><span class="s4">&amp;&amp; </span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;loading&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">fetchReloadIds</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">))) {</span>
      <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">fetchLoadMatches</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">fetchReloadIds</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">cancelledFetcherLoads</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">queueFetcherForDeletion</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">count </span><span class="s4">= (</span><span class="s2">activeFetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) || </span><span class="s7">0</span><span class="s4">) - </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">count </span><span class="s4">&lt;= </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">activeFetchers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">activeFetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">count</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">fetchers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">) });</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">controller </span><span class="s4">= </span><span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">controller</span><span class="s4">) {</span>
      <span class="s2">controller</span><span class="s4">.</span><span class="s2">abort</span><span class="s4">();</span>
      <span class="s2">fetchControllers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">markFetchersDone</span><span class="s4">(</span><span class="s2">keys</span><span class="s4">) {</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">key of keys</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">getFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">doneFetcher </span><span class="s4">= </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">doneFetcher</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">markFetchRedirectsDone</span><span class="s4">() {</span>
    <span class="s3">let </span><span class="s2">doneKeys </span><span class="s4">= [];</span>
    <span class="s3">let </span><span class="s2">updatedFetchers </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">key of fetchRedirectIds</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s2">invariant</span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">, </span><span class="s5">`Expected fetcher: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s5">`</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;loading&quot;</span><span class="s4">) {</span>
        <span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s2">doneKeys</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s2">updatedFetchers </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">markFetchersDone</span><span class="s4">(</span><span class="s2">doneKeys</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">updatedFetchers</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">abortStaleFetchLoads</span><span class="s4">(</span><span class="s2">landedId</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">yeetedKeys </span><span class="s4">= [];</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">id</span><span class="s4">] </span><span class="s2">of fetchReloadIds</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">id </span><span class="s4">&lt; </span><span class="s2">landedId</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s2">invariant</span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">, </span><span class="s5">`Expected fetcher: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s5">`</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;loading&quot;</span><span class="s4">) {</span>
          <span class="s2">abortFetcher</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
          <span class="s2">fetchReloadIds</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
          <span class="s2">yeetedKeys</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">markFetchersDone</span><span class="s4">(</span><span class="s2">yeetedKeys</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">yeetedKeys</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getBlocker</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fn</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">blocker </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) || </span><span class="s2">IDLE_BLOCKER</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) !== </span><span class="s2">fn</span><span class="s4">) {</span>
      <span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fn</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">blocker</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">deleteBlocker</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) {</span>
    <span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">updateBlocker</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">newBlocker</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">blocker </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">) || </span><span class="s2">IDLE_BLOCKER</span><span class="s4">;</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;unblocked&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">|| </span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">|| </span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;proceeding&quot; </span><span class="s4">|| </span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;unblocked&quot; </span><span class="s4">|| </span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;proceeding&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;unblocked&quot;</span><span class="s4">,</span>
      <span class="s5">`Invalid blocker state transition: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state</span><span class="s4">} </span><span class="s5">-&gt; </span><span class="s2">$</span><span class="s4">{</span><span class="s2">newBlocker</span><span class="s4">.</span><span class="s2">state</span><span class="s4">}</span><span class="s5">`</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">blockers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">);</span>
    <span class="s2">blockers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">newBlocker</span><span class="s4">);</span>
    <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">blockers </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">shouldBlockNavigation</span><span class="s4">({</span>
    <span class="s2">currentLocation</span><span class="s4">,</span>
    <span class="s2">nextLocation</span><span class="s4">,</span>
    <span class="s2">historyAction</span>
  <span class="s4">}) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">size </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">1</span><span class="s4">) {</span>
      <span class="s2">warning</span><span class="s4">(</span><span class="s3">false</span><span class="s4">, </span><span class="s5">&quot;A router only supports one blocker at a time&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">blockerFunctions</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">());</span>
    <span class="s3">let </span><span class="s4">[</span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">blockerFunction</span><span class="s4">] = </span><span class="s2">entries</span><span class="s4">[</span><span class="s2">entries</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">blocker </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blocker </span><span class="s4">&amp;&amp; </span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;proceeding&quot;</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerFunction</span><span class="s4">({ </span><span class="s2">currentLocation</span><span class="s4">, </span><span class="s2">nextLocation</span><span class="s4">, </span><span class="s2">historyAction </span><span class="s4">})) {</span>
      <span class="s3">return </span><span class="s2">blockerKey</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">handleNavigational404</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname </span><span class="s4">});</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">getShortCircuitMatches</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">notFoundMatches</span><span class="s4">: </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">route</span><span class="s4">, </span><span class="s2">error </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">enableScrollRestoration</span><span class="s4">(</span><span class="s2">positions</span><span class="s4">, </span><span class="s2">getPosition</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">) {</span>
    <span class="s2">savedScrollPositions2 </span><span class="s4">= </span><span class="s2">positions</span><span class="s4">;</span>
    <span class="s2">getScrollPosition </span><span class="s4">= </span><span class="s2">getPosition</span><span class="s4">;</span>
    <span class="s2">getScrollRestorationKey2 </span><span class="s4">= </span><span class="s2">getKey </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">initialScrollRestored </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation </span><span class="s4">=== </span><span class="s2">IDLE_NAVIGATION</span><span class="s4">) {</span>
      <span class="s2">initialScrollRestored </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">y </span><span class="s4">= </span><span class="s2">getSavedScrollPosition</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">y </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s2">updateState</span><span class="s4">({ </span><span class="s2">restoreScrollPosition</span><span class="s4">: </span><span class="s2">y </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">() =&gt; {</span>
      <span class="s2">savedScrollPositions2 </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s2">getScrollPosition </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s2">getScrollRestorationKey2 </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getScrollKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">getScrollRestorationKey2</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">getScrollRestorationKey2</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">convertRouteMatchToUiMatch</span><span class="s4">(</span><span class="s2">m</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">))</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s2">key </span><span class="s4">|| </span><span class="s2">location</span><span class="s4">.</span><span class="s2">key</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">location</span><span class="s4">.</span><span class="s2">key</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">saveScrollPosition</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">savedScrollPositions2 </span><span class="s4">&amp;&amp; </span><span class="s2">getScrollPosition</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">getScrollKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">);</span>
      <span class="s2">savedScrollPositions2</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">getScrollPosition</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">getSavedScrollPosition</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">savedScrollPositions2</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">getScrollKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">y </span><span class="s4">= </span><span class="s2">savedScrollPositions2</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">y </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">y</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">checkFogOfWar</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">init</span><span class="s4">.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">fogMatches </span><span class="s4">= </span><span class="s2">matchRoutesImpl</span><span class="s4">(</span>
          <span class="s2">routesToUse</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">,</span>
          <span class="s2">basename</span><span class="s4">,</span>
          <span class="s3">true</span>
        <span class="s4">);</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">active</span><span class="s4">: </span><span class="s3">true</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">fogMatches </span><span class="s4">|| [] };</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">).</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">partialMatches </span><span class="s4">= </span><span class="s2">matchRoutesImpl</span><span class="s4">(</span>
            <span class="s2">routesToUse</span><span class="s4">,</span>
            <span class="s2">pathname</span><span class="s4">,</span>
            <span class="s2">basename</span><span class="s4">,</span>
            <span class="s3">true</span>
          <span class="s4">);</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">active</span><span class="s4">: </span><span class="s3">true</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">partialMatches </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">active</span><span class="s4">: </span><span class="s3">false</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s3">null </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">discoverRoutes</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">signal</span><span class="s4">, </span><span class="s2">fetcherKey</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">init</span><span class="s4">.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;success&quot;</span><span class="s4">, </span><span class="s2">matches </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">partialMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s3">while </span><span class="s4">(</span><span class="s3">true</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">isNonHMR </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">== </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">localManifest </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">;</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">init</span><span class="s4">.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">({</span>
          <span class="s2">signal</span><span class="s4">,</span>
          <span class="s2">path</span><span class="s4">: </span><span class="s2">pathname</span><span class="s4">,</span>
          <span class="s2">matches</span><span class="s4">: </span><span class="s2">partialMatches</span><span class="s4">,</span>
          <span class="s2">fetcherKey</span><span class="s4">,</span>
          <span class="s2">patch</span><span class="s4">: (</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">children</span><span class="s4">) =&gt; {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
            <span class="s2">patchRoutesImpl</span><span class="s4">(</span>
              <span class="s2">routeId</span><span class="s4">,</span>
              <span class="s2">children</span><span class="s4">,</span>
              <span class="s2">routesToUse</span><span class="s4">,</span>
              <span class="s2">localManifest</span><span class="s4">,</span>
              <span class="s2">mapRouteProperties2</span>
            <span class="s4">);</span>
          <span class="s4">}</span>
        <span class="s4">});</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">error</span><span class="s4">: </span><span class="s2">e</span><span class="s4">, </span><span class="s2">partialMatches </span><span class="s4">};</span>
      <span class="s4">} </span><span class="s3">finally </span><span class="s4">{</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isNonHMR </span><span class="s4">&amp;&amp; !</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
          <span class="s2">dataRoutes </span><span class="s4">= [</span><span class="s2">...dataRoutes</span><span class="s4">];</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;aborted&quot; </span><span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">newMatches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">newMatches</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;success&quot;</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">newMatches </span><span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">newPartialMatches </span><span class="s4">= </span><span class="s2">matchRoutesImpl</span><span class="s4">(</span>
        <span class="s2">routesToUse</span><span class="s4">,</span>
        <span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">basename</span><span class="s4">,</span>
        <span class="s3">true</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">newPartialMatches </span><span class="s4">|| </span><span class="s2">partialMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s2">newPartialMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&amp;&amp; </span><span class="s2">partialMatches</span><span class="s4">.</span><span class="s2">every</span><span class="s4">(</span>
        <span class="s4">(</span><span class="s2">m</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">newPartialMatches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
      <span class="s4">)) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;success&quot;</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s3">null </span><span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s2">partialMatches </span><span class="s4">= </span><span class="s2">newPartialMatches</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">_internalSetRoutes</span><span class="s4">(</span><span class="s2">newRoutes</span><span class="s4">) {</span>
    <span class="s2">manifest </span><span class="s4">= {};</span>
    <span class="s2">inFlightDataRoutes </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
      <span class="s2">newRoutes</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">manifest</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">function </span><span class="s2">patchRoutes</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">children</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">isNonHMR </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">== </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">routesToUse </span><span class="s4">= </span><span class="s2">inFlightDataRoutes </span><span class="s4">|| </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s2">patchRoutesImpl</span><span class="s4">(</span>
      <span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">routesToUse</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties2</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isNonHMR</span><span class="s4">) {</span>
      <span class="s2">dataRoutes </span><span class="s4">= [</span><span class="s2">...dataRoutes</span><span class="s4">];</span>
      <span class="s2">updateState</span><span class="s4">({});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">router </span><span class="s4">= {</span>
    <span class="s2">get basename</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">basename</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get future</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">future</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get state</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">state</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get routes</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get window</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">routerWindow</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">initialize</span><span class="s4">,</span>
    <span class="s2">subscribe</span><span class="s4">,</span>
    <span class="s2">enableScrollRestoration</span><span class="s4">,</span>
    <span class="s2">navigate</span><span class="s4">,</span>
    <span class="s2">fetch</span><span class="s4">: </span><span class="s2">fetch2</span><span class="s4">,</span>
    <span class="s2">revalidate</span><span class="s4">,</span>
    <span class="s6">// Passthrough to history-aware createHref used by useHref so we get proper</span>
    <span class="s6">// hash-aware URLs in DOM paths</span>
    <span class="s2">createHref</span><span class="s4">: (</span><span class="s2">to</span><span class="s4">) =&gt; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">createHref</span><span class="s4">(</span><span class="s2">to</span><span class="s4">),</span>
    <span class="s2">encodeLocation</span><span class="s4">: (</span><span class="s2">to</span><span class="s4">) =&gt; </span><span class="s2">init</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">),</span>
    <span class="s2">getFetcher</span><span class="s4">,</span>
    <span class="s2">deleteFetcher</span><span class="s4">: </span><span class="s2">queueFetcherForDeletion</span><span class="s4">,</span>
    <span class="s2">dispose</span><span class="s4">,</span>
    <span class="s2">getBlocker</span><span class="s4">,</span>
    <span class="s2">deleteBlocker</span><span class="s4">,</span>
    <span class="s2">patchRoutes</span><span class="s4">,</span>
    <span class="s2">_internalFetchControllers</span><span class="s4">: </span><span class="s2">fetchControllers</span><span class="s4">,</span>
    <span class="s6">// TODO: Remove setRoutes, it's temporary to avoid dealing with</span>
    <span class="s6">// updating the tree while validating the update algorithm.</span>
    <span class="s2">_internalSetRoutes</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">router</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createStaticHandler</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">routes</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s5">&quot;You must provide a non-empty routes array to createStaticHandler&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">manifest </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">basename </span><span class="s4">= (</span><span class="s2">opts </span><span class="s4">? </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">basename </span><span class="s4">: </span><span class="s3">null</span><span class="s4">) || </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">mapRouteProperties2 </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">mapRouteProperties </span><span class="s4">|| </span><span class="s2">defaultMapRouteProperties</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">dataRoutes </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
    <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">manifest</span>
  <span class="s4">);</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">query</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, {</span>
    <span class="s2">requestContext</span><span class="s4">,</span>
    <span class="s2">filterMatchesToLoad</span><span class="s4">,</span>
    <span class="s2">skipLoaderErrorBubbling</span><span class="s4">,</span>
    <span class="s2">skipRevalidation</span><span class="s4">,</span>
    <span class="s2">dataStrategy</span><span class="s4">,</span>
    <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">respond</span>
  <span class="s4">} = {}) {</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">method </span><span class="s4">= </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">url</span><span class="s4">), </span><span class="s3">null</span><span class="s4">, </span><span class="s5">&quot;default&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s2">requestContext </span><span class="s4">= </span><span class="s2">requestContext </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">requestContext </span><span class="s4">: </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">();</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isValidMethod</span><span class="s4">(</span><span class="s2">method</span><span class="s4">) &amp;&amp; </span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, { </span><span class="s2">method </span><span class="s4">});</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">methodNotAllowedMatches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">getShortCircuitMatches</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">staticContext </span><span class="s4">= {</span>
        <span class="s2">basename</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">: </span><span class="s2">methodNotAllowedMatches</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">: {},</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">errors</span><span class="s4">: {</span>
          <span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error</span>
        <span class="s4">},</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">loaderHeaders</span><span class="s4">: {},</span>
        <span class="s2">actionHeaders</span><span class="s4">: {}</span>
      <span class="s4">};</span>
      <span class="s3">return </span><span class="s2">respond </span><span class="s4">? </span><span class="s2">respond</span><span class="s4">(</span><span class="s2">staticContext</span><span class="s4">) : </span><span class="s2">staticContext</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">});</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">notFoundMatches</span><span class="s4">, </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">getShortCircuitMatches</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">staticContext </span><span class="s4">= {</span>
        <span class="s2">basename</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">: </span><span class="s2">notFoundMatches</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">: {},</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">errors</span><span class="s4">: {</span>
          <span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">error</span>
        <span class="s4">},</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">loaderHeaders</span><span class="s4">: {},</span>
        <span class="s2">actionHeaders</span><span class="s4">: {}</span>
      <span class="s4">};</span>
      <span class="s3">return </span><span class="s2">respond </span><span class="s4">? </span><span class="s2">respond</span><span class="s4">(</span><span class="s2">staticContext</span><span class="s4">) : </span><span class="s2">staticContext</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">respond </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">unstable_middleware </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">.</span><span class="s2">unstable_middleware</span>
    <span class="s4">)) {</span>
      <span class="s2">invariant</span><span class="s4">(</span>
        <span class="s2">requestContext </span><span class="s3">instanceof </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">,</span>
        <span class="s5">&quot;When using middleware in `staticHandler.query()`, any provided `requestContext` must be an instance of `unstable_RouterContextProvider`&quot;</span>
      <span class="s4">);</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">loadLazyMiddlewareForMatches</span><span class="s4">(</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">mapRouteProperties2</span>
        <span class="s4">);</span>
        <span class="s3">let </span><span class="s2">renderedStaticContext</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">runMiddlewarePipeline</span><span class="s4">(</span>
          <span class="s4">{</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">params</span><span class="s4">: </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">,</span>
            <span class="s6">// If we're calling middleware then it must be enabled so we can cast</span>
            <span class="s6">// this to the proper type knowing it's not an `AppLoadContext`</span>
            <span class="s2">context</span><span class="s4">: </span><span class="s2">requestContext</span>
          <span class="s4">},</span>
          <span class="s3">true</span><span class="s4">,</span>
          <span class="s2">async </span><span class="s4">() =&gt; {</span>
            <span class="s3">let </span><span class="s2">result2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">queryImpl</span><span class="s4">(</span>
              <span class="s2">request</span><span class="s4">,</span>
              <span class="s2">location</span><span class="s4">,</span>
              <span class="s2">matches</span><span class="s4">,</span>
              <span class="s2">requestContext</span><span class="s4">,</span>
              <span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
              <span class="s2">skipLoaderErrorBubbling </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
              <span class="s3">null</span><span class="s4">,</span>
              <span class="s2">filterMatchesToLoad </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
              <span class="s2">skipRevalidation </span><span class="s4">=== </span><span class="s3">true</span>
            <span class="s4">);</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">)) {</span>
              <span class="s3">return </span><span class="s2">result2</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s2">renderedStaticContext </span><span class="s4">= { </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">...result2 </span><span class="s4">};</span>
            <span class="s3">let </span><span class="s2">res </span><span class="s4">= </span><span class="s3">await </span><span class="s2">respond</span><span class="s4">(</span><span class="s2">renderedStaticContext</span><span class="s4">);</span>
            <span class="s3">return </span><span class="s2">res</span><span class="s4">;</span>
          <span class="s4">},</span>
          <span class="s2">async </span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) =&gt; {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)) {</span>
              <span class="s3">return </span><span class="s2">error</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">renderedStaticContext</span><span class="s4">) {</span>
              <span class="s3">if </span><span class="s4">(</span><span class="s2">routeId </span><span class="s3">in </span><span class="s2">renderedStaticContext</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">) {</span>
                <span class="s2">renderedStaticContext</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
              <span class="s4">}</span>
              <span class="s3">return </span><span class="s2">respond</span><span class="s4">(</span>
                <span class="s2">getStaticContextFromError</span><span class="s4">(</span>
                  <span class="s2">dataRoutes</span><span class="s4">,</span>
                  <span class="s2">renderedStaticContext</span><span class="s4">,</span>
                  <span class="s2">error</span><span class="s4">,</span>
                  <span class="s2">skipLoaderErrorBubbling </span><span class="s4">? </span><span class="s2">routeId </span><span class="s4">: </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">).</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
                <span class="s4">)</span>
              <span class="s4">);</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s3">let </span><span class="s2">boundaryRouteId </span><span class="s4">= </span><span class="s2">skipLoaderErrorBubbling </span><span class="s4">? </span><span class="s2">routeId </span><span class="s4">: </span><span class="s2">findNearestBoundary</span><span class="s4">(</span>
                <span class="s2">matches</span><span class="s4">,</span>
                <span class="s2">matches</span><span class="s4">.</span><span class="s2">find</span><span class="s4">(</span>
                  <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">routeId </span><span class="s4">|| </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span>
                <span class="s4">)?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">|| </span><span class="s2">routeId</span>
              <span class="s4">).</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
              <span class="s3">return </span><span class="s2">respond</span><span class="s4">({</span>
                <span class="s2">matches</span><span class="s4">,</span>
                <span class="s2">location</span><span class="s4">,</span>
                <span class="s2">basename</span><span class="s4">,</span>
                <span class="s2">loaderData</span><span class="s4">: {},</span>
                <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
                <span class="s2">errors</span><span class="s4">: {</span>
                  <span class="s4">[</span><span class="s2">boundaryRouteId</span><span class="s4">]: </span><span class="s2">error</span>
                <span class="s4">},</span>
                <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) ? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
                <span class="s2">actionHeaders</span><span class="s4">: {},</span>
                <span class="s2">loaderHeaders</span><span class="s4">: {}</span>
              <span class="s4">});</span>
            <span class="s4">}</span>
          <span class="s4">}</span>
        <span class="s4">);</span>
        <span class="s2">invariant</span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">), </span><span class="s5">&quot;Expected a response in query()&quot;</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">e</span><span class="s4">)) {</span>
          <span class="s3">return </span><span class="s2">e</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">throw </span><span class="s2">e</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">queryImpl</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">,</span>
      <span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">skipLoaderErrorBubbling </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s3">null</span><span class="s4">,</span>
      <span class="s2">filterMatchesToLoad </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">skipRevalidation </span><span class="s4">=== </span><span class="s3">true</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">...result </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">queryRoute</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, {</span>
    <span class="s2">routeId</span><span class="s4">,</span>
    <span class="s2">requestContext</span><span class="s4">,</span>
    <span class="s2">dataStrategy</span><span class="s4">,</span>
    <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">respond</span>
  <span class="s4">} = {}) {</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">method </span><span class="s4">= </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">createLocation</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">url</span><span class="s4">), </span><span class="s3">null</span><span class="s4">, </span><span class="s5">&quot;default&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s2">requestContext </span><span class="s4">= </span><span class="s2">requestContext </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">requestContext </span><span class="s4">: </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">();</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isValidMethod</span><span class="s4">(</span><span class="s2">method</span><span class="s4">) &amp;&amp; </span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;HEAD&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;OPTIONS&quot;</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, { </span><span class="s2">method </span><span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">match </span><span class="s4">= </span><span class="s2">routeId </span><span class="s4">? </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">find</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">routeId</span><span class="s4">) : </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">location</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routeId </span><span class="s4">&amp;&amp; !</span><span class="s2">match</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">403</span><span class="s4">, {</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">routeId</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">respond </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">unstable_middleware </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">.</span><span class="s2">unstable_middleware</span>
    <span class="s4">)) {</span>
      <span class="s2">invariant</span><span class="s4">(</span>
        <span class="s2">requestContext </span><span class="s3">instanceof </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">,</span>
        <span class="s5">&quot;When using middleware in `staticHandler.queryRoute()`, any provided `requestContext` must be an instance of `unstable_RouterContextProvider`&quot;</span>
      <span class="s4">);</span>
      <span class="s3">await </span><span class="s2">loadLazyMiddlewareForMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">runMiddlewarePipeline</span><span class="s4">(</span>
        <span class="s4">{</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">params</span><span class="s4">: </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">,</span>
          <span class="s6">// If we're calling middleware then it must be enabled so we can cast</span>
          <span class="s6">// this to the proper type knowing it's not an `AppLoadContext`</span>
          <span class="s2">context</span><span class="s4">: </span><span class="s2">requestContext</span>
        <span class="s4">},</span>
        <span class="s3">true</span><span class="s4">,</span>
        <span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">let </span><span class="s2">result2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">queryImpl</span><span class="s4">(</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">location</span><span class="s4">,</span>
            <span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">requestContext</span><span class="s4">,</span>
            <span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
            <span class="s3">false</span><span class="s4">,</span>
            <span class="s2">match</span><span class="s4">,</span>
            <span class="s3">null</span><span class="s4">,</span>
            <span class="s3">false</span>
          <span class="s4">);</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">)) {</span>
            <span class="s3">return </span><span class="s2">respond</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">);</span>
          <span class="s4">}</span>
          <span class="s3">let </span><span class="s2">error2 </span><span class="s4">= </span><span class="s2">result2</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">? </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">error2 </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
            <span class="s3">throw </span><span class="s2">error2</span><span class="s4">;</span>
          <span class="s4">}</span>
          <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">result2</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">? </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">] : </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result2</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">];</span>
          <span class="s3">return typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Response</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) : </span><span class="s2">Response</span><span class="s4">.</span><span class="s2">json</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
        <span class="s4">},</span>
        <span class="s4">(</span><span class="s2">error2</span><span class="s4">) =&gt; {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">error2</span><span class="s4">)) {</span>
            <span class="s3">return </span><span class="s2">respond</span><span class="s4">(</span><span class="s2">error2</span><span class="s4">);</span>
          <span class="s4">}</span>
          <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s2">String</span><span class="s4">(</span><span class="s2">error2</span><span class="s4">), {</span>
            <span class="s2">status</span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
            <span class="s2">statusText</span><span class="s4">: </span><span class="s5">&quot;Unexpected Server Error&quot;</span>
          <span class="s4">});</span>
        <span class="s4">}</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">queryImpl</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">,</span>
      <span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s3">null</span><span class="s4">,</span>
      <span class="s3">false</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">? </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">];</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">];</span>
    <span class="s4">}</span>
    <span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">queryImpl</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">requestContext</span><span class="s4">, </span><span class="s2">dataStrategy</span><span class="s4">, </span><span class="s2">skipLoaderErrorBubbling</span><span class="s4">, </span><span class="s2">routeMatch</span><span class="s4">, </span><span class="s2">filterMatchesToLoad</span><span class="s4">, </span><span class="s2">skipRevalidation</span><span class="s4">) {</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
      <span class="s5">&quot;query()/queryRoute() requests must contain an AbortController signal&quot;</span>
    <span class="s4">);</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">)) {</span>
        <span class="s3">let </span><span class="s2">result2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">submit</span><span class="s4">(</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">routeMatch </span><span class="s4">|| </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">location</span><span class="s4">),</span>
          <span class="s2">requestContext</span><span class="s4">,</span>
          <span class="s2">dataStrategy</span><span class="s4">,</span>
          <span class="s2">skipLoaderErrorBubbling</span><span class="s4">,</span>
          <span class="s2">routeMatch </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
          <span class="s2">filterMatchesToLoad</span><span class="s4">,</span>
          <span class="s2">skipRevalidation</span>
        <span class="s4">);</span>
        <span class="s3">return </span><span class="s2">result2</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">loadRouteData</span><span class="s4">(</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">requestContext</span><span class="s4">,</span>
        <span class="s2">dataStrategy</span><span class="s4">,</span>
        <span class="s2">skipLoaderErrorBubbling</span><span class="s4">,</span>
        <span class="s2">routeMatch</span><span class="s4">,</span>
        <span class="s2">filterMatchesToLoad</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) ? </span><span class="s2">result </span><span class="s4">: {</span>
        <span class="s2">...result</span><span class="s4">,</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">actionHeaders</span><span class="s4">: {}</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isDataStrategyResult</span><span class="s4">(</span><span class="s2">e</span><span class="s4">) &amp;&amp; </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">e</span><span class="s4">.</span><span class="s2">result</span><span class="s4">)) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">e</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">) {</span>
          <span class="s3">throw </span><span class="s2">e</span><span class="s4">.</span><span class="s2">result</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">return </span><span class="s2">e</span><span class="s4">.</span><span class="s2">result</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResponse</span><span class="s4">(</span><span class="s2">e</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">e</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">throw </span><span class="s2">e</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">submit</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">actionMatch</span><span class="s4">, </span><span class="s2">requestContext</span><span class="s4">, </span><span class="s2">dataStrategy</span><span class="s4">, </span><span class="s2">skipLoaderErrorBubbling</span><span class="s4">, </span><span class="s2">isRouteRequest</span><span class="s4">, </span><span class="s2">filterMatchesToLoad</span><span class="s4">, </span><span class="s2">skipRevalidation</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">result</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">&amp;&amp; !</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, {</span>
        <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">).</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">: </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
      <span class="s4">});</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteRequest</span><span class="s4">) {</span>
        <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">result </span><span class="s4">= {</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
        <span class="s2">error</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
        <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">actionMatch</span><span class="s4">,</span>
        <span class="s4">[],</span>
        <span class="s2">requestContext</span>
      <span class="s4">);</span>
      <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">dsMatches</span><span class="s4">,</span>
        <span class="s2">isRouteRequest</span><span class="s4">,</span>
        <span class="s2">requestContext</span><span class="s4">,</span>
        <span class="s2">dataStrategy</span>
      <span class="s4">);</span>
      <span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
        <span class="s2">throwStaticHandlerAbortedError</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">isRouteRequest</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">throw new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, {</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">: {</span>
          <span class="s2">Location</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">)</span>
        <span class="s4">}</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteRequest</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
        <span class="s3">throw </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">matches</span><span class="s4">: [</span><span class="s2">actionMatch</span><span class="s4">],</span>
        <span class="s2">loaderData</span><span class="s4">: {},</span>
        <span class="s2">actionData</span><span class="s4">: { [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data </span><span class="s4">},</span>
        <span class="s2">errors</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s6">// Note: statusCode + headers are unused here since queryRoute will</span>
        <span class="s6">// return the raw Response or value</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s7">200</span><span class="s4">,</span>
        <span class="s2">loaderHeaders</span><span class="s4">: {},</span>
        <span class="s2">actionHeaders</span><span class="s4">: {}</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">skipRevalidation</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
        <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">skipLoaderErrorBubbling </span><span class="s4">? </span><span class="s2">actionMatch </span><span class="s4">: </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) ? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
          <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
          <span class="s2">actionHeaders</span><span class="s4">: {</span>
            <span class="s2">...result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">? { [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">} : {}</span>
          <span class="s4">},</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s2">errors</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span>
          <span class="s4">},</span>
          <span class="s2">loaderHeaders</span><span class="s4">: {}</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">actionData</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span>
          <span class="s4">},</span>
          <span class="s2">actionHeaders</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">? { [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">} : {},</span>
          <span class="s2">matches</span><span class="s4">,</span>
          <span class="s2">loaderData</span><span class="s4">: {},</span>
          <span class="s2">errors</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
          <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">|| </span><span class="s7">200</span><span class="s4">,</span>
          <span class="s2">loaderHeaders</span><span class="s4">: {}</span>
        <span class="s4">};</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">loaderRequest </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">, {</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
      <span class="s2">redirect</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">redirect</span><span class="s4">,</span>
      <span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">skipLoaderErrorBubbling </span><span class="s4">? </span><span class="s2">actionMatch </span><span class="s4">: </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">handlerContext2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">loadRouteData</span><span class="s4">(</span>
        <span class="s2">loaderRequest</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">requestContext</span><span class="s4">,</span>
        <span class="s2">dataStrategy</span><span class="s4">,</span>
        <span class="s2">skipLoaderErrorBubbling</span><span class="s4">,</span>
        <span class="s3">null</span><span class="s4">,</span>
        <span class="s2">filterMatchesToLoad</span><span class="s4">,</span>
        <span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">, </span><span class="s2">result</span><span class="s4">]</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">...handlerContext2</span><span class="s4">,</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) ? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">actionHeaders</span><span class="s4">: {</span>
          <span class="s2">...result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">? { [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">} : {}</span>
        <span class="s4">}</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">handlerContext </span><span class="s4">= </span><span class="s3">await </span><span class="s2">loadRouteData</span><span class="s4">(</span>
      <span class="s2">loaderRequest</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">,</span>
      <span class="s2">dataStrategy</span><span class="s4">,</span>
      <span class="s2">skipLoaderErrorBubbling</span><span class="s4">,</span>
      <span class="s3">null</span><span class="s4">,</span>
      <span class="s2">filterMatchesToLoad</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">...handlerContext</span><span class="s4">,</span>
      <span class="s2">actionData</span><span class="s4">: {</span>
        <span class="s4">[</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span>
      <span class="s4">},</span>
      <span class="s6">// action status codes take precedence over loader status codes</span>
      <span class="s2">...result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">? { </span><span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">} : {},</span>
      <span class="s2">actionHeaders</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">? { [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">} : {}</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">loadRouteData</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">requestContext</span><span class="s4">, </span><span class="s2">dataStrategy</span><span class="s4">, </span><span class="s2">skipLoaderErrorBubbling</span><span class="s4">, </span><span class="s2">routeMatch</span><span class="s4">, </span><span class="s2">filterMatchesToLoad</span><span class="s4">, </span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">isRouteRequest </span><span class="s4">= </span><span class="s2">routeMatch </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteRequest </span><span class="s4">&amp;&amp; !</span><span class="s2">routeMatch</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">&amp;&amp; !</span><span class="s2">routeMatch</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">400</span><span class="s4">, {</span>
        <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">).</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">: </span><span class="s2">routeMatch</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">dsMatches</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routeMatch</span><span class="s4">) {</span>
      <span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
        <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">routeMatch</span><span class="s4">,</span>
        <span class="s4">[],</span>
        <span class="s2">requestContext</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">maxIdx </span><span class="s4">= </span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? (</span>
        <span class="s6">// Up to but not including the boundary</span>
        <span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]) - </span><span class="s7">1</span>
      <span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">maxIdx </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">index </span><span class="s4">&gt; </span><span class="s2">maxIdx</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span>
            <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
            <span class="s2">manifest</span><span class="s4">,</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">match</span><span class="s4">,</span>
            <span class="s4">[],</span>
            <span class="s2">requestContext</span><span class="s4">,</span>
            <span class="s3">false</span>
          <span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">return </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span>
          <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">match</span><span class="s4">,</span>
          <span class="s4">[],</span>
          <span class="s2">requestContext</span><span class="s4">,</span>
          <span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) != </span><span class="s3">null </span><span class="s4">&amp;&amp; (!</span><span class="s2">filterMatchesToLoad </span><span class="s4">|| </span><span class="s2">filterMatchesToLoad</span><span class="s4">(</span><span class="s2">match</span><span class="s4">))</span>
        <span class="s4">);</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">dataStrategy </span><span class="s4">&amp;&amp; !</span><span class="s2">dsMatches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">shouldLoad</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">: {},</span>
        <span class="s2">errors</span><span class="s4">: </span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? {</span>
          <span class="s4">[</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]]: </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">error</span>
        <span class="s4">} : </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s7">200</span><span class="s4">,</span>
        <span class="s2">loaderHeaders</span><span class="s4">: {}</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategy</span><span class="s4">(</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">dsMatches</span><span class="s4">,</span>
      <span class="s2">isRouteRequest</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">,</span>
      <span class="s2">dataStrategy</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s2">throwStaticHandlerAbortedError</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">isRouteRequest</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">handlerContext </span><span class="s4">= </span><span class="s2">processRouteLoaderData</span><span class="s4">(</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">results</span><span class="s4">,</span>
      <span class="s2">pendingActionResult</span><span class="s4">,</span>
      <span class="s3">true</span><span class="s4">,</span>
      <span class="s2">skipLoaderErrorBubbling</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">...handlerContext</span><span class="s4">,</span>
      <span class="s2">matches</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">callDataStrategy</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">isRouteRequest</span><span class="s4">, </span><span class="s2">requestContext</span><span class="s4">, </span><span class="s2">dataStrategy</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callDataStrategyImpl</span><span class="s4">(</span>
      <span class="s2">dataStrategy </span><span class="s4">|| </span><span class="s2">defaultDataStrategy</span><span class="s4">,</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s3">null</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">,</span>
      <span class="s3">true</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">dataResults </span><span class="s4">= {};</span>
    <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
      <span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(!(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">results</span><span class="s4">)) {</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectDataStrategyResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
          <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">;</span>
          <span class="s3">throw </span><span class="s2">normalizeRelativeRoutingRedirectResponse</span><span class="s4">(</span>
            <span class="s2">response</span><span class="s4">,</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
            <span class="s2">matches</span><span class="s4">,</span>
            <span class="s2">basename</span>
          <span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">) &amp;&amp; </span><span class="s2">isRouteRequest</span><span class="s4">) {</span>
          <span class="s3">throw </span><span class="s2">result</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s2">dataResults</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s3">await </span><span class="s2">convertDataStrategyResultToDataResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">);</span>
      <span class="s4">})</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">dataResults</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">dataRoutes</span><span class="s4">,</span>
    <span class="s2">query</span><span class="s4">,</span>
    <span class="s2">queryRoute</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getStaticContextFromError</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">handlerContext</span><span class="s4">, </span><span class="s2">error</span><span class="s4">, </span><span class="s2">boundaryId</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">errorBoundaryId </span><span class="s4">= </span><span class="s2">boundaryId </span><span class="s4">|| </span><span class="s2">handlerContext</span><span class="s4">.</span><span class="s2">_deepestRenderedBoundaryId </span><span class="s4">|| </span><span class="s2">routes</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">id</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">...handlerContext</span><span class="s4">,</span>
    <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) ? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
    <span class="s2">errors</span><span class="s4">: {</span>
      <span class="s4">[</span><span class="s2">errorBoundaryId</span><span class="s4">]: </span><span class="s2">error</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">throwStaticHandlerAbortedError</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">isRouteRequest</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">reason </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">throw </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">reason</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">method </span><span class="s4">= </span><span class="s2">isRouteRequest </span><span class="s4">? </span><span class="s5">&quot;queryRoute&quot; </span><span class="s4">: </span><span class="s5">&quot;query&quot;</span><span class="s4">;</span>
  <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
    <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">method</span><span class="s4">}</span><span class="s5">() call aborted without an </span><span class="s3">\`</span><span class="s5">AbortSignal.reason</span><span class="s3">\`</span><span class="s5">: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">}</span><span class="s5">`</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isSubmissionNavigation</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">opts </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; (</span><span class="s5">&quot;formData&quot; </span><span class="s3">in </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formData </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">|| </span><span class="s5">&quot;body&quot; </span><span class="s3">in </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">normalizeTo</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">to</span><span class="s4">, </span><span class="s2">fromRouteId</span><span class="s4">, </span><span class="s2">relative</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">contextualMatches</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">activeRouteMatch</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">fromRouteId</span><span class="s4">) {</span>
    <span class="s2">contextualMatches </span><span class="s4">= [];</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of matches</span><span class="s4">) {</span>
      <span class="s2">contextualMatches</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">match</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">fromRouteId</span><span class="s4">) {</span>
        <span class="s2">activeRouteMatch </span><span class="s4">= </span><span class="s2">match</span><span class="s4">;</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">contextualMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s2">activeRouteMatch </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">resolveTo</span><span class="s4">(</span>
    <span class="s2">to </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s5">&quot;.&quot;</span><span class="s4">,</span>
    <span class="s2">getResolveToMatches</span><span class="s4">(</span><span class="s2">contextualMatches</span><span class="s4">),</span>
    <span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">relative </span><span class="s4">=== </span><span class="s5">&quot;path&quot;</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">to </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">((</span><span class="s2">to </span><span class="s4">== </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">|| </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;.&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">activeRouteMatch</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">nakedIndex </span><span class="s4">= </span><span class="s2">hasNakedIndexQuery</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">search</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">activeRouteMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">&amp;&amp; !</span><span class="s2">nakedIndex</span><span class="s4">) {</span>
      <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">? </span><span class="s2">path</span><span class="s4">.</span><span class="s2">search</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\?/</span><span class="s4">, </span><span class="s5">&quot;?index&amp;&quot;</span><span class="s4">) : </span><span class="s5">&quot;?index&quot;</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">activeRouteMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">&amp;&amp; </span><span class="s2">nakedIndex</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">params </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">search</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">indexValues </span><span class="s4">= </span><span class="s2">params</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
      <span class="s2">params</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
      <span class="s2">indexValues</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">v</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">params</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">, </span><span class="s2">v</span><span class="s4">));</span>
      <span class="s3">let </span><span class="s2">qs </span><span class="s4">= </span><span class="s2">params</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">();</span>
      <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">qs </span><span class="s4">? </span><span class="s5">`?</span><span class="s2">$</span><span class="s4">{</span><span class="s2">qs</span><span class="s4">}</span><span class="s5">` </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">basename </span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">]);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">normalizeNavigateOptions</span><span class="s4">(</span><span class="s2">isFetcher</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">opts </span><span class="s4">|| !</span><span class="s2">isSubmissionNavigation</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">path </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formMethod </span><span class="s4">&amp;&amp; !</span><span class="s2">isValidMethod</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">error</span><span class="s4">: </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, { </span><span class="s2">method</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formMethod </span><span class="s4">})</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">getInvalidBodyError </span><span class="s4">= () =&gt; ({</span>
    <span class="s2">path</span><span class="s4">,</span>
    <span class="s2">error</span><span class="s4">: </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">400</span><span class="s4">, { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;invalid-body&quot; </span><span class="s4">})</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">rawFormMethod </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formMethod </span><span class="s4">|| </span><span class="s5">&quot;get&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">formMethod </span><span class="s4">= </span><span class="s2">rawFormMethod</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">formAction </span><span class="s4">= </span><span class="s2">stripHashFromPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formEncType </span><span class="s4">=== </span><span class="s5">&quot;text/plain&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">formMethod</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">getInvalidBodyError</span><span class="s4">();</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">text </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s3">instanceof </span><span class="s2">FormData </span><span class="s4">|| </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s3">instanceof </span><span class="s2">URLSearchParams </span><span class="s4">? (</span>
        <span class="s6">// https://html.spec.whatwg.org/multipage/form-control-infrastructure.html#plain-text-form-data</span>
        <span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">()).</span><span class="s2">reduce</span><span class="s4">(</span>
          <span class="s4">(</span><span class="s2">acc</span><span class="s4">, [</span><span class="s2">name</span><span class="s4">, </span><span class="s2">value</span><span class="s4">]) =&gt; </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">acc</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">}</span><span class="s5">=</span><span class="s2">$</span><span class="s4">{</span><span class="s2">value</span><span class="s4">}</span>
<span class="s5">`</span><span class="s4">,</span>
          <span class="s5">&quot;&quot;</span>
        <span class="s4">)</span>
      <span class="s4">) : </span><span class="s2">String</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">path</span><span class="s4">,</span>
        <span class="s2">submission</span><span class="s4">: {</span>
          <span class="s2">formMethod</span><span class="s4">,</span>
          <span class="s2">formAction</span><span class="s4">,</span>
          <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
          <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
          <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
          <span class="s2">text</span>
        <span class="s4">}</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formEncType </span><span class="s4">=== </span><span class="s5">&quot;application/json&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">formMethod</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">getInvalidBodyError</span><span class="s4">();</span>
      <span class="s4">}</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">json </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">) : </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">;</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">path</span><span class="s4">,</span>
          <span class="s2">submission</span><span class="s4">: {</span>
            <span class="s2">formMethod</span><span class="s4">,</span>
            <span class="s2">formAction</span><span class="s4">,</span>
            <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
            <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
            <span class="s2">json</span><span class="s4">,</span>
            <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
          <span class="s4">}</span>
        <span class="s4">};</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">getInvalidBodyError</span><span class="s4">();</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s3">typeof </span><span class="s2">FormData </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">,</span>
    <span class="s5">&quot;FormData is not available in this environment&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">searchParams</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">formData</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">) {</span>
    <span class="s2">searchParams </span><span class="s4">= </span><span class="s2">convertFormDataToSearchParams</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">);</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s3">instanceof </span><span class="s2">FormData</span><span class="s4">) {</span>
    <span class="s2">searchParams </span><span class="s4">= </span><span class="s2">convertFormDataToSearchParams</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">);</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s3">instanceof </span><span class="s2">URLSearchParams</span><span class="s4">) {</span>
    <span class="s2">searchParams </span><span class="s4">= </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">;</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s2">convertSearchParamsToFormData</span><span class="s4">(</span><span class="s2">searchParams</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">searchParams </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">();</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s3">new </span><span class="s2">FormData</span><span class="s4">();</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s2">searchParams </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">.</span><span class="s2">body</span><span class="s4">);</span>
      <span class="s2">formData </span><span class="s4">= </span><span class="s2">convertSearchParamsToFormData</span><span class="s4">(</span><span class="s2">searchParams</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">getInvalidBodyError</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">submission </span><span class="s4">= {</span>
    <span class="s2">formMethod</span><span class="s4">,</span>
    <span class="s2">formAction</span><span class="s4">,</span>
    <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">opts </span><span class="s4">&amp;&amp; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">formEncType </span><span class="s4">|| </span><span class="s5">&quot;application/x-www-form-urlencoded&quot;</span><span class="s4">,</span>
    <span class="s2">formData</span><span class="s4">,</span>
    <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">path</span><span class="s4">, </span><span class="s2">submission </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">parsedPath </span><span class="s4">= </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isFetcher </span><span class="s4">&amp;&amp; </span><span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">search </span><span class="s4">&amp;&amp; </span><span class="s2">hasNakedIndexQuery</span><span class="s4">(</span><span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">search</span><span class="s4">)) {</span>
    <span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">parsedPath</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s5">`?</span><span class="s2">$</span><span class="s4">{</span><span class="s2">searchParams</span><span class="s4">}</span><span class="s5">`</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">path</span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">parsedPath</span><span class="s4">), </span><span class="s2">submission </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getMatchesToLoad</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">history</span><span class="s4">, </span><span class="s2">state</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">, </span><span class="s2">initialHydration</span><span class="s4">, </span><span class="s2">isRevalidationRequired</span><span class="s4">, </span><span class="s2">cancelledFetcherLoads</span><span class="s4">, </span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">, </span><span class="s2">fetchLoadMatches</span><span class="s4">, </span><span class="s2">fetchRedirectIds</span><span class="s4">, </span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">actionResult </span><span class="s4">= </span><span class="s2">pendingActionResult </span><span class="s4">? </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">error </span><span class="s4">: </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">data </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">currentUrl </span><span class="s4">= </span><span class="s2">history</span><span class="s4">.</span><span class="s2">createURL</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">nextUrl </span><span class="s4">= </span><span class="s2">history</span><span class="s4">.</span><span class="s2">createURL</span><span class="s4">(</span><span class="s2">location</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">maxIdx</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">initialHydration </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">boundaryId </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">];</span>
    <span class="s2">maxIdx </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">boundaryId</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">])) {</span>
    <span class="s3">let </span><span class="s2">boundaryId </span><span class="s4">= </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">];</span>
    <span class="s2">maxIdx </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">boundaryId</span><span class="s4">) - </span><span class="s7">1</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">actionStatus </span><span class="s4">= </span><span class="s2">pendingActionResult </span><span class="s4">? </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">statusCode </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">shouldSkipRevalidation </span><span class="s4">= </span><span class="s2">actionStatus </span><span class="s4">&amp;&amp; </span><span class="s2">actionStatus </span><span class="s4">&gt;= </span><span class="s7">400</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">baseShouldRevalidateArgs </span><span class="s4">= {</span>
    <span class="s2">currentUrl</span><span class="s4">,</span>
    <span class="s2">currentParams</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]?.</span><span class="s2">params </span><span class="s4">|| {},</span>
    <span class="s2">nextUrl</span><span class="s4">,</span>
    <span class="s2">nextParams</span><span class="s4">: </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">,</span>
    <span class="s2">...submission</span><span class="s4">,</span>
    <span class="s2">actionResult</span><span class="s4">,</span>
    <span class="s2">actionStatus</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">dsMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">route </span><span class="s4">} = </span><span class="s2">match</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">maxIdx </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">index </span><span class="s4">&gt; </span><span class="s2">maxIdx</span><span class="s4">) {</span>
      <span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
      <span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">initialHydration</span><span class="s4">) {</span>
      <span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s2">shouldLoadRouteOnHydration</span><span class="s4">(</span>
        <span class="s2">route</span><span class="s4">,</span>
        <span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
        <span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isNewLoader</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">], </span><span class="s2">match</span><span class="s4">)) {</span>
      <span class="s2">forceShouldLoad </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">forceShouldLoad </span><span class="s4">!== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span>
        <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">match</span><span class="s4">,</span>
        <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
        <span class="s2">scopedContext</span><span class="s4">,</span>
        <span class="s2">forceShouldLoad</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">defaultShouldRevalidate </span><span class="s4">= </span><span class="s2">shouldSkipRevalidation </span><span class="s4">? </span><span class="s3">false </span><span class="s4">: (</span>
      <span class="s6">// Forced revalidation due to submission, useRevalidator, or X-Remix-Revalidate</span>
      <span class="s2">isRevalidationRequired </span><span class="s4">|| </span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">search </span><span class="s4">=== </span><span class="s2">nextUrl</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">nextUrl</span><span class="s4">.</span><span class="s2">search </span><span class="s4">|| </span><span class="s6">// Search params affect all loaders</span>
      <span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">search </span><span class="s4">!== </span><span class="s2">nextUrl</span><span class="s4">.</span><span class="s2">search </span><span class="s4">|| </span><span class="s2">isNewRouteInstance</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">], </span><span class="s2">match</span><span class="s4">)</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">shouldRevalidateArgs </span><span class="s4">= {</span>
      <span class="s2">...baseShouldRevalidateArgs</span><span class="s4">,</span>
      <span class="s2">defaultShouldRevalidate</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">shouldLoad </span><span class="s4">= </span><span class="s2">shouldRevalidateLoader</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">shouldRevalidateArgs</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s2">shouldLoad</span><span class="s4">,</span>
      <span class="s2">shouldRevalidateArgs</span>
    <span class="s4">);</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">revalidatingFetchers </span><span class="s4">= [];</span>
  <span class="s2">fetchLoadMatches</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">f</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">initialHydration </span><span class="s4">|| !</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">f</span><span class="s4">.</span><span class="s2">routeId</span><span class="s4">) || </span><span class="s2">fetchersQueuedForDeletion</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">fetcherMatches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">f</span><span class="s4">.</span><span class="s2">path</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">fetcherMatches</span><span class="s4">) {</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
        <span class="s2">key</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">: </span><span class="s2">f</span><span class="s4">.</span><span class="s2">routeId</span><span class="s4">,</span>
        <span class="s2">path</span><span class="s4">: </span><span class="s2">f</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">match</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">controller</span><span class="s4">: </span><span class="s3">null</span>
      <span class="s4">});</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetchRedirectIds</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">fetcherMatch </span><span class="s4">= </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">fetcherMatches</span><span class="s4">, </span><span class="s2">f</span><span class="s4">.</span><span class="s2">path</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">fetchController </span><span class="s4">= </span><span class="s3">new </span><span class="s2">AbortController</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">fetchRequest </span><span class="s4">= </span><span class="s2">createClientSideRequest</span><span class="s4">(</span>
      <span class="s2">history</span><span class="s4">,</span>
      <span class="s2">f</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">fetchController</span><span class="s4">.</span><span class="s2">signal</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">fetcherDsMatches </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">cancelledFetcherLoads</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s2">cancelledFetcherLoads</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s2">fetcherDsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
        <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">fetchRequest</span><span class="s4">,</span>
        <span class="s2">fetcherMatches</span><span class="s4">,</span>
        <span class="s2">fetcherMatch</span><span class="s4">,</span>
        <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
        <span class="s2">scopedContext</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">fetcher </span><span class="s4">&amp;&amp; </span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">state </span><span class="s4">!== </span><span class="s5">&quot;idle&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">data </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRevalidationRequired</span><span class="s4">) {</span>
        <span class="s2">fetcherDsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
          <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">fetchRequest</span><span class="s4">,</span>
          <span class="s2">fetcherMatches</span><span class="s4">,</span>
          <span class="s2">fetcherMatch</span><span class="s4">,</span>
          <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
          <span class="s2">scopedContext</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">shouldRevalidateArgs </span><span class="s4">= {</span>
        <span class="s2">...baseShouldRevalidateArgs</span><span class="s4">,</span>
        <span class="s2">defaultShouldRevalidate</span><span class="s4">: </span><span class="s2">shouldSkipRevalidation </span><span class="s4">? </span><span class="s3">false </span><span class="s4">: </span><span class="s2">isRevalidationRequired</span>
      <span class="s4">};</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">shouldRevalidateLoader</span><span class="s4">(</span><span class="s2">fetcherMatch</span><span class="s4">, </span><span class="s2">shouldRevalidateArgs</span><span class="s4">)) {</span>
        <span class="s2">fetcherDsMatches </span><span class="s4">= </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span>
          <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">fetchRequest</span><span class="s4">,</span>
          <span class="s2">fetcherMatches</span><span class="s4">,</span>
          <span class="s2">fetcherMatch</span><span class="s4">,</span>
          <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
          <span class="s2">scopedContext</span><span class="s4">,</span>
          <span class="s2">shouldRevalidateArgs</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcherDsMatches</span><span class="s4">) {</span>
      <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
        <span class="s2">key</span><span class="s4">,</span>
        <span class="s2">routeId</span><span class="s4">: </span><span class="s2">f</span><span class="s4">.</span><span class="s2">routeId</span><span class="s4">,</span>
        <span class="s2">path</span><span class="s4">: </span><span class="s2">f</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">: </span><span class="s2">fetcherDsMatches</span><span class="s4">,</span>
        <span class="s2">match</span><span class="s4">: </span><span class="s2">fetcherMatch</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">: </span><span class="s2">fetchRequest</span><span class="s4">,</span>
        <span class="s2">controller</span><span class="s4">: </span><span class="s2">fetchController</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">dsMatches</span><span class="s4">, </span><span class="s2">revalidatingFetchers </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">shouldLoadRouteOnHydration</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">hasData </span><span class="s4">= </span><span class="s2">loaderData </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">loaderData</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">hasError </span><span class="s4">= </span><span class="s2">errors </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] !== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">hasData </span><span class="s4">&amp;&amp; </span><span class="s2">hasError</span><span class="s4">) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">.</span><span class="s2">hydrate </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">!</span><span class="s2">hasData </span><span class="s4">&amp;&amp; !</span><span class="s2">hasError</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isNewLoader</span><span class="s4">(</span><span class="s2">currentLoaderData</span><span class="s4">, </span><span class="s2">currentMatch</span><span class="s4">, </span><span class="s2">match</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">isNew </span><span class="s4">= (</span>
    <span class="s6">// [a] -&gt; [a, b]</span>
    <span class="s4">!</span><span class="s2">currentMatch </span><span class="s4">|| </span><span class="s6">// [a, b] -&gt; [a, c]</span>
    <span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">!== </span><span class="s2">currentMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">isMissingData </span><span class="s4">= !</span><span class="s2">currentLoaderData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">isNew </span><span class="s4">|| </span><span class="s2">isMissingData</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isNewRouteInstance</span><span class="s4">(</span><span class="s2">currentMatch</span><span class="s4">, </span><span class="s2">match</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">currentPath </span><span class="s4">= </span><span class="s2">currentMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">(</span>
    <span class="s6">// param change for this match, /users/123 -&gt; /users/456</span>
    <span class="s2">currentMatch</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">!== </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s6">// splat param changed, which is not present in match.path</span>
    <span class="s6">// e.g. /files/images/avatar.jpg -&gt; files/finances.xls</span>
    <span class="s2">currentPath </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">currentPath</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">currentMatch</span><span class="s4">.</span><span class="s2">params</span><span class="s4">[</span><span class="s5">&quot;*&quot;</span><span class="s4">] !== </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">[</span><span class="s5">&quot;*&quot;</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">shouldRevalidateLoader</span><span class="s4">(</span><span class="s2">loaderMatch</span><span class="s4">, </span><span class="s2">arg</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">loaderMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">routeChoice </span><span class="s4">= </span><span class="s2">loaderMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">(</span><span class="s2">arg</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">routeChoice </span><span class="s4">=== </span><span class="s5">&quot;boolean&quot;</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">routeChoice</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">arg</span><span class="s4">.</span><span class="s2">defaultShouldRevalidate</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">patchRoutesImpl</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">children</span><span class="s4">, </span><span class="s2">routesToUse</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">childrenToPatch</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">route</span><span class="s4">,</span>
      <span class="s5">`No route found to patch children into: routeId = </span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">`</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">) {</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= [];</span>
    <span class="s4">}</span>
    <span class="s2">childrenToPatch </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">childrenToPatch </span><span class="s4">= </span><span class="s2">routesToUse</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">uniqueChildren </span><span class="s4">= </span><span class="s2">children</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newRoute</span><span class="s4">) =&gt; !</span><span class="s2">childrenToPatch</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">existingRoute</span><span class="s4">) =&gt; </span><span class="s2">isSameRoute</span><span class="s4">(</span><span class="s2">newRoute</span><span class="s4">, </span><span class="s2">existingRoute</span><span class="s4">)</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">newRoutes </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
    <span class="s2">uniqueChildren</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
    <span class="s4">[</span><span class="s2">routeId </span><span class="s4">|| </span><span class="s5">&quot;_&quot;</span><span class="s4">, </span><span class="s5">&quot;patch&quot;</span><span class="s4">, </span><span class="s2">String</span><span class="s4">(</span><span class="s2">childrenToPatch</span><span class="s4">?.</span><span class="s2">length </span><span class="s4">|| </span><span class="s5">&quot;0&quot;</span><span class="s4">)],</span>
    <span class="s2">manifest</span>
  <span class="s4">);</span>
  <span class="s2">childrenToPatch</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...newRoutes</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isSameRoute</span><span class="s4">(</span><span class="s2">newRoute</span><span class="s4">, </span><span class="s2">existingRoute</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;id&quot; </span><span class="s3">in </span><span class="s2">newRoute </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;id&quot; </span><span class="s3">in </span><span class="s2">existingRoute </span><span class="s4">&amp;&amp; </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(!(</span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">index </span><span class="s4">=== </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">index </span><span class="s4">&amp;&amp; </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">path </span><span class="s4">=== </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">path </span><span class="s4">&amp;&amp; </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">caseSensitive </span><span class="s4">=== </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">)) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">((!</span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">|| </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">children</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) &amp;&amp; (!</span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">|| </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">children</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">)) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">children</span><span class="s4">.</span><span class="s2">every</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">aChild</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; </span><span class="s2">existingRoute</span><span class="s4">.</span><span class="s2">children</span><span class="s4">?.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">bChild</span><span class="s4">) =&gt; </span><span class="s2">isSameRoute</span><span class="s4">(</span><span class="s2">aChild</span><span class="s4">, </span><span class="s2">bChild</span><span class="s4">))</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">lazyRoutePropertyCache </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s4">();</span>
<span class="s3">var </span><span class="s2">loadLazyRouteProperty </span><span class="s4">= ({</span>
  <span class="s2">key</span><span class="s4">,</span>
  <span class="s2">route</span><span class="s4">,</span>
  <span class="s2">manifest</span><span class="s4">,</span>
  <span class="s2">mapRouteProperties</span><span class="s4">: </span><span class="s2">mapRouteProperties2</span>
<span class="s4">}) =&gt; {</span>
  <span class="s3">let </span><span class="s2">routeToUpdate </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s5">&quot;No route found in manifest&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">!== </span><span class="s5">&quot;object&quot;</span><span class="s4">) {</span>
    <span class="s3">return</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">lazyFn </span><span class="s4">= </span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">lazyFn</span><span class="s4">) {</span>
    <span class="s3">return</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">cache </span><span class="s4">= </span><span class="s2">lazyRoutePropertyCache</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">cache</span><span class="s4">) {</span>
    <span class="s2">cache </span><span class="s4">= {};</span>
    <span class="s2">lazyRoutePropertyCache</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s2">cache</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">cachedPromise </span><span class="s4">= </span><span class="s2">cache</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">cachedPromise</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">cachedPromise</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">propertyPromise </span><span class="s4">= (</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
    <span class="s3">let </span><span class="s2">isUnsupported </span><span class="s4">= </span><span class="s2">isUnsupportedLazyRouteObjectKey</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">staticRouteValue </span><span class="s4">= </span><span class="s2">routeToUpdate</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">isStaticallyDefined </span><span class="s4">= </span><span class="s2">staticRouteValue </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s2">key </span><span class="s4">!== </span><span class="s5">&quot;hasErrorBoundary&quot;</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isUnsupported</span><span class="s4">) {</span>
      <span class="s2">warning</span><span class="s4">(</span>
        <span class="s4">!</span><span class="s2">isUnsupported</span><span class="s4">,</span>
        <span class="s5">&quot;Route property &quot; </span><span class="s4">+ </span><span class="s2">key </span><span class="s4">+ </span><span class="s5">&quot; is not a supported lazy route property. This property will be ignored.&quot;</span>
      <span class="s4">);</span>
      <span class="s2">cache</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isStaticallyDefined</span><span class="s4">) {</span>
      <span class="s2">warning</span><span class="s4">(</span>
        <span class="s3">false</span><span class="s4">,</span>
        <span class="s5">`Route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">id</span><span class="s4">}</span><span class="s5">&quot; has a static property &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s5">&quot; defined. The lazy property will be ignored.`</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s3">await </span><span class="s2">lazyFn</span><span class="s4">();</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, { [</span><span class="s2">key</span><span class="s4">]: </span><span class="s2">value </span><span class="s4">});</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">));</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">=== </span><span class="s5">&quot;object&quot;</span><span class="s4">) {</span>
      <span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">).</span><span class="s2">every</span><span class="s4">((</span><span class="s2">value</span><span class="s4">) =&gt; </span><span class="s2">value </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">)) {</span>
        <span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">})();</span>
  <span class="s2">cache</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">propertyPromise</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">propertyPromise</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">lazyRouteFunctionCache </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">WeakMap</span><span class="s4">();</span>
<span class="s3">function </span><span class="s2">loadLazyRoute</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">type</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routeToUpdate </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s5">&quot;No route found in manifest&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">lazyRoutePromise</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">lazyHandlerPromise</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">cachedPromise </span><span class="s4">= </span><span class="s2">lazyRouteFunctionCache</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">cachedPromise</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">lazyRoutePromise</span><span class="s4">: </span><span class="s2">cachedPromise</span><span class="s4">,</span>
        <span class="s2">lazyHandlerPromise</span><span class="s4">: </span><span class="s2">cachedPromise</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">lazyRoutePromise2 </span><span class="s4">= (</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
      <span class="s2">invariant</span><span class="s4">(</span>
        <span class="s3">typeof </span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;No lazy route function found&quot;</span>
      <span class="s4">);</span>
      <span class="s3">let </span><span class="s2">lazyRoute </span><span class="s4">= </span><span class="s3">await </span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">();</span>
      <span class="s3">let </span><span class="s2">routeUpdates </span><span class="s4">= {};</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">lazyRouteProperty </span><span class="s3">in </span><span class="s2">lazyRoute</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">lazyValue </span><span class="s4">= </span><span class="s2">lazyRoute</span><span class="s4">[</span><span class="s2">lazyRouteProperty</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">lazyValue </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s3">continue</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">let </span><span class="s2">isUnsupported </span><span class="s4">= </span><span class="s2">isUnsupportedLazyRouteFunctionKey</span><span class="s4">(</span><span class="s2">lazyRouteProperty</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">staticRouteValue </span><span class="s4">= </span><span class="s2">routeToUpdate</span><span class="s4">[</span><span class="s2">lazyRouteProperty</span><span class="s4">];</span>
        <span class="s3">let </span><span class="s2">isStaticallyDefined </span><span class="s4">= </span><span class="s2">staticRouteValue </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s6">// This property isn't static since it should always be updated based</span>
        <span class="s6">// on the route updates</span>
        <span class="s2">lazyRouteProperty </span><span class="s4">!== </span><span class="s5">&quot;hasErrorBoundary&quot;</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isUnsupported</span><span class="s4">) {</span>
          <span class="s2">warning</span><span class="s4">(</span>
            <span class="s4">!</span><span class="s2">isUnsupported</span><span class="s4">,</span>
            <span class="s5">&quot;Route property &quot; </span><span class="s4">+ </span><span class="s2">lazyRouteProperty </span><span class="s4">+ </span><span class="s5">&quot; is not a supported property to be returned from a lazy route function. This property will be ignored.&quot;</span>
          <span class="s4">);</span>
        <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isStaticallyDefined</span><span class="s4">) {</span>
          <span class="s2">warning</span><span class="s4">(</span>
            <span class="s4">!</span><span class="s2">isStaticallyDefined</span><span class="s4">,</span>
            <span class="s5">`Route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeToUpdate</span><span class="s4">.</span><span class="s2">id</span><span class="s4">}</span><span class="s5">&quot; has a static property &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">lazyRouteProperty</span><span class="s4">}</span><span class="s5">&quot; defined but its lazy function is also returning a value for this property. The lazy route property &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">lazyRouteProperty</span><span class="s4">}</span><span class="s5">&quot; will be ignored.`</span>
          <span class="s4">);</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">routeUpdates</span><span class="s4">[</span><span class="s2">lazyRouteProperty</span><span class="s4">] = </span><span class="s2">lazyValue</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s2">routeUpdates</span><span class="s4">);</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, {</span>
        <span class="s6">// To keep things framework agnostic, we use the provided `mapRouteProperties`</span>
        <span class="s6">// function to set the framework-aware properties (`element`/`hasErrorBoundary`)</span>
        <span class="s6">// since the logic will differ between frameworks.</span>
        <span class="s2">...mapRouteProperties2</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">),</span>
        <span class="s2">lazy</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">});</span>
    <span class="s4">})();</span>
    <span class="s2">lazyRouteFunctionCache</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">routeToUpdate</span><span class="s4">, </span><span class="s2">lazyRoutePromise2</span><span class="s4">);</span>
    <span class="s2">lazyRoutePromise2</span><span class="s4">.</span><span class="s2">catch</span><span class="s4">(() =&gt; {</span>
    <span class="s4">});</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">lazyRoutePromise</span><span class="s4">: </span><span class="s2">lazyRoutePromise2</span><span class="s4">,</span>
      <span class="s2">lazyHandlerPromise</span><span class="s4">: </span><span class="s2">lazyRoutePromise2</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">lazyKeys </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">lazyPropertyPromises </span><span class="s4">= [];</span>
  <span class="s3">let </span><span class="s2">lazyHandlerPromise </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">key of lazyKeys</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">lazyRoutePropertiesToSkip </span><span class="s4">&amp;&amp; </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s3">continue</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s2">loadLazyRouteProperty</span><span class="s4">({</span>
      <span class="s2">key</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties</span><span class="s4">: </span><span class="s2">mapRouteProperties2</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">promise</span><span class="s4">) {</span>
      <span class="s2">lazyPropertyPromises</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">promise</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">key </span><span class="s4">=== </span><span class="s2">type</span><span class="s4">) {</span>
        <span class="s2">lazyHandlerPromise </span><span class="s4">= </span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">lazyRoutePromise </span><span class="s4">= </span><span class="s2">lazyPropertyPromises</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">lazyPropertyPromises</span><span class="s4">).</span><span class="s2">then</span><span class="s4">(() =&gt; {</span>
  <span class="s4">}) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s2">lazyRoutePromise</span><span class="s4">?.</span><span class="s2">catch</span><span class="s4">(() =&gt; {</span>
  <span class="s4">});</span>
  <span class="s2">lazyHandlerPromise</span><span class="s4">?.</span><span class="s2">catch</span><span class="s4">(() =&gt; {</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">lazyRoutePromise</span><span class="s4">,</span>
    <span class="s2">lazyHandlerPromise</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isNonNullable</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">value </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">loadLazyMiddlewareForMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">mapRouteProperties2</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">promises </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(({ </span><span class="s2">route </span><span class="s4">}) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">!== </span><span class="s5">&quot;object&quot; </span><span class="s4">|| !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy</span><span class="s4">.</span><span class="s2">unstable_middleware</span><span class="s4">) {</span>
      <span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">loadLazyRouteProperty</span><span class="s4">({</span>
      <span class="s2">key</span><span class="s4">: </span><span class="s5">&quot;unstable_middleware&quot;</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">mapRouteProperties</span><span class="s4">: </span><span class="s2">mapRouteProperties2</span>
    <span class="s4">});</span>
  <span class="s4">}).</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">isNonNullable</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">promises</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">promises</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">defaultDataStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">matchesToLoad </span><span class="s4">= </span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">shouldLoad</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">keyedResults </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">matchesToLoad</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">()));</span>
  <span class="s2">results</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">result</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; {</span>
    <span class="s2">keyedResults</span><span class="s4">[</span><span class="s2">matchesToLoad</span><span class="s4">[</span><span class="s2">i</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">keyedResults</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">defaultDataStrategyWithMiddleware</span><span class="s4">(</span><span class="s2">args</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">unstable_middleware</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s2">defaultDataStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">runMiddlewarePipeline</span><span class="s4">(</span>
    <span class="s2">args</span><span class="s4">,</span>
    <span class="s3">false</span><span class="s4">,</span>
    <span class="s4">() =&gt; </span><span class="s2">defaultDataStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">),</span>
    <span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) =&gt; ({ [</span><span class="s2">routeId</span><span class="s4">]: { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">error </span><span class="s4">} })</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">runMiddlewarePipeline</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">propagateResult</span><span class="s4">, </span><span class="s2">handler</span><span class="s4">, </span><span class="s2">errorHandler</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">params</span><span class="s4">, </span><span class="s2">context </span><span class="s4">} = </span><span class="s2">args</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">middlewareState </span><span class="s4">= {</span>
    <span class="s2">handlerResult</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
  <span class="s4">};</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">tuples </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">flatMap</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">unstable_middleware </span><span class="s4">? </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">unstable_middleware</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">fn</span><span class="s4">) =&gt; [</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">, </span><span class="s2">fn</span><span class="s4">]) : []</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callRouteMiddleware</span><span class="s4">(</span>
      <span class="s4">{ </span><span class="s2">request</span><span class="s4">, </span><span class="s2">params</span><span class="s4">, </span><span class="s2">context </span><span class="s4">},</span>
      <span class="s2">tuples</span><span class="s4">,</span>
      <span class="s2">propagateResult</span><span class="s4">,</span>
      <span class="s2">middlewareState</span><span class="s4">,</span>
      <span class="s2">handler</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">propagateResult </span><span class="s4">? </span><span class="s2">result </span><span class="s4">: </span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">handlerResult</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">e</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">errorHandler</span><span class="s4">(</span>
      <span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError</span><span class="s4">.</span><span class="s2">error</span><span class="s4">,</span>
      <span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError</span><span class="s4">.</span><span class="s2">routeId</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">propagateResult </span><span class="s4">|| !</span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">handlerResult</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">handlerResult</span><span class="s4">, </span><span class="s2">result</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">callRouteMiddleware</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">middlewares</span><span class="s4">, </span><span class="s2">propagateResult</span><span class="s4">, </span><span class="s2">middlewareState</span><span class="s4">, </span><span class="s2">handler</span><span class="s4">, </span><span class="s2">idx </span><span class="s4">= </span><span class="s7">0</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">request </span><span class="s4">} = </span><span class="s2">args</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">reason</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">reason</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
      <span class="s5">`Request aborted without an </span><span class="s3">\`</span><span class="s5">AbortSignal.reason</span><span class="s3">\`</span><span class="s5">: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">}</span><span class="s5">`</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">tuple </span><span class="s4">= </span><span class="s2">middlewares</span><span class="s4">[</span><span class="s2">idx</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">tuple</span><span class="s4">) {</span>
    <span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">handlerResult </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">();</span>
    <span class="s3">return </span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">handlerResult</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">middleware</span><span class="s4">] = </span><span class="s2">tuple</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">nextCalled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">nextResult </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">next </span><span class="s4">= </span><span class="s2">async </span><span class="s4">() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">nextCalled</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;You may only call `next()` once per middleware&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">nextCalled </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callRouteMiddleware</span><span class="s4">(</span>
      <span class="s2">args</span><span class="s4">,</span>
      <span class="s2">middlewares</span><span class="s4">,</span>
      <span class="s2">propagateResult</span><span class="s4">,</span>
      <span class="s2">middlewareState</span><span class="s4">,</span>
      <span class="s2">handler</span><span class="s4">,</span>
      <span class="s2">idx </span><span class="s4">+ </span><span class="s7">1</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">propagateResult</span><span class="s4">) {</span>
      <span class="s2">nextResult </span><span class="s4">= </span><span class="s2">result</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">nextResult</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">middleware</span><span class="s4">(</span>
      <span class="s4">{</span>
        <span class="s2">request</span><span class="s4">: </span><span class="s2">args</span><span class="s4">.</span><span class="s2">request</span><span class="s4">,</span>
        <span class="s2">params</span><span class="s4">: </span><span class="s2">args</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
        <span class="s2">context</span><span class="s4">: </span><span class="s2">args</span><span class="s4">.</span><span class="s2">context</span>
      <span class="s4">},</span>
      <span class="s2">next</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">nextCalled</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">result </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">nextResult</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">return </span><span class="s2">next</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError</span><span class="s4">) {</span>
      <span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError </span><span class="s4">= { </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error </span><span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError</span><span class="s4">.</span><span class="s2">error </span><span class="s4">!== </span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">middlewareState</span><span class="s4">.</span><span class="s2">middlewareError </span><span class="s4">= { </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getDataStrategyMatchLazyPromises</span><span class="s4">(</span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">lazyMiddlewarePromise </span><span class="s4">= </span><span class="s2">loadLazyRouteProperty</span><span class="s4">({</span>
    <span class="s2">key</span><span class="s4">: </span><span class="s5">&quot;unstable_middleware&quot;</span><span class="s4">,</span>
    <span class="s2">route</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">,</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span><span class="s4">: </span><span class="s2">mapRouteProperties2</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">lazyRoutePromises </span><span class="s4">= </span><span class="s2">loadLazyRoute</span><span class="s4">(</span>
    <span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">,</span>
    <span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">) ? </span><span class="s5">&quot;action&quot; </span><span class="s4">: </span><span class="s5">&quot;loader&quot;</span><span class="s4">,</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
    <span class="s2">lazyRoutePropertiesToSkip</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">middleware</span><span class="s4">: </span><span class="s2">lazyMiddlewarePromise</span><span class="s4">,</span>
    <span class="s2">route</span><span class="s4">: </span><span class="s2">lazyRoutePromises</span><span class="s4">.</span><span class="s2">lazyRoutePromise</span><span class="s4">,</span>
    <span class="s2">handler</span><span class="s4">: </span><span class="s2">lazyRoutePromises</span><span class="s4">.</span><span class="s2">lazyHandlerPromise</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">shouldLoad</span><span class="s4">, </span><span class="s2">unstable_shouldRevalidateArgs </span><span class="s4">= </span><span class="s3">null</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">isUsingNewApi </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">_lazyPromises </span><span class="s4">= </span><span class="s2">getDataStrategyMatchLazyPromises</span><span class="s4">(</span>
    <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">request</span><span class="s4">,</span>
    <span class="s2">match</span><span class="s4">,</span>
    <span class="s2">lazyRoutePropertiesToSkip</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">...match</span><span class="s4">,</span>
    <span class="s2">_lazyPromises</span><span class="s4">,</span>
    <span class="s2">shouldLoad</span><span class="s4">,</span>
    <span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">,</span>
    <span class="s2">unstable_shouldCallHandler</span><span class="s4">(</span><span class="s2">defaultShouldRevalidate</span><span class="s4">) {</span>
      <span class="s2">isUsingNewApi </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">shouldLoad</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">defaultShouldRevalidate </span><span class="s4">=== </span><span class="s5">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">shouldRevalidateLoader</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, {</span>
          <span class="s2">...unstable_shouldRevalidateArgs</span><span class="s4">,</span>
          <span class="s2">defaultShouldRevalidate</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">shouldRevalidateLoader</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">resolve</span><span class="s4">(</span><span class="s2">handlerOverride</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isUsingNewApi </span><span class="s4">|| </span><span class="s2">shouldLoad </span><span class="s4">|| </span><span class="s2">handlerOverride </span><span class="s4">&amp;&amp; </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">=== </span><span class="s5">&quot;GET&quot; </span><span class="s4">&amp;&amp; (</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">callLoaderOrAction</span><span class="s4">({</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">match</span><span class="s4">,</span>
          <span class="s2">lazyHandlerPromise</span><span class="s4">: </span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">handler</span><span class="s4">,</span>
          <span class="s2">lazyRoutePromise</span><span class="s4">: </span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">,</span>
          <span class="s2">handlerOverride</span><span class="s4">,</span>
          <span class="s2">scopedContext</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">({ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getTargetedDataStrategyMatches</span><span class="s4">(</span><span class="s2">mapRouteProperties2</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">targetMatch</span><span class="s4">, </span><span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">shouldRevalidateArgs </span><span class="s4">= </span><span class="s3">null</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">!== </span><span class="s2">targetMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">...match</span><span class="s4">,</span>
        <span class="s2">shouldLoad</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">: </span><span class="s2">shouldRevalidateArgs</span><span class="s4">,</span>
        <span class="s2">unstable_shouldCallHandler</span><span class="s4">: () =&gt; </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">_lazyPromises</span><span class="s4">: </span><span class="s2">getDataStrategyMatchLazyPromises</span><span class="s4">(</span>
          <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">match</span><span class="s4">,</span>
          <span class="s2">lazyRoutePropertiesToSkip</span>
        <span class="s4">),</span>
        <span class="s2">resolve</span><span class="s4">: () =&gt; </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">({ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">})</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">getDataStrategyMatch</span><span class="s4">(</span>
      <span class="s2">mapRouteProperties2</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">request</span><span class="s4">,</span>
      <span class="s2">match</span><span class="s4">,</span>
      <span class="s2">lazyRoutePropertiesToSkip</span><span class="s4">,</span>
      <span class="s2">scopedContext</span><span class="s4">,</span>
      <span class="s3">true</span><span class="s4">,</span>
      <span class="s2">shouldRevalidateArgs</span>
    <span class="s4">);</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">callDataStrategyImpl</span><span class="s4">(</span><span class="s2">dataStrategyImpl</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">scopedContext</span><span class="s4">, </span><span class="s2">isStaticHandler</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">middleware</span><span class="s4">)) {</span>
    <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">middleware</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">dataStrategyArgs </span><span class="s4">= {</span>
    <span class="s2">request</span><span class="s4">,</span>
    <span class="s2">params</span><span class="s4">: </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">,</span>
    <span class="s2">context</span><span class="s4">: </span><span class="s2">scopedContext</span><span class="s4">,</span>
    <span class="s2">matches</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">unstable_runClientMiddleware </span><span class="s4">= </span><span class="s2">isStaticHandler </span><span class="s4">? () =&gt; {</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
      <span class="s5">&quot;You cannot call `unstable_runClientMiddleware()` from a static handler `dataStrategy`. Middleware is run outside of `dataStrategy` during SSR in order to bubble up the Response.  You can enable middleware via the `respond` API in `query`/`queryRoute`&quot;</span>
    <span class="s4">);</span>
  <span class="s4">} : (</span><span class="s2">cb</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">typedDataStrategyArgs </span><span class="s4">= </span><span class="s2">dataStrategyArgs</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">runMiddlewarePipeline</span><span class="s4">(</span>
      <span class="s2">typedDataStrategyArgs</span><span class="s4">,</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s4">() =&gt; </span><span class="s2">cb</span><span class="s4">({</span>
        <span class="s2">...typedDataStrategyArgs</span><span class="s4">,</span>
        <span class="s2">fetcherKey</span><span class="s4">,</span>
        <span class="s2">unstable_runClientMiddleware</span><span class="s4">: () =&gt; {</span>
          <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
            <span class="s5">&quot;Cannot call `unstable_runClientMiddleware()` from within an `unstable_runClientMiddleware` handler&quot;</span>
          <span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}),</span>
      <span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) =&gt; ({</span>
        <span class="s4">[</span><span class="s2">routeId</span><span class="s4">]: { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">error </span><span class="s4">}</span>
      <span class="s4">})</span>
    <span class="s4">);</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">results </span><span class="s4">= </span><span class="s3">await </span><span class="s2">dataStrategyImpl</span><span class="s4">({</span>
    <span class="s2">...dataStrategyArgs</span><span class="s4">,</span>
    <span class="s2">fetcherKey</span><span class="s4">,</span>
    <span class="s2">unstable_runClientMiddleware</span>
  <span class="s4">});</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
      <span class="s2">matches</span><span class="s4">.</span><span class="s2">flatMap</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; [</span><span class="s2">m</span><span class="s4">.</span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">handler</span><span class="s4">, </span><span class="s2">m</span><span class="s4">.</span><span class="s2">_lazyPromises</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">])</span>
    <span class="s4">);</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">results</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">callLoaderOrAction</span><span class="s4">({</span>
  <span class="s2">request</span><span class="s4">,</span>
  <span class="s2">match</span><span class="s4">,</span>
  <span class="s2">lazyHandlerPromise</span><span class="s4">,</span>
  <span class="s2">lazyRoutePromise</span><span class="s4">,</span>
  <span class="s2">handlerOverride</span><span class="s4">,</span>
  <span class="s2">scopedContext</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">onReject</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">isAction </span><span class="s4">= </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">type </span><span class="s4">= </span><span class="s2">isAction </span><span class="s4">? </span><span class="s5">&quot;action&quot; </span><span class="s4">: </span><span class="s5">&quot;loader&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">runHandler </span><span class="s4">= (</span><span class="s2">handler</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">reject</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">abortPromise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">r</span><span class="s4">) =&gt; </span><span class="s2">reject </span><span class="s4">= </span><span class="s2">r</span><span class="s4">);</span>
    <span class="s2">onReject </span><span class="s4">= () =&gt; </span><span class="s2">reject</span><span class="s4">();</span>
    <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;abort&quot;</span><span class="s4">, </span><span class="s2">onReject</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">actualHandler </span><span class="s4">= (</span><span class="s2">ctx</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">handler </span><span class="s4">!== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">(</span>
          <span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span>
            <span class="s5">`You cannot call the handler for a route which defines a boolean &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">type</span><span class="s4">}</span><span class="s5">&quot; [routeId: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">}</span><span class="s5">]`</span>
          <span class="s4">)</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">handler</span><span class="s4">(</span>
        <span class="s4">{</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">params</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
          <span class="s2">context</span><span class="s4">: </span><span class="s2">scopedContext</span>
        <span class="s4">},</span>
        <span class="s2">...ctx </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? [</span><span class="s2">ctx</span><span class="s4">] : []</span>
      <span class="s4">);</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">handlerPromise </span><span class="s4">= (</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">val </span><span class="s4">= </span><span class="s3">await </span><span class="s4">(</span><span class="s2">handlerOverride </span><span class="s4">? </span><span class="s2">handlerOverride</span><span class="s4">((</span><span class="s2">ctx</span><span class="s4">) =&gt; </span><span class="s2">actualHandler</span><span class="s4">(</span><span class="s2">ctx</span><span class="s4">)) : </span><span class="s2">actualHandler</span><span class="s4">());</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">val </span><span class="s4">};</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
      <span class="s4">}</span>
    <span class="s4">})();</span>
    <span class="s3">return </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">race</span><span class="s4">([</span><span class="s2">handlerPromise</span><span class="s4">, </span><span class="s2">abortPromise</span><span class="s4">]);</span>
  <span class="s4">};</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">handler </span><span class="s4">= </span><span class="s2">isAction </span><span class="s4">? </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">lazyHandlerPromise </span><span class="s4">|| </span><span class="s2">lazyRoutePromise</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">handlerError</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s4">[</span><span class="s2">value</span><span class="s4">] = </span><span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">([</span>
          <span class="s6">// If the handler throws, don't let it immediately bubble out,</span>
          <span class="s6">// since we need to let the lazy() execution finish so we know if this</span>
          <span class="s6">// route has a boundary that can handle the error</span>
          <span class="s2">runHandler</span><span class="s4">(</span><span class="s2">handler</span><span class="s4">).</span><span class="s2">catch</span><span class="s4">((</span><span class="s2">e</span><span class="s4">) =&gt; {</span>
            <span class="s2">handlerError </span><span class="s4">= </span><span class="s2">e</span><span class="s4">;</span>
          <span class="s4">}),</span>
          <span class="s6">// Ensure all lazy route promises are resolved before continuing</span>
          <span class="s2">lazyHandlerPromise</span><span class="s4">,</span>
          <span class="s2">lazyRoutePromise</span>
        <span class="s4">]);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">handlerError </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s3">throw </span><span class="s2">handlerError</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s2">result </span><span class="s4">= </span><span class="s2">value</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">lazyHandlerPromise</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s2">handler2 </span><span class="s4">= </span><span class="s2">isAction </span><span class="s4">? </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">handler2</span><span class="s4">) {</span>
          <span class="s4">[</span><span class="s2">result</span><span class="s4">] = </span><span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">([</span><span class="s2">runHandler</span><span class="s4">(</span><span class="s2">handler2</span><span class="s4">), </span><span class="s2">lazyRoutePromise</span><span class="s4">]);</span>
        <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;action&quot;</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">url</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
          <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, {</span>
            <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
            <span class="s2">pathname</span><span class="s4">,</span>
            <span class="s2">routeId</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
          <span class="s4">});</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">handler</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">url</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
      <span class="s3">throw </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, {</span>
        <span class="s2">pathname</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">runHandler</span><span class="s4">(</span><span class="s2">handler</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
  <span class="s4">} </span><span class="s3">finally </span><span class="s4">{</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">onReject</span><span class="s4">) {</span>
      <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span><span class="s5">&quot;abort&quot;</span><span class="s4">, </span><span class="s2">onReject</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">convertDataStrategyResultToDataResult</span><span class="s4">(</span><span class="s2">dataStrategyResult</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">result</span><span class="s4">, </span><span class="s2">type </span><span class="s4">} = </span><span class="s2">dataStrategyResult</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">data2</span><span class="s4">;</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">contentType </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">contentType </span><span class="s4">&amp;&amp; </span><span class="s8">/\bapplication\/json\b/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">contentType</span><span class="s4">)) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">body </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
          <span class="s2">data2 </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">data2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">result</span><span class="s4">.</span><span class="s2">json</span><span class="s4">();</span>
        <span class="s4">}</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">data2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">result</span><span class="s4">.</span><span class="s2">text</span><span class="s4">();</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">, </span><span class="s2">error</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
        <span class="s2">error</span><span class="s4">: </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">, </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">),</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">,</span>
      <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isDataWithResponseInit</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">data </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">{</span>
          <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
          <span class="s2">error</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">,</span>
          <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">status</span><span class="s4">,</span>
          <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">headers </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span>
        <span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
        <span class="s2">error</span><span class="s4">: </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
          <span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">status </span><span class="s4">|| </span><span class="s7">500</span><span class="s4">,</span>
          <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
          <span class="s2">result</span><span class="s4">.</span><span class="s2">data</span>
        <span class="s4">),</span>
        <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) ? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">headers </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">,</span>
      <span class="s2">error</span><span class="s4">: </span><span class="s2">result</span><span class="s4">,</span>
      <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) ? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isDataWithResponseInit</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">,</span>
      <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">status</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">?.</span><span class="s2">headers </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */</span><span class="s4">, </span><span class="s2">data</span><span class="s4">: </span><span class="s2">result </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">normalizeRelativeRoutingRedirectResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">location</span><span class="s4">,</span>
    <span class="s5">&quot;Redirects returned/thrown from loaders/actions must have a Location header&quot;</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">ABSOLUTE_URL_REGEX</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">location</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">trimmedMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span>
      <span class="s7">0</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">routeId</span><span class="s4">) + </span><span class="s7">1</span>
    <span class="s4">);</span>
    <span class="s2">location </span><span class="s4">= </span><span class="s2">normalizeTo</span><span class="s4">(</span>
      <span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">),</span>
      <span class="s2">trimmedMatches</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">location</span>
    <span class="s4">);</span>
    <span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">, </span><span class="s2">location</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">normalizeRedirectLocation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">currentUrl</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">ABSOLUTE_URL_REGEX</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">location</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">normalizedLocation </span><span class="s4">= </span><span class="s2">location</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">normalizedLocation</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;//&quot;</span><span class="s4">) ? </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">protocol </span><span class="s4">+ </span><span class="s2">normalizedLocation</span><span class="s4">) : </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">normalizedLocation</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">isSameBasename </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) != </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">=== </span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">&amp;&amp; </span><span class="s2">isSameBasename</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">url</span><span class="s4">.</span><span class="s2">search </span><span class="s4">+ </span><span class="s2">url</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">location</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createClientSideRequest</span><span class="s4">(</span><span class="s2">history</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">signal</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">history</span><span class="s4">.</span><span class="s2">createURL</span><span class="s4">(</span><span class="s2">stripHashFromPath</span><span class="s4">(</span><span class="s2">location</span><span class="s4">)).</span><span class="s2">toString</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">init </span><span class="s4">= { </span><span class="s2">signal </span><span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">submission </span><span class="s4">&amp;&amp; </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">formMethod</span><span class="s4">, </span><span class="s2">formEncType </span><span class="s4">} = </span><span class="s2">submission</span><span class="s4">;</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">method </span><span class="s4">= </span><span class="s2">formMethod</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">();</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">formEncType </span><span class="s4">=== </span><span class="s5">&quot;application/json&quot;</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">({ </span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">: </span><span class="s2">formEncType </span><span class="s4">});</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">json</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">formEncType </span><span class="s4">=== </span><span class="s5">&quot;text/plain&quot;</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">text</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">formEncType </span><span class="s4">=== </span><span class="s5">&quot;application/x-www-form-urlencoded&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s2">convertFormDataToSearchParams</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">url</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">convertFormDataToSearchParams</span><span class="s4">(</span><span class="s2">formData</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">searchParams </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">();</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">value</span><span class="s4">] </span><span class="s2">of formData</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">()) {</span>
    <span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">value </span><span class="s4">: </span><span class="s2">value</span><span class="s4">.</span><span class="s2">name</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">searchParams</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">convertSearchParamsToFormData</span><span class="s4">(</span><span class="s2">searchParams</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">formData </span><span class="s4">= </span><span class="s3">new </span><span class="s2">FormData</span><span class="s4">();</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">value</span><span class="s4">] </span><span class="s2">of searchParams</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">()) {</span>
    <span class="s2">formData</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">formData</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">processRouteLoaderData</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">results</span><span class="s4">, </span><span class="s2">pendingActionResult</span><span class="s4">, </span><span class="s2">isStaticHandler </span><span class="s4">= </span><span class="s3">false</span><span class="s4">, </span><span class="s2">skipLoaderErrorBubbling </span><span class="s4">= </span><span class="s3">false</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">loaderData </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">errors </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">statusCode</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">foundError </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">loaderHeaders </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">pendingError </span><span class="s4">= </span><span class="s2">pendingActionResult </span><span class="s4">&amp;&amp; </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">error </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s2">matches</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">results</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">),</span>
      <span class="s5">&quot;Cannot handle redirect results in processLoaderData&quot;</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingError </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s2">error </span><span class="s4">= </span><span class="s2">pendingError</span><span class="s4">;</span>
        <span class="s2">pendingError </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">errors </span><span class="s4">= </span><span class="s2">errors </span><span class="s4">|| {};</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">skipLoaderErrorBubbling</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">id</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">errors</span><span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] == </span><span class="s3">null</span><span class="s4">) {</span>
          <span class="s2">errors</span><span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">isStaticHandler</span><span class="s4">) {</span>
        <span class="s2">loaderData</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">ResetLoaderDataSymbol</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">foundError</span><span class="s4">) {</span>
        <span class="s2">foundError </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
        <span class="s2">statusCode </span><span class="s4">= </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) ? </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span><span class="s4">.</span><span class="s2">status </span><span class="s4">: </span><span class="s7">500</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">) {</span>
        <span class="s2">loaderHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">loaderData</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">&amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode </span><span class="s4">!== </span><span class="s7">200 </span><span class="s4">&amp;&amp; !</span><span class="s2">foundError</span><span class="s4">) {</span>
        <span class="s2">statusCode </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">) {</span>
        <span class="s2">loaderHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingError </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
    <span class="s2">errors </span><span class="s4">= { [</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]]: </span><span class="s2">pendingError </span><span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">2</span><span class="s4">]) {</span>
      <span class="s2">loaderData</span><span class="s4">[</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">2</span><span class="s4">]] = </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">loaderData</span><span class="s4">,</span>
    <span class="s2">errors</span><span class="s4">,</span>
    <span class="s2">statusCode</span><span class="s4">: </span><span class="s2">statusCode </span><span class="s4">|| </span><span class="s7">200</span><span class="s4">,</span>
    <span class="s2">loaderHeaders</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">processLoaderData</span><span class="s4">(</span><span class="s2">state</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">results</span><span class="s4">, </span><span class="s2">pendingActionResult</span><span class="s4">, </span><span class="s2">revalidatingFetchers</span><span class="s4">, </span><span class="s2">fetcherResults</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors </span><span class="s4">} = </span><span class="s2">processRouteLoaderData</span><span class="s4">(</span>
    <span class="s2">matches</span><span class="s4">,</span>
    <span class="s2">results</span><span class="s4">,</span>
    <span class="s2">pendingActionResult</span>
  <span class="s4">);</span>
  <span class="s2">revalidatingFetchers</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">f</span><span class="s4">) =&gt; !</span><span class="s2">f</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">|| </span><span class="s2">f</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">shouldLoad</span><span class="s4">)).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">rf</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">key</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">controller </span><span class="s4">} = </span><span class="s2">rf</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">fetcherResults</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
    <span class="s2">invariant</span><span class="s4">(</span><span class="s2">result</span><span class="s4">, </span><span class="s5">&quot;Did not find corresponding fetcher result&quot;</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">controller </span><span class="s4">&amp;&amp; </span><span class="s2">controller</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">boundaryMatch </span><span class="s4">= </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">match</span><span class="s4">?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!(</span><span class="s2">errors </span><span class="s4">&amp;&amp; </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">])) {</span>
        <span class="s2">errors </span><span class="s4">= {</span>
          <span class="s2">...errors</span><span class="s4">,</span>
          <span class="s4">[</span><span class="s2">boundaryMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">error</span>
        <span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s2">invariant</span><span class="s4">(</span><span class="s3">false</span><span class="s4">, </span><span class="s5">&quot;Unhandled fetcher revalidation redirect&quot;</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">doneFetcher </span><span class="s4">= </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
      <span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">doneFetcher</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">mergeLoaderData</span><span class="s4">(</span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">newLoaderData</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">mergedLoaderData </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">newLoaderData</span><span class="s4">).</span><span class="s2">filter</span><span class="s4">(([, </span><span class="s2">v</span><span class="s4">]) =&gt; </span><span class="s2">v </span><span class="s4">!== </span><span class="s2">ResetLoaderDataSymbol</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">merged</span><span class="s4">, [</span><span class="s2">k</span><span class="s4">, </span><span class="s2">v</span><span class="s4">]) =&gt; {</span>
    <span class="s2">merged</span><span class="s4">[</span><span class="s2">k</span><span class="s4">] = </span><span class="s2">v</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">merged</span><span class="s4">;</span>
  <span class="s4">}, {});</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of matches</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">newLoaderData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">id</span><span class="s4">) &amp;&amp; </span><span class="s2">loaderData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">id</span><span class="s4">) &amp;&amp; </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">) {</span>
      <span class="s2">mergedLoaderData</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">errors </span><span class="s4">&amp;&amp; </span><span class="s2">errors</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">id</span><span class="s4">)) {</span>
      <span class="s3">break</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">mergedLoaderData</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getActionDataForCommit</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">pendingActionResult</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{};</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]) ? {</span>
    <span class="s6">// Clear out prior actionData on errors</span>
    <span class="s2">actionData</span><span class="s4">: {}</span>
  <span class="s4">} : {</span>
    <span class="s2">actionData</span><span class="s4">: {</span>
      <span class="s4">[</span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]]: </span><span class="s2">pendingActionResult</span><span class="s4">[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">data</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">findNearestBoundary</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">eligibleMatches </span><span class="s4">= </span><span class="s2">routeId </span><span class="s4">? </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">routeId</span><span class="s4">) + </span><span class="s7">1</span><span class="s4">) : [</span><span class="s2">...matches</span><span class="s4">];</span>
  <span class="s3">return </span><span class="s2">eligibleMatches</span><span class="s4">.</span><span class="s2">reverse</span><span class="s4">().</span><span class="s2">find</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasErrorBoundary </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">) || </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getShortCircuitMatches</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">routes</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">1 </span><span class="s4">? </span><span class="s2">routes</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] : </span><span class="s2">routes</span><span class="s4">.</span><span class="s2">find</span><span class="s4">((</span><span class="s2">r</span><span class="s4">) =&gt; </span><span class="s2">r</span><span class="s4">.</span><span class="s2">index </span><span class="s4">|| !</span><span class="s2">r</span><span class="s4">.</span><span class="s2">path </span><span class="s4">|| </span><span class="s2">r</span><span class="s4">.</span><span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;/&quot;</span><span class="s4">) || {</span>
    <span class="s2">id</span><span class="s4">: </span><span class="s5">`__shim-error-route__`</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">matches</span><span class="s4">: [</span>
      <span class="s4">{</span>
        <span class="s2">params</span><span class="s4">: {},</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s2">pathnameBase</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
        <span class="s2">route</span>
      <span class="s4">}</span>
    <span class="s4">],</span>
    <span class="s2">route</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getInternalRouterError</span><span class="s4">(</span><span class="s2">status</span><span class="s4">, {</span>
  <span class="s2">pathname</span><span class="s4">,</span>
  <span class="s2">routeId</span><span class="s4">,</span>
  <span class="s2">method</span><span class="s4">,</span>
  <span class="s2">type</span><span class="s4">,</span>
  <span class="s2">message</span>
<span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s2">statusText </span><span class="s4">= </span><span class="s5">&quot;Unknown Server Error&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">&quot;Unknown @remix-run/router error&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">400</span><span class="s4">) {</span>
    <span class="s2">statusText </span><span class="s4">= </span><span class="s5">&quot;Bad Request&quot;</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">method </span><span class="s4">&amp;&amp; </span><span class="s2">pathname </span><span class="s4">&amp;&amp; </span><span class="s2">routeId</span><span class="s4">) {</span>
      <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">`You made a </span><span class="s2">$</span><span class="s4">{</span><span class="s2">method</span><span class="s4">} </span><span class="s5">request to &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pathname</span><span class="s4">}</span><span class="s5">&quot; but did not provide a </span><span class="s3">\`</span><span class="s5">loader</span><span class="s3">\` </span><span class="s5">for route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot;, so there is no way to handle the request.`</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;invalid-body&quot;</span><span class="s4">) {</span>
      <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">&quot;Unable to encode submission body&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">403</span><span class="s4">) {</span>
    <span class="s2">statusText </span><span class="s4">= </span><span class="s5">&quot;Forbidden&quot;</span><span class="s4">;</span>
    <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">`Route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot; does not match URL &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pathname</span><span class="s4">}</span><span class="s5">&quot;`</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">404</span><span class="s4">) {</span>
    <span class="s2">statusText </span><span class="s4">= </span><span class="s5">&quot;Not Found&quot;</span><span class="s4">;</span>
    <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">`No route matches URL &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pathname</span><span class="s4">}</span><span class="s5">&quot;`</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">405</span><span class="s4">) {</span>
    <span class="s2">statusText </span><span class="s4">= </span><span class="s5">&quot;Method Not Allowed&quot;</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">method </span><span class="s4">&amp;&amp; </span><span class="s2">pathname </span><span class="s4">&amp;&amp; </span><span class="s2">routeId</span><span class="s4">) {</span>
      <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">`You made a </span><span class="s2">$</span><span class="s4">{</span><span class="s2">method</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">()} </span><span class="s5">request to &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pathname</span><span class="s4">}</span><span class="s5">&quot; but did not provide an </span><span class="s3">\`</span><span class="s5">action</span><span class="s3">\` </span><span class="s5">for route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot;, so there is no way to handle the request.`</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">method</span><span class="s4">) {</span>
      <span class="s2">errorMessage </span><span class="s4">= </span><span class="s5">`Invalid request method &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">method</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">()}</span><span class="s5">&quot;`</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
    <span class="s2">status </span><span class="s4">|| </span><span class="s7">500</span><span class="s4">,</span>
    <span class="s2">statusText</span><span class="s4">,</span>
    <span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">errorMessage</span><span class="s4">),</span>
    <span class="s3">true</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">findRedirect</span><span class="s4">(</span><span class="s2">results</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">results</span><span class="s4">);</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s2">entries</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i</span><span class="s4">--) {</span>
    <span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">result</span><span class="s4">] = </span><span class="s2">entries</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">key</span><span class="s4">, </span><span class="s2">result </span><span class="s4">};</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stripHashFromPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">parsedPath </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">path </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">) : </span><span class="s2">path</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">createPath</span><span class="s4">({ </span><span class="s2">...parsedPath</span><span class="s4">, </span><span class="s2">hash</span><span class="s4">: </span><span class="s5">&quot;&quot; </span><span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isHashChangeOnly</span><span class="s4">(</span><span class="s2">a</span><span class="s4">, </span><span class="s2">b</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">a</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">!== </span><span class="s2">b</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s2">a</span><span class="s4">.</span><span class="s2">search </span><span class="s4">!== </span><span class="s2">b</span><span class="s4">.</span><span class="s2">search</span><span class="s4">) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">a</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">=== </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">b</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">!== </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">a</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">=== </span><span class="s2">b</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">b</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">!== </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
    <span class="s3">return true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return false</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isDataStrategyResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">result </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">result </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;type&quot; </span><span class="s3">in </span><span class="s2">result </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;result&quot; </span><span class="s3">in </span><span class="s2">result </span><span class="s4">&amp;&amp; (</span><span class="s2">result</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;data&quot; </span><span class="s6">/* data */ </span><span class="s4">|| </span><span class="s2">result</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isRedirectDataStrategyResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">) &amp;&amp; </span><span class="s2">redirectStatusCodes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isErrorResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;error&quot; </span><span class="s6">/* error */</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isRedirectResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">result </span><span class="s4">&amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">type</span><span class="s4">) === </span><span class="s5">&quot;redirect&quot; </span><span class="s6">/* redirect */</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isDataWithResponseInit</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">return typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">value </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;type&quot; </span><span class="s3">in </span><span class="s2">value </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;data&quot; </span><span class="s3">in </span><span class="s2">value </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;init&quot; </span><span class="s3">in </span><span class="s2">value </span><span class="s4">&amp;&amp; </span><span class="s2">value</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;DataWithResponseInit&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">value </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">value</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s5">&quot;number&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">value</span><span class="s4">.</span><span class="s2">statusText </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">value</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">value</span><span class="s4">.</span><span class="s2">body </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isRedirectStatusCode</span><span class="s4">(</span><span class="s2">statusCode</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">redirectStatusCodes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">statusCode</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isRedirectResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) &amp;&amp; </span><span class="s2">isRedirectStatusCode</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">) &amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isValidMethod</span><span class="s4">(</span><span class="s2">method</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">validRequestMethods</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">method</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">());</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isMutationMethod</span><span class="s4">(</span><span class="s2">method</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">validMutationMethods</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">method</span><span class="s4">.</span><span class="s2">toUpperCase</span><span class="s4">());</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">hasNakedIndexQuery</span><span class="s4">(</span><span class="s2">search</span><span class="s4">) {</span>
  <span class="s3">return new </span><span class="s2">URLSearchParams</span><span class="s4">(</span><span class="s2">search</span><span class="s4">).</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">).</span><span class="s2">some</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">v </span><span class="s4">=== </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getTargetMatch</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">location</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">search </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">location </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">location</span><span class="s4">).</span><span class="s2">search </span><span class="s4">: </span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">&amp;&amp; </span><span class="s2">hasNakedIndexQuery</span><span class="s4">(</span><span class="s2">search </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">pathMatches </span><span class="s4">= </span><span class="s2">getPathContributingMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">pathMatches</span><span class="s4">[</span><span class="s2">pathMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSubmissionFromNavigation</span><span class="s4">(</span><span class="s2">navigation</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">formMethod</span><span class="s4">, </span><span class="s2">formAction</span><span class="s4">, </span><span class="s2">formEncType</span><span class="s4">, </span><span class="s2">text</span><span class="s4">, </span><span class="s2">formData</span><span class="s4">, </span><span class="s2">json </span><span class="s4">} = </span><span class="s2">navigation</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">formMethod </span><span class="s4">|| !</span><span class="s2">formAction </span><span class="s4">|| !</span><span class="s2">formEncType</span><span class="s4">) {</span>
    <span class="s3">return</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">text </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">formMethod</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">text</span>
    <span class="s4">};</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">formData </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">formMethod</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">json </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">formMethod</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getLoadingNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">submission</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">navigation </span><span class="s4">= {</span>
      <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;loading&quot;</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formAction</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">json</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">text</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">navigation</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">navigation </span><span class="s4">= {</span>
      <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;loading&quot;</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">formMethod</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">navigation</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSubmittingNavigation</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">submission</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">navigation </span><span class="s4">= {</span>
    <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;submitting&quot;</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">,</span>
    <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">,</span>
    <span class="s2">formAction</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formAction</span><span class="s4">,</span>
    <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
    <span class="s2">formData</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">,</span>
    <span class="s2">json</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">json</span><span class="s4">,</span>
    <span class="s2">text</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">text</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">navigation</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getLoadingFetcher</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">submission</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= {</span>
      <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;loading&quot;</span><span class="s4">,</span>
      <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formAction</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">json</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">text</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">fetcher</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= {</span>
      <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;loading&quot;</span><span class="s4">,</span>
      <span class="s2">formMethod</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formAction</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formEncType</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">fetcher</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSubmittingFetcher</span><span class="s4">(</span><span class="s2">submission</span><span class="s4">, </span><span class="s2">existingFetcher</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= {</span>
    <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;submitting&quot;</span><span class="s4">,</span>
    <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formMethod</span><span class="s4">,</span>
    <span class="s2">formAction</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formAction</span><span class="s4">,</span>
    <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formEncType</span><span class="s4">,</span>
    <span class="s2">formData</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">,</span>
    <span class="s2">json</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">json</span><span class="s4">,</span>
    <span class="s2">text</span><span class="s4">: </span><span class="s2">submission</span><span class="s4">.</span><span class="s2">text</span><span class="s4">,</span>
    <span class="s2">data</span><span class="s4">: </span><span class="s2">existingFetcher </span><span class="s4">? </span><span class="s2">existingFetcher</span><span class="s4">.</span><span class="s2">data </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">fetcher</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getDoneFetcher</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= {</span>
    <span class="s2">state</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
    <span class="s2">formMethod</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">formAction</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">formEncType</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">formData</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">json</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">text</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span>
  <span class="s4">};</span>
  <span class="s3">return </span><span class="s2">fetcher</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">restoreAppliedTransitions</span><span class="s4">(</span><span class="s2">_window</span><span class="s4">, </span><span class="s2">transitions</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">sessionPositions </span><span class="s4">= </span><span class="s2">_window</span><span class="s4">.</span><span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">getItem</span><span class="s4">(</span>
      <span class="s2">TRANSITIONS_STORAGE_KEY</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">sessionPositions</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">json </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">sessionPositions</span><span class="s4">);</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">k</span><span class="s4">, </span><span class="s2">v</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">json </span><span class="s4">|| {})) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">v </span><span class="s4">&amp;&amp; </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">v</span><span class="s4">)) {</span>
          <span class="s2">transitions</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">k</span><span class="s4">, </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">v </span><span class="s4">|| []));</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">persistAppliedTransitions</span><span class="s4">(</span><span class="s2">_window</span><span class="s4">, </span><span class="s2">transitions</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">transitions</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">json </span><span class="s4">= {};</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">k</span><span class="s4">, </span><span class="s2">v</span><span class="s4">] </span><span class="s2">of transitions</span><span class="s4">) {</span>
      <span class="s2">json</span><span class="s4">[</span><span class="s2">k</span><span class="s4">] = [</span><span class="s2">...v</span><span class="s4">];</span>
    <span class="s4">}</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s2">_window</span><span class="s4">.</span><span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">setItem</span><span class="s4">(</span>
        <span class="s2">TRANSITIONS_STORAGE_KEY</span><span class="s4">,</span>
        <span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">json</span><span class="s4">)</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">warning</span><span class="s4">(</span>
        <span class="s3">false</span><span class="s4">,</span>
        <span class="s5">`Failed to save applied view transitions in sessionStorage (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">}</span><span class="s5">).`</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createDeferred</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">resolve</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">reject</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">res</span><span class="s4">, </span><span class="s2">rej</span><span class="s4">) =&gt; {</span>
    <span class="s2">resolve </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">val</span><span class="s4">) =&gt; {</span>
      <span class="s2">res</span><span class="s4">(</span><span class="s2">val</span><span class="s4">);</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s4">}</span>
    <span class="s4">};</span>
    <span class="s2">reject </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) =&gt; {</span>
      <span class="s2">rej</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s4">}</span>
    <span class="s4">};</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">promise</span><span class="s4">,</span>
    <span class="s6">//@ts-ignore</span>
    <span class="s2">resolve</span><span class="s4">,</span>
    <span class="s6">//@ts-ignore</span>
    <span class="s2">reject</span>
  <span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/components.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React3 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// lib/context.ts</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">DataRouterContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
<span class="s2">DataRouterContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;DataRouter&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">DataRouterStateContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
<span class="s2">DataRouterStateContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;DataRouterState&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">ViewTransitionContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">({</span>
  <span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">false</span>
<span class="s4">});</span>
<span class="s2">ViewTransitionContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;ViewTransition&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">FetchersContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span>
  <span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">()</span>
<span class="s4">);</span>
<span class="s2">FetchersContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Fetchers&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">AwaitContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
<span class="s2">AwaitContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Await&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NavigationContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span>
  <span class="s3">null</span>
<span class="s4">);</span>
<span class="s2">NavigationContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Navigation&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">LocationContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span>
  <span class="s3">null</span>
<span class="s4">);</span>
<span class="s2">LocationContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Location&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">RouteContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">({</span>
  <span class="s2">outlet</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
  <span class="s2">matches</span><span class="s4">: [],</span>
  <span class="s2">isDataRoute</span><span class="s4">: </span><span class="s3">false</span>
<span class="s4">});</span>
<span class="s2">RouteContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Route&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">RouteErrorContext </span><span class="s4">= </span><span class="s2">React</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
<span class="s2">RouteErrorContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;RouteError&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">ENABLE_DEV_WARNINGS </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>

<span class="s6">// lib/hooks.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React2 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">useHref</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">} = {}) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of the</span>
    <span class="s6">// router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`useHref() may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">navigator </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">hash</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">search </span><span class="s4">} = </span><span class="s2">useResolvedPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">});</span>
  <span class="s3">let </span><span class="s2">joinedPathname </span><span class="s4">= </span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">joinedPathname </span><span class="s4">= </span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">basename </span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">]);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">createHref</span><span class="s4">({ </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">joinedPathname</span><span class="s4">, </span><span class="s2">search</span><span class="s4">, </span><span class="s2">hash </span><span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useInRouterContext</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">LocationContext</span><span class="s4">) != </span><span class="s3">null</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useLocation</span><span class="s4">() {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of the</span>
    <span class="s6">// router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`useLocation() may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">LocationContext</span><span class="s4">).</span><span class="s2">location</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useNavigationType</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">LocationContext</span><span class="s4">).</span><span class="s2">navigationType</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useMatch</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of the</span>
    <span class="s6">// router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`useMatch() may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname </span><span class="s4">} = </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">matchPath</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">decodePath</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">)),</span>
    <span class="s4">[</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">pattern</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">navigateEffectWarning </span><span class="s4">= </span><span class="s5">`You should call navigate() in a React.useEffect(), not when your component is first rendered.`</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">useIsomorphicLayoutEffect</span><span class="s4">(</span><span class="s2">cb</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">isStatic </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">).</span><span class="s2">static</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">isStatic</span><span class="s4">) {</span>
    <span class="s2">React2</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(</span><span class="s2">cb</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useNavigate</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">isDataRoute </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">isDataRoute </span><span class="s4">? </span><span class="s2">useNavigateStable</span><span class="s4">() : </span><span class="s2">useNavigateUnstable</span><span class="s4">();</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useNavigateUnstable</span><span class="s4">() {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of the</span>
    <span class="s6">// router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`useNavigate() may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">dataRouterContext </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">navigator </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">locationPathname </span><span class="s4">} = </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">routePathnamesJson </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">getResolveToMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">activeRef </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s2">useIsomorphicLayoutEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">navigate </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">options </span><span class="s4">= {}) =&gt; {</span>
      <span class="s2">warning</span><span class="s4">(</span><span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">, </span><span class="s2">navigateEffectWarning</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
        <span class="s2">navigator</span><span class="s4">.</span><span class="s2">go</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">resolveTo</span><span class="s4">(</span>
        <span class="s2">to</span><span class="s4">,</span>
        <span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">routePathnamesJson</span><span class="s4">),</span>
        <span class="s2">locationPathname</span><span class="s4">,</span>
        <span class="s2">options</span><span class="s4">.</span><span class="s2">relative </span><span class="s4">=== </span><span class="s5">&quot;path&quot;</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">dataRouterContext </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">basename </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
        <span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">basename </span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">]);</span>
      <span class="s4">}</span>
      <span class="s4">(!!</span><span class="s2">options</span><span class="s4">.</span><span class="s2">replace </span><span class="s4">? </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">replace </span><span class="s4">: </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">push</span><span class="s4">)(</span>
        <span class="s2">path</span><span class="s4">,</span>
        <span class="s2">options</span><span class="s4">.</span><span class="s2">state</span><span class="s4">,</span>
        <span class="s2">options</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s4">[</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">,</span>
      <span class="s2">routePathnamesJson</span><span class="s4">,</span>
      <span class="s2">locationPathname</span><span class="s4">,</span>
      <span class="s2">dataRouterContext</span>
    <span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">navigate</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">OutletContext </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
<span class="s3">function </span><span class="s2">useOutletContext</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">OutletContext</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useOutlet</span><span class="s4">(</span><span class="s2">context</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">outlet </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">).</span><span class="s2">outlet</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">outlet</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">OutletContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">context </span><span class="s4">}, </span><span class="s2">outlet</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">outlet</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useParams</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeMatch </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
  <span class="s3">return </span><span class="s2">routeMatch </span><span class="s4">? </span><span class="s2">routeMatch</span><span class="s4">.</span><span class="s2">params </span><span class="s4">: {};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useResolvedPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">locationPathname </span><span class="s4">} = </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">routePathnamesJson </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">getResolveToMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">resolveTo</span><span class="s4">(</span>
      <span class="s2">to</span><span class="s4">,</span>
      <span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">routePathnamesJson</span><span class="s4">),</span>
      <span class="s2">locationPathname</span><span class="s4">,</span>
      <span class="s2">relative </span><span class="s4">=== </span><span class="s5">&quot;path&quot;</span>
    <span class="s4">),</span>
    <span class="s4">[</span><span class="s2">to</span><span class="s4">, </span><span class="s2">routePathnamesJson</span><span class="s4">, </span><span class="s2">locationPathname</span><span class="s4">, </span><span class="s2">relative</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">useRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">locationArg</span><span class="s4">, </span><span class="s2">dataRouterState</span><span class="s4">, </span><span class="s2">future</span><span class="s4">) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of the</span>
    <span class="s6">// router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`useRoutes() may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">navigator</span><span class="s4">, </span><span class="s3">static</span><span class="s4">: </span><span class="s2">isStatic </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">parentMatches </span><span class="s4">} = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeMatch </span><span class="s4">= </span><span class="s2">parentMatches</span><span class="s4">[</span><span class="s2">parentMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
  <span class="s3">let </span><span class="s2">parentParams </span><span class="s4">= </span><span class="s2">routeMatch </span><span class="s4">? </span><span class="s2">routeMatch</span><span class="s4">.</span><span class="s2">params </span><span class="s4">: {};</span>
  <span class="s3">let </span><span class="s2">parentPathname </span><span class="s4">= </span><span class="s2">routeMatch </span><span class="s4">? </span><span class="s2">routeMatch</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">: </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">parentPathnameBase </span><span class="s4">= </span><span class="s2">routeMatch </span><span class="s4">? </span><span class="s2">routeMatch</span><span class="s4">.</span><span class="s2">pathnameBase </span><span class="s4">: </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">parentRoute </span><span class="s4">= </span><span class="s2">routeMatch </span><span class="s4">&amp;&amp; </span><span class="s2">routeMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">parentPath </span><span class="s4">= </span><span class="s2">parentRoute </span><span class="s4">&amp;&amp; </span><span class="s2">parentRoute</span><span class="s4">.</span><span class="s2">path </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
    <span class="s2">warningOnce</span><span class="s4">(</span>
      <span class="s2">parentPathname</span><span class="s4">,</span>
      <span class="s4">!</span><span class="s2">parentRoute </span><span class="s4">|| </span><span class="s2">parentPath</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">) || </span><span class="s2">parentPath</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*?&quot;</span><span class="s4">),</span>
      <span class="s5">`You rendered descendant &lt;Routes&gt; (or called </span><span class="s3">\`</span><span class="s5">useRoutes()</span><span class="s3">\`</span><span class="s5">) at &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPathname</span><span class="s4">}</span><span class="s5">&quot; (under &lt;Route path=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPath</span><span class="s4">}</span><span class="s5">&quot;&gt;) but the parent route path has no trailing &quot;*&quot;. This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render. 
 
Please change the parent &lt;Route path=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPath</span><span class="s4">}</span><span class="s5">&quot;&gt; to &lt;Route path=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPath </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s5">&quot;*&quot; </span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPath</span><span class="s4">}</span><span class="s5">/*`</span><span class="s4">}</span><span class="s5">&quot;&gt;.`</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">locationFromContext </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">location</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">locationArg</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">parsedLocationArg </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">locationArg </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">locationArg</span><span class="s4">) : </span><span class="s2">locationArg</span><span class="s4">;</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">parentPathnameBase </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">|| </span><span class="s2">parsedLocationArg</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">?.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s2">parentPathnameBase</span><span class="s4">),</span>
      <span class="s5">`When overriding the location using </span><span class="s3">\`</span><span class="s5">&lt;Routes location&gt;</span><span class="s3">\` </span><span class="s5">or </span><span class="s3">\`</span><span class="s5">useRoutes(routes, location)</span><span class="s3">\`</span><span class="s5">, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parentPathnameBase</span><span class="s4">}</span><span class="s5">&quot; but pathname &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">parsedLocationArg</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">}</span><span class="s5">&quot; was given in the </span><span class="s3">\`</span><span class="s5">location</span><span class="s3">\` </span><span class="s5">prop.`</span>
    <span class="s4">);</span>
    <span class="s2">location </span><span class="s4">= </span><span class="s2">parsedLocationArg</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">location </span><span class="s4">= </span><span class="s2">locationFromContext</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">remainingPathname </span><span class="s4">= </span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">parentPathnameBase </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">parentSegments </span><span class="s4">= </span><span class="s2">parentPathnameBase</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\//</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\//</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">).</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
    <span class="s2">remainingPathname </span><span class="s4">= </span><span class="s5">&quot;/&quot; </span><span class="s4">+ </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">parentSegments</span><span class="s4">.</span><span class="s2">length</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= !</span><span class="s2">isStatic </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterState </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches </span><span class="s4">: </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, { </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">remainingPathname </span><span class="s4">});</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s2">parentRoute </span><span class="s4">|| </span><span class="s2">matches </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s5">`No routes matched location &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">}</span><span class="s5">&quot; `</span>
    <span class="s4">);</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s2">matches </span><span class="s4">== </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">element </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">|| </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">|| </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s5">`Matched leaf route at location &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">}</span><span class="s5">&quot; does not have an element or Component. This means it will render an &lt;Outlet /&gt; with a null value by default resulting in an &quot;empty&quot; page.`</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">renderedMatches </span><span class="s4">= </span><span class="s2">_renderMatches</span><span class="s4">(</span>
    <span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">match</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">match</span><span class="s4">, {</span>
        <span class="s2">params</span><span class="s4">: </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">parentParams</span><span class="s4">, </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">),</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span>
          <span class="s2">parentPathnameBase</span><span class="s4">,</span>
          <span class="s6">// Re-encode pathnames that were decoded inside matchRoutes</span>
          <span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation </span><span class="s4">? </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">).</span><span class="s2">pathname </span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">]),</span>
        <span class="s2">pathnameBase</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">parentPathnameBase </span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span>
          <span class="s2">parentPathnameBase</span><span class="s4">,</span>
          <span class="s6">// Re-encode pathnames that were decoded inside matchRoutes</span>
          <span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation </span><span class="s4">? </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase</span><span class="s4">).</span><span class="s2">pathname </span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathnameBase</span>
        <span class="s4">])</span>
      <span class="s4">})</span>
    <span class="s4">),</span>
    <span class="s2">parentMatches</span><span class="s4">,</span>
    <span class="s2">dataRouterState</span><span class="s4">,</span>
    <span class="s2">future</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">locationArg </span><span class="s4">&amp;&amp; </span><span class="s2">renderedMatches</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">LocationContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">value</span><span class="s4">: {</span>
          <span class="s2">location</span><span class="s4">: {</span>
            <span class="s2">pathname</span><span class="s4">: </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
            <span class="s2">search</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
            <span class="s2">hash</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
            <span class="s2">state</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
            <span class="s2">key</span><span class="s4">: </span><span class="s5">&quot;default&quot;</span><span class="s4">,</span>
            <span class="s2">...location</span>
          <span class="s4">},</span>
          <span class="s2">navigationType</span><span class="s4">: </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span>
        <span class="s4">}</span>
      <span class="s4">},</span>
      <span class="s2">renderedMatches</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">renderedMatches</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">DefaultErrorComponent</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">useRouteError</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">message </span><span class="s4">= </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) ? </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">status</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">}</span><span class="s5">` </span><span class="s4">: </span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">Error </span><span class="s4">? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">message </span><span class="s4">: </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">stack </span><span class="s4">= </span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">Error </span><span class="s4">? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">: </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">lightgrey </span><span class="s4">= </span><span class="s5">&quot;rgba(200,200,200, 0.5)&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">preStyles </span><span class="s4">= { </span><span class="s2">padding</span><span class="s4">: </span><span class="s5">&quot;0.5rem&quot;</span><span class="s4">, </span><span class="s2">backgroundColor</span><span class="s4">: </span><span class="s2">lightgrey </span><span class="s4">};</span>
  <span class="s3">let </span><span class="s2">codeStyles </span><span class="s4">= { </span><span class="s2">padding</span><span class="s4">: </span><span class="s5">&quot;2px 4px&quot;</span><span class="s4">, </span><span class="s2">backgroundColor</span><span class="s4">: </span><span class="s2">lightgrey </span><span class="s4">};</span>
  <span class="s3">let </span><span class="s2">devInfo </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
      <span class="s5">&quot;Error handled by React Router default ErrorBoundary:&quot;</span><span class="s4">,</span>
      <span class="s2">error</span>
    <span class="s4">);</span>
    <span class="s2">devInfo </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React2</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s5">&quot;</span><span class="s3">\u{1F4BF} </span><span class="s5">Hey developer </span><span class="s3">\u{1F44B}</span><span class="s5">&quot;</span><span class="s4">), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s5">&quot;You can provide a way better UX than this when your app throws errors by providing your own &quot;</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;code&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: </span><span class="s2">codeStyles </span><span class="s4">}, </span><span class="s5">&quot;ErrorBoundary&quot;</span><span class="s4">), </span><span class="s5">&quot; or&quot;</span><span class="s4">, </span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;code&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: </span><span class="s2">codeStyles </span><span class="s4">}, </span><span class="s5">&quot;errorElement&quot;</span><span class="s4">), </span><span class="s5">&quot; prop on your route.&quot;</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React2</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;h2&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s5">&quot;Unexpected Application Error!&quot;</span><span class="s4">), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;h3&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: { </span><span class="s2">fontStyle</span><span class="s4">: </span><span class="s5">&quot;italic&quot; </span><span class="s4">} }, </span><span class="s2">message</span><span class="s4">), </span><span class="s2">stack </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;pre&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: </span><span class="s2">preStyles </span><span class="s4">}, </span><span class="s2">stack</span><span class="s4">) : </span><span class="s3">null</span><span class="s4">, </span><span class="s2">devInfo</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">defaultErrorElement </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">DefaultErrorComponent</span><span class="s4">, </span><span class="s3">null</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">RenderErrorBoundary </span><span class="s4">= </span><span class="s3">class extends </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">props</span><span class="s4">) {</span>
    <span class="s3">super</span><span class="s4">(</span><span class="s2">props</span><span class="s4">);</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">state </span><span class="s4">= {</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">revalidation</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">revalidation</span><span class="s4">,</span>
      <span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">static </span><span class="s2">getDerivedStateFromError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">error </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">static </span><span class="s2">getDerivedStateFromProps</span><span class="s4">(</span><span class="s2">props</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location </span><span class="s4">!== </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">revalidation </span><span class="s4">!== </span><span class="s5">&quot;idle&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">props</span><span class="s4">.</span><span class="s2">revalidation </span><span class="s4">=== </span><span class="s5">&quot;idle&quot;</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
        <span class="s2">revalidation</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">revalidation</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error </span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">revalidation</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">revalidation </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">revalidation</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">componentDidCatch</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">errorInfo</span><span class="s4">) {</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
      <span class="s5">&quot;React Router caught the following error during render&quot;</span><span class="s4">,</span>
      <span class="s2">error</span><span class="s4">,</span>
      <span class="s2">errorInfo</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">render</span><span class="s4">() {</span>
    <span class="s3">return this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s3">this</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">routeContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">RouteErrorContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">value</span><span class="s4">: </span><span class="s3">this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">,</span>
        <span class="s2">children</span><span class="s4">: </span><span class="s3">this</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">component</span>
      <span class="s4">}</span>
    <span class="s4">)) : </span><span class="s3">this</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">RenderedRoute</span><span class="s4">({ </span><span class="s2">routeContext</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">children </span><span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">dataRouterContext </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">dataRouterContext </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">static </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">staticContext </span><span class="s4">&amp;&amp; (</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">errorElement </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">)) {</span>
    <span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">staticContext</span><span class="s4">.</span><span class="s2">_deepestRenderedBoundaryId </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">routeContext </span><span class="s4">}, </span><span class="s2">children</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">_renderMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">parentMatches </span><span class="s4">= [], </span><span class="s2">dataRouterState </span><span class="s4">= </span><span class="s3">null</span><span class="s4">, </span><span class="s2">future </span><span class="s4">= </span><span class="s3">null</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">matches </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">dataRouterState</span><span class="s4">) {</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
      <span class="s2">matches </span><span class="s4">= </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">parentMatches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">&amp;&amp; !</span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">initialized </span><span class="s4">&amp;&amp; </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">matches </span><span class="s4">= </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">renderedMatches </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">errors </span><span class="s4">= </span><span class="s2">dataRouterState</span><span class="s4">?.</span><span class="s2">errors</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">errors </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">errorIndex </span><span class="s4">= </span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">&amp;&amp; </span><span class="s2">errors</span><span class="s4">?.[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] !== </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">errorIndex </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s5">`Could not find a matching route for errors on route IDs: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span>
        <span class="s2">errors</span>
      <span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">`</span>
    <span class="s4">);</span>
    <span class="s2">renderedMatches </span><span class="s4">= </span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span>
      <span class="s7">0</span><span class="s4">,</span>
      <span class="s2">Math</span><span class="s4">.</span><span class="s2">min</span><span class="s4">(</span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">errorIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">)</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">renderFallback </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">fallbackIndex </span><span class="s4">= -</span><span class="s7">1</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">dataRouterState</span><span class="s4">) {</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
      <span class="s3">let </span><span class="s2">match </span><span class="s4">= </span><span class="s2">renderedMatches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hydrateFallbackElement</span><span class="s4">) {</span>
        <span class="s2">fallbackIndex </span><span class="s4">= </span><span class="s2">i</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">: </span><span class="s2">errors2 </span><span class="s4">} = </span><span class="s2">dataRouterState</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s2">needsToRunLoader </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">&amp;&amp; !</span><span class="s2">loaderData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) &amp;&amp; (!</span><span class="s2">errors2 </span><span class="s4">|| </span><span class="s2">errors2</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] === </span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">|| </span><span class="s2">needsToRunLoader</span><span class="s4">) {</span>
          <span class="s2">renderFallback </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">fallbackIndex </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">) {</span>
            <span class="s2">renderedMatches </span><span class="s4">= </span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">fallbackIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">);</span>
          <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
            <span class="s2">renderedMatches </span><span class="s4">= [</span><span class="s2">renderedMatches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]];</span>
          <span class="s4">}</span>
          <span class="s3">break</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">reduceRight</span><span class="s4">((</span><span class="s2">outlet</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">error</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">shouldRenderHydrateFallback </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">errorElement </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">hydrateFallbackElement </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">dataRouterState</span><span class="s4">) {</span>
      <span class="s2">error </span><span class="s4">= </span><span class="s2">errors </span><span class="s4">&amp;&amp; </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">? </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s2">errorElement </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">errorElement </span><span class="s4">|| </span><span class="s2">defaultErrorElement</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">renderFallback</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">fallbackIndex </span><span class="s4">&lt; </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s2">index </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s2">warningOnce</span><span class="s4">(</span>
            <span class="s5">&quot;route-fallback&quot;</span><span class="s4">,</span>
            <span class="s3">false</span><span class="s4">,</span>
            <span class="s5">&quot;No `HydrateFallback` element provided to render during initial hydration&quot;</span>
          <span class="s4">);</span>
          <span class="s2">shouldRenderHydrateFallback </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
          <span class="s2">hydrateFallbackElement </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">fallbackIndex </span><span class="s4">=== </span><span class="s2">index</span><span class="s4">) {</span>
          <span class="s2">shouldRenderHydrateFallback </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
          <span class="s2">hydrateFallbackElement </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hydrateFallbackElement </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">matches2 </span><span class="s4">= </span><span class="s2">parentMatches</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">renderedMatches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">index </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">));</span>
    <span class="s3">let </span><span class="s2">getChildren </span><span class="s4">= () =&gt; {</span>
      <span class="s3">let </span><span class="s2">children</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
        <span class="s2">children </span><span class="s4">= </span><span class="s2">errorElement</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">shouldRenderHydrateFallback</span><span class="s4">) {</span>
        <span class="s2">children </span><span class="s4">= </span><span class="s2">hydrateFallbackElement</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">) {</span>
        <span class="s2">children </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">, </span><span class="s3">null</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">element</span><span class="s4">) {</span>
        <span class="s2">children </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">element</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">children </span><span class="s4">= </span><span class="s2">outlet</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
        <span class="s2">RenderedRoute</span><span class="s4">,</span>
        <span class="s4">{</span>
          <span class="s2">match</span><span class="s4">,</span>
          <span class="s2">routeContext</span><span class="s4">: {</span>
            <span class="s2">outlet</span><span class="s4">,</span>
            <span class="s2">matches</span><span class="s4">: </span><span class="s2">matches2</span><span class="s4">,</span>
            <span class="s2">isDataRoute</span><span class="s4">: </span><span class="s2">dataRouterState </span><span class="s4">!= </span><span class="s3">null</span>
          <span class="s4">},</span>
          <span class="s2">children</span>
        <span class="s4">}</span>
      <span class="s4">);</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">dataRouterState </span><span class="s4">&amp;&amp; (</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">|| </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">errorElement </span><span class="s4">|| </span><span class="s2">index </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) ? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">RenderErrorBoundary</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">location</span><span class="s4">: </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
        <span class="s2">revalidation</span><span class="s4">: </span><span class="s2">dataRouterState</span><span class="s4">.</span><span class="s2">revalidation</span><span class="s4">,</span>
        <span class="s2">component</span><span class="s4">: </span><span class="s2">errorElement</span><span class="s4">,</span>
        <span class="s2">error</span><span class="s4">,</span>
        <span class="s2">children</span><span class="s4">: </span><span class="s2">getChildren</span><span class="s4">(),</span>
        <span class="s2">routeContext</span><span class="s4">: { </span><span class="s2">outlet</span><span class="s4">: </span><span class="s3">null</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">matches2</span><span class="s4">, </span><span class="s2">isDataRoute</span><span class="s4">: </span><span class="s3">true </span><span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">) : </span><span class="s2">getChildren</span><span class="s4">();</span>
  <span class="s4">}, </span><span class="s3">null</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getDataRouterConsoleError</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">hookName</span><span class="s4">} </span><span class="s5">must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useDataRouterContext</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">ctx </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">ctx</span><span class="s4">, </span><span class="s2">getDataRouterConsoleError</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">ctx</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">state</span><span class="s4">, </span><span class="s2">getDataRouterConsoleError</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRouteContext</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">getDataRouterConsoleError</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">route</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">useRouteContext</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">thisRoute </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">];</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">thisRoute</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
    <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">hookName</span><span class="s4">} </span><span class="s5">can only be used on routes that contain a unique &quot;id&quot;`</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">thisRoute</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRouteId</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s5">&quot;useRouteId&quot; </span><span class="s6">/* UseRouteId */</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useNavigation</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useNavigation&quot; </span><span class="s6">/* UseNavigation */</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRevalidator</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">dataRouterContext </span><span class="s4">= </span><span class="s2">useDataRouterContext</span><span class="s4">(</span><span class="s5">&quot;useRevalidator&quot; </span><span class="s6">/* UseRevalidator */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useRevalidator&quot; </span><span class="s6">/* UseRevalidator */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">revalidate </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
    <span class="s3">await </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">router</span><span class="s4">.</span><span class="s2">revalidate</span><span class="s4">();</span>
  <span class="s4">}, [</span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">router</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; ({ </span><span class="s2">revalidate</span><span class="s4">, </span><span class="s2">state</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">revalidation </span><span class="s4">}),</span>
    <span class="s4">[</span><span class="s2">revalidate</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">revalidation</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useMatches</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">loaderData </span><span class="s4">} = </span><span class="s2">useDataRouterState</span><span class="s4">(</span>
    <span class="s5">&quot;useMatches&quot; </span><span class="s6">/* UseMatches */</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">convertRouteMatchToUiMatch</span><span class="s4">(</span><span class="s2">m</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">)),</span>
    <span class="s4">[</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">loaderData</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useLoaderData</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useLoaderData&quot; </span><span class="s6">/* UseLoaderData */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s5">&quot;useLoaderData&quot; </span><span class="s6">/* UseLoaderData */</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRouteLoaderData</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useRouteLoaderData&quot; </span><span class="s6">/* UseRouteLoaderData */</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useActionData</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useActionData&quot; </span><span class="s6">/* UseActionData */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s5">&quot;useLoaderData&quot; </span><span class="s6">/* UseLoaderData */</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">? </span><span class="s2">state</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useRouteError</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteErrorContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useRouteError&quot; </span><span class="s6">/* UseRouteError */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s5">&quot;useRouteError&quot; </span><span class="s6">/* UseRouteError */</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">error</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">?.[</span><span class="s2">routeId</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useAsyncValue</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">AwaitContext</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">value</span><span class="s4">?.</span><span class="s2">_data</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useAsyncError</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">AwaitContext</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">value</span><span class="s4">?.</span><span class="s2">_error</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">blockerId </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">useBlocker</span><span class="s4">(</span><span class="s2">shouldBlock</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router</span><span class="s4">, </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">useDataRouterContext</span><span class="s4">(</span><span class="s5">&quot;useBlocker&quot; </span><span class="s6">/* UseBlocker */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState</span><span class="s4">(</span><span class="s5">&quot;useBlocker&quot; </span><span class="s6">/* UseBlocker */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">setBlockerKey</span><span class="s4">] = </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">blockerFunction </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">arg</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">shouldBlock </span><span class="s4">!== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s4">!!</span><span class="s2">shouldBlock</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">=== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">shouldBlock</span><span class="s4">(</span><span class="s2">arg</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">currentLocation</span><span class="s4">, </span><span class="s2">nextLocation</span><span class="s4">, </span><span class="s2">historyAction </span><span class="s4">} = </span><span class="s2">arg</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">shouldBlock</span><span class="s4">({</span>
        <span class="s2">currentLocation</span><span class="s4">: {</span>
          <span class="s2">...currentLocation</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">: </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">currentLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">currentLocation</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">},</span>
        <span class="s2">nextLocation</span><span class="s4">: {</span>
          <span class="s2">...nextLocation</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">: </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">nextLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">nextLocation</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">},</span>
        <span class="s2">historyAction</span>
      <span class="s4">});</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">shouldBlock</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React2</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">String</span><span class="s4">(++</span><span class="s2">blockerId</span><span class="s4">);</span>
    <span class="s2">setBlockerKey</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">deleteBlocker</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
  <span class="s4">}, [</span><span class="s2">router</span><span class="s4">]);</span>
  <span class="s2">React2</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blockerKey </span><span class="s4">!== </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
      <span class="s2">router</span><span class="s4">.</span><span class="s2">getBlocker</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">blockerFunction</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">router</span><span class="s4">, </span><span class="s2">blockerKey</span><span class="s4">, </span><span class="s2">blockerFunction</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s2">blockerKey </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">) ? </span><span class="s2">state</span><span class="s4">.</span><span class="s2">blockers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">blockerKey</span><span class="s4">) : </span><span class="s2">IDLE_BLOCKER</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useNavigateStable</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router </span><span class="s4">} = </span><span class="s2">useDataRouterContext</span><span class="s4">(</span><span class="s5">&quot;useNavigate&quot; </span><span class="s6">/* UseNavigateStable */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">useCurrentRouteId</span><span class="s4">(</span><span class="s5">&quot;useNavigate&quot; </span><span class="s6">/* UseNavigateStable */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">activeRef </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s2">useIsomorphicLayoutEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">navigate </span><span class="s4">= </span><span class="s2">React2</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s2">async </span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">options </span><span class="s4">= {}) =&gt; {</span>
      <span class="s2">warning</span><span class="s4">(</span><span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">, </span><span class="s2">navigateEffectWarning</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">activeRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
        <span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">fromRouteId</span><span class="s4">: </span><span class="s2">id</span><span class="s4">, </span><span class="s2">...options </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">router</span><span class="s4">, </span><span class="s2">id</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">navigate</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">alreadyWarned </span><span class="s4">= {};</span>
<span class="s3">function </span><span class="s2">warningOnce</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">cond</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">cond </span><span class="s4">&amp;&amp; !</span><span class="s2">alreadyWarned</span><span class="s4">[</span><span class="s2">key</span><span class="s4">]) {</span>
    <span class="s2">alreadyWarned</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">warning</span><span class="s4">(</span><span class="s3">false</span><span class="s4">, </span><span class="s2">message</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/warnings.ts</span>
<span class="s3">var </span><span class="s2">alreadyWarned2 </span><span class="s4">= {};</span>
<span class="s3">function </span><span class="s2">warnOnce</span><span class="s4">(</span><span class="s2">condition</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">condition </span><span class="s4">&amp;&amp; !</span><span class="s2">alreadyWarned2</span><span class="s4">[</span><span class="s2">message</span><span class="s4">]) {</span>
    <span class="s2">alreadyWarned2</span><span class="s4">[</span><span class="s2">message</span><span class="s4">] = </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">warn</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/components.tsx</span>
<span class="s3">function </span><span class="s2">mapRouteProperties</span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">updates </span><span class="s4">= {</span>
    <span class="s6">// Note: this check also occurs in createRoutesFromChildren so update</span>
    <span class="s6">// there if you change this -- please and thank you!</span>
    <span class="s2">hasErrorBoundary</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasErrorBoundary </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">errorElement </span><span class="s4">!= </span><span class="s3">null</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">element</span><span class="s4">) {</span>
        <span class="s2">warning</span><span class="s4">(</span>
          <span class="s3">false</span><span class="s4">,</span>
          <span class="s5">&quot;You should not include both `Component` and `element` on your route - `Component` will be used.&quot;</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">updates</span><span class="s4">, {</span>
      <span class="s2">element</span><span class="s4">: </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">),</span>
      <span class="s2">Component</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hydrateFallbackElement</span><span class="s4">) {</span>
        <span class="s2">warning</span><span class="s4">(</span>
          <span class="s3">false</span><span class="s4">,</span>
          <span class="s5">&quot;You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used.&quot;</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">updates</span><span class="s4">, {</span>
      <span class="s2">hydrateFallbackElement</span><span class="s4">: </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback</span><span class="s4">),</span>
      <span class="s2">HydrateFallback</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">ENABLE_DEV_WARNINGS</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">errorElement</span><span class="s4">) {</span>
        <span class="s2">warning</span><span class="s4">(</span>
          <span class="s3">false</span><span class="s4">,</span>
          <span class="s5">&quot;You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used.&quot;</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">updates</span><span class="s4">, {</span>
      <span class="s2">errorElement</span><span class="s4">: </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">),</span>
      <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">updates</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">hydrationRouteProperties </span><span class="s4">= [</span>
  <span class="s5">&quot;HydrateFallback&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;hydrateFallbackElement&quot;</span>
<span class="s4">];</span>
<span class="s3">function </span><span class="s2">createMemoryRouter</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">createRouter</span><span class="s4">({</span>
    <span class="s2">basename</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">basename</span><span class="s4">,</span>
    <span class="s2">unstable_getContext</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">unstable_getContext</span><span class="s4">,</span>
    <span class="s2">future</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">future</span><span class="s4">,</span>
    <span class="s2">history</span><span class="s4">: </span><span class="s2">createMemoryHistory</span><span class="s4">({</span>
      <span class="s2">initialEntries</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">initialEntries</span><span class="s4">,</span>
      <span class="s2">initialIndex</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">initialIndex</span>
    <span class="s4">}),</span>
    <span class="s2">hydrationData</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">hydrationData</span><span class="s4">,</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">hydrationRouteProperties</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span><span class="s4">,</span>
    <span class="s2">dataStrategy</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">dataStrategy</span><span class="s4">,</span>
    <span class="s2">patchRoutesOnNavigation</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">patchRoutesOnNavigation</span>
  <span class="s4">}).</span><span class="s2">initialize</span><span class="s4">();</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">Deferred </span><span class="s4">= </span><span class="s3">class </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">() {</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">= </span><span class="s5">&quot;pending&quot;</span><span class="s4">;</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">promise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">, </span><span class="s2">reject</span><span class="s4">) =&gt; {</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">resolve </span><span class="s4">= (</span><span class="s2">value</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s5">&quot;pending&quot;</span><span class="s4">) {</span>
          <span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">= </span><span class="s5">&quot;resolved&quot;</span><span class="s4">;</span>
          <span class="s2">resolve</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">};</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">reject </span><span class="s4">= (</span><span class="s2">reason</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s5">&quot;pending&quot;</span><span class="s4">) {</span>
          <span class="s3">this</span><span class="s4">.</span><span class="s2">status </span><span class="s4">= </span><span class="s5">&quot;rejected&quot;</span><span class="s4">;</span>
          <span class="s2">reject</span><span class="s4">(</span><span class="s2">reason</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">};</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">RouterProvider</span><span class="s4">({</span>
  <span class="s2">router</span><span class="s4">,</span>
  <span class="s2">flushSync</span><span class="s4">: </span><span class="s2">reactDomFlushSyncImpl</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">state</span><span class="s4">, </span><span class="s2">setStateImpl</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">(</span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">pendingState</span><span class="s4">, </span><span class="s2">setPendingState</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">vtContext</span><span class="s4">, </span><span class="s2">setVtContext</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">({</span>
    <span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">false</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">renderDfd</span><span class="s4">, </span><span class="s2">setRenderDfd</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">transition</span><span class="s4">, </span><span class="s2">setTransition</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">interruption</span><span class="s4">, </span><span class="s2">setInterruption</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">fetcherData </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">());</span>
  <span class="s3">let </span><span class="s2">setState </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newState</span><span class="s4">, { </span><span class="s2">deletedFetchers</span><span class="s4">, </span><span class="s2">flushSync</span><span class="s4">, </span><span class="s2">viewTransitionOpts </span><span class="s4">}) =&gt; {</span>
      <span class="s2">newState</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">fetcher</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">data </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s2">fetcherData</span><span class="s4">.</span><span class="s2">current</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fetcher</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">});</span>
      <span class="s2">deletedFetchers</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">key</span><span class="s4">) =&gt; </span><span class="s2">fetcherData</span><span class="s4">.</span><span class="s2">current</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">key</span><span class="s4">));</span>
      <span class="s2">warnOnce</span><span class="s4">(</span>
        <span class="s2">flushSync </span><span class="s4">=== </span><span class="s3">false </span><span class="s4">|| </span><span class="s2">reactDomFlushSyncImpl </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s5">'You provided the `flushSync` option to a router update, but you are not using the `&lt;RouterProvider&gt;` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from &quot;react-router/dom&quot;` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.'</span>
      <span class="s4">);</span>
      <span class="s3">let </span><span class="s2">isViewTransitionAvailable </span><span class="s4">= </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">.</span><span class="s2">document </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">startViewTransition </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">;</span>
      <span class="s2">warnOnce</span><span class="s4">(</span>
        <span class="s2">viewTransitionOpts </span><span class="s4">== </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">isViewTransitionAvailable</span><span class="s4">,</span>
        <span class="s5">&quot;You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available.&quot;</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">viewTransitionOpts </span><span class="s4">|| !</span><span class="s2">isViewTransitionAvailable</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">reactDomFlushSyncImpl </span><span class="s4">&amp;&amp; </span><span class="s2">flushSync</span><span class="s4">) {</span>
          <span class="s2">reactDomFlushSyncImpl</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">React3</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
        <span class="s4">}</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">reactDomFlushSyncImpl </span><span class="s4">&amp;&amp; </span><span class="s2">flushSync</span><span class="s4">) {</span>
        <span class="s2">reactDomFlushSyncImpl</span><span class="s4">(() =&gt; {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">transition</span><span class="s4">) {</span>
            <span class="s2">renderDfd </span><span class="s4">&amp;&amp; </span><span class="s2">renderDfd</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
            <span class="s2">transition</span><span class="s4">.</span><span class="s2">skipTransition</span><span class="s4">();</span>
          <span class="s4">}</span>
          <span class="s2">setVtContext</span><span class="s4">({</span>
            <span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
            <span class="s2">flushSync</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
            <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">,</span>
            <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">nextLocation</span>
          <span class="s4">});</span>
        <span class="s4">});</span>
        <span class="s3">let </span><span class="s2">t </span><span class="s4">= </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">startViewTransition</span><span class="s4">(() =&gt; {</span>
          <span class="s2">reactDomFlushSyncImpl</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
        <span class="s4">});</span>
        <span class="s2">t</span><span class="s4">.</span><span class="s2">finished</span><span class="s4">.</span><span class="s2">finally</span><span class="s4">(() =&gt; {</span>
          <span class="s2">reactDomFlushSyncImpl</span><span class="s4">(() =&gt; {</span>
            <span class="s2">setRenderDfd</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
            <span class="s2">setTransition</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
            <span class="s2">setPendingState</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
            <span class="s2">setVtContext</span><span class="s4">({ </span><span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">false </span><span class="s4">});</span>
          <span class="s4">});</span>
        <span class="s4">});</span>
        <span class="s2">reactDomFlushSyncImpl</span><span class="s4">(() =&gt; </span><span class="s2">setTransition</span><span class="s4">(</span><span class="s2">t</span><span class="s4">));</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">transition</span><span class="s4">) {</span>
        <span class="s2">renderDfd </span><span class="s4">&amp;&amp; </span><span class="s2">renderDfd</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
        <span class="s2">transition</span><span class="s4">.</span><span class="s2">skipTransition</span><span class="s4">();</span>
        <span class="s2">setInterruption</span><span class="s4">({</span>
          <span class="s2">state</span><span class="s4">: </span><span class="s2">newState</span><span class="s4">,</span>
          <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">,</span>
          <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">nextLocation</span>
        <span class="s4">});</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">setPendingState</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">);</span>
        <span class="s2">setVtContext</span><span class="s4">({</span>
          <span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
          <span class="s2">flushSync</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
          <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">,</span>
          <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">viewTransitionOpts</span><span class="s4">.</span><span class="s2">nextLocation</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">, </span><span class="s2">reactDomFlushSyncImpl</span><span class="s4">, </span><span class="s2">transition</span><span class="s4">, </span><span class="s2">renderDfd</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">subscribe</span><span class="s4">(</span><span class="s2">setState</span><span class="s4">), [</span><span class="s2">router</span><span class="s4">, </span><span class="s2">setState</span><span class="s4">]);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">isTransitioning </span><span class="s4">&amp;&amp; !</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">) {</span>
      <span class="s2">setRenderDfd</span><span class="s4">(</span><span class="s3">new </span><span class="s2">Deferred</span><span class="s4">());</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">vtContext</span><span class="s4">]);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">renderDfd </span><span class="s4">&amp;&amp; </span><span class="s2">pendingState </span><span class="s4">&amp;&amp; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">newState </span><span class="s4">= </span><span class="s2">pendingState</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">renderPromise </span><span class="s4">= </span><span class="s2">renderDfd</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">transition2 </span><span class="s4">= </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">startViewTransition</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
        <span class="s2">React3</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
        <span class="s3">await </span><span class="s2">renderPromise</span><span class="s4">;</span>
      <span class="s4">});</span>
      <span class="s2">transition2</span><span class="s4">.</span><span class="s2">finished</span><span class="s4">.</span><span class="s2">finally</span><span class="s4">(() =&gt; {</span>
        <span class="s2">setRenderDfd</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
        <span class="s2">setTransition</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
        <span class="s2">setPendingState</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
        <span class="s2">setVtContext</span><span class="s4">({ </span><span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">false </span><span class="s4">});</span>
      <span class="s4">});</span>
      <span class="s2">setTransition</span><span class="s4">(</span><span class="s2">transition2</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">pendingState</span><span class="s4">, </span><span class="s2">renderDfd</span><span class="s4">, </span><span class="s2">router</span><span class="s4">.</span><span class="s2">window</span><span class="s4">]);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">renderDfd </span><span class="s4">&amp;&amp; </span><span class="s2">pendingState </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">key </span><span class="s4">=== </span><span class="s2">pendingState</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">key</span><span class="s4">) {</span>
      <span class="s2">renderDfd</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">renderDfd</span><span class="s4">, </span><span class="s2">transition</span><span class="s4">, </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">, </span><span class="s2">pendingState</span><span class="s4">]);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">isTransitioning </span><span class="s4">&amp;&amp; </span><span class="s2">interruption</span><span class="s4">) {</span>
      <span class="s2">setPendingState</span><span class="s4">(</span><span class="s2">interruption</span><span class="s4">.</span><span class="s2">state</span><span class="s4">);</span>
      <span class="s2">setVtContext</span><span class="s4">({</span>
        <span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">flushSync</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">currentLocation</span><span class="s4">: </span><span class="s2">interruption</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">,</span>
        <span class="s2">nextLocation</span><span class="s4">: </span><span class="s2">interruption</span><span class="s4">.</span><span class="s2">nextLocation</span>
      <span class="s4">});</span>
      <span class="s2">setInterruption</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">isTransitioning</span><span class="s4">, </span><span class="s2">interruption</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">navigator </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(() =&gt; {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">createHref</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">createHref</span><span class="s4">,</span>
      <span class="s2">encodeLocation</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">,</span>
      <span class="s2">go</span><span class="s4">: (</span><span class="s2">n</span><span class="s4">) =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">n</span><span class="s4">),</span>
      <span class="s2">push</span><span class="s4">: (</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state2</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, {</span>
        <span class="s2">state</span><span class="s4">: </span><span class="s2">state2</span><span class="s4">,</span>
        <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">preventScrollReset</span>
      <span class="s4">}),</span>
      <span class="s2">replace</span><span class="s4">: (</span><span class="s2">to</span><span class="s4">, </span><span class="s2">state2</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, {</span>
        <span class="s2">replace</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">state</span><span class="s4">: </span><span class="s2">state2</span><span class="s4">,</span>
        <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">preventScrollReset</span>
      <span class="s4">})</span>
    <span class="s4">};</span>
  <span class="s4">}, [</span><span class="s2">router</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">basename </span><span class="s4">= </span><span class="s2">router</span><span class="s4">.</span><span class="s2">basename </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">dataRouterContext </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; ({</span>
      <span class="s2">router</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">,</span>
      <span class="s3">static</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">basename</span>
    <span class="s4">}),</span>
    <span class="s4">[</span><span class="s2">router</span><span class="s4">, </span><span class="s2">navigator</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React3</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">dataRouterContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">state </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">FetchersContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">fetcherData</span><span class="s4">.</span><span class="s2">current </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">ViewTransitionContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">vtContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">historyAction</span><span class="s4">,</span>
      <span class="s2">navigator</span>
    <span class="s4">},</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">MemoizedDataRoutes</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">routes</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">,</span>
        <span class="s2">future</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
        <span class="s2">state</span>
      <span class="s4">}</span>
    <span class="s4">)</span>
  <span class="s4">))))), </span><span class="s3">null</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">MemoizedDataRoutes </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">memo</span><span class="s4">(</span><span class="s2">DataRoutes</span><span class="s4">);</span>
<span class="s3">function </span><span class="s2">DataRoutes</span><span class="s4">({</span>
  <span class="s2">routes</span><span class="s4">,</span>
  <span class="s2">future</span><span class="s4">,</span>
  <span class="s2">state</span>
<span class="s4">}) {</span>
  <span class="s3">return </span><span class="s2">useRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s3">void </span><span class="s7">0</span><span class="s4">, </span><span class="s2">state</span><span class="s4">, </span><span class="s2">future</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">MemoryRouter</span><span class="s4">({</span>
  <span class="s2">basename</span><span class="s4">,</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">initialEntries</span><span class="s4">,</span>
  <span class="s2">initialIndex</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">historyRef </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s2">createMemoryHistory</span><span class="s4">({</span>
      <span class="s2">initialEntries</span><span class="s4">,</span>
      <span class="s2">initialIndex</span><span class="s4">,</span>
      <span class="s2">v5Compat</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">history </span><span class="s4">= </span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">state</span><span class="s4">, </span><span class="s2">setStateImpl</span><span class="s4">] = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">({</span>
    <span class="s2">action</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">setState </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newState</span><span class="s4">) =&gt; {</span>
      <span class="s2">React3</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">setStateImpl</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; </span><span class="s2">history</span><span class="s4">.</span><span class="s2">listen</span><span class="s4">(</span><span class="s2">setState</span><span class="s4">), [</span><span class="s2">history</span><span class="s4">, </span><span class="s2">setState</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">history</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Navigate</span><span class="s4">({</span>
  <span class="s2">to</span><span class="s4">,</span>
  <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
  <span class="s2">state</span><span class="s4">,</span>
  <span class="s2">relative</span>
<span class="s4">}) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s6">// TODO: This error is probably because they somehow have 2 versions of</span>
    <span class="s6">// the router loaded. We can help them understand how to avoid that.</span>
    <span class="s5">`&lt;Navigate&gt; may be used only in the context of a &lt;Router&gt; component.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s3">static</span><span class="s4">: </span><span class="s2">isStatic </span><span class="s4">} = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s2">warning</span><span class="s4">(</span>
    <span class="s4">!</span><span class="s2">isStatic</span><span class="s4">,</span>
    <span class="s5">`&lt;Navigate&gt; must not be used on the initial render in a &lt;StaticRouter&gt;. This is a no-op, but you should modify your code so the &lt;Navigate&gt; is only ever rendered in response to some user interaction or state change.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches </span><span class="s4">} = </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname</span><span class="s4">: </span><span class="s2">locationPathname </span><span class="s4">} = </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">navigate </span><span class="s4">= </span><span class="s2">useNavigate</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">resolveTo</span><span class="s4">(</span>
    <span class="s2">to</span><span class="s4">,</span>
    <span class="s2">getResolveToMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">),</span>
    <span class="s2">locationPathname</span><span class="s4">,</span>
    <span class="s2">relative </span><span class="s4">=== </span><span class="s5">&quot;path&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">jsonPath </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">navigate</span><span class="s4">(</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">jsonPath</span><span class="s4">), { </span><span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">, </span><span class="s2">state</span><span class="s4">, </span><span class="s2">relative </span><span class="s4">});</span>
  <span class="s4">}, [</span><span class="s2">navigate</span><span class="s4">, </span><span class="s2">jsonPath</span><span class="s4">, </span><span class="s2">relative</span><span class="s4">, </span><span class="s2">replace2</span><span class="s4">, </span><span class="s2">state</span><span class="s4">]);</span>
  <span class="s3">return null</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Outlet</span><span class="s4">(</span><span class="s2">props</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">useOutlet</span><span class="s4">(</span><span class="s2">props</span><span class="s4">.</span><span class="s2">context</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Route</span><span class="s4">(</span><span class="s2">_props</span><span class="s4">) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s3">false</span><span class="s4">,</span>
    <span class="s5">`A &lt;Route&gt; is only ever to be used as the child of &lt;Routes&gt; element, never rendered directly. Please wrap your &lt;Route&gt; in a &lt;Routes&gt;.`</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Router</span><span class="s4">({</span>
  <span class="s2">basename</span><span class="s4">: </span><span class="s2">basenameProp </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
  <span class="s2">children </span><span class="s4">= </span><span class="s3">null</span><span class="s4">,</span>
  <span class="s2">location</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">,</span>
  <span class="s2">navigationType </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">,</span>
  <span class="s2">navigator</span><span class="s4">,</span>
  <span class="s3">static</span><span class="s4">: </span><span class="s2">staticProp </span><span class="s4">= </span><span class="s3">false</span>
<span class="s4">}) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s4">!</span><span class="s2">useInRouterContext</span><span class="s4">(),</span>
    <span class="s5">`You cannot render a &lt;Router&gt; inside another &lt;Router&gt;. You should never have more than one in your app.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">basename </span><span class="s4">= </span><span class="s2">basenameProp</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\/*/</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">navigationContext </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; ({</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">,</span>
      <span class="s3">static</span><span class="s4">: </span><span class="s2">staticProp</span><span class="s4">,</span>
      <span class="s2">future</span><span class="s4">: {}</span>
    <span class="s4">}),</span>
    <span class="s4">[</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">navigator</span><span class="s4">, </span><span class="s2">staticProp</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">locationProp </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
    <span class="s2">locationProp </span><span class="s4">= </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">locationProp</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">{</span>
    <span class="s2">pathname </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
    <span class="s2">search </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">hash </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">state </span><span class="s4">= </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s2">key </span><span class="s4">= </span><span class="s5">&quot;default&quot;</span>
  <span class="s4">} = </span><span class="s2">locationProp</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">locationContext </span><span class="s4">= </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">trailingPathname </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">trailingPathname </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">location</span><span class="s4">: {</span>
        <span class="s2">pathname</span><span class="s4">: </span><span class="s2">trailingPathname</span><span class="s4">,</span>
        <span class="s2">search</span><span class="s4">,</span>
        <span class="s2">hash</span><span class="s4">,</span>
        <span class="s2">state</span><span class="s4">,</span>
        <span class="s2">key</span>
      <span class="s4">},</span>
      <span class="s2">navigationType</span>
    <span class="s4">};</span>
  <span class="s4">}, [</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">search</span><span class="s4">, </span><span class="s2">hash</span><span class="s4">, </span><span class="s2">state</span><span class="s4">, </span><span class="s2">key</span><span class="s4">, </span><span class="s2">navigationType</span><span class="s4">]);</span>
  <span class="s2">warning</span><span class="s4">(</span>
    <span class="s2">locationContext </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s5">`&lt;Router basename=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">basename</span><span class="s4">}</span><span class="s5">&quot;&gt; is not able to match the URL &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pathname</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">search</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">hash</span><span class="s4">}</span><span class="s5">&quot; because it does not start with the basename, so the &lt;Router&gt; won't render anything.`</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">locationContext </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">navigationContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">LocationContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">children</span><span class="s4">, </span><span class="s2">value</span><span class="s4">: </span><span class="s2">locationContext </span><span class="s4">}));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Routes</span><span class="s4">({</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">location</span>
<span class="s4">}) {</span>
  <span class="s3">return </span><span class="s2">useRoutes</span><span class="s4">(</span><span class="s2">createRoutesFromChildren</span><span class="s4">(</span><span class="s2">children</span><span class="s4">), </span><span class="s2">location</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Await</span><span class="s4">({</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">errorElement</span><span class="s4">,</span>
  <span class="s2">resolve</span>
<span class="s4">}) {</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">AwaitErrorBoundary</span><span class="s4">, { </span><span class="s2">resolve</span><span class="s4">, </span><span class="s2">errorElement </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">ResolveAwait</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">children</span><span class="s4">));</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">AwaitErrorBoundary </span><span class="s4">= </span><span class="s3">class extends </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">props</span><span class="s4">) {</span>
    <span class="s3">super</span><span class="s4">(</span><span class="s2">props</span><span class="s4">);</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">state </span><span class="s4">= { </span><span class="s2">error</span><span class="s4">: </span><span class="s3">null </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">static </span><span class="s2">getDerivedStateFromError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">error </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">componentDidCatch</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">errorInfo</span><span class="s4">) {</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
      <span class="s5">&quot;&lt;Await&gt; caught the following error during render&quot;</span><span class="s4">,</span>
      <span class="s2">error</span><span class="s4">,</span>
      <span class="s2">errorInfo</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">render</span><span class="s4">() {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">children</span><span class="s4">, </span><span class="s2">errorElement</span><span class="s4">, </span><span class="s2">resolve </span><span class="s4">} = </span><span class="s3">this</span><span class="s4">.</span><span class="s2">props</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">status </span><span class="s4">= </span><span class="s7">0 </span><span class="s6">/* pending */</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!(</span><span class="s2">resolve </span><span class="s3">instanceof </span><span class="s2">Promise</span><span class="s4">)) {</span>
      <span class="s2">status </span><span class="s4">= </span><span class="s7">1 </span><span class="s6">/* success */</span><span class="s4">;</span>
      <span class="s2">promise </span><span class="s4">= </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">promise</span><span class="s4">, </span><span class="s5">&quot;_tracked&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s3">true </span><span class="s4">});</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">promise</span><span class="s4">, </span><span class="s5">&quot;_data&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s2">resolve </span><span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s3">this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">status </span><span class="s4">= </span><span class="s7">2 </span><span class="s6">/* error */</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">renderError </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
      <span class="s2">promise </span><span class="s4">= </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">().</span><span class="s2">catch</span><span class="s4">(() =&gt; {</span>
      <span class="s4">});</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">promise</span><span class="s4">, </span><span class="s5">&quot;_tracked&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s3">true </span><span class="s4">});</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">promise</span><span class="s4">, </span><span class="s5">&quot;_error&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s2">renderError </span><span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">resolve</span><span class="s4">.</span><span class="s2">_tracked</span><span class="s4">) {</span>
      <span class="s2">promise </span><span class="s4">= </span><span class="s2">resolve</span><span class="s4">;</span>
      <span class="s2">status </span><span class="s4">= </span><span class="s5">&quot;_error&quot; </span><span class="s3">in </span><span class="s2">promise </span><span class="s4">? </span><span class="s7">2 </span><span class="s6">/* error */ </span><span class="s4">: </span><span class="s5">&quot;_data&quot; </span><span class="s3">in </span><span class="s2">promise </span><span class="s4">? </span><span class="s7">1 </span><span class="s6">/* success */ </span><span class="s4">: </span><span class="s7">0 </span><span class="s6">/* pending */</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">status </span><span class="s4">= </span><span class="s7">0 </span><span class="s6">/* pending */</span><span class="s4">;</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">resolve</span><span class="s4">, </span><span class="s5">&quot;_tracked&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s3">true </span><span class="s4">});</span>
      <span class="s2">promise </span><span class="s4">= </span><span class="s2">resolve</span><span class="s4">.</span><span class="s2">then</span><span class="s4">(</span>
        <span class="s4">(</span><span class="s2">data2</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">resolve</span><span class="s4">, </span><span class="s5">&quot;_data&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s2">data2 </span><span class="s4">}),</span>
        <span class="s4">(</span><span class="s2">error</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">resolve</span><span class="s4">, </span><span class="s5">&quot;_error&quot;</span><span class="s4">, { </span><span class="s2">get</span><span class="s4">: () =&gt; </span><span class="s2">error </span><span class="s4">})</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">2 </span><span class="s6">/* error */ </span><span class="s4">&amp;&amp; !</span><span class="s2">errorElement</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">promise</span><span class="s4">.</span><span class="s2">_error</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">2 </span><span class="s6">/* error */</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">AwaitContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">promise</span><span class="s4">, </span><span class="s2">children</span><span class="s4">: </span><span class="s2">errorElement </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">1 </span><span class="s6">/* success */</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">AwaitContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">promise</span><span class="s4">, </span><span class="s2">children </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">throw </span><span class="s2">promise</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">ResolveAwait</span><span class="s4">({</span>
  <span class="s2">children</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">useAsyncValue</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">toRender </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">children </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">children</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">) : </span><span class="s2">children</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React3</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">toRender</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createRoutesFromChildren</span><span class="s4">(</span><span class="s2">children</span><span class="s4">, </span><span class="s2">parentPath </span><span class="s4">= []) {</span>
  <span class="s3">let </span><span class="s2">routes </span><span class="s4">= [];</span>
  <span class="s2">React3</span><span class="s4">.</span><span class="s2">Children</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">children</span><span class="s4">, (</span><span class="s2">element</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">React3</span><span class="s4">.</span><span class="s2">isValidElement</span><span class="s4">(</span><span class="s2">element</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">treePath </span><span class="s4">= [</span><span class="s2">...parentPath</span><span class="s4">, </span><span class="s2">index</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">element</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s2">React3</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">) {</span>
      <span class="s2">routes</span><span class="s4">.</span><span class="s2">push</span><span class="s4">.</span><span class="s2">apply</span><span class="s4">(</span>
        <span class="s2">routes</span><span class="s4">,</span>
        <span class="s2">createRoutesFromChildren</span><span class="s4">(</span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">, </span><span class="s2">treePath</span><span class="s4">)</span>
      <span class="s4">);</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s2">element</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s2">Route</span><span class="s4">,</span>
      <span class="s5">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s3">typeof </span><span class="s2">element</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">element</span><span class="s4">.</span><span class="s2">type </span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">type</span><span class="s4">.</span><span class="s2">name</span><span class="s4">}</span><span class="s5">] is not a &lt;Route&gt; component. All component children of &lt;Routes&gt; must be a &lt;Route&gt; or &lt;React.Fragment&gt;`</span>
    <span class="s4">);</span>
    <span class="s2">invariant</span><span class="s4">(</span>
      <span class="s4">!</span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">index </span><span class="s4">|| !</span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">,</span>
      <span class="s5">&quot;An index route cannot have child routes.&quot;</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= {</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">id </span><span class="s4">|| </span><span class="s2">treePath</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;-&quot;</span><span class="s4">),</span>
      <span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">,</span>
      <span class="s2">element</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">element</span><span class="s4">,</span>
      <span class="s2">Component</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">,</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">loader</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">,</span>
      <span class="s2">action</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">hydrateFallbackElement</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">hydrateFallbackElement</span><span class="s4">,</span>
      <span class="s2">HydrateFallback</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">HydrateFallback</span><span class="s4">,</span>
      <span class="s2">errorElement</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">errorElement</span><span class="s4">,</span>
      <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">,</span>
      <span class="s2">hasErrorBoundary</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">hasErrorBoundary </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">|| </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">errorElement </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
      <span class="s2">lazy</span><span class="s4">: </span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">lazy</span>
    <span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">) {</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= </span><span class="s2">createRoutesFromChildren</span><span class="s4">(</span>
        <span class="s2">element</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">,</span>
        <span class="s2">treePath</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">routes</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">routes</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">createRoutesFromElements </span><span class="s4">= </span><span class="s2">createRoutesFromChildren</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">renderMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">_renderMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/lib.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React10 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// lib/dom/dom.ts</span>
<span class="s3">var </span><span class="s2">defaultMethod </span><span class="s4">= </span><span class="s5">&quot;get&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">defaultEncType </span><span class="s4">= </span><span class="s5">&quot;application/x-www-form-urlencoded&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">isHtmlElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">object </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">tagName </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isButtonElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isHtmlElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) &amp;&amp; </span><span class="s2">object</span><span class="s4">.</span><span class="s2">tagName</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">() === </span><span class="s5">&quot;button&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isFormElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isHtmlElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) &amp;&amp; </span><span class="s2">object</span><span class="s4">.</span><span class="s2">tagName</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">() === </span><span class="s5">&quot;form&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isInputElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isHtmlElement</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) &amp;&amp; </span><span class="s2">object</span><span class="s4">.</span><span class="s2">tagName</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">() === </span><span class="s5">&quot;input&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isModifiedEvent</span><span class="s4">(</span><span class="s2">event</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">!!(</span><span class="s2">event</span><span class="s4">.</span><span class="s2">metaKey </span><span class="s4">|| </span><span class="s2">event</span><span class="s4">.</span><span class="s2">altKey </span><span class="s4">|| </span><span class="s2">event</span><span class="s4">.</span><span class="s2">ctrlKey </span><span class="s4">|| </span><span class="s2">event</span><span class="s4">.</span><span class="s2">shiftKey</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">shouldProcessLinkClick</span><span class="s4">(</span><span class="s2">event</span><span class="s4">, </span><span class="s2">target</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">event</span><span class="s4">.</span><span class="s2">button </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s6">// Ignore everything but left clicks</span>
  <span class="s4">(!</span><span class="s2">target </span><span class="s4">|| </span><span class="s2">target </span><span class="s4">=== </span><span class="s5">&quot;_self&quot;</span><span class="s4">) &amp;&amp; </span><span class="s6">// Let browser handle &quot;target=_blank&quot; etc.</span>
  <span class="s4">!</span><span class="s2">isModifiedEvent</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createSearchParams</span><span class="s4">(</span><span class="s2">init </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
  <span class="s3">return new </span><span class="s2">URLSearchParams</span><span class="s4">(</span>
    <span class="s3">typeof </span><span class="s2">init </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">|| </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">init</span><span class="s4">) || </span><span class="s2">init </span><span class="s3">instanceof </span><span class="s2">URLSearchParams </span><span class="s4">? </span><span class="s2">init </span><span class="s4">: </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">init</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">memo2</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">init</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
      <span class="s3">return </span><span class="s2">memo2</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span>
        <span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) ? </span><span class="s2">value</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; [</span><span class="s2">key</span><span class="s4">, </span><span class="s2">v</span><span class="s4">]) : [[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">value</span><span class="s4">]]</span>
      <span class="s4">);</span>
    <span class="s4">}, [])</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSearchParamsForLocation</span><span class="s4">(</span><span class="s2">locationSearch</span><span class="s4">, </span><span class="s2">defaultSearchParams</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">searchParams </span><span class="s4">= </span><span class="s2">createSearchParams</span><span class="s4">(</span><span class="s2">locationSearch</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">defaultSearchParams</span><span class="s4">) {</span>
    <span class="s2">defaultSearchParams</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">key</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
        <span class="s2">defaultSearchParams</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s2">key</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">value</span><span class="s4">) =&gt; {</span>
          <span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">searchParams</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">_formDataSupportsSubmitter </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">isFormDataSubmitterSupported</span><span class="s4">() {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">_formDataSupportsSubmitter </span><span class="s4">=== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">new </span><span class="s2">FormData</span><span class="s4">(</span>
        <span class="s2">document</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;form&quot;</span><span class="s4">),</span>
        <span class="s6">// @ts-expect-error if FormData supports the submitter parameter, this will throw</span>
        <span class="s7">0</span>
      <span class="s4">);</span>
      <span class="s2">_formDataSupportsSubmitter </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s2">_formDataSupportsSubmitter </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">_formDataSupportsSubmitter</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">supportedFormEncTypes </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span>
  <span class="s5">&quot;application/x-www-form-urlencoded&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;multipart/form-data&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;text/plain&quot;</span>
<span class="s4">]);</span>
<span class="s3">function </span><span class="s2">getFormEncType</span><span class="s4">(</span><span class="s2">encType</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">encType </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; !</span><span class="s2">supportedFormEncTypes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">encType</span><span class="s4">)) {</span>
    <span class="s2">warning</span><span class="s4">(</span>
      <span class="s3">false</span><span class="s4">,</span>
      <span class="s5">`&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">encType</span><span class="s4">}</span><span class="s5">&quot; is not a valid </span><span class="s3">\`</span><span class="s5">encType</span><span class="s3">\` </span><span class="s5">for </span><span class="s3">\`</span><span class="s5">&lt;Form&gt;</span><span class="s3">\`</span><span class="s5">/</span><span class="s3">\`</span><span class="s5">&lt;fetcher.Form&gt;</span><span class="s3">\` </span><span class="s5">and will default to &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">defaultEncType</span><span class="s4">}</span><span class="s5">&quot;`</span>
    <span class="s4">);</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">encType</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getFormSubmissionInfo</span><span class="s4">(</span><span class="s2">target</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">method</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">action</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">encType</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">formData</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">body</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isFormElement</span><span class="s4">(</span><span class="s2">target</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">attr </span><span class="s4">= </span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">);</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s2">attr </span><span class="s4">? </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">attr</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) : </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s2">method </span><span class="s4">= </span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;method&quot;</span><span class="s4">) || </span><span class="s2">defaultMethod</span><span class="s4">;</span>
    <span class="s2">encType </span><span class="s4">= </span><span class="s2">getFormEncType</span><span class="s4">(</span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;enctype&quot;</span><span class="s4">)) || </span><span class="s2">defaultEncType</span><span class="s4">;</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s3">new </span><span class="s2">FormData</span><span class="s4">(</span><span class="s2">target</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isButtonElement</span><span class="s4">(</span><span class="s2">target</span><span class="s4">) || </span><span class="s2">isInputElement</span><span class="s4">(</span><span class="s2">target</span><span class="s4">) &amp;&amp; (</span><span class="s2">target</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;submit&quot; </span><span class="s4">|| </span><span class="s2">target</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;image&quot;</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">form </span><span class="s4">= </span><span class="s2">target</span><span class="s4">.</span><span class="s2">form</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">form </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`Cannot submit a &lt;button&gt; or &lt;input type=&quot;submit&quot;&gt; without a &lt;form&gt;`</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">attr </span><span class="s4">= </span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;formaction&quot;</span><span class="s4">) || </span><span class="s2">form</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">);</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s2">attr </span><span class="s4">? </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">attr</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) : </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s2">method </span><span class="s4">= </span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;formmethod&quot;</span><span class="s4">) || </span><span class="s2">form</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;method&quot;</span><span class="s4">) || </span><span class="s2">defaultMethod</span><span class="s4">;</span>
    <span class="s2">encType </span><span class="s4">= </span><span class="s2">getFormEncType</span><span class="s4">(</span><span class="s2">target</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;formenctype&quot;</span><span class="s4">)) || </span><span class="s2">getFormEncType</span><span class="s4">(</span><span class="s2">form</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;enctype&quot;</span><span class="s4">)) || </span><span class="s2">defaultEncType</span><span class="s4">;</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s3">new </span><span class="s2">FormData</span><span class="s4">(</span><span class="s2">form</span><span class="s4">, </span><span class="s2">target</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isFormDataSubmitterSupported</span><span class="s4">()) {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">name</span><span class="s4">, </span><span class="s2">type</span><span class="s4">, </span><span class="s2">value </span><span class="s4">} = </span><span class="s2">target</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;image&quot;</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">prefix </span><span class="s4">= </span><span class="s2">name </span><span class="s4">? </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">}</span><span class="s5">.` </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
        <span class="s2">formData</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">prefix</span><span class="s4">}</span><span class="s5">x`</span><span class="s4">, </span><span class="s5">&quot;0&quot;</span><span class="s4">);</span>
        <span class="s2">formData</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">prefix</span><span class="s4">}</span><span class="s5">y`</span><span class="s4">, </span><span class="s5">&quot;0&quot;</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">name</span><span class="s4">) {</span>
        <span class="s2">formData</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isHtmlElement</span><span class="s4">(</span><span class="s2">target</span><span class="s4">)) {</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
      <span class="s5">`Cannot submit element that is not &lt;form&gt;, &lt;button&gt;, or &lt;input type=&quot;submit|image&quot;&gt;`</span>
    <span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">method </span><span class="s4">= </span><span class="s2">defaultMethod</span><span class="s4">;</span>
    <span class="s2">action </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s2">encType </span><span class="s4">= </span><span class="s2">defaultEncType</span><span class="s4">;</span>
    <span class="s2">body </span><span class="s4">= </span><span class="s2">target</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">formData </span><span class="s4">&amp;&amp; </span><span class="s2">encType </span><span class="s4">=== </span><span class="s5">&quot;text/plain&quot;</span><span class="s4">) {</span>
    <span class="s2">body </span><span class="s4">= </span><span class="s2">formData</span><span class="s4">;</span>
    <span class="s2">formData </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">method</span><span class="s4">: </span><span class="s2">method</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">(), </span><span class="s2">encType</span><span class="s4">, </span><span class="s2">formData</span><span class="s4">, </span><span class="s2">body </span><span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/components.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React9 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// lib/dom/ssr/invariant.ts</span>
<span class="s3">function </span><span class="s2">invariant2</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">=== </span><span class="s3">false </span><span class="s4">|| </span><span class="s2">value </span><span class="s4">=== </span><span class="s3">null </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/routeModules.ts</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">loadRouteModule</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModulesCache</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">routeModulesCache</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">routeModulesCache</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s3">await import</span><span class="s4">(</span>
      <span class="s6">/* @vite-ignore */</span>
      <span class="s6">/* webpackIgnore: true */</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">module</span>
    <span class="s4">);</span>
    <span class="s2">routeModulesCache</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">routeModule</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">routeModule</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
      <span class="s5">`Error loading route module </span><span class="s3">\`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">}</span><span class="s3">\`</span><span class="s5">, reloading page...`</span>
    <span class="s4">);</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">window</span><span class="s4">.</span><span class="s2">__reactRouterContext </span><span class="s4">&amp;&amp; </span><span class="s2">window</span><span class="s4">.</span><span class="s2">__reactRouterContext</span><span class="s4">.</span><span class="s2">isSpaMode </span><span class="s4">&amp;&amp; </span><span class="s6">// @ts-expect-error</span>
    <span class="s3">import</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">hot</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">reload</span><span class="s4">();</span>
    <span class="s3">return new </span><span class="s2">Promise</span><span class="s4">(() =&gt; {</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/links.ts</span>
<span class="s3">function </span><span class="s2">getKeyedLinksForMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">descriptors </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">module </span><span class="s4">= </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s3">return </span><span class="s4">[</span>
      <span class="s2">route </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">css </span><span class="s4">? </span><span class="s2">route</span><span class="s4">.</span><span class="s2">css</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">href2</span><span class="s4">) =&gt; ({ </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;stylesheet&quot;</span><span class="s4">, </span><span class="s2">href</span><span class="s4">: </span><span class="s2">href2 </span><span class="s4">})) : [],</span>
      <span class="s2">module</span><span class="s4">?.</span><span class="s2">links</span><span class="s4">?.() || []</span>
    <span class="s4">];</span>
  <span class="s4">}).</span><span class="s2">flat</span><span class="s4">(</span><span class="s7">2</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">preloads </span><span class="s4">= </span><span class="s2">getModuleLinkHrefs</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">dedupeLinkDescriptors</span><span class="s4">(</span><span class="s2">descriptors</span><span class="s4">, </span><span class="s2">preloads</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getRouteCssDescriptors</span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">css</span><span class="s4">) </span><span class="s3">return </span><span class="s4">[];</span>
  <span class="s3">return </span><span class="s2">route</span><span class="s4">.</span><span class="s2">css</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">href2</span><span class="s4">) =&gt; ({ </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;stylesheet&quot;</span><span class="s4">, </span><span class="s2">href</span><span class="s4">: </span><span class="s2">href2 </span><span class="s4">}));</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">prefetchRouteCss</span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">css</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">descriptors </span><span class="s4">= </span><span class="s2">getRouteCssDescriptors</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
  <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">descriptors</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">prefetchStyleLink</span><span class="s4">));</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">prefetchStyleLinks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModule</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">css </span><span class="s4">&amp;&amp; !</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">links </span><span class="s4">|| !</span><span class="s2">isPreloadSupported</span><span class="s4">()) </span><span class="s3">return</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">descriptors </span><span class="s4">= [];</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">css</span><span class="s4">) {</span>
    <span class="s2">descriptors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...getRouteCssDescriptors</span><span class="s4">(</span><span class="s2">route</span><span class="s4">));</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">links</span><span class="s4">) {</span>
    <span class="s2">descriptors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...routeModule</span><span class="s4">.</span><span class="s2">links</span><span class="s4">());</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">descriptors</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">styleLinks </span><span class="s4">= [];</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">descriptor of descriptors</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isPageLinkDescriptor</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">) &amp;&amp; </span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;stylesheet&quot;</span><span class="s4">) {</span>
      <span class="s2">styleLinks</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
        <span class="s2">...descriptor</span><span class="s4">,</span>
        <span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;preload&quot;</span><span class="s4">,</span>
        <span class="s4">as: </span><span class="s5">&quot;style&quot;</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">styleLinks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">prefetchStyleLink</span><span class="s4">));</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">prefetchStyleLink</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">) {</span>
  <span class="s3">return new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">media </span><span class="s4">&amp;&amp; !</span><span class="s2">window</span><span class="s4">.</span><span class="s2">matchMedia</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">media</span><span class="s4">).</span><span class="s2">matches </span><span class="s4">|| </span><span class="s2">document</span><span class="s4">.</span><span class="s2">querySelector</span><span class="s4">(</span>
      <span class="s5">`link[rel=&quot;stylesheet&quot;][href=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">href</span><span class="s4">}</span><span class="s5">&quot;]`</span>
    <span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">resolve</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">link </span><span class="s4">= </span><span class="s2">document</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">);</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">link</span><span class="s4">, </span><span class="s2">descriptor</span><span class="s4">);</span>
    <span class="s3">function </span><span class="s2">removeLink</span><span class="s4">() {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">document</span><span class="s4">.</span><span class="s2">head</span><span class="s4">.</span><span class="s2">contains</span><span class="s4">(</span><span class="s2">link</span><span class="s4">)) {</span>
        <span class="s2">document</span><span class="s4">.</span><span class="s2">head</span><span class="s4">.</span><span class="s2">removeChild</span><span class="s4">(</span><span class="s2">link</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">link</span><span class="s4">.</span><span class="s2">onload </span><span class="s4">= () =&gt; {</span>
      <span class="s2">removeLink</span><span class="s4">();</span>
      <span class="s2">resolve</span><span class="s4">();</span>
    <span class="s4">};</span>
    <span class="s2">link</span><span class="s4">.</span><span class="s2">onerror </span><span class="s4">= () =&gt; {</span>
      <span class="s2">removeLink</span><span class="s4">();</span>
      <span class="s2">resolve</span><span class="s4">();</span>
    <span class="s4">};</span>
    <span class="s2">document</span><span class="s4">.</span><span class="s2">head</span><span class="s4">.</span><span class="s2">appendChild</span><span class="s4">(</span><span class="s2">link</span><span class="s4">);</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isPageLinkDescriptor</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">object </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">page </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isHtmlLinkDescriptor</span><span class="s4">(</span><span class="s2">object</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">object </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">object</span><span class="s4">.</span><span class="s2">href </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">object</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;preload&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">imageSrcSet </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">imageSizes </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">href </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">getKeyedPrefetchLinks</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">links </span><span class="s4">= </span><span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
    <span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">mod </span><span class="s4">= </span><span class="s3">await </span><span class="s2">loadRouteModule</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">mod</span><span class="s4">.</span><span class="s2">links </span><span class="s4">? </span><span class="s2">mod</span><span class="s4">.</span><span class="s2">links</span><span class="s4">() : [];</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s4">[];</span>
    <span class="s4">})</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">dedupeLinkDescriptors</span><span class="s4">(</span>
    <span class="s2">links</span><span class="s4">.</span><span class="s2">flat</span><span class="s4">(</span><span class="s7">1</span><span class="s4">).</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">isHtmlLinkDescriptor</span><span class="s4">).</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">link</span><span class="s4">) =&gt; </span><span class="s2">link</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;stylesheet&quot; </span><span class="s4">|| </span><span class="s2">link</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;preload&quot;</span><span class="s4">).</span><span class="s2">map</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">link</span><span class="s4">) =&gt; </span><span class="s2">link</span><span class="s4">.</span><span class="s2">rel </span><span class="s4">=== </span><span class="s5">&quot;stylesheet&quot; </span><span class="s4">? { </span><span class="s2">...link</span><span class="s4">, </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;prefetch&quot;</span><span class="s4">, as: </span><span class="s5">&quot;style&quot; </span><span class="s4">} : { </span><span class="s2">...link</span><span class="s4">, </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;prefetch&quot; </span><span class="s4">}</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getNewMatchesForLinks</span><span class="s4">(</span><span class="s2">page</span><span class="s4">, </span><span class="s2">nextMatches</span><span class="s4">, </span><span class="s2">currentMatches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">mode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">isNew </span><span class="s4">= (</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">currentMatches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">]) </span><span class="s3">return true</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">!== </span><span class="s2">currentMatches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">matchPathChanged </span><span class="s4">= (</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
    <span class="s3">return </span><span class="s4">(</span>
      <span class="s6">// param change, /users/123 -&gt; /users/456</span>
      <span class="s2">currentMatches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">].</span><span class="s2">pathname </span><span class="s4">!== </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s6">// splat param changed, which is not present in match.path</span>
      <span class="s6">// e.g. /files/images/avatar.jpg -&gt; files/finances.xls</span>
      <span class="s2">currentMatches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">?.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;*&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">currentMatches</span><span class="s4">[</span><span class="s2">index</span><span class="s4">].</span><span class="s2">params</span><span class="s4">[</span><span class="s5">&quot;*&quot;</span><span class="s4">] !== </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">[</span><span class="s5">&quot;*&quot;</span><span class="s4">]</span>
    <span class="s4">);</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">mode </span><span class="s4">=== </span><span class="s5">&quot;assets&quot;</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">nextMatches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; </span><span class="s2">isNew</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) || </span><span class="s2">matchPathChanged</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">)</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">mode </span><span class="s4">=== </span><span class="s5">&quot;data&quot;</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">nextMatches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">manifestRoute </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">manifestRoute </span><span class="s4">|| !</span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">) {</span>
        <span class="s3">return false</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isNew</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) || </span><span class="s2">matchPathChanged</span><span class="s4">(</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">)) {</span>
        <span class="s3">return true</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">routeChoice </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">({</span>
          <span class="s2">currentUrl</span><span class="s4">: </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span>
            <span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">location</span><span class="s4">.</span><span class="s2">search </span><span class="s4">+ </span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">,</span>
            <span class="s2">window</span><span class="s4">.</span><span class="s2">origin</span>
          <span class="s4">),</span>
          <span class="s2">currentParams</span><span class="s4">: </span><span class="s2">currentMatches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]?.</span><span class="s2">params </span><span class="s4">|| {},</span>
          <span class="s2">nextUrl</span><span class="s4">: </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">page</span><span class="s4">, </span><span class="s2">window</span><span class="s4">.</span><span class="s2">origin</span><span class="s4">),</span>
          <span class="s2">nextParams</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
          <span class="s2">defaultShouldRevalidate</span><span class="s4">: </span><span class="s3">true</span>
        <span class="s4">});</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">routeChoice </span><span class="s4">=== </span><span class="s5">&quot;boolean&quot;</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s2">routeChoice</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">return true</span><span class="s4">;</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">[];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getModuleLinkHrefs</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, { </span><span class="s2">includeHydrateFallback </span><span class="s4">} = {}) {</span>
  <span class="s3">return </span><span class="s2">dedupeHrefs</span><span class="s4">(</span>
    <span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">) </span><span class="s3">return </span><span class="s4">[];</span>
      <span class="s3">let </span><span class="s2">hrefs </span><span class="s4">= [</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientActionModule</span><span class="s4">) {</span>
        <span class="s2">hrefs </span><span class="s4">= </span><span class="s2">hrefs</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientActionModule</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoaderModule</span><span class="s4">) {</span>
        <span class="s2">hrefs </span><span class="s4">= </span><span class="s2">hrefs</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoaderModule</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">includeHydrateFallback </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hydrateFallbackModule</span><span class="s4">) {</span>
        <span class="s2">hrefs </span><span class="s4">= </span><span class="s2">hrefs</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hydrateFallbackModule</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">imports</span><span class="s4">) {</span>
        <span class="s2">hrefs </span><span class="s4">= </span><span class="s2">hrefs</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">imports</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">hrefs</span><span class="s4">;</span>
    <span class="s4">}).</span><span class="s2">flat</span><span class="s4">(</span><span class="s7">1</span><span class="s4">)</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">dedupeHrefs</span><span class="s4">(</span><span class="s2">hrefs</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">[</span><span class="s2">...</span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">hrefs</span><span class="s4">)];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">sortKeys</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">sorted </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">keys </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">).</span><span class="s2">sort</span><span class="s4">();</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">key of keys</span><span class="s4">) {</span>
    <span class="s2">sorted</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">obj</span><span class="s4">[</span><span class="s2">key</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">sorted</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">dedupeLinkDescriptors</span><span class="s4">(</span><span class="s2">descriptors</span><span class="s4">, </span><span class="s2">preloads</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">set </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">preloadsSet </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">preloads</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">descriptors</span><span class="s4">.</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">deduped</span><span class="s4">, </span><span class="s2">descriptor</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">alreadyModulePreload </span><span class="s4">= </span><span class="s2">preloads </span><span class="s4">&amp;&amp; !</span><span class="s2">isPageLinkDescriptor</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">) &amp;&amp; </span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">as </span><span class="s4">=== </span><span class="s5">&quot;script&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">href </span><span class="s4">&amp;&amp; </span><span class="s2">preloadsSet</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">.</span><span class="s2">href</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">alreadyModulePreload</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">deduped</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">sortKeys</span><span class="s4">(</span><span class="s2">descriptor</span><span class="s4">));</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">set</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">key</span><span class="s4">)) {</span>
      <span class="s2">set</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
      <span class="s2">deduped</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">key</span><span class="s4">, </span><span class="s2">link</span><span class="s4">: </span><span class="s2">descriptor </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">deduped</span><span class="s4">;</span>
  <span class="s4">}, []);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">_isPreloadSupported</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">isPreloadSupported</span><span class="s4">() {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">_isPreloadSupported </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">_isPreloadSupported</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">el </span><span class="s4">= </span><span class="s2">document</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">);</span>
  <span class="s2">_isPreloadSupported </span><span class="s4">= </span><span class="s2">el</span><span class="s4">.</span><span class="s2">relList</span><span class="s4">.</span><span class="s2">supports</span><span class="s4">(</span><span class="s5">&quot;preload&quot;</span><span class="s4">);</span>
  <span class="s2">el </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">_isPreloadSupported</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/markup.ts</span>
<span class="s3">var </span><span class="s2">ESCAPE_LOOKUP </span><span class="s4">= {</span>
  <span class="s5">&quot;&amp;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u0026&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&gt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003e&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&lt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003c&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2028</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2028&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2029</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2029&quot;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">ESCAPE_REGEX </span><span class="s4">= </span><span class="s8">/[&amp;&gt;&lt;\u2028\u2029]/g</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">escapeHtml</span><span class="s4">(</span><span class="s2">html</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">html</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">ESCAPE_REGEX</span><span class="s4">, (</span><span class="s2">match</span><span class="s4">) =&gt; </span><span class="s2">ESCAPE_LOOKUP</span><span class="s4">[</span><span class="s2">match</span><span class="s4">]);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createHtml</span><span class="s4">(</span><span class="s2">html</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">__html</span><span class="s4">: </span><span class="s2">html </span><span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/single-fetch.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React4 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// vendor/turbo-stream-v2/utils.ts</span>
<span class="s3">var </span><span class="s2">HOLE </span><span class="s4">= -</span><span class="s7">1</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NAN </span><span class="s4">= -</span><span class="s7">2</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NEGATIVE_INFINITY </span><span class="s4">= -</span><span class="s7">3</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NEGATIVE_ZERO </span><span class="s4">= -</span><span class="s7">4</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NULL </span><span class="s4">= -</span><span class="s7">5</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">POSITIVE_INFINITY </span><span class="s4">= -</span><span class="s7">6</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">UNDEFINED </span><span class="s4">= -</span><span class="s7">7</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_BIGINT </span><span class="s4">= </span><span class="s5">&quot;B&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_DATE </span><span class="s4">= </span><span class="s5">&quot;D&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_ERROR </span><span class="s4">= </span><span class="s5">&quot;E&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_MAP </span><span class="s4">= </span><span class="s5">&quot;M&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_NULL_OBJECT </span><span class="s4">= </span><span class="s5">&quot;N&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_PROMISE </span><span class="s4">= </span><span class="s5">&quot;P&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_REGEXP </span><span class="s4">= </span><span class="s5">&quot;R&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_SET </span><span class="s4">= </span><span class="s5">&quot;S&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_SYMBOL </span><span class="s4">= </span><span class="s5">&quot;Y&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_URL </span><span class="s4">= </span><span class="s5">&quot;U&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">TYPE_PREVIOUS_RESOLVED </span><span class="s4">= </span><span class="s5">&quot;Z&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">Deferred2 </span><span class="s4">= </span><span class="s3">class </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">() {</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">promise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">, </span><span class="s2">reject</span><span class="s4">) =&gt; {</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">resolve </span><span class="s4">= </span><span class="s2">resolve</span><span class="s4">;</span>
      <span class="s3">this</span><span class="s4">.</span><span class="s2">reject </span><span class="s4">= </span><span class="s2">reject</span><span class="s4">;</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">createLineSplittingTransform</span><span class="s4">() {</span>
  <span class="s3">const </span><span class="s2">decoder </span><span class="s4">= </span><span class="s3">new </span><span class="s2">TextDecoder</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">leftover </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">return new </span><span class="s2">TransformStream</span><span class="s4">({</span>
    <span class="s2">transform</span><span class="s4">(</span><span class="s2">chunk</span><span class="s4">, </span><span class="s2">controller</span><span class="s4">) {</span>
      <span class="s3">const </span><span class="s2">str </span><span class="s4">= </span><span class="s2">decoder</span><span class="s4">.</span><span class="s2">decode</span><span class="s4">(</span><span class="s2">chunk</span><span class="s4">, { </span><span class="s2">stream</span><span class="s4">: </span><span class="s3">true </span><span class="s4">});</span>
      <span class="s3">const </span><span class="s2">parts </span><span class="s4">= (</span><span class="s2">leftover </span><span class="s4">+ </span><span class="s2">str</span><span class="s4">).</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">);</span>
      <span class="s2">leftover </span><span class="s4">= </span><span class="s2">parts</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">() || </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">part of parts</span><span class="s4">) {</span>
        <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span><span class="s2">part</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s2">flush</span><span class="s4">(</span><span class="s2">controller</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">leftover</span><span class="s4">) {</span>
        <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span><span class="s2">leftover</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
<span class="s4">}</span>

<span class="s6">// vendor/turbo-stream-v2/flatten.ts</span>
<span class="s3">function </span><span class="s2">flatten</span><span class="s4">(</span><span class="s2">input</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">indices </span><span class="s4">} = </span><span class="s3">this</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">existing </span><span class="s4">= </span><span class="s2">indices</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">input</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">existing</span><span class="s4">) </span><span class="s3">return </span><span class="s4">[</span><span class="s2">existing</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">input </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) </span><span class="s3">return </span><span class="s2">UNDEFINED</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">input </span><span class="s4">=== </span><span class="s3">null</span><span class="s4">) </span><span class="s3">return </span><span class="s2">NULL</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">Number</span><span class="s4">.</span><span class="s2">isNaN</span><span class="s4">(</span><span class="s2">input</span><span class="s4">)) </span><span class="s3">return </span><span class="s2">NAN</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">input </span><span class="s4">=== </span><span class="s2">Number</span><span class="s4">.</span><span class="s2">POSITIVE_INFINITY</span><span class="s4">) </span><span class="s3">return </span><span class="s2">POSITIVE_INFINITY</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">input </span><span class="s4">=== </span><span class="s2">Number</span><span class="s4">.</span><span class="s2">NEGATIVE_INFINITY</span><span class="s4">) </span><span class="s3">return </span><span class="s2">NEGATIVE_INFINITY</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">input </span><span class="s4">=== </span><span class="s7">0 </span><span class="s4">&amp;&amp; </span><span class="s7">1 </span><span class="s4">/ </span><span class="s2">input </span><span class="s4">&lt; </span><span class="s7">0</span><span class="s4">) </span><span class="s3">return </span><span class="s2">NEGATIVE_ZERO</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">index </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s2">index</span><span class="s4">++;</span>
  <span class="s2">indices</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">input</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
  <span class="s2">stringify</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">input</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">index</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">deferred</span><span class="s4">, </span><span class="s2">plugins</span><span class="s4">, </span><span class="s2">postPlugins </span><span class="s4">} = </span><span class="s3">this</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">str </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">stack </span><span class="s4">= [[</span><span class="s2">input</span><span class="s4">, </span><span class="s2">index</span><span class="s4">]];</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">stack</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">const </span><span class="s4">[</span><span class="s2">input2</span><span class="s4">, </span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">stack</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">();</span>
    <span class="s3">const </span><span class="s2">partsForObj </span><span class="s4">= (</span><span class="s2">obj</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">k</span><span class="s4">) =&gt; </span><span class="s5">`&quot;_</span><span class="s2">$</span><span class="s4">{</span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">k</span><span class="s4">)}</span><span class="s5">&quot;:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">obj</span><span class="s4">[</span><span class="s2">k</span><span class="s4">])}</span><span class="s5">`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">switch </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">input2</span><span class="s4">) {</span>
      <span class="s3">case </span><span class="s5">&quot;boolean&quot;</span><span class="s4">:</span>
      <span class="s3">case </span><span class="s5">&quot;number&quot;</span><span class="s4">:</span>
      <span class="s3">case </span><span class="s5">&quot;string&quot;</span><span class="s4">:</span>
        <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s5">&quot;bigint&quot;</span><span class="s4">:</span>
        <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_BIGINT</span><span class="s4">}</span><span class="s5">&quot;,&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">input2</span><span class="s4">}</span><span class="s5">&quot;]`</span><span class="s4">;</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s5">&quot;symbol&quot;</span><span class="s4">: {</span>
        <span class="s3">const </span><span class="s2">keyFor </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">.</span><span class="s2">keyFor</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">keyFor</span><span class="s4">) {</span>
          <span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span>
            <span class="s5">&quot;Cannot encode symbol unless created with Symbol.for()&quot;</span>
          <span class="s4">);</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_SYMBOL</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">keyFor</span><span class="s4">)}</span><span class="s5">]`</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">case </span><span class="s5">&quot;object&quot;</span><span class="s4">: {</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">input2</span><span class="s4">) {</span>
          <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">NULL</span><span class="s4">}</span><span class="s5">`</span><span class="s4">;</span>
          <span class="s3">break</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">const </span><span class="s2">isArray </span><span class="s4">= </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">isArray </span><span class="s4">&amp;&amp; </span><span class="s2">plugins</span><span class="s4">) {</span>
          <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">plugin of plugins</span><span class="s4">) {</span>
            <span class="s3">const </span><span class="s2">pluginResult </span><span class="s4">= </span><span class="s2">plugin</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">pluginResult</span><span class="s4">)) {</span>
              <span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
              <span class="s3">const </span><span class="s4">[</span><span class="s2">pluginIdentifier</span><span class="s4">, </span><span class="s2">...rest</span><span class="s4">] = </span><span class="s2">pluginResult</span><span class="s4">;</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">pluginIdentifier</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
              <span class="s3">if </span><span class="s4">(</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
                <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">`,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">v</span><span class="s4">)).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
              <span class="s4">}</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">&quot;]&quot;</span><span class="s4">;</span>
              <span class="s3">break</span><span class="s4">;</span>
            <span class="s4">}</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">pluginHandled</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">isArray </span><span class="s4">? </span><span class="s5">&quot;[&quot; </span><span class="s4">: </span><span class="s5">&quot;{&quot;</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">isArray</span><span class="s4">) {</span>
            <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">input2</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++)</span>
              <span class="s2">result </span><span class="s4">+= (</span><span class="s2">i </span><span class="s4">? </span><span class="s5">&quot;,&quot; </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">) + (</span><span class="s2">i </span><span class="s3">in </span><span class="s2">input2 </span><span class="s4">? </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">input2</span><span class="s4">[</span><span class="s2">i</span><span class="s4">]) : </span><span class="s2">HOLE</span><span class="s4">);</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">result</span><span class="s4">}</span><span class="s5">]`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">Date</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_DATE</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">getTime</span><span class="s4">()}</span><span class="s5">]`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">URL</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_URL</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">href</span><span class="s4">)}</span><span class="s5">]`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">RegExp</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_REGEXP</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
              <span class="s2">input2</span><span class="s4">.</span><span class="s2">source</span>
            <span class="s4">)}</span><span class="s5">,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">flags</span><span class="s4">)}</span><span class="s5">]`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">Set</span><span class="s4">) {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_SET</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{[</span><span class="s2">...input2</span><span class="s4">].</span><span class="s2">map</span><span class="s4">((</span><span class="s2">val</span><span class="s4">) =&gt; </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">val</span><span class="s4">)).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">]`</span><span class="s4">;</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_SET</span><span class="s4">}</span><span class="s5">&quot;]`</span><span class="s4">;</span>
            <span class="s4">}</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">Map</span><span class="s4">) {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_MAP</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{[</span><span class="s2">...input2</span><span class="s4">].</span><span class="s2">flatMap</span><span class="s4">(([</span><span class="s2">k</span><span class="s4">, </span><span class="s2">v</span><span class="s4">]) =&gt; [</span>
                <span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">k</span><span class="s4">),</span>
                <span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">v</span><span class="s4">)</span>
              <span class="s4">]).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">]`</span><span class="s4">;</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_MAP</span><span class="s4">}</span><span class="s5">&quot;]`</span><span class="s4">;</span>
            <span class="s4">}</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">Promise</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PROMISE</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">index2</span><span class="s4">}</span><span class="s5">]`</span><span class="s4">;</span>
            <span class="s2">deferred</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">input2</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">input2 </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_ERROR</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">message</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">name </span><span class="s4">!== </span><span class="s5">&quot;Error&quot;</span><span class="s4">) {</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">`,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">.</span><span class="s2">name</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">&quot;]&quot;</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getPrototypeOf</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">) === </span><span class="s3">null</span><span class="s4">) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_NULL_OBJECT</span><span class="s4">}</span><span class="s5">&quot;,{</span><span class="s2">$</span><span class="s4">{</span><span class="s2">partsForObj</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">)}</span><span class="s5">}]`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">isPlainObject</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">)) {</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`{</span><span class="s2">$</span><span class="s4">{</span><span class="s2">partsForObj</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">)}</span><span class="s5">}`</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
            <span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Cannot encode object with prototype&quot;</span><span class="s4">);</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">default</span><span class="s4">: {</span>
        <span class="s3">const </span><span class="s2">isArray </span><span class="s4">= </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">isArray </span><span class="s4">&amp;&amp; </span><span class="s2">plugins</span><span class="s4">) {</span>
          <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">plugin of plugins</span><span class="s4">) {</span>
            <span class="s3">const </span><span class="s2">pluginResult </span><span class="s4">= </span><span class="s2">plugin</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">pluginResult</span><span class="s4">)) {</span>
              <span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
              <span class="s3">const </span><span class="s4">[</span><span class="s2">pluginIdentifier</span><span class="s4">, </span><span class="s2">...rest</span><span class="s4">] = </span><span class="s2">pluginResult</span><span class="s4">;</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">pluginIdentifier</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
              <span class="s3">if </span><span class="s4">(</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
                <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">`,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">v</span><span class="s4">)).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
              <span class="s4">}</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">&quot;]&quot;</span><span class="s4">;</span>
              <span class="s3">break</span><span class="s4">;</span>
            <span class="s4">}</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">pluginHandled</span><span class="s4">) {</span>
          <span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Cannot encode function or unexpected type&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">postPlugins</span><span class="s4">) {</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">plugin of postPlugins</span><span class="s4">) {</span>
          <span class="s3">const </span><span class="s2">pluginResult </span><span class="s4">= </span><span class="s2">plugin</span><span class="s4">(</span><span class="s2">input2</span><span class="s4">);</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">pluginResult</span><span class="s4">)) {</span>
            <span class="s2">pluginHandled </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
            <span class="s3">const </span><span class="s4">[</span><span class="s2">pluginIdentifier</span><span class="s4">, </span><span class="s2">...rest</span><span class="s4">] = </span><span class="s2">pluginResult</span><span class="s4">;</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s5">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">pluginIdentifier</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
              <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">`,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rest</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">v</span><span class="s4">)).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s2">str</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] += </span><span class="s5">&quot;]&quot;</span><span class="s4">;</span>
            <span class="s3">break</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">pluginHandled</span><span class="s4">) {</span>
        <span class="s3">throw </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">objectProtoNames </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getOwnPropertyNames</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">).</span><span class="s2">sort</span><span class="s4">().</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\0</span><span class="s5">&quot;</span><span class="s4">);</span>
<span class="s3">function </span><span class="s2">isPlainObject</span><span class="s4">(</span><span class="s2">thing</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s2">proto </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getPrototypeOf</span><span class="s4">(</span><span class="s2">thing</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">proto </span><span class="s4">=== </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">prototype </span><span class="s4">|| </span><span class="s2">proto </span><span class="s4">=== </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getOwnPropertyNames</span><span class="s4">(</span><span class="s2">proto</span><span class="s4">).</span><span class="s2">sort</span><span class="s4">().</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\0</span><span class="s5">&quot;</span><span class="s4">) === </span><span class="s2">objectProtoNames</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// vendor/turbo-stream-v2/unflatten.ts</span>
<span class="s3">var </span><span class="s2">globalObj </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">window </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">? </span><span class="s2">window </span><span class="s4">: </span><span class="s3">typeof </span><span class="s2">globalThis </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">? </span><span class="s2">globalThis </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">unflatten</span><span class="s4">(</span><span class="s2">parsed</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">hydrated</span><span class="s4">, </span><span class="s2">values </span><span class="s4">} = </span><span class="s3">this</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">parsed </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) </span><span class="s3">return </span><span class="s2">hydrate</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">parsed</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">parsed</span><span class="s4">) || !</span><span class="s2">parsed</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) </span><span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
  <span class="s3">const </span><span class="s2">startIndex </span><span class="s4">= </span><span class="s2">values</span><span class="s4">.</span><span class="s2">length</span><span class="s4">;</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">value of parsed</span><span class="s4">) {</span>
    <span class="s2">values</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">hydrated</span><span class="s4">.</span><span class="s2">length </span><span class="s4">= </span><span class="s2">values</span><span class="s4">.</span><span class="s2">length</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">hydrate</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">startIndex</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">hydrate</span><span class="s4">(</span><span class="s2">index</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">hydrated</span><span class="s4">, </span><span class="s2">values</span><span class="s4">, </span><span class="s2">deferred</span><span class="s4">, </span><span class="s2">plugins </span><span class="s4">} = </span><span class="s3">this</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">stack </span><span class="s4">= [</span>
    <span class="s4">[</span>
      <span class="s2">index</span><span class="s4">,</span>
      <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
        <span class="s2">result </span><span class="s4">= </span><span class="s2">v</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">]</span>
  <span class="s4">];</span>
  <span class="s3">let </span><span class="s2">postRun </span><span class="s4">= [];</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">stack</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">const </span><span class="s4">[</span><span class="s2">index2</span><span class="s4">, </span><span class="s2">set</span><span class="s4">] = </span><span class="s2">stack</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">();</span>
    <span class="s3">switch </span><span class="s4">(</span><span class="s2">index2</span><span class="s4">) {</span>
      <span class="s3">case </span><span class="s2">UNDEFINED</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s2">NULL</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s2">NAN</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(</span><span class="s2">NaN</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s2">POSITIVE_INFINITY</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(</span><span class="s2">Infinity</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s2">NEGATIVE_INFINITY</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(-</span><span class="s2">Infinity</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s3">case </span><span class="s2">NEGATIVE_ZERO</span><span class="s4">:</span>
        <span class="s2">set</span><span class="s4">(-</span><span class="s7">0</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">]) {</span>
      <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">]);</span>
      <span class="s3">continue</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">values</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">value </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">!== </span><span class="s5">&quot;object&quot;</span><span class="s4">) {</span>
      <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
      <span class="s2">set</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
      <span class="s3">continue</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">value</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">value</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] === </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
        <span class="s3">const </span><span class="s4">[</span><span class="s2">type</span><span class="s4">, </span><span class="s2">b</span><span class="s4">, </span><span class="s2">c</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
        <span class="s3">switch </span><span class="s4">(</span><span class="s2">type</span><span class="s4">) {</span>
          <span class="s3">case </span><span class="s2">TYPE_DATE</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">(</span><span class="s2">b</span><span class="s4">));</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_URL</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">b</span><span class="s4">));</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_BIGINT</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">BigInt</span><span class="s4">(</span><span class="s2">b</span><span class="s4">));</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_REGEXP</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s3">new </span><span class="s2">RegExp</span><span class="s4">(</span><span class="s2">b</span><span class="s4">, </span><span class="s2">c</span><span class="s4">));</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_SYMBOL</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">Symbol</span><span class="s4">.</span><span class="s2">for</span><span class="s4">(</span><span class="s2">b</span><span class="s4">));</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_SET</span><span class="s4">:</span>
            <span class="s3">const </span><span class="s2">newSet </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
            <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">newSet</span><span class="s4">;</span>
            <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s2">value</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i</span><span class="s4">--)</span>
              <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                <span class="s2">value</span><span class="s4">[</span><span class="s2">i</span><span class="s4">],</span>
                <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
                  <span class="s2">newSet</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">v</span><span class="s4">);</span>
                <span class="s4">}</span>
              <span class="s4">]);</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">newSet</span><span class="s4">);</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_MAP</span><span class="s4">:</span>
            <span class="s3">const </span><span class="s2">map </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
            <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">map</span><span class="s4">;</span>
            <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s2">value</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">2</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">-= </span><span class="s7">2</span><span class="s4">) {</span>
              <span class="s3">const </span><span class="s2">r </span><span class="s4">= [];</span>
              <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                <span class="s2">value</span><span class="s4">[</span><span class="s2">i </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">],</span>
                <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
                  <span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">] = </span><span class="s2">v</span><span class="s4">;</span>
                <span class="s4">}</span>
              <span class="s4">]);</span>
              <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                <span class="s2">value</span><span class="s4">[</span><span class="s2">i</span><span class="s4">],</span>
                <span class="s4">(</span><span class="s2">k</span><span class="s4">) =&gt; {</span>
                  <span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] = </span><span class="s2">k</span><span class="s4">;</span>
                <span class="s4">}</span>
              <span class="s4">]);</span>
              <span class="s2">postRun</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(() =&gt; {</span>
                <span class="s2">map</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">], </span><span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]);</span>
              <span class="s4">});</span>
            <span class="s4">}</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">map</span><span class="s4">);</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_NULL_OBJECT</span><span class="s4">:</span>
            <span class="s3">const </span><span class="s2">obj </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
            <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">obj</span><span class="s4">;</span>
            <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">key of Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">b</span><span class="s4">).</span><span class="s2">reverse</span><span class="s4">()) {</span>
              <span class="s3">const </span><span class="s2">r </span><span class="s4">= [];</span>
              <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                <span class="s2">b</span><span class="s4">[</span><span class="s2">key</span><span class="s4">],</span>
                <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
                  <span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">] = </span><span class="s2">v</span><span class="s4">;</span>
                <span class="s4">}</span>
              <span class="s4">]);</span>
              <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                <span class="s2">Number</span><span class="s4">(</span><span class="s2">key</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">)),</span>
                <span class="s4">(</span><span class="s2">k</span><span class="s4">) =&gt; {</span>
                  <span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] = </span><span class="s2">k</span><span class="s4">;</span>
                <span class="s4">}</span>
              <span class="s4">]);</span>
              <span class="s2">postRun</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(() =&gt; {</span>
                <span class="s2">obj</span><span class="s4">[</span><span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]] = </span><span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">];</span>
              <span class="s4">});</span>
            <span class="s4">}</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">obj</span><span class="s4">);</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_PROMISE</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">b</span><span class="s4">]) {</span>
              <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">b</span><span class="s4">]);</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s3">const </span><span class="s2">d </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Deferred2</span><span class="s4">();</span>
              <span class="s2">deferred</span><span class="s4">[</span><span class="s2">b</span><span class="s4">] = </span><span class="s2">d</span><span class="s4">;</span>
              <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">d</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">);</span>
            <span class="s4">}</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_ERROR</span><span class="s4">:</span>
            <span class="s3">const </span><span class="s4">[, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">errorType</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
            <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s2">errorType </span><span class="s4">&amp;&amp; </span><span class="s2">globalObj </span><span class="s4">&amp;&amp; </span><span class="s2">globalObj</span><span class="s4">[</span><span class="s2">errorType</span><span class="s4">] ? </span><span class="s3">new </span><span class="s2">globalObj</span><span class="s4">[</span><span class="s2">errorType</span><span class="s4">](</span><span class="s2">message</span><span class="s4">) : </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
            <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">case </span><span class="s2">TYPE_PREVIOUS_RESOLVED</span><span class="s4">:</span>
            <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">b</span><span class="s4">]);</span>
            <span class="s3">continue</span><span class="s4">;</span>
          <span class="s3">default</span><span class="s4">:</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">plugins</span><span class="s4">)) {</span>
              <span class="s3">const </span><span class="s2">r </span><span class="s4">= [];</span>
              <span class="s3">const </span><span class="s2">vals </span><span class="s4">= </span><span class="s2">value</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">);</span>
              <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">vals</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
                <span class="s3">const </span><span class="s2">v </span><span class="s4">= </span><span class="s2">vals</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
                <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
                  <span class="s2">v</span><span class="s4">,</span>
                  <span class="s4">(</span><span class="s2">v2</span><span class="s4">) =&gt; {</span>
                    <span class="s2">r</span><span class="s4">[</span><span class="s2">i</span><span class="s4">] = </span><span class="s2">v2</span><span class="s4">;</span>
                  <span class="s4">}</span>
                <span class="s4">]);</span>
              <span class="s4">}</span>
              <span class="s2">postRun</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(() =&gt; {</span>
                <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">plugin of plugins</span><span class="s4">) {</span>
                  <span class="s3">const </span><span class="s2">result2 </span><span class="s4">= </span><span class="s2">plugin</span><span class="s4">(</span><span class="s2">value</span><span class="s4">[</span><span class="s7">0</span><span class="s4">], </span><span class="s2">...r</span><span class="s4">);</span>
                  <span class="s3">if </span><span class="s4">(</span><span class="s2">result2</span><span class="s4">) {</span>
                    <span class="s2">set</span><span class="s4">(</span><span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">result2</span><span class="s4">.</span><span class="s2">value</span><span class="s4">);</span>
                    <span class="s3">return</span><span class="s4">;</span>
                  <span class="s4">}</span>
                <span class="s4">}</span>
                <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
              <span class="s4">});</span>
              <span class="s3">continue</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
        <span class="s4">}</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">const </span><span class="s2">array </span><span class="s4">= [];</span>
        <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">array</span><span class="s4">;</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">value</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
          <span class="s3">const </span><span class="s2">n </span><span class="s4">= </span><span class="s2">value</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">n </span><span class="s4">!== </span><span class="s2">HOLE</span><span class="s4">) {</span>
            <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
              <span class="s2">n</span><span class="s4">,</span>
              <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
                <span class="s2">array</span><span class="s4">[</span><span class="s2">i</span><span class="s4">] = </span><span class="s2">v</span><span class="s4">;</span>
              <span class="s4">}</span>
            <span class="s4">]);</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s2">set</span><span class="s4">(</span><span class="s2">array</span><span class="s4">);</span>
        <span class="s3">continue</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">const </span><span class="s2">object </span><span class="s4">= {};</span>
      <span class="s2">hydrated</span><span class="s4">[</span><span class="s2">index2</span><span class="s4">] = </span><span class="s2">object</span><span class="s4">;</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">key of Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">value</span><span class="s4">).</span><span class="s2">reverse</span><span class="s4">()) {</span>
        <span class="s3">const </span><span class="s2">r </span><span class="s4">= [];</span>
        <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
          <span class="s2">value</span><span class="s4">[</span><span class="s2">key</span><span class="s4">],</span>
          <span class="s4">(</span><span class="s2">v</span><span class="s4">) =&gt; {</span>
            <span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">] = </span><span class="s2">v</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">]);</span>
        <span class="s2">stack</span><span class="s4">.</span><span class="s2">push</span><span class="s4">([</span>
          <span class="s2">Number</span><span class="s4">(</span><span class="s2">key</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">)),</span>
          <span class="s4">(</span><span class="s2">k</span><span class="s4">) =&gt; {</span>
            <span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] = </span><span class="s2">k</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">]);</span>
        <span class="s2">postRun</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(() =&gt; {</span>
          <span class="s2">object</span><span class="s4">[</span><span class="s2">r</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]] = </span><span class="s2">r</span><span class="s4">[</span><span class="s7">1</span><span class="s4">];</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s2">set</span><span class="s4">(</span><span class="s2">object</span><span class="s4">);</span>
      <span class="s3">continue</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">postRun</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s2">postRun</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">()();</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// vendor/turbo-stream-v2/turbo-stream.ts</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">decode</span><span class="s4">(</span><span class="s2">readable</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">plugins </span><span class="s4">} = </span><span class="s2">options </span><span class="s4">?? {};</span>
  <span class="s3">const </span><span class="s2">done </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Deferred2</span><span class="s4">();</span>
  <span class="s3">const </span><span class="s2">reader </span><span class="s4">= </span><span class="s2">readable</span><span class="s4">.</span><span class="s2">pipeThrough</span><span class="s4">(</span><span class="s2">createLineSplittingTransform</span><span class="s4">()).</span><span class="s2">getReader</span><span class="s4">();</span>
  <span class="s3">const </span><span class="s2">decoder </span><span class="s4">= {</span>
    <span class="s2">values</span><span class="s4">: [],</span>
    <span class="s2">hydrated</span><span class="s4">: [],</span>
    <span class="s2">deferred</span><span class="s4">: {},</span>
    <span class="s2">plugins</span>
  <span class="s4">};</span>
  <span class="s3">const </span><span class="s2">decoded </span><span class="s4">= </span><span class="s3">await </span><span class="s2">decodeInitial</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">decoder</span><span class="s4">, </span><span class="s2">reader</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">donePromise </span><span class="s4">= </span><span class="s2">done</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">decoded</span><span class="s4">.</span><span class="s2">done</span><span class="s4">) {</span>
    <span class="s2">done</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">donePromise </span><span class="s4">= </span><span class="s2">decodeDeferred</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">decoder</span><span class="s4">, </span><span class="s2">reader</span><span class="s4">).</span><span class="s2">then</span><span class="s4">(</span><span class="s2">done</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">).</span><span class="s2">catch</span><span class="s4">((</span><span class="s2">reason</span><span class="s4">) =&gt; {</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s2">deferred of Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">decoder</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">)) {</span>
        <span class="s2">deferred</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">(</span><span class="s2">reason</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">done</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">(</span><span class="s2">reason</span><span class="s4">);</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">done</span><span class="s4">: </span><span class="s2">donePromise</span><span class="s4">.</span><span class="s2">then</span><span class="s4">(() =&gt; </span><span class="s2">reader</span><span class="s4">.</span><span class="s2">closed</span><span class="s4">),</span>
    <span class="s2">value</span><span class="s4">: </span><span class="s2">decoded</span><span class="s4">.</span><span class="s2">value</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">decodeInitial</span><span class="s4">(</span><span class="s2">reader</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s2">read </span><span class="s4">= </span><span class="s3">await </span><span class="s2">reader</span><span class="s4">.</span><span class="s2">read</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">read</span><span class="s4">.</span><span class="s2">value</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">line</span><span class="s4">;</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s2">line </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">read</span><span class="s4">.</span><span class="s2">value</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">reason</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">done</span><span class="s4">: </span><span class="s2">read</span><span class="s4">.</span><span class="s2">done</span><span class="s4">,</span>
    <span class="s2">value</span><span class="s4">: </span><span class="s2">unflatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">line</span><span class="s4">)</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">decodeDeferred</span><span class="s4">(</span><span class="s2">reader</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">read </span><span class="s4">= </span><span class="s3">await </span><span class="s2">reader</span><span class="s4">.</span><span class="s2">read</span><span class="s4">();</span>
  <span class="s3">while </span><span class="s4">(!</span><span class="s2">read</span><span class="s4">.</span><span class="s2">done</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">read</span><span class="s4">.</span><span class="s2">value</span><span class="s4">) </span><span class="s3">continue</span><span class="s4">;</span>
    <span class="s3">const </span><span class="s2">line </span><span class="s4">= </span><span class="s2">read</span><span class="s4">.</span><span class="s2">value</span><span class="s4">;</span>
    <span class="s3">switch </span><span class="s4">(</span><span class="s2">line</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]) {</span>
      <span class="s3">case </span><span class="s2">TYPE_PROMISE</span><span class="s4">: {</span>
        <span class="s3">const </span><span class="s2">colonIndex </span><span class="s4">= </span><span class="s2">line</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s5">&quot;:&quot;</span><span class="s4">);</span>
        <span class="s3">const </span><span class="s2">deferredId </span><span class="s4">= </span><span class="s2">Number</span><span class="s4">(</span><span class="s2">line</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">, </span><span class="s2">colonIndex</span><span class="s4">));</span>
        <span class="s3">const </span><span class="s2">deferred </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">[</span><span class="s2">deferredId</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">deferred</span><span class="s4">) {</span>
          <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">`Deferred ID </span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">} </span><span class="s5">not found in stream`</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">const </span><span class="s2">lineData </span><span class="s4">= </span><span class="s2">line</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">colonIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">jsonLine</span><span class="s4">;</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s2">jsonLine </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">lineData</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">reason</span><span class="s4">) {</span>
          <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
        <span class="s4">}</span>
        <span class="s3">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">unflatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">jsonLine</span><span class="s4">);</span>
        <span class="s2">deferred</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">case </span><span class="s2">TYPE_ERROR</span><span class="s4">: {</span>
        <span class="s3">const </span><span class="s2">colonIndex </span><span class="s4">= </span><span class="s2">line</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s5">&quot;:&quot;</span><span class="s4">);</span>
        <span class="s3">const </span><span class="s2">deferredId </span><span class="s4">= </span><span class="s2">Number</span><span class="s4">(</span><span class="s2">line</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">, </span><span class="s2">colonIndex</span><span class="s4">));</span>
        <span class="s3">const </span><span class="s2">deferred </span><span class="s4">= </span><span class="s3">this</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">[</span><span class="s2">deferredId</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">deferred</span><span class="s4">) {</span>
          <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">`Deferred ID </span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">} </span><span class="s5">not found in stream`</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">const </span><span class="s2">lineData </span><span class="s4">= </span><span class="s2">line</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">colonIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">jsonLine</span><span class="s4">;</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s2">jsonLine </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">lineData</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">reason</span><span class="s4">) {</span>
          <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
        <span class="s4">}</span>
        <span class="s3">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">unflatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s3">this</span><span class="s4">, </span><span class="s2">jsonLine</span><span class="s4">);</span>
        <span class="s2">deferred</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
        <span class="s3">break</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">default</span><span class="s4">:</span>
        <span class="s3">throw new </span><span class="s2">SyntaxError</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s2">read </span><span class="s4">= </span><span class="s3">await </span><span class="s2">reader</span><span class="s4">.</span><span class="s2">read</span><span class="s4">();</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">encode</span><span class="s4">(</span><span class="s2">input</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
  <span class="s3">const </span><span class="s4">{ </span><span class="s2">plugins</span><span class="s4">, </span><span class="s2">postPlugins</span><span class="s4">, </span><span class="s2">signal </span><span class="s4">} = </span><span class="s2">options </span><span class="s4">?? {};</span>
  <span class="s3">const </span><span class="s2">encoder2 </span><span class="s4">= {</span>
    <span class="s2">deferred</span><span class="s4">: {},</span>
    <span class="s2">index</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">indices</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(),</span>
    <span class="s2">stringified</span><span class="s4">: [],</span>
    <span class="s2">plugins</span><span class="s4">,</span>
    <span class="s2">postPlugins</span><span class="s4">,</span>
    <span class="s2">signal</span>
  <span class="s4">};</span>
  <span class="s3">const </span><span class="s2">textEncoder </span><span class="s4">= </span><span class="s3">new </span><span class="s2">TextEncoder</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">lastSentIndex </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">const </span><span class="s2">readable </span><span class="s4">= </span><span class="s3">new </span><span class="s2">ReadableStream</span><span class="s4">({</span>
    <span class="s2">async start</span><span class="s4">(</span><span class="s2">controller</span><span class="s4">) {</span>
      <span class="s3">const </span><span class="s2">id </span><span class="s4">= </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">, </span><span class="s2">input</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">id</span><span class="s4">)) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;This should never happen&quot;</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">id </span><span class="s4">&lt; </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span><span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id</span><span class="s4">}</span>
<span class="s5">`</span><span class="s4">));</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
          <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s5">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">] 
`</span><span class="s4">)</span>
        <span class="s4">);</span>
        <span class="s2">lastSentIndex </span><span class="s4">= </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">const </span><span class="s2">seenPromises </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">WeakSet</span><span class="s4">();</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">).</span><span class="s2">length</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">raceDone</span><span class="s4">;</span>
        <span class="s3">const </span><span class="s2">racePromise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">, </span><span class="s2">reject</span><span class="s4">) =&gt; {</span>
          <span class="s2">raceDone </span><span class="s4">= </span><span class="s2">resolve</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">signal</span><span class="s4">) {</span>
            <span class="s3">const </span><span class="s2">rejectPromise </span><span class="s4">= () =&gt; </span><span class="s2">reject</span><span class="s4">(</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">reason </span><span class="s4">|| </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Signal was aborted.&quot;</span><span class="s4">));</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
              <span class="s2">rejectPromise</span><span class="s4">();</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s2">signal</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;abort&quot;</span><span class="s4">, (</span><span class="s2">event</span><span class="s4">) =&gt; {</span>
                <span class="s2">rejectPromise</span><span class="s4">();</span>
              <span class="s4">});</span>
            <span class="s4">}</span>
          <span class="s4">}</span>
        <span class="s4">});</span>
        <span class="s3">while </span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">).</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
          <span class="s3">for </span><span class="s4">(</span><span class="s3">const </span><span class="s4">[</span><span class="s2">deferredId</span><span class="s4">, </span><span class="s2">deferred</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span>
            <span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span>
          <span class="s4">)) {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">seenPromises</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">deferred</span><span class="s4">)) </span><span class="s3">continue</span><span class="s4">;</span>
            <span class="s2">seenPromises</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span>
              <span class="s6">// biome-ignore lint/suspicious/noAssignInExpressions: &lt;explanation&gt;</span>
              <span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">[</span><span class="s2">Number</span><span class="s4">(</span><span class="s2">deferredId</span><span class="s4">)] = </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">race</span><span class="s4">([</span>
                <span class="s2">racePromise</span><span class="s4">,</span>
                <span class="s2">deferred</span>
              <span class="s4">]).</span><span class="s2">then</span><span class="s4">(</span>
                <span class="s4">(</span><span class="s2">resolved</span><span class="s4">) =&gt; {</span>
                  <span class="s3">const </span><span class="s2">id2 </span><span class="s4">= </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">, </span><span class="s2">resolved</span><span class="s4">);</span>
                  <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">id2</span><span class="s4">)) {</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span>
                        <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PROMISE</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:[[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PREVIOUS_RESOLVED</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id2</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]}</span><span class="s5">]] 
`</span>
                      <span class="s4">)</span>
                    <span class="s4">);</span>
                    <span class="s2">encoder2</span><span class="s4">.</span><span class="s2">index</span><span class="s4">++;</span>
                    <span class="s2">lastSentIndex</span><span class="s4">++;</span>
                  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">id2 </span><span class="s4">&lt; </span><span class="s7">0</span><span class="s4">) {</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span>
                        <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PROMISE</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id2</span><span class="s4">}</span>
<span class="s5">`</span>
                      <span class="s4">)</span>
                    <span class="s4">);</span>
                  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
                    <span class="s3">const </span><span class="s2">values </span><span class="s4">= </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">lastSentIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">);</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span>
                        <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PROMISE</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">values</span><span class="s4">}</span><span class="s5">] 
`</span>
                      <span class="s4">)</span>
                    <span class="s4">);</span>
                    <span class="s2">lastSentIndex </span><span class="s4">= </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
                  <span class="s4">}</span>
                <span class="s4">},</span>
                <span class="s4">(</span><span class="s2">reason</span><span class="s4">) =&gt; {</span>
                  <span class="s3">if </span><span class="s4">(!</span><span class="s2">reason </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">reason </span><span class="s4">!== </span><span class="s5">&quot;object&quot; </span><span class="s4">|| !(</span><span class="s2">reason </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">)) {</span>
                    <span class="s2">reason </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;An unknown error occurred&quot;</span><span class="s4">);</span>
                  <span class="s4">}</span>
                  <span class="s3">const </span><span class="s2">id2 </span><span class="s4">= </span><span class="s2">flatten</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">, </span><span class="s2">reason</span><span class="s4">);</span>
                  <span class="s3">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">id2</span><span class="s4">)) {</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span>
                        <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_ERROR</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:[[&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_PREVIOUS_RESOLVED</span><span class="s4">}</span><span class="s5">&quot;,</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id2</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]}</span><span class="s5">]] 
`</span>
                      <span class="s4">)</span>
                    <span class="s4">);</span>
                    <span class="s2">encoder2</span><span class="s4">.</span><span class="s2">index</span><span class="s4">++;</span>
                    <span class="s2">lastSentIndex</span><span class="s4">++;</span>
                  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">id2 </span><span class="s4">&lt; </span><span class="s7">0</span><span class="s4">) {</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_ERROR</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id2</span><span class="s4">}</span>
<span class="s5">`</span><span class="s4">)</span>
                    <span class="s4">);</span>
                  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
                    <span class="s3">const </span><span class="s2">values </span><span class="s4">= </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">lastSentIndex </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">);</span>
                    <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span>
                      <span class="s2">textEncoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span>
                        <span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">TYPE_ERROR</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">deferredId</span><span class="s4">}</span><span class="s5">:[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">values</span><span class="s4">}</span><span class="s5">] 
`</span>
                      <span class="s4">)</span>
                    <span class="s4">);</span>
                    <span class="s2">lastSentIndex </span><span class="s4">= </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">stringified</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
                  <span class="s4">}</span>
                <span class="s4">}</span>
              <span class="s4">).</span><span class="s2">finally</span><span class="s4">(() =&gt; {</span>
                <span class="s3">delete </span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">[</span><span class="s2">Number</span><span class="s4">(</span><span class="s2">deferredId</span><span class="s4">)];</span>
              <span class="s4">})</span>
            <span class="s4">);</span>
          <span class="s4">}</span>
          <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">race</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">));</span>
        <span class="s4">}</span>
        <span class="s2">raceDone</span><span class="s4">();</span>
      <span class="s4">}</span>
      <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">encoder2</span><span class="s4">.</span><span class="s2">deferred</span><span class="s4">));</span>
      <span class="s2">controller</span><span class="s4">.</span><span class="s2">close</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">readable</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/data.ts</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">createRequestInit</span><span class="s4">(</span><span class="s2">request</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">init </span><span class="s4">= { </span><span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal </span><span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">method </span><span class="s4">= </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">contentType </span><span class="s4">= </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">contentType </span><span class="s4">&amp;&amp; </span><span class="s8">/\bapplication\/json\b/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">contentType</span><span class="s4">)) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">= { </span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">: </span><span class="s2">contentType </span><span class="s4">};</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s3">await </span><span class="s2">request</span><span class="s4">.</span><span class="s2">json</span><span class="s4">());</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">contentType </span><span class="s4">&amp;&amp; </span><span class="s8">/\btext\/plain\b/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">contentType</span><span class="s4">)) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">= { </span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">: </span><span class="s2">contentType </span><span class="s4">};</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s3">await </span><span class="s2">request</span><span class="s4">.</span><span class="s2">text</span><span class="s4">();</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">contentType </span><span class="s4">&amp;&amp; </span><span class="s8">/\bapplication\/x-www-form-urlencoded\b/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">contentType</span><span class="s4">)) {</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">(</span><span class="s3">await </span><span class="s2">request</span><span class="s4">.</span><span class="s2">text</span><span class="s4">());</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">init</span><span class="s4">.</span><span class="s2">body </span><span class="s4">= </span><span class="s3">await </span><span class="s2">request</span><span class="s4">.</span><span class="s2">formData</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">init</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/single-fetch.tsx</span>
<span class="s3">var </span><span class="s2">SingleFetchRedirectSymbol </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">(</span><span class="s5">&quot;SingleFetchRedirect&quot;</span><span class="s4">);</span>
<span class="s3">var </span><span class="s2">SingleFetchNoResultError </span><span class="s4">= </span><span class="s3">class extends </span><span class="s2">Error </span><span class="s4">{</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS </span><span class="s4">= </span><span class="s7">202</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NO_BODY_STATUS_CODES </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s7">100</span><span class="s4">, </span><span class="s7">101</span><span class="s4">, </span><span class="s7">204</span><span class="s4">, </span><span class="s7">205</span><span class="s4">]);</span>
<span class="s3">function </span><span class="s2">StreamTransfer</span><span class="s4">({</span>
  <span class="s2">context</span><span class="s4">,</span>
  <span class="s2">identifier</span><span class="s4">,</span>
  <span class="s2">reader</span><span class="s4">,</span>
  <span class="s2">textDecoder</span><span class="s4">,</span>
  <span class="s2">nonce</span>
<span class="s4">}) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta </span><span class="s4">|| !</span><span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta</span><span class="s4">.</span><span class="s2">didRenderScripts</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta</span><span class="s4">.</span><span class="s2">streamCache</span><span class="s4">) {</span>
    <span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta</span><span class="s4">.</span><span class="s2">streamCache </span><span class="s4">= {};</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">streamCache </span><span class="s4">} = </span><span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s2">streamCache</span><span class="s4">[</span><span class="s2">identifier</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">promise</span><span class="s4">) {</span>
    <span class="s2">promise </span><span class="s4">= </span><span class="s2">streamCache</span><span class="s4">[</span><span class="s2">identifier</span><span class="s4">] = </span><span class="s2">reader</span><span class="s4">.</span><span class="s2">read</span><span class="s4">().</span><span class="s2">then</span><span class="s4">((</span><span class="s2">result</span><span class="s4">) =&gt; {</span>
      <span class="s2">streamCache</span><span class="s4">[</span><span class="s2">identifier</span><span class="s4">].</span><span class="s2">result </span><span class="s4">= {</span>
        <span class="s2">done</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">done</span><span class="s4">,</span>
        <span class="s2">value</span><span class="s4">: </span><span class="s2">textDecoder</span><span class="s4">.</span><span class="s2">decode</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">value</span><span class="s4">, { </span><span class="s2">stream</span><span class="s4">: </span><span class="s3">true </span><span class="s4">})</span>
      <span class="s4">};</span>
    <span class="s4">}).</span><span class="s2">catch</span><span class="s4">((</span><span class="s2">e</span><span class="s4">) =&gt; {</span>
      <span class="s2">streamCache</span><span class="s4">[</span><span class="s2">identifier</span><span class="s4">].</span><span class="s2">error </span><span class="s4">= </span><span class="s2">e</span><span class="s4">;</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">promise</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">throw </span><span class="s2">promise</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">promise</span><span class="s4">.</span><span class="s2">result </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">throw </span><span class="s2">promise</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">done</span><span class="s4">, </span><span class="s2">value </span><span class="s4">} = </span><span class="s2">promise</span><span class="s4">.</span><span class="s2">result</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">scriptTag </span><span class="s4">= </span><span class="s2">value </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">nonce</span><span class="s4">,</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
        <span class="s2">__html</span><span class="s4">: </span><span class="s5">`window.__reactRouterContext.streamController.enqueue(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">escapeHtml</span><span class="s4">(</span>
          <span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">value</span><span class="s4">)</span>
        <span class="s4">)}</span><span class="s5">);`</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">) : </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">done</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React4</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">scriptTag</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">nonce</span><span class="s4">,</span>
        <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
          <span class="s2">__html</span><span class="s4">: </span><span class="s5">`window.__reactRouterContext.streamController.close();`</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">));</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React4</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">scriptTag</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React4</span><span class="s4">.</span><span class="s2">Suspense</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React4</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">StreamTransfer</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">context</span><span class="s4">,</span>
        <span class="s2">identifier</span><span class="s4">: </span><span class="s2">identifier </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">,</span>
        <span class="s2">reader</span><span class="s4">,</span>
        <span class="s2">textDecoder</span><span class="s4">,</span>
        <span class="s2">nonce</span>
      <span class="s4">}</span>
    <span class="s4">)));</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getTurboStreamSingleFetchDataStrategy</span><span class="s4">(</span><span class="s2">getRouter</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">dataStrategy </span><span class="s4">= </span><span class="s2">getSingleFetchDataStrategyImpl</span><span class="s4">(</span>
    <span class="s2">getRouter</span><span class="s4">,</span>
    <span class="s4">(</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">manifestRoute </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">manifestRoute</span><span class="s4">, </span><span class="s5">&quot;Route not found in manifest&quot;</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">hasLoader</span><span class="s4">: </span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">,</span>
        <span class="s2">hasClientLoader</span><span class="s4">: </span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasClientLoader</span><span class="s4">,</span>
        <span class="s2">hasShouldRevalidate</span><span class="s4">: </span><span class="s2">Boolean</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">?.</span><span class="s2">shouldRevalidate</span><span class="s4">)</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">fetchAndDecodeViaTurboStream</span><span class="s4">,</span>
    <span class="s2">ssr</span><span class="s4">,</span>
    <span class="s2">basename</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">async </span><span class="s4">(</span><span class="s2">args</span><span class="s4">) =&gt; </span><span class="s2">args</span><span class="s4">.</span><span class="s2">unstable_runClientMiddleware</span><span class="s4">(</span><span class="s2">dataStrategy</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSingleFetchDataStrategyImpl</span><span class="s4">(</span><span class="s2">getRouter</span><span class="s4">, </span><span class="s2">getRouteInfo</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">async </span><span class="s4">(</span><span class="s2">args</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">request</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">fetcherKey </span><span class="s4">} = </span><span class="s2">args</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">router </span><span class="s4">= </span><span class="s2">getRouter</span><span class="s4">();</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">singleFetchActionStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">foundRevalidatingServerLoader </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">hasLoader</span><span class="s4">, </span><span class="s2">hasClientLoader </span><span class="s4">} = </span><span class="s2">getRouteInfo</span><span class="s4">(</span><span class="s2">m</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldCallHandler</span><span class="s4">() &amp;&amp; </span><span class="s2">hasLoader </span><span class="s4">&amp;&amp; !</span><span class="s2">hasClientLoader</span><span class="s4">;</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">ssr </span><span class="s4">&amp;&amp; !</span><span class="s2">foundRevalidatingServerLoader</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">nonSsrStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">getRouteInfo</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">singleFetchLoaderFetcherStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">singleFetchLoaderNavigationStrategy</span><span class="s4">(</span>
      <span class="s2">args</span><span class="s4">,</span>
      <span class="s2">router</span><span class="s4">,</span>
      <span class="s2">getRouteInfo</span><span class="s4">,</span>
      <span class="s2">fetchAndDecode</span><span class="s4">,</span>
      <span class="s2">ssr</span><span class="s4">,</span>
      <span class="s2">basename</span>
    <span class="s4">);</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">singleFetchActionStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">actionMatch </span><span class="s4">= </span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">find</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldCallHandler</span><span class="s4">());</span>
  <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">actionMatch</span><span class="s4">, </span><span class="s5">&quot;No action match found&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">actionStatus </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">result2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">status </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">fetchAndDecode</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, [</span>
        <span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span>
      <span class="s4">]);</span>
      <span class="s2">actionStatus </span><span class="s4">= </span><span class="s2">status</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
    <span class="s4">});</span>
    <span class="s3">return </span><span class="s2">result2</span><span class="s4">;</span>
  <span class="s4">});</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">) || </span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">) || </span><span class="s2">isDataWithResponseInit</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{ [</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s4">[</span><span class="s2">actionMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: {</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">type</span><span class="s4">,</span>
      <span class="s2">result</span><span class="s4">: </span><span class="s2">data</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">result</span><span class="s4">, </span><span class="s2">actionStatus</span><span class="s4">)</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">nonSsrStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">getRouteInfo</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">matchesToLoad </span><span class="s4">= </span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldCallHandler</span><span class="s4">()</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">results </span><span class="s4">= {};</span>
  <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
    <span class="s2">matchesToLoad</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) =&gt; {</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">hasClientLoader </span><span class="s4">} = </span><span class="s2">getRouteInfo</span><span class="s4">(</span><span class="s2">m</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">hasClientLoader </span><span class="s4">? </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
            <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">fetchAndDecode</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, [</span><span class="s2">routeId</span><span class="s4">]);</span>
            <span class="s3">return </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">);</span>
          <span class="s4">}) : </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">();</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot;</span><span class="s4">, </span><span class="s2">result </span><span class="s4">};</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">})</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">results</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">singleFetchLoaderNavigationStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">router</span><span class="s4">, </span><span class="s2">getRouteInfo</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routesParams </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">routeDfds </span><span class="s4">= </span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(() =&gt; </span><span class="s2">createDeferred2</span><span class="s4">());</span>
  <span class="s3">let </span><span class="s2">singleFetchDfd </span><span class="s4">= </span><span class="s2">createDeferred2</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">results </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">resolvePromise </span><span class="s4">= </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
    <span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
      <span class="s2">async </span><span class="s4">(</span><span class="s2">m</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">async </span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) =&gt; {</span>
        <span class="s2">routeDfds</span><span class="s4">[</span><span class="s2">i</span><span class="s4">].</span><span class="s2">resolve</span><span class="s4">();</span>
        <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s4">{ </span><span class="s2">hasLoader</span><span class="s4">, </span><span class="s2">hasClientLoader</span><span class="s4">, </span><span class="s2">hasShouldRevalidate </span><span class="s4">} = </span><span class="s2">getRouteInfo</span><span class="s4">(</span><span class="s2">m</span><span class="s4">);</span>
        <span class="s3">let </span><span class="s2">defaultShouldRevalidate </span><span class="s4">= !</span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldRevalidateArgs </span><span class="s4">|| </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">.</span><span class="s2">actionStatus </span><span class="s4">== </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldRevalidateArgs</span><span class="s4">.</span><span class="s2">actionStatus </span><span class="s4">&lt; </span><span class="s7">400</span><span class="s4">;</span>
        <span class="s3">let </span><span class="s2">shouldCall </span><span class="s4">= </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldCallHandler</span><span class="s4">(</span><span class="s2">defaultShouldRevalidate</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">shouldCall</span><span class="s4">) {</span>
          <span class="s2">foundOptOutRoute </span><span class="s4">|| (</span><span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldRevalidateArgs </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s6">// This is a revalidation,</span>
          <span class="s2">hasLoader </span><span class="s4">&amp;&amp; </span><span class="s6">// for a route with a server loader,</span>
          <span class="s2">hasShouldRevalidate </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">);</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">hasClientLoader</span><span class="s4">) {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">hasLoader</span><span class="s4">) {</span>
            <span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
          <span class="s4">}</span>
          <span class="s3">try </span><span class="s4">{</span>
            <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
              <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">fetchAndDecode</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, [</span><span class="s2">routeId</span><span class="s4">]);</span>
              <span class="s3">return </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">);</span>
            <span class="s4">});</span>
            <span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot;</span><span class="s4">, </span><span class="s2">result </span><span class="s4">};</span>
          <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
            <span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
          <span class="s4">}</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">hasLoader</span><span class="s4">) {</span>
          <span class="s2">routesParams</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
            <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">singleFetchDfd</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">;</span>
            <span class="s3">return </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">);</span>
          <span class="s4">});</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;data&quot;</span><span class="s4">, </span><span class="s2">result </span><span class="s4">};</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = { </span><span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;error&quot;</span><span class="s4">, </span><span class="s2">result</span><span class="s4">: </span><span class="s2">e </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">})</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span><span class="s2">routeDfds</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">d</span><span class="s4">) =&gt; </span><span class="s2">d</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">isInitialLoad </span><span class="s4">= !</span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">initialized </span><span class="s4">&amp;&amp; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;idle&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">((</span><span class="s2">isInitialLoad </span><span class="s4">|| </span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">size </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) &amp;&amp; !</span><span class="s2">window</span><span class="s4">.</span><span class="s2">__reactRouterHdrActive</span><span class="s4">) {</span>
    <span class="s2">singleFetchDfd</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">({ </span><span class="s2">routes</span><span class="s4">: {} });</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">targetRoutes </span><span class="s4">= </span><span class="s2">ssr </span><span class="s4">&amp;&amp; </span><span class="s2">foundOptOutRoute </span><span class="s4">&amp;&amp; </span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">? [</span><span class="s2">...routesParams</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">()] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">fetchAndDecode</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">targetRoutes</span><span class="s4">);</span>
      <span class="s2">singleFetchDfd</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s2">singleFetchDfd</span><span class="s4">.</span><span class="s2">reject</span><span class="s4">(</span><span class="s2">e</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">await </span><span class="s2">resolvePromise</span><span class="s4">;</span>
  <span class="s3">await </span><span class="s2">bubbleMiddlewareErrors</span><span class="s4">(</span>
    <span class="s2">singleFetchDfd</span><span class="s4">.</span><span class="s2">promise</span><span class="s4">,</span>
    <span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">,</span>
    <span class="s2">routesParams</span><span class="s4">,</span>
    <span class="s2">results</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">results</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">bubbleMiddlewareErrors</span><span class="s4">(</span><span class="s2">singleFetchPromise</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routesParams</span><span class="s4">, </span><span class="s2">results</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">middlewareError</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">fetchedData </span><span class="s4">= </span><span class="s3">await </span><span class="s2">singleFetchPromise</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;routes&quot; </span><span class="s3">in </span><span class="s2">fetchedData</span><span class="s4">) {</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of matches</span><span class="s4">) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">fetchedData</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">routeResult </span><span class="s4">= </span><span class="s2">fetchedData</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;error&quot; </span><span class="s3">in </span><span class="s2">routeResult</span><span class="s4">) {</span>
            <span class="s2">middlewareError </span><span class="s4">= </span><span class="s2">routeResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
            <span class="s3">break</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">middlewareError </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">values</span><span class="s4">()).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">routeId</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">].</span><span class="s2">result </span><span class="s3">instanceof </span><span class="s2">SingleFetchNoResultError</span><span class="s4">) {</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">].</span><span class="s2">result </span><span class="s4">= </span><span class="s2">middlewareError</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">singleFetchLoaderFetcherStrategy</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">fetchAndDecode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">fetcherMatch </span><span class="s4">= </span><span class="s2">args</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">find</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">unstable_shouldCallHandler</span><span class="s4">());</span>
  <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">fetcherMatch</span><span class="s4">, </span><span class="s5">&quot;No fetcher match found&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">fetcherMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">fetcherMatch</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span>
    <span class="s2">async </span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) =&gt; </span><span class="s2">handler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">fetchAndDecode</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, [</span><span class="s2">routeId</span><span class="s4">]);</span>
      <span class="s3">return </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">);</span>
    <span class="s4">})</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{ [</span><span class="s2">fetcherMatch</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">result </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stripIndexParam</span><span class="s4">(</span><span class="s2">url</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">indexValues </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
  <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">indexValuesToKeep </span><span class="s4">= [];</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">indexValue of indexValues</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">indexValue</span><span class="s4">) {</span>
      <span class="s2">indexValuesToKeep</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">indexValue</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">toKeep of indexValuesToKeep</span><span class="s4">) {</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">, </span><span class="s2">toKeep</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">url</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">singleFetchUrl</span><span class="s4">(</span><span class="s2">reqUrl</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">reqUrl </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span>
    <span class="s2">reqUrl</span><span class="s4">,</span>
    <span class="s6">// This can be called during the SSR flow via PrefetchPageLinksImpl so</span>
    <span class="s6">// don't assume window is available</span>
    <span class="s3">typeof </span><span class="s2">window </span><span class="s4">=== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">? </span><span class="s5">&quot;server://singlefetch/&quot; </span><span class="s4">: </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin</span>
  <span class="s4">) : </span><span class="s2">reqUrl</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s5">&quot;_root.data&quot;</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">&amp;&amp; </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) === </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">basename</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">)}</span><span class="s5">/_root.data`</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">)}</span><span class="s5">.data`</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">url</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">fetchAndDecodeViaTurboStream</span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">targetRoutes</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">request </span><span class="s4">} = </span><span class="s2">args</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">singleFetchUrl</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">=== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
    <span class="s2">url </span><span class="s4">= </span><span class="s2">stripIndexParam</span><span class="s4">(</span><span class="s2">url</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">targetRoutes</span><span class="s4">) {</span>
      <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;_routes&quot;</span><span class="s4">, </span><span class="s2">targetRoutes</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">));</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">res </span><span class="s4">= </span><span class="s3">await </span><span class="s2">fetch</span><span class="s4">(</span><span class="s2">url</span><span class="s4">, </span><span class="s3">await </span><span class="s2">createRequestInit</span><span class="s4">(</span><span class="s2">request</span><span class="s4">));</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">404 </span><span class="s4">&amp;&amp; !</span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Response&quot;</span><span class="s4">)) {</span>
    <span class="s3">throw new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span><span class="s7">404</span><span class="s4">, </span><span class="s5">&quot;Not Found&quot;</span><span class="s4">, </span><span class="s3">true</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">204 </span><span class="s4">&amp;&amp; </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Redirect&quot;</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: {</span>
        <span class="s2">redirect</span><span class="s4">: {</span>
          <span class="s2">redirect</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Redirect&quot;</span><span class="s4">),</span>
          <span class="s2">status</span><span class="s4">: </span><span class="s2">Number</span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Status&quot;</span><span class="s4">) || </span><span class="s5">&quot;302&quot;</span><span class="s4">),</span>
          <span class="s2">revalidate</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Revalidate&quot;</span><span class="s4">) === </span><span class="s5">&quot;true&quot;</span><span class="s4">,</span>
          <span class="s2">reload</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">) === </span><span class="s5">&quot;true&quot;</span><span class="s4">,</span>
          <span class="s2">replace</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Replace&quot;</span><span class="s4">) === </span><span class="s5">&quot;true&quot;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">NO_BODY_STATUS_CODES</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">routes </span><span class="s4">= {};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">targetRoutes </span><span class="s4">&amp;&amp; </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
      <span class="s2">routes</span><span class="s4">[</span><span class="s2">targetRoutes</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]] = { </span><span class="s2">data</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: { </span><span class="s2">routes </span><span class="s4">}</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">body</span><span class="s4">, </span><span class="s5">&quot;No response body to decode&quot;</span><span class="s4">);</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">decoded </span><span class="s4">= </span><span class="s3">await </span><span class="s2">decodeViaTurboStream</span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">body</span><span class="s4">, </span><span class="s2">window</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">data2</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">=== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">typed </span><span class="s4">= </span><span class="s2">decoded</span><span class="s4">.</span><span class="s2">value</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">SingleFetchRedirectSymbol </span><span class="s3">in </span><span class="s2">typed</span><span class="s4">) {</span>
        <span class="s2">data2 </span><span class="s4">= { </span><span class="s2">redirect</span><span class="s4">: </span><span class="s2">typed</span><span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">] };</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">data2 </span><span class="s4">= { </span><span class="s2">routes</span><span class="s4">: </span><span class="s2">typed </span><span class="s4">};</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">typed </span><span class="s4">= </span><span class="s2">decoded</span><span class="s4">.</span><span class="s2">value</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">targetRoutes</span><span class="s4">?.[</span><span class="s7">0</span><span class="s4">];</span>
      <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s5">&quot;No routeId found for single fetch call decoding&quot;</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;redirect&quot; </span><span class="s3">in </span><span class="s2">typed</span><span class="s4">) {</span>
        <span class="s2">data2 </span><span class="s4">= { </span><span class="s2">redirect</span><span class="s4">: </span><span class="s2">typed </span><span class="s4">};</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">data2 </span><span class="s4">= { </span><span class="s2">routes</span><span class="s4">: { [</span><span class="s2">routeId</span><span class="s4">]: </span><span class="s2">typed </span><span class="s4">} };</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">status</span><span class="s4">: </span><span class="s2">res</span><span class="s4">.</span><span class="s2">status</span><span class="s4">, </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">};</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Unable to decode turbo-stream response&quot;</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">decodeViaTurboStream</span><span class="s4">(</span><span class="s2">body</span><span class="s4">, </span><span class="s2">global2</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">decode</span><span class="s4">(</span><span class="s2">body</span><span class="s4">, {</span>
    <span class="s2">plugins</span><span class="s4">: [</span>
      <span class="s4">(</span><span class="s2">type</span><span class="s4">, </span><span class="s2">...rest</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;SanitizedError&quot;</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s4">[</span><span class="s2">name</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">stack</span><span class="s4">] = </span><span class="s2">rest</span><span class="s4">;</span>
          <span class="s3">let </span><span class="s2">Constructor </span><span class="s4">= </span><span class="s2">Error</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">name </span><span class="s4">&amp;&amp; </span><span class="s2">name </span><span class="s3">in </span><span class="s2">global2 </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">global2</span><span class="s4">[</span><span class="s2">name</span><span class="s4">] === </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s2">Constructor </span><span class="s4">= </span><span class="s2">global2</span><span class="s4">[</span><span class="s2">name</span><span class="s4">];</span>
          <span class="s4">}</span>
          <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Constructor</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
          <span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s2">stack</span><span class="s4">;</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">value</span><span class="s4">: </span><span class="s2">error </span><span class="s4">};</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;ErrorResponse&quot;</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s4">[</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">status</span><span class="s4">, </span><span class="s2">statusText</span><span class="s4">] = </span><span class="s2">rest</span><span class="s4">;</span>
          <span class="s3">return </span><span class="s4">{</span>
            <span class="s2">value</span><span class="s4">: </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span><span class="s2">status</span><span class="s4">, </span><span class="s2">statusText</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">)</span>
          <span class="s4">};</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;SingleFetchRedirect&quot;</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">value</span><span class="s4">: { [</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">]: </span><span class="s2">rest</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] } };</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;SingleFetchClassInstance&quot;</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">value</span><span class="s4">: </span><span class="s2">rest</span><span class="s4">[</span><span class="s7">0</span><span class="s4">] };</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;SingleFetchFallback&quot;</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s4">{ </span><span class="s2">value</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">]</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">unwrapSingleFetchResult</span><span class="s4">(</span><span class="s2">result</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;redirect&quot; </span><span class="s3">in </span><span class="s2">result</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s4">{</span>
      <span class="s2">redirect</span><span class="s4">: </span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">revalidate</span><span class="s4">,</span>
      <span class="s2">reload</span><span class="s4">,</span>
      <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
      <span class="s2">status</span>
    <span class="s4">} = </span><span class="s2">result</span><span class="s4">.</span><span class="s2">redirect</span><span class="s4">;</span>
    <span class="s3">throw </span><span class="s2">redirect</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, {</span>
      <span class="s2">status</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: {</span>
        <span class="s6">// Three R's of redirecting (lol Veep)</span>
        <span class="s2">...revalidate </span><span class="s4">? { </span><span class="s5">&quot;X-Remix-Revalidate&quot;</span><span class="s4">: </span><span class="s5">&quot;yes&quot; </span><span class="s4">} : </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">...reload </span><span class="s4">? { </span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">: </span><span class="s5">&quot;yes&quot; </span><span class="s4">} : </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">...replace2 </span><span class="s4">? { </span><span class="s5">&quot;X-Remix-Replace&quot;</span><span class="s4">: </span><span class="s5">&quot;yes&quot; </span><span class="s4">} : </span><span class="s3">null</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">routeResult </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">routeResult </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">throw new </span><span class="s2">SingleFetchNoResultError</span><span class="s4">(</span>
      <span class="s5">`No result found for routeId &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot;`</span>
    <span class="s4">);</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s5">&quot;error&quot; </span><span class="s3">in </span><span class="s2">routeResult</span><span class="s4">) {</span>
    <span class="s3">throw </span><span class="s2">routeResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s5">&quot;data&quot; </span><span class="s3">in </span><span class="s2">routeResult</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">routeResult</span><span class="s4">.</span><span class="s2">data</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">`Invalid response found for routeId &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot;`</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createDeferred2</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">resolve</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">reject</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">promise </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">res</span><span class="s4">, </span><span class="s2">rej</span><span class="s4">) =&gt; {</span>
    <span class="s2">resolve </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">val</span><span class="s4">) =&gt; {</span>
      <span class="s2">res</span><span class="s4">(</span><span class="s2">val</span><span class="s4">);</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s4">}</span>
    <span class="s4">};</span>
    <span class="s2">reject </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) =&gt; {</span>
      <span class="s2">rej</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">promise</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s4">}</span>
    <span class="s4">};</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">promise</span><span class="s4">,</span>
    <span class="s6">//@ts-ignore</span>
    <span class="s2">resolve</span><span class="s4">,</span>
    <span class="s6">//@ts-ignore</span>
    <span class="s2">reject</span>
  <span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/fog-of-war.ts</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React8 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// lib/dom/ssr/routes.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React7 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>

<span class="s6">// lib/dom/ssr/errorBoundaries.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React5 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">RemixErrorBoundary </span><span class="s4">= </span><span class="s3">class extends </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">{</span>
  <span class="s2">constructor</span><span class="s4">(</span><span class="s2">props</span><span class="s4">) {</span>
    <span class="s3">super</span><span class="s4">(</span><span class="s2">props</span><span class="s4">);</span>
    <span class="s3">this</span><span class="s4">.</span><span class="s2">state </span><span class="s4">= { </span><span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">static </span><span class="s2">getDerivedStateFromError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">error </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">static </span><span class="s2">getDerivedStateFromProps</span><span class="s4">(</span><span class="s2">props</span><span class="s4">, </span><span class="s2">state</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location </span><span class="s4">!== </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">{ </span><span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">location </span><span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">{ </span><span class="s2">error</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">error </span><span class="s4">|| </span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">, </span><span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location </span><span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s2">render</span><span class="s4">() {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
        <span class="s2">RemixRootDefaultErrorBoundary</span><span class="s4">,</span>
        <span class="s4">{</span>
          <span class="s2">error</span><span class="s4">: </span><span class="s3">this</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">error</span><span class="s4">,</span>
          <span class="s2">isOutsideRemixApp</span><span class="s4">: </span><span class="s3">true</span>
        <span class="s4">}</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">return this</span><span class="s4">.</span><span class="s2">props</span><span class="s4">.</span><span class="s2">children</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">RemixRootDefaultErrorBoundary</span><span class="s4">({</span>
  <span class="s2">error</span><span class="s4">,</span>
  <span class="s2">isOutsideRemixApp</span>
<span class="s4">}) {</span>
  <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">heyDeveloper </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
        <span class="s2">__html</span><span class="s4">: </span><span class="s5">`</span>
        <span class="s5">console.log( 
          &quot;</span><span class="s3">\u{1F4BF} </span><span class="s5">Hey developer </span><span class="s3">\u{1F44B}</span><span class="s5">. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information.&quot; 
        ); 
      `</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)) {</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">BoundaryShell</span><span class="s4">, { </span><span class="s2">title</span><span class="s4">: </span><span class="s5">&quot;Unhandled Thrown Response!&quot; </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;h1&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: { </span><span class="s2">fontSize</span><span class="s4">: </span><span class="s5">&quot;24px&quot; </span><span class="s4">} }, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">status</span><span class="s4">, </span><span class="s5">&quot; &quot;</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">), </span><span class="s2">ENABLE_DEV_WARNINGS </span><span class="s4">? </span><span class="s2">heyDeveloper </span><span class="s4">: </span><span class="s3">null</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">errorInstance</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
    <span class="s2">errorInstance </span><span class="s4">= </span><span class="s2">error</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">errorString </span><span class="s4">= </span><span class="s2">error </span><span class="s4">== </span><span class="s3">null </span><span class="s4">? </span><span class="s5">&quot;Unknown Error&quot; </span><span class="s4">: </span><span class="s3">typeof </span><span class="s2">error </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s5">&quot;toString&quot; </span><span class="s3">in </span><span class="s2">error </span><span class="s4">? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">() : </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s2">errorInstance </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">errorString</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">BoundaryShell</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">title</span><span class="s4">: </span><span class="s5">&quot;Application Error!&quot;</span><span class="s4">,</span>
      <span class="s2">isOutsideRemixApp</span>
    <span class="s4">},</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;h1&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: { </span><span class="s2">fontSize</span><span class="s4">: </span><span class="s5">&quot;24px&quot; </span><span class="s4">} }, </span><span class="s5">&quot;Application Error&quot;</span><span class="s4">),</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s5">&quot;pre&quot;</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">style</span><span class="s4">: {</span>
          <span class="s2">padding</span><span class="s4">: </span><span class="s5">&quot;2rem&quot;</span><span class="s4">,</span>
          <span class="s2">background</span><span class="s4">: </span><span class="s5">&quot;hsla(10, 50%, 50%, 0.1)&quot;</span><span class="s4">,</span>
          <span class="s2">color</span><span class="s4">: </span><span class="s5">&quot;red&quot;</span><span class="s4">,</span>
          <span class="s2">overflow</span><span class="s4">: </span><span class="s5">&quot;auto&quot;</span>
        <span class="s4">}</span>
      <span class="s4">},</span>
      <span class="s2">errorInstance</span><span class="s4">.</span><span class="s2">stack</span>
    <span class="s4">),</span>
    <span class="s2">heyDeveloper</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">BoundaryShell</span><span class="s4">({</span>
  <span class="s2">title</span><span class="s4">,</span>
  <span class="s2">renderScripts</span><span class="s4">,</span>
  <span class="s2">isOutsideRemixApp</span><span class="s4">,</span>
  <span class="s2">children</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">routeModules </span><span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModules</span><span class="s4">.</span><span class="s2">root</span><span class="s4">?.</span><span class="s2">Layout </span><span class="s4">&amp;&amp; !</span><span class="s2">isOutsideRemixApp</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">children</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;html&quot;</span><span class="s4">, { </span><span class="s2">lang</span><span class="s4">: </span><span class="s5">&quot;en&quot; </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;head&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;meta&quot;</span><span class="s4">, { </span><span class="s2">charSet</span><span class="s4">: </span><span class="s5">&quot;utf-8&quot; </span><span class="s4">}), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;meta&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">name</span><span class="s4">: </span><span class="s5">&quot;viewport&quot;</span><span class="s4">,</span>
      <span class="s2">content</span><span class="s4">: </span><span class="s5">&quot;width=device-width,initial-scale=1,viewport-fit=cover&quot;</span>
    <span class="s4">}</span>
  <span class="s4">), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;title&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">title</span><span class="s4">)), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;body&quot;</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;main&quot;</span><span class="s4">, { </span><span class="s2">style</span><span class="s4">: { </span><span class="s2">fontFamily</span><span class="s4">: </span><span class="s5">&quot;system-ui, sans-serif&quot;</span><span class="s4">, </span><span class="s2">padding</span><span class="s4">: </span><span class="s5">&quot;2rem&quot; </span><span class="s4">} }, </span><span class="s2">children</span><span class="s4">, </span><span class="s2">renderScripts </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React5</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">Scripts</span><span class="s4">, </span><span class="s3">null</span><span class="s4">) : </span><span class="s3">null</span><span class="s4">)));</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/fallback.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React6 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">RemixRootDefaultHydrateFallback</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React6</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">BoundaryShell</span><span class="s4">, { </span><span class="s2">title</span><span class="s4">: </span><span class="s5">&quot;Loading...&quot;</span><span class="s4">, </span><span class="s2">renderScripts</span><span class="s4">: </span><span class="s3">true </span><span class="s4">}, </span><span class="s2">ENABLE_DEV_WARNINGS </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React6</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
        <span class="s2">__html</span><span class="s4">: </span><span class="s5">`</span>
              <span class="s5">console.log( 
                &quot;</span><span class="s3">\u{1F4BF} </span><span class="s5">Hey developer </span><span class="s3">\u{1F44B}</span><span class="s5">. You can provide a way better UX than this &quot; + 
                &quot;when your app is loading JS modules and/or running </span><span class="s3">\`</span><span class="s5">clientLoader</span><span class="s3">\` </span><span class="s5">&quot; + 
                &quot;functions. Check out https://reactrouter.com/start/framework/route-module#hydratefallback &quot; + 
                &quot;for more information.&quot; 
              ); 
            `</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">) : </span><span class="s3">null</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/routes.tsx</span>
<span class="s3">function </span><span class="s2">groupRoutesByParentId</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routes </span><span class="s4">= {};</span>
  <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">parentId </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">parentId </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">]) {</span>
        <span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] = [];</span>
      <span class="s4">}</span>
      <span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">].</span><span class="s2">push</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">routes</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getRouteComponents</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModule</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">Component4 </span><span class="s4">= </span><span class="s2">getRouteModuleComponent</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">HydrateFallback </span><span class="s4">= </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">HydrateFallback </span><span class="s4">&amp;&amp; (!</span><span class="s2">isSpaMode </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;root&quot;</span><span class="s4">) ? </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">HydrateFallback </span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;root&quot; </span><span class="s4">? </span><span class="s2">RemixRootDefaultHydrateFallback </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">ErrorBoundary </span><span class="s4">= </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">? </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;root&quot; </span><span class="s4">? () =&gt; </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">RemixRootDefaultErrorBoundary</span><span class="s4">, { </span><span class="s2">error</span><span class="s4">: </span><span class="s2">useRouteError</span><span class="s4">() }) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;root&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">Layout</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">...Component4 </span><span class="s4">? {</span>
        <span class="s2">element</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">Layout</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">Component4</span><span class="s4">, </span><span class="s3">null</span><span class="s4">))</span>
      <span class="s4">} : { </span><span class="s2">Component</span><span class="s4">: </span><span class="s2">Component4 </span><span class="s4">},</span>
      <span class="s2">...ErrorBoundary </span><span class="s4">? {</span>
        <span class="s2">errorElement</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">Layout</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">ErrorBoundary</span><span class="s4">, </span><span class="s3">null</span><span class="s4">))</span>
      <span class="s4">} : { </span><span class="s2">ErrorBoundary </span><span class="s4">},</span>
      <span class="s2">...HydrateFallback </span><span class="s4">? {</span>
        <span class="s2">hydrateFallbackElement</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">Layout</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React7</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">HydrateFallback</span><span class="s4">, </span><span class="s3">null</span><span class="s4">))</span>
      <span class="s4">} : { </span><span class="s2">HydrateFallback </span><span class="s4">}</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{ </span><span class="s2">Component</span><span class="s4">: </span><span class="s2">Component4</span><span class="s4">, </span><span class="s2">ErrorBoundary</span><span class="s4">, </span><span class="s2">HydrateFallback </span><span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createServerRoutes</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">future</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">parentId </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">routesByParentId </span><span class="s4">= </span><span class="s2">groupRoutesByParentId</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">), </span><span class="s2">spaModeLazyPromise </span><span class="s4">= </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">({ </span><span class="s2">Component</span><span class="s4">: () =&gt; </span><span class="s3">null </span><span class="s4">})) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">routesByParentId</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] || []).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s2">invariant2</span><span class="s4">(</span>
      <span class="s2">routeModule</span><span class="s4">,</span>
      <span class="s5">&quot;No `routeModule` available to create server routes&quot;</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">dataRoute </span><span class="s4">= {</span>
      <span class="s2">...getRouteComponents</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModule</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">),</span>
      <span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">,</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
      <span class="s6">// For SPA Mode, all routes are lazy except root.  However we tell the</span>
      <span class="s6">// router root is also lazy here too since we don't need a full</span>
      <span class="s6">// implementation - we just need a `lazy` prop to tell the RR rendering</span>
      <span class="s6">// where to stop which is always at the root route in SPA mode</span>
      <span class="s2">lazy</span><span class="s4">: </span><span class="s2">isSpaMode </span><span class="s4">? () =&gt; </span><span class="s2">spaModeLazyPromise </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s6">// For partial hydration rendering, we need to indicate when the route</span>
      <span class="s6">// has a loader/clientLoader, but it won't ever be called during the static</span>
      <span class="s6">// render, so just give it a no-op function so we can render down to the</span>
      <span class="s6">// proper fallback</span>
      <span class="s2">loader</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasLoader </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientLoader </span><span class="s4">? () =&gt; </span><span class="s3">null </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s6">// We don't need middleware/action/shouldRevalidate on these routes since</span>
      <span class="s6">// they're for a static render</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">children </span><span class="s4">= </span><span class="s2">createServerRoutes</span><span class="s4">(</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">routeModules</span><span class="s4">,</span>
      <span class="s2">future</span><span class="s4">,</span>
      <span class="s2">isSpaMode</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">routesByParentId</span><span class="s4">,</span>
      <span class="s2">spaModeLazyPromise</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">children</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) </span><span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= </span><span class="s2">children</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">dataRoute</span><span class="s4">;</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createClientRoutesWithHMRRevalidationOptOut</span><span class="s4">(</span><span class="s2">needsRevalidation</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModulesCache</span><span class="s4">, </span><span class="s2">initialState</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">createClientRoutes</span><span class="s4">(</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">routeModulesCache</span><span class="s4">,</span>
    <span class="s2">initialState</span><span class="s4">,</span>
    <span class="s2">ssr</span><span class="s4">,</span>
    <span class="s2">isSpaMode</span><span class="s4">,</span>
    <span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">groupRoutesByParentId</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">),</span>
    <span class="s2">needsRevalidation</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">preventInvalidServerHandlerCall</span><span class="s4">(</span><span class="s2">type</span><span class="s4">, </span><span class="s2">route</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;loader&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasLoader </span><span class="s4">|| </span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;action&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasAction</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">fn </span><span class="s4">= </span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;action&quot; </span><span class="s4">? </span><span class="s5">&quot;serverAction()&quot; </span><span class="s4">: </span><span class="s5">&quot;serverLoader()&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">msg </span><span class="s4">= </span><span class="s5">`You are trying to call </span><span class="s2">$</span><span class="s4">{</span><span class="s2">fn</span><span class="s4">} </span><span class="s5">on a route that does not have a server </span><span class="s2">$</span><span class="s4">{</span><span class="s2">type</span><span class="s4">} </span><span class="s5">(routeId: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">}</span><span class="s5">&quot;)`</span><span class="s4">;</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s2">msg</span><span class="s4">);</span>
    <span class="s3">throw new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span><span class="s7">400</span><span class="s4">, </span><span class="s5">&quot;Bad Request&quot;</span><span class="s4">, </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">msg</span><span class="s4">), </span><span class="s3">true</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">noActionDefinedError</span><span class="s4">(</span><span class="s2">type</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">article </span><span class="s4">= </span><span class="s2">type </span><span class="s4">=== </span><span class="s5">&quot;clientAction&quot; </span><span class="s4">? </span><span class="s5">&quot;a&quot; </span><span class="s4">: </span><span class="s5">&quot;an&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">msg </span><span class="s4">= </span><span class="s5">`Route &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeId</span><span class="s4">}</span><span class="s5">&quot; does not have </span><span class="s2">$</span><span class="s4">{</span><span class="s2">article</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">type</span><span class="s4">}</span><span class="s5">, but you are trying to submit to it. To fix this, please add </span><span class="s2">$</span><span class="s4">{</span><span class="s2">article</span><span class="s4">} </span><span class="s3">\`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">type</span><span class="s4">}</span><span class="s3">\` </span><span class="s5">function to the route`</span><span class="s4">;</span>
  <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s2">msg</span><span class="s4">);</span>
  <span class="s3">throw new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span><span class="s7">405</span><span class="s4">, </span><span class="s5">&quot;Method Not Allowed&quot;</span><span class="s4">, </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">msg</span><span class="s4">), </span><span class="s3">true</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createClientRoutes</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModulesCache</span><span class="s4">, </span><span class="s2">initialState</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">parentId </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">routesByParentId </span><span class="s4">= </span><span class="s2">groupRoutesByParentId</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">), </span><span class="s2">needsRevalidation</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">routesByParentId</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] || []).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s2">routeModulesCache</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s3">function </span><span class="s2">fetchServerHandler</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">) {</span>
      <span class="s2">invariant2</span><span class="s4">(</span>
        <span class="s3">typeof </span><span class="s2">singleFetch </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">,</span>
        <span class="s5">&quot;No single fetch function available for route handler&quot;</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s2">singleFetch</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s3">function </span><span class="s2">fetchServerLoader</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">) </span><span class="s3">return </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">fetchServerHandler</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">function </span><span class="s2">fetchServerAction</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasAction</span><span class="s4">) {</span>
        <span class="s3">throw </span><span class="s2">noActionDefinedError</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">fetchServerHandler</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">function </span><span class="s2">prefetchModule</span><span class="s4">(</span><span class="s2">modulePath</span><span class="s4">) {</span>
      <span class="s3">import</span><span class="s4">(</span>
        <span class="s6">/* @vite-ignore */</span>
        <span class="s6">/* webpackIgnore: true */</span>
        <span class="s2">modulePath</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">function </span><span class="s2">prefetchRouteModuleChunks</span><span class="s4">(</span><span class="s2">route2</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route2</span><span class="s4">.</span><span class="s2">clientActionModule</span><span class="s4">) {</span>
        <span class="s2">prefetchModule</span><span class="s4">(</span><span class="s2">route2</span><span class="s4">.</span><span class="s2">clientActionModule</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">route2</span><span class="s4">.</span><span class="s2">clientLoaderModule</span><span class="s4">) {</span>
        <span class="s2">prefetchModule</span><span class="s4">(</span><span class="s2">route2</span><span class="s4">.</span><span class="s2">clientLoaderModule</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">async </span><span class="s3">function </span><span class="s2">prefetchStylesAndCallHandler</span><span class="s4">(</span><span class="s2">handler</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">cachedModule </span><span class="s4">= </span><span class="s2">routeModulesCache</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">let </span><span class="s2">linkPrefetchPromise </span><span class="s4">= </span><span class="s2">cachedModule </span><span class="s4">? </span><span class="s2">prefetchStyleLinks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">cachedModule</span><span class="s4">) : </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">();</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">return </span><span class="s2">handler</span><span class="s4">();</span>
      <span class="s4">} </span><span class="s3">finally </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">linkPrefetchPromise</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">dataRoute </span><span class="s4">= {</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span>
    <span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">) {</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">dataRoute</span><span class="s4">, {</span>
        <span class="s2">...dataRoute</span><span class="s4">,</span>
        <span class="s2">...getRouteComponents</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModule</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">),</span>
        <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">unstable_clientMiddleware</span><span class="s4">,</span>
        <span class="s2">handle</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
        <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">getShouldRevalidateFunction</span><span class="s4">(</span>
          <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
          <span class="s2">routeModule</span><span class="s4">,</span>
          <span class="s2">route</span><span class="s4">,</span>
          <span class="s2">ssr</span><span class="s4">,</span>
          <span class="s2">needsRevalidation</span>
        <span class="s4">)</span>
      <span class="s4">});</span>
      <span class="s3">let </span><span class="s2">hasInitialData </span><span class="s4">= </span><span class="s2">initialState </span><span class="s4">&amp;&amp; </span><span class="s2">initialState</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">initialState</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">initialData </span><span class="s4">= </span><span class="s2">hasInitialData </span><span class="s4">? </span><span class="s2">initialState</span><span class="s4">?.</span><span class="s2">loaderData</span><span class="s4">?.[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">hasInitialError </span><span class="s4">= </span><span class="s2">initialState </span><span class="s4">&amp;&amp; </span><span class="s2">initialState</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">initialState</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">initialError </span><span class="s4">= </span><span class="s2">hasInitialError </span><span class="s4">? </span><span class="s2">initialState</span><span class="s4">?.</span><span class="s2">errors</span><span class="s4">?.[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">isHydrationRequest </span><span class="s4">= </span><span class="s2">needsRevalidation </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; (</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">?.</span><span class="s2">hydrate </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">|| !</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">);</span>
      <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">= </span><span class="s2">async </span><span class="s4">({ </span><span class="s2">request</span><span class="s4">, </span><span class="s2">params</span><span class="s4">, </span><span class="s2">context </span><span class="s4">}, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; {</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">prefetchStylesAndCallHandler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
            <span class="s2">invariant2</span><span class="s4">(</span>
              <span class="s2">routeModule</span><span class="s4">,</span>
              <span class="s5">&quot;No `routeModule` available for critical-route loader&quot;</span>
            <span class="s4">);</span>
            <span class="s3">if </span><span class="s4">(!</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">) {</span>
              <span class="s3">return </span><span class="s2">fetchServerLoader</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
            <span class="s4">}</span>
            <span class="s3">return </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">({</span>
              <span class="s2">request</span><span class="s4">,</span>
              <span class="s2">params</span><span class="s4">,</span>
              <span class="s2">context</span><span class="s4">,</span>
              <span class="s2">async serverLoader</span><span class="s4">() {</span>
                <span class="s2">preventInvalidServerHandlerCall</span><span class="s4">(</span><span class="s5">&quot;loader&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">);</span>
                <span class="s3">if </span><span class="s4">(</span><span class="s2">isHydrationRequest</span><span class="s4">) {</span>
                  <span class="s3">if </span><span class="s4">(</span><span class="s2">hasInitialData</span><span class="s4">) {</span>
                    <span class="s3">return </span><span class="s2">initialData</span><span class="s4">;</span>
                  <span class="s4">}</span>
                  <span class="s3">if </span><span class="s4">(</span><span class="s2">hasInitialError</span><span class="s4">) {</span>
                    <span class="s3">throw </span><span class="s2">initialError</span><span class="s4">;</span>
                  <span class="s4">}</span>
                <span class="s4">}</span>
                <span class="s3">return </span><span class="s2">fetchServerLoader</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
              <span class="s4">}</span>
            <span class="s4">});</span>
          <span class="s4">});</span>
          <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s3">finally </span><span class="s4">{</span>
          <span class="s2">isHydrationRequest </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">};</span>
      <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">.</span><span class="s2">hydrate </span><span class="s4">= </span><span class="s2">shouldHydrateRouteLoader</span><span class="s4">(</span>
        <span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
        <span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">,</span>
        <span class="s2">route</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">,</span>
        <span class="s2">isSpaMode</span>
      <span class="s4">);</span>
      <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">action </span><span class="s4">= ({ </span><span class="s2">request</span><span class="s4">, </span><span class="s2">params</span><span class="s4">, </span><span class="s2">context </span><span class="s4">}, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; {</span>
        <span class="s3">return </span><span class="s2">prefetchStylesAndCallHandler</span><span class="s4">(</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s2">invariant2</span><span class="s4">(</span>
            <span class="s2">routeModule</span><span class="s4">,</span>
            <span class="s5">&quot;No `routeModule` available for critical-route action&quot;</span>
          <span class="s4">);</span>
          <span class="s3">if </span><span class="s4">(!</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientAction</span><span class="s4">) {</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">isSpaMode</span><span class="s4">) {</span>
              <span class="s3">throw </span><span class="s2">noActionDefinedError</span><span class="s4">(</span><span class="s5">&quot;clientAction&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
            <span class="s4">}</span>
            <span class="s3">return </span><span class="s2">fetchServerAction</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
          <span class="s4">}</span>
          <span class="s3">return </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientAction</span><span class="s4">({</span>
            <span class="s2">request</span><span class="s4">,</span>
            <span class="s2">params</span><span class="s4">,</span>
            <span class="s2">context</span><span class="s4">,</span>
            <span class="s2">async serverAction</span><span class="s4">() {</span>
              <span class="s2">preventInvalidServerHandlerCall</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">);</span>
              <span class="s3">return </span><span class="s2">fetchServerAction</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
        <span class="s4">});</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientLoader</span><span class="s4">) {</span>
        <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">= (</span><span class="s2">_</span><span class="s4">, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; </span><span class="s2">prefetchStylesAndCallHandler</span><span class="s4">(() =&gt; {</span>
          <span class="s3">return </span><span class="s2">fetchServerLoader</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientAction</span><span class="s4">) {</span>
        <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">action </span><span class="s4">= (</span><span class="s2">_</span><span class="s4">, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; </span><span class="s2">prefetchStylesAndCallHandler</span><span class="s4">(() =&gt; {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">isSpaMode</span><span class="s4">) {</span>
            <span class="s3">throw </span><span class="s2">noActionDefinedError</span><span class="s4">(</span><span class="s5">&quot;clientAction&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
          <span class="s4">}</span>
          <span class="s3">return </span><span class="s2">fetchServerAction</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">lazyRoutePromise</span><span class="s4">;</span>
      <span class="s2">async </span><span class="s3">function </span><span class="s2">getLazyRoute</span><span class="s4">() {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">lazyRoutePromise</span><span class="s4">) {</span>
          <span class="s3">return await </span><span class="s2">lazyRoutePromise</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s2">lazyRoutePromise </span><span class="s4">= (</span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoaderModule </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientActionModule</span><span class="s4">) {</span>
            <span class="s3">await new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">) =&gt; </span><span class="s2">setTimeout</span><span class="s4">(</span><span class="s2">resolve</span><span class="s4">, </span><span class="s7">0</span><span class="s4">));</span>
          <span class="s4">}</span>
          <span class="s3">let </span><span class="s2">routeModulePromise </span><span class="s4">= </span><span class="s2">loadRouteModuleWithBlockingLinks</span><span class="s4">(</span>
            <span class="s2">route</span><span class="s4">,</span>
            <span class="s2">routeModulesCache</span>
          <span class="s4">);</span>
          <span class="s2">prefetchRouteModuleChunks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
          <span class="s3">return await </span><span class="s2">routeModulePromise</span><span class="s4">;</span>
        <span class="s4">})();</span>
        <span class="s3">return await </span><span class="s2">lazyRoutePromise</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">lazy </span><span class="s4">= {</span>
        <span class="s2">loader</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientLoader </span><span class="s4">? </span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">clientLoader </span><span class="s4">} = </span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoaderModule </span><span class="s4">? </span><span class="s3">await import</span><span class="s4">(</span>
            <span class="s6">/* @vite-ignore */</span>
            <span class="s6">/* webpackIgnore: true */</span>
            <span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoaderModule</span>
          <span class="s4">) : </span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">();</span>
          <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">clientLoader</span><span class="s4">, </span><span class="s5">&quot;No `clientLoader` export found&quot;</span><span class="s4">);</span>
          <span class="s3">return </span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; </span><span class="s2">clientLoader</span><span class="s4">({</span>
            <span class="s2">...args</span><span class="s4">,</span>
            <span class="s2">async serverLoader</span><span class="s4">() {</span>
              <span class="s2">preventInvalidServerHandlerCall</span><span class="s4">(</span><span class="s5">&quot;loader&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">);</span>
              <span class="s3">return </span><span class="s2">fetchServerLoader</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
        <span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">action</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientAction </span><span class="s4">? </span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">let </span><span class="s2">clientActionPromise </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientActionModule </span><span class="s4">? </span><span class="s3">import</span><span class="s4">(</span>
            <span class="s6">/* @vite-ignore */</span>
            <span class="s6">/* webpackIgnore: true */</span>
            <span class="s2">route</span><span class="s4">.</span><span class="s2">clientActionModule</span>
          <span class="s4">) : </span><span class="s2">getLazyRoute</span><span class="s4">();</span>
          <span class="s2">prefetchRouteModuleChunks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">clientAction </span><span class="s4">} = </span><span class="s3">await </span><span class="s2">clientActionPromise</span><span class="s4">;</span>
          <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">clientAction</span><span class="s4">, </span><span class="s5">&quot;No `clientAction` export found&quot;</span><span class="s4">);</span>
          <span class="s3">return </span><span class="s4">(</span><span class="s2">args</span><span class="s4">, </span><span class="s2">singleFetch</span><span class="s4">) =&gt; </span><span class="s2">clientAction</span><span class="s4">({</span>
            <span class="s2">...args</span><span class="s4">,</span>
            <span class="s2">async serverAction</span><span class="s4">() {</span>
              <span class="s2">preventInvalidServerHandlerCall</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">, </span><span class="s2">route</span><span class="s4">);</span>
              <span class="s3">return </span><span class="s2">fetchServerAction</span><span class="s4">(</span><span class="s2">singleFetch</span><span class="s4">);</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
        <span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasClientMiddleware </span><span class="s4">? </span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">unstable_clientMiddleware </span><span class="s4">} = </span><span class="s2">route</span><span class="s4">.</span><span class="s2">clientMiddlewareModule </span><span class="s4">? </span><span class="s3">await import</span><span class="s4">(</span>
            <span class="s6">/* @vite-ignore */</span>
            <span class="s6">/* webpackIgnore: true */</span>
            <span class="s2">route</span><span class="s4">.</span><span class="s2">clientMiddlewareModule</span>
          <span class="s4">) : </span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">();</span>
          <span class="s2">invariant2</span><span class="s4">(</span>
            <span class="s2">unstable_clientMiddleware</span><span class="s4">,</span>
            <span class="s5">&quot;No `unstable_clientMiddleware` export found&quot;</span>
          <span class="s4">);</span>
          <span class="s3">return </span><span class="s2">unstable_clientMiddleware</span><span class="s4">;</span>
        <span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">async </span><span class="s4">() =&gt; {</span>
          <span class="s3">let </span><span class="s2">lazyRoute </span><span class="s4">= </span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">();</span>
          <span class="s3">return </span><span class="s2">getShouldRevalidateFunction</span><span class="s4">(</span>
            <span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
            <span class="s2">lazyRoute</span><span class="s4">,</span>
            <span class="s2">route</span><span class="s4">,</span>
            <span class="s2">ssr</span><span class="s4">,</span>
            <span class="s2">needsRevalidation</span>
          <span class="s4">);</span>
        <span class="s4">},</span>
        <span class="s2">handle</span><span class="s4">: </span><span class="s2">async </span><span class="s4">() =&gt; (</span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">()).</span><span class="s2">handle</span><span class="s4">,</span>
        <span class="s6">// No need to wrap these in layout since the root route is never</span>
        <span class="s6">// loaded via route.lazy()</span>
        <span class="s2">Component</span><span class="s4">: </span><span class="s2">async </span><span class="s4">() =&gt; (</span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">()).</span><span class="s2">Component</span><span class="s4">,</span>
        <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">hasErrorBoundary </span><span class="s4">? </span><span class="s2">async </span><span class="s4">() =&gt; (</span><span class="s3">await </span><span class="s2">getLazyRoute</span><span class="s4">()).</span><span class="s2">ErrorBoundary </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">children </span><span class="s4">= </span><span class="s2">createClientRoutes</span><span class="s4">(</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">routeModulesCache</span><span class="s4">,</span>
      <span class="s2">initialState</span><span class="s4">,</span>
      <span class="s2">ssr</span><span class="s4">,</span>
      <span class="s2">isSpaMode</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">routesByParentId</span><span class="s4">,</span>
      <span class="s2">needsRevalidation</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">children</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) </span><span class="s2">dataRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= </span><span class="s2">children</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">dataRoute</span><span class="s4">;</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getShouldRevalidateFunction</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">route</span><span class="s4">, </span><span class="s2">manifestRoute</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">needsRevalidation</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">needsRevalidation</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">wrapShouldRevalidateForHdr</span><span class="s4">(</span>
      <span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">,</span>
      <span class="s2">needsRevalidation</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">ssr </span><span class="s4">&amp;&amp; </span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader </span><span class="s4">&amp;&amp; !</span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasClientLoader</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">myParams </span><span class="s4">= </span><span class="s2">path </span><span class="s4">? </span><span class="s2">compilePath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">)[</span><span class="s7">1</span><span class="s4">].</span><span class="s2">map</span><span class="s4">((</span><span class="s2">p</span><span class="s4">) =&gt; </span><span class="s2">p</span><span class="s4">.</span><span class="s2">paramName</span><span class="s4">) : [];</span>
    <span class="s3">const </span><span class="s2">didParamsChange </span><span class="s4">= (</span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">myParams</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">p</span><span class="s4">) =&gt; </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">currentParams</span><span class="s4">[</span><span class="s2">p</span><span class="s4">] !== </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">nextParams</span><span class="s4">[</span><span class="s2">p</span><span class="s4">]);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">fn </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">fn</span><span class="s4">({</span>
        <span class="s2">...opts</span><span class="s4">,</span>
        <span class="s2">defaultShouldRevalidate</span><span class="s4">: </span><span class="s2">didParamsChange</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">)</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">return </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">didParamsChange</span><span class="s4">(</span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">ssr </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">fn </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s4">(</span><span class="s2">opts</span><span class="s4">) =&gt; </span><span class="s2">fn</span><span class="s4">({ </span><span class="s2">...opts</span><span class="s4">, </span><span class="s2">defaultShouldRevalidate</span><span class="s4">: </span><span class="s3">true </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">wrapShouldRevalidateForHdr</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">routeShouldRevalidate</span><span class="s4">, </span><span class="s2">needsRevalidation</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">handledRevalidation </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">arg</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">handledRevalidation</span><span class="s4">) {</span>
      <span class="s2">handledRevalidation </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s2">needsRevalidation</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">routeShouldRevalidate </span><span class="s4">? </span><span class="s2">routeShouldRevalidate</span><span class="s4">(</span><span class="s2">arg</span><span class="s4">) : </span><span class="s2">arg</span><span class="s4">.</span><span class="s2">defaultShouldRevalidate</span><span class="s4">;</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">loadRouteModuleWithBlockingLinks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routeModulePromise </span><span class="s4">= </span><span class="s2">loadRouteModule</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">prefetchRouteCssPromise </span><span class="s4">= </span><span class="s2">prefetchRouteCss</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s3">await </span><span class="s2">routeModulePromise</span><span class="s4">;</span>
  <span class="s3">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">([</span>
    <span class="s2">prefetchRouteCssPromise</span><span class="s4">,</span>
    <span class="s2">prefetchStyleLinks</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s2">routeModule</span><span class="s4">)</span>
  <span class="s4">]);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">Component</span><span class="s4">: </span><span class="s2">getRouteModuleComponent</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">),</span>
    <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">,</span>
    <span class="s2">unstable_clientMiddleware</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">unstable_clientMiddleware</span><span class="s4">,</span>
    <span class="s2">clientAction</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientAction</span><span class="s4">,</span>
    <span class="s2">clientLoader</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">,</span>
    <span class="s2">handle</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
    <span class="s2">links</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">links</span><span class="s4">,</span>
    <span class="s2">meta</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">,</span>
    <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">shouldRevalidate</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getRouteModuleComponent</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">default </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) </span><span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">isEmptyObject </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">default </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">default</span><span class="s4">).</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">isEmptyObject</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">default</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">shouldHydrateRouteLoader</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">clientLoader</span><span class="s4">, </span><span class="s2">hasLoader</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">isSpaMode </span><span class="s4">&amp;&amp; </span><span class="s2">routeId </span><span class="s4">!== </span><span class="s5">&quot;root&quot; </span><span class="s4">|| </span><span class="s2">clientLoader </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; (</span><span class="s2">clientLoader</span><span class="s4">.</span><span class="s2">hydrate </span><span class="s4">=== </span><span class="s3">true </span><span class="s4">|| </span><span class="s2">hasLoader </span><span class="s4">!== </span><span class="s3">true</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/fog-of-war.ts</span>
<span class="s3">var </span><span class="s2">nextPaths </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
<span class="s3">var </span><span class="s2">discoveredPathsMaxSize </span><span class="s4">= </span><span class="s7">1e3</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">discoveredPaths </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
<span class="s3">var </span><span class="s2">URL_LIMIT </span><span class="s4">= </span><span class="s7">7680</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">isFogOfWarEnabled</span><span class="s4">(</span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">routeDiscovery</span><span class="s4">.</span><span class="s2">mode </span><span class="s4">=== </span><span class="s5">&quot;lazy&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">ssr </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getPartialManifest</span><span class="s4">({ </span><span class="s2">sri</span><span class="s4">, </span><span class="s2">...manifest </span><span class="s4">}, </span><span class="s2">router</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routeIds </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">Boolean</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">paths </span><span class="s4">= [</span><span class="s5">&quot;/&quot;</span><span class="s4">];</span>
  <span class="s2">segments</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">();</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">segments</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s2">paths</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s5">`/</span><span class="s2">$</span><span class="s4">{</span><span class="s2">segments</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">);</span>
    <span class="s2">segments</span><span class="s4">.</span><span class="s2">pop</span><span class="s4">();</span>
  <span class="s4">}</span>
  <span class="s2">paths</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">path</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">router</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">router</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
      <span class="s2">matches</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">routeIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">));</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">initialRoutes </span><span class="s4">= [</span><span class="s2">...routeIds</span><span class="s4">].</span><span class="s2">reduce</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">acc</span><span class="s4">, </span><span class="s2">id</span><span class="s4">) =&gt; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">acc</span><span class="s4">, { [</span><span class="s2">id</span><span class="s4">]: </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] }),</span>
    <span class="s4">{}</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">...manifest</span><span class="s4">,</span>
    <span class="s2">routes</span><span class="s4">: </span><span class="s2">initialRoutes</span><span class="s4">,</span>
    <span class="s2">sri</span><span class="s4">: </span><span class="s2">sri </span><span class="s4">? </span><span class="s3">true </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getPatchRoutesOnNavigationFunction</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">isFogOfWarEnabled</span><span class="s4">(</span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">)) {</span>
    <span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">async </span><span class="s4">({ </span><span class="s2">path</span><span class="s4">, </span><span class="s2">patch</span><span class="s4">, </span><span class="s2">signal</span><span class="s4">, </span><span class="s2">fetcherKey </span><span class="s4">}) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">discoveredPaths</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">path</span><span class="s4">)) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">await </span><span class="s2">fetchAndApplyManifestPatches</span><span class="s4">(</span>
      <span class="s4">[</span><span class="s2">path</span><span class="s4">],</span>
      <span class="s2">fetcherKey </span><span class="s4">? </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">href </span><span class="s4">: </span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">routeModules</span><span class="s4">,</span>
      <span class="s2">ssr</span><span class="s4">,</span>
      <span class="s2">isSpaMode</span><span class="s4">,</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">routeDiscovery</span><span class="s4">.</span><span class="s2">manifestPath</span><span class="s4">,</span>
      <span class="s2">patch</span><span class="s4">,</span>
      <span class="s2">signal</span>
    <span class="s4">);</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useFogOFWarDiscovery</span><span class="s4">(</span><span class="s2">router</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s2">React8</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isFogOfWarEnabled</span><span class="s4">(</span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">) || </span><span class="s6">// @ts-expect-error - TS doesn't know about this yet</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">navigator</span><span class="s4">?.</span><span class="s2">connection</span><span class="s4">?.</span><span class="s2">saveData </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">) {</span>
      <span class="s3">return</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">function </span><span class="s2">registerElement</span><span class="s4">(</span><span class="s2">el</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">el</span><span class="s4">.</span><span class="s2">tagName </span><span class="s4">=== </span><span class="s5">&quot;FORM&quot; </span><span class="s4">? </span><span class="s2">el</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;action&quot;</span><span class="s4">) : </span><span class="s2">el</span><span class="s4">.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;href&quot;</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">path</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">el</span><span class="s4">.</span><span class="s2">tagName </span><span class="s4">=== </span><span class="s5">&quot;A&quot; </span><span class="s4">? </span><span class="s2">el</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">: </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin</span><span class="s4">).</span><span class="s2">pathname</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">discoveredPaths</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">)) {</span>
        <span class="s2">nextPaths</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">pathname</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">async </span><span class="s3">function </span><span class="s2">fetchPatches</span><span class="s4">() {</span>
      <span class="s2">document</span><span class="s4">.</span><span class="s2">querySelectorAll</span><span class="s4">(</span><span class="s5">&quot;a[data-discover], form[data-discover]&quot;</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">registerElement</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">lazyPaths </span><span class="s4">= </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">nextPaths</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">()).</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">path</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">discoveredPaths</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">path</span><span class="s4">)) {</span>
          <span class="s2">nextPaths</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
          <span class="s3">return false</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">return true</span><span class="s4">;</span>
      <span class="s4">});</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">lazyPaths</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">fetchAndApplyManifestPatches</span><span class="s4">(</span>
          <span class="s2">lazyPaths</span><span class="s4">,</span>
          <span class="s3">null</span><span class="s4">,</span>
          <span class="s2">manifest</span><span class="s4">,</span>
          <span class="s2">routeModules</span><span class="s4">,</span>
          <span class="s2">ssr</span><span class="s4">,</span>
          <span class="s2">isSpaMode</span><span class="s4">,</span>
          <span class="s2">router</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">,</span>
          <span class="s2">routeDiscovery</span><span class="s4">.</span><span class="s2">manifestPath</span><span class="s4">,</span>
          <span class="s2">router</span><span class="s4">.</span><span class="s2">patchRoutes</span>
        <span class="s4">);</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s5">&quot;Failed to fetch manifest patches&quot;</span><span class="s4">, </span><span class="s2">e</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">debouncedFetchPatches </span><span class="s4">= </span><span class="s2">debounce</span><span class="s4">(</span><span class="s2">fetchPatches</span><span class="s4">, </span><span class="s7">100</span><span class="s4">);</span>
    <span class="s2">fetchPatches</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">observer </span><span class="s4">= </span><span class="s3">new </span><span class="s2">MutationObserver</span><span class="s4">(() =&gt; </span><span class="s2">debouncedFetchPatches</span><span class="s4">());</span>
    <span class="s2">observer</span><span class="s4">.</span><span class="s2">observe</span><span class="s4">(</span><span class="s2">document</span><span class="s4">.</span><span class="s2">documentElement</span><span class="s4">, {</span>
      <span class="s2">subtree</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">childList</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">attributes</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">attributeFilter</span><span class="s4">: [</span><span class="s5">&quot;data-discover&quot;</span><span class="s4">, </span><span class="s5">&quot;href&quot;</span><span class="s4">, </span><span class="s5">&quot;action&quot;</span><span class="s4">]</span>
    <span class="s4">});</span>
    <span class="s3">return </span><span class="s4">() =&gt; </span><span class="s2">observer</span><span class="s4">.</span><span class="s2">disconnect</span><span class="s4">();</span>
  <span class="s4">}, [</span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">router</span><span class="s4">, </span><span class="s2">routeDiscovery</span><span class="s4">]);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getManifestPath</span><span class="s4">(</span><span class="s2">_manifestPath</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">manifestPath </span><span class="s4">= </span><span class="s2">_manifestPath </span><span class="s4">|| </span><span class="s5">&quot;/__manifest&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s2">manifestPath</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">basename</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{</span><span class="s2">manifestPath</span><span class="s4">}</span><span class="s5">`</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\/+/g</span><span class="s4">, </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">MANIFEST_VERSION_STORAGE_KEY </span><span class="s4">= </span><span class="s5">&quot;react-router-manifest-version&quot;</span><span class="s4">;</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">fetchAndApplyManifestPatches</span><span class="s4">(</span><span class="s2">paths</span><span class="s4">, </span><span class="s2">errorReloadPath</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">manifestPath</span><span class="s4">, </span><span class="s2">patchRoutes</span><span class="s4">, </span><span class="s2">signal</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span>
    <span class="s2">getManifestPath</span><span class="s4">(</span><span class="s2">manifestPath</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">),</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">origin</span>
  <span class="s4">);</span>
  <span class="s2">paths</span><span class="s4">.</span><span class="s2">sort</span><span class="s4">().</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">path</span><span class="s4">) =&gt; </span><span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">, </span><span class="s2">path</span><span class="s4">));</span>
  <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;version&quot;</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">version</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">().</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s2">URL_LIMIT</span><span class="s4">) {</span>
    <span class="s2">nextPaths</span><span class="s4">.</span><span class="s2">clear</span><span class="s4">();</span>
    <span class="s3">return</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">serverPatches</span><span class="s4">;</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">res </span><span class="s4">= </span><span class="s3">await </span><span class="s2">fetch</span><span class="s4">(</span><span class="s2">url</span><span class="s4">, { </span><span class="s2">signal </span><span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">res</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">res</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">}</span><span class="s5">`</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s7">204 </span><span class="s4">&amp;&amp; </span><span class="s2">res</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">errorReloadPath</span><span class="s4">) {</span>
        <span class="s2">console</span><span class="s4">.</span><span class="s2">warn</span><span class="s4">(</span>
          <span class="s5">&quot;Detected a manifest version mismatch during eager route discovery. The next navigation/fetch to an undiscovered route will result in a new document navigation to sync up with the latest manifest.&quot;</span>
        <span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">getItem</span><span class="s4">(</span><span class="s2">MANIFEST_VERSION_STORAGE_KEY</span><span class="s4">) === </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">version</span><span class="s4">) {</span>
        <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
          <span class="s5">&quot;Unable to discover routes due to manifest version mismatch.&quot;</span>
        <span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">setItem</span><span class="s4">(</span><span class="s2">MANIFEST_VERSION_STORAGE_KEY</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">version</span><span class="s4">);</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">href </span><span class="s4">= </span><span class="s2">errorReloadPath</span><span class="s4">;</span>
      <span class="s2">console</span><span class="s4">.</span><span class="s2">warn</span><span class="s4">(</span><span class="s5">&quot;Detected manifest version mismatch, reloading...&quot;</span><span class="s4">);</span>
      <span class="s3">await new </span><span class="s2">Promise</span><span class="s4">(() =&gt; {</span>
      <span class="s4">});</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">res</span><span class="s4">.</span><span class="s2">status </span><span class="s4">&gt;= </span><span class="s7">400</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">await </span><span class="s2">res</span><span class="s4">.</span><span class="s2">text</span><span class="s4">());</span>
    <span class="s4">}</span>
    <span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">removeItem</span><span class="s4">(</span><span class="s2">MANIFEST_VERSION_STORAGE_KEY</span><span class="s4">);</span>
    <span class="s2">serverPatches </span><span class="s4">= </span><span class="s3">await </span><span class="s2">res</span><span class="s4">.</span><span class="s2">json</span><span class="s4">();</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">signal</span><span class="s4">?.</span><span class="s2">aborted</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
    <span class="s3">throw </span><span class="s2">e</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">knownRoutes </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">patches </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">serverPatches</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">acc</span><span class="s4">, </span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route </span><span class="s4">&amp;&amp; !</span><span class="s2">knownRoutes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">)) {</span>
      <span class="s2">acc</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">route</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">acc</span><span class="s4">;</span>
  <span class="s4">}, {});</span>
  <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">patches</span><span class="s4">);</span>
  <span class="s2">paths</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">p</span><span class="s4">) =&gt; </span><span class="s2">addToFifoQueue</span><span class="s4">(</span><span class="s2">p</span><span class="s4">, </span><span class="s2">discoveredPaths</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">parentIds </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
  <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">patches</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">patch</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">patch </span><span class="s4">&amp;&amp; (!</span><span class="s2">patch</span><span class="s4">.</span><span class="s2">parentId </span><span class="s4">|| !</span><span class="s2">patches</span><span class="s4">[</span><span class="s2">patch</span><span class="s4">.</span><span class="s2">parentId</span><span class="s4">])) {</span>
      <span class="s2">parentIds</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">patch</span><span class="s4">.</span><span class="s2">parentId</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s2">parentIds</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">parentId</span><span class="s4">) =&gt; </span><span class="s2">patchRoutes</span><span class="s4">(</span>
      <span class="s2">parentId </span><span class="s4">|| </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">createClientRoutes</span><span class="s4">(</span><span class="s2">patches</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">parentId</span><span class="s4">)</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">addToFifoQueue</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">queue</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">queue</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt;= </span><span class="s2">discoveredPathsMaxSize</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">first </span><span class="s4">= </span><span class="s2">queue</span><span class="s4">.</span><span class="s2">values</span><span class="s4">().</span><span class="s2">next</span><span class="s4">().</span><span class="s2">value</span><span class="s4">;</span>
    <span class="s2">queue</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">first</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">queue</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">debounce</span><span class="s4">(</span><span class="s2">callback</span><span class="s4">, </span><span class="s2">wait</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">timeoutId</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) =&gt; {</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">clearTimeout</span><span class="s4">(</span><span class="s2">timeoutId</span><span class="s4">);</span>
    <span class="s2">timeoutId </span><span class="s4">= </span><span class="s2">window</span><span class="s4">.</span><span class="s2">setTimeout</span><span class="s4">(() =&gt; </span><span class="s2">callback</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">), </span><span class="s2">wait</span><span class="s4">);</span>
  <span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/components.tsx</span>
<span class="s3">function </span><span class="s2">useDataRouterContext2</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">context </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">);</span>
  <span class="s2">invariant2</span><span class="s4">(</span>
    <span class="s2">context</span><span class="s4">,</span>
    <span class="s5">&quot;You must render this element inside a &lt;DataRouterContext.Provider&gt; element&quot;</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">context</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useDataRouterStateContext</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">context </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">);</span>
  <span class="s2">invariant2</span><span class="s4">(</span>
    <span class="s2">context</span><span class="s4">,</span>
    <span class="s5">&quot;You must render this element inside a &lt;DataRouterStateContext.Provider&gt; element&quot;</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">context</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">FrameworkContext </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createContext</span><span class="s4">(</span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
<span class="s2">FrameworkContext</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;FrameworkContext&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">useFrameworkContext</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">context </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">FrameworkContext</span><span class="s4">);</span>
  <span class="s2">invariant2</span><span class="s4">(</span>
    <span class="s2">context</span><span class="s4">,</span>
    <span class="s5">&quot;You must render this element inside a &lt;HydratedRouter&gt; element&quot;</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">context</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">usePrefetchBehavior</span><span class="s4">(</span><span class="s2">prefetch</span><span class="s4">, </span><span class="s2">theirElementProps</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">frameworkContext </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">FrameworkContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">maybePrefetch</span><span class="s4">, </span><span class="s2">setMaybePrefetch</span><span class="s4">] = </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">shouldPrefetch</span><span class="s4">, </span><span class="s2">setShouldPrefetch</span><span class="s4">] = </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">onFocus</span><span class="s4">, </span><span class="s2">onBlur</span><span class="s4">, </span><span class="s2">onMouseEnter</span><span class="s4">, </span><span class="s2">onMouseLeave</span><span class="s4">, </span><span class="s2">onTouchStart </span><span class="s4">} = </span><span class="s2">theirElementProps</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">ref </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s3">null</span><span class="s4">);</span>
  <span class="s2">React9</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">prefetch </span><span class="s4">=== </span><span class="s5">&quot;render&quot;</span><span class="s4">) {</span>
      <span class="s2">setShouldPrefetch</span><span class="s4">(</span><span class="s3">true</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">prefetch </span><span class="s4">=== </span><span class="s5">&quot;viewport&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">callback </span><span class="s4">= (</span><span class="s2">entries</span><span class="s4">) =&gt; {</span>
        <span class="s2">entries</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">entry</span><span class="s4">) =&gt; {</span>
          <span class="s2">setShouldPrefetch</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">isIntersecting</span><span class="s4">);</span>
        <span class="s4">});</span>
      <span class="s4">};</span>
      <span class="s3">let </span><span class="s2">observer </span><span class="s4">= </span><span class="s3">new </span><span class="s2">IntersectionObserver</span><span class="s4">(</span><span class="s2">callback</span><span class="s4">, { </span><span class="s2">threshold</span><span class="s4">: </span><span class="s7">0.5 </span><span class="s4">});</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">ref</span><span class="s4">.</span><span class="s2">current</span><span class="s4">) </span><span class="s2">observer</span><span class="s4">.</span><span class="s2">observe</span><span class="s4">(</span><span class="s2">ref</span><span class="s4">.</span><span class="s2">current</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s4">() =&gt; {</span>
        <span class="s2">observer</span><span class="s4">.</span><span class="s2">disconnect</span><span class="s4">();</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">prefetch</span><span class="s4">]);</span>
  <span class="s2">React9</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">maybePrefetch</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">setTimeout</span><span class="s4">(() =&gt; {</span>
        <span class="s2">setShouldPrefetch</span><span class="s4">(</span><span class="s3">true</span><span class="s4">);</span>
      <span class="s4">}, </span><span class="s7">100</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s4">() =&gt; {</span>
        <span class="s2">clearTimeout</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s4">};</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">maybePrefetch</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">setIntent </span><span class="s4">= () =&gt; {</span>
    <span class="s2">setMaybePrefetch</span><span class="s4">(</span><span class="s3">true</span><span class="s4">);</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">cancelIntent </span><span class="s4">= () =&gt; {</span>
    <span class="s2">setMaybePrefetch</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
    <span class="s2">setShouldPrefetch</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">frameworkContext</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">[</span><span class="s3">false</span><span class="s4">, </span><span class="s2">ref</span><span class="s4">, {}];</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">prefetch </span><span class="s4">!== </span><span class="s5">&quot;intent&quot;</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">[</span><span class="s2">shouldPrefetch</span><span class="s4">, </span><span class="s2">ref</span><span class="s4">, {}];</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">[</span>
    <span class="s2">shouldPrefetch</span><span class="s4">,</span>
    <span class="s2">ref</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">onFocus</span><span class="s4">: </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">onFocus</span><span class="s4">, </span><span class="s2">setIntent</span><span class="s4">),</span>
      <span class="s2">onBlur</span><span class="s4">: </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">onBlur</span><span class="s4">, </span><span class="s2">cancelIntent</span><span class="s4">),</span>
      <span class="s2">onMouseEnter</span><span class="s4">: </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">onMouseEnter</span><span class="s4">, </span><span class="s2">setIntent</span><span class="s4">),</span>
      <span class="s2">onMouseLeave</span><span class="s4">: </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">onMouseLeave</span><span class="s4">, </span><span class="s2">cancelIntent</span><span class="s4">),</span>
      <span class="s2">onTouchStart</span><span class="s4">: </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">onTouchStart</span><span class="s4">, </span><span class="s2">setIntent</span><span class="s4">)</span>
    <span class="s4">}</span>
  <span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">composeEventHandlers</span><span class="s4">(</span><span class="s2">theirHandler</span><span class="s4">, </span><span class="s2">ourHandler</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">event</span><span class="s4">) =&gt; {</span>
    <span class="s2">theirHandler </span><span class="s4">&amp;&amp; </span><span class="s2">theirHandler</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">event</span><span class="s4">.</span><span class="s2">defaultPrevented</span><span class="s4">) {</span>
      <span class="s2">ourHandler</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getActiveMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isSpaMode </span><span class="s4">&amp;&amp; !</span><span class="s2">isHydrated</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">[</span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]];</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">errorIdx </span><span class="s4">= </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] !== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">errorIdx </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Links</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">criticalCss </span><span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">errors</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">routerMatches </span><span class="s4">} = </span><span class="s2">useDataRouterStateContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">getActiveMatches</span><span class="s4">(</span><span class="s2">routerMatches</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">keyedLinks </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">getKeyedLinksForMatches</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">),</span>
    <span class="s4">[</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React9</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s3">typeof </span><span class="s2">criticalCss </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;style&quot;</span><span class="s4">, { </span><span class="s2">dangerouslySetInnerHTML</span><span class="s4">: { </span><span class="s2">__html</span><span class="s4">: </span><span class="s2">criticalCss </span><span class="s4">} }) : </span><span class="s3">null</span><span class="s4">, </span><span class="s3">typeof </span><span class="s2">criticalCss </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">, { </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;stylesheet&quot;</span><span class="s4">, </span><span class="s2">href</span><span class="s4">: </span><span class="s2">criticalCss</span><span class="s4">.</span><span class="s2">href </span><span class="s4">}) : </span><span class="s3">null</span><span class="s4">, </span><span class="s2">keyedLinks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
    <span class="s4">({ </span><span class="s2">key</span><span class="s4">, </span><span class="s2">link </span><span class="s4">}) =&gt; </span><span class="s2">isPageLinkDescriptor</span><span class="s4">(</span><span class="s2">link</span><span class="s4">) ? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">PrefetchPageLinks</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">, </span><span class="s2">...link </span><span class="s4">}) : </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">, </span><span class="s2">...link </span><span class="s4">})</span>
  <span class="s4">));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">PrefetchPageLinks</span><span class="s4">({</span>
  <span class="s2">page</span><span class="s4">,</span>
  <span class="s2">...dataLinkProps</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router </span><span class="s4">} = </span><span class="s2">useDataRouterContext2</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">router</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">page</span><span class="s4">, </span><span class="s2">router</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">),</span>
    <span class="s4">[</span><span class="s2">router</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">page</span><span class="s4">, </span><span class="s2">router</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">PrefetchPageLinksImpl</span><span class="s4">, { </span><span class="s2">page</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">...dataLinkProps </span><span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useKeyedPrefetchLinks</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules </span><span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">keyedPrefetchLinks</span><span class="s4">, </span><span class="s2">setKeyedPrefetchLinks</span><span class="s4">] = </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">([]);</span>
  <span class="s2">React9</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">interrupted </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s3">void </span><span class="s2">getKeyedPrefetchLinks</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">).</span><span class="s2">then</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">links</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">interrupted</span><span class="s4">) {</span>
          <span class="s2">setKeyedPrefetchLinks</span><span class="s4">(</span><span class="s2">links</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; {</span>
      <span class="s2">interrupted </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s4">};</span>
  <span class="s4">}, [</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s2">keyedPrefetchLinks</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">PrefetchPageLinksImpl</span><span class="s4">({</span>
  <span class="s2">page</span><span class="s4">,</span>
  <span class="s2">matches</span><span class="s4">: </span><span class="s2">nextMatches</span><span class="s4">,</span>
  <span class="s2">...linkProps</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules </span><span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">useDataRouterContext2</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">loaderData</span><span class="s4">, </span><span class="s2">matches </span><span class="s4">} = </span><span class="s2">useDataRouterStateContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">newMatchesForData </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">getNewMatchesForLinks</span><span class="s4">(</span>
      <span class="s2">page</span><span class="s4">,</span>
      <span class="s2">nextMatches</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s5">&quot;data&quot;</span>
    <span class="s4">),</span>
    <span class="s4">[</span><span class="s2">page</span><span class="s4">, </span><span class="s2">nextMatches</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">location</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">newMatchesForAssets </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">getNewMatchesForLinks</span><span class="s4">(</span>
      <span class="s2">page</span><span class="s4">,</span>
      <span class="s2">nextMatches</span><span class="s4">,</span>
      <span class="s2">matches</span><span class="s4">,</span>
      <span class="s2">manifest</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s5">&quot;assets&quot;</span>
    <span class="s4">),</span>
    <span class="s4">[</span><span class="s2">page</span><span class="s4">, </span><span class="s2">nextMatches</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">location</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">dataHrefs </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">page </span><span class="s4">=== </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">location</span><span class="s4">.</span><span class="s2">search </span><span class="s4">+ </span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">[];</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">routesParams </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s2">nextMatches</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">manifestRoute </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">manifestRoute </span><span class="s4">|| !</span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">newMatchesForData</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">m2</span><span class="s4">) =&gt; </span><span class="s2">m2</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) &amp;&amp; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">loaderData </span><span class="s4">&amp;&amp; </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]?.</span><span class="s2">shouldRevalidate</span><span class="s4">) {</span>
        <span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasClientLoader</span><span class="s4">) {</span>
        <span class="s2">foundOptOutRoute </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">routesParams</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">size </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s4">[];</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s2">singleFetchUrl</span><span class="s4">(</span><span class="s2">page</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">foundOptOutRoute </span><span class="s4">&amp;&amp; </span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span>
        <span class="s5">&quot;_routes&quot;</span><span class="s4">,</span>
        <span class="s2">nextMatches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">routesParams</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">)).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s4">[</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">+ </span><span class="s2">url</span><span class="s4">.</span><span class="s2">search</span><span class="s4">];</span>
  <span class="s4">}, [</span>
    <span class="s2">basename</span><span class="s4">,</span>
    <span class="s2">loaderData</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">,</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">newMatchesForData</span><span class="s4">,</span>
    <span class="s2">nextMatches</span><span class="s4">,</span>
    <span class="s2">page</span><span class="s4">,</span>
    <span class="s2">routeModules</span>
  <span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">moduleHrefs </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">getModuleLinkHrefs</span><span class="s4">(</span><span class="s2">newMatchesForAssets</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">),</span>
    <span class="s4">[</span><span class="s2">newMatchesForAssets</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">keyedPrefetchLinks </span><span class="s4">= </span><span class="s2">useKeyedPrefetchLinks</span><span class="s4">(</span><span class="s2">newMatchesForAssets</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React9</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">dataHrefs</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">href2</span><span class="s4">) =&gt; </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;prefetch&quot;</span><span class="s4">, as: </span><span class="s5">&quot;fetch&quot;</span><span class="s4">, </span><span class="s2">href</span><span class="s4">: </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">...linkProps </span><span class="s4">})), </span><span class="s2">moduleHrefs</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">href2</span><span class="s4">) =&gt; </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;modulepreload&quot;</span><span class="s4">, </span><span class="s2">href</span><span class="s4">: </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">...linkProps </span><span class="s4">})), </span><span class="s2">keyedPrefetchLinks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(({ </span><span class="s2">key</span><span class="s4">, </span><span class="s2">link </span><span class="s4">}) =&gt; (</span>
    <span class="s6">// these don't spread `linkProps` because they are full link descriptors</span>
    <span class="s6">// already with their own props</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;link&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">, </span><span class="s2">...link </span><span class="s4">})</span>
  <span class="s4">)));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">Meta</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">routeModules </span><span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{</span>
    <span class="s2">errors</span><span class="s4">,</span>
    <span class="s2">matches</span><span class="s4">: </span><span class="s2">routerMatches</span><span class="s4">,</span>
    <span class="s2">loaderData</span>
  <span class="s4">} = </span><span class="s2">useDataRouterStateContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">_matches </span><span class="s4">= </span><span class="s2">getActiveMatches</span><span class="s4">(</span><span class="s2">routerMatches</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
    <span class="s2">error </span><span class="s4">= </span><span class="s2">errors</span><span class="s4">[</span><span class="s2">_matches</span><span class="s4">[</span><span class="s2">_matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">meta </span><span class="s4">= [];</span>
  <span class="s3">let </span><span class="s2">leafMeta </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= [];</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">_matches</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
    <span class="s3">let </span><span class="s2">_match </span><span class="s4">= </span><span class="s2">_matches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">params </span><span class="s4">= </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">routeMeta </span><span class="s4">= [];</span>
    <span class="s3">let </span><span class="s2">match </span><span class="s4">= {</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">,</span>
      <span class="s2">meta</span><span class="s4">: [],</span>
      <span class="s2">params</span><span class="s4">: </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
      <span class="s2">pathname</span><span class="s4">: </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
      <span class="s2">error</span>
    <span class="s4">};</span>
    <span class="s2">matches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">] = </span><span class="s2">match</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">?.</span><span class="s2">meta</span><span class="s4">) {</span>
      <span class="s2">routeMeta </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">({</span>
        <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">,</span>
        <span class="s2">params</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">error</span>
      <span class="s4">}) : </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">) ? [</span><span class="s2">...routeModule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">] : </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">leafMeta</span><span class="s4">) {</span>
      <span class="s2">routeMeta </span><span class="s4">= [</span><span class="s2">...leafMeta</span><span class="s4">];</span>
    <span class="s4">}</span>
    <span class="s2">routeMeta </span><span class="s4">= </span><span class="s2">routeMeta </span><span class="s4">|| [];</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">routeMeta</span><span class="s4">)) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">&quot;The route at &quot; </span><span class="s4">+ </span><span class="s2">_match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">path </span><span class="s4">+ </span><span class="s5">&quot; returns an invalid value. All route meta functions must return an array of meta objects.</span><span class="s3">\n\n</span><span class="s5">To reference the meta function API, see https://remix.run/route/meta&quot;</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">match</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">= </span><span class="s2">routeMeta</span><span class="s4">;</span>
    <span class="s2">matches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">] = </span><span class="s2">match</span><span class="s4">;</span>
    <span class="s2">meta </span><span class="s4">= [</span><span class="s2">...routeMeta</span><span class="s4">];</span>
    <span class="s2">leafMeta </span><span class="s4">= </span><span class="s2">meta</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React9</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">flat</span><span class="s4">().</span><span class="s2">map</span><span class="s4">((</span><span class="s2">metaProps</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">metaProps</span><span class="s4">) {</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;tagName&quot; </span><span class="s3">in </span><span class="s2">metaProps</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">tagName</span><span class="s4">, </span><span class="s2">...rest </span><span class="s4">} = </span><span class="s2">metaProps</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">isValidMetaTag</span><span class="s4">(</span><span class="s2">tagName</span><span class="s4">)) {</span>
        <span class="s2">console</span><span class="s4">.</span><span class="s2">warn</span><span class="s4">(</span>
          <span class="s5">`A meta object uses an invalid tagName: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">tagName</span><span class="s4">}</span><span class="s5">. Expected either 'link' or 'meta'`</span>
        <span class="s4">);</span>
        <span class="s3">return null</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">Comp </span><span class="s4">= </span><span class="s2">tagName</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">Comp</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">rest</span><span class="s4">), </span><span class="s2">...rest </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;title&quot; </span><span class="s3">in </span><span class="s2">metaProps</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;title&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s5">&quot;title&quot; </span><span class="s4">}, </span><span class="s2">String</span><span class="s4">(</span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">title</span><span class="s4">));</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;charset&quot; </span><span class="s3">in </span><span class="s2">metaProps</span><span class="s4">) {</span>
      <span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charSet </span><span class="s4">?? (</span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charSet </span><span class="s4">= </span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charset</span><span class="s4">);</span>
      <span class="s3">delete </span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charset</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;charSet&quot; </span><span class="s3">in </span><span class="s2">metaProps </span><span class="s4">&amp;&amp; </span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charSet </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s3">return typeof </span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charSet </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;meta&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s5">&quot;charSet&quot;</span><span class="s4">, </span><span class="s2">charSet</span><span class="s4">: </span><span class="s2">metaProps</span><span class="s4">.</span><span class="s2">charSet </span><span class="s4">}) : </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s5">&quot;script:ld+json&quot; </span><span class="s3">in </span><span class="s2">metaProps</span><span class="s4">) {</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">json </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">metaProps</span><span class="s4">[</span><span class="s5">&quot;script:ld+json&quot;</span><span class="s4">]);</span>
        <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
          <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
          <span class="s4">{</span>
            <span class="s2">key</span><span class="s4">: </span><span class="s5">`script:ld+json:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">json</span><span class="s4">}</span><span class="s5">`</span><span class="s4">,</span>
            <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;application/ld+json&quot;</span><span class="s4">,</span>
            <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: { </span><span class="s2">__html</span><span class="s4">: </span><span class="s2">json </span><span class="s4">}</span>
          <span class="s4">}</span>
        <span class="s4">);</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
        <span class="s3">return null</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s5">&quot;meta&quot;</span><span class="s4">, { </span><span class="s2">key</span><span class="s4">: </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">metaProps</span><span class="s4">), </span><span class="s2">...metaProps </span><span class="s4">});</span>
  <span class="s4">}));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">isValidMetaTag</span><span class="s4">(</span><span class="s2">tagName</span><span class="s4">) {</span>
  <span class="s3">return typeof </span><span class="s2">tagName </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s8">/^(meta|link)$/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">tagName</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">isHydrated </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">Scripts</span><span class="s4">(</span><span class="s2">props</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{</span>
    <span class="s2">manifest</span><span class="s4">,</span>
    <span class="s2">serverHandoffString</span><span class="s4">,</span>
    <span class="s2">isSpaMode</span><span class="s4">,</span>
    <span class="s2">renderMeta</span><span class="s4">,</span>
    <span class="s2">routeDiscovery</span><span class="s4">,</span>
    <span class="s2">ssr</span>
  <span class="s4">} = </span><span class="s2">useFrameworkContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router</span><span class="s4">, </span><span class="s3">static</span><span class="s4">: </span><span class="s2">isStatic</span><span class="s4">, </span><span class="s2">staticContext </span><span class="s4">} = </span><span class="s2">useDataRouterContext2</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">matches</span><span class="s4">: </span><span class="s2">routerMatches </span><span class="s4">} = </span><span class="s2">useDataRouterStateContext</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">enableFogOfWar </span><span class="s4">= </span><span class="s2">isFogOfWarEnabled</span><span class="s4">(</span><span class="s2">routeDiscovery</span><span class="s4">, </span><span class="s2">ssr</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">renderMeta</span><span class="s4">) {</span>
    <span class="s2">renderMeta</span><span class="s4">.</span><span class="s2">didRenderScripts </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">getActiveMatches</span><span class="s4">(</span><span class="s2">routerMatches</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">);</span>
  <span class="s2">React9</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">isHydrated </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
  <span class="s4">}, []);</span>
  <span class="s3">let </span><span class="s2">initialScripts </span><span class="s4">= </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">streamScript </span><span class="s4">= </span><span class="s5">&quot;window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">contextScript </span><span class="s4">= </span><span class="s2">staticContext </span><span class="s4">? </span><span class="s5">`window.__reactRouterContext = </span><span class="s2">$</span><span class="s4">{</span><span class="s2">serverHandoffString</span><span class="s4">}</span><span class="s5">;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">streamScript</span><span class="s4">}</span><span class="s5">` </span><span class="s4">: </span><span class="s5">&quot; &quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">routeModulesScript </span><span class="s4">= !</span><span class="s2">isStatic </span><span class="s4">? </span><span class="s5">&quot; &quot; </span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">hmr</span><span class="s4">?.</span><span class="s2">runtime </span><span class="s4">? </span><span class="s5">`import </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">hmr</span><span class="s4">.</span><span class="s2">runtime</span><span class="s4">)}</span><span class="s5">;` </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">}</span><span class="s2">$</span><span class="s4">{!</span><span class="s2">enableFogOfWar </span><span class="s4">? </span><span class="s5">`import </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">url</span><span class="s4">)}</span><span class="s5">` </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">}</span><span class="s5">; 
</span><span class="s2">$</span><span class="s4">{</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">, </span><span class="s2">routeIndex</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">routeVarName </span><span class="s4">= </span><span class="s5">`route</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeIndex</span><span class="s4">}</span><span class="s5">`</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">manifestEntry </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s2">invariant2</span><span class="s4">(</span><span class="s2">manifestEntry</span><span class="s4">, </span><span class="s5">`Route </span><span class="s2">$</span><span class="s4">{</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">} </span><span class="s5">not found in manifest`</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s4">{</span>
        <span class="s2">clientActionModule</span><span class="s4">,</span>
        <span class="s2">clientLoaderModule</span><span class="s4">,</span>
        <span class="s2">clientMiddlewareModule</span><span class="s4">,</span>
        <span class="s2">hydrateFallbackModule</span><span class="s4">,</span>
        <span class="s2">module</span>
      <span class="s4">} = </span><span class="s2">manifestEntry</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">chunks </span><span class="s4">= [</span>
        <span class="s2">...clientActionModule </span><span class="s4">? [</span>
          <span class="s4">{</span>
            <span class="s2">module</span><span class="s4">: </span><span class="s2">clientActionModule</span><span class="s4">,</span>
            <span class="s2">varName</span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">}</span><span class="s5">_clientAction`</span>
          <span class="s4">}</span>
        <span class="s4">] : [],</span>
        <span class="s2">...clientLoaderModule </span><span class="s4">? [</span>
          <span class="s4">{</span>
            <span class="s2">module</span><span class="s4">: </span><span class="s2">clientLoaderModule</span><span class="s4">,</span>
            <span class="s2">varName</span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">}</span><span class="s5">_clientLoader`</span>
          <span class="s4">}</span>
        <span class="s4">] : [],</span>
        <span class="s2">...clientMiddlewareModule </span><span class="s4">? [</span>
          <span class="s4">{</span>
            <span class="s2">module</span><span class="s4">: </span><span class="s2">clientMiddlewareModule</span><span class="s4">,</span>
            <span class="s2">varName</span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">}</span><span class="s5">_clientMiddleware`</span>
          <span class="s4">}</span>
        <span class="s4">] : [],</span>
        <span class="s2">...hydrateFallbackModule </span><span class="s4">? [</span>
          <span class="s4">{</span>
            <span class="s2">module</span><span class="s4">: </span><span class="s2">hydrateFallbackModule</span><span class="s4">,</span>
            <span class="s2">varName</span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">}</span><span class="s5">_HydrateFallback`</span>
          <span class="s4">}</span>
        <span class="s4">] : [],</span>
        <span class="s4">{ </span><span class="s2">module</span><span class="s4">, </span><span class="s2">varName</span><span class="s4">: </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">}</span><span class="s5">_main` </span><span class="s4">}</span>
      <span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">chunks</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">1</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s5">`import * as </span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">} </span><span class="s5">from </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">module</span><span class="s4">)}</span><span class="s5">;`</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">chunkImportsSnippet </span><span class="s4">= </span><span class="s2">chunks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">chunk</span><span class="s4">) =&gt; </span><span class="s5">`import * as </span><span class="s2">$</span><span class="s4">{</span><span class="s2">chunk</span><span class="s4">.</span><span class="s2">varName</span><span class="s4">} </span><span class="s5">from &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">chunk</span><span class="s4">.</span><span class="s2">module</span><span class="s4">}</span><span class="s5">&quot;;`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">mergedChunksSnippet </span><span class="s4">= </span><span class="s5">`const </span><span class="s2">$</span><span class="s4">{</span><span class="s2">routeVarName</span><span class="s4">} </span><span class="s5">= {</span><span class="s2">$</span><span class="s4">{</span><span class="s2">chunks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">chunk</span><span class="s4">) =&gt; </span><span class="s5">`...</span><span class="s2">$</span><span class="s4">{</span><span class="s2">chunk</span><span class="s4">.</span><span class="s2">varName</span><span class="s4">}</span><span class="s5">`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">};`</span><span class="s4">;</span>
      <span class="s3">return </span><span class="s4">[</span><span class="s2">chunkImportsSnippet</span><span class="s4">, </span><span class="s2">mergedChunksSnippet</span><span class="s4">].</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">);</span>
    <span class="s4">}).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;</span><span class="s3">\n</span><span class="s5">&quot;</span><span class="s4">)}</span>
  <span class="s2">$</span><span class="s4">{</span><span class="s2">enableFogOfWar </span><span class="s4">? (</span>
      <span class="s6">// Inline a minimal manifest with the SSR matches</span>
      <span class="s5">`window.__reactRouterManifest = </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
        <span class="s2">getPartialManifest</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">router</span><span class="s4">),</span>
        <span class="s3">null</span><span class="s4">,</span>
        <span class="s7">2</span>
      <span class="s4">)}</span><span class="s5">;`</span>
    <span class="s4">) : </span><span class="s5">&quot;&quot;</span><span class="s4">}</span>
  <span class="s5">window.__reactRouterRouteModules = {</span><span class="s2">$</span><span class="s4">{</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">)}</span><span class="s5">:route</span><span class="s2">$</span><span class="s4">{</span><span class="s2">index</span><span class="s4">}</span><span class="s5">`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)}</span><span class="s5">}; 
 
import(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">)}</span><span class="s5">);`</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React9</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">...props</span><span class="s4">,</span>
        <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: </span><span class="s2">createHtml</span><span class="s4">(</span><span class="s2">contextScript</span><span class="s4">),</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">}</span>
    <span class="s4">), </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">...props</span><span class="s4">,</span>
        <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: </span><span class="s2">createHtml</span><span class="s4">(</span><span class="s2">routeModulesScript</span><span class="s4">),</span>
        <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;module&quot;</span><span class="s4">,</span>
        <span class="s2">async</span><span class="s4">: </span><span class="s3">true</span>
      <span class="s4">}</span>
    <span class="s4">));</span>
  <span class="s4">}, []);</span>
  <span class="s3">let </span><span class="s2">preloads </span><span class="s4">= </span><span class="s2">isHydrated </span><span class="s4">? [] : </span><span class="s2">dedupe</span><span class="s4">(</span>
    <span class="s2">manifest</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">imports</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span>
      <span class="s2">getModuleLinkHrefs</span><span class="s4">(</span><span class="s2">matches</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, {</span>
        <span class="s2">includeHydrateFallback</span><span class="s4">: </span><span class="s3">true</span>
      <span class="s4">})</span>
    <span class="s4">)</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">sri </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">sri </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">? </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">sri </span><span class="s4">: {};</span>
  <span class="s3">return </span><span class="s2">isHydrated </span><span class="s4">? </span><span class="s3">null </span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React9</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s3">typeof </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">sri </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s5">&quot;rr-importmap&quot;</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
      <span class="s2">type</span><span class="s4">: </span><span class="s5">&quot;importmap&quot;</span><span class="s4">,</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
        <span class="s2">__html</span><span class="s4">: </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">({</span>
          <span class="s2">integrity</span><span class="s4">: </span><span class="s2">sri</span>
        <span class="s4">})</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">) : </span><span class="s3">null</span><span class="s4">, !</span><span class="s2">enableFogOfWar </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;link&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;modulepreload&quot;</span><span class="s4">,</span>
      <span class="s2">href</span><span class="s4">: </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">url</span><span class="s4">,</span>
      <span class="s2">crossOrigin</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">crossOrigin</span><span class="s4">,</span>
      <span class="s2">integrity</span><span class="s4">: </span><span class="s2">sri</span><span class="s4">[</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">url</span><span class="s4">],</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}</span>
  <span class="s4">) : </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;link&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;modulepreload&quot;</span><span class="s4">,</span>
      <span class="s2">href</span><span class="s4">: </span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">,</span>
      <span class="s2">crossOrigin</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">crossOrigin</span><span class="s4">,</span>
      <span class="s2">integrity</span><span class="s4">: </span><span class="s2">sri</span><span class="s4">[</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">],</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}</span>
  <span class="s4">), </span><span class="s2">preloads</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">path</span><span class="s4">) =&gt; </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React9</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;link&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">key</span><span class="s4">: </span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">rel</span><span class="s4">: </span><span class="s5">&quot;modulepreload&quot;</span><span class="s4">,</span>
      <span class="s2">href</span><span class="s4">: </span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">crossOrigin</span><span class="s4">: </span><span class="s2">props</span><span class="s4">.</span><span class="s2">crossOrigin</span><span class="s4">,</span>
      <span class="s2">integrity</span><span class="s4">: </span><span class="s2">sri</span><span class="s4">[</span><span class="s2">path</span><span class="s4">],</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}</span>
  <span class="s4">)), </span><span class="s2">initialScripts</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">dedupe</span><span class="s4">(</span><span class="s2">array</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">[</span><span class="s2">...</span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">array</span><span class="s4">)];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">mergeRefs</span><span class="s4">(</span><span class="s2">...refs</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">value</span><span class="s4">) =&gt; {</span>
    <span class="s2">refs</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">ref</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">ref </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
        <span class="s2">ref</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">ref </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s2">ref</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s2">value</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/lib.tsx</span>
<span class="s3">var </span><span class="s2">isBrowser </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">window </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">window</span><span class="s4">.</span><span class="s2">document </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">window</span><span class="s4">.</span><span class="s2">document</span><span class="s4">.</span><span class="s2">createElement </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">;</span>
<span class="s3">try </span><span class="s4">{</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isBrowser</span><span class="s4">) {</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">__reactRouterVersion </span><span class="s4">= </span><span class="s5">&quot;7.6.0&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createBrowserRouter</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">createRouter</span><span class="s4">({</span>
    <span class="s2">basename</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">basename</span><span class="s4">,</span>
    <span class="s2">unstable_getContext</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">unstable_getContext</span><span class="s4">,</span>
    <span class="s2">future</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">future</span><span class="s4">,</span>
    <span class="s2">history</span><span class="s4">: </span><span class="s2">createBrowserHistory</span><span class="s4">({ </span><span class="s2">window</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">window </span><span class="s4">}),</span>
    <span class="s2">hydrationData</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">hydrationData </span><span class="s4">|| </span><span class="s2">parseHydrationData</span><span class="s4">(),</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span><span class="s4">,</span>
    <span class="s2">hydrationRouteProperties</span><span class="s4">,</span>
    <span class="s2">dataStrategy</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">dataStrategy</span><span class="s4">,</span>
    <span class="s2">patchRoutesOnNavigation</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">,</span>
    <span class="s2">window</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">window</span>
  <span class="s4">}).</span><span class="s2">initialize</span><span class="s4">();</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createHashRouter</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">createRouter</span><span class="s4">({</span>
    <span class="s2">basename</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">basename</span><span class="s4">,</span>
    <span class="s2">unstable_getContext</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">unstable_getContext</span><span class="s4">,</span>
    <span class="s2">future</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">future</span><span class="s4">,</span>
    <span class="s2">history</span><span class="s4">: </span><span class="s2">createHashHistory</span><span class="s4">({ </span><span class="s2">window</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">window </span><span class="s4">}),</span>
    <span class="s2">hydrationData</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">hydrationData </span><span class="s4">|| </span><span class="s2">parseHydrationData</span><span class="s4">(),</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span><span class="s4">,</span>
    <span class="s2">hydrationRouteProperties</span><span class="s4">,</span>
    <span class="s2">dataStrategy</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">dataStrategy</span><span class="s4">,</span>
    <span class="s2">patchRoutesOnNavigation</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">patchRoutesOnNavigation</span><span class="s4">,</span>
    <span class="s2">window</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">?.</span><span class="s2">window</span>
  <span class="s4">}).</span><span class="s2">initialize</span><span class="s4">();</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">parseHydrationData</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">window</span><span class="s4">?.</span><span class="s2">__staticRouterHydrationData</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">state </span><span class="s4">&amp;&amp; </span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
    <span class="s2">state </span><span class="s4">= {</span>
      <span class="s2">...state</span><span class="s4">,</span>
      <span class="s2">errors</span><span class="s4">: </span><span class="s2">deserializeErrors</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)</span>
    <span class="s4">};</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">deserializeErrors</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">errors</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">serialized </span><span class="s4">= {};</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">val</span><span class="s4">] </span><span class="s2">of entries</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">val </span><span class="s4">&amp;&amp; </span><span class="s2">val</span><span class="s4">.</span><span class="s2">__type </span><span class="s4">=== </span><span class="s5">&quot;RouteErrorResponse&quot;</span><span class="s4">) {</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">data</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">internal </span><span class="s4">=== </span><span class="s3">true</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">val </span><span class="s4">&amp;&amp; </span><span class="s2">val</span><span class="s4">.</span><span class="s2">__type </span><span class="s4">=== </span><span class="s5">&quot;Error&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">__subType</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">ErrorConstructor </span><span class="s4">= </span><span class="s2">window</span><span class="s4">[</span><span class="s2">val</span><span class="s4">.</span><span class="s2">__subType</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">ErrorConstructor </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
          <span class="s3">try </span><span class="s4">{</span>
            <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">ErrorConstructor</span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">message</span><span class="s4">);</span>
            <span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
            <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] == </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">message</span><span class="s4">);</span>
        <span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
        <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">val</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">serialized</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">BrowserRouter</span><span class="s4">({</span>
  <span class="s2">basename</span><span class="s4">,</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">window</span><span class="s4">: </span><span class="s2">window2</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">historyRef </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s2">createBrowserHistory</span><span class="s4">({ </span><span class="s2">window</span><span class="s4">: </span><span class="s2">window2</span><span class="s4">, </span><span class="s2">v5Compat</span><span class="s4">: </span><span class="s3">true </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">history </span><span class="s4">= </span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">state</span><span class="s4">, </span><span class="s2">setStateImpl</span><span class="s4">] = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">({</span>
    <span class="s2">action</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">setState </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newState</span><span class="s4">) =&gt; {</span>
      <span class="s2">React10</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">setStateImpl</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; </span><span class="s2">history</span><span class="s4">.</span><span class="s2">listen</span><span class="s4">(</span><span class="s2">setState</span><span class="s4">), [</span><span class="s2">history</span><span class="s4">, </span><span class="s2">setState</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">history</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">HashRouter</span><span class="s4">({ </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">children</span><span class="s4">, </span><span class="s2">window</span><span class="s4">: </span><span class="s2">window2 </span><span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">historyRef </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s2">createHashHistory</span><span class="s4">({ </span><span class="s2">window</span><span class="s4">: </span><span class="s2">window2</span><span class="s4">, </span><span class="s2">v5Compat</span><span class="s4">: </span><span class="s3">true </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">history </span><span class="s4">= </span><span class="s2">historyRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">state</span><span class="s4">, </span><span class="s2">setStateImpl</span><span class="s4">] = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">({</span>
    <span class="s2">action</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">setState </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newState</span><span class="s4">) =&gt; {</span>
      <span class="s2">React10</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">setStateImpl</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; </span><span class="s2">history</span><span class="s4">.</span><span class="s2">listen</span><span class="s4">(</span><span class="s2">setState</span><span class="s4">), [</span><span class="s2">history</span><span class="s4">, </span><span class="s2">setState</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">history</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">HistoryRouter</span><span class="s4">({</span>
  <span class="s2">basename</span><span class="s4">,</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">history</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">state</span><span class="s4">, </span><span class="s2">setStateImpl</span><span class="s4">] = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">({</span>
    <span class="s2">action</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
    <span class="s2">location</span><span class="s4">: </span><span class="s2">history</span><span class="s4">.</span><span class="s2">location</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">setState </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">newState</span><span class="s4">) =&gt; {</span>
      <span class="s2">React10</span><span class="s4">.</span><span class="s2">startTransition</span><span class="s4">(() =&gt; </span><span class="s2">setStateImpl</span><span class="s4">(</span><span class="s2">newState</span><span class="s4">));</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">setStateImpl</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; </span><span class="s2">history</span><span class="s4">.</span><span class="s2">listen</span><span class="s4">(</span><span class="s2">setState</span><span class="s4">), [</span><span class="s2">history</span><span class="s4">, </span><span class="s2">setState</span><span class="s4">]);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">history</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s2">HistoryRouter</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;unstable_HistoryRouter&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">ABSOLUTE_URL_REGEX2 </span><span class="s4">= </span><span class="s8">/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">Link </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">forwardRef</span><span class="s4">(</span>
  <span class="s3">function </span><span class="s2">LinkWithRef</span><span class="s4">({</span>
    <span class="s2">onClick</span><span class="s4">,</span>
    <span class="s2">discover </span><span class="s4">= </span><span class="s5">&quot;render&quot;</span><span class="s4">,</span>
    <span class="s2">prefetch </span><span class="s4">= </span><span class="s5">&quot;none&quot;</span><span class="s4">,</span>
    <span class="s2">relative</span><span class="s4">,</span>
    <span class="s2">reloadDocument</span><span class="s4">,</span>
    <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
    <span class="s2">state</span><span class="s4">,</span>
    <span class="s2">target</span><span class="s4">,</span>
    <span class="s2">to</span><span class="s4">,</span>
    <span class="s2">preventScrollReset</span><span class="s4">,</span>
    <span class="s2">viewTransition</span><span class="s4">,</span>
    <span class="s2">...rest</span>
  <span class="s4">}, </span><span class="s2">forwardedRef</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">isAbsolute </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">ABSOLUTE_URL_REGEX2</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">absoluteHref</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">isExternal </span><span class="s4">= </span><span class="s3">false</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">isAbsolute</span><span class="s4">) {</span>
      <span class="s2">absoluteHref </span><span class="s4">= </span><span class="s2">to</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isBrowser</span><span class="s4">) {</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s3">let </span><span class="s2">currentUrl </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">window</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">href</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">targetUrl </span><span class="s4">= </span><span class="s2">to</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;//&quot;</span><span class="s4">) ? </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">protocol </span><span class="s4">+ </span><span class="s2">to</span><span class="s4">) : </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">targetUrl</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">targetUrl</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">=== </span><span class="s2">currentUrl</span><span class="s4">.</span><span class="s2">origin </span><span class="s4">&amp;&amp; </span><span class="s2">path </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
            <span class="s2">to </span><span class="s4">= </span><span class="s2">path </span><span class="s4">+ </span><span class="s2">targetUrl</span><span class="s4">.</span><span class="s2">search </span><span class="s4">+ </span><span class="s2">targetUrl</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
            <span class="s2">isExternal </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s2">warning</span><span class="s4">(</span>
            <span class="s3">false</span><span class="s4">,</span>
            <span class="s5">`&lt;Link to=&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">to</span><span class="s4">}</span><span class="s5">&quot;&gt; contains an invalid URL which will probably break when clicked - please update to a valid URL path.`</span>
          <span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">href2 </span><span class="s4">= </span><span class="s2">useHref</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">});</span>
    <span class="s3">let </span><span class="s4">[</span><span class="s2">shouldPrefetch</span><span class="s4">, </span><span class="s2">prefetchRef</span><span class="s4">, </span><span class="s2">prefetchHandlers</span><span class="s4">] = </span><span class="s2">usePrefetchBehavior</span><span class="s4">(</span>
      <span class="s2">prefetch</span><span class="s4">,</span>
      <span class="s2">rest</span>
    <span class="s4">);</span>
    <span class="s3">let </span><span class="s2">internalOnClick </span><span class="s4">= </span><span class="s2">useLinkClickHandler</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, {</span>
      <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">target</span><span class="s4">,</span>
      <span class="s2">preventScrollReset</span><span class="s4">,</span>
      <span class="s2">relative</span><span class="s4">,</span>
      <span class="s2">viewTransition</span>
    <span class="s4">});</span>
    <span class="s3">function </span><span class="s2">handleClick</span><span class="s4">(</span><span class="s2">event</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">onClick</span><span class="s4">) </span><span class="s2">onClick</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">event</span><span class="s4">.</span><span class="s2">defaultPrevented</span><span class="s4">) {</span>
        <span class="s2">internalOnClick</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">link </span><span class="s4">= (</span>
      <span class="s6">// eslint-disable-next-line jsx-a11y/anchor-has-content</span>
      <span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
        <span class="s5">&quot;a&quot;</span><span class="s4">,</span>
        <span class="s4">{</span>
          <span class="s2">...rest</span><span class="s4">,</span>
          <span class="s2">...prefetchHandlers</span><span class="s4">,</span>
          <span class="s2">href</span><span class="s4">: </span><span class="s2">absoluteHref </span><span class="s4">|| </span><span class="s2">href2</span><span class="s4">,</span>
          <span class="s2">onClick</span><span class="s4">: </span><span class="s2">isExternal </span><span class="s4">|| </span><span class="s2">reloadDocument </span><span class="s4">? </span><span class="s2">onClick </span><span class="s4">: </span><span class="s2">handleClick</span><span class="s4">,</span>
          <span class="s2">ref</span><span class="s4">: </span><span class="s2">mergeRefs</span><span class="s4">(</span><span class="s2">forwardedRef</span><span class="s4">, </span><span class="s2">prefetchRef</span><span class="s4">),</span>
          <span class="s2">target</span><span class="s4">,</span>
          <span class="s5">&quot;data-discover&quot;</span><span class="s4">: !</span><span class="s2">isAbsolute </span><span class="s4">&amp;&amp; </span><span class="s2">discover </span><span class="s4">=== </span><span class="s5">&quot;render&quot; </span><span class="s4">? </span><span class="s5">&quot;true&quot; </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
        <span class="s4">}</span>
      <span class="s4">)</span>
    <span class="s4">);</span>
    <span class="s3">return </span><span class="s2">shouldPrefetch </span><span class="s4">&amp;&amp; !</span><span class="s2">isAbsolute </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React10</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s2">link</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">PrefetchPageLinks</span><span class="s4">, { </span><span class="s2">page</span><span class="s4">: </span><span class="s2">href2 </span><span class="s4">})) : </span><span class="s2">link</span><span class="s4">;</span>
  <span class="s4">}</span>
<span class="s4">);</span>
<span class="s2">Link</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Link&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">NavLink </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">forwardRef</span><span class="s4">(</span>
  <span class="s3">function </span><span class="s2">NavLinkWithRef</span><span class="s4">({</span>
    <span class="s5">&quot;aria-current&quot;</span><span class="s4">: </span><span class="s2">ariaCurrentProp </span><span class="s4">= </span><span class="s5">&quot;page&quot;</span><span class="s4">,</span>
    <span class="s2">caseSensitive </span><span class="s4">= </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">className</span><span class="s4">: </span><span class="s2">classNameProp </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">end </span><span class="s4">= </span><span class="s3">false</span><span class="s4">,</span>
    <span class="s2">style</span><span class="s4">: </span><span class="s2">styleProp</span><span class="s4">,</span>
    <span class="s2">to</span><span class="s4">,</span>
    <span class="s2">viewTransition</span><span class="s4">,</span>
    <span class="s2">children</span><span class="s4">,</span>
    <span class="s2">...rest</span>
  <span class="s4">}, </span><span class="s2">ref</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">useResolvedPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative</span><span class="s4">: </span><span class="s2">rest</span><span class="s4">.</span><span class="s2">relative </span><span class="s4">});</span>
    <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">routerState </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">navigator</span><span class="s4">, </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">isTransitioning </span><span class="s4">= </span><span class="s2">routerState </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s6">// Conditional usage is OK here because the usage of a data router is static</span>
    <span class="s6">// eslint-disable-next-line react-hooks/rules-of-hooks</span>
    <span class="s2">useViewTransitionState</span><span class="s4">(</span><span class="s2">path</span><span class="s4">) &amp;&amp; </span><span class="s2">viewTransition </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">toPathname </span><span class="s4">= </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation </span><span class="s4">? </span><span class="s2">navigator</span><span class="s4">.</span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">path</span><span class="s4">).</span><span class="s2">pathname </span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">locationPathname </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">nextLocationPathname </span><span class="s4">= </span><span class="s2">routerState </span><span class="s4">&amp;&amp; </span><span class="s2">routerState</span><span class="s4">.</span><span class="s2">navigation </span><span class="s4">&amp;&amp; </span><span class="s2">routerState</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location </span><span class="s4">? </span><span class="s2">routerState</span><span class="s4">.</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">: </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">caseSensitive</span><span class="s4">) {</span>
      <span class="s2">locationPathname </span><span class="s4">= </span><span class="s2">locationPathname</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">();</span>
      <span class="s2">nextLocationPathname </span><span class="s4">= </span><span class="s2">nextLocationPathname </span><span class="s4">? </span><span class="s2">nextLocationPathname</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">() : </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s2">toPathname </span><span class="s4">= </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">();</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">nextLocationPathname </span><span class="s4">&amp;&amp; </span><span class="s2">basename</span><span class="s4">) {</span>
      <span class="s2">nextLocationPathname </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">nextLocationPathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">nextLocationPathname</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">const </span><span class="s2">endSlashPosition </span><span class="s4">= </span><span class="s2">toPathname </span><span class="s4">!== </span><span class="s5">&quot;/&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">) ? </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1 </span><span class="s4">: </span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">length</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">isActive </span><span class="s4">= </span><span class="s2">locationPathname </span><span class="s4">=== </span><span class="s2">toPathname </span><span class="s4">|| !</span><span class="s2">end </span><span class="s4">&amp;&amp; </span><span class="s2">locationPathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s2">toPathname</span><span class="s4">) &amp;&amp; </span><span class="s2">locationPathname</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">endSlashPosition</span><span class="s4">) === </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">isPending </span><span class="s4">= </span><span class="s2">nextLocationPathname </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; (</span><span class="s2">nextLocationPathname </span><span class="s4">=== </span><span class="s2">toPathname </span><span class="s4">|| !</span><span class="s2">end </span><span class="s4">&amp;&amp; </span><span class="s2">nextLocationPathname</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s2">toPathname</span><span class="s4">) &amp;&amp; </span><span class="s2">nextLocationPathname</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">toPathname</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) === </span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">renderProps </span><span class="s4">= {</span>
      <span class="s2">isActive</span><span class="s4">,</span>
      <span class="s2">isPending</span><span class="s4">,</span>
      <span class="s2">isTransitioning</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">ariaCurrent </span><span class="s4">= </span><span class="s2">isActive </span><span class="s4">? </span><span class="s2">ariaCurrentProp </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">className</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">classNameProp </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
      <span class="s2">className </span><span class="s4">= </span><span class="s2">classNameProp</span><span class="s4">(</span><span class="s2">renderProps</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">className </span><span class="s4">= [</span>
        <span class="s2">classNameProp</span><span class="s4">,</span>
        <span class="s2">isActive </span><span class="s4">? </span><span class="s5">&quot;active&quot; </span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">isPending </span><span class="s4">? </span><span class="s5">&quot;pending&quot; </span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">isTransitioning </span><span class="s4">? </span><span class="s5">&quot;transitioning&quot; </span><span class="s4">: </span><span class="s3">null</span>
      <span class="s4">].</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">Boolean</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot; &quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">style </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">styleProp </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">styleProp</span><span class="s4">(</span><span class="s2">renderProps</span><span class="s4">) : </span><span class="s2">styleProp</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">Link</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">...rest</span><span class="s4">,</span>
        <span class="s5">&quot;aria-current&quot;</span><span class="s4">: </span><span class="s2">ariaCurrent</span><span class="s4">,</span>
        <span class="s2">className</span><span class="s4">,</span>
        <span class="s2">ref</span><span class="s4">,</span>
        <span class="s2">style</span><span class="s4">,</span>
        <span class="s2">to</span><span class="s4">,</span>
        <span class="s2">viewTransition</span>
      <span class="s4">},</span>
      <span class="s3">typeof </span><span class="s2">children </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">children</span><span class="s4">(</span><span class="s2">renderProps</span><span class="s4">) : </span><span class="s2">children</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">);</span>
<span class="s2">NavLink</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;NavLink&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">Form </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">forwardRef</span><span class="s4">(</span>
  <span class="s4">({</span>
    <span class="s2">discover </span><span class="s4">= </span><span class="s5">&quot;render&quot;</span><span class="s4">,</span>
    <span class="s2">fetcherKey</span><span class="s4">,</span>
    <span class="s2">navigate</span><span class="s4">,</span>
    <span class="s2">reloadDocument</span><span class="s4">,</span>
    <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
    <span class="s2">state</span><span class="s4">,</span>
    <span class="s2">method </span><span class="s4">= </span><span class="s2">defaultMethod</span><span class="s4">,</span>
    <span class="s2">action</span><span class="s4">,</span>
    <span class="s2">onSubmit</span><span class="s4">,</span>
    <span class="s2">relative</span><span class="s4">,</span>
    <span class="s2">preventScrollReset</span><span class="s4">,</span>
    <span class="s2">viewTransition</span><span class="s4">,</span>
    <span class="s2">...props</span>
  <span class="s4">}, </span><span class="s2">forwardedRef</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">submit </span><span class="s4">= </span><span class="s2">useSubmit</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">formAction </span><span class="s4">= </span><span class="s2">useFormAction</span><span class="s4">(</span><span class="s2">action</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">});</span>
    <span class="s3">let </span><span class="s2">formMethod </span><span class="s4">= </span><span class="s2">method</span><span class="s4">.</span><span class="s2">toLowerCase</span><span class="s4">() === </span><span class="s5">&quot;get&quot; </span><span class="s4">? </span><span class="s5">&quot;get&quot; </span><span class="s4">: </span><span class="s5">&quot;post&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">isAbsolute </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">action </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">ABSOLUTE_URL_REGEX2</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">action</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">submitHandler </span><span class="s4">= (</span><span class="s2">event</span><span class="s4">) =&gt; {</span>
      <span class="s2">onSubmit </span><span class="s4">&amp;&amp; </span><span class="s2">onSubmit</span><span class="s4">(</span><span class="s2">event</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">event</span><span class="s4">.</span><span class="s2">defaultPrevented</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
      <span class="s2">event</span><span class="s4">.</span><span class="s2">preventDefault</span><span class="s4">();</span>
      <span class="s3">let </span><span class="s2">submitter </span><span class="s4">= </span><span class="s2">event</span><span class="s4">.</span><span class="s2">nativeEvent</span><span class="s4">.</span><span class="s2">submitter</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">submitMethod </span><span class="s4">= </span><span class="s2">submitter</span><span class="s4">?.</span><span class="s2">getAttribute</span><span class="s4">(</span><span class="s5">&quot;formmethod&quot;</span><span class="s4">) || </span><span class="s2">method</span><span class="s4">;</span>
      <span class="s2">submit</span><span class="s4">(</span><span class="s2">submitter </span><span class="s4">|| </span><span class="s2">event</span><span class="s4">.</span><span class="s2">currentTarget</span><span class="s4">, {</span>
        <span class="s2">fetcherKey</span><span class="s4">,</span>
        <span class="s2">method</span><span class="s4">: </span><span class="s2">submitMethod</span><span class="s4">,</span>
        <span class="s2">navigate</span><span class="s4">,</span>
        <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
        <span class="s2">state</span><span class="s4">,</span>
        <span class="s2">relative</span><span class="s4">,</span>
        <span class="s2">preventScrollReset</span><span class="s4">,</span>
        <span class="s2">viewTransition</span>
      <span class="s4">});</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s5">&quot;form&quot;</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">ref</span><span class="s4">: </span><span class="s2">forwardedRef</span><span class="s4">,</span>
        <span class="s2">method</span><span class="s4">: </span><span class="s2">formMethod</span><span class="s4">,</span>
        <span class="s2">action</span><span class="s4">: </span><span class="s2">formAction</span><span class="s4">,</span>
        <span class="s2">onSubmit</span><span class="s4">: </span><span class="s2">reloadDocument </span><span class="s4">? </span><span class="s2">onSubmit </span><span class="s4">: </span><span class="s2">submitHandler</span><span class="s4">,</span>
        <span class="s2">...props</span><span class="s4">,</span>
        <span class="s5">&quot;data-discover&quot;</span><span class="s4">: !</span><span class="s2">isAbsolute </span><span class="s4">&amp;&amp; </span><span class="s2">discover </span><span class="s4">=== </span><span class="s5">&quot;render&quot; </span><span class="s4">? </span><span class="s5">&quot;true&quot; </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">);</span>
<span class="s2">Form</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;Form&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">ScrollRestoration</span><span class="s4">({</span>
  <span class="s2">getKey</span><span class="s4">,</span>
  <span class="s2">storageKey</span><span class="s4">,</span>
  <span class="s2">...props</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">remixContext </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">FrameworkContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">useMatches</span><span class="s4">();</span>
  <span class="s2">useScrollRestoration</span><span class="s4">({ </span><span class="s2">getKey</span><span class="s4">, </span><span class="s2">storageKey </span><span class="s4">});</span>
  <span class="s3">let </span><span class="s2">ssrKey </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">remixContext </span><span class="s4">|| !</span><span class="s2">getKey</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">userKey </span><span class="s4">= </span><span class="s2">getScrollRestorationKey</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">basename</span><span class="s4">,</span>
        <span class="s2">getKey</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s2">userKey </span><span class="s4">!== </span><span class="s2">location</span><span class="s4">.</span><span class="s2">key </span><span class="s4">? </span><span class="s2">userKey </span><span class="s4">: </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s6">// Nah, we only need this the first time for the SSR render</span>
    <span class="s6">// eslint-disable-next-line react-hooks/exhaustive-deps</span>
    <span class="s4">[]</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">remixContext </span><span class="s4">|| </span><span class="s2">remixContext</span><span class="s4">.</span><span class="s2">isSpaMode</span><span class="s4">) {</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">restoreScroll </span><span class="s4">= ((</span><span class="s2">storageKey2</span><span class="s4">, </span><span class="s2">restoreKey</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">state </span><span class="s4">|| !</span><span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">key</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">Math</span><span class="s4">.</span><span class="s2">random</span><span class="s4">().</span><span class="s2">toString</span><span class="s4">(</span><span class="s7">32</span><span class="s4">).</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">2</span><span class="s4">);</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">replaceState</span><span class="s4">({ </span><span class="s2">key </span><span class="s4">}, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s2">positions </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">getItem</span><span class="s4">(</span><span class="s2">storageKey2</span><span class="s4">) || </span><span class="s5">&quot;{}&quot;</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">storedY </span><span class="s4">= </span><span class="s2">positions</span><span class="s4">[</span><span class="s2">restoreKey </span><span class="s4">|| </span><span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">key</span><span class="s4">];</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">storedY </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
        <span class="s2">window</span><span class="s4">.</span><span class="s2">scrollTo</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">storedY</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">removeItem</span><span class="s4">(</span><span class="s2">storageKey2</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}).</span><span class="s2">toString</span><span class="s4">();</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">...props</span><span class="s4">,</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: {</span>
        <span class="s2">__html</span><span class="s4">: </span><span class="s5">`(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">restoreScroll</span><span class="s4">}</span><span class="s5">)(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span>
          <span class="s2">storageKey </span><span class="s4">|| </span><span class="s2">SCROLL_RESTORATION_STORAGE_KEY</span>
        <span class="s4">)}</span><span class="s5">, </span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">ssrKey</span><span class="s4">)}</span><span class="s5">)`</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s2">ScrollRestoration</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;ScrollRestoration&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">getDataRouterConsoleError2</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s5">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">hookName</span><span class="s4">} </span><span class="s5">must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useDataRouterContext3</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">ctx </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">ctx</span><span class="s4">, </span><span class="s2">getDataRouterConsoleError2</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">ctx</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useDataRouterState2</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">state</span><span class="s4">, </span><span class="s2">getDataRouterConsoleError2</span><span class="s4">(</span><span class="s2">hookName</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">state</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useLinkClickHandler</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, {</span>
  <span class="s2">target</span><span class="s4">,</span>
  <span class="s2">replace</span><span class="s4">: </span><span class="s2">replaceProp</span><span class="s4">,</span>
  <span class="s2">state</span><span class="s4">,</span>
  <span class="s2">preventScrollReset</span><span class="s4">,</span>
  <span class="s2">relative</span><span class="s4">,</span>
  <span class="s2">viewTransition</span>
<span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s2">navigate </span><span class="s4">= </span><span class="s2">useNavigate</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">useResolvedPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">});</span>
  <span class="s3">return </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">event</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">shouldProcessLinkClick</span><span class="s4">(</span><span class="s2">event</span><span class="s4">, </span><span class="s2">target</span><span class="s4">)) {</span>
        <span class="s2">event</span><span class="s4">.</span><span class="s2">preventDefault</span><span class="s4">();</span>
        <span class="s3">let </span><span class="s2">replace2 </span><span class="s4">= </span><span class="s2">replaceProp </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">replaceProp </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">location</span><span class="s4">) === </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
        <span class="s2">navigate</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, {</span>
          <span class="s2">replace</span><span class="s4">: </span><span class="s2">replace2</span><span class="s4">,</span>
          <span class="s2">state</span><span class="s4">,</span>
          <span class="s2">preventScrollReset</span><span class="s4">,</span>
          <span class="s2">relative</span><span class="s4">,</span>
          <span class="s2">viewTransition</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s4">[</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigate</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">,</span>
      <span class="s2">replaceProp</span><span class="s4">,</span>
      <span class="s2">state</span><span class="s4">,</span>
      <span class="s2">target</span><span class="s4">,</span>
      <span class="s2">to</span><span class="s4">,</span>
      <span class="s2">preventScrollReset</span><span class="s4">,</span>
      <span class="s2">relative</span><span class="s4">,</span>
      <span class="s2">viewTransition</span>
    <span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useSearchParams</span><span class="s4">(</span><span class="s2">defaultInit</span><span class="s4">) {</span>
  <span class="s2">warning</span><span class="s4">(</span>
    <span class="s3">typeof </span><span class="s2">URLSearchParams </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">,</span>
    <span class="s5">`You cannot use the </span><span class="s3">\`</span><span class="s5">useSearchParams</span><span class="s3">\` </span><span class="s5">hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">defaultSearchParamsRef </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s2">createSearchParams</span><span class="s4">(</span><span class="s2">defaultInit</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">hasSetSearchParamsRef </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">(</span><span class="s3">false</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">searchParams </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; (</span>
      <span class="s6">// Only merge in the defaults if we haven't yet called setSearchParams.</span>
      <span class="s6">// Once we call that we want those to take precedence, otherwise you can't</span>
      <span class="s6">// remove a param with setSearchParams({}) if it has an initial value</span>
      <span class="s2">getSearchParamsForLocation</span><span class="s4">(</span>
        <span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">,</span>
        <span class="s2">hasSetSearchParamsRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">? </span><span class="s3">null </span><span class="s4">: </span><span class="s2">defaultSearchParamsRef</span><span class="s4">.</span><span class="s2">current</span>
      <span class="s4">)</span>
    <span class="s4">),</span>
    <span class="s4">[</span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">navigate </span><span class="s4">= </span><span class="s2">useNavigate</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">setSearchParams </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s4">(</span><span class="s2">nextInit</span><span class="s4">, </span><span class="s2">navigateOptions</span><span class="s4">) =&gt; {</span>
      <span class="s3">const </span><span class="s2">newSearchParams </span><span class="s4">= </span><span class="s2">createSearchParams</span><span class="s4">(</span>
        <span class="s3">typeof </span><span class="s2">nextInit </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">nextInit</span><span class="s4">(</span><span class="s2">searchParams</span><span class="s4">) : </span><span class="s2">nextInit</span>
      <span class="s4">);</span>
      <span class="s2">hasSetSearchParamsRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s2">navigate</span><span class="s4">(</span><span class="s5">&quot;?&quot; </span><span class="s4">+ </span><span class="s2">newSearchParams</span><span class="s4">, </span><span class="s2">navigateOptions</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">navigate</span><span class="s4">, </span><span class="s2">searchParams</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s4">[</span><span class="s2">searchParams</span><span class="s4">, </span><span class="s2">setSearchParams</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">fetcherId </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">getUniqueFetcherId </span><span class="s4">= () =&gt; </span><span class="s5">`__</span><span class="s2">$</span><span class="s4">{</span><span class="s2">String</span><span class="s4">(++</span><span class="s2">fetcherId</span><span class="s4">)}</span><span class="s5">__`</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">useSubmit</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router </span><span class="s4">} = </span><span class="s2">useDataRouterContext3</span><span class="s4">(</span><span class="s5">&quot;useSubmit&quot; </span><span class="s6">/* UseSubmit */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">currentRouteId </span><span class="s4">= </span><span class="s2">useRouteId</span><span class="s4">();</span>
  <span class="s3">return </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s2">async </span><span class="s4">(</span><span class="s2">target</span><span class="s4">, </span><span class="s2">options </span><span class="s4">= {}) =&gt; {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">action</span><span class="s4">, </span><span class="s2">method</span><span class="s4">, </span><span class="s2">encType</span><span class="s4">, </span><span class="s2">formData</span><span class="s4">, </span><span class="s2">body </span><span class="s4">} = </span><span class="s2">getFormSubmissionInfo</span><span class="s4">(</span>
        <span class="s2">target</span><span class="s4">,</span>
        <span class="s2">basename</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">navigate </span><span class="s4">=== </span><span class="s3">false</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">fetcherKey </span><span class="s4">|| </span><span class="s2">getUniqueFetcherId</span><span class="s4">();</span>
        <span class="s3">await </span><span class="s2">router</span><span class="s4">.</span><span class="s2">fetch</span><span class="s4">(</span><span class="s2">key</span><span class="s4">, </span><span class="s2">currentRouteId</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">action </span><span class="s4">|| </span><span class="s2">action</span><span class="s4">, {</span>
          <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">preventScrollReset</span><span class="s4">,</span>
          <span class="s2">formData</span><span class="s4">,</span>
          <span class="s2">body</span><span class="s4">,</span>
          <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">method </span><span class="s4">|| </span><span class="s2">method</span><span class="s4">,</span>
          <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">encType </span><span class="s4">|| </span><span class="s2">encType</span><span class="s4">,</span>
          <span class="s2">flushSync</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">flushSync</span>
        <span class="s4">});</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">await </span><span class="s2">router</span><span class="s4">.</span><span class="s2">navigate</span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">action </span><span class="s4">|| </span><span class="s2">action</span><span class="s4">, {</span>
          <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">preventScrollReset</span><span class="s4">,</span>
          <span class="s2">formData</span><span class="s4">,</span>
          <span class="s2">body</span><span class="s4">,</span>
          <span class="s2">formMethod</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">method </span><span class="s4">|| </span><span class="s2">method</span><span class="s4">,</span>
          <span class="s2">formEncType</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">encType </span><span class="s4">|| </span><span class="s2">encType</span><span class="s4">,</span>
          <span class="s2">replace</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">,</span>
          <span class="s2">state</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">state</span><span class="s4">,</span>
          <span class="s2">fromRouteId</span><span class="s4">: </span><span class="s2">currentRouteId</span><span class="s4">,</span>
          <span class="s2">flushSync</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">flushSync</span><span class="s4">,</span>
          <span class="s2">viewTransition</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">viewTransition</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">router</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">currentRouteId</span><span class="s4">]</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useFormAction</span><span class="s4">(</span><span class="s2">action</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeContext </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">routeContext</span><span class="s4">, </span><span class="s5">&quot;useFormAction must be used inside a RouteContext&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">match</span><span class="s4">] = </span><span class="s2">routeContext</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(-</span><span class="s7">1</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= { </span><span class="s2">...useResolvedPath</span><span class="s4">(</span><span class="s2">action </span><span class="s4">? </span><span class="s2">action </span><span class="s4">: </span><span class="s5">&quot;.&quot;</span><span class="s4">, { </span><span class="s2">relative </span><span class="s4">}) };</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">action </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">search</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">params </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URLSearchParams</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">search</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">indexValues </span><span class="s4">= </span><span class="s2">params</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">hasNakedIndexParam </span><span class="s4">= </span><span class="s2">indexValues</span><span class="s4">.</span><span class="s2">some</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">v </span><span class="s4">=== </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">hasNakedIndexParam</span><span class="s4">) {</span>
      <span class="s2">params</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
      <span class="s2">indexValues</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">v</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">v</span><span class="s4">) =&gt; </span><span class="s2">params</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">, </span><span class="s2">v</span><span class="s4">));</span>
      <span class="s3">let </span><span class="s2">qs </span><span class="s4">= </span><span class="s2">params</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">();</span>
      <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">qs </span><span class="s4">? </span><span class="s5">`?</span><span class="s2">$</span><span class="s4">{</span><span class="s2">qs</span><span class="s4">}</span><span class="s5">` </span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">((!</span><span class="s2">action </span><span class="s4">|| </span><span class="s2">action </span><span class="s4">=== </span><span class="s5">&quot;.&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">search </span><span class="s4">? </span><span class="s2">path</span><span class="s4">.</span><span class="s2">search</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^\?/</span><span class="s4">, </span><span class="s5">&quot;?index&amp;&quot;</span><span class="s4">) : </span><span class="s5">&quot;?index&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
    <span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s5">&quot;/&quot; </span><span class="s4">? </span><span class="s2">basename </span><span class="s4">: </span><span class="s2">joinPaths</span><span class="s4">([</span><span class="s2">basename</span><span class="s4">, </span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">]);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useFetcher</span><span class="s4">({</span>
  <span class="s2">key</span>
<span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router </span><span class="s4">} = </span><span class="s2">useDataRouterContext3</span><span class="s4">(</span><span class="s5">&quot;useFetcher&quot; </span><span class="s6">/* UseFetcher */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState2</span><span class="s4">(</span><span class="s5">&quot;useFetcher&quot; </span><span class="s6">/* UseFetcher */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">fetcherData </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">FetchersContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">RouteContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">]?.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">fetcherData</span><span class="s4">, </span><span class="s5">`useFetcher must be used inside a FetchersContext`</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s5">`useFetcher must be used inside a RouteContext`</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">routeId </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s5">`useFetcher can only be used on routes that contain a unique &quot;id&quot;`</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">defaultKey </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useId</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s4">[</span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">setFetcherKey</span><span class="s4">] = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useState</span><span class="s4">(</span><span class="s2">key </span><span class="s4">|| </span><span class="s2">defaultKey</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">key </span><span class="s4">&amp;&amp; </span><span class="s2">key </span><span class="s4">!== </span><span class="s2">fetcherKey</span><span class="s4">) {</span>
    <span class="s2">setFetcherKey</span><span class="s4">(</span><span class="s2">key</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">router</span><span class="s4">.</span><span class="s2">getFetcher</span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; </span><span class="s2">router</span><span class="s4">.</span><span class="s2">deleteFetcher</span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">);</span>
  <span class="s4">}, [</span><span class="s2">router</span><span class="s4">, </span><span class="s2">fetcherKey</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">load </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s2">async </span><span class="s4">(</span><span class="s2">href2</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) =&gt; {</span>
      <span class="s2">invariant</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">, </span><span class="s5">&quot;No routeId available for fetcher.load()&quot;</span><span class="s4">);</span>
      <span class="s3">await </span><span class="s2">router</span><span class="s4">.</span><span class="s2">fetch</span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">href2</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">router</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">submitImpl </span><span class="s4">= </span><span class="s2">useSubmit</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">submit </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(</span>
    <span class="s2">async </span><span class="s4">(</span><span class="s2">target</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) =&gt; {</span>
      <span class="s3">await </span><span class="s2">submitImpl</span><span class="s4">(</span><span class="s2">target</span><span class="s4">, {</span>
        <span class="s2">...opts</span><span class="s4">,</span>
        <span class="s2">navigate</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">fetcherKey</span>
      <span class="s4">});</span>
    <span class="s4">},</span>
    <span class="s4">[</span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">submitImpl</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">FetcherForm </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">FetcherForm2 </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">forwardRef</span><span class="s4">(</span>
      <span class="s4">(</span><span class="s2">props</span><span class="s4">, </span><span class="s2">ref</span><span class="s4">) =&gt; {</span>
        <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">Form</span><span class="s4">, { </span><span class="s2">...props</span><span class="s4">, </span><span class="s2">navigate</span><span class="s4">: </span><span class="s3">false</span><span class="s4">, </span><span class="s2">fetcherKey</span><span class="s4">, </span><span class="s2">ref </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">);</span>
    <span class="s2">FetcherForm2</span><span class="s4">.</span><span class="s2">displayName </span><span class="s4">= </span><span class="s5">&quot;fetcher.Form&quot;</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">FetcherForm2</span><span class="s4">;</span>
  <span class="s4">}, [</span><span class="s2">fetcherKey</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">fetcher </span><span class="s4">= </span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">) || </span><span class="s2">IDLE_FETCHER</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">fetcherData</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">fetcherKey</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">fetcherWithComponents </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useMemo</span><span class="s4">(</span>
    <span class="s4">() =&gt; ({</span>
      <span class="s2">Form</span><span class="s4">: </span><span class="s2">FetcherForm</span><span class="s4">,</span>
      <span class="s2">submit</span><span class="s4">,</span>
      <span class="s2">load</span><span class="s4">,</span>
      <span class="s2">...fetcher</span><span class="s4">,</span>
      <span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span>
    <span class="s4">}),</span>
    <span class="s4">[</span><span class="s2">FetcherForm</span><span class="s4">, </span><span class="s2">submit</span><span class="s4">, </span><span class="s2">load</span><span class="s4">, </span><span class="s2">fetcher</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">]</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">fetcherWithComponents</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useFetchers</span><span class="s4">() {</span>
  <span class="s3">let </span><span class="s2">state </span><span class="s4">= </span><span class="s2">useDataRouterState2</span><span class="s4">(</span><span class="s5">&quot;useFetchers&quot; </span><span class="s6">/* UseFetchers */</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">state</span><span class="s4">.</span><span class="s2">fetchers</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">()).</span><span class="s2">map</span><span class="s4">(([</span><span class="s2">key</span><span class="s4">, </span><span class="s2">fetcher</span><span class="s4">]) =&gt; ({</span>
    <span class="s2">...fetcher</span><span class="s4">,</span>
    <span class="s2">key</span>
  <span class="s4">}));</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">SCROLL_RESTORATION_STORAGE_KEY </span><span class="s4">= </span><span class="s5">&quot;react-router-scroll-positions&quot;</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">savedScrollPositions </span><span class="s4">= {};</span>
<span class="s3">function </span><span class="s2">getScrollRestorationKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s3">null</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">getKey</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">basename </span><span class="s4">!== </span><span class="s5">&quot;/&quot;</span><span class="s4">) {</span>
      <span class="s2">key </span><span class="s4">= </span><span class="s2">getKey</span><span class="s4">(</span>
        <span class="s4">{</span>
          <span class="s2">...location</span><span class="s4">,</span>
          <span class="s2">pathname</span><span class="s4">: </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">location</span><span class="s4">.</span><span class="s2">pathname</span>
        <span class="s4">},</span>
        <span class="s2">matches</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">key </span><span class="s4">= </span><span class="s2">getKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">key </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
    <span class="s2">key </span><span class="s4">= </span><span class="s2">location</span><span class="s4">.</span><span class="s2">key</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">key</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useScrollRestoration</span><span class="s4">({</span>
  <span class="s2">getKey</span><span class="s4">,</span>
  <span class="s2">storageKey</span>
<span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">router </span><span class="s4">} = </span><span class="s2">useDataRouterContext3</span><span class="s4">(</span><span class="s5">&quot;useScrollRestoration&quot; </span><span class="s6">/* UseScrollRestoration */</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">restoreScrollPosition</span><span class="s4">, </span><span class="s2">preventScrollReset </span><span class="s4">} = </span><span class="s2">useDataRouterState2</span><span class="s4">(</span>
    <span class="s5">&quot;useScrollRestoration&quot; </span><span class="s6">/* UseScrollRestoration */</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">NavigationContext</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= </span><span class="s2">useLocation</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">useMatches</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">navigation </span><span class="s4">= </span><span class="s2">useNavigation</span><span class="s4">();</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">scrollRestoration </span><span class="s4">= </span><span class="s5">&quot;manual&quot;</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s4">() =&gt; {</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">scrollRestoration </span><span class="s4">= </span><span class="s5">&quot;auto&quot;</span><span class="s4">;</span>
    <span class="s4">};</span>
  <span class="s4">}, []);</span>
  <span class="s2">usePageHide</span><span class="s4">(</span>
    <span class="s2">React10</span><span class="s4">.</span><span class="s2">useCallback</span><span class="s4">(() =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;idle&quot;</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s2">getScrollRestorationKey</span><span class="s4">(</span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">);</span>
        <span class="s2">savedScrollPositions</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">window</span><span class="s4">.</span><span class="s2">scrollY</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">setItem</span><span class="s4">(</span>
          <span class="s2">storageKey </span><span class="s4">|| </span><span class="s2">SCROLL_RESTORATION_STORAGE_KEY</span><span class="s4">,</span>
          <span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">savedScrollPositions</span><span class="s4">)</span>
        <span class="s4">);</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
        <span class="s2">warning</span><span class="s4">(</span>
          <span class="s3">false</span><span class="s4">,</span>
          <span class="s5">`Failed to save scroll positions in sessionStorage, &lt;ScrollRestoration /&gt; will not work properly (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">}</span><span class="s5">).`</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">history</span><span class="s4">.</span><span class="s2">scrollRestoration </span><span class="s4">= </span><span class="s5">&quot;auto&quot;</span><span class="s4">;</span>
    <span class="s4">}, [</span><span class="s2">navigation</span><span class="s4">.</span><span class="s2">state</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">, </span><span class="s2">storageKey</span><span class="s4">])</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">document </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; {</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">sessionPositions </span><span class="s4">= </span><span class="s2">sessionStorage</span><span class="s4">.</span><span class="s2">getItem</span><span class="s4">(</span>
          <span class="s2">storageKey </span><span class="s4">|| </span><span class="s2">SCROLL_RESTORATION_STORAGE_KEY</span>
        <span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">sessionPositions</span><span class="s4">) {</span>
          <span class="s2">savedScrollPositions </span><span class="s4">= </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">sessionPositions</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
      <span class="s4">}</span>
    <span class="s4">}, [</span><span class="s2">storageKey</span><span class="s4">]);</span>
    <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; {</span>
      <span class="s3">let </span><span class="s2">disableScrollRestoration </span><span class="s4">= </span><span class="s2">router</span><span class="s4">?.</span><span class="s2">enableScrollRestoration</span><span class="s4">(</span>
        <span class="s2">savedScrollPositions</span><span class="s4">,</span>
        <span class="s4">() =&gt; </span><span class="s2">window</span><span class="s4">.</span><span class="s2">scrollY</span><span class="s4">,</span>
        <span class="s2">getKey </span><span class="s4">? (</span><span class="s2">location2</span><span class="s4">, </span><span class="s2">matches2</span><span class="s4">) =&gt; </span><span class="s2">getScrollRestorationKey</span><span class="s4">(</span><span class="s2">location2</span><span class="s4">, </span><span class="s2">matches2</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">);</span>
      <span class="s3">return </span><span class="s4">() =&gt; </span><span class="s2">disableScrollRestoration </span><span class="s4">&amp;&amp; </span><span class="s2">disableScrollRestoration</span><span class="s4">();</span>
    <span class="s4">}, [</span><span class="s2">router</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">getKey</span><span class="s4">]);</span>
    <span class="s2">React10</span><span class="s4">.</span><span class="s2">useLayoutEffect</span><span class="s4">(() =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">restoreScrollPosition </span><span class="s4">=== </span><span class="s3">false</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">restoreScrollPosition </span><span class="s4">=== </span><span class="s5">&quot;number&quot;</span><span class="s4">) {</span>
        <span class="s2">window</span><span class="s4">.</span><span class="s2">scrollTo</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">restoreScrollPosition</span><span class="s4">);</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">el </span><span class="s4">= </span><span class="s2">document</span><span class="s4">.</span><span class="s2">getElementById</span><span class="s4">(</span>
          <span class="s2">decodeURIComponent</span><span class="s4">(</span><span class="s2">location</span><span class="s4">.</span><span class="s2">hash</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">))</span>
        <span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">el</span><span class="s4">) {</span>
          <span class="s2">el</span><span class="s4">.</span><span class="s2">scrollIntoView</span><span class="s4">();</span>
          <span class="s3">return</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">preventScrollReset </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">) {</span>
        <span class="s3">return</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">scrollTo</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s7">0</span><span class="s4">);</span>
    <span class="s4">}, [</span><span class="s2">location</span><span class="s4">, </span><span class="s2">restoreScrollPosition</span><span class="s4">, </span><span class="s2">preventScrollReset</span><span class="s4">]);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useBeforeUnload</span><span class="s4">(</span><span class="s2">callback</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">capture </span><span class="s4">} = </span><span class="s2">options </span><span class="s4">|| {};</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">opts </span><span class="s4">= </span><span class="s2">capture </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? { </span><span class="s2">capture </span><span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;beforeunload&quot;</span><span class="s4">, </span><span class="s2">callback</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; {</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span><span class="s5">&quot;beforeunload&quot;</span><span class="s4">, </span><span class="s2">callback</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s4">};</span>
  <span class="s4">}, [</span><span class="s2">callback</span><span class="s4">, </span><span class="s2">capture</span><span class="s4">]);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">usePageHide</span><span class="s4">(</span><span class="s2">callback</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">capture </span><span class="s4">} = </span><span class="s2">options </span><span class="s4">|| {};</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">let </span><span class="s2">opts </span><span class="s4">= </span><span class="s2">capture </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? { </span><span class="s2">capture </span><span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s2">window</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;pagehide&quot;</span><span class="s4">, </span><span class="s2">callback</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s4">() =&gt; {</span>
      <span class="s2">window</span><span class="s4">.</span><span class="s2">removeEventListener</span><span class="s4">(</span><span class="s5">&quot;pagehide&quot;</span><span class="s4">, </span><span class="s2">callback</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">);</span>
    <span class="s4">};</span>
  <span class="s4">}, [</span><span class="s2">callback</span><span class="s4">, </span><span class="s2">capture</span><span class="s4">]);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">usePrompt</span><span class="s4">({</span>
  <span class="s2">when</span><span class="s4">,</span>
  <span class="s2">message</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">blocker </span><span class="s4">= </span><span class="s2">useBlocker</span><span class="s4">(</span><span class="s2">when</span><span class="s4">);</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">proceed </span><span class="s4">= </span><span class="s2">window</span><span class="s4">.</span><span class="s2">confirm</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">proceed</span><span class="s4">) {</span>
        <span class="s2">setTimeout</span><span class="s4">(</span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">proceed</span><span class="s4">, </span><span class="s7">0</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">blocker</span><span class="s4">.</span><span class="s2">reset</span><span class="s4">();</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">blocker</span><span class="s4">, </span><span class="s2">message</span><span class="s4">]);</span>
  <span class="s2">React10</span><span class="s4">.</span><span class="s2">useEffect</span><span class="s4">(() =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">blocker</span><span class="s4">.</span><span class="s2">state </span><span class="s4">=== </span><span class="s5">&quot;blocked&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">when</span><span class="s4">) {</span>
      <span class="s2">blocker</span><span class="s4">.</span><span class="s2">reset</span><span class="s4">();</span>
    <span class="s4">}</span>
  <span class="s4">}, [</span><span class="s2">blocker</span><span class="s4">, </span><span class="s2">when</span><span class="s4">]);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">useViewTransitionState</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
  <span class="s3">let </span><span class="s2">vtContext </span><span class="s4">= </span><span class="s2">React10</span><span class="s4">.</span><span class="s2">useContext</span><span class="s4">(</span><span class="s2">ViewTransitionContext</span><span class="s4">);</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">vtContext </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s5">&quot;`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">basename </span><span class="s4">} = </span><span class="s2">useDataRouterContext3</span><span class="s4">(</span>
    <span class="s5">&quot;useViewTransitionState&quot; </span><span class="s6">/* useViewTransitionState */</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">path </span><span class="s4">= </span><span class="s2">useResolvedPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">, { </span><span class="s2">relative</span><span class="s4">: </span><span class="s2">opts</span><span class="s4">.</span><span class="s2">relative </span><span class="s4">});</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">isTransitioning</span><span class="s4">) {</span>
    <span class="s3">return false</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">currentPath </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">currentLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">nextPath </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">nextLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">vtContext</span><span class="s4">.</span><span class="s2">nextLocation</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">matchPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">nextPath</span><span class="s4">) != </span><span class="s3">null </span><span class="s4">|| </span><span class="s2">matchPath</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">currentPath</span><span class="s4">) != </span><span class="s3">null</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/server.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React11 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">StaticRouter</span><span class="s4">({</span>
  <span class="s2">basename</span><span class="s4">,</span>
  <span class="s2">children</span><span class="s4">,</span>
  <span class="s2">location</span><span class="s4">: </span><span class="s2">locationProp </span><span class="s4">= </span><span class="s5">&quot;/&quot;</span>
<span class="s4">}) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">locationProp </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
    <span class="s2">locationProp </span><span class="s4">= </span><span class="s2">parsePath</span><span class="s4">(</span><span class="s2">locationProp</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">action </span><span class="s4">= </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">location </span><span class="s4">= {</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
    <span class="s2">search</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">search </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">hash</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">hash </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
    <span class="s2">state</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">state </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">state </span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
    <span class="s2">key</span><span class="s4">: </span><span class="s2">locationProp</span><span class="s4">.</span><span class="s2">key </span><span class="s4">|| </span><span class="s5">&quot;default&quot;</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">staticNavigator </span><span class="s4">= </span><span class="s2">getStatelessNavigator</span><span class="s4">();</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">staticNavigator</span><span class="s4">,</span>
      <span class="s3">static</span><span class="s4">: </span><span class="s3">true</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">StaticRouterProvider</span><span class="s4">({</span>
  <span class="s2">context</span><span class="s4">,</span>
  <span class="s2">router</span><span class="s4">,</span>
  <span class="s2">hydrate</span><span class="s4">: </span><span class="s2">hydrate2 </span><span class="s4">= </span><span class="s3">true</span><span class="s4">,</span>
  <span class="s2">nonce</span>
<span class="s4">}) {</span>
  <span class="s2">invariant</span><span class="s4">(</span>
    <span class="s2">router </span><span class="s4">&amp;&amp; </span><span class="s2">context</span><span class="s4">,</span>
    <span class="s5">&quot;You must provide `router` and `context` to &lt;StaticRouterProvider&gt;&quot;</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">dataRouterContext </span><span class="s4">= {</span>
    <span class="s2">router</span><span class="s4">,</span>
    <span class="s2">navigator</span><span class="s4">: </span><span class="s2">getStatelessNavigator</span><span class="s4">(),</span>
    <span class="s3">static</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
    <span class="s2">staticContext</span><span class="s4">: </span><span class="s2">context</span><span class="s4">,</span>
    <span class="s2">basename</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">basename </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">fetchersContext </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">hydrateScript </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">hydrate2 </span><span class="s4">!== </span><span class="s3">false</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= {</span>
      <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">actionData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">,</span>
      <span class="s2">errors</span><span class="s4">: </span><span class="s2">serializeErrors</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">json </span><span class="s4">= </span><span class="s2">htmlEscape</span><span class="s4">(</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">)));</span>
    <span class="s2">hydrateScript </span><span class="s4">= </span><span class="s5">`window.__staticRouterHydrationData = JSON.parse(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">json</span><span class="s4">}</span><span class="s5">);`</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">state </span><span class="s4">} = </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">router</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React11</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">DataRouterContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">dataRouterContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">DataRouterStateContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">state </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">FetchersContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">fetchersContext </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">ViewTransitionContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: { </span><span class="s2">isTransitioning</span><span class="s4">: </span><span class="s3">false </span><span class="s4">} }, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">Router</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">basename</span><span class="s4">: </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">location</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
      <span class="s2">navigationType</span><span class="s4">: </span><span class="s2">state</span><span class="s4">.</span><span class="s2">historyAction</span><span class="s4">,</span>
      <span class="s2">navigator</span><span class="s4">: </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">navigator</span><span class="s4">,</span>
      <span class="s3">static</span><span class="s4">: </span><span class="s2">dataRouterContext</span><span class="s4">.</span><span class="s2">static</span>
    <span class="s4">},</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">DataRoutes2</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">routes</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">,</span>
        <span class="s2">future</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
        <span class="s2">state</span>
      <span class="s4">}</span>
    <span class="s4">)</span>
  <span class="s4">))))), </span><span class="s2">hydrateScript </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React11</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s5">&quot;script&quot;</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">suppressHydrationWarning</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">nonce</span><span class="s4">,</span>
      <span class="s2">dangerouslySetInnerHTML</span><span class="s4">: { </span><span class="s2">__html</span><span class="s4">: </span><span class="s2">hydrateScript </span><span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">) : </span><span class="s3">null</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">DataRoutes2</span><span class="s4">({</span>
  <span class="s2">routes</span><span class="s4">,</span>
  <span class="s2">future</span><span class="s4">,</span>
  <span class="s2">state</span>
<span class="s4">}) {</span>
  <span class="s3">return </span><span class="s2">useRoutesImpl</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s3">void </span><span class="s7">0</span><span class="s4">, </span><span class="s2">state</span><span class="s4">, </span><span class="s2">future</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">serializeErrors</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">errors</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">serialized </span><span class="s4">= {};</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">val</span><span class="s4">] </span><span class="s2">of entries</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">val</span><span class="s4">)) {</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = { </span><span class="s2">...val</span><span class="s4">, </span><span class="s2">__type</span><span class="s4">: </span><span class="s5">&quot;RouteErrorResponse&quot; </span><span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">val </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = {</span>
        <span class="s2">message</span><span class="s4">: </span><span class="s2">val</span><span class="s4">.</span><span class="s2">message</span><span class="s4">,</span>
        <span class="s2">__type</span><span class="s4">: </span><span class="s5">&quot;Error&quot;</span><span class="s4">,</span>
        <span class="s6">// If this is a subclass (i.e., ReferenceError), send up the type so we</span>
        <span class="s6">// can re-create the same type during hydration.</span>
        <span class="s2">...val</span><span class="s4">.</span><span class="s2">name </span><span class="s4">!== </span><span class="s5">&quot;Error&quot; </span><span class="s4">? {</span>
          <span class="s2">__subType</span><span class="s4">: </span><span class="s2">val</span><span class="s4">.</span><span class="s2">name</span>
        <span class="s4">} : {}</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">val</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">serialized</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getStatelessNavigator</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">createHref</span><span class="s4">,</span>
    <span class="s2">encodeLocation</span><span class="s4">,</span>
    <span class="s2">push</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`You cannot use navigator.push() on the server because it is a stateless environment. This error was probably triggered when you did a </span><span class="s3">\`</span><span class="s5">navigate(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">to</span><span class="s4">)}</span><span class="s5">)</span><span class="s3">\` </span><span class="s5">somewhere in your app.`</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">replace</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`You cannot use navigator.replace() on the server because it is a stateless environment. This error was probably triggered when you did a </span><span class="s3">\`</span><span class="s5">navigate(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">to</span><span class="s4">)}</span><span class="s5">, { replace: true })</span><span class="s3">\` </span><span class="s5">somewhere in your app.`</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">go</span><span class="s4">(</span><span class="s2">delta</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`You cannot use navigator.go() on the server because it is a stateless environment. This error was probably triggered when you did a </span><span class="s3">\`</span><span class="s5">navigate(</span><span class="s2">$</span><span class="s4">{</span><span class="s2">delta</span><span class="s4">}</span><span class="s5">)</span><span class="s3">\` </span><span class="s5">somewhere in your app.`</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">back</span><span class="s4">() {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`You cannot use navigator.back() on the server because it is a stateless environment.`</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">forward</span><span class="s4">() {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`You cannot use navigator.forward() on the server because it is a stateless environment.`</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createStaticHandler2</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">opts</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">createStaticHandler</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, {</span>
    <span class="s2">...opts</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createStaticRouter</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">context</span><span class="s4">, </span><span class="s2">opts </span><span class="s4">= {}) {</span>
  <span class="s3">let </span><span class="s2">manifest </span><span class="s4">= {};</span>
  <span class="s3">let </span><span class="s2">dataRoutes </span><span class="s4">= </span><span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">mapRouteProperties</span><span class="s4">,</span>
    <span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
    <span class="s2">manifest</span>
  <span class="s4">);</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] || </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s4">{</span>
      <span class="s2">...match</span><span class="s4">,</span>
      <span class="s2">route</span>
    <span class="s4">};</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">msg </span><span class="s4">= (</span><span class="s2">method</span><span class="s4">) =&gt; </span><span class="s5">`You cannot use router.</span><span class="s2">$</span><span class="s4">{</span><span class="s2">method</span><span class="s4">}</span><span class="s5">() on the server because it is a stateless environment`</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">get basename</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">context</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get future</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">...opts</span><span class="s4">?.</span><span class="s2">future</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">get state</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s4">{</span>
        <span class="s2">historyAction</span><span class="s4">: </span><span class="s5">&quot;POP&quot; </span><span class="s6">/* Pop */</span><span class="s4">,</span>
        <span class="s2">location</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">location</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">,</span>
        <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">,</span>
        <span class="s2">errors</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">,</span>
        <span class="s2">initialized</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
        <span class="s2">navigation</span><span class="s4">: </span><span class="s2">IDLE_NAVIGATION</span><span class="s4">,</span>
        <span class="s2">restoreScrollPosition</span><span class="s4">: </span><span class="s3">null</span><span class="s4">,</span>
        <span class="s2">preventScrollReset</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">revalidation</span><span class="s4">: </span><span class="s5">&quot;idle&quot;</span><span class="s4">,</span>
        <span class="s2">fetchers</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(),</span>
        <span class="s2">blockers</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">()</span>
      <span class="s4">};</span>
    <span class="s4">},</span>
    <span class="s2">get routes</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">dataRoutes</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get window</span><span class="s4">() {</span>
      <span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">initialize</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;initialize&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">subscribe</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;subscribe&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">enableScrollRestoration</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;enableScrollRestoration&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">navigate</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;navigate&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">fetch</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;fetch&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">revalidate</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;revalidate&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">createHref</span><span class="s4">,</span>
    <span class="s2">encodeLocation</span><span class="s4">,</span>
    <span class="s2">getFetcher</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">IDLE_FETCHER</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">deleteFetcher</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;deleteFetcher&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">dispose</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;dispose&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">getBlocker</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">IDLE_BLOCKER</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">deleteBlocker</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;deleteBlocker&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">patchRoutes</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;patchRoutes&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">_internalFetchControllers</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(),</span>
    <span class="s2">_internalSetRoutes</span><span class="s4">() {</span>
      <span class="s3">throw </span><span class="s2">msg</span><span class="s4">(</span><span class="s5">&quot;_internalSetRoutes&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createHref</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
  <span class="s3">return typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">encodeLocation</span><span class="s4">(</span><span class="s2">to</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">href2 </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">to </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">? </span><span class="s2">to </span><span class="s4">: </span><span class="s2">createPath</span><span class="s4">(</span><span class="s2">to</span><span class="s4">);</span>
  <span class="s2">href2 </span><span class="s4">= </span><span class="s2">href2</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/ $/</span><span class="s4">, </span><span class="s5">&quot;%20&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">encoded </span><span class="s4">= </span><span class="s2">ABSOLUTE_URL_REGEX3</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">href2</span><span class="s4">) ? </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">href2</span><span class="s4">) : </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">href2</span><span class="s4">, </span><span class="s5">&quot;http://localhost&quot;</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s2">encoded</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">search</span><span class="s4">: </span><span class="s2">encoded</span><span class="s4">.</span><span class="s2">search</span><span class="s4">,</span>
    <span class="s2">hash</span><span class="s4">: </span><span class="s2">encoded</span><span class="s4">.</span><span class="s2">hash</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">ABSOLUTE_URL_REGEX3 </span><span class="s4">= </span><span class="s8">/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i</span><span class="s4">;</span>
<span class="s3">var </span><span class="s2">ESCAPE_LOOKUP2 </span><span class="s4">= {</span>
  <span class="s5">&quot;&amp;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u0026&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&gt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003e&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&lt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003c&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2028</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2028&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2029</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2029&quot;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">ESCAPE_REGEX2 </span><span class="s4">= </span><span class="s8">/[&amp;&gt;&lt;\u2028\u2029]/g</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">htmlEscape</span><span class="s4">(</span><span class="s2">str</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">str</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">ESCAPE_REGEX2</span><span class="s4">, (</span><span class="s2">match</span><span class="s4">) =&gt; </span><span class="s2">ESCAPE_LOOKUP2</span><span class="s4">[</span><span class="s2">match</span><span class="s4">]);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/server.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React12 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">ServerRouter</span><span class="s4">({</span>
  <span class="s2">context</span><span class="s4">,</span>
  <span class="s2">url</span><span class="s4">,</span>
  <span class="s2">nonce</span>
<span class="s4">}) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">url </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
    <span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">url</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">criticalCss</span><span class="s4">, </span><span class="s2">serverHandoffString </span><span class="s4">} = </span><span class="s2">context</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">routes </span><span class="s4">= </span><span class="s2">createServerRoutes</span><span class="s4">(</span>
    <span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">routeModules</span><span class="s4">,</span>
    <span class="s2">context</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
    <span class="s2">context</span><span class="s4">.</span><span class="s2">isSpaMode</span>
  <span class="s4">);</span>
  <span class="s2">context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">= {</span>
    <span class="s2">...context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">.</span><span class="s2">loaderData</span>
  <span class="s4">};</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">routeModules</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s3">let </span><span class="s2">manifestRoute </span><span class="s4">= </span><span class="s2">context</span><span class="s4">.</span><span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route </span><span class="s4">&amp;&amp; </span><span class="s2">manifestRoute </span><span class="s4">&amp;&amp; </span><span class="s2">shouldHydrateRouteLoader</span><span class="s4">(</span>
      <span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">route</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">,</span>
      <span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">,</span>
      <span class="s2">context</span><span class="s4">.</span><span class="s2">isSpaMode</span>
    <span class="s4">) &amp;&amp; (</span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback </span><span class="s4">|| !</span><span class="s2">manifestRoute</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">)) {</span>
      <span class="s3">delete </span><span class="s2">context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">router </span><span class="s4">= </span><span class="s2">createStaticRouter</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React12</span><span class="s4">.</span><span class="s2">Fragment</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">FrameworkContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">value</span><span class="s4">: {</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">routeModules</span><span class="s4">,</span>
        <span class="s2">criticalCss</span><span class="s4">,</span>
        <span class="s2">serverHandoffString</span><span class="s4">,</span>
        <span class="s2">future</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
        <span class="s2">ssr</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">ssr</span><span class="s4">,</span>
        <span class="s2">isSpaMode</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">isSpaMode</span><span class="s4">,</span>
        <span class="s2">routeDiscovery</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">routeDiscovery</span><span class="s4">,</span>
        <span class="s2">serializeError</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">serializeError</span><span class="s4">,</span>
        <span class="s2">renderMeta</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">renderMeta</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">RemixErrorBoundary</span><span class="s4">, { </span><span class="s2">location</span><span class="s4">: </span><span class="s2">router</span><span class="s4">.</span><span class="s2">state</span><span class="s4">.</span><span class="s2">location </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
      <span class="s2">StaticRouterProvider</span><span class="s4">,</span>
      <span class="s4">{</span>
        <span class="s2">router</span><span class="s4">,</span>
        <span class="s2">context</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">staticHandlerContext</span><span class="s4">,</span>
        <span class="s2">hydrate</span><span class="s4">: </span><span class="s3">false</span>
      <span class="s4">}</span>
    <span class="s4">))</span>
  <span class="s4">), </span><span class="s2">context</span><span class="s4">.</span><span class="s2">serverHandoffStream </span><span class="s4">? </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">React12</span><span class="s4">.</span><span class="s2">Suspense</span><span class="s4">, </span><span class="s3">null</span><span class="s4">, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React12</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span>
    <span class="s2">StreamTransfer</span><span class="s4">,</span>
    <span class="s4">{</span>
      <span class="s2">context</span><span class="s4">,</span>
      <span class="s2">identifier</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">reader</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">serverHandoffStream</span><span class="s4">.</span><span class="s2">getReader</span><span class="s4">(),</span>
      <span class="s2">textDecoder</span><span class="s4">: </span><span class="s3">new </span><span class="s2">TextDecoder</span><span class="s4">(),</span>
      <span class="s2">nonce</span>
    <span class="s4">}</span>
  <span class="s4">)) : </span><span class="s3">null</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/routes-test-stub.tsx</span>
<span class="s3">import </span><span class="s4">* as </span><span class="s2">React13 from </span><span class="s5">&quot;react&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">createRoutesStub</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">unstable_getContext</span><span class="s4">) {</span>
  <span class="s3">return function </span><span class="s2">RoutesTestStub</span><span class="s4">({</span>
    <span class="s2">initialEntries</span><span class="s4">,</span>
    <span class="s2">initialIndex</span><span class="s4">,</span>
    <span class="s2">hydrationData</span><span class="s4">,</span>
    <span class="s2">future</span>
  <span class="s4">}) {</span>
    <span class="s3">let </span><span class="s2">routerRef </span><span class="s4">= </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">remixContextRef </span><span class="s4">= </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">useRef</span><span class="s4">();</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routerRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s2">remixContextRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= {</span>
        <span class="s2">future</span><span class="s4">: {</span>
          <span class="s2">unstable_subResourceIntegrity</span><span class="s4">: </span><span class="s2">future</span><span class="s4">?.</span><span class="s2">unstable_subResourceIntegrity </span><span class="s4">=== </span><span class="s3">true</span><span class="s4">,</span>
          <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s2">future</span><span class="s4">?.</span><span class="s2">unstable_middleware </span><span class="s4">=== </span><span class="s3">true</span>
        <span class="s4">},</span>
        <span class="s2">manifest</span><span class="s4">: {</span>
          <span class="s2">routes</span><span class="s4">: {},</span>
          <span class="s2">entry</span><span class="s4">: { </span><span class="s2">imports</span><span class="s4">: [], </span><span class="s2">module</span><span class="s4">: </span><span class="s5">&quot;&quot; </span><span class="s4">},</span>
          <span class="s2">url</span><span class="s4">: </span><span class="s5">&quot;&quot;</span><span class="s4">,</span>
          <span class="s2">version</span><span class="s4">: </span><span class="s5">&quot;&quot;</span>
        <span class="s4">},</span>
        <span class="s2">routeModules</span><span class="s4">: {},</span>
        <span class="s2">ssr</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">isSpaMode</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
        <span class="s2">routeDiscovery</span><span class="s4">: { </span><span class="s2">mode</span><span class="s4">: </span><span class="s5">&quot;lazy&quot;</span><span class="s4">, </span><span class="s2">manifestPath</span><span class="s4">: </span><span class="s5">&quot;/__manifest&quot; </span><span class="s4">}</span>
      <span class="s4">};</span>
      <span class="s3">let </span><span class="s2">patched </span><span class="s4">= </span><span class="s2">processRoutes</span><span class="s4">(</span>
        <span class="s6">// @ts-expect-error `StubRouteObject` is stricter about `loader`/`action`</span>
        <span class="s6">// types compared to `AgnosticRouteObject`</span>
        <span class="s2">convertRoutesToDataRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, (</span><span class="s2">r</span><span class="s4">) =&gt; </span><span class="s2">r</span><span class="s4">),</span>
        <span class="s2">remixContextRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">.</span><span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">remixContextRef</span><span class="s4">.</span><span class="s2">current</span><span class="s4">.</span><span class="s2">routeModules</span>
      <span class="s4">);</span>
      <span class="s2">routerRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">= </span><span class="s2">createMemoryRouter</span><span class="s4">(</span><span class="s2">patched</span><span class="s4">, {</span>
        <span class="s2">unstable_getContext</span><span class="s4">,</span>
        <span class="s2">initialEntries</span><span class="s4">,</span>
        <span class="s2">initialIndex</span><span class="s4">,</span>
        <span class="s2">hydrationData</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">FrameworkContext</span><span class="s4">.</span><span class="s2">Provider</span><span class="s4">, { </span><span class="s2">value</span><span class="s4">: </span><span class="s2">remixContextRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">}, </span><span class="s6">/* @__PURE__ */ </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">RouterProvider</span><span class="s4">, { </span><span class="s2">router</span><span class="s4">: </span><span class="s2">routerRef</span><span class="s4">.</span><span class="s2">current </span><span class="s4">}));</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">withComponentProps</span><span class="s4">(</span><span class="s2">Component4</span><span class="s4">) {</span>
  <span class="s3">return function </span><span class="s2">Wrapped</span><span class="s4">() {</span>
    <span class="s3">return </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">Component4</span><span class="s4">, {</span>
      <span class="s2">params</span><span class="s4">: </span><span class="s2">useParams</span><span class="s4">(),</span>
      <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">useLoaderData</span><span class="s4">(),</span>
      <span class="s2">actionData</span><span class="s4">: </span><span class="s2">useActionData</span><span class="s4">(),</span>
      <span class="s2">matches</span><span class="s4">: </span><span class="s2">useMatches</span><span class="s4">()</span>
    <span class="s4">});</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">withHydrateFallbackProps</span><span class="s4">(</span><span class="s2">HydrateFallback</span><span class="s4">) {</span>
  <span class="s3">return function </span><span class="s2">Wrapped</span><span class="s4">() {</span>
    <span class="s3">const </span><span class="s2">props </span><span class="s4">= {</span>
      <span class="s2">params</span><span class="s4">: </span><span class="s2">useParams</span><span class="s4">(),</span>
      <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">useLoaderData</span><span class="s4">(),</span>
      <span class="s2">actionData</span><span class="s4">: </span><span class="s2">useActionData</span><span class="s4">()</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">HydrateFallback</span><span class="s4">, </span><span class="s2">props</span><span class="s4">);</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">withErrorBoundaryProps</span><span class="s4">(</span><span class="s2">ErrorBoundary</span><span class="s4">) {</span>
  <span class="s3">return function </span><span class="s2">Wrapped</span><span class="s4">() {</span>
    <span class="s3">const </span><span class="s2">props </span><span class="s4">= {</span>
      <span class="s2">params</span><span class="s4">: </span><span class="s2">useParams</span><span class="s4">(),</span>
      <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">useLoaderData</span><span class="s4">(),</span>
      <span class="s2">actionData</span><span class="s4">: </span><span class="s2">useActionData</span><span class="s4">(),</span>
      <span class="s2">error</span><span class="s4">: </span><span class="s2">useRouteError</span><span class="s4">()</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">React13</span><span class="s4">.</span><span class="s2">createElement</span><span class="s4">(</span><span class="s2">ErrorBoundary</span><span class="s4">, </span><span class="s2">props</span><span class="s4">);</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">processRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">routeModules</span><span class="s4">, </span><span class="s2">parentId</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">routes</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) {</span>
      <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">&quot;Expected a route.id in @remix-run/testing processRoutes() function&quot;</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">newRoute </span><span class="s4">= {</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">Component</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">? </span><span class="s2">withComponentProps</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">Component</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">HydrateFallback</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback </span><span class="s4">? </span><span class="s2">withHydrateFallbackProps</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">HydrateFallback</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">? </span><span class="s2">withErrorBoundaryProps</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">action</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">action</span><span class="s4">,</span>
      <span class="s2">loader</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
      <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">entryRoute </span><span class="s4">= {</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index</span><span class="s4">,</span>
      <span class="s2">parentId</span><span class="s4">,</span>
      <span class="s2">hasAction</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">action </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">hasLoader</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s6">// When testing routes, you should be stubbing loader/action/middleware,</span>
      <span class="s6">// not trying to re-implement the full loader/clientLoader/SSR/hydration</span>
      <span class="s6">// flow. That is better tested via E2E tests.</span>
      <span class="s2">hasClientAction</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">hasClientLoader</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">hasClientMiddleware</span><span class="s4">: </span><span class="s3">false</span><span class="s4">,</span>
      <span class="s2">hasErrorBoundary</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s6">// any need for these?</span>
      <span class="s2">module</span><span class="s4">: </span><span class="s5">&quot;build/stub-path-to-module.js&quot;</span><span class="s4">,</span>
      <span class="s2">clientActionModule</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">clientLoaderModule</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">clientMiddlewareModule</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">hydrateFallbackModule</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">};</span>
    <span class="s2">manifest</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">entryRoute</span><span class="s4">;</span>
    <span class="s2">routeModules</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">] = {</span>
      <span class="s3">default</span><span class="s4">: </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">Component </span><span class="s4">|| </span><span class="s2">Outlet</span><span class="s4">,</span>
      <span class="s2">ErrorBoundary</span><span class="s4">: </span><span class="s2">newRoute</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">|| </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">handle</span><span class="s4">,</span>
      <span class="s2">links</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">links</span><span class="s4">,</span>
      <span class="s2">meta</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">,</span>
      <span class="s2">shouldRevalidate</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">shouldRevalidate</span>
    <span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">) {</span>
      <span class="s2">newRoute</span><span class="s4">.</span><span class="s2">children </span><span class="s4">= </span><span class="s2">processRoutes</span><span class="s4">(</span>
        <span class="s2">route</span><span class="s4">.</span><span class="s2">children</span><span class="s4">,</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">routeModules</span><span class="s4">,</span>
        <span class="s2">newRoute</span><span class="s4">.</span><span class="s2">id</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">newRoute</span><span class="s4">;</span>
  <span class="s4">});</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/cookies.ts</span>
<span class="s3">import </span><span class="s4">{ </span><span class="s2">parse</span><span class="s4">, </span><span class="s2">serialize </span><span class="s4">} </span><span class="s2">from </span><span class="s5">&quot;cookie&quot;</span><span class="s4">;</span>

<span class="s6">// lib/server-runtime/crypto.ts</span>
<span class="s3">var </span><span class="s2">encoder </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">TextEncoder</span><span class="s4">();</span>
<span class="s3">var </span><span class="s2">sign </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secret</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">encoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s3">await </span><span class="s2">createKey2</span><span class="s4">(</span><span class="s2">secret</span><span class="s4">, [</span><span class="s5">&quot;sign&quot;</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">signature </span><span class="s4">= </span><span class="s3">await </span><span class="s2">crypto</span><span class="s4">.</span><span class="s2">subtle</span><span class="s4">.</span><span class="s2">sign</span><span class="s4">(</span><span class="s5">&quot;HMAC&quot;</span><span class="s4">, </span><span class="s2">key</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">hash </span><span class="s4">= </span><span class="s2">btoa</span><span class="s4">(</span><span class="s2">String</span><span class="s4">.</span><span class="s2">fromCharCode</span><span class="s4">(</span><span class="s2">...</span><span class="s3">new </span><span class="s2">Uint8Array</span><span class="s4">(</span><span class="s2">signature</span><span class="s4">))).</span><span class="s2">replace</span><span class="s4">(</span>
    <span class="s8">/=+$/</span><span class="s4">,</span>
    <span class="s5">&quot;&quot;</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">value </span><span class="s4">+ </span><span class="s5">&quot;.&quot; </span><span class="s4">+ </span><span class="s2">hash</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">unsign </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">cookie</span><span class="s4">, </span><span class="s2">secret</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">index </span><span class="s4">= </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">lastIndexOf</span><span class="s4">(</span><span class="s5">&quot;.&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">index</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">hash </span><span class="s4">= </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">index </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">encoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">key </span><span class="s4">= </span><span class="s3">await </span><span class="s2">createKey2</span><span class="s4">(</span><span class="s2">secret</span><span class="s4">, [</span><span class="s5">&quot;verify&quot;</span><span class="s4">]);</span>
  <span class="s3">let </span><span class="s2">signature </span><span class="s4">= </span><span class="s2">byteStringToUint8Array</span><span class="s4">(</span><span class="s2">atob</span><span class="s4">(</span><span class="s2">hash</span><span class="s4">));</span>
  <span class="s3">let </span><span class="s2">valid </span><span class="s4">= </span><span class="s3">await </span><span class="s2">crypto</span><span class="s4">.</span><span class="s2">subtle</span><span class="s4">.</span><span class="s2">verify</span><span class="s4">(</span><span class="s5">&quot;HMAC&quot;</span><span class="s4">, </span><span class="s2">key</span><span class="s4">, </span><span class="s2">signature</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">valid </span><span class="s4">? </span><span class="s2">value </span><span class="s4">: </span><span class="s3">false</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">createKey2 </span><span class="s4">= </span><span class="s2">async </span><span class="s4">(</span><span class="s2">secret</span><span class="s4">, </span><span class="s2">usages</span><span class="s4">) =&gt; </span><span class="s2">crypto</span><span class="s4">.</span><span class="s2">subtle</span><span class="s4">.</span><span class="s2">importKey</span><span class="s4">(</span>
  <span class="s5">&quot;raw&quot;</span><span class="s4">,</span>
  <span class="s2">encoder</span><span class="s4">.</span><span class="s2">encode</span><span class="s4">(</span><span class="s2">secret</span><span class="s4">),</span>
  <span class="s4">{ </span><span class="s2">name</span><span class="s4">: </span><span class="s5">&quot;HMAC&quot;</span><span class="s4">, </span><span class="s2">hash</span><span class="s4">: </span><span class="s5">&quot;SHA-256&quot; </span><span class="s4">},</span>
  <span class="s3">false</span><span class="s4">,</span>
  <span class="s2">usages</span>
<span class="s4">);</span>
<span class="s3">function </span><span class="s2">byteStringToUint8Array</span><span class="s4">(</span><span class="s2">byteString</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">array </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Uint8Array</span><span class="s4">(</span><span class="s2">byteString</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">byteString</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
    <span class="s2">array</span><span class="s4">[</span><span class="s2">i</span><span class="s4">] = </span><span class="s2">byteString</span><span class="s4">.</span><span class="s2">charCodeAt</span><span class="s4">(</span><span class="s2">i</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">array</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/cookies.ts</span>
<span class="s3">var </span><span class="s2">createCookie </span><span class="s4">= (</span><span class="s2">name</span><span class="s4">, </span><span class="s2">cookieOptions </span><span class="s4">= {}) =&gt; {</span>
  <span class="s3">let </span><span class="s4">{ </span><span class="s2">secrets </span><span class="s4">= [], </span><span class="s2">...options </span><span class="s4">} = {</span>
    <span class="s2">path</span><span class="s4">: </span><span class="s5">&quot;/&quot;</span><span class="s4">,</span>
    <span class="s2">sameSite</span><span class="s4">: </span><span class="s5">&quot;lax&quot;</span><span class="s4">,</span>
    <span class="s2">...cookieOptions</span>
  <span class="s4">};</span>
  <span class="s2">warnOnceAboutExpiresCookie</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">expires</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">get name</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">name</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get isSigned</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">secrets</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get expires</span><span class="s4">() {</span>
      <span class="s3">return typeof </span><span class="s2">options</span><span class="s4">.</span><span class="s2">maxAge </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">(</span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">() + </span><span class="s2">options</span><span class="s4">.</span><span class="s2">maxAge </span><span class="s4">* </span><span class="s7">1e3</span><span class="s4">) : </span><span class="s2">options</span><span class="s4">.</span><span class="s2">expires</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">async parse</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, </span><span class="s2">parseOptions</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">cookieHeader</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">cookies </span><span class="s4">= </span><span class="s2">parse</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, { </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">...parseOptions </span><span class="s4">});</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">name </span><span class="s3">in </span><span class="s2">cookies</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">cookies</span><span class="s4">[</span><span class="s2">name</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">value </span><span class="s4">!== </span><span class="s5">&quot;&quot;</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">decoded </span><span class="s4">= </span><span class="s3">await </span><span class="s2">decodeCookieValue</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secrets</span><span class="s4">);</span>
          <span class="s3">return </span><span class="s2">decoded</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s3">return </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">return null</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">},</span>
    <span class="s2">async serialize</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">serializeOptions</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">serialize</span><span class="s4">(</span>
        <span class="s2">name</span><span class="s4">,</span>
        <span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;&quot; </span><span class="s4">? </span><span class="s5">&quot;&quot; </span><span class="s4">: </span><span class="s3">await </span><span class="s2">encodeCookieValue</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secrets</span><span class="s4">),</span>
        <span class="s4">{</span>
          <span class="s2">...options</span><span class="s4">,</span>
          <span class="s2">...serializeOptions</span>
        <span class="s4">}</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">isCookie </span><span class="s4">= (</span><span class="s2">object</span><span class="s4">) =&gt; {</span>
  <span class="s3">return </span><span class="s2">object </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">name </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">isSigned </span><span class="s4">=== </span><span class="s5">&quot;boolean&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">parse </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">serialize </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">encodeCookieValue</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secrets</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">encoded </span><span class="s4">= </span><span class="s2">encodeData</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">secrets</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s2">encoded </span><span class="s4">= </span><span class="s3">await </span><span class="s2">sign</span><span class="s4">(</span><span class="s2">encoded</span><span class="s4">, </span><span class="s2">secrets</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">encoded</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">decodeCookieValue</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secrets</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">secrets</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">secret of secrets</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">unsignedValue </span><span class="s4">= </span><span class="s3">await </span><span class="s2">unsign</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">secret</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">unsignedValue </span><span class="s4">!== </span><span class="s3">false</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">decodeData</span><span class="s4">(</span><span class="s2">unsignedValue</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return null</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">decodeData</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">encodeData</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">btoa</span><span class="s4">(</span><span class="s2">myUnescape</span><span class="s4">(</span><span class="s2">encodeURIComponent</span><span class="s4">(</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">value</span><span class="s4">))));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">decodeData</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">return </span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">decodeURIComponent</span><span class="s4">(</span><span class="s2">myEscape</span><span class="s4">(</span><span class="s2">atob</span><span class="s4">(</span><span class="s2">value</span><span class="s4">))));</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">return </span><span class="s4">{};</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">myEscape</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">str </span><span class="s4">= </span><span class="s2">value</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">index </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">chr</span><span class="s4">, </span><span class="s2">code</span><span class="s4">;</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">index </span><span class="s4">&lt; </span><span class="s2">str</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) {</span>
    <span class="s2">chr </span><span class="s4">= </span><span class="s2">str</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">index</span><span class="s4">++);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s8">/[\w*+\-./@]/</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">chr</span><span class="s4">)) {</span>
      <span class="s2">result </span><span class="s4">+= </span><span class="s2">chr</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">code </span><span class="s4">= </span><span class="s2">chr</span><span class="s4">.</span><span class="s2">charCodeAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">code </span><span class="s4">&lt; </span><span class="s7">256</span><span class="s4">) {</span>
        <span class="s2">result </span><span class="s4">+= </span><span class="s5">&quot;%&quot; </span><span class="s4">+ </span><span class="s2">hex</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s7">2</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">result </span><span class="s4">+= </span><span class="s5">&quot;%u&quot; </span><span class="s4">+ </span><span class="s2">hex</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s7">4</span><span class="s4">).</span><span class="s2">toUpperCase</span><span class="s4">();</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">hex</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s2">length</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">code</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">(</span><span class="s7">16</span><span class="s4">);</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&lt; </span><span class="s2">length</span><span class="s4">) </span><span class="s2">result </span><span class="s4">= </span><span class="s5">&quot;0&quot; </span><span class="s4">+ </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">myUnescape</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">str </span><span class="s4">= </span><span class="s2">value</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">index </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">chr</span><span class="s4">, </span><span class="s2">part</span><span class="s4">;</span>
  <span class="s3">while </span><span class="s4">(</span><span class="s2">index </span><span class="s4">&lt; </span><span class="s2">str</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) {</span>
    <span class="s2">chr </span><span class="s4">= </span><span class="s2">str</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">index</span><span class="s4">++);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">chr </span><span class="s4">=== </span><span class="s5">&quot;%&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">str</span><span class="s4">.</span><span class="s2">charAt</span><span class="s4">(</span><span class="s2">index</span><span class="s4">) === </span><span class="s5">&quot;u&quot;</span><span class="s4">) {</span>
        <span class="s2">part </span><span class="s4">= </span><span class="s2">str</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">index </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">, </span><span class="s2">index </span><span class="s4">+ </span><span class="s7">5</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s8">/^[\da-f]{4}$/i</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">part</span><span class="s4">)) {</span>
          <span class="s2">result </span><span class="s4">+= </span><span class="s2">String</span><span class="s4">.</span><span class="s2">fromCharCode</span><span class="s4">(</span><span class="s2">parseInt</span><span class="s4">(</span><span class="s2">part</span><span class="s4">, </span><span class="s7">16</span><span class="s4">));</span>
          <span class="s2">index </span><span class="s4">+= </span><span class="s7">5</span><span class="s4">;</span>
          <span class="s3">continue</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">part </span><span class="s4">= </span><span class="s2">str</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">index</span><span class="s4">, </span><span class="s2">index </span><span class="s4">+ </span><span class="s7">2</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s8">/^[\da-f]{2}$/i</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">part</span><span class="s4">)) {</span>
          <span class="s2">result </span><span class="s4">+= </span><span class="s2">String</span><span class="s4">.</span><span class="s2">fromCharCode</span><span class="s4">(</span><span class="s2">parseInt</span><span class="s4">(</span><span class="s2">part</span><span class="s4">, </span><span class="s7">16</span><span class="s4">));</span>
          <span class="s2">index </span><span class="s4">+= </span><span class="s7">2</span><span class="s4">;</span>
          <span class="s3">continue</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s2">result </span><span class="s4">+= </span><span class="s2">chr</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">warnOnceAboutExpiresCookie</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">expires</span><span class="s4">) {</span>
  <span class="s2">warnOnce</span><span class="s4">(</span>
    <span class="s4">!</span><span class="s2">expires</span><span class="s4">,</span>
    <span class="s5">`The &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">}</span><span class="s5">&quot; cookie has an &quot;expires&quot; property set. This will cause the expires value to not be updated when the session is committed. Instead, you should set the expires value when serializing the cookie. You can use </span><span class="s3">\`</span><span class="s5">commitSession(session, { expires })</span><span class="s3">\` </span><span class="s5">if using a session storage object, or </span><span class="s3">\`</span><span class="s5">cookie.serialize(&quot;value&quot;, { expires })</span><span class="s3">\` </span><span class="s5">if you're using the cookie directly.`</span>
  <span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/entry.ts</span>
<span class="s3">function </span><span class="s2">createEntryRouteModules</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">memo2</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">manifest</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
      <span class="s2">memo2</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">memo2</span><span class="s4">;</span>
  <span class="s4">}, {});</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/mode.ts</span>
<span class="s3">var </span><span class="s2">ServerMode </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s4">((</span><span class="s2">ServerMode2</span><span class="s4">) =&gt; {</span>
  <span class="s2">ServerMode2</span><span class="s4">[</span><span class="s5">&quot;Development&quot;</span><span class="s4">] = </span><span class="s5">&quot;development&quot;</span><span class="s4">;</span>
  <span class="s2">ServerMode2</span><span class="s4">[</span><span class="s5">&quot;Production&quot;</span><span class="s4">] = </span><span class="s5">&quot;production&quot;</span><span class="s4">;</span>
  <span class="s2">ServerMode2</span><span class="s4">[</span><span class="s5">&quot;Test&quot;</span><span class="s4">] = </span><span class="s5">&quot;test&quot;</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">ServerMode2</span><span class="s4">;</span>
<span class="s4">})(</span><span class="s2">ServerMode </span><span class="s4">|| {});</span>
<span class="s3">function </span><span class="s2">isServerMode</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;development&quot; </span><span class="s6">/* Development */ </span><span class="s4">|| </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;production&quot; </span><span class="s6">/* Production */ </span><span class="s4">|| </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;test&quot; </span><span class="s6">/* Test */</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/errors.ts</span>
<span class="s3">function </span><span class="s2">sanitizeError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">Error </span><span class="s4">&amp;&amp; </span><span class="s2">serverMode </span><span class="s4">!== </span><span class="s5">&quot;development&quot; </span><span class="s6">/* Development */</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">sanitized </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Unexpected Server Error&quot;</span><span class="s4">);</span>
    <span class="s2">sanitized</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">return </span><span class="s2">sanitized</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">error</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">sanitizeErrors</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">acc</span><span class="s4">, [</span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">error</span><span class="s4">]) =&gt; {</span>
    <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">acc</span><span class="s4">, { [</span><span class="s2">routeId</span><span class="s4">]: </span><span class="s2">sanitizeError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) });</span>
  <span class="s4">}, {});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">serializeError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">sanitized </span><span class="s4">= </span><span class="s2">sanitizeError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">message</span><span class="s4">: </span><span class="s2">sanitized</span><span class="s4">.</span><span class="s2">message</span><span class="s4">,</span>
    <span class="s2">stack</span><span class="s4">: </span><span class="s2">sanitized</span><span class="s4">.</span><span class="s2">stack</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">serializeErrors2</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">errors</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">serialized </span><span class="s4">= {};</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">val</span><span class="s4">] </span><span class="s2">of entries</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">val</span><span class="s4">)) {</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = { </span><span class="s2">...val</span><span class="s4">, </span><span class="s2">__type</span><span class="s4">: </span><span class="s5">&quot;RouteErrorResponse&quot; </span><span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">val </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">sanitized </span><span class="s4">= </span><span class="s2">sanitizeError</span><span class="s4">(</span><span class="s2">val</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = {</span>
        <span class="s2">message</span><span class="s4">: </span><span class="s2">sanitized</span><span class="s4">.</span><span class="s2">message</span><span class="s4">,</span>
        <span class="s2">stack</span><span class="s4">: </span><span class="s2">sanitized</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">,</span>
        <span class="s2">__type</span><span class="s4">: </span><span class="s5">&quot;Error&quot;</span><span class="s4">,</span>
        <span class="s6">// If this is a subclass (i.e., ReferenceError), send up the type so we</span>
        <span class="s6">// can re-create the same type during hydration.  This will only apply</span>
        <span class="s6">// in dev mode since all production errors are sanitized to normal</span>
        <span class="s6">// Error instances</span>
        <span class="s2">...sanitized</span><span class="s4">.</span><span class="s2">name </span><span class="s4">!== </span><span class="s5">&quot;Error&quot; </span><span class="s4">? {</span>
          <span class="s2">__subType</span><span class="s4">: </span><span class="s2">sanitized</span><span class="s4">.</span><span class="s2">name</span>
        <span class="s4">} : {}</span>
      <span class="s4">};</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">val</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">serialized</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/routeMatching.ts</span>
<span class="s3">function </span><span class="s2">matchServerRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">pathname</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">basename</span>
  <span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">matches</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; ({</span>
    <span class="s2">params</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
    <span class="s2">pathname</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
    <span class="s2">route</span><span class="s4">: </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span>
  <span class="s4">}));</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/data.ts</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">callRouteHandler</span><span class="s4">(</span><span class="s2">handler</span><span class="s4">, </span><span class="s2">args</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handler</span><span class="s4">({</span>
    <span class="s2">request</span><span class="s4">: </span><span class="s2">stripRoutesParam</span><span class="s4">(</span><span class="s2">stripIndexParam2</span><span class="s4">(</span><span class="s2">args</span><span class="s4">.</span><span class="s2">request</span><span class="s4">)),</span>
    <span class="s2">params</span><span class="s4">: </span><span class="s2">args</span><span class="s4">.</span><span class="s2">params</span><span class="s4">,</span>
    <span class="s2">context</span><span class="s4">: </span><span class="s2">args</span><span class="s4">.</span><span class="s2">context</span>
  <span class="s4">});</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">isDataWithResponseInit</span><span class="s4">(</span><span class="s2">result</span><span class="s4">) &amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init </span><span class="s4">&amp;&amp; </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">.</span><span class="s2">status </span><span class="s4">&amp;&amp; </span><span class="s2">isRedirectStatusCode</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">.</span><span class="s2">status</span><span class="s4">)) {</span>
    <span class="s3">throw new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, </span><span class="s2">result</span><span class="s4">.</span><span class="s2">init</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stripIndexParam2</span><span class="s4">(</span><span class="s2">request</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">indexValues </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
  <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">indexValuesToKeep </span><span class="s4">= [];</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">indexValue of indexValues</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">indexValue</span><span class="s4">) {</span>
      <span class="s2">indexValuesToKeep</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">indexValue</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">toKeep of indexValuesToKeep</span><span class="s4">) {</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;index&quot;</span><span class="s4">, </span><span class="s2">toKeep</span><span class="s4">);</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">init </span><span class="s4">= {</span>
    <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
    <span class="s2">body</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">body</span><span class="s4">,</span>
    <span class="s2">headers</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
    <span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">init</span><span class="s4">.</span><span class="s2">body</span><span class="s4">) {</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">duplex </span><span class="s4">= </span><span class="s5">&quot;half&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">href</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">stripRoutesParam</span><span class="s4">(</span><span class="s2">request</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
  <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s5">&quot;_routes&quot;</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">init </span><span class="s4">= {</span>
    <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
    <span class="s2">body</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">body</span><span class="s4">,</span>
    <span class="s2">headers</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
    <span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
  <span class="s4">};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">init</span><span class="s4">.</span><span class="s2">body</span><span class="s4">) {</span>
    <span class="s2">init</span><span class="s4">.</span><span class="s2">duplex </span><span class="s4">= </span><span class="s5">&quot;half&quot;</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">href</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/invariant.ts</span>
<span class="s3">function </span><span class="s2">invariant3</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">message</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">=== </span><span class="s3">false </span><span class="s4">|| </span><span class="s2">value </span><span class="s4">=== </span><span class="s3">null </span><span class="s4">|| </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
      <span class="s5">&quot;The following error is a bug in React Router; please open an issue! https://github.com/remix-run/react-router/issues/new/choose&quot;</span>
    <span class="s4">);</span>
    <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/dev.ts</span>
<span class="s3">var </span><span class="s2">globalDevServerHooksKey </span><span class="s4">= </span><span class="s5">&quot;__reactRouterDevServerHooks&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">setDevServerHooks</span><span class="s4">(</span><span class="s2">devServerHooks</span><span class="s4">) {</span>
  <span class="s2">globalThis</span><span class="s4">[</span><span class="s2">globalDevServerHooksKey</span><span class="s4">] = </span><span class="s2">devServerHooks</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getDevServerHooks</span><span class="s4">() {</span>
  <span class="s3">return </span><span class="s2">globalThis</span><span class="s4">[</span><span class="s2">globalDevServerHooksKey</span><span class="s4">];</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getBuildTimeHeader</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">headerName</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">process </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot;</span><span class="s4">) {</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">process</span><span class="s4">.</span><span class="s2">env</span><span class="s4">?.</span><span class="s2">IS_RR_BUILD_REQUEST </span><span class="s4">=== </span><span class="s5">&quot;yes&quot;</span><span class="s4">) {</span>
        <span class="s3">return </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">headerName</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return null</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/routes.ts</span>
<span class="s3">function </span><span class="s2">groupRoutesByParentId2</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routes </span><span class="s4">= {};</span>
  <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">parentId </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">parentId </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">]) {</span>
        <span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] = [];</span>
      <span class="s4">}</span>
      <span class="s2">routes</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">].</span><span class="s2">push</span><span class="s4">(</span><span class="s2">route</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s2">routes</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createRoutes</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">parentId </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">routesByParentId </span><span class="s4">= </span><span class="s2">groupRoutesByParentId2</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">)) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">routesByParentId</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] || []).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; ({</span>
    <span class="s2">...route</span><span class="s4">,</span>
    <span class="s2">children</span><span class="s4">: </span><span class="s2">createRoutes</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">, </span><span class="s2">routesByParentId</span><span class="s4">)</span>
  <span class="s4">}));</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">createStaticHandlerDataRoutes</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">, </span><span class="s2">future</span><span class="s4">, </span><span class="s2">parentId </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">, </span><span class="s2">routesByParentId </span><span class="s4">= </span><span class="s2">groupRoutesByParentId2</span><span class="s4">(</span><span class="s2">manifest</span><span class="s4">)) {</span>
  <span class="s3">return </span><span class="s4">(</span><span class="s2">routesByParentId</span><span class="s4">[</span><span class="s2">parentId</span><span class="s4">] || []).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">route</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s2">commonRoute </span><span class="s4">= {</span>
      <span class="s6">// Always include root due to default boundaries</span>
      <span class="s2">hasErrorBoundary</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;root&quot; </span><span class="s4">|| </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">,</span>
      <span class="s2">id</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
      <span class="s2">path</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">path</span><span class="s4">,</span>
      <span class="s2">unstable_middleware</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">unstable_middleware</span><span class="s4">,</span>
      <span class="s6">// Need to use RR's version in the param typed here to permit the optional</span>
      <span class="s6">// context even though we know it'll always be provided in remix</span>
      <span class="s2">loader</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">? </span><span class="s2">async </span><span class="s4">(</span><span class="s2">args</span><span class="s4">) =&gt; {</span>
        <span class="s3">let </span><span class="s2">preRenderedData </span><span class="s4">= </span><span class="s2">getBuildTimeHeader</span><span class="s4">(</span>
          <span class="s2">args</span><span class="s4">.</span><span class="s2">request</span><span class="s4">,</span>
          <span class="s5">&quot;X-React-Router-Prerender-Data&quot;</span>
        <span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">preRenderedData </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">encoded </span><span class="s4">= </span><span class="s2">preRenderedData </span><span class="s4">? </span><span class="s2">decodeURI</span><span class="s4">(</span><span class="s2">preRenderedData</span><span class="s4">) : </span><span class="s2">preRenderedData</span><span class="s4">;</span>
          <span class="s2">invariant3</span><span class="s4">(</span><span class="s2">encoded</span><span class="s4">, </span><span class="s5">&quot;Missing prerendered data for route&quot;</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">uint8array </span><span class="s4">= </span><span class="s3">new </span><span class="s2">TextEncoder</span><span class="s4">().</span><span class="s2">encode</span><span class="s4">(</span><span class="s2">encoded</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">stream </span><span class="s4">= </span><span class="s3">new </span><span class="s2">ReadableStream</span><span class="s4">({</span>
            <span class="s2">start</span><span class="s4">(</span><span class="s2">controller</span><span class="s4">) {</span>
              <span class="s2">controller</span><span class="s4">.</span><span class="s2">enqueue</span><span class="s4">(</span><span class="s2">uint8array</span><span class="s4">);</span>
              <span class="s2">controller</span><span class="s4">.</span><span class="s2">close</span><span class="s4">();</span>
            <span class="s4">}</span>
          <span class="s4">});</span>
          <span class="s3">let </span><span class="s2">decoded </span><span class="s4">= </span><span class="s3">await </span><span class="s2">decodeViaTurboStream</span><span class="s4">(</span><span class="s2">stream</span><span class="s4">, </span><span class="s2">global</span><span class="s4">);</span>
          <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">decoded</span><span class="s4">.</span><span class="s2">value</span><span class="s4">;</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">data2 </span><span class="s4">&amp;&amp; </span><span class="s2">SingleFetchRedirectSymbol </span><span class="s3">in </span><span class="s2">data2</span><span class="s4">) {</span>
            <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">];</span>
            <span class="s3">let </span><span class="s2">init </span><span class="s4">= { </span><span class="s2">status</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">status </span><span class="s4">};</span>
            <span class="s3">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">reload</span><span class="s4">) {</span>
              <span class="s3">throw </span><span class="s2">redirectDocument</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">redirect</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">) {</span>
              <span class="s3">throw </span><span class="s2">replace</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">redirect</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
              <span class="s3">throw </span><span class="s2">redirect</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">redirect</span><span class="s4">, </span><span class="s2">init</span><span class="s4">);</span>
            <span class="s4">}</span>
          <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
            <span class="s2">invariant3</span><span class="s4">(</span>
              <span class="s2">data2 </span><span class="s4">&amp;&amp; </span><span class="s2">route</span><span class="s4">.</span><span class="s2">id </span><span class="s3">in </span><span class="s2">data2</span><span class="s4">,</span>
              <span class="s5">&quot;Unable to decode prerendered data&quot;</span>
            <span class="s4">);</span>
            <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">data2</span><span class="s4">[</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">];</span>
            <span class="s2">invariant3</span><span class="s4">(</span>
              <span class="s5">&quot;data&quot; </span><span class="s3">in </span><span class="s2">result</span><span class="s4">,</span>
              <span class="s5">&quot;Unable to process prerendered data&quot;</span>
            <span class="s4">);</span>
            <span class="s3">return </span><span class="s2">result</span><span class="s4">.</span><span class="s2">data</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s3">let </span><span class="s2">val </span><span class="s4">= </span><span class="s3">await </span><span class="s2">callRouteHandler</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">loader</span><span class="s4">, </span><span class="s2">args</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">val</span><span class="s4">;</span>
      <span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">action</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">action </span><span class="s4">? (</span><span class="s2">args</span><span class="s4">) =&gt; </span><span class="s2">callRouteHandler</span><span class="s4">(</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">action</span><span class="s4">, </span><span class="s2">args</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
      <span class="s2">handle</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">handle</span>
    <span class="s4">};</span>
    <span class="s3">return </span><span class="s2">route</span><span class="s4">.</span><span class="s2">index </span><span class="s4">? {</span>
      <span class="s2">index</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">...commonRoute</span>
    <span class="s4">} : {</span>
      <span class="s2">caseSensitive</span><span class="s4">: </span><span class="s2">route</span><span class="s4">.</span><span class="s2">caseSensitive</span><span class="s4">,</span>
      <span class="s2">children</span><span class="s4">: </span><span class="s2">createStaticHandlerDataRoutes</span><span class="s4">(</span>
        <span class="s2">manifest</span><span class="s4">,</span>
        <span class="s2">future</span><span class="s4">,</span>
        <span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
        <span class="s2">routesByParentId</span>
      <span class="s4">),</span>
      <span class="s2">...commonRoute</span>
    <span class="s4">};</span>
  <span class="s4">});</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/markup.ts</span>
<span class="s3">var </span><span class="s2">ESCAPE_LOOKUP3 </span><span class="s4">= {</span>
  <span class="s5">&quot;&amp;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u0026&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&gt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003e&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;&lt;&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u003c&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2028</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2028&quot;</span><span class="s4">,</span>
  <span class="s5">&quot;</span><span class="s3">\u2029</span><span class="s5">&quot;</span><span class="s4">: </span><span class="s5">&quot;</span><span class="s3">\\</span><span class="s5">u2029&quot;</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">ESCAPE_REGEX3 </span><span class="s4">= </span><span class="s8">/[&amp;&gt;&lt;\u2028\u2029]/g</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">escapeHtml2</span><span class="s4">(</span><span class="s2">html</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">html</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">ESCAPE_REGEX3</span><span class="s4">, (</span><span class="s2">match</span><span class="s4">) =&gt; </span><span class="s2">ESCAPE_LOOKUP3</span><span class="s4">[</span><span class="s2">match</span><span class="s4">]);</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/serverHandoff.ts</span>
<span class="s3">function </span><span class="s2">createServerHandoffString</span><span class="s4">(</span><span class="s2">serverHandoff</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">escapeHtml2</span><span class="s4">(</span><span class="s2">JSON</span><span class="s4">.</span><span class="s2">stringify</span><span class="s4">(</span><span class="s2">serverHandoff</span><span class="s4">));</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/headers.ts</span>
<span class="s3">import </span><span class="s4">{ </span><span class="s2">splitCookiesString </span><span class="s4">} </span><span class="s2">from </span><span class="s5">&quot;set-cookie-parser&quot;</span><span class="s4">;</span>
<span class="s3">function </span><span class="s2">getDocumentHeaders</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">context</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">boundaryIdx </span><span class="s4">= </span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">? </span><span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">findIndex</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">[</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">]) : -</span><span class="s7">1</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">boundaryIdx </span><span class="s4">&gt;= </span><span class="s7">0 </span><span class="s4">? </span><span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">boundaryIdx </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">) : </span><span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">errorHeaders</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">boundaryIdx </span><span class="s4">&gt;= </span><span class="s7">0</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">actionHeaders</span><span class="s4">, </span><span class="s2">actionData</span><span class="s4">, </span><span class="s2">loaderHeaders</span><span class="s4">, </span><span class="s2">loaderData </span><span class="s4">} = </span><span class="s2">context</span><span class="s4">;</span>
    <span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">boundaryIdx</span><span class="s4">).</span><span class="s2">some</span><span class="s4">((</span><span class="s2">match</span><span class="s4">) =&gt; {</span>
      <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">actionHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] &amp;&amp; (!</span><span class="s2">actionData </span><span class="s4">|| !</span><span class="s2">actionData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">id</span><span class="s4">))) {</span>
        <span class="s2">errorHeaders </span><span class="s4">= </span><span class="s2">actionHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">loaderHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] &amp;&amp; !</span><span class="s2">loaderData</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">id</span><span class="s4">)) {</span>
        <span class="s2">errorHeaders </span><span class="s4">= </span><span class="s2">loaderHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">];</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">errorHeaders </span><span class="s4">!= </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">parentHeaders</span><span class="s4">, </span><span class="s2">match</span><span class="s4">, </span><span class="s2">idx</span><span class="s4">) =&gt; {</span>
    <span class="s3">let </span><span class="s4">{ </span><span class="s2">id </span><span class="s4">} = </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">build</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">id</span><span class="s4">];</span>
    <span class="s2">invariant3</span><span class="s4">(</span><span class="s2">route</span><span class="s4">, </span><span class="s5">`Route with id &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">id</span><span class="s4">}</span><span class="s5">&quot; not found in build`</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">routeModule </span><span class="s4">= </span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">loaderHeaders </span><span class="s4">= </span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] || </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">actionHeaders </span><span class="s4">= </span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionHeaders</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] || </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">();</span>
    <span class="s3">let </span><span class="s2">includeErrorHeaders </span><span class="s4">= </span><span class="s2">errorHeaders </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">idx </span><span class="s4">=== </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">includeErrorCookies </span><span class="s4">= </span><span class="s2">includeErrorHeaders </span><span class="s4">&amp;&amp; </span><span class="s2">errorHeaders </span><span class="s4">!== </span><span class="s2">loaderHeaders </span><span class="s4">&amp;&amp; </span><span class="s2">errorHeaders </span><span class="s4">!== </span><span class="s2">actionHeaders</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">headers2 </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">parentHeaders</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">includeErrorCookies</span><span class="s4">) {</span>
        <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">errorHeaders</span><span class="s4">, </span><span class="s2">headers2</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">actionHeaders</span><span class="s4">, </span><span class="s2">headers2</span><span class="s4">);</span>
      <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">loaderHeaders</span><span class="s4">, </span><span class="s2">headers2</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">headers2</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span>
      <span class="s2">routeModule</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">? </span><span class="s3">typeof </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">({</span>
        <span class="s2">loaderHeaders</span><span class="s4">,</span>
        <span class="s2">parentHeaders</span><span class="s4">,</span>
        <span class="s2">actionHeaders</span><span class="s4">,</span>
        <span class="s2">errorHeaders</span><span class="s4">: </span><span class="s2">includeErrorHeaders </span><span class="s4">? </span><span class="s2">errorHeaders </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
      <span class="s4">}) : </span><span class="s2">routeModule</span><span class="s4">.</span><span class="s2">headers </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">includeErrorCookies</span><span class="s4">) {</span>
      <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">errorHeaders</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">actionHeaders</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">);</span>
    <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">loaderHeaders</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">);</span>
    <span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">parentHeaders</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">headers</span><span class="s4">;</span>
  <span class="s4">}, </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">());</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">prependCookies</span><span class="s4">(</span><span class="s2">parentHeaders</span><span class="s4">, </span><span class="s2">childHeaders</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">parentSetCookieString </span><span class="s4">= </span><span class="s2">parentHeaders</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Set-Cookie&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">parentSetCookieString</span><span class="s4">) {</span>
    <span class="s3">let </span><span class="s2">cookies </span><span class="s4">= </span><span class="s2">splitCookiesString</span><span class="s4">(</span><span class="s2">parentSetCookieString</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">childCookies </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">childHeaders</span><span class="s4">.</span><span class="s2">getSetCookie</span><span class="s4">());</span>
    <span class="s2">cookies</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">cookie</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">childCookies</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">cookie</span><span class="s4">)) {</span>
        <span class="s2">childHeaders</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s5">&quot;Set-Cookie&quot;</span><span class="s4">, </span><span class="s2">cookie</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/single-fetch.ts</span>
<span class="s3">var </span><span class="s2">SERVER_NO_BODY_STATUS_CODES </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">([</span>
  <span class="s2">...NO_BODY_STATUS_CODES</span><span class="s4">,</span>
  <span class="s7">304</span>
<span class="s4">]);</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">singleFetchAction</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, </span><span class="s2">staticHandler</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">handlerUrl</span><span class="s4">, </span><span class="s2">loadContext</span><span class="s4">, </span><span class="s2">handleError</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">respond2 </span><span class="s4">= </span><span class="s3">function</span><span class="s4">(</span><span class="s2">context</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s2">getDocumentHeaders</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">context</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectStatusCode</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">) &amp;&amp; </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
          <span class="s2">result</span><span class="s4">: </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span>
            <span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">,</span>
            <span class="s2">headers</span><span class="s4">,</span>
            <span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span>
          <span class="s4">),</span>
          <span class="s2">headers</span><span class="s4">,</span>
          <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">err</span><span class="s4">) =&gt; {</span>
          <span class="s3">if </span><span class="s4">(!</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">err</span><span class="s4">) || </span><span class="s2">err</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
            <span class="s2">handleError</span><span class="s4">(</span><span class="s2">err</span><span class="s4">);</span>
          <span class="s4">}</span>
        <span class="s4">});</span>
        <span class="s2">context</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">= </span><span class="s2">sanitizeErrors</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">singleFetchResult</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s2">singleFetchResult </span><span class="s4">= { </span><span class="s2">error</span><span class="s4">: </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">] };</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">singleFetchResult </span><span class="s4">= {</span>
          <span class="s2">data</span><span class="s4">: </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionData </span><span class="s4">|| {})[</span><span class="s7">0</span><span class="s4">]</span>
        <span class="s4">};</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
        <span class="s2">result</span><span class="s4">: </span><span class="s2">singleFetchResult</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span>
      <span class="s4">});</span>
    <span class="s4">};</span>
    <span class="s3">var </span><span class="s2">respond </span><span class="s4">= </span><span class="s2">respond2</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">handlerRequest </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">handlerUrl</span><span class="s4">, {</span>
      <span class="s2">method</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method</span><span class="s4">,</span>
      <span class="s2">body</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">body</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
      <span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
      <span class="s2">...request</span><span class="s4">.</span><span class="s2">body </span><span class="s4">? { </span><span class="s2">duplex</span><span class="s4">: </span><span class="s5">&quot;half&quot; </span><span class="s4">} : </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">staticHandler</span><span class="s4">.</span><span class="s2">query</span><span class="s4">(</span><span class="s2">handlerRequest</span><span class="s4">, {</span>
      <span class="s2">requestContext</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
      <span class="s2">skipLoaderErrorBubbling</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">skipRevalidation</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">respond2</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s2">result </span><span class="s4">= </span><span class="s2">respond2</span><span class="s4">(</span><span class="s2">result</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
        <span class="s2">result</span><span class="s4">: </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span>
          <span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
          <span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
          <span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span>
        <span class="s4">),</span>
        <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
      <span class="s2">result</span><span class="s4">: { </span><span class="s2">error </span><span class="s4">},</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(),</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s7">500</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">singleFetchLoaders</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, </span><span class="s2">staticHandler</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">handlerUrl</span><span class="s4">, </span><span class="s2">loadContext</span><span class="s4">, </span><span class="s2">handleError</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">respond2 </span><span class="s4">= </span><span class="s3">function</span><span class="s4">(</span><span class="s2">context</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s2">getDocumentHeaders</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">context</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectStatusCode</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">) &amp;&amp; </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">)) {</span>
        <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
          <span class="s2">result</span><span class="s4">: {</span>
            <span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">]: </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span>
              <span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">,</span>
              <span class="s2">headers</span><span class="s4">,</span>
              <span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span>
            <span class="s4">)</span>
          <span class="s4">},</span>
          <span class="s2">headers</span><span class="s4">,</span>
          <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span>
        <span class="s4">});</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">err</span><span class="s4">) =&gt; {</span>
          <span class="s3">if </span><span class="s4">(!</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">err</span><span class="s4">) || </span><span class="s2">err</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
            <span class="s2">handleError</span><span class="s4">(</span><span class="s2">err</span><span class="s4">);</span>
          <span class="s4">}</span>
        <span class="s4">});</span>
        <span class="s2">context</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">= </span><span class="s2">sanitizeErrors</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">results </span><span class="s4">= {};</span>
      <span class="s3">let </span><span class="s2">loadedMatches </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span>
        <span class="s2">context</span><span class="s4">.</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span>
          <span class="s4">(</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">loadRouteIds </span><span class="s4">? </span><span class="s2">loadRouteIds</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">) : </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">loader </span><span class="s4">!= </span><span class="s3">null</span>
        <span class="s4">).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">m</span><span class="s4">) =&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">)</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">id</span><span class="s4">, </span><span class="s2">error</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">)) {</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = { </span><span class="s2">error </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">id</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">)) {</span>
        <span class="s3">if </span><span class="s4">(!(</span><span class="s2">id </span><span class="s3">in </span><span class="s2">results</span><span class="s4">) &amp;&amp; </span><span class="s2">loadedMatches</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">id</span><span class="s4">)) {</span>
          <span class="s2">results</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = { </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">};</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
        <span class="s2">result</span><span class="s4">: </span><span class="s2">results</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span>
      <span class="s4">});</span>
    <span class="s4">};</span>
    <span class="s3">var </span><span class="s2">respond </span><span class="s4">= </span><span class="s2">respond2</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">handlerRequest </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Request</span><span class="s4">(</span><span class="s2">handlerUrl</span><span class="s4">, {</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
      <span class="s2">signal</span><span class="s4">: </span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span>
    <span class="s4">});</span>
    <span class="s3">let </span><span class="s2">routesParam </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">).</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;_routes&quot;</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">loadRouteIds </span><span class="s4">= </span><span class="s2">routesParam </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">routesParam</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;,&quot;</span><span class="s4">)) : </span><span class="s3">null</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s3">await </span><span class="s2">staticHandler</span><span class="s4">.</span><span class="s2">query</span><span class="s4">(</span><span class="s2">handlerRequest</span><span class="s4">, {</span>
      <span class="s2">requestContext</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
      <span class="s2">filterMatchesToLoad</span><span class="s4">: (</span><span class="s2">m</span><span class="s4">) =&gt; !</span><span class="s2">loadRouteIds </span><span class="s4">|| </span><span class="s2">loadRouteIds</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">m</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">),</span>
      <span class="s2">skipLoaderErrorBubbling</span><span class="s4">: </span><span class="s3">true</span><span class="s4">,</span>
      <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">respond2</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s2">result </span><span class="s4">= </span><span class="s2">respond2</span><span class="s4">(</span><span class="s2">result</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResponse</span><span class="s4">(</span><span class="s2">result</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
        <span class="s2">result</span><span class="s4">: {</span>
          <span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">]: </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span>
            <span class="s2">result</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
            <span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
            <span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span>
          <span class="s4">)</span>
        <span class="s4">},</span>
        <span class="s2">headers</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">result</span><span class="s4">;</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
      <span class="s2">result</span><span class="s4">: { </span><span class="s2">root</span><span class="s4">: { </span><span class="s2">error </span><span class="s4">} },</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(),</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s7">500</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">generateSingleFetchResponse</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">, {</span>
  <span class="s2">result</span><span class="s4">,</span>
  <span class="s2">headers</span><span class="s4">,</span>
  <span class="s2">status</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">resultHeaders </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">headers</span><span class="s4">);</span>
  <span class="s2">resultHeaders</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Response&quot;</span><span class="s4">, </span><span class="s5">&quot;yes&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">SERVER_NO_BODY_STATUS_CODES</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">status</span><span class="s4">)) {</span>
    <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, { </span><span class="s2">status</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">: </span><span class="s2">resultHeaders </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s2">resultHeaders</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">, </span><span class="s5">&quot;text/x-script&quot;</span><span class="s4">);</span>
  <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span>
    <span class="s2">encodeViaTurboStream</span><span class="s4">(</span>
      <span class="s2">result</span><span class="s4">,</span>
      <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
      <span class="s2">build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">streamTimeout</span><span class="s4">,</span>
      <span class="s2">serverMode</span>
    <span class="s4">),</span>
    <span class="s4">{</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s2">status </span><span class="s4">|| </span><span class="s7">200</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: </span><span class="s2">resultHeaders</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span><span class="s2">status</span><span class="s4">, </span><span class="s2">headers</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Location&quot;</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">basename</span><span class="s4">) {</span>
    <span class="s2">redirect2 </span><span class="s4">= </span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">redirect2</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">) || </span><span class="s2">redirect2</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">redirect</span><span class="s4">: </span><span class="s2">redirect2</span><span class="s4">,</span>
    <span class="s2">status</span><span class="s4">,</span>
    <span class="s2">revalidate</span><span class="s4">: (</span>
      <span class="s6">// Technically X-Remix-Revalidate isn't needed here - that was an implementation</span>
      <span class="s6">// detail of ?_data requests as our way to tell the front end to revalidate when</span>
      <span class="s6">// we didn't have a response body to include that information in.</span>
      <span class="s6">// With single fetch, we tell the front end via this revalidate boolean field.</span>
      <span class="s6">// However, we're respecting it for now because it may be something folks have</span>
      <span class="s6">// used in their own responses</span>
      <span class="s6">// TODO(v3): Consider removing or making this official public API</span>
      <span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Revalidate&quot;</span><span class="s4">) || </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;Set-Cookie&quot;</span><span class="s4">)</span>
    <span class="s4">),</span>
    <span class="s2">reload</span><span class="s4">: </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">),</span>
    <span class="s2">replace</span><span class="s4">: </span><span class="s2">headers</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Replace&quot;</span><span class="s4">)</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">encodeViaTurboStream</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">requestSignal</span><span class="s4">, </span><span class="s2">streamTimeout</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">controller </span><span class="s4">= </span><span class="s3">new </span><span class="s2">AbortController</span><span class="s4">();</span>
  <span class="s3">let </span><span class="s2">timeoutId </span><span class="s4">= </span><span class="s2">setTimeout</span><span class="s4">(</span>
    <span class="s4">() =&gt; </span><span class="s2">controller</span><span class="s4">.</span><span class="s2">abort</span><span class="s4">(</span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Server Timeout&quot;</span><span class="s4">)),</span>
    <span class="s3">typeof </span><span class="s2">streamTimeout </span><span class="s4">=== </span><span class="s5">&quot;number&quot; </span><span class="s4">? </span><span class="s2">streamTimeout </span><span class="s4">: </span><span class="s7">4950</span>
  <span class="s4">);</span>
  <span class="s2">requestSignal</span><span class="s4">.</span><span class="s2">addEventListener</span><span class="s4">(</span><span class="s5">&quot;abort&quot;</span><span class="s4">, () =&gt; </span><span class="s2">clearTimeout</span><span class="s4">(</span><span class="s2">timeoutId</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s2">encode</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, {</span>
    <span class="s2">signal</span><span class="s4">: </span><span class="s2">controller</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
    <span class="s2">plugins</span><span class="s4">: [</span>
      <span class="s4">(</span><span class="s2">value</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s3">instanceof </span><span class="s2">Error</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">name</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">stack </span><span class="s4">} = </span><span class="s2">serverMode </span><span class="s4">=== </span><span class="s5">&quot;production&quot; </span><span class="s6">/* Production */ </span><span class="s4">? </span><span class="s2">sanitizeError</span><span class="s4">(</span><span class="s2">value</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) : </span><span class="s2">value</span><span class="s4">;</span>
          <span class="s3">return </span><span class="s4">[</span><span class="s5">&quot;SanitizedError&quot;</span><span class="s4">, </span><span class="s2">name</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">stack</span><span class="s4">];</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s3">instanceof </span><span class="s2">ErrorResponseImpl</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data3</span><span class="s4">, </span><span class="s2">status</span><span class="s4">, </span><span class="s2">statusText </span><span class="s4">} = </span><span class="s2">value</span><span class="s4">;</span>
          <span class="s3">return </span><span class="s4">[</span><span class="s5">&quot;ErrorResponse&quot;</span><span class="s4">, </span><span class="s2">data3</span><span class="s4">, </span><span class="s2">status</span><span class="s4">, </span><span class="s2">statusText</span><span class="s4">];</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">=== </span><span class="s5">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">SingleFetchRedirectSymbol </span><span class="s3">in </span><span class="s2">value</span><span class="s4">) {</span>
          <span class="s3">return </span><span class="s4">[</span><span class="s5">&quot;SingleFetchRedirect&quot;</span><span class="s4">, </span><span class="s2">value</span><span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">]];</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">],</span>
    <span class="s2">postPlugins</span><span class="s4">: [</span>
      <span class="s4">(</span><span class="s2">value</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">value</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">value </span><span class="s4">!== </span><span class="s5">&quot;object&quot;</span><span class="s4">) </span><span class="s3">return</span><span class="s4">;</span>
        <span class="s3">return </span><span class="s4">[</span>
          <span class="s5">&quot;SingleFetchClassInstance&quot;</span><span class="s4">,</span>
          <span class="s2">Object</span><span class="s4">.</span><span class="s2">fromEntries</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">value</span><span class="s4">))</span>
        <span class="s4">];</span>
      <span class="s4">},</span>
      <span class="s4">() =&gt; [</span><span class="s5">&quot;SingleFetchFallback&quot;</span><span class="s4">]</span>
    <span class="s4">]</span>
  <span class="s4">});</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/server.ts</span>
<span class="s3">function </span><span class="s2">derive</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">mode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">routes </span><span class="s4">= </span><span class="s2">createRoutes</span><span class="s4">(</span><span class="s2">build</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">dataRoutes </span><span class="s4">= </span><span class="s2">createStaticHandlerDataRoutes</span><span class="s4">(</span><span class="s2">build</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">serverMode </span><span class="s4">= </span><span class="s2">isServerMode</span><span class="s4">(</span><span class="s2">mode</span><span class="s4">) ? </span><span class="s2">mode </span><span class="s4">: </span><span class="s5">&quot;production&quot; </span><span class="s6">/* Production */</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">staticHandler </span><span class="s4">= </span><span class="s2">createStaticHandler</span><span class="s4">(</span><span class="s2">dataRoutes</span><span class="s4">, {</span>
    <span class="s2">basename</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span>
  <span class="s4">});</span>
  <span class="s3">let </span><span class="s2">errorHandler </span><span class="s4">= </span><span class="s2">build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">handleError </span><span class="s4">|| ((</span><span class="s2">error</span><span class="s4">, { </span><span class="s2">request </span><span class="s4">}) =&gt; {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">serverMode </span><span class="s4">!== </span><span class="s5">&quot;test&quot; </span><span class="s6">/* Test */ </span><span class="s4">&amp;&amp; !</span><span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">.</span><span class="s2">aborted</span><span class="s4">) {</span>
      <span class="s2">console</span><span class="s4">.</span><span class="s2">error</span><span class="s4">(</span>
        <span class="s6">// @ts-expect-error This is &quot;private&quot; from users but intended for internal use</span>
        <span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">) &amp;&amp; </span><span class="s2">error</span><span class="s4">.</span><span class="s2">error </span><span class="s4">? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">error </span><span class="s4">: </span><span class="s2">error</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">routes</span><span class="s4">,</span>
    <span class="s2">dataRoutes</span><span class="s4">,</span>
    <span class="s2">serverMode</span><span class="s4">,</span>
    <span class="s2">staticHandler</span><span class="s4">,</span>
    <span class="s2">errorHandler</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">createRequestHandler </span><span class="s4">= (</span><span class="s2">build</span><span class="s4">, </span><span class="s2">mode</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">_build</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">routes</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">serverMode</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">staticHandler</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">errorHandler</span><span class="s4">;</span>
  <span class="s3">return </span><span class="s2">async </span><span class="s3">function </span><span class="s2">requestHandler</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s2">initialContext</span><span class="s4">) {</span>
    <span class="s2">_build </span><span class="s4">= </span><span class="s3">typeof </span><span class="s2">build </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">? </span><span class="s3">await </span><span class="s2">build</span><span class="s4">() : </span><span class="s2">build</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">build </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">derived </span><span class="s4">= </span><span class="s2">derive</span><span class="s4">(</span><span class="s2">_build</span><span class="s4">, </span><span class="s2">mode</span><span class="s4">);</span>
      <span class="s2">routes </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">;</span>
      <span class="s2">serverMode </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">serverMode</span><span class="s4">;</span>
      <span class="s2">staticHandler </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">staticHandler</span><span class="s4">;</span>
      <span class="s2">errorHandler </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">errorHandler</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">routes </span><span class="s4">|| !</span><span class="s2">serverMode </span><span class="s4">|| !</span><span class="s2">staticHandler </span><span class="s4">|| !</span><span class="s2">errorHandler</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">derived </span><span class="s4">= </span><span class="s2">derive</span><span class="s4">(</span><span class="s2">_build</span><span class="s4">, </span><span class="s2">mode</span><span class="s4">);</span>
      <span class="s2">routes </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">;</span>
      <span class="s2">serverMode </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">serverMode</span><span class="s4">;</span>
      <span class="s2">staticHandler </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">staticHandler</span><span class="s4">;</span>
      <span class="s2">errorHandler </span><span class="s4">= </span><span class="s2">derived</span><span class="s4">.</span><span class="s2">errorHandler</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">params </span><span class="s4">= {};</span>
    <span class="s3">let </span><span class="s2">loadContext</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">handleError </span><span class="s4">= (</span><span class="s2">error</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">mode </span><span class="s4">=== </span><span class="s5">&quot;development&quot; </span><span class="s6">/* Development */</span><span class="s4">) {</span>
        <span class="s2">getDevServerHooks</span><span class="s4">()?.</span><span class="s2">processRequestError</span><span class="s4">?.(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">errorHandler</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, {</span>
        <span class="s2">context</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
        <span class="s2">params</span><span class="s4">,</span>
        <span class="s2">request</span>
      <span class="s4">});</span>
    <span class="s4">};</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">.</span><span class="s2">unstable_middleware</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">initialContext </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s2">loadContext </span><span class="s4">= </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">();</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s2">loadContext </span><span class="s4">= </span><span class="s3">new </span><span class="s2">unstable_RouterContextProvider</span><span class="s4">(</span>
            <span class="s2">initialContext</span>
          <span class="s4">);</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span>
            <span class="s5">`Unable to create initial </span><span class="s3">\`</span><span class="s5">unstable_RouterContextProvider</span><span class="s3">\` </span><span class="s5">instance. Please confirm you are returning an instance of </span><span class="s3">\`</span><span class="s5">Map&lt;unstable_routerContext, unknown&gt;</span><span class="s3">\` </span><span class="s5">from your </span><span class="s3">\`</span><span class="s5">getLoadContext</span><span class="s3">\` </span><span class="s5">function. 
 
Error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">e </span><span class="s3">instanceof </span><span class="s2">Error </span><span class="s4">? </span><span class="s2">e</span><span class="s4">.</span><span class="s2">toString</span><span class="s4">() : </span><span class="s2">e</span><span class="s4">}</span><span class="s5">`</span>
          <span class="s4">);</span>
          <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
          <span class="s3">return </span><span class="s2">returnLastResortErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">loadContext </span><span class="s4">= </span><span class="s2">initialContext </span><span class="s4">|| {};</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">url </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
    <span class="s3">let </span><span class="s2">normalizedBasename </span><span class="s4">= </span><span class="s2">_build</span><span class="s4">.</span><span class="s2">basename </span><span class="s4">|| </span><span class="s5">&quot;/&quot;</span><span class="s4">;</span>
    <span class="s3">let </span><span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">normalizedPath</span><span class="s4">, </span><span class="s2">normalizedBasename</span><span class="s4">) === </span><span class="s5">&quot;/_root.data&quot;</span><span class="s4">) {</span>
      <span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">normalizedBasename</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">normalizedPath</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;.data&quot;</span><span class="s4">)) {</span>
      <span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">normalizedPath</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\.data$/</span><span class="s4">, </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">stripBasename</span><span class="s4">(</span><span class="s2">normalizedPath</span><span class="s4">, </span><span class="s2">normalizedBasename</span><span class="s4">) !== </span><span class="s5">&quot;/&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">normalizedPath</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">)) {</span>
      <span class="s2">normalizedPath </span><span class="s4">= </span><span class="s2">normalizedPath</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, -</span><span class="s7">1</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">isSpaMode </span><span class="s4">= </span><span class="s2">getBuildTimeHeader</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, </span><span class="s5">&quot;X-React-Router-SPA-Mode&quot;</span><span class="s4">) === </span><span class="s5">&quot;yes&quot;</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">ssr</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">prerender</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
        <span class="s2">isSpaMode </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">prerender</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s2">normalizedPath</span><span class="s4">) &amp;&amp; !</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">prerender</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s2">normalizedPath </span><span class="s4">+ </span><span class="s5">&quot;/&quot;</span><span class="s4">)) {</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;.data&quot;</span><span class="s4">)) {</span>
          <span class="s2">errorHandler</span><span class="s4">(</span>
            <span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
              <span class="s7">404</span><span class="s4">,</span>
              <span class="s5">&quot;Not Found&quot;</span><span class="s4">,</span>
              <span class="s5">`Refusing to SSR the path </span><span class="s3">\`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">normalizedPath</span><span class="s4">}</span><span class="s3">\` </span><span class="s5">because </span><span class="s3">\`</span><span class="s5">ssr:false</span><span class="s3">\` </span><span class="s5">is set and the path is not included in the </span><span class="s3">\`</span><span class="s5">prerender</span><span class="s3">\` </span><span class="s5">config, so in production the path will be a 404.`</span>
            <span class="s4">),</span>
            <span class="s4">{</span>
              <span class="s2">context</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
              <span class="s2">params</span><span class="s4">,</span>
              <span class="s2">request</span>
            <span class="s4">}</span>
          <span class="s4">);</span>
          <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s5">&quot;Not Found&quot;</span><span class="s4">, {</span>
            <span class="s2">status</span><span class="s4">: </span><span class="s7">404</span><span class="s4">,</span>
            <span class="s2">statusText</span><span class="s4">: </span><span class="s5">&quot;Not Found&quot;</span>
          <span class="s4">});</span>
        <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
          <span class="s2">isSpaMode </span><span class="s4">= </span><span class="s3">true</span><span class="s4">;</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">manifestUrl </span><span class="s4">= </span><span class="s2">getManifestPath</span><span class="s4">(</span>
      <span class="s2">_build</span><span class="s4">.</span><span class="s2">routeDiscovery</span><span class="s4">.</span><span class="s2">manifestPath</span><span class="s4">,</span>
      <span class="s2">normalizedBasename</span>
    <span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">=== </span><span class="s2">manifestUrl</span><span class="s4">) {</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">let </span><span class="s2">res </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handleManifestRequest</span><span class="s4">(</span><span class="s2">_build</span><span class="s4">, </span><span class="s2">routes</span><span class="s4">, </span><span class="s2">url</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">res</span><span class="s4">;</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s2">handleError</span><span class="s4">(</span><span class="s2">e</span><span class="s4">);</span>
        <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s5">&quot;Unknown Server Error&quot;</span><span class="s4">, { </span><span class="s2">status</span><span class="s4">: </span><span class="s7">500 </span><span class="s4">});</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchServerRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">normalizedPath</span><span class="s4">, </span><span class="s2">_build</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">params</span><span class="s4">, </span><span class="s2">matches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">response</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s5">&quot;.data&quot;</span><span class="s4">)) {</span>
      <span class="s3">let </span><span class="s2">handlerUrl </span><span class="s4">= </span><span class="s3">new </span><span class="s2">URL</span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">url</span><span class="s4">);</span>
      <span class="s2">handlerUrl</span><span class="s4">.</span><span class="s2">pathname </span><span class="s4">= </span><span class="s2">normalizedPath</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">singleFetchMatches </span><span class="s4">= </span><span class="s2">matchServerRoutes</span><span class="s4">(</span>
        <span class="s2">routes</span><span class="s4">,</span>
        <span class="s2">handlerUrl</span><span class="s4">.</span><span class="s2">pathname</span><span class="s4">,</span>
        <span class="s2">_build</span><span class="s4">.</span><span class="s2">basename</span>
      <span class="s4">);</span>
      <span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handleSingleFetchRequest</span><span class="s4">(</span>
        <span class="s2">serverMode</span><span class="s4">,</span>
        <span class="s2">_build</span><span class="s4">,</span>
        <span class="s2">staticHandler</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">handlerUrl</span><span class="s4">,</span>
        <span class="s2">loadContext</span><span class="s4">,</span>
        <span class="s2">handleError</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">handleDataRequest</span><span class="s4">) {</span>
        <span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">_build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">handleDataRequest</span><span class="s4">(</span><span class="s2">response</span><span class="s4">, {</span>
          <span class="s2">context</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
          <span class="s2">params</span><span class="s4">: </span><span class="s2">singleFetchMatches </span><span class="s4">? </span><span class="s2">singleFetchMatches</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">params </span><span class="s4">: {},</span>
          <span class="s2">request</span>
        <span class="s4">});</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">isRedirectResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">)) {</span>
          <span class="s3">let </span><span class="s2">result </span><span class="s4">= </span><span class="s2">getSingleFetchRedirect</span><span class="s4">(</span>
            <span class="s2">response</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
            <span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
            <span class="s2">_build</span><span class="s4">.</span><span class="s2">basename</span>
          <span class="s4">);</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">=== </span><span class="s5">&quot;GET&quot;</span><span class="s4">) {</span>
            <span class="s2">result </span><span class="s4">= {</span>
              <span class="s4">[</span><span class="s2">SingleFetchRedirectSymbol</span><span class="s4">]: </span><span class="s2">result</span>
            <span class="s4">};</span>
          <span class="s4">}</span>
          <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Headers</span><span class="s4">(</span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">);</span>
          <span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">, </span><span class="s5">&quot;text/x-script&quot;</span><span class="s4">);</span>
          <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span>
            <span class="s2">encodeViaTurboStream</span><span class="s4">(</span>
              <span class="s2">result</span><span class="s4">,</span>
              <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
              <span class="s2">_build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">streamTimeout</span><span class="s4">,</span>
              <span class="s2">serverMode</span>
            <span class="s4">),</span>
            <span class="s4">{</span>
              <span class="s2">status</span><span class="s4">: </span><span class="s2">SINGLE_FETCH_REDIRECT_STATUS</span><span class="s4">,</span>
              <span class="s2">headers</span>
            <span class="s4">}</span>
          <span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">isSpaMode </span><span class="s4">&amp;&amp; </span><span class="s2">matches </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">default </span><span class="s4">== </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s2">matches</span><span class="s4">[</span><span class="s2">matches</span><span class="s4">.</span><span class="s2">length </span><span class="s4">- </span><span class="s7">1</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">ErrorBoundary </span><span class="s4">== </span><span class="s3">null</span><span class="s4">) {</span>
      <span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handleResourceRequest</span><span class="s4">(</span>
        <span class="s2">serverMode</span><span class="s4">,</span>
        <span class="s2">_build</span><span class="s4">,</span>
        <span class="s2">staticHandler</span><span class="s4">,</span>
        <span class="s2">matches</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(-</span><span class="s7">1</span><span class="s4">)[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">loadContext</span><span class="s4">,</span>
        <span class="s2">handleError</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">pathname </span><span class="s4">} = </span><span class="s2">url</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">criticalCss </span><span class="s4">= </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">_build</span><span class="s4">.</span><span class="s2">unstable_getCriticalCss</span><span class="s4">) {</span>
        <span class="s2">criticalCss </span><span class="s4">= </span><span class="s3">await </span><span class="s2">_build</span><span class="s4">.</span><span class="s2">unstable_getCriticalCss</span><span class="s4">({ </span><span class="s2">pathname </span><span class="s4">});</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">mode </span><span class="s4">=== </span><span class="s5">&quot;development&quot; </span><span class="s6">/* Development */ </span><span class="s4">&amp;&amp; </span><span class="s2">getDevServerHooks</span><span class="s4">()?.</span><span class="s2">getCriticalCss</span><span class="s4">) {</span>
        <span class="s2">criticalCss </span><span class="s4">= </span><span class="s3">await </span><span class="s2">getDevServerHooks</span><span class="s4">()?.</span><span class="s2">getCriticalCss</span><span class="s4">?.(</span><span class="s2">pathname</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">handleDocumentRequest</span><span class="s4">(</span>
        <span class="s2">serverMode</span><span class="s4">,</span>
        <span class="s2">_build</span><span class="s4">,</span>
        <span class="s2">staticHandler</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">loadContext</span><span class="s4">,</span>
        <span class="s2">handleError</span><span class="s4">,</span>
        <span class="s2">isSpaMode</span><span class="s4">,</span>
        <span class="s2">criticalCss</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">=== </span><span class="s5">&quot;HEAD&quot;</span><span class="s4">) {</span>
      <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, {</span>
        <span class="s2">headers</span><span class="s4">: </span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">status</span><span class="s4">: </span><span class="s2">response</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">statusText</span><span class="s4">: </span><span class="s2">response</span><span class="s4">.</span><span class="s2">statusText</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
  <span class="s4">};</span>
<span class="s4">};</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">handleManifestRequest</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">routes</span><span class="s4">, </span><span class="s2">url</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">build</span><span class="s4">.</span><span class="s2">assets</span><span class="s4">.</span><span class="s2">version </span><span class="s4">!== </span><span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;version&quot;</span><span class="s4">)) {</span>
    <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, {</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s7">204</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: {</span>
        <span class="s5">&quot;X-Remix-Reload-Document&quot;</span><span class="s4">: </span><span class="s5">&quot;true&quot;</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">let </span><span class="s2">patches </span><span class="s4">= {};</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">)) {</span>
    <span class="s3">let </span><span class="s2">paths </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Set</span><span class="s4">();</span>
    <span class="s2">url</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">getAll</span><span class="s4">(</span><span class="s5">&quot;p&quot;</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">path</span><span class="s4">) =&gt; {</span>
      <span class="s3">if </span><span class="s4">(!</span><span class="s2">path</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">)) {</span>
        <span class="s2">path </span><span class="s4">= </span><span class="s5">`/</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">}</span><span class="s5">`</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">segments </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">);</span>
      <span class="s2">segments</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">_</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; {</span>
        <span class="s3">let </span><span class="s2">partialPath </span><span class="s4">= </span><span class="s2">segments</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s2">i </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
        <span class="s2">paths</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s5">`/</span><span class="s2">$</span><span class="s4">{</span><span class="s2">partialPath</span><span class="s4">}</span><span class="s5">`</span><span class="s4">);</span>
      <span class="s4">});</span>
    <span class="s4">});</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">path of paths</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">matches </span><span class="s4">= </span><span class="s2">matchServerRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">path</span><span class="s4">, </span><span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">matches</span><span class="s4">) {</span>
        <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of matches</span><span class="s4">) {</span>
          <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
          <span class="s3">let </span><span class="s2">route </span><span class="s4">= </span><span class="s2">build</span><span class="s4">.</span><span class="s2">assets</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
          <span class="s3">if </span><span class="s4">(</span><span class="s2">route</span><span class="s4">) {</span>
            <span class="s2">patches</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = </span><span class="s2">route</span><span class="s4">;</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">Response</span><span class="s4">.</span><span class="s2">json</span><span class="s4">(</span><span class="s2">patches</span><span class="s4">, {</span>
      <span class="s2">headers</span><span class="s4">: {</span>
        <span class="s5">&quot;Cache-Control&quot;</span><span class="s4">: </span><span class="s5">&quot;public, max-age=31536000, immutable&quot;</span>
      <span class="s4">}</span>
    <span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s5">&quot;Invalid Request&quot;</span><span class="s4">, { </span><span class="s2">status</span><span class="s4">: </span><span class="s7">400 </span><span class="s4">});</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">handleSingleFetchRequest</span><span class="s4">(</span><span class="s2">serverMode</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">staticHandler</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">handlerUrl</span><span class="s4">, </span><span class="s2">loadContext</span><span class="s4">, </span><span class="s2">handleError</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s2">request</span><span class="s4">.</span><span class="s2">method </span><span class="s4">!== </span><span class="s5">&quot;GET&quot; </span><span class="s4">? </span><span class="s3">await </span><span class="s2">singleFetchAction</span><span class="s4">(</span>
    <span class="s2">build</span><span class="s4">,</span>
    <span class="s2">serverMode</span><span class="s4">,</span>
    <span class="s2">staticHandler</span><span class="s4">,</span>
    <span class="s2">request</span><span class="s4">,</span>
    <span class="s2">handlerUrl</span><span class="s4">,</span>
    <span class="s2">loadContext</span><span class="s4">,</span>
    <span class="s2">handleError</span>
  <span class="s4">) : </span><span class="s3">await </span><span class="s2">singleFetchLoaders</span><span class="s4">(</span>
    <span class="s2">build</span><span class="s4">,</span>
    <span class="s2">serverMode</span><span class="s4">,</span>
    <span class="s2">staticHandler</span><span class="s4">,</span>
    <span class="s2">request</span><span class="s4">,</span>
    <span class="s2">handlerUrl</span><span class="s4">,</span>
    <span class="s2">loadContext</span><span class="s4">,</span>
    <span class="s2">handleError</span>
  <span class="s4">);</span>
  <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">handleDocumentRequest</span><span class="s4">(</span><span class="s2">serverMode</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">staticHandler</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">loadContext</span><span class="s4">, </span><span class="s2">handleError</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">, </span><span class="s2">criticalCss</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">staticHandler</span><span class="s4">.</span><span class="s2">query</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, {</span>
      <span class="s2">requestContext</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
      <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">.</span><span class="s2">unstable_middleware </span><span class="s4">? (</span><span class="s2">ctx</span><span class="s4">) =&gt; </span><span class="s2">renderHtml</span><span class="s4">(</span><span class="s2">ctx</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) : </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
    <span class="s3">return </span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">) ? </span><span class="s2">response </span><span class="s4">: </span><span class="s2">renderHtml</span><span class="s4">(</span><span class="s2">response</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, { </span><span class="s2">status</span><span class="s4">: </span><span class="s7">500 </span><span class="s4">});</span>
  <span class="s4">}</span>
  <span class="s2">async </span><span class="s3">function </span><span class="s2">renderHtml</span><span class="s4">(</span><span class="s2">context</span><span class="s4">, </span><span class="s2">isSpaMode2</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">context</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">context</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">headers </span><span class="s4">= </span><span class="s2">getDocumentHeaders</span><span class="s4">(</span><span class="s2">build</span><span class="s4">, </span><span class="s2">context</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">SERVER_NO_BODY_STATUS_CODES</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">)) {</span>
      <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s3">null</span><span class="s4">, { </span><span class="s2">status</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">, </span><span class="s2">headers </span><span class="s4">});</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
      <span class="s2">Object</span><span class="s4">.</span><span class="s2">values</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">err</span><span class="s4">) =&gt; {</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">err</span><span class="s4">) || </span><span class="s2">err</span><span class="s4">.</span><span class="s2">error</span><span class="s4">) {</span>
          <span class="s2">handleError</span><span class="s4">(</span><span class="s2">err</span><span class="s4">);</span>
        <span class="s4">}</span>
      <span class="s4">});</span>
      <span class="s2">context</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">= </span><span class="s2">sanitizeErrors</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">let </span><span class="s2">state </span><span class="s4">= {</span>
      <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
      <span class="s2">actionData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">,</span>
      <span class="s2">errors</span><span class="s4">: </span><span class="s2">serializeErrors2</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">)</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">baseServerHandoff </span><span class="s4">= {</span>
      <span class="s2">basename</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">basename</span><span class="s4">,</span>
      <span class="s2">future</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
      <span class="s2">routeDiscovery</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">routeDiscovery</span><span class="s4">,</span>
      <span class="s2">ssr</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">ssr</span><span class="s4">,</span>
      <span class="s2">isSpaMode</span><span class="s4">: </span><span class="s2">isSpaMode2</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">entryContext </span><span class="s4">= {</span>
      <span class="s2">manifest</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">assets</span><span class="s4">,</span>
      <span class="s2">routeModules</span><span class="s4">: </span><span class="s2">createEntryRouteModules</span><span class="s4">(</span><span class="s2">build</span><span class="s4">.</span><span class="s2">routes</span><span class="s4">),</span>
      <span class="s2">staticHandlerContext</span><span class="s4">: </span><span class="s2">context</span><span class="s4">,</span>
      <span class="s2">criticalCss</span><span class="s4">,</span>
      <span class="s2">serverHandoffString</span><span class="s4">: </span><span class="s2">createServerHandoffString</span><span class="s4">({</span>
        <span class="s2">...baseServerHandoff</span><span class="s4">,</span>
        <span class="s2">criticalCss</span>
      <span class="s4">}),</span>
      <span class="s2">serverHandoffStream</span><span class="s4">: </span><span class="s2">encodeViaTurboStream</span><span class="s4">(</span>
        <span class="s2">state</span><span class="s4">,</span>
        <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
        <span class="s2">build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">streamTimeout</span><span class="s4">,</span>
        <span class="s2">serverMode</span>
      <span class="s4">),</span>
      <span class="s2">renderMeta</span><span class="s4">: {},</span>
      <span class="s2">future</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">,</span>
      <span class="s2">ssr</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">ssr</span><span class="s4">,</span>
      <span class="s2">routeDiscovery</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">routeDiscovery</span><span class="s4">,</span>
      <span class="s2">isSpaMode</span><span class="s4">: </span><span class="s2">isSpaMode2</span><span class="s4">,</span>
      <span class="s2">serializeError</span><span class="s4">: (</span><span class="s2">err</span><span class="s4">) =&gt; </span><span class="s2">serializeError</span><span class="s4">(</span><span class="s2">err</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">)</span>
    <span class="s4">};</span>
    <span class="s3">let </span><span class="s2">handleDocumentRequestFunction </span><span class="s4">= </span><span class="s2">build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">default</span><span class="s4">;</span>
    <span class="s3">try </span><span class="s4">{</span>
      <span class="s3">return await </span><span class="s2">handleDocumentRequestFunction</span><span class="s4">(</span>
        <span class="s2">request</span><span class="s4">,</span>
        <span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">,</span>
        <span class="s2">headers</span><span class="s4">,</span>
        <span class="s2">entryContext</span><span class="s4">,</span>
        <span class="s2">loadContext</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
      <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">errorForSecondRender </span><span class="s4">= </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)) {</span>
        <span class="s3">try </span><span class="s4">{</span>
          <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s3">await </span><span class="s2">unwrapResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
          <span class="s2">errorForSecondRender </span><span class="s4">= </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
            <span class="s2">error</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
            <span class="s2">error</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">,</span>
            <span class="s2">data2</span>
          <span class="s4">);</span>
        <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s2">context </span><span class="s4">= </span><span class="s2">getStaticContextFromError</span><span class="s4">(</span>
        <span class="s2">staticHandler</span><span class="s4">.</span><span class="s2">dataRoutes</span><span class="s4">,</span>
        <span class="s2">context</span><span class="s4">,</span>
        <span class="s2">errorForSecondRender</span>
      <span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
        <span class="s2">context</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">= </span><span class="s2">sanitizeErrors</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">let </span><span class="s2">state2 </span><span class="s4">= {</span>
        <span class="s2">loaderData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">,</span>
        <span class="s2">actionData</span><span class="s4">: </span><span class="s2">context</span><span class="s4">.</span><span class="s2">actionData</span><span class="s4">,</span>
        <span class="s2">errors</span><span class="s4">: </span><span class="s2">serializeErrors2</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">)</span>
      <span class="s4">};</span>
      <span class="s2">entryContext </span><span class="s4">= {</span>
        <span class="s2">...entryContext</span><span class="s4">,</span>
        <span class="s2">staticHandlerContext</span><span class="s4">: </span><span class="s2">context</span><span class="s4">,</span>
        <span class="s2">serverHandoffString</span><span class="s4">: </span><span class="s2">createServerHandoffString</span><span class="s4">(</span><span class="s2">baseServerHandoff</span><span class="s4">),</span>
        <span class="s2">serverHandoffStream</span><span class="s4">: </span><span class="s2">encodeViaTurboStream</span><span class="s4">(</span>
          <span class="s2">state2</span><span class="s4">,</span>
          <span class="s2">request</span><span class="s4">.</span><span class="s2">signal</span><span class="s4">,</span>
          <span class="s2">build</span><span class="s4">.</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">module</span><span class="s4">.</span><span class="s2">streamTimeout</span><span class="s4">,</span>
          <span class="s2">serverMode</span>
        <span class="s4">),</span>
        <span class="s2">renderMeta</span><span class="s4">: {}</span>
      <span class="s4">};</span>
      <span class="s3">try </span><span class="s4">{</span>
        <span class="s3">return await </span><span class="s2">handleDocumentRequestFunction</span><span class="s4">(</span>
          <span class="s2">request</span><span class="s4">,</span>
          <span class="s2">context</span><span class="s4">.</span><span class="s2">statusCode</span><span class="s4">,</span>
          <span class="s2">headers</span><span class="s4">,</span>
          <span class="s2">entryContext</span><span class="s4">,</span>
          <span class="s2">loadContext</span>
        <span class="s4">);</span>
      <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error2</span><span class="s4">) {</span>
        <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error2</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">returnLastResortErrorResponse</span><span class="s4">(</span><span class="s2">error2</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s2">async </span><span class="s3">function </span><span class="s2">handleResourceRequest</span><span class="s4">(</span><span class="s2">serverMode</span><span class="s4">, </span><span class="s2">build</span><span class="s4">, </span><span class="s2">staticHandler</span><span class="s4">, </span><span class="s2">routeId</span><span class="s4">, </span><span class="s2">request</span><span class="s4">, </span><span class="s2">loadContext</span><span class="s4">, </span><span class="s2">handleError</span><span class="s4">) {</span>
  <span class="s3">try </span><span class="s4">{</span>
    <span class="s3">let </span><span class="s2">response </span><span class="s4">= </span><span class="s3">await </span><span class="s2">staticHandler</span><span class="s4">.</span><span class="s2">queryRoute</span><span class="s4">(</span><span class="s2">request</span><span class="s4">, {</span>
      <span class="s2">routeId</span><span class="s4">,</span>
      <span class="s2">requestContext</span><span class="s4">: </span><span class="s2">loadContext</span><span class="s4">,</span>
      <span class="s2">unstable_respond</span><span class="s4">: </span><span class="s2">build</span><span class="s4">.</span><span class="s2">future</span><span class="s4">.</span><span class="s2">unstable_middleware </span><span class="s4">? (</span><span class="s2">ctx</span><span class="s4">) =&gt; </span><span class="s2">ctx </span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span>
    <span class="s4">});</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">)) {</span>
      <span class="s3">return </span><span class="s2">response</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">response </span><span class="s4">=== </span><span class="s5">&quot;string&quot;</span><span class="s4">) {</span>
      <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s2">response</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">Response</span><span class="s4">.</span><span class="s2">json</span><span class="s4">(</span><span class="s2">response</span><span class="s4">);</span>
  <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)) {</span>
      <span class="s2">error</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s5">&quot;X-Remix-Catch&quot;</span><span class="s4">, </span><span class="s5">&quot;yes&quot;</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">error</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRouteErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
        <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">errorResponseToJson</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">error </span><span class="s3">instanceof </span><span class="s2">Error </span><span class="s4">&amp;&amp; </span><span class="s2">error</span><span class="s4">.</span><span class="s2">message </span><span class="s4">=== </span><span class="s5">&quot;Expected a response from queryRoute&quot;</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">newError </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">&quot;Expected a Response to be returned from resource route handler&quot;</span>
      <span class="s4">);</span>
      <span class="s2">handleError</span><span class="s4">(</span><span class="s2">newError</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">returnLastResortErrorResponse</span><span class="s4">(</span><span class="s2">newError</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s2">handleError</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
    <span class="s3">return </span><span class="s2">returnLastResortErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">);</span>
  <span class="s4">}</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">errorResponseToJson</span><span class="s4">(</span><span class="s2">errorResponse</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s2">Response</span><span class="s4">.</span><span class="s2">json</span><span class="s4">(</span>
    <span class="s2">serializeError</span><span class="s4">(</span>
      <span class="s6">// @ts-expect-error This is &quot;private&quot; from users but intended for internal use</span>
      <span class="s2">errorResponse</span><span class="s4">.</span><span class="s2">error </span><span class="s4">|| </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s5">&quot;Unexpected Server Error&quot;</span><span class="s4">),</span>
      <span class="s2">serverMode</span>
    <span class="s4">),</span>
    <span class="s4">{</span>
      <span class="s2">status</span><span class="s4">: </span><span class="s2">errorResponse</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
      <span class="s2">statusText</span><span class="s4">: </span><span class="s2">errorResponse</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">,</span>
      <span class="s2">headers</span><span class="s4">: {</span>
        <span class="s5">&quot;X-Remix-Error&quot;</span><span class="s4">: </span><span class="s5">&quot;yes&quot;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">);</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">returnLastResortErrorResponse</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">serverMode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">message </span><span class="s4">= </span><span class="s5">&quot;Unexpected Server Error&quot;</span><span class="s4">;</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">serverMode </span><span class="s4">!== </span><span class="s5">&quot;production&quot; </span><span class="s6">/* Production */</span><span class="s4">) {</span>
    <span class="s2">message </span><span class="s4">+= </span><span class="s5">`</span>

<span class="s2">$</span><span class="s4">{</span><span class="s2">String</span><span class="s4">(</span><span class="s2">error</span><span class="s4">)}</span><span class="s5">`</span><span class="s4">;</span>
  <span class="s4">}</span>
  <span class="s3">return new </span><span class="s2">Response</span><span class="s4">(</span><span class="s2">message</span><span class="s4">, {</span>
    <span class="s2">status</span><span class="s4">: </span><span class="s7">500</span><span class="s4">,</span>
    <span class="s2">headers</span><span class="s4">: {</span>
      <span class="s5">&quot;Content-Type&quot;</span><span class="s4">: </span><span class="s5">&quot;text/plain&quot;</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">unwrapResponse</span><span class="s4">(</span><span class="s2">response</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">contentType </span><span class="s4">= </span><span class="s2">response</span><span class="s4">.</span><span class="s2">headers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s5">&quot;Content-Type&quot;</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s2">contentType </span><span class="s4">&amp;&amp; </span><span class="s8">/\bapplication\/json\b/</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">contentType</span><span class="s4">) ? </span><span class="s2">response</span><span class="s4">.</span><span class="s2">body </span><span class="s4">== </span><span class="s3">null </span><span class="s4">? </span><span class="s3">null </span><span class="s4">: </span><span class="s2">response</span><span class="s4">.</span><span class="s2">json</span><span class="s4">() : </span><span class="s2">response</span><span class="s4">.</span><span class="s2">text</span><span class="s4">();</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/sessions.ts</span>
<span class="s3">function </span><span class="s2">flash</span><span class="s4">(</span><span class="s2">name</span><span class="s4">) {</span>
  <span class="s3">return </span><span class="s5">`__flash_</span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">}</span><span class="s5">__`</span><span class="s4">;</span>
<span class="s4">}</span>
<span class="s3">var </span><span class="s2">createSession </span><span class="s4">= (</span><span class="s2">initialData </span><span class="s4">= {}, </span><span class="s2">id </span><span class="s4">= </span><span class="s5">&quot;&quot;</span><span class="s4">) =&gt; {</span>
  <span class="s3">let </span><span class="s2">map </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">initialData</span><span class="s4">));</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">get id</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">id</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">get data</span><span class="s4">() {</span>
      <span class="s3">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">fromEntries</span><span class="s4">(</span><span class="s2">map</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">has</span><span class="s4">(</span><span class="s2">name</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">map</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">name</span><span class="s4">) || </span><span class="s2">map</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">flash</span><span class="s4">(</span><span class="s2">name</span><span class="s4">));</span>
    <span class="s4">},</span>
    <span class="s2">get</span><span class="s4">(</span><span class="s2">name</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">map</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">name</span><span class="s4">)) </span><span class="s3">return </span><span class="s2">map</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">flashName </span><span class="s4">= </span><span class="s2">flash</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">map</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">flashName</span><span class="s4">)) {</span>
        <span class="s3">let </span><span class="s2">value </span><span class="s4">= </span><span class="s2">map</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">flashName</span><span class="s4">);</span>
        <span class="s2">map</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">flashName</span><span class="s4">);</span>
        <span class="s3">return </span><span class="s2">value</span><span class="s4">;</span>
      <span class="s4">}</span>
      <span class="s3">return void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">set</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">value</span><span class="s4">) {</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">value</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">flash</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">value</span><span class="s4">) {</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">flash</span><span class="s4">(</span><span class="s2">name</span><span class="s4">), </span><span class="s2">value</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">unset</span><span class="s4">(</span><span class="s2">name</span><span class="s4">) {</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">};</span>
<span class="s3">var </span><span class="s2">isSession </span><span class="s4">= (</span><span class="s2">object</span><span class="s4">) =&gt; {</span>
  <span class="s3">return </span><span class="s2">object </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">id </span><span class="s4">=== </span><span class="s5">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">data </span><span class="s4">!== </span><span class="s5">&quot;undefined&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">has </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">get </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">set </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">flash </span><span class="s4">=== </span><span class="s5">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s3">typeof </span><span class="s2">object</span><span class="s4">.</span><span class="s2">unset </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">;</span>
<span class="s4">};</span>
<span class="s3">function </span><span class="s2">createSessionStorage</span><span class="s4">({</span>
  <span class="s2">cookie</span><span class="s4">: </span><span class="s2">cookieArg</span><span class="s4">,</span>
  <span class="s2">createData</span><span class="s4">,</span>
  <span class="s2">readData</span><span class="s4">,</span>
  <span class="s2">updateData</span><span class="s4">,</span>
  <span class="s2">deleteData</span>
<span class="s4">}) {</span>
  <span class="s3">let </span><span class="s2">cookie </span><span class="s4">= </span><span class="s2">isCookie</span><span class="s4">(</span><span class="s2">cookieArg</span><span class="s4">) ? </span><span class="s2">cookieArg </span><span class="s4">: </span><span class="s2">createCookie</span><span class="s4">(</span><span class="s2">cookieArg</span><span class="s4">?.</span><span class="s2">name </span><span class="s4">|| </span><span class="s5">&quot;__session&quot;</span><span class="s4">, </span><span class="s2">cookieArg</span><span class="s4">);</span>
  <span class="s2">warnOnceAboutSigningSessionCookie</span><span class="s4">(</span><span class="s2">cookie</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">async getSession</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">cookieHeader </span><span class="s4">&amp;&amp; </span><span class="s3">await </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
      <span class="s3">let </span><span class="s2">data2 </span><span class="s4">= </span><span class="s2">id </span><span class="s4">&amp;&amp; </span><span class="s3">await </span><span class="s2">readData</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">createSession</span><span class="s4">(</span><span class="s2">data2 </span><span class="s4">|| {}, </span><span class="s2">id </span><span class="s4">|| </span><span class="s5">&quot;&quot;</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">async commitSession</span><span class="s4">(</span><span class="s2">session</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s4">{ </span><span class="s2">id</span><span class="s4">, </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2 </span><span class="s4">} = </span><span class="s2">session</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">expires </span><span class="s4">= </span><span class="s2">options</span><span class="s4">?.</span><span class="s2">maxAge </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">(</span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">() + </span><span class="s2">options</span><span class="s4">.</span><span class="s2">maxAge </span><span class="s4">* </span><span class="s7">1e3</span><span class="s4">) : </span><span class="s2">options</span><span class="s4">?.</span><span class="s2">expires </span><span class="s4">!= </span><span class="s3">null </span><span class="s4">? </span><span class="s2">options</span><span class="s4">.</span><span class="s2">expires </span><span class="s4">: </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">expires</span><span class="s4">;</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">id</span><span class="s4">) {</span>
        <span class="s3">await </span><span class="s2">updateData</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires</span><span class="s4">);</span>
      <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
        <span class="s2">id </span><span class="s4">= </span><span class="s3">await </span><span class="s2">createData</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">serialize</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">async destroySession</span><span class="s4">(</span><span class="s2">session</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">await </span><span class="s2">deleteData</span><span class="s4">(</span><span class="s2">session</span><span class="s4">.</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s3">return </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">serialize</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, {</span>
        <span class="s2">...options</span><span class="s4">,</span>
        <span class="s2">maxAge</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">expires</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">(</span><span class="s7">0</span><span class="s4">)</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>
<span class="s3">function </span><span class="s2">warnOnceAboutSigningSessionCookie</span><span class="s4">(</span><span class="s2">cookie</span><span class="s4">) {</span>
  <span class="s2">warnOnce</span><span class="s4">(</span>
    <span class="s2">cookie</span><span class="s4">.</span><span class="s2">isSigned</span><span class="s4">,</span>
    <span class="s5">`The &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">name</span><span class="s4">}</span><span class="s5">&quot; cookie is not signed, but session cookies should be signed to prevent tampering on the client before they are sent back to the server. See https://reactrouter.com/explanation/sessions-and-cookies#signing-cookies for more information.`</span>
  <span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/sessions/cookieStorage.ts</span>
<span class="s3">function </span><span class="s2">createCookieSessionStorage</span><span class="s4">({ </span><span class="s2">cookie</span><span class="s4">: </span><span class="s2">cookieArg </span><span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s2">cookie </span><span class="s4">= </span><span class="s2">isCookie</span><span class="s4">(</span><span class="s2">cookieArg</span><span class="s4">) ? </span><span class="s2">cookieArg </span><span class="s4">: </span><span class="s2">createCookie</span><span class="s4">(</span><span class="s2">cookieArg</span><span class="s4">?.</span><span class="s2">name </span><span class="s4">|| </span><span class="s5">&quot;__session&quot;</span><span class="s4">, </span><span class="s2">cookieArg</span><span class="s4">);</span>
  <span class="s2">warnOnceAboutSigningSessionCookie</span><span class="s4">(</span><span class="s2">cookie</span><span class="s4">);</span>
  <span class="s3">return </span><span class="s4">{</span>
    <span class="s2">async getSession</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">createSession</span><span class="s4">(</span>
        <span class="s2">cookieHeader </span><span class="s4">&amp;&amp; </span><span class="s3">await </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">cookieHeader</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) || {}</span>
      <span class="s4">);</span>
    <span class="s4">},</span>
    <span class="s2">async commitSession</span><span class="s4">(</span><span class="s2">session</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">serializedCookie </span><span class="s4">= </span><span class="s3">await </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">serialize</span><span class="s4">(</span><span class="s2">session</span><span class="s4">.</span><span class="s2">data</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">serializedCookie</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">4096</span><span class="s4">) {</span>
        <span class="s3">throw new </span><span class="s2">Error</span><span class="s4">(</span>
          <span class="s5">&quot;Cookie length will exceed browser maximum. Length: &quot; </span><span class="s4">+ </span><span class="s2">serializedCookie</span><span class="s4">.</span><span class="s2">length</span>
        <span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return </span><span class="s2">serializedCookie</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">async destroySession</span><span class="s4">(</span><span class="s2">_session</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
      <span class="s3">return </span><span class="s2">cookie</span><span class="s4">.</span><span class="s2">serialize</span><span class="s4">(</span><span class="s5">&quot;&quot;</span><span class="s4">, {</span>
        <span class="s2">...options</span><span class="s4">,</span>
        <span class="s2">maxAge</span><span class="s4">: </span><span class="s3">void </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">expires</span><span class="s4">: </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">(</span><span class="s7">0</span><span class="s4">)</span>
      <span class="s4">});</span>
    <span class="s4">}</span>
  <span class="s4">};</span>
<span class="s4">}</span>

<span class="s6">// lib/server-runtime/sessions/memoryStorage.ts</span>
<span class="s3">function </span><span class="s2">createMemorySessionStorage</span><span class="s4">({ </span><span class="s2">cookie </span><span class="s4">} = {}) {</span>
  <span class="s3">let </span><span class="s2">map </span><span class="s4">= </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Map</span><span class="s4">();</span>
  <span class="s3">return </span><span class="s2">createSessionStorage</span><span class="s4">({</span>
    <span class="s2">cookie</span><span class="s4">,</span>
    <span class="s2">async createData</span><span class="s4">(</span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">id </span><span class="s4">= </span><span class="s2">Math</span><span class="s4">.</span><span class="s2">random</span><span class="s4">().</span><span class="s2">toString</span><span class="s4">(</span><span class="s7">36</span><span class="s4">).</span><span class="s2">substring</span><span class="s4">(</span><span class="s7">2</span><span class="s4">, </span><span class="s7">10</span><span class="s4">);</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, { </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires </span><span class="s4">});</span>
      <span class="s3">return </span><span class="s2">id</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">async readData</span><span class="s4">(</span><span class="s2">id</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">map</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">id</span><span class="s4">)) {</span>
        <span class="s3">let </span><span class="s4">{ </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires </span><span class="s4">} = </span><span class="s2">map</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>
        <span class="s3">if </span><span class="s4">(!</span><span class="s2">expires </span><span class="s4">|| </span><span class="s2">expires </span><span class="s4">&gt; </span><span class="s6">/* @__PURE__ */ </span><span class="s3">new </span><span class="s2">Date</span><span class="s4">()) {</span>
          <span class="s3">return </span><span class="s2">data2</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s2">expires</span><span class="s4">) </span><span class="s2">map</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>
      <span class="s4">}</span>
      <span class="s3">return null</span><span class="s4">;</span>
    <span class="s4">},</span>
    <span class="s2">async updateData</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires</span><span class="s4">) {</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, { </span><span class="s2">data</span><span class="s4">: </span><span class="s2">data2</span><span class="s4">, </span><span class="s2">expires </span><span class="s4">});</span>
    <span class="s4">},</span>
    <span class="s2">async deleteData</span><span class="s4">(</span><span class="s2">id</span><span class="s4">) {</span>
      <span class="s2">map</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>
    <span class="s4">}</span>
  <span class="s4">});</span>
<span class="s4">}</span>

<span class="s6">// lib/href.ts</span>
<span class="s3">function </span><span class="s2">href</span><span class="s4">(</span><span class="s2">path</span><span class="s4">, </span><span class="s2">...args</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">params </span><span class="s4">= </span><span class="s2">args</span><span class="s4">[</span><span class="s7">0</span><span class="s4">];</span>
  <span class="s3">return </span><span class="s2">path</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">).</span><span class="s2">map</span><span class="s4">((</span><span class="s2">segment</span><span class="s4">) =&gt; {</span>
    <span class="s3">const </span><span class="s2">match </span><span class="s4">= </span><span class="s2">segment</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s8">/^:([\w-]+)(\?)?/</span><span class="s4">);</span>
    <span class="s3">if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) </span><span class="s3">return </span><span class="s2">segment</span><span class="s4">;</span>
    <span class="s3">const </span><span class="s2">param </span><span class="s4">= </span><span class="s2">match</span><span class="s4">[</span><span class="s7">1</span><span class="s4">];</span>
    <span class="s3">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">params </span><span class="s4">? </span><span class="s2">params</span><span class="s4">[</span><span class="s2">param</span><span class="s4">] : </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">const </span><span class="s2">isRequired </span><span class="s4">= </span><span class="s2">match</span><span class="s4">[</span><span class="s7">2</span><span class="s4">] === </span><span class="s3">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">isRequired </span><span class="s4">&amp;&amp; </span><span class="s2">value </span><span class="s4">=== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">) {</span>
      <span class="s3">throw </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s5">`Path '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">path</span><span class="s4">}</span><span class="s5">' requires param '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">param</span><span class="s4">}</span><span class="s5">' but it was not provided`</span>
      <span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s3">return </span><span class="s2">value</span><span class="s4">;</span>
  <span class="s4">}).</span><span class="s2">filter</span><span class="s4">((</span><span class="s2">segment</span><span class="s4">) =&gt; </span><span class="s2">segment </span><span class="s4">!== </span><span class="s3">void </span><span class="s7">0</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s5">&quot;/&quot;</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/errors.ts</span>
<span class="s3">function </span><span class="s2">deserializeErrors2</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">) {</span>
  <span class="s3">if </span><span class="s4">(!</span><span class="s2">errors</span><span class="s4">) </span><span class="s3">return null</span><span class="s4">;</span>
  <span class="s3">let </span><span class="s2">entries </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">);</span>
  <span class="s3">let </span><span class="s2">serialized </span><span class="s4">= {};</span>
  <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s4">[</span><span class="s2">key</span><span class="s4">, </span><span class="s2">val</span><span class="s4">] </span><span class="s2">of entries</span><span class="s4">) {</span>
    <span class="s3">if </span><span class="s4">(</span><span class="s2">val </span><span class="s4">&amp;&amp; </span><span class="s2">val</span><span class="s4">.</span><span class="s2">__type </span><span class="s4">=== </span><span class="s5">&quot;RouteErrorResponse&quot;</span><span class="s4">) {</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s3">new </span><span class="s2">ErrorResponseImpl</span><span class="s4">(</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">status</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">statusText</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">data</span><span class="s4">,</span>
        <span class="s2">val</span><span class="s4">.</span><span class="s2">internal </span><span class="s4">=== </span><span class="s3">true</span>
      <span class="s4">);</span>
    <span class="s4">} </span><span class="s3">else if </span><span class="s4">(</span><span class="s2">val </span><span class="s4">&amp;&amp; </span><span class="s2">val</span><span class="s4">.</span><span class="s2">__type </span><span class="s4">=== </span><span class="s5">&quot;Error&quot;</span><span class="s4">) {</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">__subType</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">ErrorConstructor </span><span class="s4">= </span><span class="s2">window</span><span class="s4">[</span><span class="s2">val</span><span class="s4">.</span><span class="s2">__subType</span><span class="s4">];</span>
        <span class="s3">if </span><span class="s4">(</span><span class="s3">typeof </span><span class="s2">ErrorConstructor </span><span class="s4">=== </span><span class="s5">&quot;function&quot;</span><span class="s4">) {</span>
          <span class="s3">try </span><span class="s4">{</span>
            <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">ErrorConstructor</span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">message</span><span class="s4">);</span>
            <span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s2">val</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">;</span>
            <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
          <span class="s4">} </span><span class="s3">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
          <span class="s4">}</span>
        <span class="s4">}</span>
      <span class="s4">}</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] == </span><span class="s3">null</span><span class="s4">) {</span>
        <span class="s3">let </span><span class="s2">error </span><span class="s4">= </span><span class="s3">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s2">val</span><span class="s4">.</span><span class="s2">message</span><span class="s4">);</span>
        <span class="s2">error</span><span class="s4">.</span><span class="s2">stack </span><span class="s4">= </span><span class="s2">val</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">;</span>
        <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">error</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">} </span><span class="s3">else </span><span class="s4">{</span>
      <span class="s2">serialized</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">val</span><span class="s4">;</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">serialized</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">// lib/dom/ssr/hydration.tsx</span>
<span class="s3">function </span><span class="s2">getHydrationData</span><span class="s4">(</span><span class="s2">state</span><span class="s4">, </span><span class="s2">routes</span><span class="s4">, </span><span class="s2">getRouteInfo</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">, </span><span class="s2">isSpaMode</span><span class="s4">) {</span>
  <span class="s3">let </span><span class="s2">hydrationData </span><span class="s4">= {</span>
    <span class="s2">...state</span><span class="s4">,</span>
    <span class="s2">loaderData</span><span class="s4">: { </span><span class="s2">...state</span><span class="s4">.</span><span class="s2">loaderData </span><span class="s4">}</span>
  <span class="s4">};</span>
  <span class="s3">let </span><span class="s2">initialMatches </span><span class="s4">= </span><span class="s2">matchRoutes</span><span class="s4">(</span><span class="s2">routes</span><span class="s4">, </span><span class="s2">location</span><span class="s4">, </span><span class="s2">basename</span><span class="s4">);</span>
  <span class="s3">if </span><span class="s4">(</span><span class="s2">initialMatches</span><span class="s4">) {</span>
    <span class="s3">for </span><span class="s4">(</span><span class="s3">let </span><span class="s2">match of initialMatches</span><span class="s4">) {</span>
      <span class="s3">let </span><span class="s2">routeId </span><span class="s4">= </span><span class="s2">match</span><span class="s4">.</span><span class="s2">route</span><span class="s4">.</span><span class="s2">id</span><span class="s4">;</span>
      <span class="s3">let </span><span class="s2">routeInfo </span><span class="s4">= </span><span class="s2">getRouteInfo</span><span class="s4">(</span><span class="s2">routeId</span><span class="s4">);</span>
      <span class="s3">if </span><span class="s4">(</span><span class="s2">shouldHydrateRouteLoader</span><span class="s4">(</span>
        <span class="s2">routeId</span><span class="s4">,</span>
        <span class="s2">routeInfo</span><span class="s4">.</span><span class="s2">clientLoader</span><span class="s4">,</span>
        <span class="s2">routeInfo</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">,</span>
        <span class="s2">isSpaMode</span>
      <span class="s4">) &amp;&amp; (</span><span class="s2">routeInfo</span><span class="s4">.</span><span class="s2">hasHydrateFallback </span><span class="s4">|| !</span><span class="s2">routeInfo</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">)) {</span>
        <span class="s3">delete </span><span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">];</span>
      <span class="s4">} </span><span class="s3">else if </span><span class="s4">(!</span><span class="s2">routeInfo</span><span class="s4">.</span><span class="s2">hasLoader</span><span class="s4">) {</span>
        <span class="s2">hydrationData</span><span class="s4">.</span><span class="s2">loaderData</span><span class="s4">[</span><span class="s2">routeId</span><span class="s4">] = </span><span class="s3">null</span><span class="s4">;</span>
      <span class="s4">}</span>
    <span class="s4">}</span>
  <span class="s4">}</span>
  <span class="s3">return </span><span class="s2">hydrationData</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s3">export </span><span class="s4">{</span>
  <span class="s2">Action</span><span class="s4">,</span>
  <span class="s2">createBrowserHistory</span><span class="s4">,</span>
  <span class="s2">invariant</span><span class="s4">,</span>
  <span class="s2">createPath</span><span class="s4">,</span>
  <span class="s2">parsePath</span><span class="s4">,</span>
  <span class="s2">unstable_createContext</span><span class="s4">,</span>
  <span class="s2">unstable_RouterContextProvider</span><span class="s4">,</span>
  <span class="s2">matchRoutes</span><span class="s4">,</span>
  <span class="s2">generatePath</span><span class="s4">,</span>
  <span class="s2">matchPath</span><span class="s4">,</span>
  <span class="s2">resolvePath</span><span class="s4">,</span>
  <span class="s2">data</span><span class="s4">,</span>
  <span class="s2">redirect</span><span class="s4">,</span>
  <span class="s2">redirectDocument</span><span class="s4">,</span>
  <span class="s2">replace</span><span class="s4">,</span>
  <span class="s2">ErrorResponseImpl</span><span class="s4">,</span>
  <span class="s2">isRouteErrorResponse</span><span class="s4">,</span>
  <span class="s2">IDLE_NAVIGATION</span><span class="s4">,</span>
  <span class="s2">IDLE_FETCHER</span><span class="s4">,</span>
  <span class="s2">IDLE_BLOCKER</span><span class="s4">,</span>
  <span class="s2">createRouter</span><span class="s4">,</span>
  <span class="s2">DataRouterContext</span><span class="s4">,</span>
  <span class="s2">DataRouterStateContext</span><span class="s4">,</span>
  <span class="s2">ViewTransitionContext</span><span class="s4">,</span>
  <span class="s2">FetchersContext</span><span class="s4">,</span>
  <span class="s2">NavigationContext</span><span class="s4">,</span>
  <span class="s2">LocationContext</span><span class="s4">,</span>
  <span class="s2">RouteContext</span><span class="s4">,</span>
  <span class="s2">useHref</span><span class="s4">,</span>
  <span class="s2">useInRouterContext</span><span class="s4">,</span>
  <span class="s2">useLocation</span><span class="s4">,</span>
  <span class="s2">useNavigationType</span><span class="s4">,</span>
  <span class="s2">useMatch</span><span class="s4">,</span>
  <span class="s2">useNavigate</span><span class="s4">,</span>
  <span class="s2">useOutletContext</span><span class="s4">,</span>
  <span class="s2">useOutlet</span><span class="s4">,</span>
  <span class="s2">useParams</span><span class="s4">,</span>
  <span class="s2">useResolvedPath</span><span class="s4">,</span>
  <span class="s2">useRoutes</span><span class="s4">,</span>
  <span class="s2">useNavigation</span><span class="s4">,</span>
  <span class="s2">useRevalidator</span><span class="s4">,</span>
  <span class="s2">useMatches</span><span class="s4">,</span>
  <span class="s2">useLoaderData</span><span class="s4">,</span>
  <span class="s2">useRouteLoaderData</span><span class="s4">,</span>
  <span class="s2">useActionData</span><span class="s4">,</span>
  <span class="s2">useRouteError</span><span class="s4">,</span>
  <span class="s2">useAsyncValue</span><span class="s4">,</span>
  <span class="s2">useAsyncError</span><span class="s4">,</span>
  <span class="s2">useBlocker</span><span class="s4">,</span>
  <span class="s2">mapRouteProperties</span><span class="s4">,</span>
  <span class="s2">hydrationRouteProperties</span><span class="s4">,</span>
  <span class="s2">createMemoryRouter</span><span class="s4">,</span>
  <span class="s2">RouterProvider</span><span class="s4">,</span>
  <span class="s2">MemoryRouter</span><span class="s4">,</span>
  <span class="s2">Navigate</span><span class="s4">,</span>
  <span class="s2">Outlet</span><span class="s4">,</span>
  <span class="s2">Route</span><span class="s4">,</span>
  <span class="s2">Router</span><span class="s4">,</span>
  <span class="s2">Routes</span><span class="s4">,</span>
  <span class="s2">Await</span><span class="s4">,</span>
  <span class="s2">createRoutesFromChildren</span><span class="s4">,</span>
  <span class="s2">createRoutesFromElements</span><span class="s4">,</span>
  <span class="s2">renderMatches</span><span class="s4">,</span>
  <span class="s2">createSearchParams</span><span class="s4">,</span>
  <span class="s2">SingleFetchRedirectSymbol</span><span class="s4">,</span>
  <span class="s2">getTurboStreamSingleFetchDataStrategy</span><span class="s4">,</span>
  <span class="s2">decodeViaTurboStream</span><span class="s4">,</span>
  <span class="s2">RemixErrorBoundary</span><span class="s4">,</span>
  <span class="s2">createClientRoutesWithHMRRevalidationOptOut</span><span class="s4">,</span>
  <span class="s2">createClientRoutes</span><span class="s4">,</span>
  <span class="s2">shouldHydrateRouteLoader</span><span class="s4">,</span>
  <span class="s2">getPatchRoutesOnNavigationFunction</span><span class="s4">,</span>
  <span class="s2">useFogOFWarDiscovery</span><span class="s4">,</span>
  <span class="s2">FrameworkContext</span><span class="s4">,</span>
  <span class="s2">Links</span><span class="s4">,</span>
  <span class="s2">PrefetchPageLinks</span><span class="s4">,</span>
  <span class="s2">Meta</span><span class="s4">,</span>
  <span class="s2">Scripts</span><span class="s4">,</span>
  <span class="s2">createBrowserRouter</span><span class="s4">,</span>
  <span class="s2">createHashRouter</span><span class="s4">,</span>
  <span class="s2">BrowserRouter</span><span class="s4">,</span>
  <span class="s2">HashRouter</span><span class="s4">,</span>
  <span class="s2">HistoryRouter</span><span class="s4">,</span>
  <span class="s2">Link</span><span class="s4">,</span>
  <span class="s2">NavLink</span><span class="s4">,</span>
  <span class="s2">Form</span><span class="s4">,</span>
  <span class="s2">ScrollRestoration</span><span class="s4">,</span>
  <span class="s2">useLinkClickHandler</span><span class="s4">,</span>
  <span class="s2">useSearchParams</span><span class="s4">,</span>
  <span class="s2">useSubmit</span><span class="s4">,</span>
  <span class="s2">useFormAction</span><span class="s4">,</span>
  <span class="s2">useFetcher</span><span class="s4">,</span>
  <span class="s2">useFetchers</span><span class="s4">,</span>
  <span class="s2">useScrollRestoration</span><span class="s4">,</span>
  <span class="s2">useBeforeUnload</span><span class="s4">,</span>
  <span class="s2">usePrompt</span><span class="s4">,</span>
  <span class="s2">useViewTransitionState</span><span class="s4">,</span>
  <span class="s2">StaticRouter</span><span class="s4">,</span>
  <span class="s2">StaticRouterProvider</span><span class="s4">,</span>
  <span class="s2">createStaticHandler2 </span><span class="s4">as </span><span class="s2">createStaticHandler</span><span class="s4">,</span>
  <span class="s2">createStaticRouter</span><span class="s4">,</span>
  <span class="s2">ServerRouter</span><span class="s4">,</span>
  <span class="s2">createRoutesStub</span><span class="s4">,</span>
  <span class="s2">createCookie</span><span class="s4">,</span>
  <span class="s2">isCookie</span><span class="s4">,</span>
  <span class="s2">ServerMode</span><span class="s4">,</span>
  <span class="s2">setDevServerHooks</span><span class="s4">,</span>
  <span class="s2">createRequestHandler</span><span class="s4">,</span>
  <span class="s2">createSession</span><span class="s4">,</span>
  <span class="s2">isSession</span><span class="s4">,</span>
  <span class="s2">createSessionStorage</span><span class="s4">,</span>
  <span class="s2">createCookieSessionStorage</span><span class="s4">,</span>
  <span class="s2">createMemorySessionStorage</span><span class="s4">,</span>
  <span class="s2">href</span><span class="s4">,</span>
  <span class="s2">deserializeErrors2 </span><span class="s4">as </span><span class="s2">deserializeErrors</span><span class="s4">,</span>
  <span class="s2">getHydrationData</span>
<span class="s4">};</span>
</pre>
</body>
</html>