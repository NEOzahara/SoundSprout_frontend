<html>
<head>
<title>dataTypes.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cf8e6d;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #7a7e85;}
.s5 { color: #42c3d4;}
.s6 { color: #2aacb8;}
.s7 { color: #5f826b; font-style: italic;}
.s8 { color: #67a37c; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
dataTypes.js</font>
</center></td></tr></table>
<pre><span class="s0">import </span><span class="s2">{ </span><span class="s1">parseColor </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./color'</span>
<span class="s0">import </span><span class="s2">{ </span><span class="s1">parseBoxShadowValue </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./parseBoxShadowValue'</span>
<span class="s0">import </span><span class="s2">{ </span><span class="s1">splitAtTopLevelOnly </span><span class="s2">} </span><span class="s1">from </span><span class="s3">'./splitAtTopLevelOnly'</span>

<span class="s0">let </span><span class="s1">cssFunctions </span><span class="s2">= [</span><span class="s3">'min'</span><span class="s2">, </span><span class="s3">'max'</span><span class="s2">, </span><span class="s3">'clamp'</span><span class="s2">, </span><span class="s3">'calc'</span><span class="s2">]</span>

<span class="s4">// Ref: https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Types</span>

<span class="s0">function </span><span class="s1">isCSSFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">cssFunctions</span><span class="s2">.</span><span class="s1">some</span><span class="s2">((</span><span class="s1">fn</span><span class="s2">) =&gt; </span><span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">`^</span><span class="s1">$</span><span class="s2">{</span><span class="s1">fn</span><span class="s2">}</span><span class="s0">\\</span><span class="s3">(.*</span><span class="s0">\\</span><span class="s3">)`</span><span class="s2">).</span><span class="s1">test</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
<span class="s2">}</span>

<span class="s4">// These properties accept a `&lt;dashed-ident&gt;` as one of the values. This means that you can use them</span>
<span class="s4">// as: `timeline-scope: --tl;`</span>
<span class="s4">//</span>
<span class="s4">// Without the `var(--tl)`, in these cases we don't want to normalize the value, and you should add</span>
<span class="s4">// the `var()` yourself.</span>
<span class="s4">//</span>
<span class="s4">// More info:</span>
<span class="s4">// - https://drafts.csswg.org/scroll-animations/#propdef-timeline-scope</span>
<span class="s4">// - https://developer.mozilla.org/en-US/docs/Web/CSS/timeline-scope#dashed-ident</span>
<span class="s4">// - https://www.w3.org/TR/css-anchor-position-1</span>
<span class="s4">//</span>
<span class="s0">const </span><span class="s1">AUTO_VAR_INJECTION_EXCEPTIONS </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span>
  <span class="s4">// Concrete properties</span>
  <span class="s3">'scroll-timeline-name'</span><span class="s2">,</span>
  <span class="s3">'timeline-scope'</span><span class="s2">,</span>
  <span class="s3">'view-timeline-name'</span><span class="s2">,</span>
  <span class="s3">'font-palette'</span><span class="s2">,</span>
  <span class="s3">'anchor-name'</span><span class="s2">,</span>
  <span class="s3">'anchor-scope'</span><span class="s2">,</span>
  <span class="s3">'position-anchor'</span><span class="s2">,</span>
  <span class="s3">'position-try-options'</span><span class="s2">,</span>

  <span class="s4">// Shorthand properties</span>
  <span class="s3">'scroll-timeline'</span><span class="s2">,</span>
  <span class="s3">'animation-timeline'</span><span class="s2">,</span>
  <span class="s3">'view-timeline'</span><span class="s2">,</span>
  <span class="s3">'position-try'</span><span class="s2">,</span>
<span class="s2">])</span>

<span class="s4">// This is not a data type, but rather a function that can normalize the</span>
<span class="s4">// correct values.</span>
<span class="s0">export function </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">context </span><span class="s2">= </span><span class="s0">null</span><span class="s2">, </span><span class="s1">isRoot </span><span class="s2">= </span><span class="s0">true</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">isVarException </span><span class="s2">= </span><span class="s1">context </span><span class="s2">&amp;&amp; </span><span class="s1">AUTO_VAR_INJECTION_EXCEPTIONS</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">context</span><span class="s2">.</span><span class="s1">property</span><span class="s2">)</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'--'</span><span class="s2">) &amp;&amp; !</span><span class="s1">isVarException</span><span class="s2">) {</span>
    <span class="s0">return </span><span class="s3">`var(</span><span class="s1">$</span><span class="s2">{</span><span class="s1">value</span><span class="s2">}</span><span class="s3">)`</span>
  <span class="s2">}</span>

  <span class="s4">// Keep raw strings if it starts with `url(`</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">includes</span><span class="s2">(</span><span class="s3">'url('</span><span class="s2">)) {</span>
    <span class="s0">return </span><span class="s1">value</span>
      <span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s5">/(url\(.*?\))/g</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">Boolean</span><span class="s2">)</span>
      <span class="s2">.</span><span class="s1">map</span><span class="s2">((</span><span class="s1">part</span><span class="s2">) =&gt; {</span>
        <span class="s0">if </span><span class="s2">(</span><span class="s5">/^url\(.*?\)$/</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)) {</span>
          <span class="s0">return </span><span class="s1">part</span>
        <span class="s2">}</span>

        <span class="s0">return </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">part</span><span class="s2">, </span><span class="s1">context</span><span class="s2">, </span><span class="s0">false</span><span class="s2">)</span>
      <span class="s2">})</span>
      <span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">''</span><span class="s2">)</span>
  <span class="s2">}</span>

  <span class="s4">// Convert `_` to ` `, except for escaped underscores `\_`</span>
  <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span>
    <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span>
      <span class="s5">/([^\\])_+/g</span><span class="s2">,</span>
      <span class="s2">(</span><span class="s1">fullMatch</span><span class="s2">, </span><span class="s1">characterBefore</span><span class="s2">) =&gt; </span><span class="s1">characterBefore </span><span class="s2">+ </span><span class="s3">' '</span><span class="s2">.</span><span class="s1">repeat</span><span class="s2">(</span><span class="s1">fullMatch</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">)</span>
    <span class="s2">)</span>
    <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/^_/g</span><span class="s2">, </span><span class="s3">' '</span><span class="s2">)</span>
    <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\\_/g</span><span class="s2">, </span><span class="s3">'_'</span><span class="s2">)</span>

  <span class="s4">// Remove leftover whitespace</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">isRoot</span><span class="s2">) {</span>
    <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">trim</span><span class="s2">()</span>
  <span class="s2">}</span>

  <span class="s1">value </span><span class="s2">= </span><span class="s1">normalizeMathOperatorSpacing</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

  <span class="s0">return </span><span class="s1">value</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">normalizeAttributeSelectors</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s4">// Wrap values in attribute selectors with quotes</span>
  <span class="s0">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">includes</span><span class="s2">(</span><span class="s3">'='</span><span class="s2">)) {</span>
    <span class="s1">value </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/(=.*)/g</span><span class="s2">, (</span><span class="s1">_fullMatch</span><span class="s2">, </span><span class="s1">match</span><span class="s2">) =&gt; {</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] === </span><span class="s3">&quot;'&quot; </span><span class="s2">|| </span><span class="s1">match</span><span class="s2">[</span><span class="s6">1</span><span class="s2">] === </span><span class="s3">'&quot;'</span><span class="s2">) {</span>
        <span class="s0">return </span><span class="s1">match</span>
      <span class="s2">}</span>

      <span class="s4">// Handle regex flags on unescaped values</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s6">2</span><span class="s2">) {</span>
        <span class="s0">let </span><span class="s1">trailingCharacter </span><span class="s2">= </span><span class="s1">match</span><span class="s2">[</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">]</span>
        <span class="s0">if </span><span class="s2">(</span>
          <span class="s1">match</span><span class="s2">[</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">2</span><span class="s2">] === </span><span class="s3">' ' </span><span class="s2">&amp;&amp;</span>
          <span class="s2">(</span><span class="s1">trailingCharacter </span><span class="s2">=== </span><span class="s3">'i' </span><span class="s2">||</span>
            <span class="s1">trailingCharacter </span><span class="s2">=== </span><span class="s3">'I' </span><span class="s2">||</span>
            <span class="s1">trailingCharacter </span><span class="s2">=== </span><span class="s3">'s' </span><span class="s2">||</span>
            <span class="s1">trailingCharacter </span><span class="s2">=== </span><span class="s3">'S'</span><span class="s2">)</span>
        <span class="s2">) {</span>
          <span class="s0">return </span><span class="s3">`=&quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">match</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">1</span><span class="s2">, -</span><span class="s6">2</span><span class="s2">)}</span><span class="s3">&quot; </span><span class="s1">$</span><span class="s2">{</span><span class="s1">match</span><span class="s2">[</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">]}</span><span class="s3">`</span>
        <span class="s2">}</span>
      <span class="s2">}</span>

      <span class="s0">return </span><span class="s3">`=&quot;</span><span class="s1">$</span><span class="s2">{</span><span class="s1">match</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">1</span><span class="s2">)}</span><span class="s3">&quot;`</span>
    <span class="s2">})</span>
  <span class="s2">}</span>
  <span class="s0">return </span><span class="s1">value</span>
<span class="s2">}</span>

<span class="s7">/**</span>
 <span class="s7">* Add spaces around operators inside math functions</span>
 <span class="s7">* like calc() that do not follow an operator, '(', or `,`.</span>
 <span class="s7">*</span>
 <span class="s7">* </span><span class="s8">@param </span><span class="s7">{string} value</span>
 <span class="s7">* </span><span class="s8">@returns </span><span class="s7">{string}</span>
 <span class="s7">*/</span>
<span class="s0">function </span><span class="s1">normalizeMathOperatorSpacing</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">preventFormattingInFunctions </span><span class="s2">= [</span><span class="s3">'theme'</span><span class="s2">]</span>
  <span class="s0">let </span><span class="s1">preventFormattingKeywords </span><span class="s2">= [</span>
    <span class="s3">'min-content'</span><span class="s2">,</span>
    <span class="s3">'max-content'</span><span class="s2">,</span>
    <span class="s3">'fit-content'</span><span class="s2">,</span>

    <span class="s4">// Env</span>
    <span class="s3">'safe-area-inset-top'</span><span class="s2">,</span>
    <span class="s3">'safe-area-inset-right'</span><span class="s2">,</span>
    <span class="s3">'safe-area-inset-bottom'</span><span class="s2">,</span>
    <span class="s3">'safe-area-inset-left'</span><span class="s2">,</span>

    <span class="s3">'titlebar-area-x'</span><span class="s2">,</span>
    <span class="s3">'titlebar-area-y'</span><span class="s2">,</span>
    <span class="s3">'titlebar-area-width'</span><span class="s2">,</span>
    <span class="s3">'titlebar-area-height'</span><span class="s2">,</span>

    <span class="s3">'keyboard-inset-top'</span><span class="s2">,</span>
    <span class="s3">'keyboard-inset-right'</span><span class="s2">,</span>
    <span class="s3">'keyboard-inset-bottom'</span><span class="s2">,</span>
    <span class="s3">'keyboard-inset-left'</span><span class="s2">,</span>
    <span class="s3">'keyboard-inset-width'</span><span class="s2">,</span>
    <span class="s3">'keyboard-inset-height'</span><span class="s2">,</span>

    <span class="s3">'radial-gradient'</span><span class="s2">,</span>
    <span class="s3">'linear-gradient'</span><span class="s2">,</span>
    <span class="s3">'conic-gradient'</span><span class="s2">,</span>
    <span class="s3">'repeating-radial-gradient'</span><span class="s2">,</span>
    <span class="s3">'repeating-linear-gradient'</span><span class="s2">,</span>
    <span class="s3">'repeating-conic-gradient'</span><span class="s2">,</span>

    <span class="s3">'anchor-size'</span><span class="s2">,</span>
  <span class="s2">]</span>

  <span class="s0">return </span><span class="s1">value</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/(calc|min|max|clamp)\(.+\)/g</span><span class="s2">, (</span><span class="s1">match</span><span class="s2">) =&gt; {</span>
    <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s3">''</span>

    <span class="s0">function </span><span class="s1">lastChar</span><span class="s2">() {</span>
      <span class="s0">let </span><span class="s1">char </span><span class="s2">= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">trimEnd</span><span class="s2">()</span>
      <span class="s0">return </span><span class="s1">char</span><span class="s2">[</span><span class="s1">char</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span><span class="s2">]</span>
    <span class="s2">}</span>

    <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">i </span><span class="s2">= </span><span class="s6">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">match</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s0">function </span><span class="s1">peek</span><span class="s2">(</span><span class="s1">word</span><span class="s2">) {</span>
        <span class="s0">return </span><span class="s1">word</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s3">''</span><span class="s2">).</span><span class="s1">every</span><span class="s2">((</span><span class="s1">char</span><span class="s2">, </span><span class="s1">j</span><span class="s2">) =&gt; </span><span class="s1">match</span><span class="s2">[</span><span class="s1">i </span><span class="s2">+ </span><span class="s1">j</span><span class="s2">] === </span><span class="s1">char</span><span class="s2">)</span>
      <span class="s2">}</span>

      <span class="s0">function </span><span class="s1">consumeUntil</span><span class="s2">(</span><span class="s1">chars</span><span class="s2">) {</span>
        <span class="s0">let </span><span class="s1">minIndex </span><span class="s2">= </span><span class="s1">Infinity</span>
        <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">char of chars</span><span class="s2">) {</span>
          <span class="s0">let </span><span class="s1">index </span><span class="s2">= </span><span class="s1">match</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">char</span><span class="s2">, </span><span class="s1">i</span><span class="s2">)</span>
          <span class="s0">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">!== -</span><span class="s6">1 </span><span class="s2">&amp;&amp; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">minIndex</span><span class="s2">) {</span>
            <span class="s1">minIndex </span><span class="s2">= </span><span class="s1">index</span>
          <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s1">match</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s1">minIndex</span><span class="s2">)</span>
        <span class="s1">i </span><span class="s2">+= </span><span class="s1">result</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span>
        <span class="s0">return </span><span class="s1">result</span>
      <span class="s2">}</span>

      <span class="s0">let </span><span class="s1">char </span><span class="s2">= </span><span class="s1">match</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]</span>

      <span class="s4">// Handle `var(--variable)`</span>
      <span class="s0">if </span><span class="s2">(</span><span class="s1">peek</span><span class="s2">(</span><span class="s3">'var'</span><span class="s2">)) {</span>
        <span class="s4">// When we consume until `)`, then we are dealing with this scenario:</span>
        <span class="s4">//   `var(--example)`</span>
        <span class="s4">//</span>
        <span class="s4">// When we consume until `,`, then we are dealing with this scenario:</span>
        <span class="s4">//   `var(--example, 1rem)`</span>
        <span class="s4">//</span>
        <span class="s4">//   In this case we do want to &quot;format&quot;, the default value as well</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">consumeUntil</span><span class="s2">([</span><span class="s3">')'</span><span class="s2">, </span><span class="s3">','</span><span class="s2">])</span>
      <span class="s2">}</span>

      <span class="s4">// Skip formatting of known keywords</span>
      <span class="s0">else if </span><span class="s2">(</span><span class="s1">preventFormattingKeywords</span><span class="s2">.</span><span class="s1">some</span><span class="s2">((</span><span class="s1">keyword</span><span class="s2">) =&gt; </span><span class="s1">peek</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">))) {</span>
        <span class="s0">let </span><span class="s1">keyword </span><span class="s2">= </span><span class="s1">preventFormattingKeywords</span><span class="s2">.</span><span class="s1">find</span><span class="s2">((</span><span class="s1">keyword</span><span class="s2">) =&gt; </span><span class="s1">peek</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">))</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">keyword</span>
        <span class="s1">i </span><span class="s2">+= </span><span class="s1">keyword</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s6">1</span>
      <span class="s2">}</span>

      <span class="s4">// Skip formatting inside known functions</span>
      <span class="s0">else if </span><span class="s2">(</span><span class="s1">preventFormattingInFunctions</span><span class="s2">.</span><span class="s1">some</span><span class="s2">((</span><span class="s1">fn</span><span class="s2">) =&gt; </span><span class="s1">peek</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">))) {</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">consumeUntil</span><span class="s2">([</span><span class="s3">')'</span><span class="s2">])</span>
      <span class="s2">}</span>

      <span class="s4">// Don't break CSS grid track names</span>
      <span class="s0">else if </span><span class="s2">(</span><span class="s1">peek</span><span class="s2">(</span><span class="s3">'['</span><span class="s2">)) {</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">consumeUntil</span><span class="s2">([</span><span class="s3">']'</span><span class="s2">])</span>
      <span class="s2">}</span>

      <span class="s4">// Handle operators</span>
      <span class="s0">else if </span><span class="s2">(</span>
        <span class="s2">[</span><span class="s3">'+'</span><span class="s2">, </span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'*'</span><span class="s2">, </span><span class="s3">'/'</span><span class="s2">].</span><span class="s1">includes</span><span class="s2">(</span><span class="s1">char</span><span class="s2">) &amp;&amp;</span>
        <span class="s2">![</span><span class="s3">'('</span><span class="s2">, </span><span class="s3">'+'</span><span class="s2">, </span><span class="s3">'-'</span><span class="s2">, </span><span class="s3">'*'</span><span class="s2">, </span><span class="s3">'/'</span><span class="s2">, </span><span class="s3">','</span><span class="s2">].</span><span class="s1">includes</span><span class="s2">(</span><span class="s1">lastChar</span><span class="s2">())</span>
      <span class="s2">) {</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s3">` </span><span class="s1">$</span><span class="s2">{</span><span class="s1">char</span><span class="s2">} </span><span class="s3">`</span>
      <span class="s2">} </span><span class="s0">else </span><span class="s2">{</span>
        <span class="s1">result </span><span class="s2">+= </span><span class="s1">char</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s4">// Simplify multiple spaces</span>
    <span class="s0">return </span><span class="s1">result</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s5">/\s+/g</span><span class="s2">, </span><span class="s3">' '</span><span class="s2">)</span>
  <span class="s2">})</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">url</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">value</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'url('</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">number</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s2">!</span><span class="s1">isNaN</span><span class="s2">(</span><span class="s1">Number</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) || </span><span class="s1">isCSSFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">percentage</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">endsWith</span><span class="s2">(</span><span class="s3">'%'</span><span class="s2">) &amp;&amp; </span><span class="s1">number</span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s6">0</span><span class="s2">, -</span><span class="s6">1</span><span class="s2">))) || </span><span class="s1">isCSSFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s4">// Please refer to MDN when updating this list:</span>
<span class="s4">// https://developer.mozilla.org/en-US/docs/Learn/CSS/Building_blocks/Values_and_units</span>
<span class="s4">// https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Container_Queries#container_query_length_units</span>
<span class="s0">let </span><span class="s1">lengthUnits </span><span class="s2">= [</span>
  <span class="s3">'cm'</span><span class="s2">,</span>
  <span class="s3">'mm'</span><span class="s2">,</span>
  <span class="s3">'Q'</span><span class="s2">,</span>
  <span class="s3">'in'</span><span class="s2">,</span>
  <span class="s3">'pc'</span><span class="s2">,</span>
  <span class="s3">'pt'</span><span class="s2">,</span>
  <span class="s3">'px'</span><span class="s2">,</span>
  <span class="s3">'em'</span><span class="s2">,</span>
  <span class="s3">'ex'</span><span class="s2">,</span>
  <span class="s3">'ch'</span><span class="s2">,</span>
  <span class="s3">'rem'</span><span class="s2">,</span>
  <span class="s3">'lh'</span><span class="s2">,</span>
  <span class="s3">'rlh'</span><span class="s2">,</span>
  <span class="s3">'vw'</span><span class="s2">,</span>
  <span class="s3">'vh'</span><span class="s2">,</span>
  <span class="s3">'vmin'</span><span class="s2">,</span>
  <span class="s3">'vmax'</span><span class="s2">,</span>
  <span class="s3">'vb'</span><span class="s2">,</span>
  <span class="s3">'vi'</span><span class="s2">,</span>
  <span class="s3">'svw'</span><span class="s2">,</span>
  <span class="s3">'svh'</span><span class="s2">,</span>
  <span class="s3">'lvw'</span><span class="s2">,</span>
  <span class="s3">'lvh'</span><span class="s2">,</span>
  <span class="s3">'dvw'</span><span class="s2">,</span>
  <span class="s3">'dvh'</span><span class="s2">,</span>
  <span class="s3">'cqw'</span><span class="s2">,</span>
  <span class="s3">'cqh'</span><span class="s2">,</span>
  <span class="s3">'cqi'</span><span class="s2">,</span>
  <span class="s3">'cqb'</span><span class="s2">,</span>
  <span class="s3">'cqmin'</span><span class="s2">,</span>
  <span class="s3">'cqmax'</span><span class="s2">,</span>
<span class="s2">]</span>
<span class="s0">let </span><span class="s1">lengthUnitsPattern </span><span class="s2">= </span><span class="s3">`(?:</span><span class="s1">$</span><span class="s2">{</span><span class="s1">lengthUnits</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s3">'|'</span><span class="s2">)}</span><span class="s3">)`</span>
<span class="s0">export function </span><span class="s1">length</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s2">(</span>
    <span class="s1">value </span><span class="s2">=== </span><span class="s3">'0' </span><span class="s2">||</span>
    <span class="s0">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s3">`^[+-]?[0-9]*</span><span class="s0">\.</span><span class="s3">?[0-9]+(?:[eE][+-]?[0-9]+)?</span><span class="s1">$</span><span class="s2">{</span><span class="s1">lengthUnitsPattern</span><span class="s2">}</span><span class="s3">$`</span><span class="s2">).</span><span class="s1">test</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) ||</span>
    <span class="s1">isCSSFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
  <span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">lineWidths </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span><span class="s3">'thin'</span><span class="s2">, </span><span class="s3">'medium'</span><span class="s2">, </span><span class="s3">'thick'</span><span class="s2">])</span>
<span class="s0">export function </span><span class="s1">lineWidth</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">lineWidths</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">shadow</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">parsedShadows </span><span class="s2">= </span><span class="s1">parseBoxShadowValue</span><span class="s2">(</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>

  <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">parsedShadow of parsedShadows</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(!</span><span class="s1">parsedShadow</span><span class="s2">.</span><span class="s1">valid</span><span class="s2">) {</span>
      <span class="s0">return false</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">return true</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">color</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">colors </span><span class="s2">= </span><span class="s6">0</span>

  <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s1">splitAtTopLevelOnly</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">'_'</span><span class="s2">).</span><span class="s1">every</span><span class="s2">((</span><span class="s1">part</span><span class="s2">) =&gt; {</span>
    <span class="s1">part </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">part</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'var('</span><span class="s2">)) </span><span class="s0">return true</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">parseColor</span><span class="s2">(</span><span class="s1">part</span><span class="s2">, { </span><span class="s1">loose</span><span class="s2">: </span><span class="s0">true </span><span class="s2">}) !== </span><span class="s0">null</span><span class="s2">) </span><span class="s0">return </span><span class="s1">colors</span><span class="s2">++, </span><span class="s0">true</span>

    <span class="s0">return false</span>
  <span class="s2">})</span>

  <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">) </span><span class="s0">return false</span>
  <span class="s0">return </span><span class="s1">colors </span><span class="s2">&gt; </span><span class="s6">0</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">image</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">images </span><span class="s2">= </span><span class="s6">0</span>
  <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s1">splitAtTopLevelOnly</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">','</span><span class="s2">).</span><span class="s1">every</span><span class="s2">((</span><span class="s1">part</span><span class="s2">) =&gt; {</span>
    <span class="s1">part </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">part</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'var('</span><span class="s2">)) </span><span class="s0">return true</span>
    <span class="s0">if </span><span class="s2">(</span>
      <span class="s1">url</span><span class="s2">(</span><span class="s1">part</span><span class="s2">) ||</span>
      <span class="s1">gradient</span><span class="s2">(</span><span class="s1">part</span><span class="s2">) ||</span>
      <span class="s2">[</span><span class="s3">'element('</span><span class="s2">, </span><span class="s3">'image('</span><span class="s2">, </span><span class="s3">'cross-fade('</span><span class="s2">, </span><span class="s3">'image-set('</span><span class="s2">].</span><span class="s1">some</span><span class="s2">((</span><span class="s1">fn</span><span class="s2">) =&gt; </span><span class="s1">part</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">))</span>
    <span class="s2">) {</span>
      <span class="s1">images</span><span class="s2">++</span>
      <span class="s0">return true</span>
    <span class="s2">}</span>

    <span class="s0">return false</span>
  <span class="s2">})</span>

  <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">) </span><span class="s0">return false</span>
  <span class="s0">return </span><span class="s1">images </span><span class="s2">&gt; </span><span class="s6">0</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">gradientTypes </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span>
  <span class="s3">'conic-gradient'</span><span class="s2">,</span>
  <span class="s3">'linear-gradient'</span><span class="s2">,</span>
  <span class="s3">'radial-gradient'</span><span class="s2">,</span>
  <span class="s3">'repeating-conic-gradient'</span><span class="s2">,</span>
  <span class="s3">'repeating-linear-gradient'</span><span class="s2">,</span>
  <span class="s3">'repeating-radial-gradient'</span><span class="s2">,</span>
<span class="s2">])</span>
<span class="s0">export function </span><span class="s1">gradient</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s1">value </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>

  <span class="s0">for </span><span class="s2">(</span><span class="s0">let </span><span class="s1">type of gradientTypes</span><span class="s2">) {</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">`</span><span class="s1">$</span><span class="s2">{</span><span class="s1">type</span><span class="s2">}</span><span class="s3">(`</span><span class="s2">)) {</span>
      <span class="s0">return true</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s0">return false</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">validPositions </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span><span class="s3">'center'</span><span class="s2">, </span><span class="s3">'top'</span><span class="s2">, </span><span class="s3">'right'</span><span class="s2">, </span><span class="s3">'bottom'</span><span class="s2">, </span><span class="s3">'left'</span><span class="s2">])</span>
<span class="s0">export function </span><span class="s1">position</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">positions </span><span class="s2">= </span><span class="s6">0</span>
  <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s1">splitAtTopLevelOnly</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">'_'</span><span class="s2">).</span><span class="s1">every</span><span class="s2">((</span><span class="s1">part</span><span class="s2">) =&gt; {</span>
    <span class="s1">part </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">part</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'var('</span><span class="s2">)) </span><span class="s0">return true</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">validPositions</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">part</span><span class="s2">) || </span><span class="s1">length</span><span class="s2">(</span><span class="s1">part</span><span class="s2">) || </span><span class="s1">percentage</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)) {</span>
      <span class="s1">positions</span><span class="s2">++</span>
      <span class="s0">return true</span>
    <span class="s2">}</span>

    <span class="s0">return false</span>
  <span class="s2">})</span>

  <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">) </span><span class="s0">return false</span>
  <span class="s0">return </span><span class="s1">positions </span><span class="s2">&gt; </span><span class="s6">0</span>
<span class="s2">}</span>

<span class="s0">export function </span><span class="s1">familyName</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">let </span><span class="s1">fonts </span><span class="s2">= </span><span class="s6">0</span>
  <span class="s0">let </span><span class="s1">result </span><span class="s2">= </span><span class="s1">splitAtTopLevelOnly</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">','</span><span class="s2">).</span><span class="s1">every</span><span class="s2">((</span><span class="s1">part</span><span class="s2">) =&gt; {</span>
    <span class="s1">part </span><span class="s2">= </span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)</span>

    <span class="s0">if </span><span class="s2">(</span><span class="s1">part</span><span class="s2">.</span><span class="s1">startsWith</span><span class="s2">(</span><span class="s3">'var('</span><span class="s2">)) </span><span class="s0">return true</span>

    <span class="s4">// If it contains spaces, then it should be quoted</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s1">part</span><span class="s2">.</span><span class="s1">includes</span><span class="s2">(</span><span class="s3">' '</span><span class="s2">)) {</span>
      <span class="s0">if </span><span class="s2">(!</span><span class="s5">/(['&quot;])([^&quot;']+)\1/g</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)) {</span>
        <span class="s0">return false</span>
      <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s4">// If it starts with a number, it's invalid</span>
    <span class="s0">if </span><span class="s2">(</span><span class="s5">/^\d/g</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">part</span><span class="s2">)) {</span>
      <span class="s0">return false</span>
    <span class="s2">}</span>

    <span class="s1">fonts</span><span class="s2">++</span>

    <span class="s0">return true</span>
  <span class="s2">})</span>

  <span class="s0">if </span><span class="s2">(!</span><span class="s1">result</span><span class="s2">) </span><span class="s0">return false</span>
  <span class="s0">return </span><span class="s1">fonts </span><span class="s2">&gt; </span><span class="s6">0</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">genericNames </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span>
  <span class="s3">'serif'</span><span class="s2">,</span>
  <span class="s3">'sans-serif'</span><span class="s2">,</span>
  <span class="s3">'monospace'</span><span class="s2">,</span>
  <span class="s3">'cursive'</span><span class="s2">,</span>
  <span class="s3">'fantasy'</span><span class="s2">,</span>
  <span class="s3">'system-ui'</span><span class="s2">,</span>
  <span class="s3">'ui-serif'</span><span class="s2">,</span>
  <span class="s3">'ui-sans-serif'</span><span class="s2">,</span>
  <span class="s3">'ui-monospace'</span><span class="s2">,</span>
  <span class="s3">'ui-rounded'</span><span class="s2">,</span>
  <span class="s3">'math'</span><span class="s2">,</span>
  <span class="s3">'emoji'</span><span class="s2">,</span>
  <span class="s3">'fangsong'</span><span class="s2">,</span>
<span class="s2">])</span>
<span class="s0">export function </span><span class="s1">genericName</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">genericNames</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">absoluteSizes </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span>
  <span class="s3">'xx-small'</span><span class="s2">,</span>
  <span class="s3">'x-small'</span><span class="s2">,</span>
  <span class="s3">'small'</span><span class="s2">,</span>
  <span class="s3">'medium'</span><span class="s2">,</span>
  <span class="s3">'large'</span><span class="s2">,</span>
  <span class="s3">'x-large'</span><span class="s2">,</span>
  <span class="s3">'xx-large'</span><span class="s2">,</span>
  <span class="s3">'xxx-large'</span><span class="s2">,</span>
<span class="s2">])</span>
<span class="s0">export function </span><span class="s1">absoluteSize</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">absoluteSizes</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>

<span class="s0">let </span><span class="s1">relativeSizes </span><span class="s2">= </span><span class="s0">new </span><span class="s1">Set</span><span class="s2">([</span><span class="s3">'larger'</span><span class="s2">, </span><span class="s3">'smaller'</span><span class="s2">])</span>
<span class="s0">export function </span><span class="s1">relativeSize</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s0">return </span><span class="s1">relativeSizes</span><span class="s2">.</span><span class="s1">has</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
<span class="s2">}</span>
</pre>
</body>
</html>