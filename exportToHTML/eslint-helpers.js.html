<html>
<head>
<title>eslint-helpers.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #bcbec4;}
.s5 { color: #7a7e85;}
.s6 { color: #cf8e6d;}
.s7 { color: #42c3d4;}
.s8 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
eslint-helpers.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@fileoverview </span><span class="s0">Helper functions for ESLint class</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Nicholas C. Zakas</span>
 <span class="s0">*/</span>

<span class="s3">&quot;use strict&quot;</span><span class="s4">;</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Requirements</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s6">const </span><span class="s2">path </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;path&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">fs </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;fs&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">fsp </span><span class="s4">= </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">promises</span><span class="s4">;</span>
<span class="s6">const </span><span class="s2">isGlob </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;is-glob&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">hash </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../cli-engine/hash&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">minimatch </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;minimatch&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">fswalk </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;@nodelib/fs.walk&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">globParent </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;glob-parent&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">isPathInside </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;is-path-inside&quot;</span><span class="s4">);</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Fixup references</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s6">const </span><span class="s2">Minimatch </span><span class="s4">= </span><span class="s2">minimatch</span><span class="s4">.</span><span class="s2">Minimatch</span><span class="s4">;</span>
<span class="s6">const </span><span class="s2">MINIMATCH_OPTIONS </span><span class="s4">= { </span><span class="s2">dot</span><span class="s4">: </span><span class="s6">true </span><span class="s4">};</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Types</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} GlobSearch</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Array&lt;string&gt;} patterns The normalized patterns to use for a search.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Array&lt;string&gt;} rawPatterns The patterns as entered by the user</span>
 <span class="s0">*      before doing any normalization.</span>
 <span class="s0">*/</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Errors</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* The error type when no files match a glob.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">NoFilesFoundError </span><span class="s6">extends </span><span class="s2">Error </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} pattern The glob pattern which was not found.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} globEnabled If `false` then the pattern was a glob pattern, but glob was disabled.</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">globEnabled</span><span class="s4">) {</span>
        <span class="s6">super</span><span class="s4">(</span><span class="s3">`No files matching '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pattern</span><span class="s4">}</span><span class="s3">' were found</span><span class="s2">$</span><span class="s4">{!</span><span class="s2">globEnabled </span><span class="s4">? </span><span class="s3">&quot; (glob was disabled)&quot; </span><span class="s4">: </span><span class="s3">&quot;&quot;</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">);</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">messageTemplate </span><span class="s4">= </span><span class="s3">&quot;file-not-found&quot;</span><span class="s4">;</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">messageData </span><span class="s4">= { </span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">globDisabled</span><span class="s4">: !</span><span class="s2">globEnabled </span><span class="s4">};</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* The error type when a search fails to match multiple patterns.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">UnmatchedSearchPatternsError </span><span class="s6">extends </span><span class="s2">Error </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options The options for the error.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.basePath The directory that was searched.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.unmatchedPatterns The glob patterns</span>
     <span class="s0">*      which were not found.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.patterns The glob patterns that were</span>
     <span class="s0">*      searched.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.rawPatterns The raw glob patterns that</span>
     <span class="s0">*      were searched.</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">({ </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">unmatchedPatterns</span><span class="s4">, </span><span class="s2">patterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">}) {</span>
        <span class="s6">super</span><span class="s4">(</span><span class="s3">`No files matching '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rawPatterns</span><span class="s4">}</span><span class="s3">' in '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">basePath</span><span class="s4">}</span><span class="s3">' were found.`</span><span class="s4">);</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">basePath </span><span class="s4">= </span><span class="s2">basePath</span><span class="s4">;</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">unmatchedPatterns </span><span class="s4">= </span><span class="s2">unmatchedPatterns</span><span class="s4">;</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">patterns </span><span class="s4">= </span><span class="s2">patterns</span><span class="s4">;</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">rawPatterns </span><span class="s4">= </span><span class="s2">rawPatterns</span><span class="s4">;</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* The error type when there are files matched by a glob, but all of them have been ignored.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">AllFilesIgnoredError </span><span class="s6">extends </span><span class="s2">Error </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} pattern The glob pattern which was not found.</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">) {</span>
        <span class="s6">super</span><span class="s4">(</span><span class="s3">`All files matched by '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">pattern</span><span class="s4">}</span><span class="s3">' are ignored.`</span><span class="s4">);</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">messageTemplate </span><span class="s4">= </span><span class="s3">&quot;all-files-ignored&quot;</span><span class="s4">;</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">messageData </span><span class="s4">= { </span><span class="s2">pattern </span><span class="s4">};</span>
    <span class="s4">}</span>
<span class="s4">}</span>


<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// General Helpers</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Check if a given value is a non-empty string or not.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x The value to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if `x` is a non-empty string.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">return typeof </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;string&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">x</span><span class="s4">.</span><span class="s2">trim</span><span class="s4">() !== </span><span class="s3">&quot;&quot;</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Check if a given value is an array of non-empty strings or not.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x The value to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if `x` is an array of non-empty strings.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isArrayOfNonEmptyString</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) &amp;&amp; </span><span class="s2">x</span><span class="s4">.</span><span class="s2">every</span><span class="s4">(</span><span class="s2">isNonEmptyString</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// File-related Helpers</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Normalizes slashes in a file pattern to posix-style.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} pattern The pattern to replace slashes in.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The pattern with slashes normalized.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">pattern</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s7">/\\/gu</span><span class="s4">, </span><span class="s3">&quot;/&quot;</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Check if a string is a glob pattern or not.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} pattern A glob pattern.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if the string is a glob pattern.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isGlobPattern</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">isGlob</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">sep </span><span class="s4">=== </span><span class="s3">&quot;</span><span class="s6">\\</span><span class="s3">&quot; </span><span class="s4">? </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">) : </span><span class="s2">pattern</span><span class="s4">);</span>
<span class="s4">}</span>


<span class="s0">/**</span>
 <span class="s0">* Determines if a given glob pattern will return any results.</span>
 <span class="s0">* Used primarily to help with useful error messages.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options The options for the function.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.basePath The directory to search.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.pattern A glob pattern to match.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;boolean&gt;} True if there is a glob match, false if not.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">globMatch</span><span class="s4">({ </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">pattern </span><span class="s4">}) {</span>

    <span class="s6">let </span><span class="s2">found </span><span class="s4">= </span><span class="s6">false</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">patternToUse </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">isAbsolute</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">)</span>
        <span class="s4">? </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">pattern</span><span class="s4">))</span>
        <span class="s4">: </span><span class="s2">pattern</span><span class="s4">;</span>

    <span class="s6">const </span><span class="s2">matcher </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Minimatch</span><span class="s4">(</span><span class="s2">patternToUse</span><span class="s4">, </span><span class="s2">MINIMATCH_OPTIONS</span><span class="s4">);</span>

    <span class="s6">const </span><span class="s2">fsWalkSettings </span><span class="s4">= {</span>

        <span class="s2">deepFilter</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">relativePath </span><span class="s4">= </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">));</span>

            <span class="s6">return </span><span class="s4">!</span><span class="s2">found </span><span class="s4">&amp;&amp; </span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">, </span><span class="s6">true</span><span class="s4">);</span>
        <span class="s4">},</span>

        <span class="s2">entryFilter</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">found </span><span class="s4">|| </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">dirent</span><span class="s4">.</span><span class="s2">isDirectory</span><span class="s4">()) {</span>
                <span class="s6">return false</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">relativePath </span><span class="s4">= </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">));</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">)) {</span>
                <span class="s2">found </span><span class="s4">= </span><span class="s6">true</span><span class="s4">;</span>
                <span class="s6">return true</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">return false</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">};</span>

    <span class="s6">return new </span><span class="s2">Promise</span><span class="s4">(</span><span class="s2">resolve </span><span class="s4">=&gt; {</span>

        <span class="s5">// using a stream so we can exit early because we just need one match</span>
        <span class="s6">const </span><span class="s2">globStream </span><span class="s4">= </span><span class="s2">fswalk</span><span class="s4">.</span><span class="s2">walkStream</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">fsWalkSettings</span><span class="s4">);</span>

        <span class="s2">globStream</span><span class="s4">.</span><span class="s2">on</span><span class="s4">(</span><span class="s3">&quot;data&quot;</span><span class="s4">, () =&gt; {</span>
            <span class="s2">globStream</span><span class="s4">.</span><span class="s2">destroy</span><span class="s4">();</span>
            <span class="s2">resolve</span><span class="s4">(</span><span class="s6">true</span><span class="s4">);</span>
        <span class="s4">});</span>

        <span class="s5">// swallow errors as they're not important here</span>
        <span class="s2">globStream</span><span class="s4">.</span><span class="s2">on</span><span class="s4">(</span><span class="s3">&quot;error&quot;</span><span class="s4">, () =&gt; { });</span>

        <span class="s2">globStream</span><span class="s4">.</span><span class="s2">on</span><span class="s4">(</span><span class="s3">&quot;end&quot;</span><span class="s4">, () =&gt; {</span>
            <span class="s2">resolve</span><span class="s4">(</span><span class="s6">false</span><span class="s4">);</span>
        <span class="s4">});</span>
        <span class="s2">globStream</span><span class="s4">.</span><span class="s2">read</span><span class="s4">();</span>
    <span class="s4">});</span>

<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Searches a directory looking for matching glob patterns. This uses</span>
 <span class="s0">* the config array's logic to determine if a directory or file should</span>
 <span class="s0">* be ignored, so it is consistent with how ignoring works throughout</span>
 <span class="s0">* ESLint.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options The options for this function.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.basePath The directory to search.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.patterns An array of glob patterns</span>
 <span class="s0">*      to match.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.rawPatterns An array of glob patterns</span>
 <span class="s0">*      as the user inputted them. Used for errors.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} options.configs The config array to use for</span>
 <span class="s0">*      determining what to ignore.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} options.errorOnUnmatchedPattern Determines if an error</span>
 <span class="s0">*      should be thrown when a pattern is unmatched.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;Array&lt;string&gt;&gt;} An array of matching file paths</span>
 <span class="s0">*      or an empty array if there are no matches.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{UnmatchedSearchPatternsError} If there is a pattern that doesn't</span>
 <span class="s0">*      match any files.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">globSearch</span><span class="s4">({</span>
    <span class="s2">basePath</span><span class="s4">,</span>
    <span class="s2">patterns</span><span class="s4">,</span>
    <span class="s2">rawPatterns</span><span class="s4">,</span>
    <span class="s2">configs</span><span class="s4">,</span>
    <span class="s2">errorOnUnmatchedPattern</span>
<span class="s4">}) {</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">patterns</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s8">0</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s4">[];</span>
    <span class="s4">}</span>

    <span class="s5">/* 
     * In this section we are converting the patterns into Minimatch 
     * instances for performance reasons. Because we are doing the same 
     * matches repeatedly, it's best to compile those patterns once and 
     * reuse them multiple times. 
     * 
     * To do that, we convert any patterns with an absolute path into a 
     * relative path and normalize it to Posix-style slashes. We also keep 
     * track of the relative patterns to map them back to the original 
     * patterns, which we need in order to throw an error if there are any 
     * unmatched patterns. 
     */</span>
    <span class="s6">const </span><span class="s2">relativeToPatterns </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">();</span>
    <span class="s6">const </span><span class="s2">matchers </span><span class="s4">= </span><span class="s2">patterns</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">pattern</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; {</span>
        <span class="s6">const </span><span class="s2">patternToUse </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">isAbsolute</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">)</span>
            <span class="s4">? </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">pattern</span><span class="s4">))</span>
            <span class="s4">: </span><span class="s2">pattern</span><span class="s4">;</span>

        <span class="s2">relativeToPatterns</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">patternToUse</span><span class="s4">, </span><span class="s2">patterns</span><span class="s4">[</span><span class="s2">i</span><span class="s4">]);</span>

        <span class="s6">return new </span><span class="s2">Minimatch</span><span class="s4">(</span><span class="s2">patternToUse</span><span class="s4">, </span><span class="s2">MINIMATCH_OPTIONS</span><span class="s4">);</span>
    <span class="s4">});</span>

    <span class="s5">/* 
     * We track unmatched patterns because we may want to throw an error when 
     * they occur. To start, this set is initialized with all of the patterns. 
     * Every time a match occurs, the pattern is removed from the set, making 
     * it easy to tell if we have any unmatched patterns left at the end of 
     * search. 
     */</span>
    <span class="s6">const </span><span class="s2">unmatchedPatterns </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s2">...relativeToPatterns</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">()]);</span>

    <span class="s6">const </span><span class="s2">filePaths </span><span class="s4">= (</span><span class="s6">await new </span><span class="s2">Promise</span><span class="s4">((</span><span class="s2">resolve</span><span class="s4">, </span><span class="s2">reject</span><span class="s4">) =&gt; {</span>

        <span class="s6">let </span><span class="s2">promiseRejected </span><span class="s4">= </span><span class="s6">false</span><span class="s4">;</span>

        <span class="s0">/**</span>
         <span class="s0">* Wraps a boolean-returning filter function. The wrapped function will reject the promise if an error occurs.</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function} filter A filter function to wrap.</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Function} A function similar to the wrapped filter that rejects the promise if an error occurs.</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">wrapFilter</span><span class="s4">(</span><span class="s2">filter</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) =&gt; {</span>

                <span class="s5">// No need to run the filter if an error has been thrown.</span>
                <span class="s6">if </span><span class="s4">(!</span><span class="s2">promiseRejected</span><span class="s4">) {</span>
                    <span class="s6">try </span><span class="s4">{</span>
                        <span class="s6">return </span><span class="s2">filter</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">);</span>
                    <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
                        <span class="s2">promiseRejected </span><span class="s4">= </span><span class="s6">true</span><span class="s4">;</span>
                        <span class="s2">reject</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>
                <span class="s6">return false</span><span class="s4">;</span>
            <span class="s4">};</span>
        <span class="s4">}</span>

        <span class="s2">fswalk</span><span class="s4">.</span><span class="s2">walk</span><span class="s4">(</span>
            <span class="s2">basePath</span><span class="s4">,</span>
            <span class="s4">{</span>
                <span class="s2">deepFilter</span><span class="s4">: </span><span class="s2">wrapFilter</span><span class="s4">(</span><span class="s2">entry </span><span class="s4">=&gt; {</span>
                    <span class="s6">const </span><span class="s2">relativePath </span><span class="s4">= </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">));</span>
                    <span class="s6">const </span><span class="s2">matchesPattern </span><span class="s4">= </span><span class="s2">matchers</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span><span class="s2">matcher </span><span class="s4">=&gt; </span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">, </span><span class="s6">true</span><span class="s4">));</span>

                    <span class="s6">return </span><span class="s2">matchesPattern </span><span class="s4">&amp;&amp; !</span><span class="s2">configs</span><span class="s4">.</span><span class="s2">isDirectoryIgnored</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">);</span>
                <span class="s4">}),</span>
                <span class="s2">entryFilter</span><span class="s4">: </span><span class="s2">wrapFilter</span><span class="s4">(</span><span class="s2">entry </span><span class="s4">=&gt; {</span>
                    <span class="s6">const </span><span class="s2">relativePath </span><span class="s4">= </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">));</span>

                    <span class="s5">// entries may be directories or files so filter out directories</span>
                    <span class="s6">if </span><span class="s4">(</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">dirent</span><span class="s4">.</span><span class="s2">isDirectory</span><span class="s4">()) {</span>
                        <span class="s6">return false</span><span class="s4">;</span>
                    <span class="s4">}</span>

                    <span class="s5">/* 
                     * Optimization: We need to track when patterns are left unmatched 
                     * and so we use `unmatchedPatterns` to do that. There is a bit of 
                     * complexity here because the same file can be matched by more than 
                     * one pattern. So, when we start, we actually need to test every 
                     * pattern against every file. Once we know there are no remaining 
                     * unmatched patterns, then we can switch to just looking for the 
                     * first matching pattern for improved speed. 
                     */</span>
                    <span class="s6">const </span><span class="s2">matchesPattern </span><span class="s4">= </span><span class="s2">unmatchedPatterns</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s8">0</span>
                        <span class="s4">? </span><span class="s2">matchers</span><span class="s4">.</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">previousValue</span><span class="s4">, </span><span class="s2">matcher</span><span class="s4">) =&gt; {</span>
                            <span class="s6">const </span><span class="s2">pathMatches </span><span class="s4">= </span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">);</span>

                            <span class="s5">/* 
                             * We updated the unmatched patterns set only if the path 
                             * matches and the file isn't ignored. If the file is 
                             * ignored, that means there wasn't a match for the 
                             * pattern so it should not be removed. 
                             * 
                             * Performance note: isFileIgnored() aggressively caches 
                             * results so there is no performance penalty for calling 
                             * it twice with the same argument. 
                             */</span>
                            <span class="s6">if </span><span class="s4">(</span><span class="s2">pathMatches </span><span class="s4">&amp;&amp; !</span><span class="s2">configs</span><span class="s4">.</span><span class="s2">isFileIgnored</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">)) {</span>
                                <span class="s2">unmatchedPatterns</span><span class="s4">.</span><span class="s2">delete</span><span class="s4">(</span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">pattern</span><span class="s4">);</span>
                            <span class="s4">}</span>

                            <span class="s6">return </span><span class="s2">pathMatches </span><span class="s4">|| </span><span class="s2">previousValue</span><span class="s4">;</span>
                        <span class="s4">}, </span><span class="s6">false</span><span class="s4">)</span>
                        <span class="s4">: </span><span class="s2">matchers</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span><span class="s2">matcher </span><span class="s4">=&gt; </span><span class="s2">matcher</span><span class="s4">.</span><span class="s2">match</span><span class="s4">(</span><span class="s2">relativePath</span><span class="s4">));</span>

                    <span class="s6">return </span><span class="s2">matchesPattern </span><span class="s4">&amp;&amp; !</span><span class="s2">configs</span><span class="s4">.</span><span class="s2">isFileIgnored</span><span class="s4">(</span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">);</span>
                <span class="s4">})</span>
            <span class="s4">},</span>
            <span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s2">entries</span><span class="s4">) =&gt; {</span>

                <span class="s5">// If the promise is already rejected, calling `resolve` or `reject` will do nothing.</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
                    <span class="s2">reject</span><span class="s4">(</span><span class="s2">error</span><span class="s4">);</span>
                <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                    <span class="s2">resolve</span><span class="s4">(</span><span class="s2">entries</span><span class="s4">);</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">);</span>
    <span class="s4">})).</span><span class="s2">map</span><span class="s4">(</span><span class="s2">entry </span><span class="s4">=&gt; </span><span class="s2">entry</span><span class="s4">.</span><span class="s2">path</span><span class="s4">);</span>

    <span class="s5">// now check to see if we have any unmatched patterns</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">errorOnUnmatchedPattern </span><span class="s4">&amp;&amp; </span><span class="s2">unmatchedPatterns</span><span class="s4">.</span><span class="s2">size </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
        <span class="s6">throw new </span><span class="s2">UnmatchedSearchPatternsError</span><span class="s4">({</span>
            <span class="s2">basePath</span><span class="s4">,</span>
            <span class="s2">unmatchedPatterns</span><span class="s4">: [</span><span class="s2">...unmatchedPatterns</span><span class="s4">].</span><span class="s2">map</span><span class="s4">(</span>
                <span class="s2">pattern </span><span class="s4">=&gt; </span><span class="s2">relativeToPatterns</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">)</span>
            <span class="s4">),</span>
            <span class="s2">patterns</span><span class="s4">,</span>
            <span class="s2">rawPatterns</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">filePaths</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Throws an error for unmatched patterns. The error will only contain information about the first one.</span>
 <span class="s0">* Checks to see if there are any ignored results for a given search.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options The options for this function.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.basePath The directory to search.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.patterns An array of glob patterns</span>
 <span class="s0">*      that were used in the original search.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.rawPatterns An array of glob patterns</span>
 <span class="s0">*      as the user inputted them. Used for errors.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} options.unmatchedPatterns A non-empty array of glob patterns</span>
 <span class="s0">*      that were unmatched in the original search.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void} Always throws an error.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{NoFilesFoundError} If the first unmatched pattern</span>
 <span class="s0">*      doesn't match any files even when there are no ignores.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{AllFilesIgnoredError} If the first unmatched pattern</span>
 <span class="s0">*      matches some files when there are no ignores.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">throwErrorForUnmatchedPatterns</span><span class="s4">({</span>
    <span class="s2">basePath</span><span class="s4">,</span>
    <span class="s2">patterns</span><span class="s4">,</span>
    <span class="s2">rawPatterns</span><span class="s4">,</span>
    <span class="s2">unmatchedPatterns</span>
<span class="s4">}) {</span>

    <span class="s6">const </span><span class="s2">pattern </span><span class="s4">= </span><span class="s2">unmatchedPatterns</span><span class="s4">[</span><span class="s8">0</span><span class="s4">];</span>
    <span class="s6">const </span><span class="s2">rawPattern </span><span class="s4">= </span><span class="s2">rawPatterns</span><span class="s4">[</span><span class="s2">patterns</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">)];</span>

    <span class="s6">const </span><span class="s2">patternHasMatch </span><span class="s4">= </span><span class="s6">await </span><span class="s2">globMatch</span><span class="s4">({</span>
        <span class="s2">basePath</span><span class="s4">,</span>
        <span class="s2">pattern</span>
    <span class="s4">});</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">patternHasMatch</span><span class="s4">) {</span>
        <span class="s6">throw new </span><span class="s2">AllFilesIgnoredError</span><span class="s4">(</span><span class="s2">rawPattern</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s5">// if we get here there are truly no matches</span>
    <span class="s6">throw new </span><span class="s2">NoFilesFoundError</span><span class="s4">(</span><span class="s2">rawPattern</span><span class="s4">, </span><span class="s6">true</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Performs multiple glob searches in parallel.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options The options for this function.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Map&lt;string,GlobSearch&gt;} options.searches</span>
 <span class="s0">*      An array of glob patterns to match.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} options.configs The config array to use for</span>
 <span class="s0">*      determining what to ignore.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} options.errorOnUnmatchedPattern Determines if an</span>
 <span class="s0">*      unmatched glob pattern should throw an error.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;Array&lt;string&gt;&gt;} An array of matching file paths</span>
 <span class="s0">*      or an empty array if there are no matches.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">globMultiSearch</span><span class="s4">({ </span><span class="s2">searches</span><span class="s4">, </span><span class="s2">configs</span><span class="s4">, </span><span class="s2">errorOnUnmatchedPattern </span><span class="s4">}) {</span>

    <span class="s5">/* 
     * For convenience, we normalized the search map into an array of objects. 
     * Next, we filter out all searches that have no patterns. This happens 
     * primarily for the cwd, which is prepopulated in the searches map as an 
     * optimization. However, if it has no patterns, it means all patterns 
     * occur outside of the cwd and we can safely filter out that search. 
     */</span>
    <span class="s6">const </span><span class="s2">normalizedSearches </span><span class="s4">= [</span><span class="s2">...searches</span><span class="s4">].</span><span class="s2">map</span><span class="s4">(</span>
        <span class="s4">([</span><span class="s2">basePath</span><span class="s4">, { </span><span class="s2">patterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">}]) =&gt; ({ </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">patterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">})</span>
    <span class="s4">).</span><span class="s2">filter</span><span class="s4">(({ </span><span class="s2">patterns </span><span class="s4">}) =&gt; </span><span class="s2">patterns</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">);</span>

    <span class="s6">const </span><span class="s2">results </span><span class="s4">= </span><span class="s6">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">allSettled</span><span class="s4">(</span>
        <span class="s2">normalizedSearches</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
            <span class="s4">({ </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">patterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">}) =&gt; </span><span class="s2">globSearch</span><span class="s4">({</span>
                <span class="s2">basePath</span><span class="s4">,</span>
                <span class="s2">patterns</span><span class="s4">,</span>
                <span class="s2">rawPatterns</span><span class="s4">,</span>
                <span class="s2">configs</span><span class="s4">,</span>
                <span class="s2">errorOnUnmatchedPattern</span>
            <span class="s4">})</span>
        <span class="s4">)</span>
    <span class="s4">);</span>

    <span class="s6">const </span><span class="s2">filePaths </span><span class="s4">= [];</span>

    <span class="s6">for </span><span class="s4">(</span><span class="s6">let </span><span class="s2">i </span><span class="s4">= </span><span class="s8">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">results</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>

        <span class="s6">const </span><span class="s2">result </span><span class="s4">= </span><span class="s2">results</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
        <span class="s6">const </span><span class="s2">currentSearch </span><span class="s4">= </span><span class="s2">normalizedSearches</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">status </span><span class="s4">=== </span><span class="s3">&quot;fulfilled&quot;</span><span class="s4">) {</span>

            <span class="s5">// if the search was successful just add the results</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">value</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
                <span class="s2">filePaths</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...result</span><span class="s4">.</span><span class="s2">value</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">continue</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s5">// if we make it here then there was an error</span>
        <span class="s6">const </span><span class="s2">error </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">reason</span><span class="s4">;</span>

        <span class="s5">// unexpected errors should be re-thrown</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">error</span><span class="s4">.</span><span class="s2">basePath</span><span class="s4">) {</span>
            <span class="s6">throw </span><span class="s2">error</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">errorOnUnmatchedPattern</span><span class="s4">) {</span>

            <span class="s6">await </span><span class="s2">throwErrorForUnmatchedPatterns</span><span class="s4">({</span>
                <span class="s2">...currentSearch</span><span class="s4">,</span>
                <span class="s2">unmatchedPatterns</span><span class="s4">: </span><span class="s2">error</span><span class="s4">.</span><span class="s2">unmatchedPatterns</span>
            <span class="s4">});</span>

        <span class="s4">}</span>

    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">filePaths</span><span class="s4">;</span>

<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Finds all files matching the options specified.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} args The arguments objects.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;string&gt;} args.patterns An array of glob patterns.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} args.globInputPaths true to interpret glob patterns,</span>
 <span class="s0">*      false to not interpret glob patterns.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} args.cwd The current working directory to find from.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} args.configs The configs for the current run.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} args.errorOnUnmatchedPattern Determines if an unmatched pattern</span>
 <span class="s0">*      should throw an error.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;Array&lt;string&gt;&gt;} The fully resolved file paths.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{AllFilesIgnoredError} If there are no results due to an ignore pattern.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{NoFilesFoundError} If no files matched the given patterns.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">findFiles</span><span class="s4">({</span>
    <span class="s2">patterns</span><span class="s4">,</span>
    <span class="s2">globInputPaths</span><span class="s4">,</span>
    <span class="s2">cwd</span><span class="s4">,</span>
    <span class="s2">configs</span><span class="s4">,</span>
    <span class="s2">errorOnUnmatchedPattern</span>
<span class="s4">}) {</span>

    <span class="s6">const </span><span class="s2">results </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">missingPatterns </span><span class="s4">= [];</span>
    <span class="s6">let </span><span class="s2">globbyPatterns </span><span class="s4">= [];</span>
    <span class="s6">let </span><span class="s2">rawPatterns </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">searches </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">([[</span><span class="s2">cwd</span><span class="s4">, { </span><span class="s2">patterns</span><span class="s4">: </span><span class="s2">globbyPatterns</span><span class="s4">, </span><span class="s2">rawPatterns</span><span class="s4">: [] }]]);</span>

    <span class="s5">// check to see if we have explicit files and directories</span>
    <span class="s6">const </span><span class="s2">filePaths </span><span class="s4">= </span><span class="s2">patterns</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">filePath </span><span class="s4">=&gt; </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">));</span>
    <span class="s6">const </span><span class="s2">stats </span><span class="s4">= </span><span class="s6">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
        <span class="s2">filePaths</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span>
            <span class="s2">filePath </span><span class="s4">=&gt; </span><span class="s2">fsp</span><span class="s4">.</span><span class="s2">stat</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">).</span><span class="s2">catch</span><span class="s4">(() =&gt; { })</span>
        <span class="s4">)</span>
    <span class="s4">);</span>

    <span class="s2">stats</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">stat</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>

        <span class="s6">const </span><span class="s2">filePath </span><span class="s4">= </span><span class="s2">filePaths</span><span class="s4">[</span><span class="s2">index</span><span class="s4">];</span>
        <span class="s6">const </span><span class="s2">pattern </span><span class="s4">= </span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">patterns</span><span class="s4">[</span><span class="s2">index</span><span class="s4">]);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">stat</span><span class="s4">) {</span>

            <span class="s5">// files are added directly to the list</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">stat</span><span class="s4">.</span><span class="s2">isFile</span><span class="s4">()) {</span>
                <span class="s2">results</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s5">// directories need extensions attached</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">stat</span><span class="s4">.</span><span class="s2">isDirectory</span><span class="s4">()) {</span>

                <span class="s5">// group everything in cwd together and split out others</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">isPathInside</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">)) {</span>
                    <span class="s4">({ </span><span class="s2">patterns</span><span class="s4">: </span><span class="s2">globbyPatterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">} = </span><span class="s2">searches</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">));</span>
                <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                    <span class="s6">if </span><span class="s4">(!</span><span class="s2">searches</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">)) {</span>
                        <span class="s2">searches</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, { </span><span class="s2">patterns</span><span class="s4">: [], </span><span class="s2">rawPatterns</span><span class="s4">: [] });</span>
                    <span class="s4">}</span>
                    <span class="s4">({ </span><span class="s2">patterns</span><span class="s4">: </span><span class="s2">globbyPatterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">} = </span><span class="s2">searches</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">));</span>
                <span class="s4">}</span>

                <span class="s2">globbyPatterns</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">normalizeToPosix</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">)}</span><span class="s3">/**`</span><span class="s4">);</span>
                <span class="s2">rawPatterns</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s5">// save patterns for later use based on whether globs are enabled</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">globInputPaths </span><span class="s4">&amp;&amp; </span><span class="s2">isGlobPattern</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">)) {</span>

            <span class="s6">const </span><span class="s2">basePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">globParent</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">));</span>

            <span class="s5">// group in cwd if possible and split out others</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">isPathInside</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">)) {</span>
                <span class="s4">({ </span><span class="s2">patterns</span><span class="s4">: </span><span class="s2">globbyPatterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">} = </span><span class="s2">searches</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">));</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s6">if </span><span class="s4">(!</span><span class="s2">searches</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">)) {</span>
                    <span class="s2">searches</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, { </span><span class="s2">patterns</span><span class="s4">: [], </span><span class="s2">rawPatterns</span><span class="s4">: [] });</span>
                <span class="s4">}</span>
                <span class="s4">({ </span><span class="s2">patterns</span><span class="s4">: </span><span class="s2">globbyPatterns</span><span class="s4">, </span><span class="s2">rawPatterns </span><span class="s4">} = </span><span class="s2">searches</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">));</span>
            <span class="s4">}</span>

            <span class="s2">globbyPatterns</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>
            <span class="s2">rawPatterns</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">missingPatterns</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">pattern</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">});</span>

    <span class="s5">// there were patterns that didn't match anything, tell the user</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">errorOnUnmatchedPattern </span><span class="s4">&amp;&amp; </span><span class="s2">missingPatterns</span><span class="s4">.</span><span class="s2">length</span><span class="s4">) {</span>
        <span class="s6">throw new </span><span class="s2">NoFilesFoundError</span><span class="s4">(</span><span class="s2">missingPatterns</span><span class="s4">[</span><span class="s8">0</span><span class="s4">], </span><span class="s2">globInputPaths</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s5">// now we are safe to do the search</span>
    <span class="s6">const </span><span class="s2">globbyResults </span><span class="s4">= </span><span class="s6">await </span><span class="s2">globMultiSearch</span><span class="s4">({</span>
        <span class="s2">searches</span><span class="s4">,</span>
        <span class="s2">configs</span><span class="s4">,</span>
        <span class="s2">errorOnUnmatchedPattern</span>
    <span class="s4">});</span>

    <span class="s6">return </span><span class="s4">[</span>
        <span class="s2">...</span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span>
            <span class="s2">...results</span><span class="s4">,</span>
            <span class="s2">...globbyResults</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">filePath </span><span class="s4">=&gt; </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">))</span>
        <span class="s4">])</span>
    <span class="s4">];</span>
<span class="s4">}</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Results-related Helpers</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Checks if the given message is an error message.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintMessage} message The message to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} Whether or not the message is an error message.</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isErrorMessage</span><span class="s4">(</span><span class="s2">message</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">message</span><span class="s4">.</span><span class="s2">severity </span><span class="s4">=== </span><span class="s8">2</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Returns result with warning by ignore settings</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filePath File path of checked code</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} baseDir Absolute path of base directory</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintResult} Result with single warning</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createIgnoreResult</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">baseDir</span><span class="s4">) {</span>
    <span class="s6">let </span><span class="s2">message</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">isInNodeModules </span><span class="s4">= </span><span class="s2">baseDir </span><span class="s4">&amp;&amp; </span><span class="s2">path</span><span class="s4">.</span><span class="s2">dirname</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">baseDir</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">)).</span><span class="s2">split</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">sep</span><span class="s4">).</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;node_modules&quot;</span><span class="s4">);</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">isInNodeModules</span><span class="s4">) {</span>
        <span class="s2">message </span><span class="s4">= </span><span class="s3">&quot;File ignored by default because it is located under the node_modules directory. Use ignore pattern </span><span class="s6">\&quot;</span><span class="s3">!**/node_modules/</span><span class="s6">\&quot; </span><span class="s3">to disable file ignore settings or use </span><span class="s6">\&quot;</span><span class="s3">--no-warn-ignored</span><span class="s6">\&quot; </span><span class="s3">to suppress this warning.&quot;</span><span class="s4">;</span>
    <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
        <span class="s2">message </span><span class="s4">= </span><span class="s3">&quot;File ignored because of a matching ignore pattern. Use </span><span class="s6">\&quot;</span><span class="s3">--no-ignore</span><span class="s6">\&quot; </span><span class="s3">to disable file ignore settings or use </span><span class="s6">\&quot;</span><span class="s3">--no-warn-ignored</span><span class="s6">\&quot; </span><span class="s3">to suppress this warning.&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">filePath</span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">),</span>
        <span class="s2">messages</span><span class="s4">: [</span>
            <span class="s4">{</span>
                <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                <span class="s2">fatal</span><span class="s4">: </span><span class="s6">false</span><span class="s4">,</span>
                <span class="s2">severity</span><span class="s4">: </span><span class="s8">1</span><span class="s4">,</span>
                <span class="s2">message</span><span class="s4">,</span>
                <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
            <span class="s4">}</span>
        <span class="s4">],</span>
        <span class="s2">suppressedMessages</span><span class="s4">: [],</span>
        <span class="s2">errorCount</span><span class="s4">: </span><span class="s8">0</span><span class="s4">,</span>
        <span class="s2">warningCount</span><span class="s4">: </span><span class="s8">1</span><span class="s4">,</span>
        <span class="s2">fatalErrorCount</span><span class="s4">: </span><span class="s8">0</span><span class="s4">,</span>
        <span class="s2">fixableErrorCount</span><span class="s4">: </span><span class="s8">0</span><span class="s4">,</span>
        <span class="s2">fixableWarningCount</span><span class="s4">: </span><span class="s8">0</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Options-related Helpers</span>
<span class="s5">//-----------------------------------------------------------------------------</span>


<span class="s0">/**</span>
 <span class="s0">* Check if a given value is a valid fix type or not.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x The value to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if `x` is valid fix type.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isFixType</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;directive&quot; </span><span class="s4">|| </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;problem&quot; </span><span class="s4">|| </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;suggestion&quot; </span><span class="s4">|| </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;layout&quot;</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Check if a given value is an array of fix types or not.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x The value to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if `x` is an array of fix types.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isFixTypeArray</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) &amp;&amp; </span><span class="s2">x</span><span class="s4">.</span><span class="s2">every</span><span class="s4">(</span><span class="s2">isFixType</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* The error for invalid options.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">ESLintInvalidOptionsError </span><span class="s6">extends </span><span class="s2">Error </span><span class="s4">{</span>
    <span class="s2">constructor</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">) {</span>
        <span class="s6">super</span><span class="s4">(</span><span class="s3">`Invalid Options:</span><span class="s6">\n</span><span class="s3">- </span><span class="s2">$</span><span class="s4">{</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;</span><span class="s6">\n</span><span class="s3">- &quot;</span><span class="s4">)}</span><span class="s3">`</span><span class="s4">);</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">code </span><span class="s4">= </span><span class="s3">&quot;ESLINT_INVALID_OPTIONS&quot;</span><span class="s4">;</span>
        <span class="s2">Error</span><span class="s4">.</span><span class="s2">captureStackTrace</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">ESLintInvalidOptionsError</span><span class="s4">);</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Validates and normalizes options for the wrapped CLIEngine instance.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatESLintOptions} options The options to process.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{ESLintInvalidOptionsError} If of any of a variety of type errors.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{FlatESLintOptions} The normalized options.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">processOptions</span><span class="s4">({</span>
    <span class="s2">allowInlineConfig </span><span class="s4">= </span><span class="s6">true</span><span class="s4">, </span><span class="s5">//  we cannot use `overrideConfig.noInlineConfig` instead because `allowInlineConfig` has side-effect that suppress warnings that show inline configs are ignored.</span>
    <span class="s2">baseConfig </span><span class="s4">= </span><span class="s6">null</span><span class="s4">,</span>
    <span class="s2">cache </span><span class="s4">= </span><span class="s6">false</span><span class="s4">,</span>
    <span class="s2">cacheLocation </span><span class="s4">= </span><span class="s3">&quot;.eslintcache&quot;</span><span class="s4">,</span>
    <span class="s2">cacheStrategy </span><span class="s4">= </span><span class="s3">&quot;metadata&quot;</span><span class="s4">,</span>
    <span class="s2">cwd </span><span class="s4">= </span><span class="s2">process</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">(),</span>
    <span class="s2">errorOnUnmatchedPattern </span><span class="s4">= </span><span class="s6">true</span><span class="s4">,</span>
    <span class="s2">fix </span><span class="s4">= </span><span class="s6">false</span><span class="s4">,</span>
    <span class="s2">fixTypes </span><span class="s4">= </span><span class="s6">null</span><span class="s4">, </span><span class="s5">//  should be null by default because if it's an array then it suppresses rules that don't have the `meta.type` property.</span>
    <span class="s2">globInputPaths </span><span class="s4">= </span><span class="s6">true</span><span class="s4">,</span>
    <span class="s2">ignore </span><span class="s4">= </span><span class="s6">true</span><span class="s4">,</span>
    <span class="s2">ignorePatterns </span><span class="s4">= </span><span class="s6">null</span><span class="s4">,</span>
    <span class="s2">overrideConfig </span><span class="s4">= </span><span class="s6">null</span><span class="s4">,</span>
    <span class="s2">overrideConfigFile </span><span class="s4">= </span><span class="s6">null</span><span class="s4">,</span>
    <span class="s2">plugins </span><span class="s4">= {},</span>
    <span class="s2">warnIgnored </span><span class="s4">= </span><span class="s6">true</span><span class="s4">,</span>
    <span class="s2">...unknownOptions</span>
<span class="s4">}) {</span>
    <span class="s6">const </span><span class="s2">errors </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">unknownOptionKeys </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">unknownOptions</span><span class="s4">);</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt;= </span><span class="s8">1</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">`Unknown options: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">`</span><span class="s4">);</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;cacheFile&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'cacheFile' has been removed. Please use the 'cacheLocation' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;configFile&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'configFile' has been removed. Please use the 'overrideConfigFile' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;envs&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'envs' has been removed.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;extensions&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'extensions' has been removed.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;resolvePluginsRelativeTo&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'resolvePluginsRelativeTo' has been removed.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;globals&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'globals' has been removed. Please use the 'overrideConfig.languageOptions.globals' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;ignorePath&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'ignorePath' has been removed.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;ignorePattern&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'ignorePattern' has been removed. Please use the 'overrideConfig.ignorePatterns' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;parser&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'parser' has been removed. Please use the 'overrideConfig.languageOptions.parser' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;parserOptions&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'parserOptions' has been removed. Please use the 'overrideConfig.languageOptions.parserOptions' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;rules&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'rules' has been removed. Please use the 'overrideConfig.rules' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;rulePaths&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'rulePaths' has been removed. Please define your rules using plugins.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;reportUnusedDisableDirectives&quot;</span><span class="s4">)) {</span>
            <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'reportUnusedDisableDirectives' has been removed. Please use the 'overrideConfig.linterOptions.reportUnusedDisableDirectives' option instead.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">allowInlineConfig </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'allowInlineConfig' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">baseConfig </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'baseConfig' must be an object or null.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">cache </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'cache' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">cacheLocation</span><span class="s4">)) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'cacheLocation' must be a non-empty string.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span>
        <span class="s2">cacheStrategy </span><span class="s4">!== </span><span class="s3">&quot;metadata&quot; </span><span class="s4">&amp;&amp;</span>
        <span class="s2">cacheStrategy </span><span class="s4">!== </span><span class="s3">&quot;content&quot;</span>
    <span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'cacheStrategy' must be any of </span><span class="s6">\&quot;</span><span class="s3">metadata</span><span class="s6">\&quot;</span><span class="s3">, </span><span class="s6">\&quot;</span><span class="s3">content</span><span class="s6">\&quot;</span><span class="s3">.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) || !</span><span class="s2">path</span><span class="s4">.</span><span class="s2">isAbsolute</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">)) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'cwd' must be an absolute path.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">errorOnUnmatchedPattern </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'errorOnUnmatchedPattern' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">fix </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot; </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">fix </span><span class="s4">!== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'fix' must be a boolean or a function.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">fixTypes </span><span class="s4">!== </span><span class="s6">null </span><span class="s4">&amp;&amp; !</span><span class="s2">isFixTypeArray</span><span class="s4">(</span><span class="s2">fixTypes</span><span class="s4">)) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'fixTypes' must be an array of any of </span><span class="s6">\&quot;</span><span class="s3">directive</span><span class="s6">\&quot;</span><span class="s3">, </span><span class="s6">\&quot;</span><span class="s3">problem</span><span class="s6">\&quot;</span><span class="s3">, </span><span class="s6">\&quot;</span><span class="s3">suggestion</span><span class="s6">\&quot;</span><span class="s3">, and </span><span class="s6">\&quot;</span><span class="s3">layout</span><span class="s6">\&quot;</span><span class="s3">.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">globInputPaths </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'globInputPaths' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">ignore </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'ignore' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">isArrayOfNonEmptyString</span><span class="s4">(</span><span class="s2">ignorePatterns</span><span class="s4">) &amp;&amp; </span><span class="s2">ignorePatterns </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'ignorePatterns' must be an array of non-empty strings or null.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">overrideConfig </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'overrideConfig' must be an object or null.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">overrideConfigFile</span><span class="s4">) &amp;&amp; </span><span class="s2">overrideConfigFile </span><span class="s4">!== </span><span class="s6">null </span><span class="s4">&amp;&amp; </span><span class="s2">overrideConfigFile </span><span class="s4">!== </span><span class="s6">true</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'overrideConfigFile' must be a non-empty string, null, or true.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">plugins </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'plugins' must be an object or null.&quot;</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s6">else if </span><span class="s4">(</span><span class="s2">plugins </span><span class="s4">!== </span><span class="s6">null </span><span class="s4">&amp;&amp; </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">plugins</span><span class="s4">).</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;&quot;</span><span class="s4">)) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'plugins' must not include an empty string.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">plugins</span><span class="s4">)) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'plugins' doesn't add plugins to configuration to load. Please use the 'overrideConfig.plugins' option instead.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">warnIgnored </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">errors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">&quot;'warnIgnored' must be a boolean.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
        <span class="s6">throw new </span><span class="s2">ESLintInvalidOptionsError</span><span class="s4">(</span><span class="s2">errors</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">allowInlineConfig</span><span class="s4">,</span>
        <span class="s2">baseConfig</span><span class="s4">,</span>
        <span class="s2">cache</span><span class="s4">,</span>
        <span class="s2">cacheLocation</span><span class="s4">,</span>
        <span class="s2">cacheStrategy</span><span class="s4">,</span>

        <span class="s5">// when overrideConfigFile is true that means don't do config file lookup</span>
        <span class="s2">configFile</span><span class="s4">: </span><span class="s2">overrideConfigFile </span><span class="s4">=== </span><span class="s6">true </span><span class="s4">? </span><span class="s6">false </span><span class="s4">: </span><span class="s2">overrideConfigFile</span><span class="s4">,</span>
        <span class="s2">overrideConfig</span><span class="s4">,</span>
        <span class="s2">cwd</span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">normalize</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">),</span>
        <span class="s2">errorOnUnmatchedPattern</span><span class="s4">,</span>
        <span class="s2">fix</span><span class="s4">,</span>
        <span class="s2">fixTypes</span><span class="s4">,</span>
        <span class="s2">globInputPaths</span><span class="s4">,</span>
        <span class="s2">ignore</span><span class="s4">,</span>
        <span class="s2">ignorePatterns</span><span class="s4">,</span>
        <span class="s2">warnIgnored</span>
    <span class="s4">};</span>
<span class="s4">}</span>


<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Cache-related helpers</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* return the cacheFile to be used by eslint, based on whether the provided parameter is</span>
 <span class="s0">* a directory or looks like a directory (ends in `path.sep`), in which case the file</span>
 <span class="s0">* name will be the `cacheFile/.cache_hashOfCWD`</span>
 <span class="s0">*</span>
 <span class="s0">* if cacheFile points to a file or looks like a file then in will just use that file</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} cacheFile The name of file to be used to store the cache</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} cwd Current working directory</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} the resolved path to the cache file</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getCacheFile</span><span class="s4">(</span><span class="s2">cacheFile</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">) {</span>

    <span class="s5">/* 
     * make sure the path separators are normalized for the environment/os 
     * keeping the trailing path separator if present 
     */</span>
    <span class="s6">const </span><span class="s2">normalizedCacheFile </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">normalize</span><span class="s4">(</span><span class="s2">cacheFile</span><span class="s4">);</span>

    <span class="s6">const </span><span class="s2">resolvedCacheFile </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">normalizedCacheFile</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s2">looksLikeADirectory </span><span class="s4">= </span><span class="s2">normalizedCacheFile</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(-</span><span class="s8">1</span><span class="s4">) === </span><span class="s2">path</span><span class="s4">.</span><span class="s2">sep</span><span class="s4">;</span>

    <span class="s0">/**</span>
     <span class="s0">* return the name for the cache file in case the provided parameter is a directory</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} the resolved path to the cacheFile</span>
     <span class="s0">*/</span>
    <span class="s6">function </span><span class="s2">getCacheFileForDirectory</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">path</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s2">resolvedCacheFile</span><span class="s4">, </span><span class="s3">`.cache_</span><span class="s2">$</span><span class="s4">{</span><span class="s2">hash</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">)}</span><span class="s3">`</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">let </span><span class="s2">fileStats</span><span class="s4">;</span>

    <span class="s6">try </span><span class="s4">{</span>
        <span class="s2">fileStats </span><span class="s4">= </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">lstatSync</span><span class="s4">(</span><span class="s2">resolvedCacheFile</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s6">catch </span><span class="s4">{</span>
        <span class="s2">fileStats </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>
    <span class="s4">}</span>


    <span class="s5">/* 
     * in case the file exists we need to verify if the provided path 
     * is a directory or a file. If it is a directory we want to create a file 
     * inside that directory 
     */</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">fileStats</span><span class="s4">) {</span>

        <span class="s5">/* 
         * is a directory or is a file, but the original file the user provided 
         * looks like a directory but `path.resolve` removed the `last path.sep` 
         * so we need to still treat this like a directory 
         */</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">fileStats</span><span class="s4">.</span><span class="s2">isDirectory</span><span class="s4">() || </span><span class="s2">looksLikeADirectory</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s2">getCacheFileForDirectory</span><span class="s4">();</span>
        <span class="s4">}</span>

        <span class="s5">// is file so just use that file</span>
        <span class="s6">return </span><span class="s2">resolvedCacheFile</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s5">/* 
     * here we known the file or directory doesn't exist, 
     * so we will try to infer if its a directory if it looks like a directory 
     * for the current operating system. 
     */</span>

    <span class="s5">// if the last character passed is a path separator we assume is a directory</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">looksLikeADirectory</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">getCacheFileForDirectory</span><span class="s4">();</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">resolvedCacheFile</span><span class="s4">;</span>
<span class="s4">}</span>


<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Exports</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s2">module</span><span class="s4">.</span><span class="s2">exports </span><span class="s4">= {</span>
    <span class="s2">isGlobPattern</span><span class="s4">,</span>
    <span class="s2">findFiles</span><span class="s4">,</span>

    <span class="s2">isNonEmptyString</span><span class="s4">,</span>
    <span class="s2">isArrayOfNonEmptyString</span><span class="s4">,</span>

    <span class="s2">createIgnoreResult</span><span class="s4">,</span>
    <span class="s2">isErrorMessage</span><span class="s4">,</span>

    <span class="s2">processOptions</span><span class="s4">,</span>

    <span class="s2">getCacheFile</span>
<span class="s4">};</span>
</pre>
</body>
</html>