<html>
<head>
<title>esprima.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
esprima.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
  Copyright (C) 2013 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
  Copyright (C) 2013 Thaddee Tyl &lt;thaddee.tyl@gmail.com&gt; 
  Copyright (C) 2013 Mathias Bynens &lt;mathias@qiwi.be&gt; 
  Copyright (C) 2012 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
  Copyright (C) 2012 Mathias Bynens &lt;mathias@qiwi.be&gt; 
  Copyright (C) 2012 Joost-Wim Boekesteijn &lt;joost-wim@boekesteijn.nl&gt; 
  Copyright (C) 2012 Kris Kowal &lt;kris.kowal@cixar.com&gt; 
  Copyright (C) 2012 Yusuke Suzuki &lt;utatane.tea@gmail.com&gt; 
  Copyright (C) 2012 Arpad Borsos &lt;arpad.borsos@googlemail.com&gt; 
  Copyright (C) 2011 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
 
  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are met: 
 
    * Redistributions of source code must retain the above copyright 
      notice, this list of conditions and the following disclaimer. 
    * Redistributions in binary form must reproduce the above copyright 
      notice, this list of conditions and the following disclaimer in the 
      documentation and/or other materials provided with the distribution. 
 
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; 
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
  ARE DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY 
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES 
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; 
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND 
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF 
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
*/</span>

<span class="s0">/*jslint bitwise:true plusplus:true */</span>
<span class="s0">/*global esprima:true, define:true, exports:true, window: true, 
throwErrorTolerant: true, 
throwError: true, generateStatement: true, peek: true, 
parseAssignmentExpression: true, parseBlock: true, parseExpression: true, 
parseFunctionDeclaration: true, parseFunctionExpression: true, 
parseFunctionSourceElements: true, parseVariableIdentifier: true, 
parseLeftHandSideExpression: true, 
parseUnaryExpression: true, 
parseStatement: true, parseSourceElement: true */</span>

<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">root</span><span class="s2">, </span><span class="s1">factory</span><span class="s2">) {</span>
    <span class="s4">'use strict'</span><span class="s2">;</span>

    <span class="s0">// Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,</span>
    <span class="s0">// Rhino, and plain browser loading.</span>

    <span class="s0">/* istanbul ignore next */</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">) {</span>
        <span class="s1">define</span><span class="s2">([</span><span class="s4">'exports'</span><span class="s2">], </span><span class="s1">factory</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">exports </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
        <span class="s1">factory</span><span class="s2">(</span><span class="s1">exports</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">factory</span><span class="s2">((</span><span class="s1">root</span><span class="s2">.</span><span class="s1">esprima </span><span class="s2">= {}));</span>
    <span class="s2">}</span>
<span class="s2">}(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">exports</span><span class="s2">) {</span>
    <span class="s4">'use strict'</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">Token</span><span class="s2">,</span>
        <span class="s1">TokenName</span><span class="s2">,</span>
        <span class="s1">FnExprTokens</span><span class="s2">,</span>
        <span class="s1">Syntax</span><span class="s2">,</span>
        <span class="s1">PropertyKind</span><span class="s2">,</span>
        <span class="s1">Messages</span><span class="s2">,</span>
        <span class="s1">Regex</span><span class="s2">,</span>
        <span class="s1">SyntaxTreeDelegate</span><span class="s2">,</span>
        <span class="s1">source</span><span class="s2">,</span>
        <span class="s1">strict</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">,</span>
        <span class="s1">lineNumber</span><span class="s2">,</span>
        <span class="s1">lineStart</span><span class="s2">,</span>
        <span class="s1">length</span><span class="s2">,</span>
        <span class="s1">delegate</span><span class="s2">,</span>
        <span class="s1">lookahead</span><span class="s2">,</span>
        <span class="s1">state</span><span class="s2">,</span>
        <span class="s1">extra</span><span class="s2">;</span>

    <span class="s1">Token </span><span class="s2">= {</span>
        <span class="s1">BooleanLiteral</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
        <span class="s1">EOF</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
        <span class="s1">Identifier</span><span class="s2">: </span><span class="s5">3</span><span class="s2">,</span>
        <span class="s1">Keyword</span><span class="s2">: </span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">NullLiteral</span><span class="s2">: </span><span class="s5">5</span><span class="s2">,</span>
        <span class="s1">NumericLiteral</span><span class="s2">: </span><span class="s5">6</span><span class="s2">,</span>
        <span class="s1">Punctuator</span><span class="s2">: </span><span class="s5">7</span><span class="s2">,</span>
        <span class="s1">StringLiteral</span><span class="s2">: </span><span class="s5">8</span><span class="s2">,</span>
        <span class="s1">RegularExpression</span><span class="s2">: </span><span class="s5">9</span>
    <span class="s2">};</span>

    <span class="s1">TokenName </span><span class="s2">= {};</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">] = </span><span class="s4">'Boolean'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">] = </span><span class="s4">'&lt;end&gt;'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">] = </span><span class="s4">'Identifier'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">] = </span><span class="s4">'Keyword'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">] = </span><span class="s4">'Null'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">] = </span><span class="s4">'Numeric'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">] = </span><span class="s4">'Punctuator'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">] = </span><span class="s4">'String'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">RegularExpression</span><span class="s2">] = </span><span class="s4">'RegularExpression'</span><span class="s2">;</span>

    <span class="s0">// A function following one of those tokens is an expression.</span>
    <span class="s1">FnExprTokens </span><span class="s2">= [</span><span class="s4">'('</span><span class="s2">, </span><span class="s4">'{'</span><span class="s2">, </span><span class="s4">'['</span><span class="s2">, </span><span class="s4">'in'</span><span class="s2">, </span><span class="s4">'typeof'</span><span class="s2">, </span><span class="s4">'instanceof'</span><span class="s2">, </span><span class="s4">'new'</span><span class="s2">,</span>
                    <span class="s4">'return'</span><span class="s2">, </span><span class="s4">'case'</span><span class="s2">, </span><span class="s4">'delete'</span><span class="s2">, </span><span class="s4">'throw'</span><span class="s2">, </span><span class="s4">'void'</span><span class="s2">,</span>
                    <span class="s0">// assignment operators</span>
                    <span class="s4">'='</span><span class="s2">, </span><span class="s4">'+='</span><span class="s2">, </span><span class="s4">'-='</span><span class="s2">, </span><span class="s4">'*='</span><span class="s2">, </span><span class="s4">'/='</span><span class="s2">, </span><span class="s4">'%='</span><span class="s2">, </span><span class="s4">'&lt;&lt;='</span><span class="s2">, </span><span class="s4">'&gt;&gt;='</span><span class="s2">, </span><span class="s4">'&gt;&gt;&gt;='</span><span class="s2">,</span>
                    <span class="s4">'&amp;='</span><span class="s2">, </span><span class="s4">'|='</span><span class="s2">, </span><span class="s4">'^='</span><span class="s2">, </span><span class="s4">','</span><span class="s2">,</span>
                    <span class="s0">// binary/unary operators</span>
                    <span class="s4">'+'</span><span class="s2">, </span><span class="s4">'-'</span><span class="s2">, </span><span class="s4">'*'</span><span class="s2">, </span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'%'</span><span class="s2">, </span><span class="s4">'++'</span><span class="s2">, </span><span class="s4">'--'</span><span class="s2">, </span><span class="s4">'&lt;&lt;'</span><span class="s2">, </span><span class="s4">'&gt;&gt;'</span><span class="s2">, </span><span class="s4">'&gt;&gt;&gt;'</span><span class="s2">, </span><span class="s4">'&amp;'</span><span class="s2">,</span>
                    <span class="s4">'|'</span><span class="s2">, </span><span class="s4">'^'</span><span class="s2">, </span><span class="s4">'!'</span><span class="s2">, </span><span class="s4">'~'</span><span class="s2">, </span><span class="s4">'&amp;&amp;'</span><span class="s2">, </span><span class="s4">'||'</span><span class="s2">, </span><span class="s4">'?'</span><span class="s2">, </span><span class="s4">':'</span><span class="s2">, </span><span class="s4">'==='</span><span class="s2">, </span><span class="s4">'=='</span><span class="s2">, </span><span class="s4">'&gt;='</span><span class="s2">,</span>
                    <span class="s4">'&lt;='</span><span class="s2">, </span><span class="s4">'&lt;'</span><span class="s2">, </span><span class="s4">'&gt;'</span><span class="s2">, </span><span class="s4">'!='</span><span class="s2">, </span><span class="s4">'!=='</span><span class="s2">];</span>

    <span class="s1">Syntax </span><span class="s2">= {</span>
        <span class="s1">AssignmentExpression</span><span class="s2">: </span><span class="s4">'AssignmentExpression'</span><span class="s2">,</span>
        <span class="s1">ArrayExpression</span><span class="s2">: </span><span class="s4">'ArrayExpression'</span><span class="s2">,</span>
        <span class="s1">BlockStatement</span><span class="s2">: </span><span class="s4">'BlockStatement'</span><span class="s2">,</span>
        <span class="s1">BinaryExpression</span><span class="s2">: </span><span class="s4">'BinaryExpression'</span><span class="s2">,</span>
        <span class="s1">BreakStatement</span><span class="s2">: </span><span class="s4">'BreakStatement'</span><span class="s2">,</span>
        <span class="s1">CallExpression</span><span class="s2">: </span><span class="s4">'CallExpression'</span><span class="s2">,</span>
        <span class="s1">CatchClause</span><span class="s2">: </span><span class="s4">'CatchClause'</span><span class="s2">,</span>
        <span class="s1">ConditionalExpression</span><span class="s2">: </span><span class="s4">'ConditionalExpression'</span><span class="s2">,</span>
        <span class="s1">ContinueStatement</span><span class="s2">: </span><span class="s4">'ContinueStatement'</span><span class="s2">,</span>
        <span class="s1">DoWhileStatement</span><span class="s2">: </span><span class="s4">'DoWhileStatement'</span><span class="s2">,</span>
        <span class="s1">DebuggerStatement</span><span class="s2">: </span><span class="s4">'DebuggerStatement'</span><span class="s2">,</span>
        <span class="s1">EmptyStatement</span><span class="s2">: </span><span class="s4">'EmptyStatement'</span><span class="s2">,</span>
        <span class="s1">ExpressionStatement</span><span class="s2">: </span><span class="s4">'ExpressionStatement'</span><span class="s2">,</span>
        <span class="s1">ForStatement</span><span class="s2">: </span><span class="s4">'ForStatement'</span><span class="s2">,</span>
        <span class="s1">ForInStatement</span><span class="s2">: </span><span class="s4">'ForInStatement'</span><span class="s2">,</span>
        <span class="s1">FunctionDeclaration</span><span class="s2">: </span><span class="s4">'FunctionDeclaration'</span><span class="s2">,</span>
        <span class="s1">FunctionExpression</span><span class="s2">: </span><span class="s4">'FunctionExpression'</span><span class="s2">,</span>
        <span class="s1">Identifier</span><span class="s2">: </span><span class="s4">'Identifier'</span><span class="s2">,</span>
        <span class="s1">IfStatement</span><span class="s2">: </span><span class="s4">'IfStatement'</span><span class="s2">,</span>
        <span class="s1">Literal</span><span class="s2">: </span><span class="s4">'Literal'</span><span class="s2">,</span>
        <span class="s1">LabeledStatement</span><span class="s2">: </span><span class="s4">'LabeledStatement'</span><span class="s2">,</span>
        <span class="s1">LogicalExpression</span><span class="s2">: </span><span class="s4">'LogicalExpression'</span><span class="s2">,</span>
        <span class="s1">MemberExpression</span><span class="s2">: </span><span class="s4">'MemberExpression'</span><span class="s2">,</span>
        <span class="s1">NewExpression</span><span class="s2">: </span><span class="s4">'NewExpression'</span><span class="s2">,</span>
        <span class="s1">ObjectExpression</span><span class="s2">: </span><span class="s4">'ObjectExpression'</span><span class="s2">,</span>
        <span class="s1">Program</span><span class="s2">: </span><span class="s4">'Program'</span><span class="s2">,</span>
        <span class="s1">Property</span><span class="s2">: </span><span class="s4">'Property'</span><span class="s2">,</span>
        <span class="s1">ReturnStatement</span><span class="s2">: </span><span class="s4">'ReturnStatement'</span><span class="s2">,</span>
        <span class="s1">SequenceExpression</span><span class="s2">: </span><span class="s4">'SequenceExpression'</span><span class="s2">,</span>
        <span class="s1">SwitchStatement</span><span class="s2">: </span><span class="s4">'SwitchStatement'</span><span class="s2">,</span>
        <span class="s1">SwitchCase</span><span class="s2">: </span><span class="s4">'SwitchCase'</span><span class="s2">,</span>
        <span class="s1">ThisExpression</span><span class="s2">: </span><span class="s4">'ThisExpression'</span><span class="s2">,</span>
        <span class="s1">ThrowStatement</span><span class="s2">: </span><span class="s4">'ThrowStatement'</span><span class="s2">,</span>
        <span class="s1">TryStatement</span><span class="s2">: </span><span class="s4">'TryStatement'</span><span class="s2">,</span>
        <span class="s1">UnaryExpression</span><span class="s2">: </span><span class="s4">'UnaryExpression'</span><span class="s2">,</span>
        <span class="s1">UpdateExpression</span><span class="s2">: </span><span class="s4">'UpdateExpression'</span><span class="s2">,</span>
        <span class="s1">VariableDeclaration</span><span class="s2">: </span><span class="s4">'VariableDeclaration'</span><span class="s2">,</span>
        <span class="s1">VariableDeclarator</span><span class="s2">: </span><span class="s4">'VariableDeclarator'</span><span class="s2">,</span>
        <span class="s1">WhileStatement</span><span class="s2">: </span><span class="s4">'WhileStatement'</span><span class="s2">,</span>
        <span class="s1">WithStatement</span><span class="s2">: </span><span class="s4">'WithStatement'</span>
    <span class="s2">};</span>

    <span class="s1">PropertyKind </span><span class="s2">= {</span>
        <span class="s1">Data</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
        <span class="s1">Get</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
        <span class="s1">Set</span><span class="s2">: </span><span class="s5">4</span>
    <span class="s2">};</span>

    <span class="s0">// Error messages should be identical to V8.</span>
    <span class="s1">Messages </span><span class="s2">= {</span>
        <span class="s1">UnexpectedToken</span><span class="s2">:  </span><span class="s4">'Unexpected token %0'</span><span class="s2">,</span>
        <span class="s1">UnexpectedNumber</span><span class="s2">:  </span><span class="s4">'Unexpected number'</span><span class="s2">,</span>
        <span class="s1">UnexpectedString</span><span class="s2">:  </span><span class="s4">'Unexpected string'</span><span class="s2">,</span>
        <span class="s1">UnexpectedIdentifier</span><span class="s2">:  </span><span class="s4">'Unexpected identifier'</span><span class="s2">,</span>
        <span class="s1">UnexpectedReserved</span><span class="s2">:  </span><span class="s4">'Unexpected reserved word'</span><span class="s2">,</span>
        <span class="s1">UnexpectedEOS</span><span class="s2">:  </span><span class="s4">'Unexpected end of input'</span><span class="s2">,</span>
        <span class="s1">NewlineAfterThrow</span><span class="s2">:  </span><span class="s4">'Illegal newline after throw'</span><span class="s2">,</span>
        <span class="s1">InvalidRegExp</span><span class="s2">: </span><span class="s4">'Invalid regular expression'</span><span class="s2">,</span>
        <span class="s1">UnterminatedRegExp</span><span class="s2">:  </span><span class="s4">'Invalid regular expression: missing /'</span><span class="s2">,</span>
        <span class="s1">InvalidLHSInAssignment</span><span class="s2">:  </span><span class="s4">'Invalid left-hand side in assignment'</span><span class="s2">,</span>
        <span class="s1">InvalidLHSInForIn</span><span class="s2">:  </span><span class="s4">'Invalid left-hand side in for-in'</span><span class="s2">,</span>
        <span class="s1">MultipleDefaultsInSwitch</span><span class="s2">: </span><span class="s4">'More than one default clause in switch statement'</span><span class="s2">,</span>
        <span class="s1">NoCatchOrFinally</span><span class="s2">:  </span><span class="s4">'Missing catch or finally after try'</span><span class="s2">,</span>
        <span class="s1">UnknownLabel</span><span class="s2">: </span><span class="s4">'Undefined label </span><span class="s3">\'</span><span class="s4">%0</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">,</span>
        <span class="s1">Redeclaration</span><span class="s2">: </span><span class="s4">'%0 </span><span class="s3">\'</span><span class="s4">%1</span><span class="s3">\' </span><span class="s4">has already been declared'</span><span class="s2">,</span>
        <span class="s1">IllegalContinue</span><span class="s2">: </span><span class="s4">'Illegal continue statement'</span><span class="s2">,</span>
        <span class="s1">IllegalBreak</span><span class="s2">: </span><span class="s4">'Illegal break statement'</span><span class="s2">,</span>
        <span class="s1">IllegalReturn</span><span class="s2">: </span><span class="s4">'Illegal return statement'</span><span class="s2">,</span>
        <span class="s1">StrictModeWith</span><span class="s2">:  </span><span class="s4">'Strict mode code may not include a with statement'</span><span class="s2">,</span>
        <span class="s1">StrictCatchVariable</span><span class="s2">:  </span><span class="s4">'Catch variable may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictVarName</span><span class="s2">:  </span><span class="s4">'Variable name may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictParamName</span><span class="s2">:  </span><span class="s4">'Parameter name eval or arguments is not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictParamDupe</span><span class="s2">: </span><span class="s4">'Strict mode function may not have duplicate parameter names'</span><span class="s2">,</span>
        <span class="s1">StrictFunctionName</span><span class="s2">:  </span><span class="s4">'Function name may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictOctalLiteral</span><span class="s2">:  </span><span class="s4">'Octal literals are not allowed in strict mode.'</span><span class="s2">,</span>
        <span class="s1">StrictDelete</span><span class="s2">:  </span><span class="s4">'Delete of an unqualified identifier in strict mode.'</span><span class="s2">,</span>
        <span class="s1">StrictDuplicateProperty</span><span class="s2">:  </span><span class="s4">'Duplicate data property in object literal not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">AccessorDataProperty</span><span class="s2">:  </span><span class="s4">'Object literal may not have data and accessor property with the same name'</span><span class="s2">,</span>
        <span class="s1">AccessorGetSet</span><span class="s2">:  </span><span class="s4">'Object literal may not have multiple get/set accessors with the same name'</span><span class="s2">,</span>
        <span class="s1">StrictLHSAssignment</span><span class="s2">:  </span><span class="s4">'Assignment to eval or arguments is not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictLHSPostfix</span><span class="s2">:  </span><span class="s4">'Postfix increment/decrement may not have eval or arguments operand in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictLHSPrefix</span><span class="s2">:  </span><span class="s4">'Prefix increment/decrement may not have eval or arguments operand in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictReservedWord</span><span class="s2">:  </span><span class="s4">'Use of future reserved word in strict mode'</span>
    <span class="s2">};</span>

    <span class="s0">// See also tools/generate-unicode-regex.py.</span>
    <span class="s1">Regex </span><span class="s2">= {</span>
        <span class="s1">NonAsciiIdentifierStart</span><span class="s2">: </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'[</span><span class="s3">\xAA\xB5\xBA\xC0</span><span class="s4">-</span><span class="s3">\xD6\xD8</span><span class="s4">-</span><span class="s3">\xF6\xF8</span><span class="s4">-</span><span class="s3">\u02C1\u02C6</span><span class="s4">-</span><span class="s3">\u02D1\u02E0</span><span class="s4">-</span><span class="s3">\u02E4\u02EC\u02EE\u0370</span><span class="s4">-</span><span class="s3">\u0374\u0376\u0377\u037A</span><span class="s4">-</span><span class="s3">\u037D\u0386\u0388</span><span class="s4">-</span><span class="s3">\u038A\u038C\u038E</span><span class="s4">-</span><span class="s3">\u03A1\u03A3</span><span class="s4">-</span><span class="s3">\u03F5\u03F7</span><span class="s4">-</span><span class="s3">\u0481\u048A</span><span class="s4">-</span><span class="s3">\u0527\u0531</span><span class="s4">-</span><span class="s3">\u0556\u0559\u0561</span><span class="s4">-</span><span class="s3">\u0587\u05D0</span><span class="s4">-</span><span class="s3">\u05EA\u05F0</span><span class="s4">-</span><span class="s3">\u05F2\u0620</span><span class="s4">-</span><span class="s3">\u064A\u066E\u066F\u0671</span><span class="s4">-</span><span class="s3">\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA</span><span class="s4">-</span><span class="s3">\u06FC\u06FF\u0710\u0712</span><span class="s4">-</span><span class="s3">\u072F\u074D</span><span class="s4">-</span><span class="s3">\u07A5\u07B1\u07CA</span><span class="s4">-</span><span class="s3">\u07EA\u07F4\u07F5\u07FA\u0800</span><span class="s4">-</span><span class="s3">\u0815\u081A\u0824\u0828\u0840</span><span class="s4">-</span><span class="s3">\u0858\u08A0\u08A2</span><span class="s4">-</span><span class="s3">\u08AC\u0904</span><span class="s4">-</span><span class="s3">\u0939\u093D\u0950\u0958</span><span class="s4">-</span><span class="s3">\u0961\u0971</span><span class="s4">-</span><span class="s3">\u0977\u0979</span><span class="s4">-</span><span class="s3">\u097F\u0985</span><span class="s4">-</span><span class="s3">\u098C\u098F\u0990\u0993</span><span class="s4">-</span><span class="s3">\u09A8\u09AA</span><span class="s4">-</span><span class="s3">\u09B0\u09B2\u09B6</span><span class="s4">-</span><span class="s3">\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF</span><span class="s4">-</span><span class="s3">\u09E1\u09F0\u09F1\u0A05</span><span class="s4">-</span><span class="s3">\u0A0A\u0A0F\u0A10\u0A13</span><span class="s4">-</span><span class="s3">\u0A28\u0A2A</span><span class="s4">-</span><span class="s3">\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59</span><span class="s4">-</span><span class="s3">\u0A5C\u0A5E\u0A72</span><span class="s4">-</span><span class="s3">\u0A74\u0A85</span><span class="s4">-</span><span class="s3">\u0A8D\u0A8F</span><span class="s4">-</span><span class="s3">\u0A91\u0A93</span><span class="s4">-</span><span class="s3">\u0AA8\u0AAA</span><span class="s4">-</span><span class="s3">\u0AB0\u0AB2\u0AB3\u0AB5</span><span class="s4">-</span><span class="s3">\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05</span><span class="s4">-</span><span class="s3">\u0B0C\u0B0F\u0B10\u0B13</span><span class="s4">-</span><span class="s3">\u0B28\u0B2A</span><span class="s4">-</span><span class="s3">\u0B30\u0B32\u0B33\u0B35</span><span class="s4">-</span><span class="s3">\u0B39\u0B3D\u0B5C\u0B5D\u0B5F</span><span class="s4">-</span><span class="s3">\u0B61\u0B71\u0B83\u0B85</span><span class="s4">-</span><span class="s3">\u0B8A\u0B8E</span><span class="s4">-</span><span class="s3">\u0B90\u0B92</span><span class="s4">-</span><span class="s3">\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8</span><span class="s4">-</span><span class="s3">\u0BAA\u0BAE</span><span class="s4">-</span><span class="s3">\u0BB9\u0BD0\u0C05</span><span class="s4">-</span><span class="s3">\u0C0C\u0C0E</span><span class="s4">-</span><span class="s3">\u0C10\u0C12</span><span class="s4">-</span><span class="s3">\u0C28\u0C2A</span><span class="s4">-</span><span class="s3">\u0C33\u0C35</span><span class="s4">-</span><span class="s3">\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85</span><span class="s4">-</span><span class="s3">\u0C8C\u0C8E</span><span class="s4">-</span><span class="s3">\u0C90\u0C92</span><span class="s4">-</span><span class="s3">\u0CA8\u0CAA</span><span class="s4">-</span><span class="s3">\u0CB3\u0CB5</span><span class="s4">-</span><span class="s3">\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05</span><span class="s4">-</span><span class="s3">\u0D0C\u0D0E</span><span class="s4">-</span><span class="s3">\u0D10\u0D12</span><span class="s4">-</span><span class="s3">\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A</span><span class="s4">-</span><span class="s3">\u0D7F\u0D85</span><span class="s4">-</span><span class="s3">\u0D96\u0D9A</span><span class="s4">-</span><span class="s3">\u0DB1\u0DB3</span><span class="s4">-</span><span class="s3">\u0DBB\u0DBD\u0DC0</span><span class="s4">-</span><span class="s3">\u0DC6\u0E01</span><span class="s4">-</span><span class="s3">\u0E30\u0E32\u0E33\u0E40</span><span class="s4">-</span><span class="s3">\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94</span><span class="s4">-</span><span class="s3">\u0E97\u0E99</span><span class="s4">-</span><span class="s3">\u0E9F\u0EA1</span><span class="s4">-</span><span class="s3">\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD</span><span class="s4">-</span><span class="s3">\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0</span><span class="s4">-</span><span class="s3">\u0EC4\u0EC6\u0EDC</span><span class="s4">-</span><span class="s3">\u0EDF\u0F00\u0F40</span><span class="s4">-</span><span class="s3">\u0F47\u0F49</span><span class="s4">-</span><span class="s3">\u0F6C\u0F88</span><span class="s4">-</span><span class="s3">\u0F8C\u1000</span><span class="s4">-</span><span class="s3">\u102A\u103F\u1050</span><span class="s4">-</span><span class="s3">\u1055\u105A</span><span class="s4">-</span><span class="s3">\u105D\u1061\u1065\u1066\u106E</span><span class="s4">-</span><span class="s3">\u1070\u1075</span><span class="s4">-</span><span class="s3">\u1081\u108E\u10A0</span><span class="s4">-</span><span class="s3">\u10C5\u10C7\u10CD\u10D0</span><span class="s4">-</span><span class="s3">\u10FA\u10FC</span><span class="s4">-</span><span class="s3">\u1248\u124A</span><span class="s4">-</span><span class="s3">\u124D\u1250</span><span class="s4">-</span><span class="s3">\u1256\u1258\u125A</span><span class="s4">-</span><span class="s3">\u125D\u1260</span><span class="s4">-</span><span class="s3">\u1288\u128A</span><span class="s4">-</span><span class="s3">\u128D\u1290</span><span class="s4">-</span><span class="s3">\u12B0\u12B2</span><span class="s4">-</span><span class="s3">\u12B5\u12B8</span><span class="s4">-</span><span class="s3">\u12BE\u12C0\u12C2</span><span class="s4">-</span><span class="s3">\u12C5\u12C8</span><span class="s4">-</span><span class="s3">\u12D6\u12D8</span><span class="s4">-</span><span class="s3">\u1310\u1312</span><span class="s4">-</span><span class="s3">\u1315\u1318</span><span class="s4">-</span><span class="s3">\u135A\u1380</span><span class="s4">-</span><span class="s3">\u138F\u13A0</span><span class="s4">-</span><span class="s3">\u13F4\u1401</span><span class="s4">-</span><span class="s3">\u166C\u166F</span><span class="s4">-</span><span class="s3">\u167F\u1681</span><span class="s4">-</span><span class="s3">\u169A\u16A0</span><span class="s4">-</span><span class="s3">\u16EA\u16EE</span><span class="s4">-</span><span class="s3">\u16F0\u1700</span><span class="s4">-</span><span class="s3">\u170C\u170E</span><span class="s4">-</span><span class="s3">\u1711\u1720</span><span class="s4">-</span><span class="s3">\u1731\u1740</span><span class="s4">-</span><span class="s3">\u1751\u1760</span><span class="s4">-</span><span class="s3">\u176C\u176E</span><span class="s4">-</span><span class="s3">\u1770\u1780</span><span class="s4">-</span><span class="s3">\u17B3\u17D7\u17DC\u1820</span><span class="s4">-</span><span class="s3">\u1877\u1880</span><span class="s4">-</span><span class="s3">\u18A8\u18AA\u18B0</span><span class="s4">-</span><span class="s3">\u18F5\u1900</span><span class="s4">-</span><span class="s3">\u191C\u1950</span><span class="s4">-</span><span class="s3">\u196D\u1970</span><span class="s4">-</span><span class="s3">\u1974\u1980</span><span class="s4">-</span><span class="s3">\u19AB\u19C1</span><span class="s4">-</span><span class="s3">\u19C7\u1A00</span><span class="s4">-</span><span class="s3">\u1A16\u1A20</span><span class="s4">-</span><span class="s3">\u1A54\u1AA7\u1B05</span><span class="s4">-</span><span class="s3">\u1B33\u1B45</span><span class="s4">-</span><span class="s3">\u1B4B\u1B83</span><span class="s4">-</span><span class="s3">\u1BA0\u1BAE\u1BAF\u1BBA</span><span class="s4">-</span><span class="s3">\u1BE5\u1C00</span><span class="s4">-</span><span class="s3">\u1C23\u1C4D</span><span class="s4">-</span><span class="s3">\u1C4F\u1C5A</span><span class="s4">-</span><span class="s3">\u1C7D\u1CE9</span><span class="s4">-</span><span class="s3">\u1CEC\u1CEE</span><span class="s4">-</span><span class="s3">\u1CF1\u1CF5\u1CF6\u1D00</span><span class="s4">-</span><span class="s3">\u1DBF\u1E00</span><span class="s4">-</span><span class="s3">\u1F15\u1F18</span><span class="s4">-</span><span class="s3">\u1F1D\u1F20</span><span class="s4">-</span><span class="s3">\u1F45\u1F48</span><span class="s4">-</span><span class="s3">\u1F4D\u1F50</span><span class="s4">-</span><span class="s3">\u1F57\u1F59\u1F5B\u1F5D\u1F5F</span><span class="s4">-</span><span class="s3">\u1F7D\u1F80</span><span class="s4">-</span><span class="s3">\u1FB4\u1FB6</span><span class="s4">-</span><span class="s3">\u1FBC\u1FBE\u1FC2</span><span class="s4">-</span><span class="s3">\u1FC4\u1FC6</span><span class="s4">-</span><span class="s3">\u1FCC\u1FD0</span><span class="s4">-</span><span class="s3">\u1FD3\u1FD6</span><span class="s4">-</span><span class="s3">\u1FDB\u1FE0</span><span class="s4">-</span><span class="s3">\u1FEC\u1FF2</span><span class="s4">-</span><span class="s3">\u1FF4\u1FF6</span><span class="s4">-</span><span class="s3">\u1FFC\u2071\u207F\u2090</span><span class="s4">-</span><span class="s3">\u209C\u2102\u2107\u210A</span><span class="s4">-</span><span class="s3">\u2113\u2115\u2119</span><span class="s4">-</span><span class="s3">\u211D\u2124\u2126\u2128\u212A</span><span class="s4">-</span><span class="s3">\u212D\u212F</span><span class="s4">-</span><span class="s3">\u2139\u213C</span><span class="s4">-</span><span class="s3">\u213F\u2145</span><span class="s4">-</span><span class="s3">\u2149\u214E\u2160</span><span class="s4">-</span><span class="s3">\u2188\u2C00</span><span class="s4">-</span><span class="s3">\u2C2E\u2C30</span><span class="s4">-</span><span class="s3">\u2C5E\u2C60</span><span class="s4">-</span><span class="s3">\u2CE4\u2CEB</span><span class="s4">-</span><span class="s3">\u2CEE\u2CF2\u2CF3\u2D00</span><span class="s4">-</span><span class="s3">\u2D25\u2D27\u2D2D\u2D30</span><span class="s4">-</span><span class="s3">\u2D67\u2D6F\u2D80</span><span class="s4">-</span><span class="s3">\u2D96\u2DA0</span><span class="s4">-</span><span class="s3">\u2DA6\u2DA8</span><span class="s4">-</span><span class="s3">\u2DAE\u2DB0</span><span class="s4">-</span><span class="s3">\u2DB6\u2DB8</span><span class="s4">-</span><span class="s3">\u2DBE\u2DC0</span><span class="s4">-</span><span class="s3">\u2DC6\u2DC8</span><span class="s4">-</span><span class="s3">\u2DCE\u2DD0</span><span class="s4">-</span><span class="s3">\u2DD6\u2DD8</span><span class="s4">-</span><span class="s3">\u2DDE\u2E2F\u3005</span><span class="s4">-</span><span class="s3">\u3007\u3021</span><span class="s4">-</span><span class="s3">\u3029\u3031</span><span class="s4">-</span><span class="s3">\u3035\u3038</span><span class="s4">-</span><span class="s3">\u303C\u3041</span><span class="s4">-</span><span class="s3">\u3096\u309D</span><span class="s4">-</span><span class="s3">\u309F\u30A1</span><span class="s4">-</span><span class="s3">\u30FA\u30FC</span><span class="s4">-</span><span class="s3">\u30FF\u3105</span><span class="s4">-</span><span class="s3">\u312D\u3131</span><span class="s4">-</span><span class="s3">\u318E\u31A0</span><span class="s4">-</span><span class="s3">\u31BA\u31F0</span><span class="s4">-</span><span class="s3">\u31FF\u3400</span><span class="s4">-</span><span class="s3">\u4DB5\u4E00</span><span class="s4">-</span><span class="s3">\u9FCC\uA000</span><span class="s4">-</span><span class="s3">\uA48C\uA4D0</span><span class="s4">-</span><span class="s3">\uA4FD\uA500</span><span class="s4">-</span><span class="s3">\uA60C\uA610</span><span class="s4">-</span><span class="s3">\uA61F\uA62A\uA62B\uA640</span><span class="s4">-</span><span class="s3">\uA66E\uA67F</span><span class="s4">-</span><span class="s3">\uA697\uA6A0</span><span class="s4">-</span><span class="s3">\uA6EF\uA717</span><span class="s4">-</span><span class="s3">\uA71F\uA722</span><span class="s4">-</span><span class="s3">\uA788\uA78B</span><span class="s4">-</span><span class="s3">\uA78E\uA790</span><span class="s4">-</span><span class="s3">\uA793\uA7A0</span><span class="s4">-</span><span class="s3">\uA7AA\uA7F8</span><span class="s4">-</span><span class="s3">\uA801\uA803</span><span class="s4">-</span><span class="s3">\uA805\uA807</span><span class="s4">-</span><span class="s3">\uA80A\uA80C</span><span class="s4">-</span><span class="s3">\uA822\uA840</span><span class="s4">-</span><span class="s3">\uA873\uA882</span><span class="s4">-</span><span class="s3">\uA8B3\uA8F2</span><span class="s4">-</span><span class="s3">\uA8F7\uA8FB\uA90A</span><span class="s4">-</span><span class="s3">\uA925\uA930</span><span class="s4">-</span><span class="s3">\uA946\uA960</span><span class="s4">-</span><span class="s3">\uA97C\uA984</span><span class="s4">-</span><span class="s3">\uA9B2\uA9CF\uAA00</span><span class="s4">-</span><span class="s3">\uAA28\uAA40</span><span class="s4">-</span><span class="s3">\uAA42\uAA44</span><span class="s4">-</span><span class="s3">\uAA4B\uAA60</span><span class="s4">-</span><span class="s3">\uAA76\uAA7A\uAA80</span><span class="s4">-</span><span class="s3">\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9</span><span class="s4">-</span><span class="s3">\uAABD\uAAC0\uAAC2\uAADB</span><span class="s4">-</span><span class="s3">\uAADD\uAAE0</span><span class="s4">-</span><span class="s3">\uAAEA\uAAF2</span><span class="s4">-</span><span class="s3">\uAAF4\uAB01</span><span class="s4">-</span><span class="s3">\uAB06\uAB09</span><span class="s4">-</span><span class="s3">\uAB0E\uAB11</span><span class="s4">-</span><span class="s3">\uAB16\uAB20</span><span class="s4">-</span><span class="s3">\uAB26\uAB28</span><span class="s4">-</span><span class="s3">\uAB2E\uABC0</span><span class="s4">-</span><span class="s3">\uABE2\uAC00</span><span class="s4">-</span><span class="s3">\uD7A3\uD7B0</span><span class="s4">-</span><span class="s3">\uD7C6\uD7CB</span><span class="s4">-</span><span class="s3">\uD7FB\uF900</span><span class="s4">-</span><span class="s3">\uFA6D\uFA70</span><span class="s4">-</span><span class="s3">\uFAD9\uFB00</span><span class="s4">-</span><span class="s3">\uFB06\uFB13</span><span class="s4">-</span><span class="s3">\uFB17\uFB1D\uFB1F</span><span class="s4">-</span><span class="s3">\uFB28\uFB2A</span><span class="s4">-</span><span class="s3">\uFB36\uFB38</span><span class="s4">-</span><span class="s3">\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46</span><span class="s4">-</span><span class="s3">\uFBB1\uFBD3</span><span class="s4">-</span><span class="s3">\uFD3D\uFD50</span><span class="s4">-</span><span class="s3">\uFD8F\uFD92</span><span class="s4">-</span><span class="s3">\uFDC7\uFDF0</span><span class="s4">-</span><span class="s3">\uFDFB\uFE70</span><span class="s4">-</span><span class="s3">\uFE74\uFE76</span><span class="s4">-</span><span class="s3">\uFEFC\uFF21</span><span class="s4">-</span><span class="s3">\uFF3A\uFF41</span><span class="s4">-</span><span class="s3">\uFF5A\uFF66</span><span class="s4">-</span><span class="s3">\uFFBE\uFFC2</span><span class="s4">-</span><span class="s3">\uFFC7\uFFCA</span><span class="s4">-</span><span class="s3">\uFFCF\uFFD2</span><span class="s4">-</span><span class="s3">\uFFD7\uFFDA</span><span class="s4">-</span><span class="s3">\uFFDC</span><span class="s4">]'</span><span class="s2">),</span>
        <span class="s1">NonAsciiIdentifierPart</span><span class="s2">: </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'[</span><span class="s3">\xAA\xB5\xBA\xC0</span><span class="s4">-</span><span class="s3">\xD6\xD8</span><span class="s4">-</span><span class="s3">\xF6\xF8</span><span class="s4">-</span><span class="s3">\u02C1\u02C6</span><span class="s4">-</span><span class="s3">\u02D1\u02E0</span><span class="s4">-</span><span class="s3">\u02E4\u02EC\u02EE\u0300</span><span class="s4">-</span><span class="s3">\u0374\u0376\u0377\u037A</span><span class="s4">-</span><span class="s3">\u037D\u0386\u0388</span><span class="s4">-</span><span class="s3">\u038A\u038C\u038E</span><span class="s4">-</span><span class="s3">\u03A1\u03A3</span><span class="s4">-</span><span class="s3">\u03F5\u03F7</span><span class="s4">-</span><span class="s3">\u0481\u0483</span><span class="s4">-</span><span class="s3">\u0487\u048A</span><span class="s4">-</span><span class="s3">\u0527\u0531</span><span class="s4">-</span><span class="s3">\u0556\u0559\u0561</span><span class="s4">-</span><span class="s3">\u0587\u0591</span><span class="s4">-</span><span class="s3">\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0</span><span class="s4">-</span><span class="s3">\u05EA\u05F0</span><span class="s4">-</span><span class="s3">\u05F2\u0610</span><span class="s4">-</span><span class="s3">\u061A\u0620</span><span class="s4">-</span><span class="s3">\u0669\u066E</span><span class="s4">-</span><span class="s3">\u06D3\u06D5</span><span class="s4">-</span><span class="s3">\u06DC\u06DF</span><span class="s4">-</span><span class="s3">\u06E8\u06EA</span><span class="s4">-</span><span class="s3">\u06FC\u06FF\u0710</span><span class="s4">-</span><span class="s3">\u074A\u074D</span><span class="s4">-</span><span class="s3">\u07B1\u07C0</span><span class="s4">-</span><span class="s3">\u07F5\u07FA\u0800</span><span class="s4">-</span><span class="s3">\u082D\u0840</span><span class="s4">-</span><span class="s3">\u085B\u08A0\u08A2</span><span class="s4">-</span><span class="s3">\u08AC\u08E4</span><span class="s4">-</span><span class="s3">\u08FE\u0900</span><span class="s4">-</span><span class="s3">\u0963\u0966</span><span class="s4">-</span><span class="s3">\u096F\u0971</span><span class="s4">-</span><span class="s3">\u0977\u0979</span><span class="s4">-</span><span class="s3">\u097F\u0981</span><span class="s4">-</span><span class="s3">\u0983\u0985</span><span class="s4">-</span><span class="s3">\u098C\u098F\u0990\u0993</span><span class="s4">-</span><span class="s3">\u09A8\u09AA</span><span class="s4">-</span><span class="s3">\u09B0\u09B2\u09B6</span><span class="s4">-</span><span class="s3">\u09B9\u09BC</span><span class="s4">-</span><span class="s3">\u09C4\u09C7\u09C8\u09CB</span><span class="s4">-</span><span class="s3">\u09CE\u09D7\u09DC\u09DD\u09DF</span><span class="s4">-</span><span class="s3">\u09E3\u09E6</span><span class="s4">-</span><span class="s3">\u09F1\u0A01</span><span class="s4">-</span><span class="s3">\u0A03\u0A05</span><span class="s4">-</span><span class="s3">\u0A0A\u0A0F\u0A10\u0A13</span><span class="s4">-</span><span class="s3">\u0A28\u0A2A</span><span class="s4">-</span><span class="s3">\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E</span><span class="s4">-</span><span class="s3">\u0A42\u0A47\u0A48\u0A4B</span><span class="s4">-</span><span class="s3">\u0A4D\u0A51\u0A59</span><span class="s4">-</span><span class="s3">\u0A5C\u0A5E\u0A66</span><span class="s4">-</span><span class="s3">\u0A75\u0A81</span><span class="s4">-</span><span class="s3">\u0A83\u0A85</span><span class="s4">-</span><span class="s3">\u0A8D\u0A8F</span><span class="s4">-</span><span class="s3">\u0A91\u0A93</span><span class="s4">-</span><span class="s3">\u0AA8\u0AAA</span><span class="s4">-</span><span class="s3">\u0AB0\u0AB2\u0AB3\u0AB5</span><span class="s4">-</span><span class="s3">\u0AB9\u0ABC</span><span class="s4">-</span><span class="s3">\u0AC5\u0AC7</span><span class="s4">-</span><span class="s3">\u0AC9\u0ACB</span><span class="s4">-</span><span class="s3">\u0ACD\u0AD0\u0AE0</span><span class="s4">-</span><span class="s3">\u0AE3\u0AE6</span><span class="s4">-</span><span class="s3">\u0AEF\u0B01</span><span class="s4">-</span><span class="s3">\u0B03\u0B05</span><span class="s4">-</span><span class="s3">\u0B0C\u0B0F\u0B10\u0B13</span><span class="s4">-</span><span class="s3">\u0B28\u0B2A</span><span class="s4">-</span><span class="s3">\u0B30\u0B32\u0B33\u0B35</span><span class="s4">-</span><span class="s3">\u0B39\u0B3C</span><span class="s4">-</span><span class="s3">\u0B44\u0B47\u0B48\u0B4B</span><span class="s4">-</span><span class="s3">\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F</span><span class="s4">-</span><span class="s3">\u0B63\u0B66</span><span class="s4">-</span><span class="s3">\u0B6F\u0B71\u0B82\u0B83\u0B85</span><span class="s4">-</span><span class="s3">\u0B8A\u0B8E</span><span class="s4">-</span><span class="s3">\u0B90\u0B92</span><span class="s4">-</span><span class="s3">\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8</span><span class="s4">-</span><span class="s3">\u0BAA\u0BAE</span><span class="s4">-</span><span class="s3">\u0BB9\u0BBE</span><span class="s4">-</span><span class="s3">\u0BC2\u0BC6</span><span class="s4">-</span><span class="s3">\u0BC8\u0BCA</span><span class="s4">-</span><span class="s3">\u0BCD\u0BD0\u0BD7\u0BE6</span><span class="s4">-</span><span class="s3">\u0BEF\u0C01</span><span class="s4">-</span><span class="s3">\u0C03\u0C05</span><span class="s4">-</span><span class="s3">\u0C0C\u0C0E</span><span class="s4">-</span><span class="s3">\u0C10\u0C12</span><span class="s4">-</span><span class="s3">\u0C28\u0C2A</span><span class="s4">-</span><span class="s3">\u0C33\u0C35</span><span class="s4">-</span><span class="s3">\u0C39\u0C3D</span><span class="s4">-</span><span class="s3">\u0C44\u0C46</span><span class="s4">-</span><span class="s3">\u0C48\u0C4A</span><span class="s4">-</span><span class="s3">\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60</span><span class="s4">-</span><span class="s3">\u0C63\u0C66</span><span class="s4">-</span><span class="s3">\u0C6F\u0C82\u0C83\u0C85</span><span class="s4">-</span><span class="s3">\u0C8C\u0C8E</span><span class="s4">-</span><span class="s3">\u0C90\u0C92</span><span class="s4">-</span><span class="s3">\u0CA8\u0CAA</span><span class="s4">-</span><span class="s3">\u0CB3\u0CB5</span><span class="s4">-</span><span class="s3">\u0CB9\u0CBC</span><span class="s4">-</span><span class="s3">\u0CC4\u0CC6</span><span class="s4">-</span><span class="s3">\u0CC8\u0CCA</span><span class="s4">-</span><span class="s3">\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0</span><span class="s4">-</span><span class="s3">\u0CE3\u0CE6</span><span class="s4">-</span><span class="s3">\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05</span><span class="s4">-</span><span class="s3">\u0D0C\u0D0E</span><span class="s4">-</span><span class="s3">\u0D10\u0D12</span><span class="s4">-</span><span class="s3">\u0D3A\u0D3D</span><span class="s4">-</span><span class="s3">\u0D44\u0D46</span><span class="s4">-</span><span class="s3">\u0D48\u0D4A</span><span class="s4">-</span><span class="s3">\u0D4E\u0D57\u0D60</span><span class="s4">-</span><span class="s3">\u0D63\u0D66</span><span class="s4">-</span><span class="s3">\u0D6F\u0D7A</span><span class="s4">-</span><span class="s3">\u0D7F\u0D82\u0D83\u0D85</span><span class="s4">-</span><span class="s3">\u0D96\u0D9A</span><span class="s4">-</span><span class="s3">\u0DB1\u0DB3</span><span class="s4">-</span><span class="s3">\u0DBB\u0DBD\u0DC0</span><span class="s4">-</span><span class="s3">\u0DC6\u0DCA\u0DCF</span><span class="s4">-</span><span class="s3">\u0DD4\u0DD6\u0DD8</span><span class="s4">-</span><span class="s3">\u0DDF\u0DF2\u0DF3\u0E01</span><span class="s4">-</span><span class="s3">\u0E3A\u0E40</span><span class="s4">-</span><span class="s3">\u0E4E\u0E50</span><span class="s4">-</span><span class="s3">\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94</span><span class="s4">-</span><span class="s3">\u0E97\u0E99</span><span class="s4">-</span><span class="s3">\u0E9F\u0EA1</span><span class="s4">-</span><span class="s3">\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD</span><span class="s4">-</span><span class="s3">\u0EB9\u0EBB</span><span class="s4">-</span><span class="s3">\u0EBD\u0EC0</span><span class="s4">-</span><span class="s3">\u0EC4\u0EC6\u0EC8</span><span class="s4">-</span><span class="s3">\u0ECD\u0ED0</span><span class="s4">-</span><span class="s3">\u0ED9\u0EDC</span><span class="s4">-</span><span class="s3">\u0EDF\u0F00\u0F18\u0F19\u0F20</span><span class="s4">-</span><span class="s3">\u0F29\u0F35\u0F37\u0F39\u0F3E</span><span class="s4">-</span><span class="s3">\u0F47\u0F49</span><span class="s4">-</span><span class="s3">\u0F6C\u0F71</span><span class="s4">-</span><span class="s3">\u0F84\u0F86</span><span class="s4">-</span><span class="s3">\u0F97\u0F99</span><span class="s4">-</span><span class="s3">\u0FBC\u0FC6\u1000</span><span class="s4">-</span><span class="s3">\u1049\u1050</span><span class="s4">-</span><span class="s3">\u109D\u10A0</span><span class="s4">-</span><span class="s3">\u10C5\u10C7\u10CD\u10D0</span><span class="s4">-</span><span class="s3">\u10FA\u10FC</span><span class="s4">-</span><span class="s3">\u1248\u124A</span><span class="s4">-</span><span class="s3">\u124D\u1250</span><span class="s4">-</span><span class="s3">\u1256\u1258\u125A</span><span class="s4">-</span><span class="s3">\u125D\u1260</span><span class="s4">-</span><span class="s3">\u1288\u128A</span><span class="s4">-</span><span class="s3">\u128D\u1290</span><span class="s4">-</span><span class="s3">\u12B0\u12B2</span><span class="s4">-</span><span class="s3">\u12B5\u12B8</span><span class="s4">-</span><span class="s3">\u12BE\u12C0\u12C2</span><span class="s4">-</span><span class="s3">\u12C5\u12C8</span><span class="s4">-</span><span class="s3">\u12D6\u12D8</span><span class="s4">-</span><span class="s3">\u1310\u1312</span><span class="s4">-</span><span class="s3">\u1315\u1318</span><span class="s4">-</span><span class="s3">\u135A\u135D</span><span class="s4">-</span><span class="s3">\u135F\u1380</span><span class="s4">-</span><span class="s3">\u138F\u13A0</span><span class="s4">-</span><span class="s3">\u13F4\u1401</span><span class="s4">-</span><span class="s3">\u166C\u166F</span><span class="s4">-</span><span class="s3">\u167F\u1681</span><span class="s4">-</span><span class="s3">\u169A\u16A0</span><span class="s4">-</span><span class="s3">\u16EA\u16EE</span><span class="s4">-</span><span class="s3">\u16F0\u1700</span><span class="s4">-</span><span class="s3">\u170C\u170E</span><span class="s4">-</span><span class="s3">\u1714\u1720</span><span class="s4">-</span><span class="s3">\u1734\u1740</span><span class="s4">-</span><span class="s3">\u1753\u1760</span><span class="s4">-</span><span class="s3">\u176C\u176E</span><span class="s4">-</span><span class="s3">\u1770\u1772\u1773\u1780</span><span class="s4">-</span><span class="s3">\u17D3\u17D7\u17DC\u17DD\u17E0</span><span class="s4">-</span><span class="s3">\u17E9\u180B</span><span class="s4">-</span><span class="s3">\u180D\u1810</span><span class="s4">-</span><span class="s3">\u1819\u1820</span><span class="s4">-</span><span class="s3">\u1877\u1880</span><span class="s4">-</span><span class="s3">\u18AA\u18B0</span><span class="s4">-</span><span class="s3">\u18F5\u1900</span><span class="s4">-</span><span class="s3">\u191C\u1920</span><span class="s4">-</span><span class="s3">\u192B\u1930</span><span class="s4">-</span><span class="s3">\u193B\u1946</span><span class="s4">-</span><span class="s3">\u196D\u1970</span><span class="s4">-</span><span class="s3">\u1974\u1980</span><span class="s4">-</span><span class="s3">\u19AB\u19B0</span><span class="s4">-</span><span class="s3">\u19C9\u19D0</span><span class="s4">-</span><span class="s3">\u19D9\u1A00</span><span class="s4">-</span><span class="s3">\u1A1B\u1A20</span><span class="s4">-</span><span class="s3">\u1A5E\u1A60</span><span class="s4">-</span><span class="s3">\u1A7C\u1A7F</span><span class="s4">-</span><span class="s3">\u1A89\u1A90</span><span class="s4">-</span><span class="s3">\u1A99\u1AA7\u1B00</span><span class="s4">-</span><span class="s3">\u1B4B\u1B50</span><span class="s4">-</span><span class="s3">\u1B59\u1B6B</span><span class="s4">-</span><span class="s3">\u1B73\u1B80</span><span class="s4">-</span><span class="s3">\u1BF3\u1C00</span><span class="s4">-</span><span class="s3">\u1C37\u1C40</span><span class="s4">-</span><span class="s3">\u1C49\u1C4D</span><span class="s4">-</span><span class="s3">\u1C7D\u1CD0</span><span class="s4">-</span><span class="s3">\u1CD2\u1CD4</span><span class="s4">-</span><span class="s3">\u1CF6\u1D00</span><span class="s4">-</span><span class="s3">\u1DE6\u1DFC</span><span class="s4">-</span><span class="s3">\u1F15\u1F18</span><span class="s4">-</span><span class="s3">\u1F1D\u1F20</span><span class="s4">-</span><span class="s3">\u1F45\u1F48</span><span class="s4">-</span><span class="s3">\u1F4D\u1F50</span><span class="s4">-</span><span class="s3">\u1F57\u1F59\u1F5B\u1F5D\u1F5F</span><span class="s4">-</span><span class="s3">\u1F7D\u1F80</span><span class="s4">-</span><span class="s3">\u1FB4\u1FB6</span><span class="s4">-</span><span class="s3">\u1FBC\u1FBE\u1FC2</span><span class="s4">-</span><span class="s3">\u1FC4\u1FC6</span><span class="s4">-</span><span class="s3">\u1FCC\u1FD0</span><span class="s4">-</span><span class="s3">\u1FD3\u1FD6</span><span class="s4">-</span><span class="s3">\u1FDB\u1FE0</span><span class="s4">-</span><span class="s3">\u1FEC\u1FF2</span><span class="s4">-</span><span class="s3">\u1FF4\u1FF6</span><span class="s4">-</span><span class="s3">\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090</span><span class="s4">-</span><span class="s3">\u209C\u20D0</span><span class="s4">-</span><span class="s3">\u20DC\u20E1\u20E5</span><span class="s4">-</span><span class="s3">\u20F0\u2102\u2107\u210A</span><span class="s4">-</span><span class="s3">\u2113\u2115\u2119</span><span class="s4">-</span><span class="s3">\u211D\u2124\u2126\u2128\u212A</span><span class="s4">-</span><span class="s3">\u212D\u212F</span><span class="s4">-</span><span class="s3">\u2139\u213C</span><span class="s4">-</span><span class="s3">\u213F\u2145</span><span class="s4">-</span><span class="s3">\u2149\u214E\u2160</span><span class="s4">-</span><span class="s3">\u2188\u2C00</span><span class="s4">-</span><span class="s3">\u2C2E\u2C30</span><span class="s4">-</span><span class="s3">\u2C5E\u2C60</span><span class="s4">-</span><span class="s3">\u2CE4\u2CEB</span><span class="s4">-</span><span class="s3">\u2CF3\u2D00</span><span class="s4">-</span><span class="s3">\u2D25\u2D27\u2D2D\u2D30</span><span class="s4">-</span><span class="s3">\u2D67\u2D6F\u2D7F</span><span class="s4">-</span><span class="s3">\u2D96\u2DA0</span><span class="s4">-</span><span class="s3">\u2DA6\u2DA8</span><span class="s4">-</span><span class="s3">\u2DAE\u2DB0</span><span class="s4">-</span><span class="s3">\u2DB6\u2DB8</span><span class="s4">-</span><span class="s3">\u2DBE\u2DC0</span><span class="s4">-</span><span class="s3">\u2DC6\u2DC8</span><span class="s4">-</span><span class="s3">\u2DCE\u2DD0</span><span class="s4">-</span><span class="s3">\u2DD6\u2DD8</span><span class="s4">-</span><span class="s3">\u2DDE\u2DE0</span><span class="s4">-</span><span class="s3">\u2DFF\u2E2F\u3005</span><span class="s4">-</span><span class="s3">\u3007\u3021</span><span class="s4">-</span><span class="s3">\u302F\u3031</span><span class="s4">-</span><span class="s3">\u3035\u3038</span><span class="s4">-</span><span class="s3">\u303C\u3041</span><span class="s4">-</span><span class="s3">\u3096\u3099\u309A\u309D</span><span class="s4">-</span><span class="s3">\u309F\u30A1</span><span class="s4">-</span><span class="s3">\u30FA\u30FC</span><span class="s4">-</span><span class="s3">\u30FF\u3105</span><span class="s4">-</span><span class="s3">\u312D\u3131</span><span class="s4">-</span><span class="s3">\u318E\u31A0</span><span class="s4">-</span><span class="s3">\u31BA\u31F0</span><span class="s4">-</span><span class="s3">\u31FF\u3400</span><span class="s4">-</span><span class="s3">\u4DB5\u4E00</span><span class="s4">-</span><span class="s3">\u9FCC\uA000</span><span class="s4">-</span><span class="s3">\uA48C\uA4D0</span><span class="s4">-</span><span class="s3">\uA4FD\uA500</span><span class="s4">-</span><span class="s3">\uA60C\uA610</span><span class="s4">-</span><span class="s3">\uA62B\uA640</span><span class="s4">-</span><span class="s3">\uA66F\uA674</span><span class="s4">-</span><span class="s3">\uA67D\uA67F</span><span class="s4">-</span><span class="s3">\uA697\uA69F</span><span class="s4">-</span><span class="s3">\uA6F1\uA717</span><span class="s4">-</span><span class="s3">\uA71F\uA722</span><span class="s4">-</span><span class="s3">\uA788\uA78B</span><span class="s4">-</span><span class="s3">\uA78E\uA790</span><span class="s4">-</span><span class="s3">\uA793\uA7A0</span><span class="s4">-</span><span class="s3">\uA7AA\uA7F8</span><span class="s4">-</span><span class="s3">\uA827\uA840</span><span class="s4">-</span><span class="s3">\uA873\uA880</span><span class="s4">-</span><span class="s3">\uA8C4\uA8D0</span><span class="s4">-</span><span class="s3">\uA8D9\uA8E0</span><span class="s4">-</span><span class="s3">\uA8F7\uA8FB\uA900</span><span class="s4">-</span><span class="s3">\uA92D\uA930</span><span class="s4">-</span><span class="s3">\uA953\uA960</span><span class="s4">-</span><span class="s3">\uA97C\uA980</span><span class="s4">-</span><span class="s3">\uA9C0\uA9CF</span><span class="s4">-</span><span class="s3">\uA9D9\uAA00</span><span class="s4">-</span><span class="s3">\uAA36\uAA40</span><span class="s4">-</span><span class="s3">\uAA4D\uAA50</span><span class="s4">-</span><span class="s3">\uAA59\uAA60</span><span class="s4">-</span><span class="s3">\uAA76\uAA7A\uAA7B\uAA80</span><span class="s4">-</span><span class="s3">\uAAC2\uAADB</span><span class="s4">-</span><span class="s3">\uAADD\uAAE0</span><span class="s4">-</span><span class="s3">\uAAEF\uAAF2</span><span class="s4">-</span><span class="s3">\uAAF6\uAB01</span><span class="s4">-</span><span class="s3">\uAB06\uAB09</span><span class="s4">-</span><span class="s3">\uAB0E\uAB11</span><span class="s4">-</span><span class="s3">\uAB16\uAB20</span><span class="s4">-</span><span class="s3">\uAB26\uAB28</span><span class="s4">-</span><span class="s3">\uAB2E\uABC0</span><span class="s4">-</span><span class="s3">\uABEA\uABEC\uABED\uABF0</span><span class="s4">-</span><span class="s3">\uABF9\uAC00</span><span class="s4">-</span><span class="s3">\uD7A3\uD7B0</span><span class="s4">-</span><span class="s3">\uD7C6\uD7CB</span><span class="s4">-</span><span class="s3">\uD7FB\uF900</span><span class="s4">-</span><span class="s3">\uFA6D\uFA70</span><span class="s4">-</span><span class="s3">\uFAD9\uFB00</span><span class="s4">-</span><span class="s3">\uFB06\uFB13</span><span class="s4">-</span><span class="s3">\uFB17\uFB1D</span><span class="s4">-</span><span class="s3">\uFB28\uFB2A</span><span class="s4">-</span><span class="s3">\uFB36\uFB38</span><span class="s4">-</span><span class="s3">\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46</span><span class="s4">-</span><span class="s3">\uFBB1\uFBD3</span><span class="s4">-</span><span class="s3">\uFD3D\uFD50</span><span class="s4">-</span><span class="s3">\uFD8F\uFD92</span><span class="s4">-</span><span class="s3">\uFDC7\uFDF0</span><span class="s4">-</span><span class="s3">\uFDFB\uFE00</span><span class="s4">-</span><span class="s3">\uFE0F\uFE20</span><span class="s4">-</span><span class="s3">\uFE26\uFE33\uFE34\uFE4D</span><span class="s4">-</span><span class="s3">\uFE4F\uFE70</span><span class="s4">-</span><span class="s3">\uFE74\uFE76</span><span class="s4">-</span><span class="s3">\uFEFC\uFF10</span><span class="s4">-</span><span class="s3">\uFF19\uFF21</span><span class="s4">-</span><span class="s3">\uFF3A\uFF3F\uFF41</span><span class="s4">-</span><span class="s3">\uFF5A\uFF66</span><span class="s4">-</span><span class="s3">\uFFBE\uFFC2</span><span class="s4">-</span><span class="s3">\uFFC7\uFFCA</span><span class="s4">-</span><span class="s3">\uFFCF\uFFD2</span><span class="s4">-</span><span class="s3">\uFFD7\uFFDA</span><span class="s4">-</span><span class="s3">\uFFDC</span><span class="s4">]'</span><span class="s2">)</span>
    <span class="s2">};</span>

    <span class="s0">// Ensure the condition is true, otherwise throw an error.</span>
    <span class="s0">// This is only to have a better contract semantic, i.e. another safety net</span>
    <span class="s0">// to catch a logic error. The condition shall be fulfilled in normal case.</span>
    <span class="s0">// Do NOT use this to enforce a certain condition on any user input.</span>

    <span class="s3">function </span><span class="s1">assert</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
        <span class="s0">/* istanbul ignore if */</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">condition</span><span class="s2">) {</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'ASSERT: ' </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">48 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">57</span><span class="s2">);   </span><span class="s0">// 0..9</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s4">'0123456789abcdefABCDEF'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 7.2 White Space</span>

    <span class="s3">function </span><span class="s1">isWhiteSpace</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x20</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x09</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0B</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0C</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0xA0</span><span class="s2">) ||</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x1680 </span><span class="s2">&amp;&amp; [</span><span class="s5">0x1680</span><span class="s2">, </span><span class="s5">0x180E</span><span class="s2">, </span><span class="s5">0x2000</span><span class="s2">, </span><span class="s5">0x2001</span><span class="s2">, </span><span class="s5">0x2002</span><span class="s2">, </span><span class="s5">0x2003</span><span class="s2">, </span><span class="s5">0x2004</span><span class="s2">, </span><span class="s5">0x2005</span><span class="s2">, </span><span class="s5">0x2006</span><span class="s2">, </span><span class="s5">0x2007</span><span class="s2">, </span><span class="s5">0x2008</span><span class="s2">, </span><span class="s5">0x2009</span><span class="s2">, </span><span class="s5">0x200A</span><span class="s2">, </span><span class="s5">0x202F</span><span class="s2">, </span><span class="s5">0x205F</span><span class="s2">, </span><span class="s5">0x3000</span><span class="s2">, </span><span class="s5">0xFEFF</span><span class="s2">].</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.3 Line Terminators</span>

    <span class="s3">function </span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0A</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2028</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2029</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6 Identifier Names and Identifiers</span>

    <span class="s3">function </span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x24</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5F</span><span class="s2">) ||  </span><span class="s0">// $ (dollar) and _ (underscore)</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x41 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x5A</span><span class="s2">) ||         </span><span class="s0">// A..Z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x61 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x7A</span><span class="s2">) ||         </span><span class="s0">// a..z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) ||                      </span><span class="s0">// \ (backslash)</span>
            <span class="s2">((</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x80</span><span class="s2">) &amp;&amp; </span><span class="s1">Regex</span><span class="s2">.</span><span class="s1">NonAsciiIdentifierStart</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)));</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x24</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5F</span><span class="s2">) ||  </span><span class="s0">// $ (dollar) and _ (underscore)</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x41 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x5A</span><span class="s2">) ||         </span><span class="s0">// A..Z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x61 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x7A</span><span class="s2">) ||         </span><span class="s0">// a..z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x30 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x39</span><span class="s2">) ||         </span><span class="s0">// 0..9</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) ||                      </span><span class="s0">// \ (backslash)</span>
            <span class="s2">((</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x80</span><span class="s2">) &amp;&amp; </span><span class="s1">Regex</span><span class="s2">.</span><span class="s1">NonAsciiIdentifierPart</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)));</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6.1.2 Future Reserved Words</span>

    <span class="s3">function </span><span class="s1">isFutureReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'class'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'enum'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'export'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'extends'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'import'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'super'</span><span class="s2">:</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'implements'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'interface'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'package'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'private'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'protected'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'public'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'static'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'yield'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'let'</span><span class="s2">:</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'eval' </span><span class="s2">|| </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'arguments'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6.1.1 Keywords</span>

    <span class="s3">function </span><span class="s1">isKeyword</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)) {</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// 'const' is specialized as Keyword in V8.</span>
        <span class="s0">// 'yield' and 'let' are for compatiblity with SpiderMonkey and ES.next.</span>
        <span class="s0">// Some others are from future reserved words.</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'if'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'in'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'do'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">3</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'var'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'for'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'new'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'try'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'let'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">4</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'this'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'else'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'case'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'void'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'with'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'enum'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">5</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'while'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'break'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'catch'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'throw'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'const'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'yield'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'class'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'super'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">6</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'return'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'typeof'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'delete'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'switch'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'export'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'import'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">7</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'default'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'finally'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'extends'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">8</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'continue'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'debugger'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">10</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'instanceof'</span><span class="s2">);</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// 7.4 Comments</span>

    <span class="s3">function </span><span class="s1">addComment</span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">attacher</span><span class="s2">;</span>

        <span class="s1">assert</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">start </span><span class="s2">=== </span><span class="s4">'number'</span><span class="s2">, </span><span class="s4">'Comment must have valid position'</span><span class="s2">);</span>

        <span class="s0">// Because the way the actual token is scanned, often the comments</span>
        <span class="s0">// (if any) are skipped twice during the lexical analysis.</span>
        <span class="s0">// Thus, we need to skip adding a comment if the comment array already</span>
        <span class="s0">// handled it.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">lastCommentStart </span><span class="s2">&gt;= </span><span class="s1">start</span><span class="s2">) {</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">lastCommentStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">comment </span><span class="s2">= {</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span>
        <span class="s2">};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
            <span class="s1">comment</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
            <span class="s1">comment</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s1">loc</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s1">offset</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s1">offset</span><span class="s2">;</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s1">offset</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
                    <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                        <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s5">1</span>
                    <span class="s2">};</span>
                    <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Line'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">13 </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">10</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
            <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">index</span><span class="s2">);</span>
            <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">};</span>
            <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Line'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipMultiLineComment</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s1">loc </span><span class="s2">= {</span>
                <span class="s1">start</span><span class="s2">: {</span>
                    <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                    <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s5">2</span>
                <span class="s2">}</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x0A</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt;= </span><span class="s1">length</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2A</span><span class="s2">) {</span>
                <span class="s0">// Block comment ends with '*/'.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x2F</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
                        <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">2</span><span class="s2">);</span>
                        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
                        <span class="s2">};</span>
                        <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Block'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
                    <span class="s2">}</span>
                    <span class="s3">return</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipComment</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= (</span><span class="s1">index </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">);</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">isWhiteSpace</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x0A</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">start </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) { </span><span class="s0">// U+002F is '/'</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">2</span><span class="s2">);</span>
                    <span class="s1">start </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2A</span><span class="s2">) {  </span><span class="s0">// U+002A is '*'</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">skipMultiLineComment</span><span class="s2">();</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">start </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2D</span><span class="s2">) { </span><span class="s0">// U+002D is '-'</span>
                <span class="s0">// U+003E is '&gt;'</span>
                <span class="s3">if </span><span class="s2">((</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x2D</span><span class="s2">) &amp;&amp; (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">) === </span><span class="s5">0x3E</span><span class="s2">)) {</span>
                    <span class="s0">// '--&gt;' is a single-line comment</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">3</span><span class="s2">;</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">3</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x3C</span><span class="s2">) { </span><span class="s0">// U+003C is '&lt;'</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">index </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">) === </span><span class="s4">'!--'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `&lt;`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `!`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `-`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `-`</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">4</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">code </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>

        <span class="s1">len </span><span class="s2">= (</span><span class="s1">prefix </span><span class="s2">=== </span><span class="s4">'u'</span><span class="s2">) ? </span><span class="s5">4 </span><span class="s2">: </span><span class="s5">2</span><span class="s2">;</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">16 </span><span class="s2">+ </span><span class="s4">'0123456789abcdef'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">());</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">return </span><span class="s4">''</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">getEscapedIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">id</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">++);</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

        <span class="s0">// '\u' (U+005C, U+0075) denotes an escaped character.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) !== </span><span class="s5">0x75</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">|| !</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">id </span><span class="s2">= </span><span class="s1">ch</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">id </span><span class="s2">+= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

            <span class="s0">// '\u' (U+005C, U+0075) denotes an escaped character.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
                <span class="s1">id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">id</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) !== </span><span class="s5">0x75</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">|| !</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">id </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">id</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">getIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">++;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
                <span class="s0">// Blackslash (U+005C) marks Unicode escape sequence.</span>
                <span class="s1">index </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>
                <span class="s3">return </span><span class="s1">getEscapedIdentifier</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">type</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>

        <span class="s0">// Backslash (U+005C) starts an escaped character.</span>
        <span class="s1">id </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x5C</span><span class="s2">) ? </span><span class="s1">getEscapedIdentifier</span><span class="s2">() : </span><span class="s1">getIdentifier</span><span class="s2">();</span>

        <span class="s0">// There is no keyword or literal with only one character.</span>
        <span class="s0">// Thus, it must be an identifier.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isKeyword</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'null'</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'true' </span><span class="s2">|| </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'false'</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>


    <span class="s0">// 7.7 Punctuators</span>

    <span class="s3">function </span><span class="s1">scanPunctuator</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">,</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">),</span>
            <span class="s1">code2</span><span class="s2">,</span>
            <span class="s1">ch1 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">],</span>
            <span class="s1">ch2</span><span class="s2">,</span>
            <span class="s1">ch3</span><span class="s2">,</span>
            <span class="s1">ch4</span><span class="s2">;</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">code</span><span class="s2">) {</span>

        <span class="s0">// Check for most common single-character punctuators.</span>
        <span class="s3">case </span><span class="s5">0x2E</span><span class="s2">:  </span><span class="s0">// . dot</span>
        <span class="s3">case </span><span class="s5">0x28</span><span class="s2">:  </span><span class="s0">// ( open bracket</span>
        <span class="s3">case </span><span class="s5">0x29</span><span class="s2">:  </span><span class="s0">// ) close bracket</span>
        <span class="s3">case </span><span class="s5">0x3B</span><span class="s2">:  </span><span class="s0">// ; semicolon</span>
        <span class="s3">case </span><span class="s5">0x2C</span><span class="s2">:  </span><span class="s0">// , comma</span>
        <span class="s3">case </span><span class="s5">0x7B</span><span class="s2">:  </span><span class="s0">// { open curly brace</span>
        <span class="s3">case </span><span class="s5">0x7D</span><span class="s2">:  </span><span class="s0">// } close curly brace</span>
        <span class="s3">case </span><span class="s5">0x5B</span><span class="s2">:  </span><span class="s0">// [</span>
        <span class="s3">case </span><span class="s5">0x5D</span><span class="s2">:  </span><span class="s0">// ]</span>
        <span class="s3">case </span><span class="s5">0x3A</span><span class="s2">:  </span><span class="s0">// :</span>
        <span class="s3">case </span><span class="s5">0x3F</span><span class="s2">:  </span><span class="s0">// ?</span>
        <span class="s3">case </span><span class="s5">0x7E</span><span class="s2">:  </span><span class="s0">// ~</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">0x28</span><span class="s2">) {</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">0x7B</span><span class="s2">) {</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">),</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>

        <span class="s3">default</span><span class="s2">:</span>
            <span class="s1">code2 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>

            <span class="s0">// '=' (U+003D) marks an assignment or comparison operator.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">code2 </span><span class="s2">=== </span><span class="s5">0x3D</span><span class="s2">) {</span>
                <span class="s3">switch </span><span class="s2">(</span><span class="s1">code</span><span class="s2">) {</span>
                <span class="s3">case </span><span class="s5">0x2B</span><span class="s2">:  </span><span class="s0">// +</span>
                <span class="s3">case </span><span class="s5">0x2D</span><span class="s2">:  </span><span class="s0">// -</span>
                <span class="s3">case </span><span class="s5">0x2F</span><span class="s2">:  </span><span class="s0">// /</span>
                <span class="s3">case </span><span class="s5">0x3C</span><span class="s2">:  </span><span class="s0">// &lt;</span>
                <span class="s3">case </span><span class="s5">0x3E</span><span class="s2">:  </span><span class="s0">// &gt;</span>
                <span class="s3">case </span><span class="s5">0x5E</span><span class="s2">:  </span><span class="s0">// ^</span>
                <span class="s3">case </span><span class="s5">0x7C</span><span class="s2">:  </span><span class="s0">// |</span>
                <span class="s3">case </span><span class="s5">0x25</span><span class="s2">:  </span><span class="s0">// %</span>
                <span class="s3">case </span><span class="s5">0x26</span><span class="s2">:  </span><span class="s0">// &amp;</span>
                <span class="s3">case </span><span class="s5">0x2A</span><span class="s2">:  </span><span class="s0">// *</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>
                    <span class="s3">return </span><span class="s2">{</span>
                        <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                        <span class="s1">value</span><span class="s2">: </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">) + </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code2</span><span class="s2">),</span>
                        <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                        <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                        <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
                    <span class="s2">};</span>

                <span class="s3">case </span><span class="s5">0x21</span><span class="s2">: </span><span class="s0">// !</span>
                <span class="s3">case </span><span class="s5">0x3D</span><span class="s2">: </span><span class="s0">// =</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>

                    <span class="s0">// !== and ===</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3D</span><span class="s2">) {</span>
                        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s3">return </span><span class="s2">{</span>
                        <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                        <span class="s1">value</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">),</span>
                        <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                        <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                        <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
                    <span class="s2">};</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">// 4-character punctuator: &gt;&gt;&gt;=</span>

        <span class="s1">ch4 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s5">4</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch4 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;='</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">4</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch4</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// 3-character punctuators: === !== &gt;&gt;&gt; &lt;&lt;= &gt;&gt;=</span>

        <span class="s1">ch3 </span><span class="s2">= </span><span class="s1">ch4</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;' </span><span class="s2">|| </span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&lt;&lt;=' </span><span class="s2">|| </span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;='</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">3</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch3</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// Other 2-character punctuators: ++ -- &lt;&lt; &gt;&gt; &amp;&amp; ||</span>
        <span class="s1">ch2 </span><span class="s2">= </span><span class="s1">ch3</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">((</span><span class="s1">ch1 </span><span class="s2">=== </span><span class="s1">ch2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &amp;&amp; (</span><span class="s4">'+-&lt;&gt;&amp;|'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch1</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">)) || </span><span class="s1">ch2 </span><span class="s2">=== </span><span class="s4">'=&gt;'</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch2</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// 1-character punctuators: &lt; &gt; = ! + - * % &amp; | ^ /</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s4">'&lt;&gt;=!+-*%&amp;|^/'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch1</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch1</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.8.3 Numeric Literals</span>

    <span class="s3">function </span><span class="s1">scanHexLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">number </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">number</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s4">'0x' </span><span class="s2">+ </span><span class="s1">number</span><span class="s2">, </span><span class="s5">16</span><span class="s2">),</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanOctalLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">number </span><span class="s2">= </span><span class="s4">'0' </span><span class="s2">+ </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)) || </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">number</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
            <span class="s1">octal</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanNumericLiteral</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">number</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">),</span>
            <span class="s4">'Numeric literal must start with a decimal digit or a decimal point'</span><span class="s2">);</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">number </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">!== </span><span class="s4">'.'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>

            <span class="s0">// Hex number starts with '0x'.</span>
            <span class="s0">// Octal number starts with '0'.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">number </span><span class="s2">=== </span><span class="s4">'0'</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'x' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'X'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s3">return </span><span class="s1">scanHexLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                    <span class="s3">return </span><span class="s1">scanOctalLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s0">// decimal number starts with '0' such as '09' is illegal.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">&amp;&amp; </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'e' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'E'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'+' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'-'</span><span class="s2">) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                    <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseFloat</span><span class="s2">(</span><span class="s1">number</span><span class="s2">),</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s0">// 7.8.4 String Literals</span>

    <span class="s3">function </span><span class="s1">scanStringLiteral</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">str </span><span class="s2">= </span><span class="s4">''</span><span class="s2">, </span><span class="s1">quote</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">code</span><span class="s2">, </span><span class="s1">unescaped</span><span class="s2">, </span><span class="s1">restore</span><span class="s2">, </span><span class="s1">octal </span><span class="s2">= </span><span class="s3">false</span><span class="s2">, </span><span class="s1">startLineNumber</span><span class="s2">, </span><span class="s1">startLineStart</span><span class="s2">;</span>
        <span class="s1">startLineNumber </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">startLineStart </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s1">quote </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">((</span><span class="s1">quote </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">|| </span><span class="s1">quote </span><span class="s2">=== </span><span class="s4">'&quot;'</span><span class="s2">),</span>
            <span class="s4">'String literal must starts with a quote'</span><span class="s2">);</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s1">quote</span><span class="s2">) {</span>
                <span class="s1">quote </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| !</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s3">switch </span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
                    <span class="s3">case </span><span class="s4">'u'</span><span class="s2">:</span>
                    <span class="s3">case </span><span class="s4">'x'</span><span class="s2">:</span>
                        <span class="s1">restore </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                        <span class="s1">unescaped </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s1">unescaped</span><span class="s2">) {</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">unescaped</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                            <span class="s1">index </span><span class="s2">= </span><span class="s1">restore</span><span class="s2">;</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s2">}</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'n'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'r'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\r</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'t'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\t</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'b'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\b</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'f'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\f</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'v'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\x0B</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>

                    <span class="s3">default</span><span class="s2">:</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                            <span class="s1">code </span><span class="s2">= </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

                            <span class="s0">// \0 is not octal escape sequence</span>
                            <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">!== </span><span class="s5">0</span><span class="s2">) {</span>
                                <span class="s1">octal </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                            <span class="s2">}</span>

                            <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                                <span class="s1">octal </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                                <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">8 </span><span class="s2">+ </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++]);</span>

                                <span class="s0">// 3 digits are only allowed when string starts</span>
                                <span class="s0">// with 0, 1, 2, 3</span>
                                <span class="s3">if </span><span class="s2">(</span><span class="s4">'0123'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0 </span><span class="s2">&amp;&amp;</span>
                                        <span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp;</span>
                                        <span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                                    <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">8 </span><span class="s2">+ </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++]);</span>
                                <span class="s2">}</span>
                            <span class="s2">}</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
                        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s2">}</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">===  </span><span class="s4">'</span><span class="s3">\r</span><span class="s4">' </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">] === </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">) {</span>
                        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">quote </span><span class="s2">!== </span><span class="s4">''</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
            <span class="s1">octal</span><span class="s2">: </span><span class="s1">octal</span><span class="s2">,</span>
            <span class="s1">startLineNumber</span><span class="s2">: </span><span class="s1">startLineNumber</span><span class="s2">,</span>
            <span class="s1">startLineStart</span><span class="s2">: </span><span class="s1">startLineStart</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">testRegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">value</span><span class="s2">;</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidRegExp</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExpBody</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">classMarker</span><span class="s2">, </span><span class="s1">terminated</span><span class="s2">, </span><span class="s1">body</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'Regular expression literal must start with a slash'</span><span class="s2">);</span>
        <span class="s1">str </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

        <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">terminated </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s0">// ECMA-262 7.8.5</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">classMarker</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">']'</span><span class="s2">) {</span>
                    <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">) {</span>
                    <span class="s1">terminated </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'['</span><span class="s2">) {</span>
                    <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">terminated</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// Exclude leading and trailing slash.</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">str</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">str</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExpFlags</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">restore</span><span class="s2">;</span>

        <span class="s1">str </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s1">flags </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">&amp;&amp; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'u'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">restore </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
                        <span class="s1">flags </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s3">for </span><span class="s2">(</span><span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">u'</span><span class="s2">; </span><span class="s1">restore </span><span class="s2">&lt; </span><span class="s1">index</span><span class="s2">; ++</span><span class="s1">restore</span><span class="s2">) {</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">restore</span><span class="s2">];</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                        <span class="s1">index </span><span class="s2">= </span><span class="s1">restore</span><span class="s2">;</span>
                        <span class="s1">flags </span><span class="s2">+= </span><span class="s4">'u'</span><span class="s2">;</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">u'</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">;</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">flags </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">flags</span><span class="s2">,</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">str</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExp</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">scanRegExpBody</span><span class="s2">();</span>
        <span class="s1">flags </span><span class="s2">= </span><span class="s1">scanRegExpFlags</span><span class="s2">();</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">testRegExp</span><span class="s2">(</span><span class="s1">body</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">RegularExpression</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">body</span><span class="s2">.</span><span class="s1">literal </span><span class="s2">+ </span><span class="s1">flags</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">collectRegex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">regex</span><span class="s2">, </span><span class="s1">token</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s1">regex </span><span class="s2">= </span><span class="s1">scanRegExp</span><span class="s2">();</span>
        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
        <span class="s2">};</span>

        <span class="s0">/* istanbul ignore next */</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
            <span class="s0">// Pop the previous token, which is likely '/' or '/='</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] === </span><span class="s1">pos </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Punctuator'</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'/' </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'/='</span><span class="s2">) {</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s4">'RegularExpression'</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">regex</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">,</span>
                <span class="s1">range</span><span class="s2">: [</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">index</span><span class="s2">],</span>
                <span class="s1">loc</span><span class="s2">: </span><span class="s1">loc</span>
            <span class="s2">});</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">regex</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isIdentifierName</span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">advanceSlash</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">prevToken</span><span class="s2">,</span>
            <span class="s1">checkToken</span><span class="s2">;</span>
        <span class="s0">// Using the following algorithm:</span>
        <span class="s0">// https://github.com/mozilla/sweet.js/wiki/design</span>
        <span class="s1">prevToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">prevToken</span><span class="s2">) {</span>
            <span class="s0">// Nothing before that: it cannot be a division.</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Punctuator'</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">']'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">')'</span><span class="s2">) {</span>
                <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">checkToken </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword' </span><span class="s2">&amp;&amp;</span>
                        <span class="s2">(</span><span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'if' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'while' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'for' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'with'</span><span class="s2">)) {</span>
                    <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'}'</span><span class="s2">) {</span>
                <span class="s0">// Dividing a function by anything makes little sense,</span>
                <span class="s0">// but we have to check for that.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">3</span><span class="s2">] &amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">3</span><span class="s2">].</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
                    <span class="s0">// Anonymous function.</span>
                    <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">];</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">checkToken</span><span class="s2">) {</span>
                        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">] &amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">].</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
                    <span class="s0">// Named function.</span>
                    <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">5</span><span class="s2">];</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">checkToken</span><span class="s2">) {</span>
                        <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s0">// checkToken determines whether the function is</span>
                <span class="s0">// a declaration or an expression.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">FnExprTokens</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">) {</span>
                    <span class="s0">// It is an expression.</span>
                    <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s0">// It is a declaration.</span>
                <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">advance</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt;= </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">index</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">scanIdentifier</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// Very common: ( and ) and ;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x28 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x29 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// String literal starts with single quote (U+0027) or double quote (U+0022).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x27 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x22</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">scanStringLiteral</span><span class="s2">();</span>
        <span class="s2">}</span>


        <span class="s0">// Dot (.) U+002E can also start a floating-point number, hence the need</span>
        <span class="s0">// to check the next character.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2E</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))) {</span>
                <span class="s3">return </span><span class="s1">scanNumericLiteral</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">scanNumericLiteral</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// Slash (/) U+002F can also start a regex.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">advanceSlash</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">collectToken</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">range</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">advance</span><span class="s2">();</span>
        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
        <span class="s2">};</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">);</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">TokenName</span><span class="s2">[</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type</span><span class="s2">],</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">range</span><span class="s2">: [</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">],</span>
                <span class="s1">loc</span><span class="s2">: </span><span class="s1">loc</span>
            <span class="s2">});</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">lex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s1">lookahead </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) ? </span><span class="s1">collectToken</span><span class="s2">() : </span><span class="s1">advance</span><span class="s2">();</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">peek</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) ? </span><span class="s1">collectToken</span><span class="s2">() : </span><span class="s1">advance</span><span class="s2">();</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">pos</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">line </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">column</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">SourceLocation</span><span class="s2">(</span><span class="s1">startLine</span><span class="s2">, </span><span class="s1">startColumn</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">start </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">startLine</span><span class="s2">, </span><span class="s1">startColumn</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">SyntaxTreeDelegate </span><span class="s2">= {</span>

        <span class="s1">name</span><span class="s2">: </span><span class="s4">'SyntaxTree'</span><span class="s2">,</span>

        <span class="s1">processComment</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">lastChild</span><span class="s2">, </span><span class="s1">trailingComments</span><span class="s2">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Program</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                    <span class="s3">return</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) {</span>
                    <span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">;</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= [];</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) {</span>
                    <span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">;</span>
                    <span class="s3">delete </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">// Eating the stack.</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                <span class="s1">lastChild </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">lastChild</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">&amp;&amp; </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">[</span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &lt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                    <span class="s1">node</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                    <span class="s3">delete </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &lt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= [];</span>
            <span class="s2">}</span>


            <span class="s3">if </span><span class="s2">(</span><span class="s1">trailingComments</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">trailingComments</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
        <span class="s2">},</span>

        <span class="s1">markEnd</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s3">new </span><span class="s1">SourceLocation</span><span class="s2">(</span>
                    <span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineNumber </span><span class="s2">=== </span><span class="s1">undefined </span><span class="s2">?  </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">: </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineNumber</span><span class="s2">,</span>
                    <span class="s1">startToken</span><span class="s2">.</span><span class="s1">start </span><span class="s2">- (</span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineStart </span><span class="s2">=== </span><span class="s1">undefined </span><span class="s2">?  </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">lineStart </span><span class="s2">: </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineStart</span><span class="s2">),</span>
                    <span class="s1">lineNumber</span><span class="s2">,</span>
                    <span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
                <span class="s2">);</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">postProcess</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">processComment</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
        <span class="s2">},</span>

        <span class="s1">postProcess</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">source</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">source</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
        <span class="s2">},</span>

        <span class="s1">createArrayExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">elements</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ArrayExpression</span><span class="s2">,</span>
                <span class="s1">elements</span><span class="s2">: </span><span class="s1">elements</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createAssignmentExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">AssignmentExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBinaryExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">type </span><span class="s2">= (</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'||' </span><span class="s2">|| </span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'&amp;&amp;'</span><span class="s2">) ? </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">LogicalExpression </span><span class="s2">:</span>
                        <span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BinaryExpression</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBlockStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BlockStatement</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBreakStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BreakStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createCallExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">CallExpression</span><span class="s2">,</span>
                <span class="s1">callee</span><span class="s2">: </span><span class="s1">callee</span><span class="s2">,</span>
                <span class="s4">'arguments'</span><span class="s2">: </span><span class="s1">args</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createCatchClause</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">CatchClause</span><span class="s2">,</span>
                <span class="s1">param</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createConditionalExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ConditionalExpression</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span><span class="s2">,</span>
                <span class="s1">alternate</span><span class="s2">: </span><span class="s1">alternate</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createContinueStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ContinueStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createDebuggerStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">DebuggerStatement</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createDoWhileStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">DoWhileStatement</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createEmptyStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">EmptyStatement</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createExpressionStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">expression</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ExpressionStatement</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s1">expression</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createForStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ForStatement</span><span class="s2">,</span>
                <span class="s1">init</span><span class="s2">: </span><span class="s1">init</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">update</span><span class="s2">: </span><span class="s1">update</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createForInStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ForInStatement</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">each</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createFunctionDeclaration</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">FunctionDeclaration</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
                <span class="s1">defaults</span><span class="s2">: </span><span class="s1">defaults</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">rest</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">generator</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createFunctionExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">FunctionExpression</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
                <span class="s1">defaults</span><span class="s2">: </span><span class="s1">defaults</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">rest</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">generator</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createIdentifier</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">,</span>
                <span class="s1">name</span><span class="s2">: </span><span class="s1">name</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createIfStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">IfStatement</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span><span class="s2">,</span>
                <span class="s1">alternate</span><span class="s2">: </span><span class="s1">alternate</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createLabeledStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">LabeledStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createLiteral</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">raw</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">)</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createMemberExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">accessor</span><span class="s2">, </span><span class="s1">object</span><span class="s2">, </span><span class="s1">property</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">MemberExpression</span><span class="s2">,</span>
                <span class="s1">computed</span><span class="s2">: </span><span class="s1">accessor </span><span class="s2">=== </span><span class="s4">'['</span><span class="s2">,</span>
                <span class="s1">object</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
                <span class="s1">property</span><span class="s2">: </span><span class="s1">property</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createNewExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">NewExpression</span><span class="s2">,</span>
                <span class="s1">callee</span><span class="s2">: </span><span class="s1">callee</span><span class="s2">,</span>
                <span class="s4">'arguments'</span><span class="s2">: </span><span class="s1">args</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createObjectExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">properties</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ObjectExpression</span><span class="s2">,</span>
                <span class="s1">properties</span><span class="s2">: </span><span class="s1">properties</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createPostfixExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UpdateExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                <span class="s1">prefix</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createProgram</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Program</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createProperty</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">kind</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Property</span><span class="s2">,</span>
                <span class="s1">key</span><span class="s2">: </span><span class="s1">key</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">kind</span><span class="s2">: </span><span class="s1">kind</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createReturnStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ReturnStatement</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSequenceExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">expressions</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SequenceExpression</span><span class="s2">,</span>
                <span class="s1">expressions</span><span class="s2">: </span><span class="s1">expressions</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSwitchCase</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SwitchCase</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSwitchStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SwitchStatement</span><span class="s2">,</span>
                <span class="s1">discriminant</span><span class="s2">: </span><span class="s1">discriminant</span><span class="s2">,</span>
                <span class="s1">cases</span><span class="s2">: </span><span class="s1">cases</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createThisExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ThisExpression</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createThrowStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ThrowStatement</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createTryStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">block</span><span class="s2">, </span><span class="s1">guardedHandlers</span><span class="s2">, </span><span class="s1">handlers</span><span class="s2">, </span><span class="s1">finalizer</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">TryStatement</span><span class="s2">,</span>
                <span class="s1">block</span><span class="s2">: </span><span class="s1">block</span><span class="s2">,</span>
                <span class="s1">guardedHandlers</span><span class="s2">: </span><span class="s1">guardedHandlers</span><span class="s2">,</span>
                <span class="s1">handlers</span><span class="s2">: </span><span class="s1">handlers</span><span class="s2">,</span>
                <span class="s1">finalizer</span><span class="s2">: </span><span class="s1">finalizer</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createUnaryExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'++' </span><span class="s2">|| </span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'--'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s2">{</span>
                    <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UpdateExpression</span><span class="s2">,</span>
                    <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                    <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                    <span class="s1">prefix</span><span class="s2">: </span><span class="s3">true</span>
                <span class="s2">};</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UnaryExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                <span class="s1">prefix</span><span class="s2">: </span><span class="s3">true</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createVariableDeclaration</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">VariableDeclaration</span><span class="s2">,</span>
                <span class="s1">declarations</span><span class="s2">: </span><span class="s1">declarations</span><span class="s2">,</span>
                <span class="s1">kind</span><span class="s2">: </span><span class="s1">kind</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createVariableDeclarator</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">init</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">VariableDeclarator</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">init</span><span class="s2">: </span><span class="s1">init</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createWhileStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">WhileStatement</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createWithStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">WithStatement</span><span class="s2">,</span>
                <span class="s1">object</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s0">// Return true if there is a line terminator before the next token.</span>

    <span class="s3">function </span><span class="s1">peekLineTerminator</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">found</span><span class="s2">;</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">found </span><span class="s2">= </span><span class="s1">lineNumber </span><span class="s2">!== </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">pos</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">found</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Throw an exception</span>

    <span class="s3">function </span><span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">messageFormat</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">error</span><span class="s2">,</span>
            <span class="s1">args </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s5">2</span><span class="s2">),</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s1">messageFormat</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span>
                <span class="s6">/%(\d)/g</span><span class="s2">,</span>
                <span class="s3">function </span><span class="s2">(</span><span class="s1">whole</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
                    <span class="s1">assert</span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s4">'Message reference must be in range'</span><span class="s2">);</span>
                    <span class="s3">return </span><span class="s1">args</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                <span class="s2">}</span>
            <span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">=== </span><span class="s4">'number'</span><span class="s2">) {</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Line ' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">+ </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">msg</span><span class="s2">);</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Line ' </span><span class="s2">+ </span><span class="s1">lineNumber </span><span class="s2">+ </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">msg</span><span class="s2">);</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">error</span><span class="s2">.</span><span class="s1">description </span><span class="s2">= </span><span class="s1">msg</span><span class="s2">;</span>
        <span class="s3">throw </span><span class="s1">error</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">throwErrorTolerant</span><span class="s2">() {</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">throwError</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">e</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


    <span class="s0">// Throw an exception because of the token.</span>

    <span class="s3">function </span><span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedEOS</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedNumber</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedString</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedIdentifier</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isFutureReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedReserved</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">);</span>
                <span class="s3">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// BooleanLiteral, NullLiteral, or Punctuator.</span>
        <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// Expect the next token to match the specified punctuator.</span>
    <span class="s0">// If not, an exception will be thrown.</span>

    <span class="s3">function </span><span class="s1">expect</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">!== </span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Expect the next token to match the specified keyword.</span>
    <span class="s0">// If not, an exception will be thrown.</span>

    <span class="s3">function </span><span class="s1">expectKeyword</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">!== </span><span class="s1">keyword</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token matches the specified punctuator.</span>

    <span class="s3">function </span><span class="s1">match</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token matches the specified keyword</span>

    <span class="s3">function </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">keyword</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token is an assignment operator</span>

    <span class="s3">function </span><span class="s1">matchAssign</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">op</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">op </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'*=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'/=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'%=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'+=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'-=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&lt;&lt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;&gt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&amp;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'^=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'|='</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">consumeSemicolon</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">line</span><span class="s2">;</span>

        <span class="s0">// Catch the very common case first: immediately a semicolon (U+003B).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B </span><span class="s2">|| </span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lineNumber </span><span class="s2">!== </span><span class="s1">line</span><span class="s2">) {</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if provided expression is LeftHandSideExpression</span>

    <span class="s3">function </span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">|| </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">MemberExpression</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.4 Array Initialiser</span>

    <span class="s3">function </span><span class="s1">parseArrayInitialiser</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">elements </span><span class="s2">= [], </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">elements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">elements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>

                <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">)) {</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createArrayExpression</span><span class="s2">(</span><span class="s1">elements</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.5 Object Initialiser</span>

    <span class="s3">function </span><span class="s1">parsePropertyFunction</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">first</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">first </span><span class="s2">&amp;&amp; </span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">param</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">first</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionExpression</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">param</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectPropertyKey</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s0">// Note: This function is called only from parseObjectProperty(), where</span>
        <span class="s0">// EOF and Punctuator tokens are already filtered out.</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectProperty</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">param</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>

            <span class="s1">id </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>

            <span class="s0">// Property Assignment: Getter and Setter.</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'get' </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">([]);</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'get'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'set' </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">([]);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">param </span><span class="s2">= [ </span><span class="s1">parseVariableIdentifier</span><span class="s2">() ];</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">token</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'set'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'init'</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'init'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectInitialiser</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">properties </span><span class="s2">= [], </span><span class="s1">property</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">map </span><span class="s2">= {}, </span><span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">property </span><span class="s2">= </span><span class="s1">parseObjectProperty</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">kind </span><span class="s2">= (</span><span class="s1">property</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'init'</span><span class="s2">) ? </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data </span><span class="s2">: (</span><span class="s1">property</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'get'</span><span class="s2">) ? </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Get </span><span class="s2">: </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Set</span><span class="s2">;</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">map</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] === </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">kind </span><span class="s2">=== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictDuplicateProperty</span><span class="s2">);</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">!== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorDataProperty</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">=== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorDataProperty</span><span class="s2">);</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] &amp; </span><span class="s1">kind</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorGetSet</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] |= </span><span class="s1">kind</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">kind</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">properties</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">property</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createObjectExpression</span><span class="s2">(</span><span class="s1">properties</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.6 The Grouping Operator</span>

    <span class="s3">function </span><span class="s1">parseGroupExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 11.1 Primary Expressions</span>

    <span class="s3">function </span><span class="s1">parsePrimaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">type</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseGroupExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseArrayInitialiser</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseObjectInitialiser</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s1">type </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">=  </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">().</span><span class="s1">value</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral </span><span class="s2">|| </span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">)) {</span>
                <span class="s3">return </span><span class="s1">parseFunctionExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'this'</span><span class="s2">)) {</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createThisExpression</span><span class="s2">();</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= (</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'true'</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'/='</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">collectRegex</span><span class="s2">());</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">scanRegExp</span><span class="s2">());</span>
            <span class="s2">}</span>
            <span class="s1">peek</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.2 Left-Hand-Side Expressions</span>

    <span class="s3">function </span><span class="s1">parseArguments</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">args </span><span class="s2">= [];</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">args</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">args</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNonComputedProperty</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierName</span><span class="s2">(</span><span class="s1">token</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNonComputedMember</span><span class="s2">() {</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">parseNonComputedProperty</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseComputedMember</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">);</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNewExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">);</span>
        <span class="s1">callee </span><span class="s2">= </span><span class="s1">parseLeftHandSideExpression</span><span class="s2">();</span>
        <span class="s1">args </span><span class="s2">= </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">) ? </span><span class="s1">parseArguments</span><span class="s2">() : [];</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createNewExpression</span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseLeftHandSideExpressionAllowCall</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">property</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">) ? </span><span class="s1">parseNewExpression</span><span class="s2">() : </span><span class="s1">parsePrimaryExpression</span><span class="s2">();</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>

        <span class="s3">for </span><span class="s2">(;;) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseNonComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
                <span class="s1">args </span><span class="s2">= </span><span class="s1">parseArguments</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createCallExpression</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseLeftHandSideExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">) ? </span><span class="s1">parseNewExpression</span><span class="s2">() : </span><span class="s1">parsePrimaryExpression</span><span class="s2">();</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseNonComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.3 Postfix Expressions</span>

    <span class="s3">function </span><span class="s1">parsePostfixExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseLeftHandSideExpressionAllowCall</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">((</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'++'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'--'</span><span class="s2">)) &amp;&amp; !</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
                <span class="s0">// 11.3.1, 11.3.2</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSPostfix</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createPostfixExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.4 Unary Operators</span>

    <span class="s3">function </span><span class="s1">parseUnaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parsePostfixExpression</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'++'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'--'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s0">// 11.4.4, 11.4.5</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSPrefix</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'+'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'~'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'!'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'delete'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'void'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'typeof'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'delete' </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">argument</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictDelete</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parsePostfixExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">allowIn</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">prec </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'||'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&amp;&amp;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'|'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">3</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'^'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">4</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&amp;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">5</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'=='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'!='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'==='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'!=='</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">6</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&lt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&lt;='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'instanceof'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">7</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'in'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s1">allowIn </span><span class="s2">? </span><span class="s5">7 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&lt;&lt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;&gt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;&gt;&gt;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">8</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'+'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'-'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">9</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'*'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'/'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'%'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">11</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">break</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">prec</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.5 Multiplicative Operators</span>
    <span class="s0">// 11.6 Additive Operators</span>
    <span class="s0">// 11.7 Bitwise Shift Operators</span>
    <span class="s0">// 11.8 Relational Operators</span>
    <span class="s0">// 11.9 Equality Operators</span>
    <span class="s0">// 11.10 Binary Bitwise Operators</span>
    <span class="s0">// 11.11 Binary Logical Operators</span>

    <span class="s3">function </span><span class="s1">parseBinaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">marker</span><span class="s2">, </span><span class="s1">markers</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">prec</span><span class="s2">, </span><span class="s1">stack</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">i</span><span class="s2">;</span>

        <span class="s1">marker </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">left </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">prec </span><span class="s2">= </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prec </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">left</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">prec</span><span class="s2">;</span>
        <span class="s1">lex</span><span class="s2">();</span>

        <span class="s1">markers </span><span class="s2">= [</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">lookahead</span><span class="s2">];</span>
        <span class="s1">right </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>

        <span class="s1">stack </span><span class="s2">= [</span><span class="s1">left</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">right</span><span class="s2">];</span>

        <span class="s3">while </span><span class="s2">((</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">, </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">)) &gt; </span><span class="s5">0</span><span class="s2">) {</span>

            <span class="s0">// Reduce: make a binary expression from the three topmost entries.</span>
            <span class="s3">while </span><span class="s2">((</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">2</span><span class="s2">) &amp;&amp; (</span><span class="s1">prec </span><span class="s2">&lt;= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">].</span><span class="s1">prec</span><span class="s2">)) {</span>
                <span class="s1">right </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">operator </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">().</span><span class="s1">value</span><span class="s2">;</span>
                <span class="s1">left </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBinaryExpression</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">);</span>
                <span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">marker </span><span class="s2">= </span><span class="s1">markers</span><span class="s2">[</span><span class="s1">markers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
                <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">// Shift.</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">prec</span><span class="s2">;</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
            <span class="s1">markers</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// Final reduce to clean-up the stack.</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
        <span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBinaryExpression</span><span class="s2">(</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">value</span><span class="s2">, </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s5">2</span><span class="s2">], </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">i </span><span class="s2">-= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s1">marker </span><span class="s2">= </span><span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 11.12 Conditional Operator</span>

    <span class="s3">function </span><span class="s1">parseConditionalExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseBinaryExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'?'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
            <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">consequent </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>

            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createConditionalExpression</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">);</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.13 Assignment Operators</span>

    <span class="s3">function </span><span class="s1">parseAssignmentExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">node</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">node </span><span class="s2">= </span><span class="s1">left </span><span class="s2">= </span><span class="s1">parseConditionalExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchAssign</span><span class="s2">()) {</span>
            <span class="s0">// LeftHandSideExpression</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">left</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">// 11.13.1</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">left</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">left</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">right </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s1">node </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createAssignmentExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.14 Comma Operator</span>

    <span class="s3">function </span><span class="s1">parseExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSequenceExpression</span><span class="s2">([ </span><span class="s1">expr </span><span class="s2">]);</span>

            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr</span><span class="s2">.</span><span class="s1">expressions</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>
            <span class="s2">}</span>

            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 12.1 Block</span>

    <span class="s3">function </span><span class="s1">parseStatementList</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">list </span><span class="s2">= [],</span>
            <span class="s1">statement</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">statement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">statement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">list</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">statement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">list</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseBlock</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">block</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s1">block </span><span class="s2">= </span><span class="s1">parseStatementList</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBlockStatement</span><span class="s2">(</span><span class="s1">block</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.2 Variable Statement</span>

    <span class="s3">function </span><span class="s1">parseVariableIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

        <span class="s0">// 12.2.1</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictVarName</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'const'</span><span class="s2">) {</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">);</span>
            <span class="s1">init </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">init </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclarator</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">init</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableDeclarationList</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">list </span><span class="s2">= [];</span>

        <span class="s3">do </span><span class="s2">{</span>
            <span class="s1">list</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseVariableDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">));</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">list</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">declarations</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'var'</span><span class="s2">);</span>

        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">();</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s4">'var'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// kind may be `const` or `let`</span>
    <span class="s0">// Both are experimental and not in the specification yet.</span>
    <span class="s0">// see http://wiki.ecmascript.org/doku.php?id=harmony:const</span>
    <span class="s0">// and http://wiki.ecmascript.org/doku.php?id=harmony:let</span>
    <span class="s3">function </span><span class="s1">parseConstLetDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">);</span>

        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">);</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.3 Empty Statement</span>

    <span class="s3">function </span><span class="s1">parseEmptyStatement</span><span class="s2">() {</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createEmptyStatement</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// 12.4 Expression Statement</span>

    <span class="s3">function </span><span class="s1">parseExpressionStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
        <span class="s1">consumeSemicolon</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createExpressionStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.5 If statement</span>

    <span class="s3">function </span><span class="s1">parseIfStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'if'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">consequent </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'else'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIfStatement</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.6 Iteration Statements</span>

    <span class="s3">function </span><span class="s1">parseDoWhileStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'do'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'while'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createDoWhileStatement</span><span class="s2">(</span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseWhileStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'while'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createWhileStatement</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseForVariableDeclaration</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseForStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">init </span><span class="s2">= </span><span class="s1">test </span><span class="s2">= </span><span class="s1">update </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'for'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'var'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'let'</span><span class="s2">)) {</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s1">init </span><span class="s2">= </span><span class="s1">parseForVariableDeclaration</span><span class="s2">();</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">init</span><span class="s2">.</span><span class="s1">declarations</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">1 </span><span class="s2">&amp;&amp; </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'in'</span><span class="s2">)) {</span>
                    <span class="s1">lex</span><span class="s2">();</span>
                    <span class="s1">left </span><span class="s2">= </span><span class="s1">init</span><span class="s2">;</span>
                    <span class="s1">right </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                    <span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s1">init </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'in'</span><span class="s2">)) {</span>
                    <span class="s0">// LeftHandSideExpression</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">init</span><span class="s2">)) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInForIn</span><span class="s2">);</span>
                    <span class="s2">}</span>

                    <span class="s1">lex</span><span class="s2">();</span>
                    <span class="s1">left </span><span class="s2">= </span><span class="s1">init</span><span class="s2">;</span>
                    <span class="s1">right </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                    <span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
                <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                <span class="s1">update </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) ?</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">createForStatement</span><span class="s2">(</span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) :</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">createForInStatement</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.7 The continue statement</span>

    <span class="s3">function </span><span class="s1">parseContinueStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">label </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">key</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'continue'</span><span class="s2">);</span>

        <span class="s0">// Optimize the most common form: 'continue;'.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnknownLabel</span><span class="s2">, </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">label </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">&amp;&amp; !</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.8 The break statement</span>

    <span class="s3">function </span><span class="s1">parseBreakStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">label </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">key</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'break'</span><span class="s2">);</span>

        <span class="s0">// Catch the very common case first: immediately a semicolon (U+003B).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(!(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">if </span><span class="s2">(!(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnknownLabel</span><span class="s2">, </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">label </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">&amp;&amp; !(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.9 The return statement</span>

    <span class="s3">function </span><span class="s1">parseReturnStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">argument </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'return'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalReturn</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// 'return' followed by a space and an identifier is very common.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x20</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))) {</span>
                <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                <span class="s1">consumeSemicolon</span><span class="s2">();</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">) &amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.10 The with statement</span>

    <span class="s3">function </span><span class="s1">parseWithStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
            <span class="s0">// TODO(ikarienator): Should we update the test cases instead?</span>
            <span class="s1">skipComment</span><span class="s2">();</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictModeWith</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'with'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">object </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createWithStatement</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.10 The swith statement</span>

    <span class="s3">function </span><span class="s1">parseSwitchCase</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent </span><span class="s2">= [], </span><span class="s1">statement</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">test </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'case'</span><span class="s2">);</span>
            <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'case'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">statement </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s1">consequent</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">statement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchCase</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseSwitchStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">, </span><span class="s1">clause</span><span class="s2">, </span><span class="s1">oldInSwitch</span><span class="s2">, </span><span class="s1">defaultFound</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'switch'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">discriminant </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s1">cases </span><span class="s2">= [];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchStatement</span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">oldInSwitch </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">defaultFound </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">clause </span><span class="s2">= </span><span class="s1">parseSwitchCase</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">clause</span><span class="s2">.</span><span class="s1">test </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">defaultFound</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">MultipleDefaultsInSwitch</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">defaultFound </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">cases</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">clause</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s1">oldInSwitch</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchStatement</span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.13 The throw statement</span>

    <span class="s3">function </span><span class="s1">parseThrowStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">argument</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'throw'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">NewlineAfterThrow</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createThrowStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.14 The try statement</span>

    <span class="s3">function </span><span class="s1">parseCatchClause</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'catch'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">param </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
        <span class="s0">// 12.14.1</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">param</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictCatchVariable</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createCatchClause</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseTryStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">block</span><span class="s2">, </span><span class="s1">handlers </span><span class="s2">= [], </span><span class="s1">finalizer </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'try'</span><span class="s2">);</span>

        <span class="s1">block </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'catch'</span><span class="s2">)) {</span>
            <span class="s1">handlers</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseCatchClause</span><span class="s2">());</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'finally'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">finalizer </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">&amp;&amp; !</span><span class="s1">finalizer</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">NoCatchOrFinally</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createTryStatement</span><span class="s2">(</span><span class="s1">block</span><span class="s2">, [], </span><span class="s1">handlers</span><span class="s2">, </span><span class="s1">finalizer</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.15 The debugger statement</span>

    <span class="s3">function </span><span class="s1">parseDebuggerStatement</span><span class="s2">() {</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'debugger'</span><span class="s2">);</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createDebuggerStatement</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// 12 Statements</span>

    <span class="s3">function </span><span class="s1">parseStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">type </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">expr</span><span class="s2">,</span>
            <span class="s1">labeledBody</span><span class="s2">,</span>
            <span class="s1">key</span><span class="s2">,</span>
            <span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'{'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">';'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseEmptyStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'('</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseExpressionStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">'break'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseBreakStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'continue'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseContinueStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'debugger'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseDebuggerStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'do'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseDoWhileStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'for'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseForStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'function'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseFunctionDeclaration</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'if'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseIfStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'return'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseReturnStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'switch'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseSwitchStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'throw'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseThrowStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'try'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseTryStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'var'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseVariableStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'while'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseWhileStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'with'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseWithStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s0">// 12.12 Labelled Statements</span>
        <span class="s3">if </span><span class="s2">((</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) &amp;&amp; </span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">Redeclaration</span><span class="s2">, </span><span class="s4">'Label'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">labeledBody </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s3">delete </span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLabeledStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">labeledBody</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createExpressionStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 13 Function Definition</span>

    <span class="s3">function </span><span class="s1">parseFunctionSourceElements</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">sourceElement</span><span class="s2">, </span><span class="s1">sourceElements </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">directive</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">,</span>
            <span class="s1">oldLabelSet</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">, </span><span class="s1">oldInSwitch</span><span class="s2">, </span><span class="s1">oldInFunctionBody</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">) {</span>
                <span class="s0">// this is not directive</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">directive </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">directive </span><span class="s2">=== </span><span class="s4">'use strict'</span><span class="s2">) {</span>
                <span class="s1">strict </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">firstRestricted </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">oldLabelSet </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">;</span>
        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">oldInSwitch </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">;</span>
        <span class="s1">oldInFunctionBody </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody</span><span class="s2">;</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet </span><span class="s2">= {};</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">sourceElement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet </span><span class="s2">= </span><span class="s1">oldLabelSet</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s1">oldInSwitch</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody </span><span class="s2">= </span><span class="s1">oldInFunctionBody</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBlockStatement</span><span class="s2">(</span><span class="s1">sourceElements</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">param</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">message</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s1">paramSet </span><span class="s2">= {};</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                <span class="s1">param </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamDupe</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamDupe</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">params</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">param</span><span class="s2">);</span>
                <span class="s1">paramSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
            <span class="s1">stricted</span><span class="s2">: </span><span class="s1">stricted</span><span class="s2">,</span>
            <span class="s1">firstRestricted</span><span class="s2">: </span><span class="s1">firstRestricted</span><span class="s2">,</span>
            <span class="s1">message</span><span class="s2">: </span><span class="s1">message</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseFunctionDeclaration</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">id</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">body</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">);</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">);</span>
        <span class="s1">params </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">stricted</span><span class="s2">;</span>
        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">firstRestricted</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s1">message </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">firstRestricted</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">stricted</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionDeclaration</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseFunctionExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">id </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">body</span><span class="s2">, </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                    <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                    <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">);</span>
        <span class="s1">params </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">stricted</span><span class="s2">;</span>
        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">firstRestricted</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s1">message </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">firstRestricted</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">stricted</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionExpression</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 14 Program</span>

    <span class="s3">function </span><span class="s1">parseSourceElement</span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">'const'</span><span class="s2">:</span>
            <span class="s3">case </span><span class="s4">'let'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseConstLetDeclaration</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'function'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseFunctionDeclaration</span><span class="s2">();</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">parseStatement</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseSourceElements</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">sourceElement</span><span class="s2">, </span><span class="s1">sourceElements </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">directive</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">) {</span>
                <span class="s0">// this is not directive</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">directive </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">directive </span><span class="s2">=== </span><span class="s4">'use strict'</span><span class="s2">) {</span>
                <span class="s1">strict </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">firstRestricted </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s0">/* istanbul ignore if */</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">sourceElement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">sourceElements</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseProgram</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">peek</span><span class="s2">();</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseSourceElements</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProgram</span><span class="s2">(</span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">filterTokenLocation</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">i</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">tokens </span><span class="s2">= [];</span>

        <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
            <span class="s1">entry </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
            <span class="s1">token </span><span class="s2">= {</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">type</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">value</span>
            <span class="s2">};</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
                <span class="s1">token</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
                <span class="s1">token</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">tokenize</span><span class="s2">(</span><span class="s1">code</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">toString</span><span class="s2">,</span>
            <span class="s1">token</span><span class="s2">,</span>
            <span class="s1">tokens</span><span class="s2">;</span>

        <span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">code </span><span class="s2">!== </span><span class="s4">'string' </span><span class="s2">&amp;&amp; !(</span><span class="s1">code </span><span class="s3">instanceof </span><span class="s1">String</span><span class="s2">)) {</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">delegate </span><span class="s2">= </span><span class="s1">SyntaxTreeDelegate</span><span class="s2">;</span>
        <span class="s1">source </span><span class="s2">= </span><span class="s1">code</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) ? </span><span class="s5">1 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">length </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">state </span><span class="s2">= {</span>
            <span class="s1">allowIn</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">labelSet</span><span class="s2">: {},</span>
            <span class="s1">inFunctionBody</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inIteration</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inSwitch</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">lastCommentStart</span><span class="s2">: -</span><span class="s5">1</span>
        <span class="s2">};</span>

        <span class="s1">extra </span><span class="s2">= {};</span>

        <span class="s0">// Options matching.</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

        <span class="s0">// Of course we collect tokens here.</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= [];</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s0">// The following two fields are necessary to compute the Regex tokens.</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>

        <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= [];</span>
        <span class="s2">}</span>

        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">peek</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s3">try </span><span class="s2">{</span>
                    <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
                <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">lexError</span><span class="s2">) {</span>
                    <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">) {</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">lexError</span><span class="s2">);</span>
                        <span class="s0">// We have to break on the first error</span>
                        <span class="s0">// to avoid infinite loops.</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                        <span class="s3">throw </span><span class="s1">lexError</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">filterTokenLocation</span><span class="s2">();</span>
            <span class="s1">tokens </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">tokens</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">tokens</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
            <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">tokens</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parse</span><span class="s2">(</span><span class="s1">code</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">program</span><span class="s2">, </span><span class="s1">toString</span><span class="s2">;</span>

        <span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">code </span><span class="s2">!== </span><span class="s4">'string' </span><span class="s2">&amp;&amp; !(</span><span class="s1">code </span><span class="s3">instanceof </span><span class="s1">String</span><span class="s2">)) {</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">delegate </span><span class="s2">= </span><span class="s1">SyntaxTreeDelegate</span><span class="s2">;</span>
        <span class="s1">source </span><span class="s2">= </span><span class="s1">code</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) ? </span><span class="s5">1 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">length </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">state </span><span class="s2">= {</span>
            <span class="s1">allowIn</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">labelSet</span><span class="s2">: {},</span>
            <span class="s1">inFunctionBody</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inIteration</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inSwitch</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">lastCommentStart</span><span class="s2">: -</span><span class="s5">1</span>
        <span class="s2">};</span>

        <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">attachComment </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">source </span><span class="s2">!== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">source </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">source</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= [];</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">program </span><span class="s2">= </span><span class="s1">parseProgram</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">filterTokenLocation</span><span class="s2">();</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
            <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">program</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Sync with *.json manifests.</span>
    <span class="s1">exports</span><span class="s2">.</span><span class="s1">version </span><span class="s2">= </span><span class="s4">'1.2.2'</span><span class="s2">;</span>

    <span class="s1">exports</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">= </span><span class="s1">tokenize</span><span class="s2">;</span>

    <span class="s1">exports</span><span class="s2">.</span><span class="s1">parse </span><span class="s2">= </span><span class="s1">parse</span><span class="s2">;</span>

    <span class="s0">// Deep copy.</span>
   <span class="s0">/* istanbul ignore next */</span>
    <span class="s1">exports</span><span class="s2">.</span><span class="s1">Syntax </span><span class="s2">= (</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">name</span><span class="s2">, </span><span class="s1">types </span><span class="s2">= {};</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">types </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">for </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">Syntax</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">types</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">Syntax</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">(</span><span class="s1">types</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">types</span><span class="s2">;</span>
    <span class="s2">}());</span>

<span class="s2">}));</span>
<span class="s0">/* vim: set sw=4 ts=4 et tw=80 : */</span>
</pre>
</body>
</html>