<html>
<head>
<title>flat-eslint.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #bcbec4;}
.s5 { color: #7a7e85;}
.s6 { color: #cf8e6d;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
flat-eslint.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@fileoverview </span><span class="s0">Main class using flat config</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Nicholas C. Zakas</span>
 <span class="s0">*/</span>

<span class="s3">&quot;use strict&quot;</span><span class="s4">;</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Requirements</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s5">// Note: Node.js 12 does not support fs/promises.</span>
<span class="s6">const </span><span class="s2">fs </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;fs&quot;</span><span class="s4">).</span><span class="s2">promises</span><span class="s4">;</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">existsSync </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;fs&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">path </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;path&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">findUp </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;find-up&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">version </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../../package.json&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">Linter </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../linter&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">getRuleFromConfig </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-helpers&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{</span>
    <span class="s2">Legacy</span><span class="s4">: {</span>
        <span class="s2">ConfigOps</span><span class="s4">: {</span>
            <span class="s2">getRuleSeverity</span>
        <span class="s4">},</span>
        <span class="s2">ModuleResolver</span><span class="s4">,</span>
        <span class="s2">naming</span>
    <span class="s4">}</span>
<span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;@eslint/eslintrc&quot;</span><span class="s4">);</span>

<span class="s6">const </span><span class="s4">{</span>
    <span class="s2">findFiles</span><span class="s4">,</span>
    <span class="s2">getCacheFile</span><span class="s4">,</span>

    <span class="s2">isNonEmptyString</span><span class="s4">,</span>
    <span class="s2">isArrayOfNonEmptyString</span><span class="s4">,</span>

    <span class="s2">createIgnoreResult</span><span class="s4">,</span>
    <span class="s2">isErrorMessage</span><span class="s4">,</span>

    <span class="s2">processOptions</span>
<span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./eslint-helpers&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">pathToFileURL </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;url&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">FlatConfigArray </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-array&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">LintResultCache </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../cli-engine/lint-result-cache&quot;</span><span class="s4">);</span>

<span class="s5">/* 
 * This is necessary to allow overwriting writeFile for testing purposes. 
 * We can just use fs/promises once we drop Node.js 12 support. 
 */</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Typedefs</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s5">// For VSCode IntelliSense</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).ConfigData} ConfigData */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).DeprecatedRuleInfo} DeprecatedRuleInfo */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).LintMessage} LintMessage */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).LintResult} LintResult */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).ParserOptions} ParserOptions */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Plugin} Plugin */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).ResultsMeta} ResultsMeta */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).RuleConf} RuleConf */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Rule} Rule */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{ReturnType&lt;ConfigArray.extractConfig&gt;} ExtractedConfig */</span>

<span class="s0">/**</span>
 <span class="s0">* The options with which to configure the ESLint instance.</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} FlatESLintOptions</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [allowInlineConfig] Enable or disable inline configuration comments.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{ConfigData} [baseConfig] Base config object, extended by all configs used with this instance</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [cache] Enable result caching.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [cacheLocation] The cache file to use instead of .eslintcache.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{&quot;metadata&quot; | &quot;content&quot;} [cacheStrategy] The strategy used to detect changed files.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [cwd] The value to use for the current working directory.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [errorOnUnmatchedPattern] If `false` then `ESLint#lintFiles()` doesn't throw even if no target files found. Defaults to `true`.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean|Function} [fix] Execute in autofix mode. If a function, should return a boolean.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string[]} [fixTypes] Array of rule types to apply fixes for.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [globInputPaths] Set to false to skip glob resolution of input file paths to lint (default: true). If false, each input file paths is assumed to be a non-glob path to an existing file.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [ignore] False disables all ignore patterns except for the default ones.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string[]} [ignorePatterns] Ignore file patterns to use in addition to config ignores. These patterns are relative to `cwd`.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{ConfigData} [overrideConfig] Override config object, overrides all configs used with this instance</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean|string} [overrideConfigFile] Searches for default config file when falsy;</span>
 <span class="s0">*      doesn't do any config file lookup when `true`; considered to be a config filename</span>
 <span class="s0">*      when a string.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Record&lt;string,Plugin&gt;} [plugins] An array of plugin implementations.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} warnIgnored Show warnings when the file list includes ignored files</span>
 <span class="s0">*/</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Helpers</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s6">const </span><span class="s2">FLAT_CONFIG_FILENAMES </span><span class="s4">= [</span>
    <span class="s3">&quot;eslint.config.js&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;eslint.config.mjs&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;eslint.config.cjs&quot;</span>
<span class="s4">];</span>
<span class="s6">const </span><span class="s2">debug </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;debug&quot;</span><span class="s4">)(</span><span class="s3">&quot;eslint:flat-eslint&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">removedFormatters </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s3">&quot;table&quot;</span><span class="s4">, </span><span class="s3">&quot;codeframe&quot;</span><span class="s4">]);</span>
<span class="s6">const </span><span class="s2">privateMembers </span><span class="s4">= </span><span class="s6">new </span><span class="s2">WeakMap</span><span class="s4">();</span>
<span class="s6">const </span><span class="s2">importedConfigFileModificationTime </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">();</span>

<span class="s0">/**</span>
 <span class="s0">* It will calculate the error and warning count for collection of messages per file</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintMessage[]} messages Collection of messages</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} Contains the stats</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">calculateStatsPerFile</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">stat </span><span class="s4">= {</span>
        <span class="s2">errorCount</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">fatalErrorCount</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">warningCount</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">fixableErrorCount</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
        <span class="s2">fixableWarningCount</span><span class="s4">: </span><span class="s7">0</span>
    <span class="s4">};</span>

    <span class="s6">for </span><span class="s4">(</span><span class="s6">let </span><span class="s2">i </span><span class="s4">= </span><span class="s7">0</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
        <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s2">messages</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">fatal </span><span class="s4">|| </span><span class="s2">message</span><span class="s4">.</span><span class="s2">severity </span><span class="s4">=== </span><span class="s7">2</span><span class="s4">) {</span>
            <span class="s2">stat</span><span class="s4">.</span><span class="s2">errorCount</span><span class="s4">++;</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">fatal</span><span class="s4">) {</span>
                <span class="s2">stat</span><span class="s4">.</span><span class="s2">fatalErrorCount</span><span class="s4">++;</span>
            <span class="s4">}</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">fix</span><span class="s4">) {</span>
                <span class="s2">stat</span><span class="s4">.</span><span class="s2">fixableErrorCount</span><span class="s4">++;</span>
            <span class="s4">}</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">stat</span><span class="s4">.</span><span class="s2">warningCount</span><span class="s4">++;</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">fix</span><span class="s4">) {</span>
                <span class="s2">stat</span><span class="s4">.</span><span class="s2">fixableWarningCount</span><span class="s4">++;</span>
            <span class="s4">}</span>
        <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s6">return </span><span class="s2">stat</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Create rulesMeta object.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Map&lt;string,Rule&gt;} rules a map of rules from which to generate the object.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} metadata for all enabled rules.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createRulesMeta</span><span class="s4">(</span><span class="s2">rules</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">from</span><span class="s4">(</span><span class="s2">rules</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">retVal</span><span class="s4">, [</span><span class="s2">id</span><span class="s4">, </span><span class="s2">rule</span><span class="s4">]) =&gt; {</span>
        <span class="s2">retVal</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">;</span>
        <span class="s6">return </span><span class="s2">retVal</span><span class="s4">;</span>
    <span class="s4">}, {});</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Return the absolute path of a file named `&quot;__placeholder__.js&quot;` in a given directory.</span>
 <span class="s0">* This is used as a replacement for a missing file path.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} cwd An absolute directory path.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The absolute path of a file named `&quot;__placeholder__.js&quot;` in the given directory.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getPlaceholderPath</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">path</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s3">&quot;__placeholder__.js&quot;</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/** </span><span class="s1">@type </span><span class="s0">{WeakMap&lt;ExtractedConfig, DeprecatedRuleInfo[]&gt;} */</span>
<span class="s6">const </span><span class="s2">usedDeprecatedRulesCache </span><span class="s4">= </span><span class="s6">new </span><span class="s2">WeakMap</span><span class="s4">();</span>

<span class="s0">/**</span>
 <span class="s0">* Create used deprecated rule list.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{CLIEngine} eslint The CLIEngine instance.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} maybeFilePath The absolute path to a lint target file or `&quot;&lt;text&gt;&quot;`.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{DeprecatedRuleInfo[]} The used deprecated rule list.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getOrFindUsedDeprecatedRules</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">, </span><span class="s2">maybeFilePath</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s4">{</span>
        <span class="s2">configs</span><span class="s4">,</span>
        <span class="s2">options</span><span class="s4">: { </span><span class="s2">cwd </span><span class="s4">}</span>
    <span class="s4">} = </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s2">filePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">isAbsolute</span><span class="s4">(</span><span class="s2">maybeFilePath</span><span class="s4">)</span>
        <span class="s4">? </span><span class="s2">maybeFilePath</span>
        <span class="s4">: </span><span class="s2">getPlaceholderPath</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>

    <span class="s5">// Most files use the same config, so cache it.</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">config </span><span class="s4">&amp;&amp; !</span><span class="s2">usedDeprecatedRulesCache</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">config</span><span class="s4">)) {</span>
        <span class="s6">const </span><span class="s2">retv </span><span class="s4">= [];</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">) {</span>
            <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleConf</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">)) {</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">getRuleSeverity</span><span class="s4">(</span><span class="s2">ruleConf</span><span class="s4">) === </span><span class="s7">0</span><span class="s4">) {</span>
                    <span class="s6">continue</span><span class="s4">;</span>
                <span class="s4">}</span>
                <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>
                <span class="s6">const </span><span class="s2">meta </span><span class="s4">= </span><span class="s2">rule </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">;</span>

                <span class="s6">if </span><span class="s4">(</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">deprecated</span><span class="s4">) {</span>
                    <span class="s2">retv</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">replacedBy</span><span class="s4">: </span><span class="s2">meta</span><span class="s4">.</span><span class="s2">replacedBy </span><span class="s4">|| [] });</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>


        <span class="s2">usedDeprecatedRulesCache</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">config</span><span class="s4">, </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">(</span><span class="s2">retv</span><span class="s4">));</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">config </span><span class="s4">? </span><span class="s2">usedDeprecatedRulesCache</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">config</span><span class="s4">) : </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">([]);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Processes the linting results generated by a CLIEngine linting report to</span>
 <span class="s0">* match the ESLint class's API.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{CLIEngine} eslint The CLIEngine instance.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{CLIEngineLintReport} report The CLIEngine linting report to process.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintResult[]} The processed linting results.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">processLintReport</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">, { </span><span class="s2">results </span><span class="s4">}) {</span>
    <span class="s6">const </span><span class="s2">descriptor </span><span class="s4">= {</span>
        <span class="s2">configurable</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
        <span class="s2">enumerable</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
        <span class="s2">get</span><span class="s4">() {</span>
            <span class="s6">return </span><span class="s2">getOrFindUsedDeprecatedRules</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">, </span><span class="s6">this</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">};</span>

    <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">result of results</span><span class="s4">) {</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">result</span><span class="s4">, </span><span class="s3">&quot;usedDeprecatedRules&quot;</span><span class="s4">, </span><span class="s2">descriptor</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">results</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* An Array.prototype.sort() compatible compare function to order results by their file path.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResult} a The first lint result.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResult} b The second lint result.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{number} An integer representing the order in which the two results should occur.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">compareResultsByFilePath</span><span class="s4">(</span><span class="s2">a</span><span class="s4">, </span><span class="s2">b</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">a</span><span class="s4">.</span><span class="s2">filePath </span><span class="s4">&lt; </span><span class="s2">b</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s4">-</span><span class="s7">1</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">a</span><span class="s4">.</span><span class="s2">filePath </span><span class="s4">&gt; </span><span class="s2">b</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s7">1</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s7">0</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Searches from the current working directory up until finding the</span>
 <span class="s0">* given flat config filename.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} cwd The current working directory to search from.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;string|undefined&gt;} The filename if found or `undefined` if not.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">findFlatConfigFile</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">findUp</span><span class="s4">(</span>
        <span class="s2">FLAT_CONFIG_FILENAMES</span><span class="s4">,</span>
        <span class="s4">{ </span><span class="s2">cwd </span><span class="s4">}</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Load the config array from the given filename.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filePath The filename to load from.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;any&gt;} The config loaded from the config file.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">loadFlatConfigFile</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">) {</span>
    <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Loading config from </span><span class="s2">$</span><span class="s4">{</span><span class="s2">filePath</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

    <span class="s6">const </span><span class="s2">fileURL </span><span class="s4">= </span><span class="s2">pathToFileURL</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>

    <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Config file URL is </span><span class="s2">$</span><span class="s4">{</span><span class="s2">fileURL</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

    <span class="s6">const </span><span class="s2">mtime </span><span class="s4">= (</span><span class="s6">await </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">stat</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">)).</span><span class="s2">mtime</span><span class="s4">.</span><span class="s2">getTime</span><span class="s4">();</span>

    <span class="s5">/* 
     * Append a query with the config file's modification time (`mtime`) in order 
     * to import the current version of the config file. Without the query, `import()` would 
     * cache the config file module by the pathname only, and then always return 
     * the same version (the one that was actual when the module was imported for the first time). 
     * 
     * This ensures that the config file module is loaded and executed again 
     * if it has been changed since the last time it was imported. 
     * If it hasn't been changed, `import()` will just return the cached version. 
     * 
     * Note that we should not overuse queries (e.g., by appending the current time 
     * to always reload the config file module) as that could cause memory leaks 
     * because entries are never removed from the import cache. 
     */</span>
    <span class="s2">fileURL</span><span class="s4">.</span><span class="s2">searchParams</span><span class="s4">.</span><span class="s2">append</span><span class="s4">(</span><span class="s3">&quot;mtime&quot;</span><span class="s4">, </span><span class="s2">mtime</span><span class="s4">);</span>

    <span class="s5">/* 
     * With queries, we can bypass the import cache. However, when import-ing a CJS module, 
     * Node.js uses the require infrastructure under the hood. That includes the require cache, 
     * which caches the config file module by its file path (queries have no effect). 
     * Therefore, we also need to clear the require cache before importing the config file module. 
     * In order to get the same behavior with ESM and CJS config files, in particular - to reload 
     * the config file only if it has been changed, we track file modification times and clear 
     * the require cache only if the file has been changed. 
     */</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">importedConfigFileModificationTime</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">) !== </span><span class="s2">mtime</span><span class="s4">) {</span>
        <span class="s6">delete </span><span class="s2">require</span><span class="s4">.</span><span class="s2">cache</span><span class="s4">[</span><span class="s2">filePath</span><span class="s4">];</span>
    <span class="s4">}</span>

    <span class="s6">const </span><span class="s2">config </span><span class="s4">= (</span><span class="s6">await import</span><span class="s4">(</span><span class="s2">fileURL</span><span class="s4">)).</span><span class="s2">default</span><span class="s4">;</span>

    <span class="s2">importedConfigFileModificationTime</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">mtime</span><span class="s4">);</span>

    <span class="s6">return </span><span class="s2">config</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Determines which config file to use. This is determined by seeing if an</span>
 <span class="s0">* override config file was passed, and if so, using it; otherwise, as long</span>
 <span class="s0">* as override config file is not explicitly set to `false`, it will search</span>
 <span class="s0">* upwards from the cwd for a file named `eslint.config.js`.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{import(&quot;./eslint&quot;).ESLintOptions} options The ESLint instance options.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{{configFilePath:string|undefined,basePath:string,error:Error|null}} Location information for</span>
 <span class="s0">*      the config file.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">locateConfigFileToUse</span><span class="s4">({ </span><span class="s2">configFile</span><span class="s4">, </span><span class="s2">cwd </span><span class="s4">}) {</span>

    <span class="s5">// determine where to load config file from</span>
    <span class="s6">let </span><span class="s2">configFilePath</span><span class="s4">;</span>
    <span class="s6">let </span><span class="s2">basePath </span><span class="s4">= </span><span class="s2">cwd</span><span class="s4">;</span>
    <span class="s6">let </span><span class="s2">error </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">configFile </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Override config file path is </span><span class="s2">$</span><span class="s4">{</span><span class="s2">configFile</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
        <span class="s2">configFilePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">configFile</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s6">else if </span><span class="s4">(</span><span class="s2">configFile </span><span class="s4">!== </span><span class="s6">false</span><span class="s4">) {</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Searching for eslint.config.js&quot;</span><span class="s4">);</span>
        <span class="s2">configFilePath </span><span class="s4">= </span><span class="s6">await </span><span class="s2">findFlatConfigFile</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">configFilePath</span><span class="s4">) {</span>
            <span class="s2">basePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">dirname</span><span class="s4">(</span><span class="s2">configFilePath</span><span class="s4">));</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">error </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;Could not find config file.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

    <span class="s4">}</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">configFilePath</span><span class="s4">,</span>
        <span class="s2">basePath</span><span class="s4">,</span>
        <span class="s2">error</span>
    <span class="s4">};</span>

<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Calculates the config array for this run based on inputs.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatESLint} eslint The instance to create the config array for.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{import(&quot;./eslint&quot;).ESLintOptions} options The ESLint instance options.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{FlatConfigArray} The config array for `eslint``.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">calculateConfigArray</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">, {</span>
    <span class="s2">cwd</span><span class="s4">,</span>
    <span class="s2">baseConfig</span><span class="s4">,</span>
    <span class="s2">overrideConfig</span><span class="s4">,</span>
    <span class="s2">configFile</span><span class="s4">,</span>
    <span class="s2">ignore</span><span class="s4">: </span><span class="s2">shouldIgnore</span><span class="s4">,</span>
    <span class="s2">ignorePatterns</span>
<span class="s4">}) {</span>

    <span class="s5">// check for cached instance</span>
    <span class="s6">const </span><span class="s2">slots </span><span class="s4">= </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">eslint</span><span class="s4">);</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">configs</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">configs</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">const </span><span class="s4">{ </span><span class="s2">configFilePath</span><span class="s4">, </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">error </span><span class="s4">} = </span><span class="s6">await </span><span class="s2">locateConfigFileToUse</span><span class="s4">({ </span><span class="s2">configFile</span><span class="s4">, </span><span class="s2">cwd </span><span class="s4">});</span>

    <span class="s5">// config file is required to calculate config</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
        <span class="s6">throw </span><span class="s2">error</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">const </span><span class="s2">configs </span><span class="s4">= </span><span class="s6">new </span><span class="s2">FlatConfigArray</span><span class="s4">(</span><span class="s2">baseConfig </span><span class="s4">|| [], { </span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">shouldIgnore </span><span class="s4">});</span>

    <span class="s5">// load config file</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">configFilePath</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">fileConfig </span><span class="s4">= </span><span class="s6">await </span><span class="s2">loadFlatConfigFile</span><span class="s4">(</span><span class="s2">configFilePath</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">fileConfig</span><span class="s4">)) {</span>
            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...fileConfig</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">fileConfig</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">// add in any configured defaults</span>
    <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...slots</span><span class="s4">.</span><span class="s2">defaultConfigs</span><span class="s4">);</span>

    <span class="s5">// append command line ignore patterns</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">ignorePatterns </span><span class="s4">&amp;&amp; </span><span class="s2">ignorePatterns</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>

        <span class="s6">let </span><span class="s2">relativeIgnorePatterns</span><span class="s4">;</span>

        <span class="s5">/* 
         * If the config file basePath is different than the cwd, then 
         * the ignore patterns won't work correctly. Here, we adjust the 
         * ignore pattern to include the correct relative path. Patterns 
         * passed as `ignorePatterns` are relative to the cwd, whereas 
         * the config file basePath can be an ancestor of the cwd. 
         */</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">basePath </span><span class="s4">=== </span><span class="s2">cwd</span><span class="s4">) {</span>
            <span class="s2">relativeIgnorePatterns </span><span class="s4">= </span><span class="s2">ignorePatterns</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>

            <span class="s6">const </span><span class="s2">relativeIgnorePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">relative</span><span class="s4">(</span><span class="s2">basePath</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">);</span>

            <span class="s2">relativeIgnorePatterns </span><span class="s4">= </span><span class="s2">ignorePatterns</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">pattern </span><span class="s4">=&gt; {</span>
                <span class="s6">const </span><span class="s2">negated </span><span class="s4">= </span><span class="s2">pattern</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s3">&quot;!&quot;</span><span class="s4">);</span>
                <span class="s6">const </span><span class="s2">basePattern </span><span class="s4">= </span><span class="s2">negated </span><span class="s4">? </span><span class="s2">pattern</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">) : </span><span class="s2">pattern</span><span class="s4">;</span>

                <span class="s6">return </span><span class="s4">(</span><span class="s2">negated </span><span class="s4">? </span><span class="s3">&quot;!&quot; </span><span class="s4">: </span><span class="s3">&quot;&quot;</span><span class="s4">) +</span>
                <span class="s2">path</span><span class="s4">.</span><span class="s2">posix</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s2">relativeIgnorePath</span><span class="s4">, </span><span class="s2">basePattern</span><span class="s4">);</span>
            <span class="s4">});</span>
        <span class="s4">}</span>

        <span class="s5">/* 
         * Ignore patterns are added to the end of the config array 
         * so they can override default ignores. 
         */</span>
        <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
            <span class="s2">ignores</span><span class="s4">: </span><span class="s2">relativeIgnorePatterns</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">overrideConfig</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">overrideConfig</span><span class="s4">)) {</span>
            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...overrideConfig</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">overrideConfig</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s6">await </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">normalize</span><span class="s4">();</span>

    <span class="s5">// cache the config array for this instance</span>
    <span class="s2">slots</span><span class="s4">.</span><span class="s2">configs </span><span class="s4">= </span><span class="s2">configs</span><span class="s4">;</span>

    <span class="s6">return </span><span class="s2">configs</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Processes an source code using ESLint.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} config The config object.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} config.text The source code to verify.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} config.cwd The path to the current working directory.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|undefined} config.filePath The path to the file of `text`. If this is undefined, it uses `&lt;text&gt;`.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} config.configs The config.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} config.fix If `true` then it does fix.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} config.allowInlineConfig If `true` then it uses directive comments.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Linter} config.linter The linter instance to verify.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintResult} The result of linting.</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">verifyText</span><span class="s4">({</span>
    <span class="s2">text</span><span class="s4">,</span>
    <span class="s2">cwd</span><span class="s4">,</span>
    <span class="s2">filePath</span><span class="s4">: </span><span class="s2">providedFilePath</span><span class="s4">,</span>
    <span class="s2">configs</span><span class="s4">,</span>
    <span class="s2">fix</span><span class="s4">,</span>
    <span class="s2">allowInlineConfig</span><span class="s4">,</span>
    <span class="s2">linter</span>
<span class="s4">}) {</span>
    <span class="s6">const </span><span class="s2">filePath </span><span class="s4">= </span><span class="s2">providedFilePath </span><span class="s4">|| </span><span class="s3">&quot;&lt;text&gt;&quot;</span><span class="s4">;</span>

    <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Lint </span><span class="s2">$</span><span class="s4">{</span><span class="s2">filePath</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

    <span class="s5">/* 
     * Verify. 
     * `config.extractConfig(filePath)` requires an absolute path, but `linter` 
     * doesn't know CWD, so it gives `linter` an absolute path always. 
     */</span>
    <span class="s6">const </span><span class="s2">filePathToVerify </span><span class="s4">= </span><span class="s2">filePath </span><span class="s4">=== </span><span class="s3">&quot;&lt;text&gt;&quot; </span><span class="s4">? </span><span class="s2">getPlaceholderPath</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) : </span><span class="s2">filePath</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s4">{ </span><span class="s2">fixed</span><span class="s4">, </span><span class="s2">messages</span><span class="s4">, </span><span class="s2">output </span><span class="s4">} = </span><span class="s2">linter</span><span class="s4">.</span><span class="s2">verifyAndFix</span><span class="s4">(</span>
        <span class="s2">text</span><span class="s4">,</span>
        <span class="s2">configs</span><span class="s4">,</span>
        <span class="s4">{</span>
            <span class="s2">allowInlineConfig</span><span class="s4">,</span>
            <span class="s2">filename</span><span class="s4">: </span><span class="s2">filePathToVerify</span><span class="s4">,</span>
            <span class="s2">fix</span><span class="s4">,</span>

            <span class="s0">/**</span>
             <span class="s0">* Check if the linter should adopt a given code block or not.</span>
             <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} blockFilename The virtual filename of a code block.</span>
             <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} `true` if the linter should adopt the code block.</span>
             <span class="s0">*/</span>
            <span class="s2">filterCodeBlock</span><span class="s4">(</span><span class="s2">blockFilename</span><span class="s4">) {</span>
                <span class="s6">return </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">blockFilename</span><span class="s4">) !== </span><span class="s6">void </span><span class="s7">0</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">}</span>
    <span class="s4">);</span>

    <span class="s5">// Tweak and return.</span>
    <span class="s6">const </span><span class="s2">result </span><span class="s4">= {</span>
        <span class="s2">filePath</span><span class="s4">: </span><span class="s2">filePath </span><span class="s4">=== </span><span class="s3">&quot;&lt;text&gt;&quot; </span><span class="s4">? </span><span class="s2">filePath </span><span class="s4">: </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">),</span>
        <span class="s2">messages</span><span class="s4">,</span>
        <span class="s2">suppressedMessages</span><span class="s4">: </span><span class="s2">linter</span><span class="s4">.</span><span class="s2">getSuppressedMessages</span><span class="s4">(),</span>
        <span class="s2">...calculateStatsPerFile</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">)</span>
    <span class="s4">};</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">fixed</span><span class="s4">) {</span>
        <span class="s2">result</span><span class="s4">.</span><span class="s2">output </span><span class="s4">= </span><span class="s2">output</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">if </span><span class="s4">(</span>
        <span class="s2">result</span><span class="s4">.</span><span class="s2">errorCount </span><span class="s4">+ </span><span class="s2">result</span><span class="s4">.</span><span class="s2">warningCount </span><span class="s4">&gt; </span><span class="s7">0 </span><span class="s4">&amp;&amp;</span>
        <span class="s6">typeof </span><span class="s2">result</span><span class="s4">.</span><span class="s2">output </span><span class="s4">=== </span><span class="s3">&quot;undefined&quot;</span>
    <span class="s4">) {</span>
        <span class="s2">result</span><span class="s4">.</span><span class="s2">source </span><span class="s4">= </span><span class="s2">text</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Checks whether a message's rule type should be fixed.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintMessage} message The message to check.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfig} config The config for the file that generated the message.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string[]} fixTypes An array of fix types to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} Whether the message should be fixed.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">shouldMessageBeFixed</span><span class="s4">(</span><span class="s2">message</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">fixTypes</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">message</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">fixTypes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s3">&quot;directive&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">message</span><span class="s4">.</span><span class="s2">ruleId </span><span class="s4">&amp;&amp; </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>

    <span class="s6">return </span><span class="s2">Boolean</span><span class="s4">(</span><span class="s2">rule </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">fixTypes</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">type</span><span class="s4">));</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Creates an error to be thrown when an array of results passed to `getRulesMetaForResults` was not created by the current engine.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{TypeError} An error object.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createExtraneousResultsError</span><span class="s4">() {</span>
    <span class="s6">return new </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s3">&quot;Results object was not created from this ESLint instance.&quot;</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Creates a fixer function based on the provided fix, fixTypesSet, and config.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function|boolean} fix The original fix option.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Set&lt;string&gt;} fixTypesSet A set of fix types to filter messages for fixing.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfig} config The config for the file that generated the message.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Function|boolean} The fixer function or the original fix value.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getFixerForFixTypes</span><span class="s4">(</span><span class="s2">fix</span><span class="s4">, </span><span class="s2">fixTypesSet</span><span class="s4">, </span><span class="s2">config</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">fix </span><span class="s4">|| !</span><span class="s2">fixTypesSet</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">fix</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">const </span><span class="s2">originalFix </span><span class="s4">= (</span><span class="s6">typeof </span><span class="s2">fix </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) ? </span><span class="s2">fix </span><span class="s4">: () =&gt; </span><span class="s6">true</span><span class="s4">;</span>

    <span class="s6">return </span><span class="s2">message </span><span class="s4">=&gt; </span><span class="s2">shouldMessageBeFixed</span><span class="s4">(</span><span class="s2">message</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">fixTypesSet</span><span class="s4">) &amp;&amp; </span><span class="s2">originalFix</span><span class="s4">(</span><span class="s2">message</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s5">//-----------------------------------------------------------------------------</span>
<span class="s5">// Main API</span>
<span class="s5">//-----------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Primary Node.js API for ESLint.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">FlatESLint </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* Creates a new instance of the main ESLint API.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatESLintOptions} options The options for this instance.</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">(</span><span class="s2">options </span><span class="s4">= {}) {</span>

        <span class="s6">const </span><span class="s2">defaultConfigs </span><span class="s4">= [];</span>
        <span class="s6">const </span><span class="s2">processedOptions </span><span class="s4">= </span><span class="s2">processOptions</span><span class="s4">(</span><span class="s2">options</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">linter </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Linter</span><span class="s4">({</span>
            <span class="s2">cwd</span><span class="s4">: </span><span class="s2">processedOptions</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">,</span>
            <span class="s2">configType</span><span class="s4">: </span><span class="s3">&quot;flat&quot;</span>
        <span class="s4">});</span>

        <span class="s6">const </span><span class="s2">cacheFilePath </span><span class="s4">= </span><span class="s2">getCacheFile</span><span class="s4">(</span>
            <span class="s2">processedOptions</span><span class="s4">.</span><span class="s2">cacheLocation</span><span class="s4">,</span>
            <span class="s2">processedOptions</span><span class="s4">.</span><span class="s2">cwd</span>
        <span class="s4">);</span>

        <span class="s6">const </span><span class="s2">lintResultCache </span><span class="s4">= </span><span class="s2">processedOptions</span><span class="s4">.</span><span class="s2">cache</span>
            <span class="s4">? </span><span class="s6">new </span><span class="s2">LintResultCache</span><span class="s4">(</span><span class="s2">cacheFilePath</span><span class="s4">, </span><span class="s2">processedOptions</span><span class="s4">.</span><span class="s2">cacheStrategy</span><span class="s4">)</span>
            <span class="s4">: </span><span class="s6">null</span><span class="s4">;</span>

        <span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, {</span>
            <span class="s2">options</span><span class="s4">: </span><span class="s2">processedOptions</span><span class="s4">,</span>
            <span class="s2">linter</span><span class="s4">,</span>
            <span class="s2">cacheFilePath</span><span class="s4">,</span>
            <span class="s2">lintResultCache</span><span class="s4">,</span>
            <span class="s2">defaultConfigs</span><span class="s4">,</span>
            <span class="s2">configs</span><span class="s4">: </span><span class="s6">null</span>
        <span class="s4">});</span>

        <span class="s0">/**</span>
         <span class="s0">* If additional plugins are passed in, add that to the default</span>
         <span class="s0">* configs for this instance.</span>
         <span class="s0">*/</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">plugins</span><span class="s4">) {</span>

            <span class="s6">const </span><span class="s2">plugins </span><span class="s4">= {};</span>

            <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s4">[</span><span class="s2">pluginName</span><span class="s4">, </span><span class="s2">plugin</span><span class="s4">] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">plugins</span><span class="s4">)) {</span>
                <span class="s2">plugins</span><span class="s4">[</span><span class="s2">naming</span><span class="s4">.</span><span class="s2">getShorthandName</span><span class="s4">(</span><span class="s2">pluginName</span><span class="s4">, </span><span class="s3">&quot;eslint-plugin&quot;</span><span class="s4">)] = </span><span class="s2">plugin</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s2">defaultConfigs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                <span class="s2">plugins</span>
            <span class="s4">});</span>
        <span class="s4">}</span>

    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* The version text.</span>
     <span class="s0">* </span><span class="s1">@type </span><span class="s0">{string}</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">get version</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">version</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Outputs fixes from the given results to files.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResult[]} results The lint results.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;void&gt;} Returns a promise that is used to track side effects.</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">async outputFixes</span><span class="s4">(</span><span class="s2">results</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">results</span><span class="s4">)) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'results' must be an array&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>
            <span class="s2">results</span>
                <span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">result </span><span class="s4">=&gt; {</span>
                    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">result </span><span class="s4">!== </span><span class="s3">&quot;object&quot; </span><span class="s4">|| </span><span class="s2">result </span><span class="s4">=== </span><span class="s6">null</span><span class="s4">) {</span>
                        <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'results' must include only objects&quot;</span><span class="s4">);</span>
                    <span class="s4">}</span>
                    <span class="s6">return </span><span class="s4">(</span>
                        <span class="s6">typeof </span><span class="s2">result</span><span class="s4">.</span><span class="s2">output </span><span class="s4">=== </span><span class="s3">&quot;string&quot; </span><span class="s4">&amp;&amp;</span>
                        <span class="s2">path</span><span class="s4">.</span><span class="s2">isAbsolute</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">)</span>
                    <span class="s4">);</span>
                <span class="s4">})</span>
                <span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">r </span><span class="s4">=&gt; </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">writeFile</span><span class="s4">(</span><span class="s2">r</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">r</span><span class="s4">.</span><span class="s2">output</span><span class="s4">))</span>
        <span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Returns results that only contains errors.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResult[]} results The results to filter.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintResult[]} The filtered results.</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">getErrorResults</span><span class="s4">(</span><span class="s2">results</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">filtered </span><span class="s4">= [];</span>

        <span class="s2">results</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">result </span><span class="s4">=&gt; {</span>
            <span class="s6">const </span><span class="s2">filteredMessages </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">isErrorMessage</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s2">filteredSuppressedMessages </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">suppressedMessages</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">isErrorMessage</span><span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">filteredMessages</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
                <span class="s2">filtered</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                    <span class="s2">...result</span><span class="s4">,</span>
                    <span class="s2">messages</span><span class="s4">: </span><span class="s2">filteredMessages</span><span class="s4">,</span>
                    <span class="s2">suppressedMessages</span><span class="s4">: </span><span class="s2">filteredSuppressedMessages</span><span class="s4">,</span>
                    <span class="s2">errorCount</span><span class="s4">: </span><span class="s2">filteredMessages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">,</span>
                    <span class="s2">warningCount</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
                    <span class="s2">fixableErrorCount</span><span class="s4">: </span><span class="s2">result</span><span class="s4">.</span><span class="s2">fixableErrorCount</span><span class="s4">,</span>
                    <span class="s2">fixableWarningCount</span><span class="s4">: </span><span class="s7">0</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">});</span>

        <span class="s6">return </span><span class="s2">filtered</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Returns meta objects for each rule represented in the lint results.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResult[]} results The results to fetch rules meta for.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} A mapping of ruleIds to rule meta objects.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{TypeError} When the results object wasn't created from this ESLint instance.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{TypeError} When a plugin or rule is missing.</span>
     <span class="s0">*/</span>
    <span class="s2">getRulesMetaForResults</span><span class="s4">(</span><span class="s2">results</span><span class="s4">) {</span>

        <span class="s5">// short-circuit simple case</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">results</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s4">{};</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">resultRules </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">();</span>
        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">configs</span><span class="s4">,</span>
            <span class="s2">options</span><span class="s4">: { </span><span class="s2">cwd </span><span class="s4">}</span>
        <span class="s4">} = </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>

        <span class="s5">/* 
         * We can only accurately return rules meta information for linting results if the 
         * results were created by this instance. Otherwise, the necessary rules data is 
         * not available. So if the config array doesn't already exist, just throw an error 
         * to let the user know we can't do anything here. 
         */</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">configs</span><span class="s4">) {</span>
            <span class="s6">throw </span><span class="s2">createExtraneousResultsError</span><span class="s4">();</span>
        <span class="s4">}</span>

        <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">result of results</span><span class="s4">) {</span>

            <span class="s5">/* 
             * Normalize filename for &lt;text&gt;. 
             */</span>
            <span class="s6">const </span><span class="s2">filePath </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">filePath </span><span class="s4">=== </span><span class="s3">&quot;&lt;text&gt;&quot;</span>
                <span class="s4">? </span><span class="s2">getPlaceholderPath</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) : </span><span class="s2">result</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">allMessages </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">suppressedMessages</span><span class="s4">);</span>

            <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s4">{ </span><span class="s2">ruleId </span><span class="s4">} </span><span class="s2">of allMessages</span><span class="s4">) {</span>
                <span class="s6">if </span><span class="s4">(!</span><span class="s2">ruleId</span><span class="s4">) {</span>
                    <span class="s6">continue</span><span class="s4">;</span>
                <span class="s4">}</span>

                <span class="s5">/* 
                 * All of the plugin and rule information is contained within the 
                 * calculated config for the given file. 
                 */</span>
                <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>

                <span class="s6">if </span><span class="s4">(!</span><span class="s2">config</span><span class="s4">) {</span>
                    <span class="s6">throw </span><span class="s2">createExtraneousResultsError</span><span class="s4">();</span>
                <span class="s4">}</span>
                <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>

                <span class="s5">// ignore unknown rules</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">rule</span><span class="s4">) {</span>
                    <span class="s2">resultRules</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">rule</span><span class="s4">);</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">return </span><span class="s2">createRulesMeta</span><span class="s4">(</span><span class="s2">resultRules</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Executes the current configuration on an array of file and directory names.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|string[]} patterns An array of file and directory names.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;LintResult[]&gt;} The results of linting the file patterns given.</span>
     <span class="s0">*/</span>
    <span class="s2">async lintFiles</span><span class="s4">(</span><span class="s2">patterns</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">patterns</span><span class="s4">) &amp;&amp; !</span><span class="s2">isArrayOfNonEmptyString</span><span class="s4">(</span><span class="s2">patterns</span><span class="s4">)) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'patterns' must be a non-empty string or an array of non-empty strings&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">cacheFilePath</span><span class="s4">,</span>
            <span class="s2">lintResultCache</span><span class="s4">,</span>
            <span class="s2">linter</span><span class="s4">,</span>
            <span class="s2">options</span><span class="s4">: </span><span class="s2">eslintOptions</span>
        <span class="s4">} = </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">configs </span><span class="s4">= </span><span class="s6">await </span><span class="s2">calculateConfigArray</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">eslintOptions</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">allowInlineConfig</span><span class="s4">,</span>
            <span class="s2">cache</span><span class="s4">,</span>
            <span class="s2">cwd</span><span class="s4">,</span>
            <span class="s2">fix</span><span class="s4">,</span>
            <span class="s2">fixTypes</span><span class="s4">,</span>
            <span class="s2">globInputPaths</span><span class="s4">,</span>
            <span class="s2">errorOnUnmatchedPattern</span><span class="s4">,</span>
            <span class="s2">warnIgnored</span>
        <span class="s4">} = </span><span class="s2">eslintOptions</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">startTime </span><span class="s4">= </span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">();</span>
        <span class="s6">const </span><span class="s2">fixTypesSet </span><span class="s4">= </span><span class="s2">fixTypes </span><span class="s4">? </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">fixTypes</span><span class="s4">) : </span><span class="s6">null</span><span class="s4">;</span>

        <span class="s5">// Delete cache file; should this be done here?</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">cache </span><span class="s4">&amp;&amp; </span><span class="s2">cacheFilePath</span><span class="s4">) {</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Deleting cache file at </span><span class="s2">$</span><span class="s4">{</span><span class="s2">cacheFilePath</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

            <span class="s6">try </span><span class="s4">{</span>
                <span class="s6">await </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">unlink</span><span class="s4">(</span><span class="s2">cacheFilePath</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
                <span class="s6">const </span><span class="s2">errorCode </span><span class="s4">= </span><span class="s2">error </span><span class="s4">&amp;&amp; </span><span class="s2">error</span><span class="s4">.</span><span class="s2">code</span><span class="s4">;</span>

                <span class="s5">// Ignore errors when no such file exists or file system is read only (and cache file does not exist)</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">errorCode </span><span class="s4">!== </span><span class="s3">&quot;ENOENT&quot; </span><span class="s4">&amp;&amp; !(</span><span class="s2">errorCode </span><span class="s4">=== </span><span class="s3">&quot;EROFS&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">existsSync</span><span class="s4">(</span><span class="s2">cacheFilePath</span><span class="s4">))) {</span>
                    <span class="s6">throw </span><span class="s2">error</span><span class="s4">;</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">filePaths </span><span class="s4">= </span><span class="s6">await </span><span class="s2">findFiles</span><span class="s4">({</span>
            <span class="s2">patterns</span><span class="s4">: </span><span class="s6">typeof </span><span class="s2">patterns </span><span class="s4">=== </span><span class="s3">&quot;string&quot; </span><span class="s4">? [</span><span class="s2">patterns</span><span class="s4">] : </span><span class="s2">patterns</span><span class="s4">,</span>
            <span class="s2">cwd</span><span class="s4">,</span>
            <span class="s2">globInputPaths</span><span class="s4">,</span>
            <span class="s2">configs</span><span class="s4">,</span>
            <span class="s2">errorOnUnmatchedPattern</span>
        <span class="s4">});</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">filePaths</span><span class="s4">.</span><span class="s2">length</span><span class="s4">} </span><span class="s3">files found in: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">() - </span><span class="s2">startTime</span><span class="s4">}</span><span class="s3">ms`</span><span class="s4">);</span>

        <span class="s5">/* 
         * Because we need to process multiple files, including reading from disk, 
         * it is most efficient to start by reading each file via promises so that 
         * they can be done in parallel. Then, we can lint the returned text. This 
         * ensures we are waiting the minimum amount of time in between lints. 
         */</span>
        <span class="s6">const </span><span class="s2">results </span><span class="s4">= </span><span class="s6">await </span><span class="s2">Promise</span><span class="s4">.</span><span class="s2">all</span><span class="s4">(</span>

            <span class="s2">filePaths</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">filePath </span><span class="s4">=&gt; {</span>

                <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>

                <span class="s5">/* 
                 * If a filename was entered that cannot be matched 
                 * to a config, then notify the user. 
                 */</span>
                <span class="s6">if </span><span class="s4">(!</span><span class="s2">config</span><span class="s4">) {</span>
                    <span class="s6">if </span><span class="s4">(</span><span class="s2">warnIgnored</span><span class="s4">) {</span>
                        <span class="s6">return </span><span class="s2">createIgnoreResult</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">);</span>
                    <span class="s4">}</span>

                    <span class="s6">return void </span><span class="s7">0</span><span class="s4">;</span>
                <span class="s4">}</span>

                <span class="s5">// Skip if there is cached result.</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">lintResultCache</span><span class="s4">) {</span>
                    <span class="s6">const </span><span class="s2">cachedResult </span><span class="s4">=</span>
                        <span class="s2">lintResultCache</span><span class="s4">.</span><span class="s2">getCachedLintResults</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>

                    <span class="s6">if </span><span class="s4">(</span><span class="s2">cachedResult</span><span class="s4">) {</span>
                        <span class="s6">const </span><span class="s2">hadMessages </span><span class="s4">=</span>
                            <span class="s2">cachedResult</span><span class="s4">.</span><span class="s2">messages </span><span class="s4">&amp;&amp;</span>
                            <span class="s2">cachedResult</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">;</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hadMessages </span><span class="s4">&amp;&amp; </span><span class="s2">fix</span><span class="s4">) {</span>
                            <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Reprocessing cached file to allow autofix: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">filePath</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                            <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Skipping file since it hasn't changed: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">filePath</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                            <span class="s6">return </span><span class="s2">cachedResult</span><span class="s4">;</span>
                        <span class="s4">}</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>


                <span class="s5">// set up fixer for fixTypes if necessary</span>
                <span class="s6">const </span><span class="s2">fixer </span><span class="s4">= </span><span class="s2">getFixerForFixTypes</span><span class="s4">(</span><span class="s2">fix</span><span class="s4">, </span><span class="s2">fixTypesSet</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>

                <span class="s6">return </span><span class="s2">fs</span><span class="s4">.</span><span class="s2">readFile</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s3">&quot;utf8&quot;</span><span class="s4">)</span>
                    <span class="s4">.</span><span class="s2">then</span><span class="s4">(</span><span class="s2">text </span><span class="s4">=&gt; {</span>

                        <span class="s5">// do the linting</span>
                        <span class="s6">const </span><span class="s2">result </span><span class="s4">= </span><span class="s2">verifyText</span><span class="s4">({</span>
                            <span class="s2">text</span><span class="s4">,</span>
                            <span class="s2">filePath</span><span class="s4">,</span>
                            <span class="s2">configs</span><span class="s4">,</span>
                            <span class="s2">cwd</span><span class="s4">,</span>
                            <span class="s2">fix</span><span class="s4">: </span><span class="s2">fixer</span><span class="s4">,</span>
                            <span class="s2">allowInlineConfig</span><span class="s4">,</span>
                            <span class="s2">linter</span>
                        <span class="s4">});</span>

                        <span class="s5">/* 
                         * Store the lint result in the LintResultCache. 
                         * NOTE: The LintResultCache will remove the file source and any 
                         * other properties that are difficult to serialize, and will 
                         * hydrate those properties back in on future lint runs. 
                         */</span>
                        <span class="s6">if </span><span class="s4">(</span><span class="s2">lintResultCache</span><span class="s4">) {</span>
                            <span class="s2">lintResultCache</span><span class="s4">.</span><span class="s2">setCachedLintResults</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">result</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">return </span><span class="s2">result</span><span class="s4">;</span>
                    <span class="s4">});</span>

            <span class="s4">})</span>
        <span class="s4">);</span>

        <span class="s5">// Persist the cache to disk.</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">lintResultCache</span><span class="s4">) {</span>
            <span class="s2">lintResultCache</span><span class="s4">.</span><span class="s2">reconcile</span><span class="s4">();</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">finalResults </span><span class="s4">= </span><span class="s2">results</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">result </span><span class="s4">=&gt; !!</span><span class="s2">result</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s2">processLintReport</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, {</span>
            <span class="s2">results</span><span class="s4">: </span><span class="s2">finalResults</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Executes the current configuration on text.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} code A string of JavaScript code to lint.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [options] The options.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [options.filePath] The path to the file of the source code.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} [options.warnIgnored] When set to true, warn if given filePath is an ignored path.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;LintResult[]&gt;} The results of linting the string of code given.</span>
     <span class="s0">*/</span>
    <span class="s2">async lintText</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s2">options </span><span class="s4">= {}) {</span>

        <span class="s5">// Parameter validation</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">code </span><span class="s4">!== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'code' must be a string&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">options </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'options' must be an object, null, or undefined&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// Options validation</span>

        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">filePath</span><span class="s4">,</span>
            <span class="s2">warnIgnored</span><span class="s4">,</span>
            <span class="s2">...unknownOptions</span>
        <span class="s4">} = </span><span class="s2">options </span><span class="s4">|| {};</span>

        <span class="s6">const </span><span class="s2">unknownOptionKeys </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">unknownOptions</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s7">0</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">`'options' must not include the unknown option(s): </span><span class="s2">$</span><span class="s4">{</span><span class="s2">unknownOptionKeys</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">`</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">filePath </span><span class="s4">!== </span><span class="s6">void </span><span class="s7">0 </span><span class="s4">&amp;&amp; !</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">)) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'options.filePath' must be a non-empty string or undefined&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">warnIgnored </span><span class="s4">!== </span><span class="s3">&quot;boolean&quot; </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">warnIgnored </span><span class="s4">!== </span><span class="s3">&quot;undefined&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'options.warnIgnored' must be a boolean or undefined&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// Now we can get down to linting</span>

        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">linter</span><span class="s4">,</span>
            <span class="s2">options</span><span class="s4">: </span><span class="s2">eslintOptions</span>
        <span class="s4">} = </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">configs </span><span class="s4">= </span><span class="s6">await </span><span class="s2">calculateConfigArray</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">eslintOptions</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s4">{</span>
            <span class="s2">allowInlineConfig</span><span class="s4">,</span>
            <span class="s2">cwd</span><span class="s4">,</span>
            <span class="s2">fix</span><span class="s4">,</span>
            <span class="s2">fixTypes</span><span class="s4">,</span>
            <span class="s2">warnIgnored</span><span class="s4">: </span><span class="s2">constructorWarnIgnored</span>
        <span class="s4">} = </span><span class="s2">eslintOptions</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">results </span><span class="s4">= [];</span>
        <span class="s6">const </span><span class="s2">startTime </span><span class="s4">= </span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">();</span>
        <span class="s6">const </span><span class="s2">fixTypesSet </span><span class="s4">= </span><span class="s2">fixTypes </span><span class="s4">? </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">(</span><span class="s2">fixTypes</span><span class="s4">) : </span><span class="s6">null</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">resolvedFilename </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">filePath </span><span class="s4">|| </span><span class="s3">&quot;__placeholder__.js&quot;</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">resolvedFilename</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">fixer </span><span class="s4">= </span><span class="s2">getFixerForFixTypes</span><span class="s4">(</span><span class="s2">fix</span><span class="s4">, </span><span class="s2">fixTypesSet</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>

        <span class="s5">// Clear the last used config arrays.</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">resolvedFilename </span><span class="s4">&amp;&amp; </span><span class="s6">await this</span><span class="s4">.</span><span class="s2">isPathIgnored</span><span class="s4">(</span><span class="s2">resolvedFilename</span><span class="s4">)) {</span>
            <span class="s6">const </span><span class="s2">shouldWarnIgnored </span><span class="s4">= </span><span class="s6">typeof </span><span class="s2">warnIgnored </span><span class="s4">=== </span><span class="s3">&quot;boolean&quot; </span><span class="s4">? </span><span class="s2">warnIgnored </span><span class="s4">: </span><span class="s2">constructorWarnIgnored</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">shouldWarnIgnored</span><span class="s4">) {</span>
                <span class="s2">results</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createIgnoreResult</span><span class="s4">(</span><span class="s2">resolvedFilename</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">));</span>
            <span class="s4">}</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>

            <span class="s5">// Do lint.</span>
            <span class="s2">results</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">verifyText</span><span class="s4">({</span>
                <span class="s2">text</span><span class="s4">: </span><span class="s2">code</span><span class="s4">,</span>
                <span class="s2">filePath</span><span class="s4">: </span><span class="s2">resolvedFilename</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s3">&quot;__placeholder__.js&quot;</span><span class="s4">) ? </span><span class="s3">&quot;&lt;text&gt;&quot; </span><span class="s4">: </span><span class="s2">resolvedFilename</span><span class="s4">,</span>
                <span class="s2">configs</span><span class="s4">,</span>
                <span class="s2">cwd</span><span class="s4">,</span>
                <span class="s2">fix</span><span class="s4">: </span><span class="s2">fixer</span><span class="s4">,</span>
                <span class="s2">allowInlineConfig</span><span class="s4">,</span>
                <span class="s2">linter</span>
            <span class="s4">}));</span>
        <span class="s4">}</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Linting complete in: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">Date</span><span class="s4">.</span><span class="s2">now</span><span class="s4">() - </span><span class="s2">startTime</span><span class="s4">}</span><span class="s3">ms`</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s2">processLintReport</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, {</span>
            <span class="s2">results</span>
        <span class="s4">});</span>

    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Returns the formatter representing the given formatter name.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [name] The name of the formatter to load.</span>
     <span class="s0">* The following values are allowed:</span>
     <span class="s0">* - `undefined` ... Load `stylish` builtin formatter.</span>
     <span class="s0">* - A builtin formatter name ... Load the builtin formatter.</span>
     <span class="s0">* - A third-party formatter name:</span>
     <span class="s0">*   - `foo` → `eslint-formatter-foo`</span>
     <span class="s0">*   - `@foo` → `@foo/eslint-formatter`</span>
     <span class="s0">*   - `@foo/bar` → `@foo/eslint-formatter-bar`</span>
     <span class="s0">* - A file path ... Load the file.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;Formatter&gt;} A promise resolving to the formatter object.</span>
     <span class="s0">* This promise will be rejected if the given formatter was not found or not</span>
     <span class="s0">* a function.</span>
     <span class="s0">*/</span>
    <span class="s2">async loadFormatter</span><span class="s4">(</span><span class="s2">name </span><span class="s4">= </span><span class="s3">&quot;stylish&quot;</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">name </span><span class="s4">!== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'name' must be a string&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// replace \ with / for Windows compatibility</span>
        <span class="s6">const </span><span class="s2">normalizedFormatName </span><span class="s4">= </span><span class="s2">name</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/\\/gu</span><span class="s4">, </span><span class="s3">&quot;/&quot;</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">namespace </span><span class="s4">= </span><span class="s2">naming</span><span class="s4">.</span><span class="s2">getNamespaceFromTerm</span><span class="s4">(</span><span class="s2">normalizedFormatName</span><span class="s4">);</span>

        <span class="s5">// grab our options</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">cwd </span><span class="s4">} = </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">options</span><span class="s4">;</span>


        <span class="s6">let </span><span class="s2">formatterPath</span><span class="s4">;</span>

        <span class="s5">// if there's a slash, then it's a file (TODO: this check seems dubious for scoped npm packages)</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">namespace </span><span class="s4">&amp;&amp; </span><span class="s2">normalizedFormatName</span><span class="s4">.</span><span class="s2">includes</span><span class="s4">(</span><span class="s3">&quot;/&quot;</span><span class="s4">)) {</span>
            <span class="s2">formatterPath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">normalizedFormatName</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s6">try </span><span class="s4">{</span>
                <span class="s6">const </span><span class="s2">npmFormat </span><span class="s4">= </span><span class="s2">naming</span><span class="s4">.</span><span class="s2">normalizePackageName</span><span class="s4">(</span><span class="s2">normalizedFormatName</span><span class="s4">, </span><span class="s3">&quot;eslint-formatter&quot;</span><span class="s4">);</span>

                <span class="s5">// TODO: This is pretty dirty...would be nice to clean up at some point.</span>
                <span class="s2">formatterPath </span><span class="s4">= </span><span class="s2">ModuleResolver</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">npmFormat</span><span class="s4">, </span><span class="s2">getPlaceholderPath</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">));</span>
            <span class="s4">} </span><span class="s6">catch </span><span class="s4">{</span>
                <span class="s2">formatterPath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">__dirname</span><span class="s4">, </span><span class="s3">&quot;../&quot;</span><span class="s4">, </span><span class="s3">&quot;cli-engine&quot;</span><span class="s4">, </span><span class="s3">&quot;formatters&quot;</span><span class="s4">, </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">normalizedFormatName</span><span class="s4">}</span><span class="s3">.js`</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">let </span><span class="s2">formatter</span><span class="s4">;</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s2">formatter </span><span class="s4">= (</span><span class="s6">await import</span><span class="s4">(</span><span class="s2">pathToFileURL</span><span class="s4">(</span><span class="s2">formatterPath</span><span class="s4">))).</span><span class="s2">default</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">ex</span><span class="s4">) {</span>

            <span class="s5">// check for formatters that have been removed</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">removedFormatters</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">name</span><span class="s4">)) {</span>
                <span class="s2">ex</span><span class="s4">.</span><span class="s2">message </span><span class="s4">= </span><span class="s3">`The </span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">} </span><span class="s3">formatter is no longer part of core ESLint. Install it manually with </span><span class="s6">\`</span><span class="s3">npm install -D eslint-formatter-</span><span class="s2">$</span><span class="s4">{</span><span class="s2">name</span><span class="s4">}</span><span class="s6">\`</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">ex</span><span class="s4">.</span><span class="s2">message </span><span class="s4">= </span><span class="s3">`There was a problem loading formatter: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">formatterPath</span><span class="s4">}</span><span class="s6">\n</span><span class="s3">Error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ex</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">throw </span><span class="s2">ex</span><span class="s4">;</span>
        <span class="s4">}</span>


        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">formatter </span><span class="s4">!== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s3">`Formatter must be a function, but got a </span><span class="s2">$</span><span class="s4">{</span><span class="s6">typeof </span><span class="s2">formatter</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">eslint </span><span class="s4">= </span><span class="s6">this</span><span class="s4">;</span>

        <span class="s6">return </span><span class="s4">{</span>

            <span class="s0">/**</span>
             <span class="s0">* The main formatter method.</span>
             <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LintResults[]} results The lint results to format.</span>
             <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ResultsMeta} resultsMeta Warning count and max threshold.</span>
             <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The formatted lint results.</span>
             <span class="s0">*/</span>
            <span class="s2">format</span><span class="s4">(</span><span class="s2">results</span><span class="s4">, </span><span class="s2">resultsMeta</span><span class="s4">) {</span>
                <span class="s6">let </span><span class="s2">rulesMeta </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>

                <span class="s2">results</span><span class="s4">.</span><span class="s2">sort</span><span class="s4">(</span><span class="s2">compareResultsByFilePath</span><span class="s4">);</span>

                <span class="s6">return </span><span class="s2">formatter</span><span class="s4">(</span><span class="s2">results</span><span class="s4">, {</span>
                    <span class="s2">...resultsMeta</span><span class="s4">,</span>
                    <span class="s2">cwd</span><span class="s4">,</span>
                    <span class="s2">get rulesMeta</span><span class="s4">() {</span>
                        <span class="s6">if </span><span class="s4">(!</span><span class="s2">rulesMeta</span><span class="s4">) {</span>
                            <span class="s2">rulesMeta </span><span class="s4">= </span><span class="s2">eslint</span><span class="s4">.</span><span class="s2">getRulesMetaForResults</span><span class="s4">(</span><span class="s2">results</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">return </span><span class="s2">rulesMeta</span><span class="s4">;</span>
                    <span class="s4">}</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">};</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Returns a configuration object for the given file based on the CLI options.</span>
     <span class="s0">* This is the same logic used by the ESLint CLI executable to determine</span>
     <span class="s0">* configuration for each file it processes.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filePath The path of the file to retrieve a config object for.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;ConfigData|undefined&gt;} A configuration object for the file</span>
     <span class="s0">*      or `undefined` if there is no configuration data for the object.</span>
     <span class="s0">*/</span>
    <span class="s2">async calculateConfigForFile</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">isNonEmptyString</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">)) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;'filePath' must be a non-empty string&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">const </span><span class="s2">options </span><span class="s4">= </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">options</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">absolutePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">resolve</span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">configs </span><span class="s4">= </span><span class="s6">await </span><span class="s2">calculateConfigArray</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">absolutePath</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Finds the config file being used by this instance based on the options</span>
     <span class="s0">* passed to the constructor.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string|undefined} The path to the config file being used or</span>
     <span class="s0">*      `undefined` if no config file is being used.</span>
     <span class="s0">*/</span>
    <span class="s2">async findConfigFile</span><span class="s4">() {</span>
        <span class="s6">const </span><span class="s2">options </span><span class="s4">= </span><span class="s2">privateMembers</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">options</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">configFilePath </span><span class="s4">} = </span><span class="s6">await </span><span class="s2">locateConfigFileToUse</span><span class="s4">(</span><span class="s2">options</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s2">configFilePath</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Checks if a given path is ignored by ESLint.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filePath The path of the file to check.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;boolean&gt;} Whether or not the given path is ignored.</span>
     <span class="s0">*/</span>
    <span class="s2">async isPathIgnored</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s6">await this</span><span class="s4">.</span><span class="s2">calculateConfigForFile</span><span class="s4">(</span><span class="s2">filePath</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s2">config </span><span class="s4">=== </span><span class="s6">void </span><span class="s7">0</span><span class="s4">;</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* The type of configuration used by this class.</span>
 <span class="s0">* </span><span class="s1">@type </span><span class="s0">{string}</span>
 <span class="s0">* </span><span class="s1">@static</span>
 <span class="s0">*/</span>
<span class="s2">FlatESLint</span><span class="s4">.</span><span class="s2">configType </span><span class="s4">= </span><span class="s3">&quot;flat&quot;</span><span class="s4">;</span>

<span class="s0">/**</span>
 <span class="s0">* Returns whether flat config should be used.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [options] The options for this function.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [options.cwd] The current working directory.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Promise&lt;boolean&gt;} Whether flat config should be used.</span>
 <span class="s0">*/</span>
<span class="s2">async </span><span class="s6">function </span><span class="s2">shouldUseFlatConfig</span><span class="s4">({ </span><span class="s2">cwd </span><span class="s4">= </span><span class="s2">process</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">() } = {}) {</span>
    <span class="s6">switch </span><span class="s4">(</span><span class="s2">process</span><span class="s4">.</span><span class="s2">env</span><span class="s4">.</span><span class="s2">ESLINT_USE_FLAT_CONFIG</span><span class="s4">) {</span>
        <span class="s6">case </span><span class="s3">&quot;true&quot;</span><span class="s4">:</span>
            <span class="s6">return true</span><span class="s4">;</span>
        <span class="s6">case </span><span class="s3">&quot;false&quot;</span><span class="s4">:</span>
            <span class="s6">return false</span><span class="s4">;</span>
        <span class="s6">default</span><span class="s4">:</span>

            <span class="s5">/* 
             * If neither explicitly enabled nor disabled, then use the presence 
             * of a flat config file to determine enablement. 
             */</span>
            <span class="s6">return </span><span class="s4">!!(</span><span class="s6">await </span><span class="s2">findFlatConfigFile</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">));</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Public Interface</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s2">module</span><span class="s4">.</span><span class="s2">exports </span><span class="s4">= {</span>
    <span class="s2">FlatESLint</span><span class="s4">,</span>
    <span class="s2">shouldUseFlatConfig</span>
<span class="s4">};</span>
</pre>
</body>
</html>