<html>
<head>
<title>flat-rule-tester.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #bcbec4;}
.s5 { color: #7a7e85;}
.s6 { color: #cf8e6d;}
.s7 { color: #42c3d4;}
.s8 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
flat-rule-tester.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@fileoverview </span><span class="s0">Mocha/Jest test wrapper</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Ilya Volodin</span>
 <span class="s0">*/</span>
<span class="s3">&quot;use strict&quot;</span><span class="s4">;</span>

<span class="s5">/* globals describe, it -- Mocha globals */</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Requirements</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s6">const</span>
    <span class="s2">assert </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;assert&quot;</span><span class="s4">),</span>
    <span class="s2">util </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;util&quot;</span><span class="s4">),</span>
    <span class="s2">path </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;path&quot;</span><span class="s4">),</span>
    <span class="s2">equal </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;fast-deep-equal&quot;</span><span class="s4">),</span>
    <span class="s2">Traverser </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/traverser&quot;</span><span class="s4">),</span>
    <span class="s4">{ </span><span class="s2">getRuleOptionsSchema </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-helpers&quot;</span><span class="s4">),</span>
    <span class="s4">{ </span><span class="s2">Linter</span><span class="s4">, </span><span class="s2">SourceCodeFixer</span><span class="s4">, </span><span class="s2">interpolate </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../linter&quot;</span><span class="s4">),</span>
    <span class="s2">CodePath </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../linter/code-path-analysis/code-path&quot;</span><span class="s4">);</span>

<span class="s6">const </span><span class="s4">{ </span><span class="s2">FlatConfigArray </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-array&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">defaultConfig </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/default-config&quot;</span><span class="s4">);</span>

<span class="s6">const </span><span class="s2">ajv </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/ajv&quot;</span><span class="s4">)({ </span><span class="s2">strictDefaults</span><span class="s4">: </span><span class="s6">true </span><span class="s4">});</span>

<span class="s6">const </span><span class="s2">parserSymbol </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">.</span><span class="s2">for</span><span class="s4">(</span><span class="s3">&quot;eslint.RuleTester.parser&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">SourceCode </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../source-code&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">ConfigArraySymbol </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;@humanwhocodes/config-array&quot;</span><span class="s4">);</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Typedefs</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Parser} Parser */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).LanguageOptions} LanguageOptions */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Rule} Rule */</span>


<span class="s0">/**</span>
 <span class="s0">* A test case that is expected to pass lint.</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} ValidTestCase</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [name] Name for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} code Code for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{any[]} [options] Options for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{LanguageOptions} [languageOptions] The language options to use in the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{{ [name: string]: any }} [settings] Settings for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [filename] The fake filename for the test case. Useful for rules that make assertion about filenames.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [only] Run only this test case or the subset of test cases with this property.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* A test case that is expected to fail lint.</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} InvalidTestCase</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [name] Name for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} code Code for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number | Array&lt;TestCaseError | string | RegExp&gt;} errors Expected errors.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string | null} [output] The expected code after autofixes are applied. If set to `null`, the test runner will assert that no autofix is suggested.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{any[]} [options] Options for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{{ [name: string]: any }} [settings] Settings for the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [filename] The fake filename for the test case. Useful for rules that make assertion about filenames.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{LanguageOptions} [languageOptions] The language options to use in the test case.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [only] Run only this test case or the subset of test cases with this property.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* A description of a reported error used in a rule tester test.</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} TestCaseError</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string | RegExp} [message] Message.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [messageId] Message ID.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [type] The type of the reported AST node.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{{ [name: string]: string }} [data] The data used to fill the message template.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} [line] The 1-based line number of the reported start location.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} [column] The 1-based column number of the reported start location.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} [endLine] The 1-based line number of the reported end location.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} [endColumn] The 1-based column number of the reported end location.</span>
 <span class="s0">*/</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Private Members</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s5">/* 
 * testerDefaultConfig must not be modified as it allows to reset the tester to 
 * the initial default configuration 
 */</span>
<span class="s6">const </span><span class="s2">testerDefaultConfig </span><span class="s4">= { </span><span class="s2">rules</span><span class="s4">: {} };</span>

<span class="s5">/* 
 * RuleTester uses this config as its default. This can be overwritten via 
 * setDefaultConfig(). 
 */</span>
<span class="s6">let </span><span class="s2">sharedDefaultConfig </span><span class="s4">= { </span><span class="s2">rules</span><span class="s4">: {} };</span>

<span class="s5">/* 
 * List every parameters possible on a test case that are not related to eslint 
 * configuration 
 */</span>
<span class="s6">const </span><span class="s2">RuleTesterParameters </span><span class="s4">= [</span>
    <span class="s3">&quot;name&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;code&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;filename&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;options&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;errors&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;output&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;only&quot;</span>
<span class="s4">];</span>

<span class="s5">/* 
 * All allowed property names in error objects. 
 */</span>
<span class="s6">const </span><span class="s2">errorObjectParameters </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span>
    <span class="s3">&quot;message&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;messageId&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;data&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;type&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;line&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;column&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;endLine&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;endColumn&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;suggestions&quot;</span>
<span class="s4">]);</span>
<span class="s6">const </span><span class="s2">friendlyErrorObjectParameterList </span><span class="s4">= </span><span class="s3">`[</span><span class="s2">$</span><span class="s4">{[</span><span class="s2">...errorObjectParameters</span><span class="s4">].</span><span class="s2">map</span><span class="s4">(</span><span class="s2">key </span><span class="s4">=&gt; </span><span class="s3">`'</span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s3">'`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">]`</span><span class="s4">;</span>

<span class="s5">/* 
 * All allowed property names in suggestion objects. 
 */</span>
<span class="s6">const </span><span class="s2">suggestionObjectParameters </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span>
    <span class="s3">&quot;desc&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;messageId&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;data&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;output&quot;</span>
<span class="s4">]);</span>
<span class="s6">const </span><span class="s2">friendlySuggestionObjectParameterList </span><span class="s4">= </span><span class="s3">`[</span><span class="s2">$</span><span class="s4">{[</span><span class="s2">...suggestionObjectParameters</span><span class="s4">].</span><span class="s2">map</span><span class="s4">(</span><span class="s2">key </span><span class="s4">=&gt; </span><span class="s3">`'</span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s3">'`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">]`</span><span class="s4">;</span>

<span class="s6">const </span><span class="s2">forbiddenMethods </span><span class="s4">= [</span>
    <span class="s3">&quot;applyInlineConfig&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;applyLanguageOptions&quot;</span><span class="s4">,</span>
    <span class="s3">&quot;finalize&quot;</span>
<span class="s4">];</span>

<span class="s0">/** </span><span class="s1">@type </span><span class="s0">{Map&lt;string,WeakSet&gt;} */</span>
<span class="s6">const </span><span class="s2">forbiddenMethodCalls </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">(</span><span class="s2">forbiddenMethods</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">methodName </span><span class="s4">=&gt; ([</span><span class="s2">methodName</span><span class="s4">, </span><span class="s6">new </span><span class="s2">WeakSet</span><span class="s4">()])));</span>

<span class="s6">const </span><span class="s2">hasOwnProperty </span><span class="s4">= </span><span class="s2">Function</span><span class="s4">.</span><span class="s2">call</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">(</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">);</span>

<span class="s0">/**</span>
 <span class="s0">* Clones a given value deeply.</span>
 <span class="s0">* Note: This ignores `parent` property.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x A value to clone.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{any} A cloned value.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">cloneDeeplyExcludesParent</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">x </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">x</span><span class="s4">)) {</span>
            <span class="s6">return </span><span class="s2">x</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">cloneDeeplyExcludesParent</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">retv </span><span class="s4">= {};</span>

        <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">key </span><span class="s6">in </span><span class="s2">x</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">key </span><span class="s4">!== </span><span class="s3">&quot;parent&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">x</span><span class="s4">, </span><span class="s2">key</span><span class="s4">)) {</span>
                <span class="s2">retv</span><span class="s4">[</span><span class="s2">key</span><span class="s4">] = </span><span class="s2">cloneDeeplyExcludesParent</span><span class="s4">(</span><span class="s2">x</span><span class="s4">[</span><span class="s2">key</span><span class="s4">]);</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">return </span><span class="s2">retv</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">x</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Freezes a given value deeply.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} x A value to freeze.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">freezeDeeply</span><span class="s4">(</span><span class="s2">x</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">x </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">x </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">x</span><span class="s4">)) {</span>
            <span class="s2">x</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">freezeDeeply</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">key </span><span class="s6">in </span><span class="s2">x</span><span class="s4">) {</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">key </span><span class="s4">!== </span><span class="s3">&quot;parent&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">x</span><span class="s4">, </span><span class="s2">key</span><span class="s4">)) {</span>
                    <span class="s2">freezeDeeply</span><span class="s4">(</span><span class="s2">x</span><span class="s4">[</span><span class="s2">key</span><span class="s4">]);</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">(</span><span class="s2">x</span><span class="s4">);</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Replace control characters by `\u00xx` form.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text The text to sanitize.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The sanitized text.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">sanitize</span><span class="s4">(</span><span class="s2">text</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">text </span><span class="s4">!== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s3">&quot;&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s6">return </span><span class="s2">text</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span>
        <span class="s7">/[\u0000-\u0009\u000b-\u001a]/gu</span><span class="s4">, </span><span class="s5">// eslint-disable-line no-control-regex -- Escaping controls</span>
        <span class="s2">c </span><span class="s4">=&gt; </span><span class="s3">`</span><span class="s6">\\</span><span class="s3">u</span><span class="s2">$</span><span class="s4">{</span><span class="s2">c</span><span class="s4">.</span><span class="s2">codePointAt</span><span class="s4">(</span><span class="s8">0</span><span class="s4">).</span><span class="s2">toString</span><span class="s4">(</span><span class="s8">16</span><span class="s4">).</span><span class="s2">padStart</span><span class="s4">(</span><span class="s8">4</span><span class="s4">, </span><span class="s3">&quot;0&quot;</span><span class="s4">)}</span><span class="s3">`</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Define `start`/`end` properties as throwing error.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} objName Object name used for error messages.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ASTNode} node The node to define.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">defineStartEndAsError</span><span class="s4">(</span><span class="s2">objName</span><span class="s4">, </span><span class="s2">node</span><span class="s4">) {</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperties</span><span class="s4">(</span><span class="s2">node</span><span class="s4">, {</span>
        <span class="s2">start</span><span class="s4">: {</span>
            <span class="s2">get</span><span class="s4">() {</span>
                <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">`Use </span><span class="s2">$</span><span class="s4">{</span><span class="s2">objName</span><span class="s4">}</span><span class="s3">.range[0] instead of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">objName</span><span class="s4">}</span><span class="s3">.start`</span><span class="s4">);</span>
            <span class="s4">},</span>
            <span class="s2">configurable</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">enumerable</span><span class="s4">: </span><span class="s6">false</span>
        <span class="s4">},</span>
        <span class="s2">end</span><span class="s4">: {</span>
            <span class="s2">get</span><span class="s4">() {</span>
                <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">`Use </span><span class="s2">$</span><span class="s4">{</span><span class="s2">objName</span><span class="s4">}</span><span class="s3">.range[1] instead of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">objName</span><span class="s4">}</span><span class="s3">.end`</span><span class="s4">);</span>
            <span class="s4">},</span>
            <span class="s2">configurable</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">enumerable</span><span class="s4">: </span><span class="s6">false</span>
        <span class="s4">}</span>
    <span class="s4">});</span>
<span class="s4">}</span>


<span class="s0">/**</span>
 <span class="s0">* Define `start`/`end` properties of all nodes of the given AST as throwing error.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ASTNode} ast The root node to errorize `start`/`end` properties.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [visitorKeys] Visitor keys to be used for traversing the given ast.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">defineStartEndAsErrorInTree</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">visitorKeys</span><span class="s4">) {</span>
    <span class="s2">Traverser</span><span class="s4">.</span><span class="s2">traverse</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">, { </span><span class="s2">visitorKeys</span><span class="s4">, </span><span class="s2">enter</span><span class="s4">: </span><span class="s2">defineStartEndAsError</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">(</span><span class="s6">null</span><span class="s4">, </span><span class="s3">&quot;node&quot;</span><span class="s4">) });</span>
    <span class="s2">ast</span><span class="s4">.</span><span class="s2">tokens</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">defineStartEndAsError</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">(</span><span class="s6">null</span><span class="s4">, </span><span class="s3">&quot;token&quot;</span><span class="s4">));</span>
    <span class="s2">ast</span><span class="s4">.</span><span class="s2">comments</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">defineStartEndAsError</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">(</span><span class="s6">null</span><span class="s4">, </span><span class="s3">&quot;token&quot;</span><span class="s4">));</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Wraps the given parser in order to intercept and modify return values from the `parse` and `parseForESLint` methods, for test purposes.</span>
 <span class="s0">* In particular, to modify ast nodes, tokens and comments to throw on access to their `start` and `end` properties.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Parser} parser Parser object.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Parser} Wrapped parser object.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">wrapParser</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">) {</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parseForESLint </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s4">{</span>
            <span class="s4">[</span><span class="s2">parserSymbol</span><span class="s4">]: </span><span class="s2">parser</span><span class="s4">,</span>
            <span class="s2">parseForESLint</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) {</span>
                <span class="s6">const </span><span class="s2">ret </span><span class="s4">= </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parseForESLint</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">);</span>

                <span class="s2">defineStartEndAsErrorInTree</span><span class="s4">(</span><span class="s2">ret</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">ret</span><span class="s4">.</span><span class="s2">visitorKeys</span><span class="s4">);</span>
                <span class="s6">return </span><span class="s2">ret</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">};</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s4">[</span><span class="s2">parserSymbol</span><span class="s4">]: </span><span class="s2">parser</span><span class="s4">,</span>
        <span class="s2">parse</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">ast </span><span class="s4">= </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">);</span>

            <span class="s2">defineStartEndAsErrorInTree</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">);</span>
            <span class="s6">return </span><span class="s2">ast</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Function to replace `SourceCode.prototype.getComments`.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} Deprecation message.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getCommentsDeprecation</span><span class="s4">() {</span>
    <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span>
        <span class="s3">&quot;`SourceCode#getComments()` is deprecated and will be removed in a future major version. Use `getCommentsBefore()`, `getCommentsAfter()`, and `getCommentsInside()` instead.&quot;</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Emit a deprecation warning if rule uses CodePath#currentSegments.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} ruleName Name of the rule.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">emitCodePathCurrentSegmentsWarning</span><span class="s4">(</span><span class="s2">ruleName</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(!</span><span class="s2">emitCodePathCurrentSegmentsWarning</span><span class="s4">[</span><span class="s3">`warned-</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">}</span><span class="s3">`</span><span class="s4">]) {</span>
        <span class="s2">emitCodePathCurrentSegmentsWarning</span><span class="s4">[</span><span class="s3">`warned-</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">}</span><span class="s3">`</span><span class="s4">] = </span><span class="s6">true</span><span class="s4">;</span>
        <span class="s2">process</span><span class="s4">.</span><span class="s2">emitWarning</span><span class="s4">(</span>
            <span class="s3">`&quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">}</span><span class="s3">&quot; rule uses CodePath#currentSegments and will stop working in ESLint v9. Please read the documentation for how to update your code: https://eslint.org/docs/latest/extend/code-path-analysis#usage-examples`</span><span class="s4">,</span>
            <span class="s3">&quot;DeprecationWarning&quot;</span>
        <span class="s4">);</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Function to replace forbidden `SourceCode` methods. Allows just one call per method.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} methodName The name of the method to forbid.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function} prototype The prototype with the original method to call.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Function} The function that throws the error.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">throwForbiddenMethodError</span><span class="s4">(</span><span class="s2">methodName</span><span class="s4">, </span><span class="s2">prototype</span><span class="s4">) {</span>

    <span class="s6">const </span><span class="s2">original </span><span class="s4">= </span><span class="s2">prototype</span><span class="s4">[</span><span class="s2">methodName</span><span class="s4">];</span>

    <span class="s6">return function</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) {</span>

        <span class="s6">const </span><span class="s2">called </span><span class="s4">= </span><span class="s2">forbiddenMethodCalls</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">methodName</span><span class="s4">);</span>

        <span class="s5">/* eslint-disable no-invalid-this -- needed to operate as a method. */</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">called</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s6">this</span><span class="s4">)) {</span>
            <span class="s2">called</span><span class="s4">.</span><span class="s2">add</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>

            <span class="s6">return </span><span class="s2">original</span><span class="s4">.</span><span class="s2">apply</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">args</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s5">/* eslint-enable no-invalid-this -- not needed past this point */</span>

        <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span>
            <span class="s3">`</span><span class="s6">\`</span><span class="s3">SourceCode#</span><span class="s2">$</span><span class="s4">{</span><span class="s2">methodName</span><span class="s4">}</span><span class="s3">()</span><span class="s6">\` </span><span class="s3">cannot be called inside a rule.`</span>
        <span class="s4">);</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Public Interface</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s5">// default separators for testing</span>
<span class="s6">const </span><span class="s2">DESCRIBE </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">(</span><span class="s3">&quot;describe&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">IT </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">(</span><span class="s3">&quot;it&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">IT_ONLY </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">(</span><span class="s3">&quot;itOnly&quot;</span><span class="s4">);</span>

<span class="s0">/**</span>
 <span class="s0">* This is `it` default handler if `it` don't exist.</span>
 <span class="s0">* </span><span class="s1">@this </span><span class="s0">{Mocha}</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text The description of the test case.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function} method The logic of the test case.</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} Any error upon execution of `method`.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{any} Returned value of `method`.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">itDefaultHandler</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">method</span><span class="s4">) {</span>
    <span class="s6">try </span><span class="s4">{</span>
        <span class="s6">return </span><span class="s2">method</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">err </span><span class="s6">instanceof </span><span class="s2">assert</span><span class="s4">.</span><span class="s2">AssertionError</span><span class="s4">) {</span>
            <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">` (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">actual</span><span class="s4">)} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">err</span><span class="s4">.</span><span class="s2">operator</span><span class="s4">} </span><span class="s2">$</span><span class="s4">{</span><span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">expected</span><span class="s4">)}</span><span class="s3">)`</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s6">throw </span><span class="s2">err</span><span class="s4">;</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* This is `describe` default handler if `describe` don't exist.</span>
 <span class="s0">* </span><span class="s1">@this </span><span class="s0">{Mocha}</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text The description of the test case.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function} method The logic of the test case.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{any} Returned value of `method`.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">describeDefaultHandler</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">method</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">method</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Mocha test wrapper.</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">FlatRuleTester </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* Creates a new instance of RuleTester.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [testerConfig] Optional, extra configuration for the tester</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">(</span><span class="s2">testerConfig </span><span class="s4">= {}) {</span>

        <span class="s0">/**</span>
         <span class="s0">* The configuration to use for this tester. Combination of the tester</span>
         <span class="s0">* configuration and the default configuration.</span>
         <span class="s0">* </span><span class="s1">@type </span><span class="s0">{Object}</span>
         <span class="s0">*/</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">testerConfig </span><span class="s4">= [</span>
            <span class="s2">sharedDefaultConfig</span><span class="s4">,</span>
            <span class="s2">testerConfig</span><span class="s4">,</span>
            <span class="s4">{ </span><span class="s2">rules</span><span class="s4">: { </span><span class="s3">&quot;rule-tester/validate-ast&quot;</span><span class="s4">: </span><span class="s3">&quot;error&quot; </span><span class="s4">} }</span>
        <span class="s4">];</span>

        <span class="s6">this</span><span class="s4">.</span><span class="s2">linter </span><span class="s4">= </span><span class="s6">new </span><span class="s2">Linter</span><span class="s4">({ </span><span class="s2">configType</span><span class="s4">: </span><span class="s3">&quot;flat&quot; </span><span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Set the configuration to use for all future tests</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} config the configuration to use.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{TypeError} If non-object config.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">setDefaultConfig</span><span class="s4">(</span><span class="s2">config</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">config </span><span class="s4">!== </span><span class="s3">&quot;object&quot; </span><span class="s4">|| </span><span class="s2">config </span><span class="s4">=== </span><span class="s6">null</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s3">&quot;FlatRuleTester.setDefaultConfig: config must be an object&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s2">sharedDefaultConfig </span><span class="s4">= </span><span class="s2">config</span><span class="s4">;</span>

        <span class="s5">// Make sure the rules object exists since it is assumed to exist later</span>
        <span class="s2">sharedDefaultConfig</span><span class="s4">.</span><span class="s2">rules </span><span class="s4">= </span><span class="s2">sharedDefaultConfig</span><span class="s4">.</span><span class="s2">rules </span><span class="s4">|| {};</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Get the current configuration used for all tests</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} the current configuration</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">getDefaultConfig</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">sharedDefaultConfig</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Reset the configuration to the initial configuration of the tester removing</span>
     <span class="s0">* any changes made until now.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">resetDefaultConfig</span><span class="s4">() {</span>
        <span class="s2">sharedDefaultConfig </span><span class="s4">= {</span>
            <span class="s2">rules</span><span class="s4">: {</span>
                <span class="s2">...testerDefaultConfig</span><span class="s4">.</span><span class="s2">rules</span>
            <span class="s4">}</span>
        <span class="s4">};</span>
    <span class="s4">}</span>


    <span class="s5">/* 
     * If people use `mocha test.js --watch` command, `describe` and `it` function 
     * instances are different for each execution. So `describe` and `it` should get fresh instance 
     * always. 
     */</span>
    <span class="s6">static </span><span class="s2">get describe</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s4">(</span>
            <span class="s6">this</span><span class="s4">[</span><span class="s2">DESCRIBE</span><span class="s4">] ||</span>
            <span class="s4">(</span><span class="s6">typeof </span><span class="s2">describe </span><span class="s4">=== </span><span class="s3">&quot;function&quot; </span><span class="s4">? </span><span class="s2">describe </span><span class="s4">: </span><span class="s2">describeDefaultHandler</span><span class="s4">)</span>
        <span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">static </span><span class="s2">set describe</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
        <span class="s6">this</span><span class="s4">[</span><span class="s2">DESCRIBE</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">static </span><span class="s2">get it</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s4">(</span>
            <span class="s6">this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">] ||</span>
            <span class="s4">(</span><span class="s6">typeof </span><span class="s2">it </span><span class="s4">=== </span><span class="s3">&quot;function&quot; </span><span class="s4">? </span><span class="s2">it </span><span class="s4">: </span><span class="s2">itDefaultHandler</span><span class="s4">)</span>
        <span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">static </span><span class="s2">set it</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
        <span class="s6">this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Adds the `only` property to a test to run it in isolation.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string | ValidTestCase | InvalidTestCase} item A single test to run by itself.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{ValidTestCase | InvalidTestCase} The test with `only` set.</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">only</span><span class="s4">(</span><span class="s2">item</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s4">{ </span><span class="s2">code</span><span class="s4">: </span><span class="s2">item</span><span class="s4">, </span><span class="s2">only</span><span class="s4">: </span><span class="s6">true </span><span class="s4">};</span>
        <span class="s4">}</span>

        <span class="s6">return </span><span class="s4">{ </span><span class="s2">...item</span><span class="s4">, </span><span class="s2">only</span><span class="s4">: </span><span class="s6">true </span><span class="s4">};</span>
    <span class="s4">}</span>

    <span class="s6">static </span><span class="s2">get itOnly</span><span class="s4">() {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof this</span><span class="s4">[</span><span class="s2">IT_ONLY</span><span class="s4">] === </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">return this</span><span class="s4">[</span><span class="s2">IT_ONLY</span><span class="s4">];</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">] === </span><span class="s3">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s6">typeof this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">].</span><span class="s2">only </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s2">Function</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s6">this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">].</span><span class="s2">only</span><span class="s4">, </span><span class="s6">this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">]);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">it </span><span class="s4">=== </span><span class="s3">&quot;function&quot; </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">it</span><span class="s4">.</span><span class="s2">only </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s2">Function</span><span class="s4">.</span><span class="s2">bind</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">it</span><span class="s4">.</span><span class="s2">only</span><span class="s4">, </span><span class="s2">it</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof this</span><span class="s4">[</span><span class="s2">DESCRIBE</span><span class="s4">] === </span><span class="s3">&quot;function&quot; </span><span class="s4">|| </span><span class="s6">typeof this</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">] === </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span>
                <span class="s3">&quot;Set `RuleTester.itOnly` to use `only` with a custom test framework.</span><span class="s6">\n</span><span class="s3">&quot; </span><span class="s4">+</span>
                <span class="s3">&quot;See https://eslint.org/docs/latest/integrate/nodejs-api#customizing-ruletester for more.&quot;</span>
            <span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">it </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;The current test framework does not support exclusive tests with `only`.&quot;</span><span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;To use `only`, use RuleTester with a test framework that provides `it.only()` like Mocha.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s6">static </span><span class="s2">set itOnly</span><span class="s4">(</span><span class="s2">value</span><span class="s4">) {</span>
        <span class="s6">this</span><span class="s4">[</span><span class="s2">IT_ONLY</span><span class="s4">] = </span><span class="s2">value</span><span class="s4">;</span>
    <span class="s4">}</span>


    <span class="s0">/**</span>
     <span class="s0">* Adds a new rule test to execute.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} ruleName The name of the rule to run.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function | Rule} rule The rule to test.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{{</span>
     <span class="s0">*   valid: (ValidTestCase | string)[],</span>
     <span class="s0">*   invalid: InvalidTestCase[]</span>
     <span class="s0">* }} test The collection of tests to run.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{TypeError|Error} If non-object `test`, or if a required</span>
     <span class="s0">* scenario of the given type is missing.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s2">run</span><span class="s4">(</span><span class="s2">ruleName</span><span class="s4">, </span><span class="s2">rule</span><span class="s4">, </span><span class="s2">test</span><span class="s4">) {</span>

        <span class="s6">const </span><span class="s2">testerConfig </span><span class="s4">= </span><span class="s6">this</span><span class="s4">.</span><span class="s2">testerConfig</span><span class="s4">,</span>
            <span class="s2">requiredScenarios </span><span class="s4">= [</span><span class="s3">&quot;valid&quot;</span><span class="s4">, </span><span class="s3">&quot;invalid&quot;</span><span class="s4">],</span>
            <span class="s2">scenarioErrors </span><span class="s4">= [],</span>
            <span class="s2">linter </span><span class="s4">= </span><span class="s6">this</span><span class="s4">.</span><span class="s2">linter</span><span class="s4">,</span>
            <span class="s2">ruleId </span><span class="s4">= </span><span class="s3">`rule-to-test/</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">test </span><span class="s4">|| </span><span class="s6">typeof </span><span class="s2">test </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s3">`Test Scenarios for rule </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">} </span><span class="s3">: Could not find test scenario object`</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">requiredScenarios</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">scenarioType </span><span class="s4">=&gt; {</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">test</span><span class="s4">[</span><span class="s2">scenarioType</span><span class="s4">]) {</span>
                <span class="s2">scenarioErrors</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s3">`Could not find any </span><span class="s2">$</span><span class="s4">{</span><span class="s2">scenarioType</span><span class="s4">} </span><span class="s3">test scenarios`</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">});</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">scenarioErrors</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">([</span>
                <span class="s3">`Test Scenarios for rule </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">} </span><span class="s3">is invalid:`</span>
            <span class="s4">].</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">scenarioErrors</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;</span><span class="s6">\n</span><span class="s3">&quot;</span><span class="s4">));</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">baseConfig </span><span class="s4">= [</span>
            <span class="s4">{ </span><span class="s2">files</span><span class="s4">: [</span><span class="s3">&quot;**&quot;</span><span class="s4">] }, </span><span class="s5">// Make sure the default config matches for all files</span>
            <span class="s4">{</span>
                <span class="s2">plugins</span><span class="s4">: {</span>

                    <span class="s5">// copy root plugin over</span>
                    <span class="s3">&quot;@&quot;</span><span class="s4">: {</span>

                        <span class="s5">/* 
                         * Parsers are wrapped to detect more errors, so this needs 
                         * to be a new object for each call to run(), otherwise the 
                         * parsers will be wrapped multiple times. 
                         */</span>
                        <span class="s2">parsers</span><span class="s4">: {</span>
                            <span class="s2">...defaultConfig</span><span class="s4">[</span><span class="s8">0</span><span class="s4">].</span><span class="s2">plugins</span><span class="s4">[</span><span class="s3">&quot;@&quot;</span><span class="s4">].</span><span class="s2">parsers</span>
                        <span class="s4">},</span>

                        <span class="s5">/* 
                         * The rules key on the default plugin is a proxy to lazy-load 
                         * just the rules that are needed. So, don't create a new object 
                         * here, just use the default one to keep that performance 
                         * enhancement. 
                         */</span>
                        <span class="s2">rules</span><span class="s4">: </span><span class="s2">defaultConfig</span><span class="s4">[</span><span class="s8">0</span><span class="s4">].</span><span class="s2">plugins</span><span class="s4">[</span><span class="s3">&quot;@&quot;</span><span class="s4">].</span><span class="s2">rules</span>
                    <span class="s4">},</span>
                    <span class="s3">&quot;rule-to-test&quot;</span><span class="s4">: {</span>
                        <span class="s2">rules</span><span class="s4">: {</span>
                            <span class="s4">[</span><span class="s2">ruleName</span><span class="s4">]: </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">rule</span><span class="s4">, {</span>

                                <span class="s5">// Create a wrapper rule that freezes the `context` properties.</span>
                                <span class="s2">create</span><span class="s4">(</span><span class="s2">context</span><span class="s4">) {</span>
                                    <span class="s2">freezeDeeply</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">options</span><span class="s4">);</span>
                                    <span class="s2">freezeDeeply</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">settings</span><span class="s4">);</span>
                                    <span class="s2">freezeDeeply</span><span class="s4">(</span><span class="s2">context</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">);</span>

                                    <span class="s5">// freezeDeeply(context.languageOptions);</span>

                                    <span class="s6">return </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">rule </span><span class="s4">=== </span><span class="s3">&quot;function&quot; </span><span class="s4">? </span><span class="s2">rule </span><span class="s4">: </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">create</span><span class="s4">)(</span><span class="s2">context</span><span class="s4">);</span>
                                <span class="s4">}</span>
                            <span class="s4">})</span>
                        <span class="s4">}</span>
                    <span class="s4">}</span>
                <span class="s4">},</span>
                <span class="s2">languageOptions</span><span class="s4">: {</span>
                    <span class="s2">...defaultConfig</span><span class="s4">[</span><span class="s8">0</span><span class="s4">].</span><span class="s2">languageOptions</span>
                <span class="s4">}</span>
            <span class="s4">},</span>
            <span class="s2">...defaultConfig</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s8">1</span><span class="s4">)</span>
        <span class="s4">];</span>

        <span class="s0">/**</span>
         <span class="s0">* Run the rule for the given item</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|Object} item Item to run the rule against</span>
         <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} If an invalid schema.</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} Eslint run result</span>
         <span class="s0">* </span><span class="s1">@private</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">runRuleForItem</span><span class="s4">(</span><span class="s2">item</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">flatConfigArrayOptions </span><span class="s4">= {</span>
                <span class="s2">baseConfig</span>
            <span class="s4">};</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">) {</span>
                <span class="s2">flatConfigArrayOptions</span><span class="s4">.</span><span class="s2">basePath </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">).</span><span class="s2">root</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">configs </span><span class="s4">= </span><span class="s6">new </span><span class="s2">FlatConfigArray</span><span class="s4">(</span><span class="s2">testerConfig</span><span class="s4">, </span><span class="s2">flatConfigArrayOptions</span><span class="s4">);</span>

            <span class="s5">/* 
             * Modify the returned config so that the parser is wrapped to catch 
             * access of the start/end properties. This method is called just 
             * once per code snippet being tested, so each test case gets a clean 
             * parser. 
             */</span>
            <span class="s2">configs</span><span class="s4">[</span><span class="s2">ConfigArraySymbol</span><span class="s4">.</span><span class="s2">finalizeConfig</span><span class="s4">] = </span><span class="s6">function</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) {</span>

                <span class="s5">// can't do super here :(</span>
                <span class="s6">const </span><span class="s2">proto </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getPrototypeOf</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
                <span class="s6">const </span><span class="s2">calculatedConfig </span><span class="s4">= </span><span class="s2">proto</span><span class="s4">[</span><span class="s2">ConfigArraySymbol</span><span class="s4">.</span><span class="s2">finalizeConfig</span><span class="s4">].</span><span class="s2">apply</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, </span><span class="s2">args</span><span class="s4">);</span>

                <span class="s5">// wrap the parser to catch start/end property access</span>
                <span class="s2">calculatedConfig</span><span class="s4">.</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser </span><span class="s4">= </span><span class="s2">wrapParser</span><span class="s4">(</span><span class="s2">calculatedConfig</span><span class="s4">.</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">);</span>
                <span class="s6">return </span><span class="s2">calculatedConfig</span><span class="s4">;</span>
            <span class="s4">};</span>

            <span class="s6">let </span><span class="s2">code</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">, </span><span class="s2">output</span><span class="s4">, </span><span class="s2">beforeAST</span><span class="s4">, </span><span class="s2">afterAST</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
                <span class="s2">code </span><span class="s4">= </span><span class="s2">item</span><span class="s4">;</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">code </span><span class="s4">= </span><span class="s2">item</span><span class="s4">.</span><span class="s2">code</span><span class="s4">;</span>

                <span class="s5">/* 
                 * Assumes everything on the item is a config except for the 
                 * parameters used by this tester 
                 */</span>
                <span class="s6">const </span><span class="s2">itemConfig </span><span class="s4">= { </span><span class="s2">...item </span><span class="s4">};</span>

                <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">parameter of RuleTesterParameters</span><span class="s4">) {</span>
                    <span class="s6">delete </span><span class="s2">itemConfig</span><span class="s4">[</span><span class="s2">parameter</span><span class="s4">];</span>
                <span class="s4">}</span>

                <span class="s5">// wrap any parsers</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">itemConfig</span><span class="s4">.</span><span class="s2">languageOptions </span><span class="s4">&amp;&amp; </span><span class="s2">itemConfig</span><span class="s4">.</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">) {</span>

                    <span class="s6">const </span><span class="s2">parser </span><span class="s4">= </span><span class="s2">itemConfig</span><span class="s4">.</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">;</span>

                    <span class="s6">if </span><span class="s4">(</span><span class="s2">parser </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">parser </span><span class="s4">!== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
                        <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;Parser must be an object with a parse() or parseForESLint() method.&quot;</span><span class="s4">);</span>
                    <span class="s4">}</span>

                <span class="s4">}</span>

                <span class="s5">/* 
                 * Create the config object from the tester config and this item 
                 * specific configurations. 
                 */</span>
                <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">itemConfig</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">) {</span>
                <span class="s2">filename </span><span class="s4">= </span><span class="s2">item</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">let </span><span class="s2">ruleConfig </span><span class="s4">= </span><span class="s8">1</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">item</span><span class="s4">, </span><span class="s3">&quot;options&quot;</span><span class="s4">)) {</span>
                <span class="s2">assert</span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">options</span><span class="s4">), </span><span class="s3">&quot;options must be an array&quot;</span><span class="s4">);</span>
                <span class="s2">ruleConfig </span><span class="s4">= [</span><span class="s8">1</span><span class="s4">, </span><span class="s2">...item</span><span class="s4">.</span><span class="s2">options</span><span class="s4">];</span>
            <span class="s4">}</span>

            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                <span class="s2">rules</span><span class="s4">: {</span>
                    <span class="s4">[</span><span class="s2">ruleId</span><span class="s4">]: </span><span class="s2">ruleConfig</span>
                <span class="s4">}</span>
            <span class="s4">});</span>

            <span class="s6">const </span><span class="s2">schema </span><span class="s4">= </span><span class="s2">getRuleOptionsSchema</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">);</span>

            <span class="s5">/* 
             * Setup AST getters. 
             * The goal is to check whether or not AST was modified when 
             * running the rule under test. 
             */</span>
            <span class="s2">configs</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                <span class="s2">plugins</span><span class="s4">: {</span>
                    <span class="s3">&quot;rule-tester&quot;</span><span class="s4">: {</span>
                        <span class="s2">rules</span><span class="s4">: {</span>
                            <span class="s3">&quot;validate-ast&quot;</span><span class="s4">: {</span>
                                <span class="s2">create</span><span class="s4">() {</span>
                                    <span class="s6">return </span><span class="s4">{</span>
                                        <span class="s2">Program</span><span class="s4">(</span><span class="s2">node</span><span class="s4">) {</span>
                                            <span class="s2">beforeAST </span><span class="s4">= </span><span class="s2">cloneDeeplyExcludesParent</span><span class="s4">(</span><span class="s2">node</span><span class="s4">);</span>
                                        <span class="s4">},</span>
                                        <span class="s3">&quot;Program:exit&quot;</span><span class="s4">(</span><span class="s2">node</span><span class="s4">) {</span>
                                            <span class="s2">afterAST </span><span class="s4">= </span><span class="s2">node</span><span class="s4">;</span>
                                        <span class="s4">}</span>
                                    <span class="s4">};</span>
                                <span class="s4">}</span>
                            <span class="s4">}</span>
                        <span class="s4">}</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>
            <span class="s4">});</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">schema</span><span class="s4">) {</span>
                <span class="s2">ajv</span><span class="s4">.</span><span class="s2">validateSchema</span><span class="s4">(</span><span class="s2">schema</span><span class="s4">);</span>

                <span class="s6">if </span><span class="s4">(</span><span class="s2">ajv</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) {</span>
                    <span class="s6">const </span><span class="s2">errors </span><span class="s4">= </span><span class="s2">ajv</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">error </span><span class="s4">=&gt; {</span>
                        <span class="s6">const </span><span class="s2">field </span><span class="s4">= </span><span class="s2">error</span><span class="s4">.</span><span class="s2">dataPath</span><span class="s4">[</span><span class="s8">0</span><span class="s4">] === </span><span class="s3">&quot;.&quot; </span><span class="s4">? </span><span class="s2">error</span><span class="s4">.</span><span class="s2">dataPath</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s8">1</span><span class="s4">) : </span><span class="s2">error</span><span class="s4">.</span><span class="s2">dataPath</span><span class="s4">;</span>

                        <span class="s6">return </span><span class="s3">`</span><span class="s6">\t</span><span class="s2">$</span><span class="s4">{</span><span class="s2">field</span><span class="s4">}</span><span class="s3">: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
                    <span class="s4">}).</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;</span><span class="s6">\n</span><span class="s3">&quot;</span><span class="s4">);</span>

                    <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">([</span><span class="s3">`Schema for rule </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">} </span><span class="s3">is invalid:`</span><span class="s4">, </span><span class="s2">errors</span><span class="s4">]);</span>
                <span class="s4">}</span>

                <span class="s5">/* 
                 * `ajv.validateSchema` checks for errors in the structure of the schema (by comparing the schema against a &quot;meta-schema&quot;), 
                 * and it reports those errors individually. However, there are other types of schema errors that only occur when compiling 
                 * the schema (e.g. using invalid defaults in a schema), and only one of these errors can be reported at a time. As a result, 
                 * the schema is compiled here separately from checking for `validateSchema` errors. 
                 */</span>
                <span class="s6">try </span><span class="s4">{</span>
                    <span class="s2">ajv</span><span class="s4">.</span><span class="s2">compile</span><span class="s4">(</span><span class="s2">schema</span><span class="s4">);</span>
                <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
                    <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">`Schema for rule </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">} </span><span class="s3">is invalid: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                <span class="s4">}</span>
            <span class="s4">}</span>

            <span class="s5">// check for validation errors</span>
            <span class="s6">try </span><span class="s4">{</span>
                <span class="s2">configs</span><span class="s4">.</span><span class="s2">normalizeSync</span><span class="s4">();</span>
                <span class="s2">configs</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s3">&quot;test.js&quot;</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">error</span><span class="s4">) {</span>
                <span class="s2">error</span><span class="s4">.</span><span class="s2">message </span><span class="s4">= </span><span class="s3">`ESLint configuration in rule-tester is invalid: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
                <span class="s6">throw </span><span class="s2">error</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s5">// Verify the code.</span>
            <span class="s6">const </span><span class="s4">{ </span><span class="s2">getComments</span><span class="s4">, </span><span class="s2">applyLanguageOptions</span><span class="s4">, </span><span class="s2">applyInlineConfig</span><span class="s4">, </span><span class="s2">finalize </span><span class="s4">} = </span><span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">originalCurrentSegments </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">getOwnPropertyDescriptor</span><span class="s4">(</span><span class="s2">CodePath</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">, </span><span class="s3">&quot;currentSegments&quot;</span><span class="s4">);</span>
            <span class="s6">let </span><span class="s2">messages</span><span class="s4">;</span>

            <span class="s6">try </span><span class="s4">{</span>
                <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">getComments </span><span class="s4">= </span><span class="s2">getCommentsDeprecation</span><span class="s4">;</span>
                <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">CodePath</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">, </span><span class="s3">&quot;currentSegments&quot;</span><span class="s4">, {</span>
                    <span class="s2">get</span><span class="s4">() {</span>
                        <span class="s2">emitCodePathCurrentSegmentsWarning</span><span class="s4">(</span><span class="s2">ruleName</span><span class="s4">);</span>
                        <span class="s6">return </span><span class="s2">originalCurrentSegments</span><span class="s4">.</span><span class="s2">get</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
                    <span class="s4">}</span>
                <span class="s4">});</span>

                <span class="s2">forbiddenMethods</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">methodName </span><span class="s4">=&gt; {</span>
                    <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">[</span><span class="s2">methodName</span><span class="s4">] = </span><span class="s2">throwForbiddenMethodError</span><span class="s4">(</span><span class="s2">methodName</span><span class="s4">, </span><span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">);</span>
                <span class="s4">});</span>

                <span class="s2">messages </span><span class="s4">= </span><span class="s2">linter</span><span class="s4">.</span><span class="s2">verify</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s2">configs</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s6">finally </span><span class="s4">{</span>
                <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">getComments </span><span class="s4">= </span><span class="s2">getComments</span><span class="s4">;</span>
                <span class="s2">Object</span><span class="s4">.</span><span class="s2">defineProperty</span><span class="s4">(</span><span class="s2">CodePath</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">, </span><span class="s3">&quot;currentSegments&quot;</span><span class="s4">, </span><span class="s2">originalCurrentSegments</span><span class="s4">);</span>
                <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">applyInlineConfig </span><span class="s4">= </span><span class="s2">applyInlineConfig</span><span class="s4">;</span>
                <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">applyLanguageOptions </span><span class="s4">= </span><span class="s2">applyLanguageOptions</span><span class="s4">;</span>
                <span class="s2">SourceCode</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">finalize </span><span class="s4">= </span><span class="s2">finalize</span><span class="s4">;</span>
            <span class="s4">}</span>


            <span class="s6">const </span><span class="s2">fatalErrorMessage </span><span class="s4">= </span><span class="s2">messages</span><span class="s4">.</span><span class="s2">find</span><span class="s4">(</span><span class="s2">m </span><span class="s4">=&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">fatal</span><span class="s4">);</span>

            <span class="s2">assert</span><span class="s4">(!</span><span class="s2">fatalErrorMessage</span><span class="s4">, </span><span class="s3">`A fatal parsing error occurred: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">fatalErrorMessage </span><span class="s4">&amp;&amp; </span><span class="s2">fatalErrorMessage</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

            <span class="s5">// Verify if autofix makes a syntax error or not.</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span><span class="s2">m </span><span class="s4">=&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">fix</span><span class="s4">)) {</span>
                <span class="s2">output </span><span class="s4">= </span><span class="s2">SourceCodeFixer</span><span class="s4">.</span><span class="s2">applyFixes</span><span class="s4">(</span><span class="s2">code</span><span class="s4">, </span><span class="s2">messages</span><span class="s4">).</span><span class="s2">output</span><span class="s4">;</span>
                <span class="s6">const </span><span class="s2">errorMessageInFix </span><span class="s4">= </span><span class="s2">linter</span><span class="s4">.</span><span class="s2">verify</span><span class="s4">(</span><span class="s2">output</span><span class="s4">, </span><span class="s2">configs</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">).</span><span class="s2">find</span><span class="s4">(</span><span class="s2">m </span><span class="s4">=&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">fatal</span><span class="s4">);</span>

                <span class="s2">assert</span><span class="s4">(!</span><span class="s2">errorMessageInFix</span><span class="s4">, [</span>
                    <span class="s3">&quot;A fatal parsing error occurred in autofix.&quot;</span><span class="s4">,</span>
                    <span class="s3">`Error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">errorMessageInFix </span><span class="s4">&amp;&amp; </span><span class="s2">errorMessageInFix</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">,</span>
                    <span class="s3">&quot;Autofix output:&quot;</span><span class="s4">,</span>
                    <span class="s2">output</span>
                <span class="s4">].</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;</span><span class="s6">\n</span><span class="s3">&quot;</span><span class="s4">));</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">output </span><span class="s4">= </span><span class="s2">code</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">return </span><span class="s4">{</span>
                <span class="s2">messages</span><span class="s4">,</span>
                <span class="s2">output</span><span class="s4">,</span>
                <span class="s2">beforeAST</span><span class="s4">,</span>
                <span class="s2">afterAST</span><span class="s4">: </span><span class="s2">cloneDeeplyExcludesParent</span><span class="s4">(</span><span class="s2">afterAST</span><span class="s4">)</span>
            <span class="s4">};</span>
        <span class="s4">}</span>

        <span class="s0">/**</span>
         <span class="s0">* Check if the AST was changed</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ASTNode} beforeAST AST node before running</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ASTNode} afterAST AST node after running</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
         <span class="s0">* </span><span class="s1">@private</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">assertASTDidntChange</span><span class="s4">(</span><span class="s2">beforeAST</span><span class="s4">, </span><span class="s2">afterAST</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">equal</span><span class="s4">(</span><span class="s2">beforeAST</span><span class="s4">, </span><span class="s2">afterAST</span><span class="s4">)) {</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">fail</span><span class="s4">(</span><span class="s3">&quot;Rule should not modify AST.&quot;</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s0">/**</span>
         <span class="s0">* Check if the template is valid or not</span>
         <span class="s0">* all valid cases go through this</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|Object} item Item to run the rule against</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
         <span class="s0">* </span><span class="s1">@private</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">testValidTemplate</span><span class="s4">(</span><span class="s2">item</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">code </span><span class="s4">= </span><span class="s6">typeof </span><span class="s2">item </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">? </span><span class="s2">item</span><span class="s4">.</span><span class="s2">code </span><span class="s4">: </span><span class="s2">item</span><span class="s4">;</span>

            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">code </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">, </span><span class="s3">&quot;Test case must specify a string value for 'code'&quot;</span><span class="s4">);</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">name</span><span class="s4">) {</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item</span><span class="s4">.</span><span class="s2">name </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">, </span><span class="s3">&quot;Optional test case property 'name' must be a string&quot;</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">result </span><span class="s4">= </span><span class="s2">runRuleForItem</span><span class="s4">(</span><span class="s2">item</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s2">messages </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">;</span>

            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s8">0</span><span class="s4">, </span><span class="s2">util</span><span class="s4">.</span><span class="s2">format</span><span class="s4">(</span><span class="s3">&quot;Should have no errors but had %d: %s&quot;</span><span class="s4">,</span>
                <span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">,</span>
                <span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">)));</span>

            <span class="s2">assertASTDidntChange</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">beforeAST</span><span class="s4">, </span><span class="s2">result</span><span class="s4">.</span><span class="s2">afterAST</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s0">/**</span>
         <span class="s0">* Asserts that the message matches its expected value. If the expected</span>
         <span class="s0">* value is a regular expression, it is checked against the actual</span>
         <span class="s0">* value.</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} actual Actual value</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|RegExp} expected Expected value</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
         <span class="s0">* </span><span class="s1">@private</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">assertMessageMatches</span><span class="s4">(</span><span class="s2">actual</span><span class="s4">, </span><span class="s2">expected</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">expected </span><span class="s6">instanceof </span><span class="s2">RegExp</span><span class="s4">) {</span>

                <span class="s5">// assert.js doesn't have a built-in RegExp match function</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                    <span class="s2">expected</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">actual</span><span class="s4">),</span>
                    <span class="s3">`Expected '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">actual</span><span class="s4">}</span><span class="s3">' to match </span><span class="s2">$</span><span class="s4">{</span><span class="s2">expected</span><span class="s4">}</span><span class="s3">`</span>
                <span class="s4">);</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">actual</span><span class="s4">, </span><span class="s2">expected</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s0">/**</span>
         <span class="s0">* Check if the template is invalid or not</span>
         <span class="s0">* all invalid cases go through this.</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|Object} item Item to run the rule against</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
         <span class="s0">* </span><span class="s1">@private</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">testInvalidTemplate</span><span class="s4">(</span><span class="s2">item</span><span class="s4">) {</span>
            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item</span><span class="s4">.</span><span class="s2">code </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">, </span><span class="s3">&quot;Test case must specify a string value for 'code'&quot;</span><span class="s4">);</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">name</span><span class="s4">) {</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item</span><span class="s4">.</span><span class="s2">name </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">, </span><span class="s3">&quot;Optional test case property 'name' must be a string&quot;</span><span class="s4">);</span>
            <span class="s4">}</span>
            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">|| </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">=== </span><span class="s8">0</span><span class="s4">,</span>
                <span class="s3">`Did not specify errors for an invalid test of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleName</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">) &amp;&amp; </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s8">0</span><span class="s4">) {</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">fail</span><span class="s4">(</span><span class="s3">&quot;Invalid cases must have at least one error&quot;</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">ruleHasMetaMessages </span><span class="s4">= </span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">, </span><span class="s3">&quot;meta&quot;</span><span class="s4">) &amp;&amp; </span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">, </span><span class="s3">&quot;messages&quot;</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s2">friendlyIDList </span><span class="s4">= </span><span class="s2">ruleHasMetaMessages </span><span class="s4">? </span><span class="s3">`[</span><span class="s2">$</span><span class="s4">{</span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">).</span><span class="s2">map</span><span class="s4">(</span><span class="s2">key </span><span class="s4">=&gt; </span><span class="s3">`'</span><span class="s2">$</span><span class="s4">{</span><span class="s2">key</span><span class="s4">}</span><span class="s3">'`</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">]` </span><span class="s4">: </span><span class="s6">null</span><span class="s4">;</span>

            <span class="s6">const </span><span class="s2">result </span><span class="s4">= </span><span class="s2">runRuleForItem</span><span class="s4">(</span><span class="s2">item</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s2">messages </span><span class="s4">= </span><span class="s2">result</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">=== </span><span class="s3">&quot;number&quot;</span><span class="s4">) {</span>

                <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">=== </span><span class="s8">0</span><span class="s4">) {</span>
                    <span class="s2">assert</span><span class="s4">.</span><span class="s2">fail</span><span class="s4">(</span><span class="s3">&quot;Invalid cases must have 'error' value greater than 0&quot;</span><span class="s4">);</span>
                <span class="s4">}</span>

                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">, </span><span class="s2">util</span><span class="s4">.</span><span class="s2">format</span><span class="s4">(</span><span class="s3">&quot;Should have %d error%s but had %d: %s&quot;</span><span class="s4">,</span>
                    <span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">,</span>
                    <span class="s2">item</span><span class="s4">.</span><span class="s2">errors </span><span class="s4">=== </span><span class="s8">1 </span><span class="s4">? </span><span class="s3">&quot;&quot; </span><span class="s4">: </span><span class="s3">&quot;s&quot;</span><span class="s4">,</span>
                    <span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">,</span>
                    <span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">)));</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                    <span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">util</span><span class="s4">.</span><span class="s2">format</span><span class="s4">(</span>
                        <span class="s3">&quot;Should have %d error%s but had %d: %s&quot;</span><span class="s4">,</span>
                        <span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length</span><span class="s4">,</span>
                        <span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s8">1 </span><span class="s4">? </span><span class="s3">&quot;&quot; </span><span class="s4">: </span><span class="s3">&quot;s&quot;</span><span class="s4">,</span>
                        <span class="s2">messages</span><span class="s4">.</span><span class="s2">length</span><span class="s4">,</span>
                        <span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">messages</span><span class="s4">)</span>
                    <span class="s4">)</span>
                <span class="s4">);</span>

                <span class="s6">const </span><span class="s2">hasMessageOfThisRule </span><span class="s4">= </span><span class="s2">messages</span><span class="s4">.</span><span class="s2">some</span><span class="s4">(</span><span class="s2">m </span><span class="s4">=&gt; </span><span class="s2">m</span><span class="s4">.</span><span class="s2">ruleId </span><span class="s4">=== </span><span class="s2">ruleId</span><span class="s4">);</span>

                <span class="s6">for </span><span class="s4">(</span><span class="s6">let </span><span class="s2">i </span><span class="s4">= </span><span class="s8">0</span><span class="s4">, </span><span class="s2">l </span><span class="s4">= </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">.</span><span class="s2">length</span><span class="s4">; </span><span class="s2">i </span><span class="s4">&lt; </span><span class="s2">l</span><span class="s4">; </span><span class="s2">i</span><span class="s4">++) {</span>
                    <span class="s6">const </span><span class="s2">error </span><span class="s4">= </span><span class="s2">item</span><span class="s4">.</span><span class="s2">errors</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>
                    <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s2">messages</span><span class="s4">[</span><span class="s2">i</span><span class="s4">];</span>

                    <span class="s2">assert</span><span class="s4">(</span><span class="s2">hasMessageOfThisRule</span><span class="s4">, </span><span class="s3">&quot;Error rule name should be the same as the name of the rule being tested&quot;</span><span class="s4">);</span>

                    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">error </span><span class="s4">=== </span><span class="s3">&quot;string&quot; </span><span class="s4">|| </span><span class="s2">error </span><span class="s6">instanceof </span><span class="s2">RegExp</span><span class="s4">) {</span>

                        <span class="s5">// Just an error message.</span>
                        <span class="s2">assertMessageMatches</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">, </span><span class="s2">error</span><span class="s4">);</span>
                    <span class="s4">} </span><span class="s6">else if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">error </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">error </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">) {</span>

                        <span class="s5">/* 
                         * Error object. 
                         * This may have a message, messageId, data, node type, line, and/or 
                         * column. 
                         */</span>

                        <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">error</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">propertyName </span><span class="s4">=&gt; {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                <span class="s2">errorObjectParameters</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">propertyName</span><span class="s4">),</span>
                                <span class="s3">`Invalid error property name '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">propertyName</span><span class="s4">}</span><span class="s3">'. Expected one of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">friendlyErrorObjectParameterList</span><span class="s4">}</span><span class="s3">.`</span>
                            <span class="s4">);</span>
                        <span class="s4">});</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;message&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(!</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;messageId&quot;</span><span class="s4">), </span><span class="s3">&quot;Error should not specify both 'message' and a 'messageId'.&quot;</span><span class="s4">);</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(!</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">), </span><span class="s3">&quot;Error should not specify both 'data' and 'message'.&quot;</span><span class="s4">);</span>
                            <span class="s2">assertMessageMatches</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">message</span><span class="s4">);</span>
                        <span class="s4">} </span><span class="s6">else if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;messageId&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                <span class="s2">ruleHasMetaMessages</span><span class="s4">,</span>
                                <span class="s3">&quot;Error can not use 'messageId' if rule under test doesn't define 'meta.messages'.&quot;</span>
                            <span class="s4">);</span>
                            <span class="s6">if </span><span class="s4">(!</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">)) {</span>
                                <span class="s2">assert</span><span class="s4">(</span><span class="s6">false</span><span class="s4">, </span><span class="s3">`Invalid messageId '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">'. Expected one of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">friendlyIDList</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">);</span>
                            <span class="s4">}</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                                <span class="s2">message</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">,</span>
                                <span class="s2">error</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">,</span>
                                <span class="s3">`messageId '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">' does not match expected messageId '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">'.`</span>
                            <span class="s4">);</span>
                            <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">)) {</span>

                                <span class="s5">/* 
                                 *  if data was provided, then directly compare the returned message to a synthetic 
                                 *  interpolated message using the same message ID and data provided in the test. 
                                 *  See https://github.com/eslint/eslint/issues/9890 for context. 
                                 */</span>
                                <span class="s6">const </span><span class="s2">unformattedOriginalMessage </span><span class="s4">= </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">[</span><span class="s2">error</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">];</span>
                                <span class="s6">const </span><span class="s2">rehydratedMessage </span><span class="s4">= </span><span class="s2">interpolate</span><span class="s4">(</span><span class="s2">unformattedOriginalMessage</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>

                                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                                    <span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">,</span>
                                    <span class="s2">rehydratedMessage</span><span class="s4">,</span>
                                    <span class="s3">`Hydrated message &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rehydratedMessage</span><span class="s4">}</span><span class="s3">&quot; does not match &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">&quot;`</span>
                                <span class="s4">);</span>
                            <span class="s4">}</span>
                        <span class="s4">}</span>

                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                            <span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">) ? </span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;messageId&quot;</span><span class="s4">) : </span><span class="s6">true</span><span class="s4">,</span>
                            <span class="s3">&quot;Error must specify 'messageId' if 'data' is used.&quot;</span>
                        <span class="s4">);</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">error</span><span class="s4">.</span><span class="s2">type</span><span class="s4">) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">nodeType</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">type</span><span class="s4">, </span><span class="s3">`Error type should be </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">type</span><span class="s4">}</span><span class="s3">, found </span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">nodeType</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;line&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">line</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">line</span><span class="s4">, </span><span class="s3">`Error line should be </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">line</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;column&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">column</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">column</span><span class="s4">, </span><span class="s3">`Error column should be </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">column</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;endLine&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">endLine</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">endLine</span><span class="s4">, </span><span class="s3">`Error endLine should be </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">endLine</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;endColumn&quot;</span><span class="s4">)) {</span>
                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">endColumn</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">endColumn</span><span class="s4">, </span><span class="s3">`Error endColumn should be </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">endColumn</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
                        <span class="s4">}</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">error</span><span class="s4">, </span><span class="s3">&quot;suggestions&quot;</span><span class="s4">)) {</span>

                            <span class="s5">// Support asserting there are no suggestions</span>
                            <span class="s6">if </span><span class="s4">(!</span><span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions </span><span class="s4">|| (</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">) &amp;&amp; </span><span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s8">0</span><span class="s4">)) {</span>
                                <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">) &amp;&amp; </span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
                                    <span class="s2">assert</span><span class="s4">.</span><span class="s2">fail</span><span class="s4">(</span><span class="s3">`Error should have no suggestions on error with message: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">&quot;`</span><span class="s4">);</span>
                                <span class="s4">}</span>
                            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">), </span><span class="s6">true</span><span class="s4">, </span><span class="s3">`Error should have an array of suggestions. Instead received &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">}</span><span class="s3">&quot; on error with message: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">&quot;`</span><span class="s4">);</span>
                                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length</span><span class="s4">, </span><span class="s3">`Error should have </span><span class="s2">$</span><span class="s4">{</span><span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length</span><span class="s4">} </span><span class="s3">suggestions. Instead found </span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">length</span><span class="s4">} </span><span class="s3">suggestions`</span><span class="s4">);</span>

                                <span class="s2">error</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">((</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s2">index</span><span class="s4">) =&gt; {</span>
                                    <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                        <span class="s6">typeof </span><span class="s2">expectedSuggestion </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">expectedSuggestion </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">,</span>
                                        <span class="s3">&quot;Test suggestion in 'suggestions' array must be an object.&quot;</span>
                                    <span class="s4">);</span>
                                    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">propertyName </span><span class="s4">=&gt; {</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                            <span class="s2">suggestionObjectParameters</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">propertyName</span><span class="s4">),</span>
                                            <span class="s3">`Invalid suggestion property name '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">propertyName</span><span class="s4">}</span><span class="s3">'. Expected one of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">friendlySuggestionObjectParameterList</span><span class="s4">}</span><span class="s3">.`</span>
                                        <span class="s4">);</span>
                                    <span class="s4">});</span>

                                    <span class="s6">const </span><span class="s2">actualSuggestion </span><span class="s4">= </span><span class="s2">message</span><span class="s4">.</span><span class="s2">suggestions</span><span class="s4">[</span><span class="s2">index</span><span class="s4">];</span>
                                    <span class="s6">const </span><span class="s2">suggestionPrefix </span><span class="s4">= </span><span class="s3">`Error Suggestion at index </span><span class="s2">$</span><span class="s4">{</span><span class="s2">index</span><span class="s4">} </span><span class="s3">:`</span><span class="s4">;</span>

                                    <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;desc&quot;</span><span class="s4">)) {</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                            <span class="s4">!</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">),</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">Test should not specify both 'desc' and 'data'.`</span>
                                        <span class="s4">);</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                                            <span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">,</span>
                                            <span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">,</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">desc should be &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">}</span><span class="s3">&quot; but got &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">}</span><span class="s3">&quot; instead.`</span>
                                        <span class="s4">);</span>
                                    <span class="s4">}</span>

                                    <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;messageId&quot;</span><span class="s4">)) {</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                            <span class="s2">ruleHasMetaMessages</span><span class="s4">,</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">Test can not use 'messageId' if rule under test doesn't define 'meta.messages'.`</span>
                                        <span class="s4">);</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                            <span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">, </span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">),</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">Test has invalid messageId '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">', the rule under test allows only one of </span><span class="s2">$</span><span class="s4">{</span><span class="s2">friendlyIDList</span><span class="s4">}</span><span class="s3">.`</span>
                                        <span class="s4">);</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                                            <span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">,</span>
                                            <span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">,</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">messageId should be '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">' but got '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">}</span><span class="s3">' instead.`</span>
                                        <span class="s4">);</span>
                                        <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">)) {</span>
                                            <span class="s6">const </span><span class="s2">unformattedMetaMessage </span><span class="s4">= </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">[</span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">messageId</span><span class="s4">];</span>
                                            <span class="s6">const </span><span class="s2">rehydratedDesc </span><span class="s4">= </span><span class="s2">interpolate</span><span class="s4">(</span><span class="s2">unformattedMetaMessage</span><span class="s4">, </span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">data</span><span class="s4">);</span>

                                            <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                                                <span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">,</span>
                                                <span class="s2">rehydratedDesc</span><span class="s4">,</span>
                                                <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">Hydrated test desc &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">rehydratedDesc</span><span class="s4">}</span><span class="s3">&quot; does not match received desc &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">actualSuggestion</span><span class="s4">.</span><span class="s2">desc</span><span class="s4">}</span><span class="s3">&quot;.`</span>
                                            <span class="s4">);</span>
                                        <span class="s4">}</span>
                                    <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">ok</span><span class="s4">(</span>
                                            <span class="s4">!</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;data&quot;</span><span class="s4">),</span>
                                            <span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">suggestionPrefix</span><span class="s4">} </span><span class="s3">Test must specify 'messageId' if 'data' is used.`</span>
                                        <span class="s4">);</span>
                                    <span class="s4">}</span>

                                    <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">expectedSuggestion</span><span class="s4">, </span><span class="s3">&quot;output&quot;</span><span class="s4">)) {</span>
                                        <span class="s6">const </span><span class="s2">codeWithAppliedSuggestion </span><span class="s4">= </span><span class="s2">SourceCodeFixer</span><span class="s4">.</span><span class="s2">applyFixes</span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">code</span><span class="s4">, [</span><span class="s2">actualSuggestion</span><span class="s4">]).</span><span class="s2">output</span><span class="s4">;</span>

                                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">codeWithAppliedSuggestion</span><span class="s4">, </span><span class="s2">expectedSuggestion</span><span class="s4">.</span><span class="s2">output</span><span class="s4">, </span><span class="s3">`Expected the applied suggestion fix to match the test suggestion output for suggestion at index: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">index</span><span class="s4">} </span><span class="s3">on error with message: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">message</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">&quot;`</span><span class="s4">);</span>
                                    <span class="s4">}</span>
                                <span class="s4">});</span>
                            <span class="s4">}</span>
                        <span class="s4">}</span>
                    <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>

                        <span class="s5">// Message was an unexpected type</span>
                        <span class="s2">assert</span><span class="s4">.</span><span class="s2">fail</span><span class="s4">(</span><span class="s3">`Error should be a string, object, or RegExp, but found (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">util</span><span class="s4">.</span><span class="s2">inspect</span><span class="s4">(</span><span class="s2">message</span><span class="s4">)}</span><span class="s3">)`</span><span class="s4">);</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>
            <span class="s4">}</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">hasOwnProperty</span><span class="s4">(</span><span class="s2">item</span><span class="s4">, </span><span class="s3">&quot;output&quot;</span><span class="s4">)) {</span>
                <span class="s6">if </span><span class="s4">(</span><span class="s2">item</span><span class="s4">.</span><span class="s2">output </span><span class="s4">=== </span><span class="s6">null</span><span class="s4">) {</span>
                    <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                        <span class="s2">result</span><span class="s4">.</span><span class="s2">output</span><span class="s4">,</span>
                        <span class="s2">item</span><span class="s4">.</span><span class="s2">code</span><span class="s4">,</span>
                        <span class="s3">&quot;Expected no autofixes to be suggested&quot;</span>
                    <span class="s4">);</span>
                <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                    <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">output</span><span class="s4">, </span><span class="s2">item</span><span class="s4">.</span><span class="s2">output</span><span class="s4">, </span><span class="s3">&quot;Output is incorrect.&quot;</span><span class="s4">);</span>
                <span class="s4">}</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">assert</span><span class="s4">.</span><span class="s2">strictEqual</span><span class="s4">(</span>
                    <span class="s2">result</span><span class="s4">.</span><span class="s2">output</span><span class="s4">,</span>
                    <span class="s2">item</span><span class="s4">.</span><span class="s2">code</span><span class="s4">,</span>
                    <span class="s3">&quot;The rule fixed the code. Please add 'output' property.&quot;</span>
                <span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s2">assertASTDidntChange</span><span class="s4">(</span><span class="s2">result</span><span class="s4">.</span><span class="s2">beforeAST</span><span class="s4">, </span><span class="s2">result</span><span class="s4">.</span><span class="s2">afterAST</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">/* 
         * This creates a mocha test suite and pipes all supplied info through 
         * one of the templates above. 
         * The test suites for valid/invalid are created conditionally as 
         * test runners (eg. vitest) fail for empty test suites. 
         */</span>
        <span class="s6">this</span><span class="s4">.</span><span class="s2">constructor</span><span class="s4">.</span><span class="s2">describe</span><span class="s4">(</span><span class="s2">ruleName</span><span class="s4">, () =&gt; {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">test</span><span class="s4">.</span><span class="s2">valid</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
                <span class="s6">this</span><span class="s4">.</span><span class="s2">constructor</span><span class="s4">.</span><span class="s2">describe</span><span class="s4">(</span><span class="s3">&quot;valid&quot;</span><span class="s4">, () =&gt; {</span>
                    <span class="s2">test</span><span class="s4">.</span><span class="s2">valid</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">valid </span><span class="s4">=&gt; {</span>
                        <span class="s6">this</span><span class="s4">.</span><span class="s2">constructor</span><span class="s4">[</span><span class="s2">valid</span><span class="s4">.</span><span class="s2">only </span><span class="s4">? </span><span class="s3">&quot;itOnly&quot; </span><span class="s4">: </span><span class="s3">&quot;it&quot;</span><span class="s4">](</span>
                            <span class="s2">sanitize</span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">valid </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">? </span><span class="s2">valid</span><span class="s4">.</span><span class="s2">name </span><span class="s4">|| </span><span class="s2">valid</span><span class="s4">.</span><span class="s2">code </span><span class="s4">: </span><span class="s2">valid</span><span class="s4">),</span>
                            <span class="s4">() =&gt; {</span>
                                <span class="s2">testValidTemplate</span><span class="s4">(</span><span class="s2">valid</span><span class="s4">);</span>
                            <span class="s4">}</span>
                        <span class="s4">);</span>
                    <span class="s4">});</span>
                <span class="s4">});</span>
            <span class="s4">}</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">test</span><span class="s4">.</span><span class="s2">invalid</span><span class="s4">.</span><span class="s2">length </span><span class="s4">&gt; </span><span class="s8">0</span><span class="s4">) {</span>
                <span class="s6">this</span><span class="s4">.</span><span class="s2">constructor</span><span class="s4">.</span><span class="s2">describe</span><span class="s4">(</span><span class="s3">&quot;invalid&quot;</span><span class="s4">, () =&gt; {</span>
                    <span class="s2">test</span><span class="s4">.</span><span class="s2">invalid</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">invalid </span><span class="s4">=&gt; {</span>
                        <span class="s6">this</span><span class="s4">.</span><span class="s2">constructor</span><span class="s4">[</span><span class="s2">invalid</span><span class="s4">.</span><span class="s2">only </span><span class="s4">? </span><span class="s3">&quot;itOnly&quot; </span><span class="s4">: </span><span class="s3">&quot;it&quot;</span><span class="s4">](</span>
                            <span class="s2">sanitize</span><span class="s4">(</span><span class="s2">invalid</span><span class="s4">.</span><span class="s2">name </span><span class="s4">|| </span><span class="s2">invalid</span><span class="s4">.</span><span class="s2">code</span><span class="s4">),</span>
                            <span class="s4">() =&gt; {</span>
                                <span class="s2">testInvalidTemplate</span><span class="s4">(</span><span class="s2">invalid</span><span class="s4">);</span>
                            <span class="s4">}</span>
                        <span class="s4">);</span>
                    <span class="s4">});</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">});</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s2">FlatRuleTester</span><span class="s4">[</span><span class="s2">DESCRIBE</span><span class="s4">] = </span><span class="s2">FlatRuleTester</span><span class="s4">[</span><span class="s2">IT</span><span class="s4">] = </span><span class="s2">FlatRuleTester</span><span class="s4">[</span><span class="s2">IT_ONLY</span><span class="s4">] = </span><span class="s6">null</span><span class="s4">;</span>

<span class="s2">module</span><span class="s4">.</span><span class="s2">exports </span><span class="s4">= </span><span class="s2">FlatRuleTester</span><span class="s4">;</span>
</pre>
</body>
</html>