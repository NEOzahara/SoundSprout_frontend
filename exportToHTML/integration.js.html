<html>
<head>
<title>integration.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #2aacb8;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
integration.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span>

<span class="s2">const </span><span class="s1">assert </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'chai'</span><span class="s3">).</span><span class="s1">assert</span>
<span class="s2">const </span><span class="s1">axios </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'axios'</span><span class="s3">)</span>
<span class="s2">const </span><span class="s1">fs </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'fs'</span><span class="s3">)</span>
<span class="s2">const </span><span class="s1">path </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'path'</span><span class="s3">)</span>
<span class="s2">const </span><span class="s1">Promise </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'bluebird'</span><span class="s3">)</span>
<span class="s2">const </span><span class="s1">stream </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'stream'</span><span class="s3">)</span>

<span class="s2">const </span><span class="s1">modulePath </span><span class="s3">= </span><span class="s0">'../src'</span>

<span class="s1">suite</span><span class="s3">(</span><span class="s0">'integration:'</span><span class="s3">, () =&gt; {</span>
  <span class="s2">let </span><span class="s1">log</span>

  <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
    <span class="s1">log </span><span class="s3">= {}</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'require does not throw'</span><span class="s3">, () =&gt; {</span>
    <span class="s1">assert</span><span class="s3">.</span><span class="s1">doesNotThrow</span><span class="s3">(() =&gt; {</span>
      <span class="s1">require</span><span class="s3">(</span><span class="s1">modulePath</span><span class="s3">)</span>
    <span class="s3">})</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'require returns object'</span><span class="s3">, () =&gt; {</span>
    <span class="s1">assert</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">require</span><span class="s3">(</span><span class="s1">modulePath</span><span class="s3">))</span>
  <span class="s3">})</span>

  <span class="s1">suite</span><span class="s3">(</span><span class="s0">'require:'</span><span class="s3">, () =&gt; {</span>
    <span class="s2">let </span><span class="s1">bfj</span>

    <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
      <span class="s1">bfj </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s1">modulePath</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'walk function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">walk</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'walk expects one argument'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">walk</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'match function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">match</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'match expects two arguments'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">match</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'parse function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'parse expects one argument'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'read function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'read expects two arguments'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'eventify function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">eventify</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'eventify expects one argument'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">eventify</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'streamify function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">streamify</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'streamify expects one argument'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">streamify</span><span class="s3">, </span><span class="s4">1</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'stringify function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'stringify expects two arguments'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">, </span><span class="s4">2</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'write function is exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFunction</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">write</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'write expects two arguments'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">write</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)</span>
    <span class="s3">})</span>

    <span class="s1">test</span><span class="s3">(</span><span class="s0">'events are exported'</span><span class="s3">, () =&gt; {</span>
      <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">events</span><span class="s3">, </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'../src/events'</span><span class="s3">))</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'read object:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">result</span><span class="s3">, </span><span class="s1">error</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">({</span>
          <span class="s1">foo</span><span class="s3">: [ </span><span class="s0">'b'</span><span class="s3">, </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'r' </span><span class="s3">],</span>
          <span class="s1">baz</span><span class="s3">: </span><span class="s2">null</span><span class="s3">,</span>
          <span class="s1">qux</span><span class="s3">: </span><span class="s4">3.14159265359e42</span>
        <span class="s3">}, </span><span class="s2">null</span><span class="s3">, </span><span class="s0">'</span><span class="s2">\t</span><span class="s0">'</span><span class="s3">))</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">res </span><span class="s3">=&gt; {</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">res</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">err </span><span class="s3">=&gt; {</span>
            <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
            <span class="s1">error </span><span class="s3">= </span><span class="s1">err</span>
          <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">teardown</span><span class="s3">(() =&gt; {</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">unlinkSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFalse</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isUndefined</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isObject</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">Object</span><span class="s3">.</span><span class="s1">keys</span><span class="s3">(</span><span class="s1">result</span><span class="s3">), </span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">, </span><span class="s4">3</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">[</span><span class="s4">0</span><span class="s3">], </span><span class="s0">'b'</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">[</span><span class="s4">1</span><span class="s3">], </span><span class="s0">'a'</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">foo</span><span class="s3">[</span><span class="s4">2</span><span class="s3">], </span><span class="s0">'r'</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isNull</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">baz</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">.</span><span class="s1">qux</span><span class="s3">, </span><span class="s4">3.14159265359e42</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'read value:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">result</span><span class="s3">, </span><span class="s1">error</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s0">'&quot;foo&quot;'</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">res </span><span class="s3">=&gt; {</span>
            <span class="s1">result </span><span class="s3">= </span><span class="s1">res</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">err </span><span class="s3">=&gt; {</span>
            <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
            <span class="s1">error </span><span class="s3">= </span><span class="s1">err</span>
          <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">teardown</span><span class="s3">(() =&gt; {</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">unlinkSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFalse</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isUndefined</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s0">'foo'</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'read error:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">result</span><span class="s3">, </span><span class="s1">error</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s0">'&quot;foo&quot; &quot;bar&quot;'</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">res </span><span class="s3">=&gt; </span><span class="s1">result </span><span class="s3">= </span><span class="s1">res</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">err </span><span class="s3">=&gt; {</span>
            <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
            <span class="s1">error </span><span class="s3">= </span><span class="s1">err</span>
          <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">teardown</span><span class="s3">(() =&gt; {</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">unlinkSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isTrue</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isUndefined</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">instanceOf</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'read missing file:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">result</span><span class="s3">, </span><span class="s1">error</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'missing.json'</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFalse</span><span class="s3">(</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">existsSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">))</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">read</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">res </span><span class="s3">=&gt; </span><span class="s1">result </span><span class="s3">= </span><span class="s1">res</span><span class="s3">)</span>
          <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">err </span><span class="s3">=&gt; {</span>
            <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
            <span class="s1">error </span><span class="s3">= </span><span class="s1">err</span>
          <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isTrue</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isUndefined</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">instanceOf</span><span class="s3">(</span><span class="s1">error</span><span class="s3">, </span><span class="s1">Error</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'match predicate:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">file</span><span class="s3">, </span><span class="s1">results</span><span class="s3">, </span><span class="s1">errors</span>

      <span class="s1">setup</span><span class="s3">(</span><span class="s1">done </span><span class="s3">=&gt; {</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">({</span>
          <span class="s1">foo</span><span class="s3">: </span><span class="s0">'bar'</span><span class="s3">,</span>
          <span class="s1">baz</span><span class="s3">: </span><span class="s0">'qux'</span><span class="s3">,</span>
          <span class="s1">wibble</span><span class="s3">: </span><span class="s0">'blee'</span>
        <span class="s3">}))</span>
        <span class="s1">results </span><span class="s3">= []</span>
        <span class="s1">errors </span><span class="s3">= []</span>
        <span class="s2">const </span><span class="s1">datastream </span><span class="s3">= </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span>
          <span class="s1">fs</span><span class="s3">.</span><span class="s1">createReadStream</span><span class="s3">(</span><span class="s1">file</span><span class="s3">),</span>
          <span class="s3">(</span><span class="s1">k</span><span class="s3">, </span><span class="s1">v</span><span class="s3">) =&gt; </span><span class="s1">k </span><span class="s3">=== </span><span class="s0">'baz' </span><span class="s3">|| </span><span class="s1">v </span><span class="s3">=== </span><span class="s0">'blee'</span><span class="s3">,</span>
          <span class="s3">{ </span><span class="s1">minDepth</span><span class="s3">: </span><span class="s4">1 </span><span class="s3">}</span>
        <span class="s3">)</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'data'</span><span class="s3">, </span><span class="s1">item </span><span class="s3">=&gt; </span><span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">item</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'error'</span><span class="s3">, </span><span class="s1">error </span><span class="s3">=&gt; </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">error</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'end'</span><span class="s3">, </span><span class="s1">done</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'the correct properties were matched'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">([ </span><span class="s0">'qux'</span><span class="s3">, </span><span class="s0">'blee' </span><span class="s3">], </span><span class="s1">results</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'no errors occurred'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">errors</span><span class="s3">, [])</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'match nested:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">file</span><span class="s3">, </span><span class="s1">results</span><span class="s3">, </span><span class="s1">errors</span>

      <span class="s1">setup</span><span class="s3">(</span><span class="s1">done </span><span class="s3">=&gt; {</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, </span><span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">({</span>
          <span class="s1">foo</span><span class="s3">: {</span>
            <span class="s1">bar</span><span class="s3">: </span><span class="s0">'baz'</span>
          <span class="s3">}</span>
        <span class="s3">}))</span>
        <span class="s1">results </span><span class="s3">= []</span>
        <span class="s1">errors </span><span class="s3">= []</span>
        <span class="s2">const </span><span class="s1">datastream </span><span class="s3">= </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">createReadStream</span><span class="s3">(</span><span class="s1">file</span><span class="s3">), () =&gt; </span><span class="s2">true</span><span class="s3">)</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'data'</span><span class="s3">, </span><span class="s1">item </span><span class="s3">=&gt; </span><span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">item</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'error'</span><span class="s3">, </span><span class="s1">error </span><span class="s3">=&gt; </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">error</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'end'</span><span class="s3">, </span><span class="s1">done</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'the correct properties were matched'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">([ </span><span class="s0">'baz'</span><span class="s3">, { </span><span class="s1">bar</span><span class="s3">: </span><span class="s0">'baz' </span><span class="s3">}, { </span><span class="s1">foo</span><span class="s3">: { </span><span class="s1">bar</span><span class="s3">: </span><span class="s0">'baz' </span><span class="s3">} } ], </span><span class="s1">results</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'no errors occurred'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">errors</span><span class="s3">, [])</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'match ndjson:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">file</span><span class="s3">, </span><span class="s1">results</span><span class="s3">, </span><span class="s1">errors</span>

      <span class="s1">setup</span><span class="s3">(</span><span class="s1">done </span><span class="s3">=&gt; {</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.ndjson'</span><span class="s3">)</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, [</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">([ </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'b' </span><span class="s3">]),</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s2">null</span><span class="s3">),</span>
          <span class="s0">''</span><span class="s3">,</span>
          <span class="s0">''</span><span class="s3">,</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s0">'wibble'</span><span class="s3">)</span>
        <span class="s3">].</span><span class="s1">join</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\n</span><span class="s0">'</span><span class="s3">))</span>
        <span class="s1">results </span><span class="s3">= []</span>
        <span class="s1">errors </span><span class="s3">= []</span>
        <span class="s2">const </span><span class="s1">datastream </span><span class="s3">= </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s1">fs</span><span class="s3">.</span><span class="s1">createReadStream</span><span class="s3">(</span><span class="s1">file</span><span class="s3">), () =&gt; </span><span class="s2">true</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'data'</span><span class="s3">, </span><span class="s1">item </span><span class="s3">=&gt; </span><span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">item</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'error'</span><span class="s3">, </span><span class="s1">error </span><span class="s3">=&gt; </span><span class="s1">errors</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">error</span><span class="s3">))</span>
        <span class="s1">datastream</span><span class="s3">.</span><span class="s1">on</span><span class="s3">(</span><span class="s0">'end'</span><span class="s3">, </span><span class="s1">done</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'the correct properties were matched'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">([ </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'b'</span><span class="s3">, [ </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'b' </span><span class="s3">], </span><span class="s0">'wibble' </span><span class="s3">], </span><span class="s1">results</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'no errors occurred'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">errors</span><span class="s3">, [])</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'parse request:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">error</span><span class="s3">, </span><span class="s1">result</span>

      <span class="s1">setup</span><span class="s3">((</span><span class="s1">done</span><span class="s3">) =&gt; {</span>
        <span class="s2">const </span><span class="s1">jsonstream </span><span class="s3">= </span><span class="s2">new </span><span class="s1">stream</span><span class="s3">.</span><span class="s1">PassThrough</span><span class="s3">()</span>
        <span class="s1">axios</span><span class="s3">({</span>
          <span class="s1">responseType</span><span class="s3">: </span><span class="s0">'stream'</span><span class="s3">,</span>
          <span class="s1">url</span><span class="s3">: </span><span class="s0">'https://gitlab.com/philbooth/bfj/raw/master/package.json'</span><span class="s3">,</span>
        <span class="s3">}).</span><span class="s1">then</span><span class="s3">((</span><span class="s1">response</span><span class="s3">) =&gt; </span><span class="s1">response</span><span class="s3">.</span><span class="s1">data</span><span class="s3">.</span><span class="s1">pipe</span><span class="s3">(</span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">unpipe</span><span class="s3">((</span><span class="s1">err</span><span class="s3">, </span><span class="s1">res</span><span class="s3">) =&gt; {</span>
          <span class="s1">error </span><span class="s3">= </span><span class="s1">err</span>
          <span class="s1">result </span><span class="s3">= </span><span class="s1">res</span>
          <span class="s1">done</span><span class="s3">()</span>
        <span class="s3">})))</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isNull</span><span class="s3">(</span><span class="s1">error</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'../package.json'</span><span class="s3">))</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'parse NDJSON:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">results</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.ndjson'</span><span class="s3">)</span>
        <span class="s1">results </span><span class="s3">= []</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">writeFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, [</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">([ </span><span class="s0">'b'</span><span class="s3">, </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'r' </span><span class="s3">]),</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s2">null</span><span class="s3">),</span>
          <span class="s0">''</span><span class="s3">,</span>
          <span class="s0">''</span><span class="s3">,</span>
          <span class="s1">JSON</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s0">'wibble'</span><span class="s3">)</span>
        <span class="s3">].</span><span class="s1">join</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\n</span><span class="s0">'</span><span class="s3">))</span>
        <span class="s2">const </span><span class="s1">stream </span><span class="s3">= </span><span class="s1">fs</span><span class="s3">.</span><span class="s1">createReadStream</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">result </span><span class="s3">=&gt; {</span>
            <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">result </span><span class="s3">=&gt; {</span>
            <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">result </span><span class="s3">=&gt; {</span>
            <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">result </span><span class="s3">=&gt; {</span>
            <span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">result</span><span class="s3">)</span>
            <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s1">stream</span><span class="s3">, { </span><span class="s1">ndjson</span><span class="s3">: </span><span class="s2">true </span><span class="s3">})</span>
          <span class="s3">})</span>
          <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">result </span><span class="s3">=&gt; </span><span class="s1">results</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">result</span><span class="s3">))</span>
          <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">e </span><span class="s3">=&gt; {</span>
            <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
          <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">teardown</span><span class="s3">(() =&gt; {</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">unlinkSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'results were correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFalse</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">lengthOf</span><span class="s3">(</span><span class="s1">results</span><span class="s3">, </span><span class="s4">5</span><span class="s3">)</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">results</span><span class="s3">, [</span>
          <span class="s3">[ </span><span class="s0">'b'</span><span class="s3">, </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'r' </span><span class="s3">],</span>
          <span class="s2">null</span><span class="s3">,</span>
          <span class="s0">'wibble'</span><span class="s3">,</span>
          <span class="s1">undefined</span><span class="s3">,</span>
          <span class="s1">undefined</span>
        <span class="s3">])</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'stringify value:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">result</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">stringify</span><span class="s3">(</span><span class="s2">new </span><span class="s1">Promise</span><span class="s3">(</span><span class="s1">resolve </span><span class="s3">=&gt; {</span>
          <span class="s1">setTimeout</span><span class="s3">(</span><span class="s1">resolve</span><span class="s3">.</span><span class="s1">bind</span><span class="s3">(</span><span class="s2">null</span><span class="s3">, </span><span class="s0">'foo</span><span class="s2">\t</span><span class="s0">&quot;</span><span class="s2">\n</span><span class="s0">bar'</span><span class="s3">), </span><span class="s4">20</span><span class="s3">)</span>
        <span class="s3">}))</span>
        <span class="s3">.</span><span class="s1">then</span><span class="s3">(</span><span class="s1">res </span><span class="s3">=&gt; </span><span class="s1">result </span><span class="s3">= </span><span class="s1">res</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s0">'&quot;foo</span><span class="s2">\\</span><span class="s0">t</span><span class="s2">\\</span><span class="s0">&quot;</span><span class="s2">\\</span><span class="s0">nbar&quot;'</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>

    <span class="s1">suite</span><span class="s3">(</span><span class="s0">'write object:'</span><span class="s3">, () =&gt; {</span>
      <span class="s2">let </span><span class="s1">failed</span><span class="s3">, </span><span class="s1">file</span><span class="s3">, </span><span class="s1">result</span>

      <span class="s1">setup</span><span class="s3">(() =&gt; {</span>
        <span class="s1">failed </span><span class="s3">= </span><span class="s2">false</span>
        <span class="s1">file </span><span class="s3">= </span><span class="s1">path</span><span class="s3">.</span><span class="s1">join</span><span class="s3">(</span><span class="s1">__dirname</span><span class="s3">, </span><span class="s0">'data.json'</span><span class="s3">)</span>
        <span class="s2">return </span><span class="s1">bfj</span><span class="s3">.</span><span class="s1">write</span><span class="s3">(</span>
          <span class="s1">file</span><span class="s3">,</span>
          <span class="s3">{ </span><span class="s1">foo</span><span class="s3">: [ </span><span class="s0">'b'</span><span class="s3">, </span><span class="s0">'a'</span><span class="s3">, </span><span class="s0">'r' </span><span class="s3">], </span><span class="s1">baz</span><span class="s3">: </span><span class="s2">null</span><span class="s3">, </span><span class="s1">qux</span><span class="s3">: </span><span class="s4">3.14159265359e42 </span><span class="s3">}</span>
        <span class="s3">)</span>
        <span class="s3">.</span><span class="s1">then</span><span class="s3">(() =&gt; {</span>
          <span class="s1">result </span><span class="s3">= </span><span class="s1">fs</span><span class="s3">.</span><span class="s1">readFileSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">, { </span><span class="s1">encoding</span><span class="s3">: </span><span class="s0">'utf8' </span><span class="s3">})</span>
        <span class="s3">})</span>
        <span class="s3">.</span><span class="s1">catch</span><span class="s3">(</span><span class="s1">error </span><span class="s3">=&gt; {</span>
          <span class="s1">failed </span><span class="s3">= </span><span class="s2">true</span>
          <span class="s1">result </span><span class="s3">= </span><span class="s1">error</span>
        <span class="s3">})</span>
      <span class="s3">})</span>

      <span class="s1">teardown</span><span class="s3">(() =&gt; {</span>
        <span class="s1">fs</span><span class="s3">.</span><span class="s1">unlinkSync</span><span class="s3">(</span><span class="s1">file</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'did not fail'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">isFalse</span><span class="s3">(</span><span class="s1">failed</span><span class="s3">)</span>
      <span class="s3">})</span>

      <span class="s1">test</span><span class="s3">(</span><span class="s0">'result was correct'</span><span class="s3">, () =&gt; {</span>
        <span class="s1">assert</span><span class="s3">.</span><span class="s1">strictEqual</span><span class="s3">(</span><span class="s1">result</span><span class="s3">, </span><span class="s0">'{&quot;foo&quot;:[&quot;b&quot;,&quot;a&quot;,&quot;r&quot;],&quot;baz&quot;:null,&quot;qux&quot;:3.14159265359e+42}'</span><span class="s3">)</span>
      <span class="s3">})</span>
    <span class="s3">})</span>
  <span class="s3">})</span>
<span class="s3">})</span>

</pre>
</body>
</html>