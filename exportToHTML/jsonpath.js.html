<html>
<head>
<title>jsonpath.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #bcbec4;}
.s3 { color: #cf8e6d;}
.s4 { color: #6aab73;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
.s7 { color: #5f826b; font-style: italic;}
.s8 { color: #67a37c; font-style: italic;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
jsonpath.js</font>
</center></td></tr></table>
<pre><span class="s0">/*! jsonpath 1.1.1 */</span>

<span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">f</span><span class="s2">){</span><span class="s3">if</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">exports</span><span class="s2">===</span><span class="s4">&quot;object&quot;</span><span class="s2">&amp;&amp;</span><span class="s3">typeof </span><span class="s1">module</span><span class="s2">!==</span><span class="s4">&quot;undefined&quot;</span><span class="s2">){</span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">=</span><span class="s1">f</span><span class="s2">()}</span><span class="s3">else if</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">define</span><span class="s2">===</span><span class="s4">&quot;function&quot;</span><span class="s2">&amp;&amp;</span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">){</span><span class="s1">define</span><span class="s2">([],</span><span class="s1">f</span><span class="s2">)}</span><span class="s3">else</span><span class="s2">{</span><span class="s3">var </span><span class="s1">g</span><span class="s2">;</span><span class="s3">if</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">window</span><span class="s2">!==</span><span class="s4">&quot;undefined&quot;</span><span class="s2">){</span><span class="s1">g</span><span class="s2">=</span><span class="s1">window</span><span class="s2">}</span><span class="s3">else if</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">global</span><span class="s2">!==</span><span class="s4">&quot;undefined&quot;</span><span class="s2">){</span><span class="s1">g</span><span class="s2">=</span><span class="s1">global</span><span class="s2">}</span><span class="s3">else if</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">self</span><span class="s2">!==</span><span class="s4">&quot;undefined&quot;</span><span class="s2">){</span><span class="s1">g</span><span class="s2">=</span><span class="s1">self</span><span class="s2">}</span><span class="s3">else</span><span class="s2">{</span><span class="s1">g</span><span class="s2">=</span><span class="s3">this</span><span class="s2">}</span><span class="s1">g</span><span class="s2">.</span><span class="s1">jsonpath </span><span class="s2">= </span><span class="s1">f</span><span class="s2">()}})(</span><span class="s3">function</span><span class="s2">(){</span><span class="s3">var </span><span class="s1">define</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">;</span><span class="s3">return </span><span class="s2">(</span><span class="s3">function </span><span class="s1">e</span><span class="s2">(</span><span class="s1">t</span><span class="s2">,</span><span class="s1">n</span><span class="s2">,</span><span class="s1">r</span><span class="s2">){</span><span class="s3">function </span><span class="s1">s</span><span class="s2">(</span><span class="s1">o</span><span class="s2">,</span><span class="s1">u</span><span class="s2">){</span><span class="s3">if</span><span class="s2">(!</span><span class="s1">n</span><span class="s2">[</span><span class="s1">o</span><span class="s2">]){</span><span class="s3">if</span><span class="s2">(!</span><span class="s1">t</span><span class="s2">[</span><span class="s1">o</span><span class="s2">]){</span><span class="s3">var </span><span class="s1">a</span><span class="s2">=</span><span class="s3">typeof </span><span class="s1">require</span><span class="s2">==</span><span class="s4">&quot;function&quot;</span><span class="s2">&amp;&amp;</span><span class="s1">require</span><span class="s2">;</span><span class="s3">if</span><span class="s2">(!</span><span class="s1">u</span><span class="s2">&amp;&amp;</span><span class="s1">a</span><span class="s2">)</span><span class="s3">return </span><span class="s1">a</span><span class="s2">(</span><span class="s1">o</span><span class="s2">,!</span><span class="s5">0</span><span class="s2">);</span><span class="s3">if</span><span class="s2">(</span><span class="s1">i</span><span class="s2">)</span><span class="s3">return </span><span class="s1">i</span><span class="s2">(</span><span class="s1">o</span><span class="s2">,!</span><span class="s5">0</span><span class="s2">);</span><span class="s3">var </span><span class="s1">f</span><span class="s2">=</span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;Cannot find module '&quot;</span><span class="s2">+</span><span class="s1">o</span><span class="s2">+</span><span class="s4">&quot;'&quot;</span><span class="s2">);</span><span class="s3">throw </span><span class="s1">f</span><span class="s2">.</span><span class="s1">code</span><span class="s2">=</span><span class="s4">&quot;MODULE_NOT_FOUND&quot;</span><span class="s2">,</span><span class="s1">f</span><span class="s2">}</span><span class="s3">var </span><span class="s1">l</span><span class="s2">=</span><span class="s1">n</span><span class="s2">[</span><span class="s1">o</span><span class="s2">]={</span><span class="s1">exports</span><span class="s2">:{}};</span><span class="s1">t</span><span class="s2">[</span><span class="s1">o</span><span class="s2">][</span><span class="s5">0</span><span class="s2">].</span><span class="s1">call</span><span class="s2">(</span><span class="s1">l</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">,</span><span class="s3">function</span><span class="s2">(</span><span class="s1">e</span><span class="s2">){</span><span class="s3">var </span><span class="s1">n</span><span class="s2">=</span><span class="s1">t</span><span class="s2">[</span><span class="s1">o</span><span class="s2">][</span><span class="s5">1</span><span class="s2">][</span><span class="s1">e</span><span class="s2">];</span><span class="s3">return </span><span class="s1">s</span><span class="s2">(</span><span class="s1">n</span><span class="s2">?</span><span class="s1">n</span><span class="s2">:</span><span class="s1">e</span><span class="s2">)},</span><span class="s1">l</span><span class="s2">,</span><span class="s1">l</span><span class="s2">.</span><span class="s1">exports</span><span class="s2">,</span><span class="s1">e</span><span class="s2">,</span><span class="s1">t</span><span class="s2">,</span><span class="s1">n</span><span class="s2">,</span><span class="s1">r</span><span class="s2">)}</span><span class="s3">return </span><span class="s1">n</span><span class="s2">[</span><span class="s1">o</span><span class="s2">].</span><span class="s1">exports</span><span class="s2">}</span><span class="s3">var </span><span class="s1">i</span><span class="s2">=</span><span class="s3">typeof </span><span class="s1">require</span><span class="s2">==</span><span class="s4">&quot;function&quot;</span><span class="s2">&amp;&amp;</span><span class="s1">require</span><span class="s2">;</span><span class="s3">for</span><span class="s2">(</span><span class="s3">var </span><span class="s1">o</span><span class="s2">=</span><span class="s5">0</span><span class="s2">;</span><span class="s1">o</span><span class="s2">&lt;</span><span class="s1">r</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span><span class="s1">o</span><span class="s2">++)</span><span class="s1">s</span><span class="s2">(</span><span class="s1">r</span><span class="s2">[</span><span class="s1">o</span><span class="s2">]);</span><span class="s3">return </span><span class="s1">s</span><span class="s2">})({</span><span class="s4">&quot;./aesprim&quot;</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s0">/* 
  Copyright (C) 2013 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
  Copyright (C) 2013 Thaddee Tyl &lt;thaddee.tyl@gmail.com&gt; 
  Copyright (C) 2013 Mathias Bynens &lt;mathias@qiwi.be&gt; 
  Copyright (C) 2012 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
  Copyright (C) 2012 Mathias Bynens &lt;mathias@qiwi.be&gt; 
  Copyright (C) 2012 Joost-Wim Boekesteijn &lt;joost-wim@boekesteijn.nl&gt; 
  Copyright (C) 2012 Kris Kowal &lt;kris.kowal@cixar.com&gt; 
  Copyright (C) 2012 Yusuke Suzuki &lt;utatane.tea@gmail.com&gt; 
  Copyright (C) 2012 Arpad Borsos &lt;arpad.borsos@googlemail.com&gt; 
  Copyright (C) 2011 Ariya Hidayat &lt;ariya.hidayat@gmail.com&gt; 
 
  Redistribution and use in source and binary forms, with or without 
  modification, are permitted provided that the following conditions are met: 
 
    * Redistributions of source code must retain the above copyright 
      notice, this list of conditions and the following disclaimer. 
    * Redistributions in binary form must reproduce the above copyright 
      notice, this list of conditions and the following disclaimer in the 
      documentation and/or other materials provided with the distribution. 
 
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; 
  AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
  IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
  ARE DISCLAIMED. IN NO EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY 
  DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES 
  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; 
  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND 
  ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT 
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF 
  THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
*/</span>

<span class="s0">/*jslint bitwise:true plusplus:true */</span>
<span class="s0">/*global esprima:true, define:true, exports:true, window: true, 
throwErrorTolerant: true, 
throwError: true, generateStatement: true, peek: true, 
parseAssignmentExpression: true, parseBlock: true, parseExpression: true, 
parseFunctionDeclaration: true, parseFunctionExpression: true, 
parseFunctionSourceElements: true, parseVariableIdentifier: true, 
parseLeftHandSideExpression: true, 
parseUnaryExpression: true, 
parseStatement: true, parseSourceElement: true */</span>

<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">root</span><span class="s2">, </span><span class="s1">factory</span><span class="s2">) {</span>
    <span class="s4">'use strict'</span><span class="s2">;</span>

    <span class="s0">// Universal Module Definition (UMD) to support AMD, CommonJS/Node.js,</span>
    <span class="s0">// Rhino, and plain browser loading.</span>

    <span class="s0">/* istanbul ignore next */</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">define </span><span class="s2">=== </span><span class="s4">'function' </span><span class="s2">&amp;&amp; </span><span class="s1">define</span><span class="s2">.</span><span class="s1">amd</span><span class="s2">) {</span>
        <span class="s1">define</span><span class="s2">([</span><span class="s4">'exports'</span><span class="s2">], </span><span class="s1">factory</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">exports </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
        <span class="s1">factory</span><span class="s2">(</span><span class="s1">exports</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">factory</span><span class="s2">((</span><span class="s1">root</span><span class="s2">.</span><span class="s1">esprima </span><span class="s2">= {}));</span>
    <span class="s2">}</span>
<span class="s2">}(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">function </span><span class="s2">(</span><span class="s1">exports</span><span class="s2">) {</span>
    <span class="s4">'use strict'</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">Token</span><span class="s2">,</span>
        <span class="s1">TokenName</span><span class="s2">,</span>
        <span class="s1">FnExprTokens</span><span class="s2">,</span>
        <span class="s1">Syntax</span><span class="s2">,</span>
        <span class="s1">PropertyKind</span><span class="s2">,</span>
        <span class="s1">Messages</span><span class="s2">,</span>
        <span class="s1">Regex</span><span class="s2">,</span>
        <span class="s1">SyntaxTreeDelegate</span><span class="s2">,</span>
        <span class="s1">source</span><span class="s2">,</span>
        <span class="s1">strict</span><span class="s2">,</span>
        <span class="s1">index</span><span class="s2">,</span>
        <span class="s1">lineNumber</span><span class="s2">,</span>
        <span class="s1">lineStart</span><span class="s2">,</span>
        <span class="s1">length</span><span class="s2">,</span>
        <span class="s1">delegate</span><span class="s2">,</span>
        <span class="s1">lookahead</span><span class="s2">,</span>
        <span class="s1">state</span><span class="s2">,</span>
        <span class="s1">extra</span><span class="s2">;</span>

    <span class="s1">Token </span><span class="s2">= {</span>
        <span class="s1">BooleanLiteral</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
        <span class="s1">EOF</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
        <span class="s1">Identifier</span><span class="s2">: </span><span class="s5">3</span><span class="s2">,</span>
        <span class="s1">Keyword</span><span class="s2">: </span><span class="s5">4</span><span class="s2">,</span>
        <span class="s1">NullLiteral</span><span class="s2">: </span><span class="s5">5</span><span class="s2">,</span>
        <span class="s1">NumericLiteral</span><span class="s2">: </span><span class="s5">6</span><span class="s2">,</span>
        <span class="s1">Punctuator</span><span class="s2">: </span><span class="s5">7</span><span class="s2">,</span>
        <span class="s1">StringLiteral</span><span class="s2">: </span><span class="s5">8</span><span class="s2">,</span>
        <span class="s1">RegularExpression</span><span class="s2">: </span><span class="s5">9</span>
    <span class="s2">};</span>

    <span class="s1">TokenName </span><span class="s2">= {};</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">] = </span><span class="s4">'Boolean'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">] = </span><span class="s4">'&lt;end&gt;'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">] = </span><span class="s4">'Identifier'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">] = </span><span class="s4">'Keyword'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">] = </span><span class="s4">'Null'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">] = </span><span class="s4">'Numeric'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">] = </span><span class="s4">'Punctuator'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">] = </span><span class="s4">'String'</span><span class="s2">;</span>
    <span class="s1">TokenName</span><span class="s2">[</span><span class="s1">Token</span><span class="s2">.</span><span class="s1">RegularExpression</span><span class="s2">] = </span><span class="s4">'RegularExpression'</span><span class="s2">;</span>

    <span class="s0">// A function following one of those tokens is an expression.</span>
    <span class="s1">FnExprTokens </span><span class="s2">= [</span><span class="s4">'('</span><span class="s2">, </span><span class="s4">'{'</span><span class="s2">, </span><span class="s4">'['</span><span class="s2">, </span><span class="s4">'in'</span><span class="s2">, </span><span class="s4">'typeof'</span><span class="s2">, </span><span class="s4">'instanceof'</span><span class="s2">, </span><span class="s4">'new'</span><span class="s2">,</span>
                    <span class="s4">'return'</span><span class="s2">, </span><span class="s4">'case'</span><span class="s2">, </span><span class="s4">'delete'</span><span class="s2">, </span><span class="s4">'throw'</span><span class="s2">, </span><span class="s4">'void'</span><span class="s2">,</span>
                    <span class="s0">// assignment operators</span>
                    <span class="s4">'='</span><span class="s2">, </span><span class="s4">'+='</span><span class="s2">, </span><span class="s4">'-='</span><span class="s2">, </span><span class="s4">'*='</span><span class="s2">, </span><span class="s4">'/='</span><span class="s2">, </span><span class="s4">'%='</span><span class="s2">, </span><span class="s4">'&lt;&lt;='</span><span class="s2">, </span><span class="s4">'&gt;&gt;='</span><span class="s2">, </span><span class="s4">'&gt;&gt;&gt;='</span><span class="s2">,</span>
                    <span class="s4">'&amp;='</span><span class="s2">, </span><span class="s4">'|='</span><span class="s2">, </span><span class="s4">'^='</span><span class="s2">, </span><span class="s4">','</span><span class="s2">,</span>
                    <span class="s0">// binary/unary operators</span>
                    <span class="s4">'+'</span><span class="s2">, </span><span class="s4">'-'</span><span class="s2">, </span><span class="s4">'*'</span><span class="s2">, </span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'%'</span><span class="s2">, </span><span class="s4">'++'</span><span class="s2">, </span><span class="s4">'--'</span><span class="s2">, </span><span class="s4">'&lt;&lt;'</span><span class="s2">, </span><span class="s4">'&gt;&gt;'</span><span class="s2">, </span><span class="s4">'&gt;&gt;&gt;'</span><span class="s2">, </span><span class="s4">'&amp;'</span><span class="s2">,</span>
                    <span class="s4">'|'</span><span class="s2">, </span><span class="s4">'^'</span><span class="s2">, </span><span class="s4">'!'</span><span class="s2">, </span><span class="s4">'~'</span><span class="s2">, </span><span class="s4">'&amp;&amp;'</span><span class="s2">, </span><span class="s4">'||'</span><span class="s2">, </span><span class="s4">'?'</span><span class="s2">, </span><span class="s4">':'</span><span class="s2">, </span><span class="s4">'==='</span><span class="s2">, </span><span class="s4">'=='</span><span class="s2">, </span><span class="s4">'&gt;='</span><span class="s2">,</span>
                    <span class="s4">'&lt;='</span><span class="s2">, </span><span class="s4">'&lt;'</span><span class="s2">, </span><span class="s4">'&gt;'</span><span class="s2">, </span><span class="s4">'!='</span><span class="s2">, </span><span class="s4">'!=='</span><span class="s2">];</span>

    <span class="s1">Syntax </span><span class="s2">= {</span>
        <span class="s1">AssignmentExpression</span><span class="s2">: </span><span class="s4">'AssignmentExpression'</span><span class="s2">,</span>
        <span class="s1">ArrayExpression</span><span class="s2">: </span><span class="s4">'ArrayExpression'</span><span class="s2">,</span>
        <span class="s1">BlockStatement</span><span class="s2">: </span><span class="s4">'BlockStatement'</span><span class="s2">,</span>
        <span class="s1">BinaryExpression</span><span class="s2">: </span><span class="s4">'BinaryExpression'</span><span class="s2">,</span>
        <span class="s1">BreakStatement</span><span class="s2">: </span><span class="s4">'BreakStatement'</span><span class="s2">,</span>
        <span class="s1">CallExpression</span><span class="s2">: </span><span class="s4">'CallExpression'</span><span class="s2">,</span>
        <span class="s1">CatchClause</span><span class="s2">: </span><span class="s4">'CatchClause'</span><span class="s2">,</span>
        <span class="s1">ConditionalExpression</span><span class="s2">: </span><span class="s4">'ConditionalExpression'</span><span class="s2">,</span>
        <span class="s1">ContinueStatement</span><span class="s2">: </span><span class="s4">'ContinueStatement'</span><span class="s2">,</span>
        <span class="s1">DoWhileStatement</span><span class="s2">: </span><span class="s4">'DoWhileStatement'</span><span class="s2">,</span>
        <span class="s1">DebuggerStatement</span><span class="s2">: </span><span class="s4">'DebuggerStatement'</span><span class="s2">,</span>
        <span class="s1">EmptyStatement</span><span class="s2">: </span><span class="s4">'EmptyStatement'</span><span class="s2">,</span>
        <span class="s1">ExpressionStatement</span><span class="s2">: </span><span class="s4">'ExpressionStatement'</span><span class="s2">,</span>
        <span class="s1">ForStatement</span><span class="s2">: </span><span class="s4">'ForStatement'</span><span class="s2">,</span>
        <span class="s1">ForInStatement</span><span class="s2">: </span><span class="s4">'ForInStatement'</span><span class="s2">,</span>
        <span class="s1">FunctionDeclaration</span><span class="s2">: </span><span class="s4">'FunctionDeclaration'</span><span class="s2">,</span>
        <span class="s1">FunctionExpression</span><span class="s2">: </span><span class="s4">'FunctionExpression'</span><span class="s2">,</span>
        <span class="s1">Identifier</span><span class="s2">: </span><span class="s4">'Identifier'</span><span class="s2">,</span>
        <span class="s1">IfStatement</span><span class="s2">: </span><span class="s4">'IfStatement'</span><span class="s2">,</span>
        <span class="s1">Literal</span><span class="s2">: </span><span class="s4">'Literal'</span><span class="s2">,</span>
        <span class="s1">LabeledStatement</span><span class="s2">: </span><span class="s4">'LabeledStatement'</span><span class="s2">,</span>
        <span class="s1">LogicalExpression</span><span class="s2">: </span><span class="s4">'LogicalExpression'</span><span class="s2">,</span>
        <span class="s1">MemberExpression</span><span class="s2">: </span><span class="s4">'MemberExpression'</span><span class="s2">,</span>
        <span class="s1">NewExpression</span><span class="s2">: </span><span class="s4">'NewExpression'</span><span class="s2">,</span>
        <span class="s1">ObjectExpression</span><span class="s2">: </span><span class="s4">'ObjectExpression'</span><span class="s2">,</span>
        <span class="s1">Program</span><span class="s2">: </span><span class="s4">'Program'</span><span class="s2">,</span>
        <span class="s1">Property</span><span class="s2">: </span><span class="s4">'Property'</span><span class="s2">,</span>
        <span class="s1">ReturnStatement</span><span class="s2">: </span><span class="s4">'ReturnStatement'</span><span class="s2">,</span>
        <span class="s1">SequenceExpression</span><span class="s2">: </span><span class="s4">'SequenceExpression'</span><span class="s2">,</span>
        <span class="s1">SwitchStatement</span><span class="s2">: </span><span class="s4">'SwitchStatement'</span><span class="s2">,</span>
        <span class="s1">SwitchCase</span><span class="s2">: </span><span class="s4">'SwitchCase'</span><span class="s2">,</span>
        <span class="s1">ThisExpression</span><span class="s2">: </span><span class="s4">'ThisExpression'</span><span class="s2">,</span>
        <span class="s1">ThrowStatement</span><span class="s2">: </span><span class="s4">'ThrowStatement'</span><span class="s2">,</span>
        <span class="s1">TryStatement</span><span class="s2">: </span><span class="s4">'TryStatement'</span><span class="s2">,</span>
        <span class="s1">UnaryExpression</span><span class="s2">: </span><span class="s4">'UnaryExpression'</span><span class="s2">,</span>
        <span class="s1">UpdateExpression</span><span class="s2">: </span><span class="s4">'UpdateExpression'</span><span class="s2">,</span>
        <span class="s1">VariableDeclaration</span><span class="s2">: </span><span class="s4">'VariableDeclaration'</span><span class="s2">,</span>
        <span class="s1">VariableDeclarator</span><span class="s2">: </span><span class="s4">'VariableDeclarator'</span><span class="s2">,</span>
        <span class="s1">WhileStatement</span><span class="s2">: </span><span class="s4">'WhileStatement'</span><span class="s2">,</span>
        <span class="s1">WithStatement</span><span class="s2">: </span><span class="s4">'WithStatement'</span>
    <span class="s2">};</span>

    <span class="s1">PropertyKind </span><span class="s2">= {</span>
        <span class="s1">Data</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
        <span class="s1">Get</span><span class="s2">: </span><span class="s5">2</span><span class="s2">,</span>
        <span class="s1">Set</span><span class="s2">: </span><span class="s5">4</span>
    <span class="s2">};</span>

    <span class="s0">// Error messages should be identical to V8.</span>
    <span class="s1">Messages </span><span class="s2">= {</span>
        <span class="s1">UnexpectedToken</span><span class="s2">:  </span><span class="s4">'Unexpected token %0'</span><span class="s2">,</span>
        <span class="s1">UnexpectedNumber</span><span class="s2">:  </span><span class="s4">'Unexpected number'</span><span class="s2">,</span>
        <span class="s1">UnexpectedString</span><span class="s2">:  </span><span class="s4">'Unexpected string'</span><span class="s2">,</span>
        <span class="s1">UnexpectedIdentifier</span><span class="s2">:  </span><span class="s4">'Unexpected identifier'</span><span class="s2">,</span>
        <span class="s1">UnexpectedReserved</span><span class="s2">:  </span><span class="s4">'Unexpected reserved word'</span><span class="s2">,</span>
        <span class="s1">UnexpectedEOS</span><span class="s2">:  </span><span class="s4">'Unexpected end of input'</span><span class="s2">,</span>
        <span class="s1">NewlineAfterThrow</span><span class="s2">:  </span><span class="s4">'Illegal newline after throw'</span><span class="s2">,</span>
        <span class="s1">InvalidRegExp</span><span class="s2">: </span><span class="s4">'Invalid regular expression'</span><span class="s2">,</span>
        <span class="s1">UnterminatedRegExp</span><span class="s2">:  </span><span class="s4">'Invalid regular expression: missing /'</span><span class="s2">,</span>
        <span class="s1">InvalidLHSInAssignment</span><span class="s2">:  </span><span class="s4">'Invalid left-hand side in assignment'</span><span class="s2">,</span>
        <span class="s1">InvalidLHSInForIn</span><span class="s2">:  </span><span class="s4">'Invalid left-hand side in for-in'</span><span class="s2">,</span>
        <span class="s1">MultipleDefaultsInSwitch</span><span class="s2">: </span><span class="s4">'More than one default clause in switch statement'</span><span class="s2">,</span>
        <span class="s1">NoCatchOrFinally</span><span class="s2">:  </span><span class="s4">'Missing catch or finally after try'</span><span class="s2">,</span>
        <span class="s1">UnknownLabel</span><span class="s2">: </span><span class="s4">'Undefined label </span><span class="s3">\'</span><span class="s4">%0</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">,</span>
        <span class="s1">Redeclaration</span><span class="s2">: </span><span class="s4">'%0 </span><span class="s3">\'</span><span class="s4">%1</span><span class="s3">\' </span><span class="s4">has already been declared'</span><span class="s2">,</span>
        <span class="s1">IllegalContinue</span><span class="s2">: </span><span class="s4">'Illegal continue statement'</span><span class="s2">,</span>
        <span class="s1">IllegalBreak</span><span class="s2">: </span><span class="s4">'Illegal break statement'</span><span class="s2">,</span>
        <span class="s1">IllegalReturn</span><span class="s2">: </span><span class="s4">'Illegal return statement'</span><span class="s2">,</span>
        <span class="s1">StrictModeWith</span><span class="s2">:  </span><span class="s4">'Strict mode code may not include a with statement'</span><span class="s2">,</span>
        <span class="s1">StrictCatchVariable</span><span class="s2">:  </span><span class="s4">'Catch variable may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictVarName</span><span class="s2">:  </span><span class="s4">'Variable name may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictParamName</span><span class="s2">:  </span><span class="s4">'Parameter name eval or arguments is not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictParamDupe</span><span class="s2">: </span><span class="s4">'Strict mode function may not have duplicate parameter names'</span><span class="s2">,</span>
        <span class="s1">StrictFunctionName</span><span class="s2">:  </span><span class="s4">'Function name may not be eval or arguments in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictOctalLiteral</span><span class="s2">:  </span><span class="s4">'Octal literals are not allowed in strict mode.'</span><span class="s2">,</span>
        <span class="s1">StrictDelete</span><span class="s2">:  </span><span class="s4">'Delete of an unqualified identifier in strict mode.'</span><span class="s2">,</span>
        <span class="s1">StrictDuplicateProperty</span><span class="s2">:  </span><span class="s4">'Duplicate data property in object literal not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">AccessorDataProperty</span><span class="s2">:  </span><span class="s4">'Object literal may not have data and accessor property with the same name'</span><span class="s2">,</span>
        <span class="s1">AccessorGetSet</span><span class="s2">:  </span><span class="s4">'Object literal may not have multiple get/set accessors with the same name'</span><span class="s2">,</span>
        <span class="s1">StrictLHSAssignment</span><span class="s2">:  </span><span class="s4">'Assignment to eval or arguments is not allowed in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictLHSPostfix</span><span class="s2">:  </span><span class="s4">'Postfix increment/decrement may not have eval or arguments operand in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictLHSPrefix</span><span class="s2">:  </span><span class="s4">'Prefix increment/decrement may not have eval or arguments operand in strict mode'</span><span class="s2">,</span>
        <span class="s1">StrictReservedWord</span><span class="s2">:  </span><span class="s4">'Use of future reserved word in strict mode'</span>
    <span class="s2">};</span>

    <span class="s0">// See also tools/generate-unicode-regex.py.</span>
    <span class="s1">Regex </span><span class="s2">= {</span>
        <span class="s1">NonAsciiIdentifierStart</span><span class="s2">: </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'[</span><span class="s3">\xAA\xB5\xBA\xC0</span><span class="s4">-</span><span class="s3">\xD6\xD8</span><span class="s4">-</span><span class="s3">\xF6\xF8</span><span class="s4">-</span><span class="s3">\u02C1\u02C6</span><span class="s4">-</span><span class="s3">\u02D1\u02E0</span><span class="s4">-</span><span class="s3">\u02E4\u02EC\u02EE\u0370</span><span class="s4">-</span><span class="s3">\u0374\u0376\u0377\u037A</span><span class="s4">-</span><span class="s3">\u037D\u0386\u0388</span><span class="s4">-</span><span class="s3">\u038A\u038C\u038E</span><span class="s4">-</span><span class="s3">\u03A1\u03A3</span><span class="s4">-</span><span class="s3">\u03F5\u03F7</span><span class="s4">-</span><span class="s3">\u0481\u048A</span><span class="s4">-</span><span class="s3">\u0527\u0531</span><span class="s4">-</span><span class="s3">\u0556\u0559\u0561</span><span class="s4">-</span><span class="s3">\u0587\u05D0</span><span class="s4">-</span><span class="s3">\u05EA\u05F0</span><span class="s4">-</span><span class="s3">\u05F2\u0620</span><span class="s4">-</span><span class="s3">\u064A\u066E\u066F\u0671</span><span class="s4">-</span><span class="s3">\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA</span><span class="s4">-</span><span class="s3">\u06FC\u06FF\u0710\u0712</span><span class="s4">-</span><span class="s3">\u072F\u074D</span><span class="s4">-</span><span class="s3">\u07A5\u07B1\u07CA</span><span class="s4">-</span><span class="s3">\u07EA\u07F4\u07F5\u07FA\u0800</span><span class="s4">-</span><span class="s3">\u0815\u081A\u0824\u0828\u0840</span><span class="s4">-</span><span class="s3">\u0858\u08A0\u08A2</span><span class="s4">-</span><span class="s3">\u08AC\u0904</span><span class="s4">-</span><span class="s3">\u0939\u093D\u0950\u0958</span><span class="s4">-</span><span class="s3">\u0961\u0971</span><span class="s4">-</span><span class="s3">\u0977\u0979</span><span class="s4">-</span><span class="s3">\u097F\u0985</span><span class="s4">-</span><span class="s3">\u098C\u098F\u0990\u0993</span><span class="s4">-</span><span class="s3">\u09A8\u09AA</span><span class="s4">-</span><span class="s3">\u09B0\u09B2\u09B6</span><span class="s4">-</span><span class="s3">\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF</span><span class="s4">-</span><span class="s3">\u09E1\u09F0\u09F1\u0A05</span><span class="s4">-</span><span class="s3">\u0A0A\u0A0F\u0A10\u0A13</span><span class="s4">-</span><span class="s3">\u0A28\u0A2A</span><span class="s4">-</span><span class="s3">\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59</span><span class="s4">-</span><span class="s3">\u0A5C\u0A5E\u0A72</span><span class="s4">-</span><span class="s3">\u0A74\u0A85</span><span class="s4">-</span><span class="s3">\u0A8D\u0A8F</span><span class="s4">-</span><span class="s3">\u0A91\u0A93</span><span class="s4">-</span><span class="s3">\u0AA8\u0AAA</span><span class="s4">-</span><span class="s3">\u0AB0\u0AB2\u0AB3\u0AB5</span><span class="s4">-</span><span class="s3">\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05</span><span class="s4">-</span><span class="s3">\u0B0C\u0B0F\u0B10\u0B13</span><span class="s4">-</span><span class="s3">\u0B28\u0B2A</span><span class="s4">-</span><span class="s3">\u0B30\u0B32\u0B33\u0B35</span><span class="s4">-</span><span class="s3">\u0B39\u0B3D\u0B5C\u0B5D\u0B5F</span><span class="s4">-</span><span class="s3">\u0B61\u0B71\u0B83\u0B85</span><span class="s4">-</span><span class="s3">\u0B8A\u0B8E</span><span class="s4">-</span><span class="s3">\u0B90\u0B92</span><span class="s4">-</span><span class="s3">\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8</span><span class="s4">-</span><span class="s3">\u0BAA\u0BAE</span><span class="s4">-</span><span class="s3">\u0BB9\u0BD0\u0C05</span><span class="s4">-</span><span class="s3">\u0C0C\u0C0E</span><span class="s4">-</span><span class="s3">\u0C10\u0C12</span><span class="s4">-</span><span class="s3">\u0C28\u0C2A</span><span class="s4">-</span><span class="s3">\u0C33\u0C35</span><span class="s4">-</span><span class="s3">\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85</span><span class="s4">-</span><span class="s3">\u0C8C\u0C8E</span><span class="s4">-</span><span class="s3">\u0C90\u0C92</span><span class="s4">-</span><span class="s3">\u0CA8\u0CAA</span><span class="s4">-</span><span class="s3">\u0CB3\u0CB5</span><span class="s4">-</span><span class="s3">\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05</span><span class="s4">-</span><span class="s3">\u0D0C\u0D0E</span><span class="s4">-</span><span class="s3">\u0D10\u0D12</span><span class="s4">-</span><span class="s3">\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A</span><span class="s4">-</span><span class="s3">\u0D7F\u0D85</span><span class="s4">-</span><span class="s3">\u0D96\u0D9A</span><span class="s4">-</span><span class="s3">\u0DB1\u0DB3</span><span class="s4">-</span><span class="s3">\u0DBB\u0DBD\u0DC0</span><span class="s4">-</span><span class="s3">\u0DC6\u0E01</span><span class="s4">-</span><span class="s3">\u0E30\u0E32\u0E33\u0E40</span><span class="s4">-</span><span class="s3">\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94</span><span class="s4">-</span><span class="s3">\u0E97\u0E99</span><span class="s4">-</span><span class="s3">\u0E9F\u0EA1</span><span class="s4">-</span><span class="s3">\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD</span><span class="s4">-</span><span class="s3">\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0</span><span class="s4">-</span><span class="s3">\u0EC4\u0EC6\u0EDC</span><span class="s4">-</span><span class="s3">\u0EDF\u0F00\u0F40</span><span class="s4">-</span><span class="s3">\u0F47\u0F49</span><span class="s4">-</span><span class="s3">\u0F6C\u0F88</span><span class="s4">-</span><span class="s3">\u0F8C\u1000</span><span class="s4">-</span><span class="s3">\u102A\u103F\u1050</span><span class="s4">-</span><span class="s3">\u1055\u105A</span><span class="s4">-</span><span class="s3">\u105D\u1061\u1065\u1066\u106E</span><span class="s4">-</span><span class="s3">\u1070\u1075</span><span class="s4">-</span><span class="s3">\u1081\u108E\u10A0</span><span class="s4">-</span><span class="s3">\u10C5\u10C7\u10CD\u10D0</span><span class="s4">-</span><span class="s3">\u10FA\u10FC</span><span class="s4">-</span><span class="s3">\u1248\u124A</span><span class="s4">-</span><span class="s3">\u124D\u1250</span><span class="s4">-</span><span class="s3">\u1256\u1258\u125A</span><span class="s4">-</span><span class="s3">\u125D\u1260</span><span class="s4">-</span><span class="s3">\u1288\u128A</span><span class="s4">-</span><span class="s3">\u128D\u1290</span><span class="s4">-</span><span class="s3">\u12B0\u12B2</span><span class="s4">-</span><span class="s3">\u12B5\u12B8</span><span class="s4">-</span><span class="s3">\u12BE\u12C0\u12C2</span><span class="s4">-</span><span class="s3">\u12C5\u12C8</span><span class="s4">-</span><span class="s3">\u12D6\u12D8</span><span class="s4">-</span><span class="s3">\u1310\u1312</span><span class="s4">-</span><span class="s3">\u1315\u1318</span><span class="s4">-</span><span class="s3">\u135A\u1380</span><span class="s4">-</span><span class="s3">\u138F\u13A0</span><span class="s4">-</span><span class="s3">\u13F4\u1401</span><span class="s4">-</span><span class="s3">\u166C\u166F</span><span class="s4">-</span><span class="s3">\u167F\u1681</span><span class="s4">-</span><span class="s3">\u169A\u16A0</span><span class="s4">-</span><span class="s3">\u16EA\u16EE</span><span class="s4">-</span><span class="s3">\u16F0\u1700</span><span class="s4">-</span><span class="s3">\u170C\u170E</span><span class="s4">-</span><span class="s3">\u1711\u1720</span><span class="s4">-</span><span class="s3">\u1731\u1740</span><span class="s4">-</span><span class="s3">\u1751\u1760</span><span class="s4">-</span><span class="s3">\u176C\u176E</span><span class="s4">-</span><span class="s3">\u1770\u1780</span><span class="s4">-</span><span class="s3">\u17B3\u17D7\u17DC\u1820</span><span class="s4">-</span><span class="s3">\u1877\u1880</span><span class="s4">-</span><span class="s3">\u18A8\u18AA\u18B0</span><span class="s4">-</span><span class="s3">\u18F5\u1900</span><span class="s4">-</span><span class="s3">\u191C\u1950</span><span class="s4">-</span><span class="s3">\u196D\u1970</span><span class="s4">-</span><span class="s3">\u1974\u1980</span><span class="s4">-</span><span class="s3">\u19AB\u19C1</span><span class="s4">-</span><span class="s3">\u19C7\u1A00</span><span class="s4">-</span><span class="s3">\u1A16\u1A20</span><span class="s4">-</span><span class="s3">\u1A54\u1AA7\u1B05</span><span class="s4">-</span><span class="s3">\u1B33\u1B45</span><span class="s4">-</span><span class="s3">\u1B4B\u1B83</span><span class="s4">-</span><span class="s3">\u1BA0\u1BAE\u1BAF\u1BBA</span><span class="s4">-</span><span class="s3">\u1BE5\u1C00</span><span class="s4">-</span><span class="s3">\u1C23\u1C4D</span><span class="s4">-</span><span class="s3">\u1C4F\u1C5A</span><span class="s4">-</span><span class="s3">\u1C7D\u1CE9</span><span class="s4">-</span><span class="s3">\u1CEC\u1CEE</span><span class="s4">-</span><span class="s3">\u1CF1\u1CF5\u1CF6\u1D00</span><span class="s4">-</span><span class="s3">\u1DBF\u1E00</span><span class="s4">-</span><span class="s3">\u1F15\u1F18</span><span class="s4">-</span><span class="s3">\u1F1D\u1F20</span><span class="s4">-</span><span class="s3">\u1F45\u1F48</span><span class="s4">-</span><span class="s3">\u1F4D\u1F50</span><span class="s4">-</span><span class="s3">\u1F57\u1F59\u1F5B\u1F5D\u1F5F</span><span class="s4">-</span><span class="s3">\u1F7D\u1F80</span><span class="s4">-</span><span class="s3">\u1FB4\u1FB6</span><span class="s4">-</span><span class="s3">\u1FBC\u1FBE\u1FC2</span><span class="s4">-</span><span class="s3">\u1FC4\u1FC6</span><span class="s4">-</span><span class="s3">\u1FCC\u1FD0</span><span class="s4">-</span><span class="s3">\u1FD3\u1FD6</span><span class="s4">-</span><span class="s3">\u1FDB\u1FE0</span><span class="s4">-</span><span class="s3">\u1FEC\u1FF2</span><span class="s4">-</span><span class="s3">\u1FF4\u1FF6</span><span class="s4">-</span><span class="s3">\u1FFC\u2071\u207F\u2090</span><span class="s4">-</span><span class="s3">\u209C\u2102\u2107\u210A</span><span class="s4">-</span><span class="s3">\u2113\u2115\u2119</span><span class="s4">-</span><span class="s3">\u211D\u2124\u2126\u2128\u212A</span><span class="s4">-</span><span class="s3">\u212D\u212F</span><span class="s4">-</span><span class="s3">\u2139\u213C</span><span class="s4">-</span><span class="s3">\u213F\u2145</span><span class="s4">-</span><span class="s3">\u2149\u214E\u2160</span><span class="s4">-</span><span class="s3">\u2188\u2C00</span><span class="s4">-</span><span class="s3">\u2C2E\u2C30</span><span class="s4">-</span><span class="s3">\u2C5E\u2C60</span><span class="s4">-</span><span class="s3">\u2CE4\u2CEB</span><span class="s4">-</span><span class="s3">\u2CEE\u2CF2\u2CF3\u2D00</span><span class="s4">-</span><span class="s3">\u2D25\u2D27\u2D2D\u2D30</span><span class="s4">-</span><span class="s3">\u2D67\u2D6F\u2D80</span><span class="s4">-</span><span class="s3">\u2D96\u2DA0</span><span class="s4">-</span><span class="s3">\u2DA6\u2DA8</span><span class="s4">-</span><span class="s3">\u2DAE\u2DB0</span><span class="s4">-</span><span class="s3">\u2DB6\u2DB8</span><span class="s4">-</span><span class="s3">\u2DBE\u2DC0</span><span class="s4">-</span><span class="s3">\u2DC6\u2DC8</span><span class="s4">-</span><span class="s3">\u2DCE\u2DD0</span><span class="s4">-</span><span class="s3">\u2DD6\u2DD8</span><span class="s4">-</span><span class="s3">\u2DDE\u2E2F\u3005</span><span class="s4">-</span><span class="s3">\u3007\u3021</span><span class="s4">-</span><span class="s3">\u3029\u3031</span><span class="s4">-</span><span class="s3">\u3035\u3038</span><span class="s4">-</span><span class="s3">\u303C\u3041</span><span class="s4">-</span><span class="s3">\u3096\u309D</span><span class="s4">-</span><span class="s3">\u309F\u30A1</span><span class="s4">-</span><span class="s3">\u30FA\u30FC</span><span class="s4">-</span><span class="s3">\u30FF\u3105</span><span class="s4">-</span><span class="s3">\u312D\u3131</span><span class="s4">-</span><span class="s3">\u318E\u31A0</span><span class="s4">-</span><span class="s3">\u31BA\u31F0</span><span class="s4">-</span><span class="s3">\u31FF\u3400</span><span class="s4">-</span><span class="s3">\u4DB5\u4E00</span><span class="s4">-</span><span class="s3">\u9FCC\uA000</span><span class="s4">-</span><span class="s3">\uA48C\uA4D0</span><span class="s4">-</span><span class="s3">\uA4FD\uA500</span><span class="s4">-</span><span class="s3">\uA60C\uA610</span><span class="s4">-</span><span class="s3">\uA61F\uA62A\uA62B\uA640</span><span class="s4">-</span><span class="s3">\uA66E\uA67F</span><span class="s4">-</span><span class="s3">\uA697\uA6A0</span><span class="s4">-</span><span class="s3">\uA6EF\uA717</span><span class="s4">-</span><span class="s3">\uA71F\uA722</span><span class="s4">-</span><span class="s3">\uA788\uA78B</span><span class="s4">-</span><span class="s3">\uA78E\uA790</span><span class="s4">-</span><span class="s3">\uA793\uA7A0</span><span class="s4">-</span><span class="s3">\uA7AA\uA7F8</span><span class="s4">-</span><span class="s3">\uA801\uA803</span><span class="s4">-</span><span class="s3">\uA805\uA807</span><span class="s4">-</span><span class="s3">\uA80A\uA80C</span><span class="s4">-</span><span class="s3">\uA822\uA840</span><span class="s4">-</span><span class="s3">\uA873\uA882</span><span class="s4">-</span><span class="s3">\uA8B3\uA8F2</span><span class="s4">-</span><span class="s3">\uA8F7\uA8FB\uA90A</span><span class="s4">-</span><span class="s3">\uA925\uA930</span><span class="s4">-</span><span class="s3">\uA946\uA960</span><span class="s4">-</span><span class="s3">\uA97C\uA984</span><span class="s4">-</span><span class="s3">\uA9B2\uA9CF\uAA00</span><span class="s4">-</span><span class="s3">\uAA28\uAA40</span><span class="s4">-</span><span class="s3">\uAA42\uAA44</span><span class="s4">-</span><span class="s3">\uAA4B\uAA60</span><span class="s4">-</span><span class="s3">\uAA76\uAA7A\uAA80</span><span class="s4">-</span><span class="s3">\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9</span><span class="s4">-</span><span class="s3">\uAABD\uAAC0\uAAC2\uAADB</span><span class="s4">-</span><span class="s3">\uAADD\uAAE0</span><span class="s4">-</span><span class="s3">\uAAEA\uAAF2</span><span class="s4">-</span><span class="s3">\uAAF4\uAB01</span><span class="s4">-</span><span class="s3">\uAB06\uAB09</span><span class="s4">-</span><span class="s3">\uAB0E\uAB11</span><span class="s4">-</span><span class="s3">\uAB16\uAB20</span><span class="s4">-</span><span class="s3">\uAB26\uAB28</span><span class="s4">-</span><span class="s3">\uAB2E\uABC0</span><span class="s4">-</span><span class="s3">\uABE2\uAC00</span><span class="s4">-</span><span class="s3">\uD7A3\uD7B0</span><span class="s4">-</span><span class="s3">\uD7C6\uD7CB</span><span class="s4">-</span><span class="s3">\uD7FB\uF900</span><span class="s4">-</span><span class="s3">\uFA6D\uFA70</span><span class="s4">-</span><span class="s3">\uFAD9\uFB00</span><span class="s4">-</span><span class="s3">\uFB06\uFB13</span><span class="s4">-</span><span class="s3">\uFB17\uFB1D\uFB1F</span><span class="s4">-</span><span class="s3">\uFB28\uFB2A</span><span class="s4">-</span><span class="s3">\uFB36\uFB38</span><span class="s4">-</span><span class="s3">\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46</span><span class="s4">-</span><span class="s3">\uFBB1\uFBD3</span><span class="s4">-</span><span class="s3">\uFD3D\uFD50</span><span class="s4">-</span><span class="s3">\uFD8F\uFD92</span><span class="s4">-</span><span class="s3">\uFDC7\uFDF0</span><span class="s4">-</span><span class="s3">\uFDFB\uFE70</span><span class="s4">-</span><span class="s3">\uFE74\uFE76</span><span class="s4">-</span><span class="s3">\uFEFC\uFF21</span><span class="s4">-</span><span class="s3">\uFF3A\uFF41</span><span class="s4">-</span><span class="s3">\uFF5A\uFF66</span><span class="s4">-</span><span class="s3">\uFFBE\uFFC2</span><span class="s4">-</span><span class="s3">\uFFC7\uFFCA</span><span class="s4">-</span><span class="s3">\uFFCF\uFFD2</span><span class="s4">-</span><span class="s3">\uFFD7\uFFDA</span><span class="s4">-</span><span class="s3">\uFFDC</span><span class="s4">]'</span><span class="s2">),</span>
        <span class="s1">NonAsciiIdentifierPart</span><span class="s2">: </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'[</span><span class="s3">\xAA\xB5\xBA\xC0</span><span class="s4">-</span><span class="s3">\xD6\xD8</span><span class="s4">-</span><span class="s3">\xF6\xF8</span><span class="s4">-</span><span class="s3">\u02C1\u02C6</span><span class="s4">-</span><span class="s3">\u02D1\u02E0</span><span class="s4">-</span><span class="s3">\u02E4\u02EC\u02EE\u0300</span><span class="s4">-</span><span class="s3">\u0374\u0376\u0377\u037A</span><span class="s4">-</span><span class="s3">\u037D\u0386\u0388</span><span class="s4">-</span><span class="s3">\u038A\u038C\u038E</span><span class="s4">-</span><span class="s3">\u03A1\u03A3</span><span class="s4">-</span><span class="s3">\u03F5\u03F7</span><span class="s4">-</span><span class="s3">\u0481\u0483</span><span class="s4">-</span><span class="s3">\u0487\u048A</span><span class="s4">-</span><span class="s3">\u0527\u0531</span><span class="s4">-</span><span class="s3">\u0556\u0559\u0561</span><span class="s4">-</span><span class="s3">\u0587\u0591</span><span class="s4">-</span><span class="s3">\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0</span><span class="s4">-</span><span class="s3">\u05EA\u05F0</span><span class="s4">-</span><span class="s3">\u05F2\u0610</span><span class="s4">-</span><span class="s3">\u061A\u0620</span><span class="s4">-</span><span class="s3">\u0669\u066E</span><span class="s4">-</span><span class="s3">\u06D3\u06D5</span><span class="s4">-</span><span class="s3">\u06DC\u06DF</span><span class="s4">-</span><span class="s3">\u06E8\u06EA</span><span class="s4">-</span><span class="s3">\u06FC\u06FF\u0710</span><span class="s4">-</span><span class="s3">\u074A\u074D</span><span class="s4">-</span><span class="s3">\u07B1\u07C0</span><span class="s4">-</span><span class="s3">\u07F5\u07FA\u0800</span><span class="s4">-</span><span class="s3">\u082D\u0840</span><span class="s4">-</span><span class="s3">\u085B\u08A0\u08A2</span><span class="s4">-</span><span class="s3">\u08AC\u08E4</span><span class="s4">-</span><span class="s3">\u08FE\u0900</span><span class="s4">-</span><span class="s3">\u0963\u0966</span><span class="s4">-</span><span class="s3">\u096F\u0971</span><span class="s4">-</span><span class="s3">\u0977\u0979</span><span class="s4">-</span><span class="s3">\u097F\u0981</span><span class="s4">-</span><span class="s3">\u0983\u0985</span><span class="s4">-</span><span class="s3">\u098C\u098F\u0990\u0993</span><span class="s4">-</span><span class="s3">\u09A8\u09AA</span><span class="s4">-</span><span class="s3">\u09B0\u09B2\u09B6</span><span class="s4">-</span><span class="s3">\u09B9\u09BC</span><span class="s4">-</span><span class="s3">\u09C4\u09C7\u09C8\u09CB</span><span class="s4">-</span><span class="s3">\u09CE\u09D7\u09DC\u09DD\u09DF</span><span class="s4">-</span><span class="s3">\u09E3\u09E6</span><span class="s4">-</span><span class="s3">\u09F1\u0A01</span><span class="s4">-</span><span class="s3">\u0A03\u0A05</span><span class="s4">-</span><span class="s3">\u0A0A\u0A0F\u0A10\u0A13</span><span class="s4">-</span><span class="s3">\u0A28\u0A2A</span><span class="s4">-</span><span class="s3">\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E</span><span class="s4">-</span><span class="s3">\u0A42\u0A47\u0A48\u0A4B</span><span class="s4">-</span><span class="s3">\u0A4D\u0A51\u0A59</span><span class="s4">-</span><span class="s3">\u0A5C\u0A5E\u0A66</span><span class="s4">-</span><span class="s3">\u0A75\u0A81</span><span class="s4">-</span><span class="s3">\u0A83\u0A85</span><span class="s4">-</span><span class="s3">\u0A8D\u0A8F</span><span class="s4">-</span><span class="s3">\u0A91\u0A93</span><span class="s4">-</span><span class="s3">\u0AA8\u0AAA</span><span class="s4">-</span><span class="s3">\u0AB0\u0AB2\u0AB3\u0AB5</span><span class="s4">-</span><span class="s3">\u0AB9\u0ABC</span><span class="s4">-</span><span class="s3">\u0AC5\u0AC7</span><span class="s4">-</span><span class="s3">\u0AC9\u0ACB</span><span class="s4">-</span><span class="s3">\u0ACD\u0AD0\u0AE0</span><span class="s4">-</span><span class="s3">\u0AE3\u0AE6</span><span class="s4">-</span><span class="s3">\u0AEF\u0B01</span><span class="s4">-</span><span class="s3">\u0B03\u0B05</span><span class="s4">-</span><span class="s3">\u0B0C\u0B0F\u0B10\u0B13</span><span class="s4">-</span><span class="s3">\u0B28\u0B2A</span><span class="s4">-</span><span class="s3">\u0B30\u0B32\u0B33\u0B35</span><span class="s4">-</span><span class="s3">\u0B39\u0B3C</span><span class="s4">-</span><span class="s3">\u0B44\u0B47\u0B48\u0B4B</span><span class="s4">-</span><span class="s3">\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F</span><span class="s4">-</span><span class="s3">\u0B63\u0B66</span><span class="s4">-</span><span class="s3">\u0B6F\u0B71\u0B82\u0B83\u0B85</span><span class="s4">-</span><span class="s3">\u0B8A\u0B8E</span><span class="s4">-</span><span class="s3">\u0B90\u0B92</span><span class="s4">-</span><span class="s3">\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8</span><span class="s4">-</span><span class="s3">\u0BAA\u0BAE</span><span class="s4">-</span><span class="s3">\u0BB9\u0BBE</span><span class="s4">-</span><span class="s3">\u0BC2\u0BC6</span><span class="s4">-</span><span class="s3">\u0BC8\u0BCA</span><span class="s4">-</span><span class="s3">\u0BCD\u0BD0\u0BD7\u0BE6</span><span class="s4">-</span><span class="s3">\u0BEF\u0C01</span><span class="s4">-</span><span class="s3">\u0C03\u0C05</span><span class="s4">-</span><span class="s3">\u0C0C\u0C0E</span><span class="s4">-</span><span class="s3">\u0C10\u0C12</span><span class="s4">-</span><span class="s3">\u0C28\u0C2A</span><span class="s4">-</span><span class="s3">\u0C33\u0C35</span><span class="s4">-</span><span class="s3">\u0C39\u0C3D</span><span class="s4">-</span><span class="s3">\u0C44\u0C46</span><span class="s4">-</span><span class="s3">\u0C48\u0C4A</span><span class="s4">-</span><span class="s3">\u0C4D\u0C55\u0C56\u0C58\u0C59\u0C60</span><span class="s4">-</span><span class="s3">\u0C63\u0C66</span><span class="s4">-</span><span class="s3">\u0C6F\u0C82\u0C83\u0C85</span><span class="s4">-</span><span class="s3">\u0C8C\u0C8E</span><span class="s4">-</span><span class="s3">\u0C90\u0C92</span><span class="s4">-</span><span class="s3">\u0CA8\u0CAA</span><span class="s4">-</span><span class="s3">\u0CB3\u0CB5</span><span class="s4">-</span><span class="s3">\u0CB9\u0CBC</span><span class="s4">-</span><span class="s3">\u0CC4\u0CC6</span><span class="s4">-</span><span class="s3">\u0CC8\u0CCA</span><span class="s4">-</span><span class="s3">\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0</span><span class="s4">-</span><span class="s3">\u0CE3\u0CE6</span><span class="s4">-</span><span class="s3">\u0CEF\u0CF1\u0CF2\u0D02\u0D03\u0D05</span><span class="s4">-</span><span class="s3">\u0D0C\u0D0E</span><span class="s4">-</span><span class="s3">\u0D10\u0D12</span><span class="s4">-</span><span class="s3">\u0D3A\u0D3D</span><span class="s4">-</span><span class="s3">\u0D44\u0D46</span><span class="s4">-</span><span class="s3">\u0D48\u0D4A</span><span class="s4">-</span><span class="s3">\u0D4E\u0D57\u0D60</span><span class="s4">-</span><span class="s3">\u0D63\u0D66</span><span class="s4">-</span><span class="s3">\u0D6F\u0D7A</span><span class="s4">-</span><span class="s3">\u0D7F\u0D82\u0D83\u0D85</span><span class="s4">-</span><span class="s3">\u0D96\u0D9A</span><span class="s4">-</span><span class="s3">\u0DB1\u0DB3</span><span class="s4">-</span><span class="s3">\u0DBB\u0DBD\u0DC0</span><span class="s4">-</span><span class="s3">\u0DC6\u0DCA\u0DCF</span><span class="s4">-</span><span class="s3">\u0DD4\u0DD6\u0DD8</span><span class="s4">-</span><span class="s3">\u0DDF\u0DF2\u0DF3\u0E01</span><span class="s4">-</span><span class="s3">\u0E3A\u0E40</span><span class="s4">-</span><span class="s3">\u0E4E\u0E50</span><span class="s4">-</span><span class="s3">\u0E59\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94</span><span class="s4">-</span><span class="s3">\u0E97\u0E99</span><span class="s4">-</span><span class="s3">\u0E9F\u0EA1</span><span class="s4">-</span><span class="s3">\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD</span><span class="s4">-</span><span class="s3">\u0EB9\u0EBB</span><span class="s4">-</span><span class="s3">\u0EBD\u0EC0</span><span class="s4">-</span><span class="s3">\u0EC4\u0EC6\u0EC8</span><span class="s4">-</span><span class="s3">\u0ECD\u0ED0</span><span class="s4">-</span><span class="s3">\u0ED9\u0EDC</span><span class="s4">-</span><span class="s3">\u0EDF\u0F00\u0F18\u0F19\u0F20</span><span class="s4">-</span><span class="s3">\u0F29\u0F35\u0F37\u0F39\u0F3E</span><span class="s4">-</span><span class="s3">\u0F47\u0F49</span><span class="s4">-</span><span class="s3">\u0F6C\u0F71</span><span class="s4">-</span><span class="s3">\u0F84\u0F86</span><span class="s4">-</span><span class="s3">\u0F97\u0F99</span><span class="s4">-</span><span class="s3">\u0FBC\u0FC6\u1000</span><span class="s4">-</span><span class="s3">\u1049\u1050</span><span class="s4">-</span><span class="s3">\u109D\u10A0</span><span class="s4">-</span><span class="s3">\u10C5\u10C7\u10CD\u10D0</span><span class="s4">-</span><span class="s3">\u10FA\u10FC</span><span class="s4">-</span><span class="s3">\u1248\u124A</span><span class="s4">-</span><span class="s3">\u124D\u1250</span><span class="s4">-</span><span class="s3">\u1256\u1258\u125A</span><span class="s4">-</span><span class="s3">\u125D\u1260</span><span class="s4">-</span><span class="s3">\u1288\u128A</span><span class="s4">-</span><span class="s3">\u128D\u1290</span><span class="s4">-</span><span class="s3">\u12B0\u12B2</span><span class="s4">-</span><span class="s3">\u12B5\u12B8</span><span class="s4">-</span><span class="s3">\u12BE\u12C0\u12C2</span><span class="s4">-</span><span class="s3">\u12C5\u12C8</span><span class="s4">-</span><span class="s3">\u12D6\u12D8</span><span class="s4">-</span><span class="s3">\u1310\u1312</span><span class="s4">-</span><span class="s3">\u1315\u1318</span><span class="s4">-</span><span class="s3">\u135A\u135D</span><span class="s4">-</span><span class="s3">\u135F\u1380</span><span class="s4">-</span><span class="s3">\u138F\u13A0</span><span class="s4">-</span><span class="s3">\u13F4\u1401</span><span class="s4">-</span><span class="s3">\u166C\u166F</span><span class="s4">-</span><span class="s3">\u167F\u1681</span><span class="s4">-</span><span class="s3">\u169A\u16A0</span><span class="s4">-</span><span class="s3">\u16EA\u16EE</span><span class="s4">-</span><span class="s3">\u16F0\u1700</span><span class="s4">-</span><span class="s3">\u170C\u170E</span><span class="s4">-</span><span class="s3">\u1714\u1720</span><span class="s4">-</span><span class="s3">\u1734\u1740</span><span class="s4">-</span><span class="s3">\u1753\u1760</span><span class="s4">-</span><span class="s3">\u176C\u176E</span><span class="s4">-</span><span class="s3">\u1770\u1772\u1773\u1780</span><span class="s4">-</span><span class="s3">\u17D3\u17D7\u17DC\u17DD\u17E0</span><span class="s4">-</span><span class="s3">\u17E9\u180B</span><span class="s4">-</span><span class="s3">\u180D\u1810</span><span class="s4">-</span><span class="s3">\u1819\u1820</span><span class="s4">-</span><span class="s3">\u1877\u1880</span><span class="s4">-</span><span class="s3">\u18AA\u18B0</span><span class="s4">-</span><span class="s3">\u18F5\u1900</span><span class="s4">-</span><span class="s3">\u191C\u1920</span><span class="s4">-</span><span class="s3">\u192B\u1930</span><span class="s4">-</span><span class="s3">\u193B\u1946</span><span class="s4">-</span><span class="s3">\u196D\u1970</span><span class="s4">-</span><span class="s3">\u1974\u1980</span><span class="s4">-</span><span class="s3">\u19AB\u19B0</span><span class="s4">-</span><span class="s3">\u19C9\u19D0</span><span class="s4">-</span><span class="s3">\u19D9\u1A00</span><span class="s4">-</span><span class="s3">\u1A1B\u1A20</span><span class="s4">-</span><span class="s3">\u1A5E\u1A60</span><span class="s4">-</span><span class="s3">\u1A7C\u1A7F</span><span class="s4">-</span><span class="s3">\u1A89\u1A90</span><span class="s4">-</span><span class="s3">\u1A99\u1AA7\u1B00</span><span class="s4">-</span><span class="s3">\u1B4B\u1B50</span><span class="s4">-</span><span class="s3">\u1B59\u1B6B</span><span class="s4">-</span><span class="s3">\u1B73\u1B80</span><span class="s4">-</span><span class="s3">\u1BF3\u1C00</span><span class="s4">-</span><span class="s3">\u1C37\u1C40</span><span class="s4">-</span><span class="s3">\u1C49\u1C4D</span><span class="s4">-</span><span class="s3">\u1C7D\u1CD0</span><span class="s4">-</span><span class="s3">\u1CD2\u1CD4</span><span class="s4">-</span><span class="s3">\u1CF6\u1D00</span><span class="s4">-</span><span class="s3">\u1DE6\u1DFC</span><span class="s4">-</span><span class="s3">\u1F15\u1F18</span><span class="s4">-</span><span class="s3">\u1F1D\u1F20</span><span class="s4">-</span><span class="s3">\u1F45\u1F48</span><span class="s4">-</span><span class="s3">\u1F4D\u1F50</span><span class="s4">-</span><span class="s3">\u1F57\u1F59\u1F5B\u1F5D\u1F5F</span><span class="s4">-</span><span class="s3">\u1F7D\u1F80</span><span class="s4">-</span><span class="s3">\u1FB4\u1FB6</span><span class="s4">-</span><span class="s3">\u1FBC\u1FBE\u1FC2</span><span class="s4">-</span><span class="s3">\u1FC4\u1FC6</span><span class="s4">-</span><span class="s3">\u1FCC\u1FD0</span><span class="s4">-</span><span class="s3">\u1FD3\u1FD6</span><span class="s4">-</span><span class="s3">\u1FDB\u1FE0</span><span class="s4">-</span><span class="s3">\u1FEC\u1FF2</span><span class="s4">-</span><span class="s3">\u1FF4\u1FF6</span><span class="s4">-</span><span class="s3">\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090</span><span class="s4">-</span><span class="s3">\u209C\u20D0</span><span class="s4">-</span><span class="s3">\u20DC\u20E1\u20E5</span><span class="s4">-</span><span class="s3">\u20F0\u2102\u2107\u210A</span><span class="s4">-</span><span class="s3">\u2113\u2115\u2119</span><span class="s4">-</span><span class="s3">\u211D\u2124\u2126\u2128\u212A</span><span class="s4">-</span><span class="s3">\u212D\u212F</span><span class="s4">-</span><span class="s3">\u2139\u213C</span><span class="s4">-</span><span class="s3">\u213F\u2145</span><span class="s4">-</span><span class="s3">\u2149\u214E\u2160</span><span class="s4">-</span><span class="s3">\u2188\u2C00</span><span class="s4">-</span><span class="s3">\u2C2E\u2C30</span><span class="s4">-</span><span class="s3">\u2C5E\u2C60</span><span class="s4">-</span><span class="s3">\u2CE4\u2CEB</span><span class="s4">-</span><span class="s3">\u2CF3\u2D00</span><span class="s4">-</span><span class="s3">\u2D25\u2D27\u2D2D\u2D30</span><span class="s4">-</span><span class="s3">\u2D67\u2D6F\u2D7F</span><span class="s4">-</span><span class="s3">\u2D96\u2DA0</span><span class="s4">-</span><span class="s3">\u2DA6\u2DA8</span><span class="s4">-</span><span class="s3">\u2DAE\u2DB0</span><span class="s4">-</span><span class="s3">\u2DB6\u2DB8</span><span class="s4">-</span><span class="s3">\u2DBE\u2DC0</span><span class="s4">-</span><span class="s3">\u2DC6\u2DC8</span><span class="s4">-</span><span class="s3">\u2DCE\u2DD0</span><span class="s4">-</span><span class="s3">\u2DD6\u2DD8</span><span class="s4">-</span><span class="s3">\u2DDE\u2DE0</span><span class="s4">-</span><span class="s3">\u2DFF\u2E2F\u3005</span><span class="s4">-</span><span class="s3">\u3007\u3021</span><span class="s4">-</span><span class="s3">\u302F\u3031</span><span class="s4">-</span><span class="s3">\u3035\u3038</span><span class="s4">-</span><span class="s3">\u303C\u3041</span><span class="s4">-</span><span class="s3">\u3096\u3099\u309A\u309D</span><span class="s4">-</span><span class="s3">\u309F\u30A1</span><span class="s4">-</span><span class="s3">\u30FA\u30FC</span><span class="s4">-</span><span class="s3">\u30FF\u3105</span><span class="s4">-</span><span class="s3">\u312D\u3131</span><span class="s4">-</span><span class="s3">\u318E\u31A0</span><span class="s4">-</span><span class="s3">\u31BA\u31F0</span><span class="s4">-</span><span class="s3">\u31FF\u3400</span><span class="s4">-</span><span class="s3">\u4DB5\u4E00</span><span class="s4">-</span><span class="s3">\u9FCC\uA000</span><span class="s4">-</span><span class="s3">\uA48C\uA4D0</span><span class="s4">-</span><span class="s3">\uA4FD\uA500</span><span class="s4">-</span><span class="s3">\uA60C\uA610</span><span class="s4">-</span><span class="s3">\uA62B\uA640</span><span class="s4">-</span><span class="s3">\uA66F\uA674</span><span class="s4">-</span><span class="s3">\uA67D\uA67F</span><span class="s4">-</span><span class="s3">\uA697\uA69F</span><span class="s4">-</span><span class="s3">\uA6F1\uA717</span><span class="s4">-</span><span class="s3">\uA71F\uA722</span><span class="s4">-</span><span class="s3">\uA788\uA78B</span><span class="s4">-</span><span class="s3">\uA78E\uA790</span><span class="s4">-</span><span class="s3">\uA793\uA7A0</span><span class="s4">-</span><span class="s3">\uA7AA\uA7F8</span><span class="s4">-</span><span class="s3">\uA827\uA840</span><span class="s4">-</span><span class="s3">\uA873\uA880</span><span class="s4">-</span><span class="s3">\uA8C4\uA8D0</span><span class="s4">-</span><span class="s3">\uA8D9\uA8E0</span><span class="s4">-</span><span class="s3">\uA8F7\uA8FB\uA900</span><span class="s4">-</span><span class="s3">\uA92D\uA930</span><span class="s4">-</span><span class="s3">\uA953\uA960</span><span class="s4">-</span><span class="s3">\uA97C\uA980</span><span class="s4">-</span><span class="s3">\uA9C0\uA9CF</span><span class="s4">-</span><span class="s3">\uA9D9\uAA00</span><span class="s4">-</span><span class="s3">\uAA36\uAA40</span><span class="s4">-</span><span class="s3">\uAA4D\uAA50</span><span class="s4">-</span><span class="s3">\uAA59\uAA60</span><span class="s4">-</span><span class="s3">\uAA76\uAA7A\uAA7B\uAA80</span><span class="s4">-</span><span class="s3">\uAAC2\uAADB</span><span class="s4">-</span><span class="s3">\uAADD\uAAE0</span><span class="s4">-</span><span class="s3">\uAAEF\uAAF2</span><span class="s4">-</span><span class="s3">\uAAF6\uAB01</span><span class="s4">-</span><span class="s3">\uAB06\uAB09</span><span class="s4">-</span><span class="s3">\uAB0E\uAB11</span><span class="s4">-</span><span class="s3">\uAB16\uAB20</span><span class="s4">-</span><span class="s3">\uAB26\uAB28</span><span class="s4">-</span><span class="s3">\uAB2E\uABC0</span><span class="s4">-</span><span class="s3">\uABEA\uABEC\uABED\uABF0</span><span class="s4">-</span><span class="s3">\uABF9\uAC00</span><span class="s4">-</span><span class="s3">\uD7A3\uD7B0</span><span class="s4">-</span><span class="s3">\uD7C6\uD7CB</span><span class="s4">-</span><span class="s3">\uD7FB\uF900</span><span class="s4">-</span><span class="s3">\uFA6D\uFA70</span><span class="s4">-</span><span class="s3">\uFAD9\uFB00</span><span class="s4">-</span><span class="s3">\uFB06\uFB13</span><span class="s4">-</span><span class="s3">\uFB17\uFB1D</span><span class="s4">-</span><span class="s3">\uFB28\uFB2A</span><span class="s4">-</span><span class="s3">\uFB36\uFB38</span><span class="s4">-</span><span class="s3">\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46</span><span class="s4">-</span><span class="s3">\uFBB1\uFBD3</span><span class="s4">-</span><span class="s3">\uFD3D\uFD50</span><span class="s4">-</span><span class="s3">\uFD8F\uFD92</span><span class="s4">-</span><span class="s3">\uFDC7\uFDF0</span><span class="s4">-</span><span class="s3">\uFDFB\uFE00</span><span class="s4">-</span><span class="s3">\uFE0F\uFE20</span><span class="s4">-</span><span class="s3">\uFE26\uFE33\uFE34\uFE4D</span><span class="s4">-</span><span class="s3">\uFE4F\uFE70</span><span class="s4">-</span><span class="s3">\uFE74\uFE76</span><span class="s4">-</span><span class="s3">\uFEFC\uFF10</span><span class="s4">-</span><span class="s3">\uFF19\uFF21</span><span class="s4">-</span><span class="s3">\uFF3A\uFF3F\uFF41</span><span class="s4">-</span><span class="s3">\uFF5A\uFF66</span><span class="s4">-</span><span class="s3">\uFFBE\uFFC2</span><span class="s4">-</span><span class="s3">\uFFC7\uFFCA</span><span class="s4">-</span><span class="s3">\uFFCF\uFFD2</span><span class="s4">-</span><span class="s3">\uFFD7\uFFDA</span><span class="s4">-</span><span class="s3">\uFFDC</span><span class="s4">]'</span><span class="s2">)</span>
    <span class="s2">};</span>

    <span class="s0">// Ensure the condition is true, otherwise throw an error.</span>
    <span class="s0">// This is only to have a better contract semantic, i.e. another safety net</span>
    <span class="s0">// to catch a logic error. The condition shall be fulfilled in normal case.</span>
    <span class="s0">// Do NOT use this to enforce a certain condition on any user input.</span>

    <span class="s3">function </span><span class="s1">assert</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
        <span class="s0">/* istanbul ignore if */</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">condition</span><span class="s2">) {</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'ASSERT: ' </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">48 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">57</span><span class="s2">);   </span><span class="s0">// 0..9</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s4">'0123456789abcdefABCDEF'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 7.2 White Space</span>

    <span class="s3">function </span><span class="s1">isWhiteSpace</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x20</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x09</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0B</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0C</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0xA0</span><span class="s2">) ||</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x1680 </span><span class="s2">&amp;&amp; [</span><span class="s5">0x1680</span><span class="s2">, </span><span class="s5">0x180E</span><span class="s2">, </span><span class="s5">0x2000</span><span class="s2">, </span><span class="s5">0x2001</span><span class="s2">, </span><span class="s5">0x2002</span><span class="s2">, </span><span class="s5">0x2003</span><span class="s2">, </span><span class="s5">0x2004</span><span class="s2">, </span><span class="s5">0x2005</span><span class="s2">, </span><span class="s5">0x2006</span><span class="s2">, </span><span class="s5">0x2007</span><span class="s2">, </span><span class="s5">0x2008</span><span class="s2">, </span><span class="s5">0x2009</span><span class="s2">, </span><span class="s5">0x200A</span><span class="s2">, </span><span class="s5">0x202F</span><span class="s2">, </span><span class="s5">0x205F</span><span class="s2">, </span><span class="s5">0x3000</span><span class="s2">, </span><span class="s5">0xFEFF</span><span class="s2">].</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.3 Line Terminators</span>

    <span class="s3">function </span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0A</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2028</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2029</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6 Identifier Names and Identifiers</span>

    <span class="s3">function </span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">== </span><span class="s5">0x40</span><span class="s2">) ||  (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x24</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5F</span><span class="s2">) ||  </span><span class="s0">// $ (dollar) and _ (underscore)</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x41 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x5A</span><span class="s2">) ||         </span><span class="s0">// A..Z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x61 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x7A</span><span class="s2">) ||         </span><span class="s0">// a..z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) ||                      </span><span class="s0">// \ (backslash)</span>
            <span class="s2">((</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x80</span><span class="s2">) &amp;&amp; </span><span class="s1">Regex</span><span class="s2">.</span><span class="s1">NonAsciiIdentifierStart</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)));</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x24</span><span class="s2">) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5F</span><span class="s2">) ||  </span><span class="s0">// $ (dollar) and _ (underscore)</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x41 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x5A</span><span class="s2">) ||         </span><span class="s0">// A..Z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x61 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x7A</span><span class="s2">) ||         </span><span class="s0">// a..z</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x30 </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">&lt;= </span><span class="s5">0x39</span><span class="s2">) ||         </span><span class="s0">// 0..9</span>
            <span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) ||                      </span><span class="s0">// \ (backslash)</span>
            <span class="s2">((</span><span class="s1">ch </span><span class="s2">&gt;= </span><span class="s5">0x80</span><span class="s2">) &amp;&amp; </span><span class="s1">Regex</span><span class="s2">.</span><span class="s1">NonAsciiIdentifierPart</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)));</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6.1.2 Future Reserved Words</span>

    <span class="s3">function </span><span class="s1">isFutureReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'class'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'enum'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'export'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'extends'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'import'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'super'</span><span class="s2">:</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'implements'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'interface'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'package'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'private'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'protected'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'public'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'static'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'yield'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'let'</span><span class="s2">:</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'eval' </span><span class="s2">|| </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'arguments'</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 7.6.1.1 Keywords</span>

    <span class="s3">function </span><span class="s1">isKeyword</span><span class="s2">(</span><span class="s1">id</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)) {</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s0">// 'const' is specialized as Keyword in V8.</span>
        <span class="s0">// 'yield' and 'let' are for compatiblity with SpiderMonkey and ES.next.</span>
        <span class="s0">// Some others are from future reserved words.</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'if'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'in'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'do'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">3</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'var'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'for'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'new'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'try'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'let'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">4</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'this'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'else'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'case'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'void'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'with'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'enum'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">5</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'while'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'break'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'catch'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'throw'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'const'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'yield'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'class'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'super'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">6</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'return'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'typeof'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'delete'</span><span class="s2">) ||</span>
                <span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'switch'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'export'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'import'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">7</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'default'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'finally'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'extends'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">8</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'continue'</span><span class="s2">) || (</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'debugger'</span><span class="s2">);</span>
        <span class="s3">case </span><span class="s5">10</span><span class="s2">:</span>
            <span class="s3">return </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'instanceof'</span><span class="s2">);</span>
        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// 7.4 Comments</span>

    <span class="s3">function </span><span class="s1">addComment</span><span class="s2">(</span><span class="s1">type</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">attacher</span><span class="s2">;</span>

        <span class="s1">assert</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">start </span><span class="s2">=== </span><span class="s4">'number'</span><span class="s2">, </span><span class="s4">'Comment must have valid position'</span><span class="s2">);</span>

        <span class="s0">// Because the way the actual token is scanned, often the comments</span>
        <span class="s0">// (if any) are skipped twice during the lexical analysis.</span>
        <span class="s0">// Thus, we need to skip adding a comment if the comment array already</span>
        <span class="s0">// handled it.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">lastCommentStart </span><span class="s2">&gt;= </span><span class="s1">start</span><span class="s2">) {</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">lastCommentStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">comment </span><span class="s2">= {</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span>
        <span class="s2">};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
            <span class="s1">comment</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
            <span class="s1">comment</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s1">loc</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">comment</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s1">offset</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s1">offset</span><span class="s2">;</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s1">offset</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
                    <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
                    <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                        <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s5">1</span>
                    <span class="s2">};</span>
                    <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Line'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">1</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">13 </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">10</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">return</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
            <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s1">offset</span><span class="s2">, </span><span class="s1">index</span><span class="s2">);</span>
            <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">};</span>
            <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Line'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipMultiLineComment</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
            <span class="s1">start </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s1">loc </span><span class="s2">= {</span>
                <span class="s1">start</span><span class="s2">: {</span>
                    <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                    <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">- </span><span class="s5">2</span>
                <span class="s2">}</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x0A</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt;= </span><span class="s1">length</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2A</span><span class="s2">) {</span>
                <span class="s0">// Block comment ends with '*/'.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x2F</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">) {</span>
                        <span class="s1">comment </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">, </span><span class="s1">index </span><span class="s2">- </span><span class="s5">2</span><span class="s2">);</span>
                        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
                            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
                        <span class="s2">};</span>
                        <span class="s1">addComment</span><span class="s2">(</span><span class="s4">'Block'</span><span class="s2">, </span><span class="s1">comment</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">);</span>
                    <span class="s2">}</span>
                    <span class="s3">return</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">skipComment</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= (</span><span class="s1">index </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">);</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">isWhiteSpace</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x0D </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x0A</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">start </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) { </span><span class="s0">// U+002F is '/'</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">2</span><span class="s2">);</span>
                    <span class="s1">start </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2A</span><span class="s2">) {  </span><span class="s0">// U+002A is '*'</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">skipMultiLineComment</span><span class="s2">();</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">start </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2D</span><span class="s2">) { </span><span class="s0">// U+002D is '-'</span>
                <span class="s0">// U+003E is '&gt;'</span>
                <span class="s3">if </span><span class="s2">((</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) === </span><span class="s5">0x2D</span><span class="s2">) &amp;&amp; (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">2</span><span class="s2">) === </span><span class="s5">0x3E</span><span class="s2">)) {</span>
                    <span class="s0">// '--&gt;' is a single-line comment</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">3</span><span class="s2">;</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">3</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x3C</span><span class="s2">) { </span><span class="s0">// U+003C is '&lt;'</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">index </span><span class="s2">+ </span><span class="s5">4</span><span class="s2">) === </span><span class="s4">'!--'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `&lt;`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `!`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `-`</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">; </span><span class="s0">// `-`</span>
                    <span class="s1">skipSingleLineComment</span><span class="s2">(</span><span class="s5">4</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s1">prefix</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">i</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">code </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>

        <span class="s1">len </span><span class="s2">= (</span><span class="s1">prefix </span><span class="s2">=== </span><span class="s4">'u'</span><span class="s2">) ? </span><span class="s5">4 </span><span class="s2">: </span><span class="s5">2</span><span class="s2">;</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">16 </span><span class="s2">+ </span><span class="s4">'0123456789abcdef'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">toLowerCase</span><span class="s2">());</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">return </span><span class="s4">''</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">getEscapedIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">id</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">++);</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

        <span class="s0">// '\u' (U+005C, U+0075) denotes an escaped character.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) !== </span><span class="s5">0x75</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">|| !</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">id </span><span class="s2">= </span><span class="s1">ch</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">id </span><span class="s2">+= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

            <span class="s0">// '\u' (U+005C, U+0075) denotes an escaped character.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
                <span class="s1">id </span><span class="s2">= </span><span class="s1">id</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">id</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) !== </span><span class="s5">0x75</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">|| !</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">id </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">id</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">getIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">++;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x5C</span><span class="s2">) {</span>
                <span class="s0">// Blackslash (U+005C) marks Unicode escape sequence.</span>
                <span class="s1">index </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>
                <span class="s3">return </span><span class="s1">getEscapedIdentifier</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">type</span><span class="s2">;</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>

        <span class="s0">// Backslash (U+005C) starts an escaped character.</span>
        <span class="s1">id </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x5C</span><span class="s2">) ? </span><span class="s1">getEscapedIdentifier</span><span class="s2">() : </span><span class="s1">getIdentifier</span><span class="s2">();</span>

        <span class="s0">// There is no keyword or literal with only one character.</span>
        <span class="s0">// Thus, it must be an identifier.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isKeyword</span><span class="s2">(</span><span class="s1">id</span><span class="s2">)) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'null'</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'true' </span><span class="s2">|| </span><span class="s1">id </span><span class="s2">=== </span><span class="s4">'false'</span><span class="s2">) {</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">type </span><span class="s2">= </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>


    <span class="s0">// 7.7 Punctuators</span>

    <span class="s3">function </span><span class="s1">scanPunctuator</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">,</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">),</span>
            <span class="s1">code2</span><span class="s2">,</span>
            <span class="s1">ch1 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">],</span>
            <span class="s1">ch2</span><span class="s2">,</span>
            <span class="s1">ch3</span><span class="s2">,</span>
            <span class="s1">ch4</span><span class="s2">;</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">code</span><span class="s2">) {</span>

        <span class="s0">// Check for most common single-character punctuators.</span>
        <span class="s3">case </span><span class="s5">0x2E</span><span class="s2">:  </span><span class="s0">// . dot</span>
        <span class="s3">case </span><span class="s5">0x28</span><span class="s2">:  </span><span class="s0">// ( open bracket</span>
        <span class="s3">case </span><span class="s5">0x29</span><span class="s2">:  </span><span class="s0">// ) close bracket</span>
        <span class="s3">case </span><span class="s5">0x3B</span><span class="s2">:  </span><span class="s0">// ; semicolon</span>
        <span class="s3">case </span><span class="s5">0x2C</span><span class="s2">:  </span><span class="s0">// , comma</span>
        <span class="s3">case </span><span class="s5">0x7B</span><span class="s2">:  </span><span class="s0">// { open curly brace</span>
        <span class="s3">case </span><span class="s5">0x7D</span><span class="s2">:  </span><span class="s0">// } close curly brace</span>
        <span class="s3">case </span><span class="s5">0x5B</span><span class="s2">:  </span><span class="s0">// [</span>
        <span class="s3">case </span><span class="s5">0x5D</span><span class="s2">:  </span><span class="s0">// ]</span>
        <span class="s3">case </span><span class="s5">0x3A</span><span class="s2">:  </span><span class="s0">// :</span>
        <span class="s3">case </span><span class="s5">0x3F</span><span class="s2">:  </span><span class="s0">// ?</span>
        <span class="s3">case </span><span class="s5">0x7E</span><span class="s2">:  </span><span class="s0">// ~</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">0x28</span><span class="s2">) {</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">0x7B</span><span class="s2">) {</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">),</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>

        <span class="s3">default</span><span class="s2">:</span>
            <span class="s1">code2 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>

            <span class="s0">// '=' (U+003D) marks an assignment or comparison operator.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">code2 </span><span class="s2">=== </span><span class="s5">0x3D</span><span class="s2">) {</span>
                <span class="s3">switch </span><span class="s2">(</span><span class="s1">code</span><span class="s2">) {</span>
                <span class="s3">case </span><span class="s5">0x2B</span><span class="s2">:  </span><span class="s0">// +</span>
                <span class="s3">case </span><span class="s5">0x2D</span><span class="s2">:  </span><span class="s0">// -</span>
                <span class="s3">case </span><span class="s5">0x2F</span><span class="s2">:  </span><span class="s0">// /</span>
                <span class="s3">case </span><span class="s5">0x3C</span><span class="s2">:  </span><span class="s0">// &lt;</span>
                <span class="s3">case </span><span class="s5">0x3E</span><span class="s2">:  </span><span class="s0">// &gt;</span>
                <span class="s3">case </span><span class="s5">0x5E</span><span class="s2">:  </span><span class="s0">// ^</span>
                <span class="s3">case </span><span class="s5">0x7C</span><span class="s2">:  </span><span class="s0">// |</span>
                <span class="s3">case </span><span class="s5">0x25</span><span class="s2">:  </span><span class="s0">// %</span>
                <span class="s3">case </span><span class="s5">0x26</span><span class="s2">:  </span><span class="s0">// &amp;</span>
                <span class="s3">case </span><span class="s5">0x2A</span><span class="s2">:  </span><span class="s0">// *</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>
                    <span class="s3">return </span><span class="s2">{</span>
                        <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                        <span class="s1">value</span><span class="s2">: </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">) + </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code2</span><span class="s2">),</span>
                        <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                        <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                        <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
                    <span class="s2">};</span>

                <span class="s3">case </span><span class="s5">0x21</span><span class="s2">: </span><span class="s0">// !</span>
                <span class="s3">case </span><span class="s5">0x3D</span><span class="s2">: </span><span class="s0">// =</span>
                    <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>

                    <span class="s0">// !== and ===</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3D</span><span class="s2">) {</span>
                        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s3">return </span><span class="s2">{</span>
                        <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                        <span class="s1">value</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">),</span>
                        <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                        <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                        <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                        <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
                    <span class="s2">};</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s0">// 4-character punctuator: &gt;&gt;&gt;=</span>

        <span class="s1">ch4 </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s5">4</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch4 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;='</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">4</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch4</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// 3-character punctuators: === !== &gt;&gt;&gt; &lt;&lt;= &gt;&gt;=</span>

        <span class="s1">ch3 </span><span class="s2">= </span><span class="s1">ch4</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">3</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;' </span><span class="s2">|| </span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&lt;&lt;=' </span><span class="s2">|| </span><span class="s1">ch3 </span><span class="s2">=== </span><span class="s4">'&gt;&gt;='</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">3</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch3</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// Other 2-character punctuators: ++ -- &lt;&lt; &gt;&gt; &amp;&amp; ||</span>
        <span class="s1">ch2 </span><span class="s2">= </span><span class="s1">ch3</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">2</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">((</span><span class="s1">ch1 </span><span class="s2">=== </span><span class="s1">ch2</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &amp;&amp; (</span><span class="s4">'+-&lt;&gt;&amp;|'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch1</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">)) || </span><span class="s1">ch2 </span><span class="s2">=== </span><span class="s4">'=&gt;'</span><span class="s2">) {</span>
            <span class="s1">index </span><span class="s2">+= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch2</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s0">// 1-character punctuators: &lt; &gt; = ! + - * % &amp; | ^ /</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s4">'&lt;&gt;=!+-*%&amp;|^/'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch1</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">ch1</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 7.8.3 Numeric Literals</span>

    <span class="s3">function </span><span class="s1">scanHexLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">number </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isHexDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">number</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s4">'0x' </span><span class="s2">+ </span><span class="s1">number</span><span class="s2">, </span><span class="s5">16</span><span class="s2">),</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanOctalLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">number </span><span class="s2">= </span><span class="s4">'0' </span><span class="s2">+ </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">)) || </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">number</span><span class="s2">, </span><span class="s5">8</span><span class="s2">),</span>
            <span class="s1">octal</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanNumericLiteral</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">number</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">)) || (</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">),</span>
            <span class="s4">'Numeric literal must start with a decimal digit or a decimal point'</span><span class="s2">);</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">number </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">!== </span><span class="s4">'.'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>

            <span class="s0">// Hex number starts with '0x'.</span>
            <span class="s0">// Octal number starts with '0'.</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">number </span><span class="s2">=== </span><span class="s4">'0'</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'x' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'X'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s3">return </span><span class="s1">scanHexLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                    <span class="s3">return </span><span class="s1">scanOctalLiteral</span><span class="s2">(</span><span class="s1">start</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s0">// decimal number starts with '0' such as '09' is illegal.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">&amp;&amp; </span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'e' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'E'</span><span class="s2">) {</span>
            <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'+' </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'-'</span><span class="s2">) {</span>
                <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                <span class="s3">while </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
                    <span class="s1">number </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">))) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">parseFloat</span><span class="s2">(</span><span class="s1">number</span><span class="s2">),</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s0">// 7.8.4 String Literals</span>

    <span class="s3">function </span><span class="s1">scanStringLiteral</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">str </span><span class="s2">= </span><span class="s4">''</span><span class="s2">, </span><span class="s1">quote</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">code</span><span class="s2">, </span><span class="s1">unescaped</span><span class="s2">, </span><span class="s1">restore</span><span class="s2">, </span><span class="s1">octal </span><span class="s2">= </span><span class="s3">false</span><span class="s2">, </span><span class="s1">startLineNumber</span><span class="s2">, </span><span class="s1">startLineStart</span><span class="s2">;</span>
        <span class="s1">startLineNumber </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">startLineStart </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s1">quote </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">((</span><span class="s1">quote </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">|| </span><span class="s1">quote </span><span class="s2">=== </span><span class="s4">'&quot;'</span><span class="s2">),</span>
            <span class="s4">'String literal must starts with a quote'</span><span class="s2">);</span>

        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s1">quote</span><span class="s2">) {</span>
                <span class="s1">quote </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">ch </span><span class="s2">|| !</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s3">switch </span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
                    <span class="s3">case </span><span class="s4">'u'</span><span class="s2">:</span>
                    <span class="s3">case </span><span class="s4">'x'</span><span class="s2">:</span>
                        <span class="s1">restore </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                        <span class="s1">unescaped </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s1">unescaped</span><span class="s2">) {</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">unescaped</span><span class="s2">;</span>
                        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                            <span class="s1">index </span><span class="s2">= </span><span class="s1">restore</span><span class="s2">;</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s2">}</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'n'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'r'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\r</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'t'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\t</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'b'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\b</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'f'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\f</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s3">case </span><span class="s4">'v'</span><span class="s2">:</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\x0B</span><span class="s4">'</span><span class="s2">;</span>
                        <span class="s3">break</span><span class="s2">;</span>

                    <span class="s3">default</span><span class="s2">:</span>
                        <span class="s3">if </span><span class="s2">(</span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
                            <span class="s1">code </span><span class="s2">= </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">);</span>

                            <span class="s0">// \0 is not octal escape sequence</span>
                            <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">!== </span><span class="s5">0</span><span class="s2">) {</span>
                                <span class="s1">octal </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                            <span class="s2">}</span>

                            <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                                <span class="s1">octal </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                                <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">8 </span><span class="s2">+ </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++]);</span>

                                <span class="s0">// 3 digits are only allowed when string starts</span>
                                <span class="s0">// with 0, 1, 2, 3</span>
                                <span class="s3">if </span><span class="s2">(</span><span class="s4">'0123'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) &gt;= </span><span class="s5">0 </span><span class="s2">&amp;&amp;</span>
                                        <span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length </span><span class="s2">&amp;&amp;</span>
                                        <span class="s1">isOctalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">])) {</span>
                                    <span class="s1">code </span><span class="s2">= </span><span class="s1">code </span><span class="s2">* </span><span class="s5">8 </span><span class="s2">+ </span><span class="s4">'01234567'</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++]);</span>
                                <span class="s2">}</span>
                            <span class="s2">}</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">String</span><span class="s2">.</span><span class="s1">fromCharCode</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
                        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s2">}</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s2">++</span><span class="s1">lineNumber</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">===  </span><span class="s4">'</span><span class="s3">\r</span><span class="s4">' </span><span class="s2">&amp;&amp; </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">] === </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">) {</span>
                        <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">quote </span><span class="s2">!== </span><span class="s4">''</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">str</span><span class="s2">,</span>
            <span class="s1">octal</span><span class="s2">: </span><span class="s1">octal</span><span class="s2">,</span>
            <span class="s1">startLineNumber</span><span class="s2">: </span><span class="s1">startLineNumber</span><span class="s2">,</span>
            <span class="s1">startLineStart</span><span class="s2">: </span><span class="s1">startLineStart</span><span class="s2">,</span>
            <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">testRegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">value</span><span class="s2">;</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidRegExp</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExpBody</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">classMarker</span><span class="s2">, </span><span class="s1">terminated</span><span class="s2">, </span><span class="s1">body</span><span class="s2">;</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
        <span class="s1">assert</span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">, </span><span class="s4">'Regular expression literal must start with a slash'</span><span class="s2">);</span>
        <span class="s1">str </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>

        <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">terminated </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
            <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">++];</span>
                <span class="s0">// ECMA-262 7.8.5</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isLineTerminator</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">classMarker</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">']'</span><span class="s2">) {</span>
                    <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">) {</span>
                    <span class="s1">terminated </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'['</span><span class="s2">) {</span>
                    <span class="s1">classMarker </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">terminated</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnterminatedRegExp</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// Exclude leading and trailing slash.</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">str</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">str</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExpFlags</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">restore</span><span class="s2">;</span>

        <span class="s1">str </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s1">flags </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierPart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">))) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">' </span><span class="s2">&amp;&amp; </span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s4">'u'</span><span class="s2">) {</span>
                    <span class="s2">++</span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">restore </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
                    <span class="s1">ch </span><span class="s2">= </span><span class="s1">scanHexEscape</span><span class="s2">(</span><span class="s4">'u'</span><span class="s2">);</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
                        <span class="s1">flags </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                        <span class="s3">for </span><span class="s2">(</span><span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">u'</span><span class="s2">; </span><span class="s1">restore </span><span class="s2">&lt; </span><span class="s1">index</span><span class="s2">; ++</span><span class="s1">restore</span><span class="s2">) {</span>
                            <span class="s1">str </span><span class="s2">+= </span><span class="s1">source</span><span class="s2">[</span><span class="s1">restore</span><span class="s2">];</span>
                        <span class="s2">}</span>
                    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                        <span class="s1">index </span><span class="s2">= </span><span class="s1">restore</span><span class="s2">;</span>
                        <span class="s1">flags </span><span class="s2">+= </span><span class="s4">'u'</span><span class="s2">;</span>
                        <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">u'</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">str </span><span class="s2">+= </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s2">;</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s4">'ILLEGAL'</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">flags </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">flags</span><span class="s2">,</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">str</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">scanRegExp</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">start</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">, </span><span class="s1">pattern</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">scanRegExpBody</span><span class="s2">();</span>
        <span class="s1">flags </span><span class="s2">= </span><span class="s1">scanRegExpFlags</span><span class="s2">();</span>
        <span class="s1">value </span><span class="s2">= </span><span class="s1">testRegExp</span><span class="s2">(</span><span class="s1">body</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">flags</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">RegularExpression</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">literal</span><span class="s2">: </span><span class="s1">body</span><span class="s2">.</span><span class="s1">literal </span><span class="s2">+ </span><span class="s1">flags</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">,</span>
            <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
            <span class="s1">start</span><span class="s2">: </span><span class="s1">start</span><span class="s2">,</span>
            <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">collectRegex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">regex</span><span class="s2">, </span><span class="s1">token</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s1">regex </span><span class="s2">= </span><span class="s1">scanRegExp</span><span class="s2">();</span>
        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
        <span class="s2">};</span>

        <span class="s0">/* istanbul ignore next */</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize</span><span class="s2">) {</span>
            <span class="s0">// Pop the previous token, which is likely '/' or '/='</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] === </span><span class="s1">pos </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Punctuator'</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'/' </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'/='</span><span class="s2">) {</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s4">'RegularExpression'</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">regex</span><span class="s2">.</span><span class="s1">literal</span><span class="s2">,</span>
                <span class="s1">range</span><span class="s2">: [</span><span class="s1">pos</span><span class="s2">, </span><span class="s1">index</span><span class="s2">],</span>
                <span class="s1">loc</span><span class="s2">: </span><span class="s1">loc</span>
            <span class="s2">});</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">regex</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">isIdentifierName</span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral </span><span class="s2">||</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">advanceSlash</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">prevToken</span><span class="s2">,</span>
            <span class="s1">checkToken</span><span class="s2">;</span>
        <span class="s0">// Using the following algorithm:</span>
        <span class="s0">// https://github.com/mozilla/sweet.js/wiki/design</span>
        <span class="s1">prevToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">prevToken</span><span class="s2">) {</span>
            <span class="s0">// Nothing before that: it cannot be a division.</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Punctuator'</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">']'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">')'</span><span class="s2">) {</span>
                <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">checkToken </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword' </span><span class="s2">&amp;&amp;</span>
                        <span class="s2">(</span><span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'if' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'while' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'for' </span><span class="s2">||</span>
                         <span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'with'</span><span class="s2">)) {</span>
                    <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'}'</span><span class="s2">) {</span>
                <span class="s0">// Dividing a function by anything makes little sense,</span>
                <span class="s0">// but we have to check for that.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">3</span><span class="s2">] &amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">3</span><span class="s2">].</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
                    <span class="s0">// Anonymous function.</span>
                    <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">];</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">checkToken</span><span class="s2">) {</span>
                        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">] &amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">4</span><span class="s2">].</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
                    <span class="s0">// Named function.</span>
                    <span class="s1">checkToken </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">- </span><span class="s5">5</span><span class="s2">];</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">checkToken</span><span class="s2">) {</span>
                        <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s0">// checkToken determines whether the function is</span>
                <span class="s0">// a declaration or an expression.</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">FnExprTokens</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">checkToken</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">) {</span>
                    <span class="s0">// It is an expression.</span>
                    <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
                <span class="s2">}</span>
                <span class="s0">// It is a declaration.</span>
                <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prevToken</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Keyword'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">collectRegex</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">advance</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&gt;= </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">,</span>
                <span class="s1">lineNumber</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">lineStart</span><span class="s2">: </span><span class="s1">lineStart</span><span class="s2">,</span>
                <span class="s1">start</span><span class="s2">: </span><span class="s1">index</span><span class="s2">,</span>
                <span class="s1">end</span><span class="s2">: </span><span class="s1">index</span>
            <span class="s2">};</span>
        <span class="s2">}</span>

        <span class="s1">ch </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">scanIdentifier</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// Very common: ( and ) and ;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x28 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x29 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// String literal starts with single quote (U+0027) or double quote (U+0022).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x27 </span><span class="s2">|| </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x22</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">scanStringLiteral</span><span class="s2">();</span>
        <span class="s2">}</span>


        <span class="s0">// Dot (.) U+002E can also start a floating-point number, hence the need</span>
        <span class="s0">// to check the next character.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2E</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))) {</span>
                <span class="s3">return </span><span class="s1">scanNumericLiteral</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">isDecimalDigit</span><span class="s2">(</span><span class="s1">ch</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">scanNumericLiteral</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s0">// Slash (/) U+002F can also start a regex.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">&amp;&amp; </span><span class="s1">ch </span><span class="s2">=== </span><span class="s5">0x2F</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">advanceSlash</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">scanPunctuator</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">collectToken</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">loc</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">range</span><span class="s2">, </span><span class="s1">value</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">loc </span><span class="s2">= {</span>
            <span class="s1">start</span><span class="s2">: {</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
                <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
            <span class="s2">}</span>
        <span class="s2">};</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">advance</span><span class="s2">();</span>
        <span class="s1">loc</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= {</span>
            <span class="s1">line</span><span class="s2">: </span><span class="s1">lineNumber</span><span class="s2">,</span>
            <span class="s1">column</span><span class="s2">: </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
        <span class="s2">};</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">);</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">TokenName</span><span class="s2">[</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type</span><span class="s2">],</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">range</span><span class="s2">: [</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">],</span>
                <span class="s1">loc</span><span class="s2">: </span><span class="s1">loc</span>
            <span class="s2">});</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">lex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s1">lookahead </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) ? </span><span class="s1">collectToken</span><span class="s2">() : </span><span class="s1">advance</span><span class="s2">();</span>

        <span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineStart</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">peek</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) ? </span><span class="s1">collectToken</span><span class="s2">() : </span><span class="s1">advance</span><span class="s2">();</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">pos</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">line </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">column</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">SourceLocation</span><span class="s2">(</span><span class="s1">startLine</span><span class="s2">, </span><span class="s1">startColumn</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">start </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">startLine</span><span class="s2">, </span><span class="s1">startColumn</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">end </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Position</span><span class="s2">(</span><span class="s1">line</span><span class="s2">, </span><span class="s1">column</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s1">SyntaxTreeDelegate </span><span class="s2">= {</span>

        <span class="s1">name</span><span class="s2">: </span><span class="s4">'SyntaxTree'</span><span class="s2">,</span>

        <span class="s1">processComment</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">lastChild</span><span class="s2">, </span><span class="s1">trailingComments</span><span class="s2">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Program</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                    <span class="s3">return</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) {</span>
                    <span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">;</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= [];</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments </span><span class="s2">&amp;&amp;</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) {</span>
                    <span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">;</span>
                    <span class="s3">delete </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">trailingComments</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s0">// Eating the stack.</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] &gt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                <span class="s1">lastChild </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">lastChild</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">&amp;&amp; </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">[</span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &lt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                    <span class="s1">node</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                    <span class="s3">delete </span><span class="s1">lastChild</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">[</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">] &lt;= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments</span><span class="s2">;</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= [];</span>
            <span class="s2">}</span>


            <span class="s3">if </span><span class="s2">(</span><span class="s1">trailingComments</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= </span><span class="s1">trailingComments</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
        <span class="s2">},</span>

        <span class="s1">markEnd</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">index</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s3">new </span><span class="s1">SourceLocation</span><span class="s2">(</span>
                    <span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineNumber </span><span class="s2">=== </span><span class="s1">undefined </span><span class="s2">?  </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">: </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineNumber</span><span class="s2">,</span>
                    <span class="s1">startToken</span><span class="s2">.</span><span class="s1">start </span><span class="s2">- (</span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineStart </span><span class="s2">=== </span><span class="s1">undefined </span><span class="s2">?  </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">lineStart </span><span class="s2">: </span><span class="s1">startToken</span><span class="s2">.</span><span class="s1">startLineStart</span><span class="s2">),</span>
                    <span class="s1">lineNumber</span><span class="s2">,</span>
                    <span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart</span>
                <span class="s2">);</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">postProcess</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">processComment</span><span class="s2">(</span><span class="s1">node</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
        <span class="s2">},</span>

        <span class="s1">postProcess</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">source</span><span class="s2">) {</span>
                <span class="s1">node</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">source</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
        <span class="s2">},</span>

        <span class="s1">createArrayExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">elements</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ArrayExpression</span><span class="s2">,</span>
                <span class="s1">elements</span><span class="s2">: </span><span class="s1">elements</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createAssignmentExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">AssignmentExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBinaryExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">type </span><span class="s2">= (</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'||' </span><span class="s2">|| </span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'&amp;&amp;'</span><span class="s2">) ? </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">LogicalExpression </span><span class="s2">:</span>
                        <span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BinaryExpression</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">type</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBlockStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BlockStatement</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createBreakStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">BreakStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createCallExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">CallExpression</span><span class="s2">,</span>
                <span class="s1">callee</span><span class="s2">: </span><span class="s1">callee</span><span class="s2">,</span>
                <span class="s4">'arguments'</span><span class="s2">: </span><span class="s1">args</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createCatchClause</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">CatchClause</span><span class="s2">,</span>
                <span class="s1">param</span><span class="s2">: </span><span class="s1">param</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createConditionalExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ConditionalExpression</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span><span class="s2">,</span>
                <span class="s1">alternate</span><span class="s2">: </span><span class="s1">alternate</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createContinueStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ContinueStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createDebuggerStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">DebuggerStatement</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createDoWhileStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">DoWhileStatement</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createEmptyStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">EmptyStatement</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createExpressionStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">expression</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ExpressionStatement</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s1">expression</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createForStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ForStatement</span><span class="s2">,</span>
                <span class="s1">init</span><span class="s2">: </span><span class="s1">init</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">update</span><span class="s2">: </span><span class="s1">update</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createForInStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ForInStatement</span><span class="s2">,</span>
                <span class="s1">left</span><span class="s2">: </span><span class="s1">left</span><span class="s2">,</span>
                <span class="s1">right</span><span class="s2">: </span><span class="s1">right</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">each</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createFunctionDeclaration</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">FunctionDeclaration</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
                <span class="s1">defaults</span><span class="s2">: </span><span class="s1">defaults</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">rest</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">generator</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createFunctionExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, </span><span class="s1">defaults</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">FunctionExpression</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
                <span class="s1">defaults</span><span class="s2">: </span><span class="s1">defaults</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span><span class="s2">,</span>
                <span class="s1">rest</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">generator</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
                <span class="s1">expression</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createIdentifier</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">,</span>
                <span class="s1">name</span><span class="s2">: </span><span class="s1">name</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createIfStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">IfStatement</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span><span class="s2">,</span>
                <span class="s1">alternate</span><span class="s2">: </span><span class="s1">alternate</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createLabeledStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">label</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">LabeledStatement</span><span class="s2">,</span>
                <span class="s1">label</span><span class="s2">: </span><span class="s1">label</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createLiteral</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">raw</span><span class="s2">: </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end</span><span class="s2">)</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createMemberExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">accessor</span><span class="s2">, </span><span class="s1">object</span><span class="s2">, </span><span class="s1">property</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">MemberExpression</span><span class="s2">,</span>
                <span class="s1">computed</span><span class="s2">: </span><span class="s1">accessor </span><span class="s2">=== </span><span class="s4">'['</span><span class="s2">,</span>
                <span class="s1">object</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
                <span class="s1">property</span><span class="s2">: </span><span class="s1">property</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createNewExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">NewExpression</span><span class="s2">,</span>
                <span class="s1">callee</span><span class="s2">: </span><span class="s1">callee</span><span class="s2">,</span>
                <span class="s4">'arguments'</span><span class="s2">: </span><span class="s1">args</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createObjectExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">properties</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ObjectExpression</span><span class="s2">,</span>
                <span class="s1">properties</span><span class="s2">: </span><span class="s1">properties</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createPostfixExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UpdateExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                <span class="s1">prefix</span><span class="s2">: </span><span class="s3">false</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createProgram</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Program</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createProperty</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">kind</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Property</span><span class="s2">,</span>
                <span class="s1">key</span><span class="s2">: </span><span class="s1">key</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">,</span>
                <span class="s1">kind</span><span class="s2">: </span><span class="s1">kind</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createReturnStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ReturnStatement</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSequenceExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">expressions</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SequenceExpression</span><span class="s2">,</span>
                <span class="s1">expressions</span><span class="s2">: </span><span class="s1">expressions</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSwitchCase</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SwitchCase</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">consequent</span><span class="s2">: </span><span class="s1">consequent</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createSwitchStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">SwitchStatement</span><span class="s2">,</span>
                <span class="s1">discriminant</span><span class="s2">: </span><span class="s1">discriminant</span><span class="s2">,</span>
                <span class="s1">cases</span><span class="s2">: </span><span class="s1">cases</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createThisExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">() {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ThisExpression</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createThrowStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">ThrowStatement</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createTryStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">block</span><span class="s2">, </span><span class="s1">guardedHandlers</span><span class="s2">, </span><span class="s1">handlers</span><span class="s2">, </span><span class="s1">finalizer</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">TryStatement</span><span class="s2">,</span>
                <span class="s1">block</span><span class="s2">: </span><span class="s1">block</span><span class="s2">,</span>
                <span class="s1">guardedHandlers</span><span class="s2">: </span><span class="s1">guardedHandlers</span><span class="s2">,</span>
                <span class="s1">handlers</span><span class="s2">: </span><span class="s1">handlers</span><span class="s2">,</span>
                <span class="s1">finalizer</span><span class="s2">: </span><span class="s1">finalizer</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createUnaryExpression</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">argument</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'++' </span><span class="s2">|| </span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'--'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s2">{</span>
                    <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UpdateExpression</span><span class="s2">,</span>
                    <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                    <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                    <span class="s1">prefix</span><span class="s2">: </span><span class="s3">true</span>
                <span class="s2">};</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">UnaryExpression</span><span class="s2">,</span>
                <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
                <span class="s1">argument</span><span class="s2">: </span><span class="s1">argument</span><span class="s2">,</span>
                <span class="s1">prefix</span><span class="s2">: </span><span class="s3">true</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createVariableDeclaration</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">VariableDeclaration</span><span class="s2">,</span>
                <span class="s1">declarations</span><span class="s2">: </span><span class="s1">declarations</span><span class="s2">,</span>
                <span class="s1">kind</span><span class="s2">: </span><span class="s1">kind</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createVariableDeclarator</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">init</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">VariableDeclarator</span><span class="s2">,</span>
                <span class="s1">id</span><span class="s2">: </span><span class="s1">id</span><span class="s2">,</span>
                <span class="s1">init</span><span class="s2">: </span><span class="s1">init</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createWhileStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">WhileStatement</span><span class="s2">,</span>
                <span class="s1">test</span><span class="s2">: </span><span class="s1">test</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">},</span>

        <span class="s1">createWithStatement</span><span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s2">{</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">WithStatement</span><span class="s2">,</span>
                <span class="s1">object</span><span class="s2">: </span><span class="s1">object</span><span class="s2">,</span>
                <span class="s1">body</span><span class="s2">: </span><span class="s1">body</span>
            <span class="s2">};</span>
        <span class="s2">}</span>
    <span class="s2">};</span>

    <span class="s0">// Return true if there is a line terminator before the next token.</span>

    <span class="s3">function </span><span class="s1">peekLineTerminator</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pos</span><span class="s2">, </span><span class="s1">line</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">found</span><span class="s2">;</span>

        <span class="s1">pos </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">start </span><span class="s2">= </span><span class="s1">lineStart</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">found </span><span class="s2">= </span><span class="s1">lineNumber </span><span class="s2">!== </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s1">pos</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">line</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s1">start</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">found</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Throw an exception</span>

    <span class="s3">function </span><span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">messageFormat</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">error</span><span class="s2">,</span>
            <span class="s1">args </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s5">2</span><span class="s2">),</span>
            <span class="s1">msg </span><span class="s2">= </span><span class="s1">messageFormat</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span>
                <span class="s6">/%(\d)/g</span><span class="s2">,</span>
                <span class="s3">function </span><span class="s2">(</span><span class="s1">whole</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
                    <span class="s1">assert</span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s4">'Message reference must be in range'</span><span class="s2">);</span>
                    <span class="s3">return </span><span class="s1">args</span><span class="s2">[</span><span class="s1">index</span><span class="s2">];</span>
                <span class="s2">}</span>
            <span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">=== </span><span class="s4">'number'</span><span class="s2">) {</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Line ' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">+ </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">msg</span><span class="s2">);</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">start</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">lineNumber</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">error </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Line ' </span><span class="s2">+ </span><span class="s1">lineNumber </span><span class="s2">+ </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">msg</span><span class="s2">);</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">index </span><span class="s2">= </span><span class="s1">index</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">lineNumber </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
            <span class="s1">error</span><span class="s2">.</span><span class="s1">column </span><span class="s2">= </span><span class="s1">index </span><span class="s2">- </span><span class="s1">lineStart </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">error</span><span class="s2">.</span><span class="s1">description </span><span class="s2">= </span><span class="s1">msg</span><span class="s2">;</span>
        <span class="s3">throw </span><span class="s1">error</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">throwErrorTolerant</span><span class="s2">() {</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">throwError</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">e</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


    <span class="s0">// Throw an exception because of the token.</span>

    <span class="s3">function </span><span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedEOS</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedNumber</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedString</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedIdentifier</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isFutureReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedReserved</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">);</span>
                <span class="s3">return</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// BooleanLiteral, NullLiteral, or Punctuator.</span>
        <span class="s1">throwError</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// Expect the next token to match the specified punctuator.</span>
    <span class="s0">// If not, an exception will be thrown.</span>

    <span class="s3">function </span><span class="s1">expect</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">!== </span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Expect the next token to match the specified keyword.</span>
    <span class="s0">// If not, an exception will be thrown.</span>

    <span class="s3">function </span><span class="s1">expectKeyword</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">!== </span><span class="s1">keyword</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token matches the specified punctuator.</span>

    <span class="s3">function </span><span class="s1">match</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token matches the specified keyword</span>

    <span class="s3">function </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s1">keyword</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">keyword</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if the next token is an assignment operator</span>

    <span class="s3">function </span><span class="s1">matchAssign</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">op</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">op </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'*=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'/=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'%=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'+=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'-=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&lt;&lt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;&gt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;&gt;&gt;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'&amp;=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'^=' </span><span class="s2">||</span>
            <span class="s1">op </span><span class="s2">=== </span><span class="s4">'|='</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">consumeSemicolon</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">line</span><span class="s2">;</span>

        <span class="s0">// Catch the very common case first: immediately a semicolon (U+003B).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B </span><span class="s2">|| </span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">line </span><span class="s2">= </span><span class="s1">lineNumber</span><span class="s2">;</span>
        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lineNumber </span><span class="s2">!== </span><span class="s1">line</span><span class="s2">) {</span>
            <span class="s3">return</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s0">// Return true if provided expression is LeftHandSideExpression</span>

    <span class="s3">function </span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">) {</span>
        <span class="s3">return </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">|| </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">MemberExpression</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.4 Array Initialiser</span>

    <span class="s3">function </span><span class="s1">parseArrayInitialiser</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">elements </span><span class="s2">= [], </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">elements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">elements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>

                <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">)) {</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createArrayExpression</span><span class="s2">(</span><span class="s1">elements</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.5 Object Initialiser</span>

    <span class="s3">function </span><span class="s1">parsePropertyFunction</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">first</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">first </span><span class="s2">&amp;&amp; </span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">param</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">first</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionExpression</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">param</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectPropertyKey</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s0">// Note: This function is called only from parseObjectProperty(), where</span>
        <span class="s0">// EOF and Punctuator tokens are already filtered out.</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectProperty</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">param</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>

            <span class="s1">id </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>

            <span class="s0">// Property Assignment: Getter and Setter.</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'get' </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">([]);</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'get'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'set' </span><span class="s2">&amp;&amp; !</span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnexpectedToken</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">([]);</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">param </span><span class="s2">= [ </span><span class="s1">parseVariableIdentifier</span><span class="s2">() ];</span>
                    <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
                    <span class="s1">value </span><span class="s2">= </span><span class="s1">parsePropertyFunction</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">token</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'set'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'init'</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF </span><span class="s2">|| </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">key </span><span class="s2">= </span><span class="s1">parseObjectPropertyKey</span><span class="s2">();</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">value </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProperty</span><span class="s2">(</span><span class="s4">'init'</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseObjectInitialiser</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">properties </span><span class="s2">= [], </span><span class="s1">property</span><span class="s2">, </span><span class="s1">name</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">, </span><span class="s1">map </span><span class="s2">= {}, </span><span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">property </span><span class="s2">= </span><span class="s1">parseObjectProperty</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">name </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">property</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">kind </span><span class="s2">= (</span><span class="s1">property</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'init'</span><span class="s2">) ? </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data </span><span class="s2">: (</span><span class="s1">property</span><span class="s2">.</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'get'</span><span class="s2">) ? </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Get </span><span class="s2">: </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Set</span><span class="s2">;</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">map</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] === </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">kind </span><span class="s2">=== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictDuplicateProperty</span><span class="s2">);</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">!== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorDataProperty</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">=== </span><span class="s1">PropertyKind</span><span class="s2">.</span><span class="s1">Data</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorDataProperty</span><span class="s2">);</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] &amp; </span><span class="s1">kind</span><span class="s2">) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">AccessorGetSet</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] |= </span><span class="s1">kind</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">map</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">kind</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">properties</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">property</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createObjectExpression</span><span class="s2">(</span><span class="s1">properties</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.1.6 The Grouping Operator</span>

    <span class="s3">function </span><span class="s1">parseGroupExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 11.1 Primary Expressions</span>

    <span class="s3">function </span><span class="s1">parsePrimaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">type</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseGroupExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseArrayInitialiser</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">)) {</span>
            <span class="s3">return </span><span class="s1">parseObjectInitialiser</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s1">type </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">=  </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">().</span><span class="s1">value</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral </span><span class="s2">|| </span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NumericLiteral</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">)) {</span>
                <span class="s3">return </span><span class="s1">parseFunctionExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'this'</span><span class="s2">)) {</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createThisExpression</span><span class="s2">();</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">BooleanLiteral</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= (</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'true'</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">NullLiteral</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'/='</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">collectRegex</span><span class="s2">());</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLiteral</span><span class="s2">(</span><span class="s1">scanRegExp</span><span class="s2">());</span>
            <span class="s2">}</span>
            <span class="s1">peek</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lex</span><span class="s2">());</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 11.2 Left-Hand-Side Expressions</span>

    <span class="s3">function </span><span class="s1">parseArguments</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">args </span><span class="s2">= [];</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">args</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">args</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNonComputedProperty</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">isIdentifierName</span><span class="s2">(</span><span class="s1">token</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNonComputedMember</span><span class="s2">() {</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">parseNonComputedProperty</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseComputedMember</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">);</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">']'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseNewExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">);</span>
        <span class="s1">callee </span><span class="s2">= </span><span class="s1">parseLeftHandSideExpression</span><span class="s2">();</span>
        <span class="s1">args </span><span class="s2">= </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">) ? </span><span class="s1">parseArguments</span><span class="s2">() : [];</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createNewExpression</span><span class="s2">(</span><span class="s1">callee</span><span class="s2">, </span><span class="s1">args</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseLeftHandSideExpressionAllowCall</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">args</span><span class="s2">, </span><span class="s1">property</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">) ? </span><span class="s1">parseNewExpression</span><span class="s2">() : </span><span class="s1">parsePrimaryExpression</span><span class="s2">();</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>

        <span class="s3">for </span><span class="s2">(;;) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseNonComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
                <span class="s1">args </span><span class="s2">= </span><span class="s1">parseArguments</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createCallExpression</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseLeftHandSideExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'new'</span><span class="s2">) ? </span><span class="s1">parseNewExpression</span><span class="s2">() : </span><span class="s1">parsePrimaryExpression</span><span class="s2">();</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">)) {</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'['</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">property </span><span class="s2">= </span><span class="s1">parseNonComputedMember</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createMemberExpression</span><span class="s2">(</span><span class="s4">'.'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">property</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.3 Postfix Expressions</span>

    <span class="s3">function </span><span class="s1">parsePostfixExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseLeftHandSideExpressionAllowCall</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">((</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'++'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'--'</span><span class="s2">)) &amp;&amp; !</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
                <span class="s0">// 11.3.1, 11.3.2</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSPostfix</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
                <span class="s2">}</span>

                <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createPostfixExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.4 Unary Operators</span>

    <span class="s3">function </span><span class="s1">parseUnaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parsePostfixExpression</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'++'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'--'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s0">// 11.4.4, 11.4.5</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSPrefix</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'+'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'~'</span><span class="s2">) || </span><span class="s1">match</span><span class="s2">(</span><span class="s4">'!'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'delete'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'void'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'typeof'</span><span class="s2">)) {</span>
            <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createUnaryExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'delete' </span><span class="s2">&amp;&amp; </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">argument</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictDelete</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parsePostfixExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">allowIn</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">prec </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">switch </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
        <span class="s3">case </span><span class="s4">'||'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&amp;&amp;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'|'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">3</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'^'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">4</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&amp;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">5</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'=='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'!='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'==='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'!=='</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">6</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&lt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&lt;='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;='</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'instanceof'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">7</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'in'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s1">allowIn </span><span class="s2">? </span><span class="s5">7 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'&lt;&lt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;&gt;'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'&gt;&gt;&gt;'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">8</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'+'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'-'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">9</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">case </span><span class="s4">'*'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'/'</span><span class="s2">:</span>
        <span class="s3">case </span><span class="s4">'%'</span><span class="s2">:</span>
            <span class="s1">prec </span><span class="s2">= </span><span class="s5">11</span><span class="s2">;</span>
            <span class="s3">break</span><span class="s2">;</span>

        <span class="s3">default</span><span class="s2">:</span>
            <span class="s3">break</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">prec</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.5 Multiplicative Operators</span>
    <span class="s0">// 11.6 Additive Operators</span>
    <span class="s0">// 11.7 Bitwise Shift Operators</span>
    <span class="s0">// 11.8 Relational Operators</span>
    <span class="s0">// 11.9 Equality Operators</span>
    <span class="s0">// 11.10 Binary Bitwise Operators</span>
    <span class="s0">// 11.11 Binary Logical Operators</span>

    <span class="s3">function </span><span class="s1">parseBinaryExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">marker</span><span class="s2">, </span><span class="s1">markers</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">prec</span><span class="s2">, </span><span class="s1">stack</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">i</span><span class="s2">;</span>

        <span class="s1">marker </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">left </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">prec </span><span class="s2">= </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">prec </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">left</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s1">token</span><span class="s2">.</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">prec</span><span class="s2">;</span>
        <span class="s1">lex</span><span class="s2">();</span>

        <span class="s1">markers </span><span class="s2">= [</span><span class="s1">marker</span><span class="s2">, </span><span class="s1">lookahead</span><span class="s2">];</span>
        <span class="s1">right </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>

        <span class="s1">stack </span><span class="s2">= [</span><span class="s1">left</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">right</span><span class="s2">];</span>

        <span class="s3">while </span><span class="s2">((</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">binaryPrecedence</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">, </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">)) &gt; </span><span class="s5">0</span><span class="s2">) {</span>

            <span class="s0">// Reduce: make a binary expression from the three topmost entries.</span>
            <span class="s3">while </span><span class="s2">((</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">2</span><span class="s2">) &amp;&amp; (</span><span class="s1">prec </span><span class="s2">&lt;= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">].</span><span class="s1">prec</span><span class="s2">)) {</span>
                <span class="s1">right </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">operator </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">().</span><span class="s1">value</span><span class="s2">;</span>
                <span class="s1">left </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBinaryExpression</span><span class="s2">(</span><span class="s1">operator</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">);</span>
                <span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
                <span class="s1">marker </span><span class="s2">= </span><span class="s1">markers</span><span class="s2">[</span><span class="s1">markers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
                <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">// Shift.</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">token</span><span class="s2">.</span><span class="s1">prec </span><span class="s2">= </span><span class="s1">prec</span><span class="s2">;</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
            <span class="s1">markers</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseUnaryExpression</span><span class="s2">();</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// Final reduce to clean-up the stack.</span>
        <span class="s1">i </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s1">expr </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
        <span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
        <span class="s3">while </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBinaryExpression</span><span class="s2">(</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">value</span><span class="s2">, </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s5">2</span><span class="s2">], </span><span class="s1">expr</span><span class="s2">);</span>
            <span class="s1">i </span><span class="s2">-= </span><span class="s5">2</span><span class="s2">;</span>
            <span class="s1">marker </span><span class="s2">= </span><span class="s1">markers</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>


    <span class="s0">// 11.12 Conditional Operator</span>

    <span class="s3">function </span><span class="s1">parseConditionalExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">previousAllowIn</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseBinaryExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'?'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">previousAllowIn </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn</span><span class="s2">;</span>
            <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">consequent </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s1">previousAllowIn</span><span class="s2">;</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>

            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createConditionalExpression</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">);</span>
            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.13 Assignment Operators</span>

    <span class="s3">function </span><span class="s1">parseAssignmentExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">node</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">node </span><span class="s2">= </span><span class="s1">left </span><span class="s2">= </span><span class="s1">parseConditionalExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchAssign</span><span class="s2">()) {</span>
            <span class="s0">// LeftHandSideExpression</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">left</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s0">// 11.13.1</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">left</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">left</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictLHSAssignment</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">right </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
            <span class="s1">node </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createAssignmentExpression</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">node</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 11.14 Comma Operator</span>

    <span class="s3">function </span><span class="s1">parseExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
            <span class="s1">expr </span><span class="s2">= </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSequenceExpression</span><span class="s2">([ </span><span class="s1">expr </span><span class="s2">]);</span>

            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">lex</span><span class="s2">();</span>
                <span class="s1">expr</span><span class="s2">.</span><span class="s1">expressions</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseAssignmentExpression</span><span class="s2">());</span>
            <span class="s2">}</span>

            <span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">expr</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// 12.1 Block</span>

    <span class="s3">function </span><span class="s1">parseStatementList</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">list </span><span class="s2">= [],</span>
            <span class="s1">statement</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">statement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">statement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">list</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">statement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">list</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseBlock</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">block</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s1">block </span><span class="s2">= </span><span class="s1">parseStatementList</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBlockStatement</span><span class="s2">(</span><span class="s1">block</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.2 Variable Statement</span>

    <span class="s3">function </span><span class="s1">parseVariableIdentifier</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIdentifier</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">id</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

        <span class="s0">// 12.2.1</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">id</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictVarName</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">kind </span><span class="s2">=== </span><span class="s4">'const'</span><span class="s2">) {</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">);</span>
            <span class="s1">init </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'='</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">init </span><span class="s2">= </span><span class="s1">parseAssignmentExpression</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclarator</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">init</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableDeclarationList</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">list </span><span class="s2">= [];</span>

        <span class="s3">do </span><span class="s2">{</span>
            <span class="s1">list</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseVariableDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">));</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">','</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">list</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseVariableStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">declarations</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'var'</span><span class="s2">);</span>

        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">();</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s4">'var'</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// kind may be `const` or `let`</span>
    <span class="s0">// Both are experimental and not in the specification yet.</span>
    <span class="s0">// see http://wiki.ecmascript.org/doku.php?id=harmony:const</span>
    <span class="s0">// and http://wiki.ecmascript.org/doku.php?id=harmony:let</span>
    <span class="s3">function </span><span class="s1">parseConstLetDeclaration</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">);</span>

        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">(</span><span class="s1">kind</span><span class="s2">);</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">kind</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.3 Empty Statement</span>

    <span class="s3">function </span><span class="s1">parseEmptyStatement</span><span class="s2">() {</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createEmptyStatement</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// 12.4 Expression Statement</span>

    <span class="s3">function </span><span class="s1">parseExpressionStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
        <span class="s1">consumeSemicolon</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createExpressionStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.5 If statement</span>

    <span class="s3">function </span><span class="s1">parseIfStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'if'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">consequent </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'else'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">alternate </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createIfStatement</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">, </span><span class="s1">alternate</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.6 Iteration Statements</span>

    <span class="s3">function </span><span class="s1">parseDoWhileStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'do'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'while'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createDoWhileStatement</span><span class="s2">(</span><span class="s1">body</span><span class="s2">, </span><span class="s1">test</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseWhileStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'while'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createWhileStatement</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseForVariableDeclaration</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s1">declarations </span><span class="s2">= </span><span class="s1">parseVariableDeclarationList</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createVariableDeclaration</span><span class="s2">(</span><span class="s1">declarations</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseForStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s1">init </span><span class="s2">= </span><span class="s1">test </span><span class="s2">= </span><span class="s1">update </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'for'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'var'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'let'</span><span class="s2">)) {</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s1">init </span><span class="s2">= </span><span class="s1">parseForVariableDeclaration</span><span class="s2">();</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">init</span><span class="s2">.</span><span class="s1">declarations</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">1 </span><span class="s2">&amp;&amp; </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'in'</span><span class="s2">)) {</span>
                    <span class="s1">lex</span><span class="s2">();</span>
                    <span class="s1">left </span><span class="s2">= </span><span class="s1">init</span><span class="s2">;</span>
                    <span class="s1">right </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                    <span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                <span class="s1">init </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                <span class="s1">state</span><span class="s2">.</span><span class="s1">allowIn </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

                <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'in'</span><span class="s2">)) {</span>
                    <span class="s0">// LeftHandSideExpression</span>
                    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isLeftHandSide</span><span class="s2">(</span><span class="s1">init</span><span class="s2">)) {</span>
                        <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">InvalidLHSInForIn</span><span class="s2">);</span>
                    <span class="s2">}</span>

                    <span class="s1">lex</span><span class="s2">();</span>
                    <span class="s1">left </span><span class="s2">= </span><span class="s1">init</span><span class="s2">;</span>
                    <span class="s1">right </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                    <span class="s1">init </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
                <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s1">expect</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">);</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                <span class="s1">update </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">left </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) ?</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">createForStatement</span><span class="s2">(</span><span class="s1">init</span><span class="s2">, </span><span class="s1">test</span><span class="s2">, </span><span class="s1">update</span><span class="s2">, </span><span class="s1">body</span><span class="s2">) :</span>
                <span class="s1">delegate</span><span class="s2">.</span><span class="s1">createForInStatement</span><span class="s2">(</span><span class="s1">left</span><span class="s2">, </span><span class="s1">right</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.7 The continue statement</span>

    <span class="s3">function </span><span class="s1">parseContinueStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">label </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">key</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'continue'</span><span class="s2">);</span>

        <span class="s0">// Optimize the most common form: 'continue;'.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnknownLabel</span><span class="s2">, </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">label </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">&amp;&amp; !</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalContinue</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createContinueStatement</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.8 The break statement</span>

    <span class="s3">function </span><span class="s1">parseBreakStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">label </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">key</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'break'</span><span class="s2">);</span>

        <span class="s0">// Catch the very common case first: immediately a semicolon (U+003B).</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x3B</span><span class="s2">) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s3">if </span><span class="s2">(!(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">if </span><span class="s2">(!(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) {</span>
            <span class="s1">label </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">UnknownLabel</span><span class="s2">, </span><span class="s1">label</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">label </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">&amp;&amp; !(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">|| </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">)) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalBreak</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBreakStatement</span><span class="s2">(</span><span class="s1">label</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.9 The return statement</span>

    <span class="s3">function </span><span class="s1">parseReturnStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">argument </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'return'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">IllegalReturn</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s0">// 'return' followed by a space and an identifier is very common.</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index</span><span class="s2">) === </span><span class="s5">0x20</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isIdentifierStart</span><span class="s2">(</span><span class="s1">source</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">index </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">))) {</span>
                <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
                <span class="s1">consumeSemicolon</span><span class="s2">();</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">';'</span><span class="s2">)) {</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">) &amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createReturnStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.10 The with statement</span>

    <span class="s3">function </span><span class="s1">parseWithStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
            <span class="s0">// TODO(ikarienator): Should we update the test cases instead?</span>
            <span class="s1">skipComment</span><span class="s2">();</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictModeWith</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'with'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">object </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createWithStatement</span><span class="s2">(</span><span class="s1">object</span><span class="s2">, </span><span class="s1">body</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.10 The swith statement</span>

    <span class="s3">function </span><span class="s1">parseSwitchCase</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent </span><span class="s2">= [], </span><span class="s1">statement</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">test </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'case'</span><span class="s2">);</span>
            <span class="s1">test </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>
        <span class="s2">}</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'default'</span><span class="s2">) || </span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'case'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">statement </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s1">consequent</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">statement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchCase</span><span class="s2">(</span><span class="s1">test</span><span class="s2">, </span><span class="s1">consequent</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseSwitchStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">, </span><span class="s1">clause</span><span class="s2">, </span><span class="s1">oldInSwitch</span><span class="s2">, </span><span class="s1">defaultFound</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'switch'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s1">discriminant </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s1">cases </span><span class="s2">= [];</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchStatement</span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">oldInSwitch </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">defaultFound </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">clause </span><span class="s2">= </span><span class="s1">parseSwitchCase</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">clause</span><span class="s2">.</span><span class="s1">test </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">defaultFound</span><span class="s2">) {</span>
                    <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">MultipleDefaultsInSwitch</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s1">defaultFound </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">cases</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">clause</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s1">oldInSwitch</span><span class="s2">;</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createSwitchStatement</span><span class="s2">(</span><span class="s1">discriminant</span><span class="s2">, </span><span class="s1">cases</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.13 The throw statement</span>

    <span class="s3">function </span><span class="s1">parseThrowStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">argument</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'throw'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">peekLineTerminator</span><span class="s2">()) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">NewlineAfterThrow</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">argument </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createThrowStatement</span><span class="s2">(</span><span class="s1">argument</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.14 The try statement</span>

    <span class="s3">function </span><span class="s1">parseCatchClause</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'catch'</span><span class="s2">);</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">param </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
        <span class="s0">// 12.14.1</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">param</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictCatchVariable</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createCatchClause</span><span class="s2">(</span><span class="s1">param</span><span class="s2">, </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseTryStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">block</span><span class="s2">, </span><span class="s1">handlers </span><span class="s2">= [], </span><span class="s1">finalizer </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'try'</span><span class="s2">);</span>

        <span class="s1">block </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'catch'</span><span class="s2">)) {</span>
            <span class="s1">handlers</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">parseCatchClause</span><span class="s2">());</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">matchKeyword</span><span class="s2">(</span><span class="s4">'finally'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>
            <span class="s1">finalizer </span><span class="s2">= </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">&amp;&amp; !</span><span class="s1">finalizer</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">NoCatchOrFinally</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createTryStatement</span><span class="s2">(</span><span class="s1">block</span><span class="s2">, [], </span><span class="s1">handlers</span><span class="s2">, </span><span class="s1">finalizer</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 12.15 The debugger statement</span>

    <span class="s3">function </span><span class="s1">parseDebuggerStatement</span><span class="s2">() {</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'debugger'</span><span class="s2">);</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createDebuggerStatement</span><span class="s2">();</span>
    <span class="s2">}</span>

    <span class="s0">// 12 Statements</span>

    <span class="s3">function </span><span class="s1">parseStatement</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">type </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type</span><span class="s2">,</span>
            <span class="s1">expr</span><span class="s2">,</span>
            <span class="s1">labeledBody</span><span class="s2">,</span>
            <span class="s1">key</span><span class="s2">,</span>
            <span class="s1">startToken</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s1">throwUnexpected</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator </span><span class="s2">&amp;&amp; </span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s4">'{'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">parseBlock</span><span class="s2">();</span>
        <span class="s2">}</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Punctuator</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">';'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseEmptyStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'('</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseExpressionStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">'break'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseBreakStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'continue'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseContinueStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'debugger'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseDebuggerStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'do'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseDoWhileStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'for'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseForStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'function'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseFunctionDeclaration</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'if'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseIfStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'return'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseReturnStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'switch'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseSwitchStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'throw'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseThrowStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'try'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseTryStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'var'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseVariableStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'while'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseWhileStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'with'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">parseWithStatement</span><span class="s2">(), </span><span class="s1">startToken</span><span class="s2">);</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expr </span><span class="s2">= </span><span class="s1">parseExpression</span><span class="s2">();</span>

        <span class="s0">// 12.12 Labelled Statements</span>
        <span class="s3">if </span><span class="s2">((</span><span class="s1">expr</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Identifier</span><span class="s2">) &amp;&amp; </span><span class="s1">match</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">)) {</span>
            <span class="s1">lex</span><span class="s2">();</span>

            <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                <span class="s1">throwError</span><span class="s2">({}, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">Redeclaration</span><span class="s2">, </span><span class="s4">'Label'</span><span class="s2">, </span><span class="s1">expr</span><span class="s2">.</span><span class="s1">name</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
            <span class="s1">labeledBody </span><span class="s2">= </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s3">delete </span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
            <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createLabeledStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">, </span><span class="s1">labeledBody</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">consumeSemicolon</span><span class="s2">();</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createExpressionStatement</span><span class="s2">(</span><span class="s1">expr</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 13 Function Definition</span>

    <span class="s3">function </span><span class="s1">parseFunctionSourceElements</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">sourceElement</span><span class="s2">, </span><span class="s1">sourceElements </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">directive</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">,</span>
            <span class="s1">oldLabelSet</span><span class="s2">, </span><span class="s1">oldInIteration</span><span class="s2">, </span><span class="s1">oldInSwitch</span><span class="s2">, </span><span class="s1">oldInFunctionBody</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'{'</span><span class="s2">);</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">) {</span>
                <span class="s0">// this is not directive</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">directive </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">directive </span><span class="s2">=== </span><span class="s4">'use strict'</span><span class="s2">) {</span>
                <span class="s1">strict </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">firstRestricted </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">oldLabelSet </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet</span><span class="s2">;</span>
        <span class="s1">oldInIteration </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration</span><span class="s2">;</span>
        <span class="s1">oldInSwitch </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch</span><span class="s2">;</span>
        <span class="s1">oldInFunctionBody </span><span class="s2">= </span><span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody</span><span class="s2">;</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet </span><span class="s2">= {};</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">)) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">sourceElement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'}'</span><span class="s2">);</span>

        <span class="s1">state</span><span class="s2">.</span><span class="s1">labelSet </span><span class="s2">= </span><span class="s1">oldLabelSet</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inIteration </span><span class="s2">= </span><span class="s1">oldInIteration</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inSwitch </span><span class="s2">= </span><span class="s1">oldInSwitch</span><span class="s2">;</span>
        <span class="s1">state</span><span class="s2">.</span><span class="s1">inFunctionBody </span><span class="s2">= </span><span class="s1">oldInFunctionBody</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createBlockStatement</span><span class="s2">(</span><span class="s1">sourceElements</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">param</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">message</span><span class="s2">;</span>
        <span class="s1">expect</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
            <span class="s1">paramSet </span><span class="s2">= {};</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
                <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                <span class="s1">param </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
                <span class="s1">key </span><span class="s2">= </span><span class="s4">'$' </span><span class="s2">+ </span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">;</span>
                    <span class="s2">}</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamDupe</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamName</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">paramSet</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
                        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                        <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictParamDupe</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s1">params</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">param</span><span class="s2">);</span>
                <span class="s1">paramSet</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">)) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s1">expect</span><span class="s2">(</span><span class="s4">','</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">expect</span><span class="s2">(</span><span class="s4">')'</span><span class="s2">);</span>

        <span class="s3">return </span><span class="s2">{</span>
            <span class="s1">params</span><span class="s2">: </span><span class="s1">params</span><span class="s2">,</span>
            <span class="s1">stricted</span><span class="s2">: </span><span class="s1">stricted</span><span class="s2">,</span>
            <span class="s1">firstRestricted</span><span class="s2">: </span><span class="s1">firstRestricted</span><span class="s2">,</span>
            <span class="s1">message</span><span class="s2">: </span><span class="s1">message</span>
        <span class="s2">};</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseFunctionDeclaration</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">id</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">body</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>

        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">);</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">;</span>
            <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">);</span>
        <span class="s1">params </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">stricted</span><span class="s2">;</span>
        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">firstRestricted</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s1">message </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">firstRestricted</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">stricted</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionDeclaration</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseFunctionExpression</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">, </span><span class="s1">id </span><span class="s2">= </span><span class="s3">null</span><span class="s2">, </span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">tmp</span><span class="s2">, </span><span class="s1">params </span><span class="s2">= [], </span><span class="s1">body</span><span class="s2">, </span><span class="s1">previousStrict</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">expectKeyword</span><span class="s2">(</span><span class="s4">'function'</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(!</span><span class="s1">match</span><span class="s2">(</span><span class="s4">'('</span><span class="s2">)) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s1">id </span><span class="s2">= </span><span class="s1">parseVariableIdentifier</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">strict</span><span class="s2">) {</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">token</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">isRestrictedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                    <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictFunctionName</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">isStrictModeReservedWord</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                    <span class="s1">message </span><span class="s2">= </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictReservedWord</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">tmp </span><span class="s2">= </span><span class="s1">parseParams</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">);</span>
        <span class="s1">params </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">params</span><span class="s2">;</span>
        <span class="s1">stricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">stricted</span><span class="s2">;</span>
        <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">firstRestricted</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">) {</span>
            <span class="s1">message </span><span class="s2">= </span><span class="s1">tmp</span><span class="s2">.</span><span class="s1">message</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s1">previousStrict </span><span class="s2">= </span><span class="s1">strict</span><span class="s2">;</span>
        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseFunctionSourceElements</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">firstRestricted</span><span class="s2">) {</span>
            <span class="s1">throwError</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">strict </span><span class="s2">&amp;&amp; </span><span class="s1">stricted</span><span class="s2">) {</span>
            <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">stricted</span><span class="s2">, </span><span class="s1">message</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s1">previousStrict</span><span class="s2">;</span>

        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createFunctionExpression</span><span class="s2">(</span><span class="s1">id</span><span class="s2">, </span><span class="s1">params</span><span class="s2">, [], </span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s0">// 14 Program</span>

    <span class="s3">function </span><span class="s1">parseSourceElement</span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">Keyword</span><span class="s2">) {</span>
            <span class="s3">switch </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) {</span>
            <span class="s3">case </span><span class="s4">'const'</span><span class="s2">:</span>
            <span class="s3">case </span><span class="s4">'let'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseConstLetDeclaration</span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">value</span><span class="s2">);</span>
            <span class="s3">case </span><span class="s4">'function'</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseFunctionDeclaration</span><span class="s2">();</span>
            <span class="s3">default</span><span class="s2">:</span>
                <span class="s3">return </span><span class="s1">parseStatement</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">parseStatement</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseSourceElements</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">sourceElement</span><span class="s2">, </span><span class="s1">sourceElements </span><span class="s2">= [], </span><span class="s1">token</span><span class="s2">, </span><span class="s1">directive</span><span class="s2">, </span><span class="s1">firstRestricted</span><span class="s2">;</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">StringLiteral</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">Literal</span><span class="s2">) {</span>
                <span class="s0">// this is not directive</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">directive </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">token</span><span class="s2">.</span><span class="s1">start </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">, </span><span class="s1">token</span><span class="s2">.</span><span class="s1">end </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">directive </span><span class="s2">=== </span><span class="s4">'use strict'</span><span class="s2">) {</span>
                <span class="s1">strict </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">) {</span>
                    <span class="s1">throwErrorTolerant</span><span class="s2">(</span><span class="s1">firstRestricted</span><span class="s2">, </span><span class="s1">Messages</span><span class="s2">.</span><span class="s1">StrictOctalLiteral</span><span class="s2">);</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s3">if </span><span class="s2">(!</span><span class="s1">firstRestricted </span><span class="s2">&amp;&amp; </span><span class="s1">token</span><span class="s2">.</span><span class="s1">octal</span><span class="s2">) {</span>
                    <span class="s1">firstRestricted </span><span class="s2">= </span><span class="s1">token</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">while </span><span class="s2">(</span><span class="s1">index </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">) {</span>
            <span class="s1">sourceElement </span><span class="s2">= </span><span class="s1">parseSourceElement</span><span class="s2">();</span>
            <span class="s0">/* istanbul ignore if */</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">sourceElement </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">break</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">sourceElements</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">sourceElement</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">sourceElements</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parseProgram</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">body</span><span class="s2">, </span><span class="s1">startToken</span><span class="s2">;</span>

        <span class="s1">skipComment</span><span class="s2">();</span>
        <span class="s1">peek</span><span class="s2">();</span>
        <span class="s1">startToken </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
        <span class="s1">strict </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

        <span class="s1">body </span><span class="s2">= </span><span class="s1">parseSourceElements</span><span class="s2">();</span>
        <span class="s3">return </span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">markEnd</span><span class="s2">(</span><span class="s1">delegate</span><span class="s2">.</span><span class="s1">createProgram</span><span class="s2">(</span><span class="s1">body</span><span class="s2">), </span><span class="s1">startToken</span><span class="s2">);</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">filterTokenLocation</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">i</span><span class="s2">, </span><span class="s1">entry</span><span class="s2">, </span><span class="s1">token</span><span class="s2">, </span><span class="s1">tokens </span><span class="s2">= [];</span>

        <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
            <span class="s1">entry </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
            <span class="s1">token </span><span class="s2">= {</span>
                <span class="s1">type</span><span class="s2">: </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">type</span><span class="s2">,</span>
                <span class="s1">value</span><span class="s2">: </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">value</span>
            <span class="s2">};</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">range</span><span class="s2">) {</span>
                <span class="s1">token</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">) {</span>
                <span class="s1">token</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= </span><span class="s1">entry</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s1">tokens</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">token</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s1">tokens</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">tokenize</span><span class="s2">(</span><span class="s1">code</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">toString</span><span class="s2">,</span>
            <span class="s1">token</span><span class="s2">,</span>
            <span class="s1">tokens</span><span class="s2">;</span>

        <span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">code </span><span class="s2">!== </span><span class="s4">'string' </span><span class="s2">&amp;&amp; !(</span><span class="s1">code </span><span class="s3">instanceof </span><span class="s1">String</span><span class="s2">)) {</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">delegate </span><span class="s2">= </span><span class="s1">SyntaxTreeDelegate</span><span class="s2">;</span>
        <span class="s1">source </span><span class="s2">= </span><span class="s1">code</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) ? </span><span class="s5">1 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">length </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">state </span><span class="s2">= {</span>
            <span class="s1">allowIn</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">labelSet</span><span class="s2">: {},</span>
            <span class="s1">inFunctionBody</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inIteration</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inSwitch</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">lastCommentStart</span><span class="s2">: -</span><span class="s5">1</span>
        <span class="s2">};</span>

        <span class="s1">extra </span><span class="s2">= {};</span>

        <span class="s0">// Options matching.</span>
        <span class="s1">options </span><span class="s2">= </span><span class="s1">options </span><span class="s2">|| {};</span>

        <span class="s0">// Of course we collect tokens here.</span>
        <span class="s1">options</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= [];</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s0">// The following two fields are necessary to compute the Regex tokens.</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">openParenToken </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">openCurlyToken </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>

        <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
        <span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= [];</span>
        <span class="s2">}</span>

        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">peek</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s2">}</span>

            <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s3">while </span><span class="s2">(</span><span class="s1">lookahead</span><span class="s2">.</span><span class="s1">type </span><span class="s2">!== </span><span class="s1">Token</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">) {</span>
                <span class="s3">try </span><span class="s2">{</span>
                    <span class="s1">token </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
                <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">lexError</span><span class="s2">) {</span>
                    <span class="s1">token </span><span class="s2">= </span><span class="s1">lookahead</span><span class="s2">;</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">) {</span>
                        <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">lexError</span><span class="s2">);</span>
                        <span class="s0">// We have to break on the first error</span>
                        <span class="s0">// to avoid infinite loops.</span>
                        <span class="s3">break</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                        <span class="s3">throw </span><span class="s1">lexError</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
            <span class="s2">}</span>

            <span class="s1">filterTokenLocation</span><span class="s2">();</span>
            <span class="s1">tokens </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">tokens</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">tokens</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
            <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">tokens</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">function </span><span class="s1">parse</span><span class="s2">(</span><span class="s1">code</span><span class="s2">, </span><span class="s1">options</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">program</span><span class="s2">, </span><span class="s1">toString</span><span class="s2">;</span>

        <span class="s1">toString </span><span class="s2">= </span><span class="s1">String</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">code </span><span class="s2">!== </span><span class="s4">'string' </span><span class="s2">&amp;&amp; !(</span><span class="s1">code </span><span class="s3">instanceof </span><span class="s1">String</span><span class="s2">)) {</span>
            <span class="s1">code </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">code</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s1">delegate </span><span class="s2">= </span><span class="s1">SyntaxTreeDelegate</span><span class="s2">;</span>
        <span class="s1">source </span><span class="s2">= </span><span class="s1">code</span><span class="s2">;</span>
        <span class="s1">index </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineNumber </span><span class="s2">= (</span><span class="s1">source</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) ? </span><span class="s5">1 </span><span class="s2">: </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">lineStart </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s1">length </span><span class="s2">= </span><span class="s1">source</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s1">lookahead </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
        <span class="s1">state </span><span class="s2">= {</span>
            <span class="s1">allowIn</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
            <span class="s1">labelSet</span><span class="s2">: {},</span>
            <span class="s1">inFunctionBody</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inIteration</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">inSwitch</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
            <span class="s1">lastCommentStart</span><span class="s2">: -</span><span class="s5">1</span>
        <span class="s2">};</span>

        <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">loc</span><span class="s2">;</span>
            <span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment </span><span class="s2">= (</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">attachComment </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">) &amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">;</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">loc </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">source </span><span class="s2">!== </span><span class="s3">null </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">source </span><span class="s2">!== </span><span class="s1">undefined</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">source </span><span class="s2">= </span><span class="s1">toString</span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">source</span><span class="s2">);</span>
            <span class="s2">}</span>

            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">comment</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">&amp;&amp; </span><span class="s1">options</span><span class="s2">.</span><span class="s1">tolerant</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= [];</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">extra</span><span class="s2">.</span><span class="s1">attachComment</span><span class="s2">) {</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">bottomRightStack </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">trailingComments </span><span class="s2">= [];</span>
                <span class="s1">extra</span><span class="s2">.</span><span class="s1">leadingComments </span><span class="s2">= [];</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">try </span><span class="s2">{</span>
            <span class="s1">program </span><span class="s2">= </span><span class="s1">parseProgram</span><span class="s2">();</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">comments </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">comments</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">filterTokenLocation</span><span class="s2">();</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">tokens </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">tokens</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">program</span><span class="s2">.</span><span class="s1">errors </span><span class="s2">= </span><span class="s1">extra</span><span class="s2">.</span><span class="s1">errors</span><span class="s2">;</span>
            <span class="s2">}</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
            <span class="s3">throw </span><span class="s1">e</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">finally </span><span class="s2">{</span>
            <span class="s1">extra </span><span class="s2">= {};</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">program</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s0">// Sync with *.json manifests.</span>
    <span class="s1">exports</span><span class="s2">.</span><span class="s1">version </span><span class="s2">= </span><span class="s4">'1.2.2'</span><span class="s2">;</span>

    <span class="s1">exports</span><span class="s2">.</span><span class="s1">tokenize </span><span class="s2">= </span><span class="s1">tokenize</span><span class="s2">;</span>

    <span class="s1">exports</span><span class="s2">.</span><span class="s1">parse </span><span class="s2">= </span><span class="s1">parse</span><span class="s2">;</span>

    <span class="s0">// Deep copy.</span>
   <span class="s0">/* istanbul ignore next */</span>
    <span class="s1">exports</span><span class="s2">.</span><span class="s1">Syntax </span><span class="s2">= (</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">name</span><span class="s2">, </span><span class="s1">types </span><span class="s2">= {};</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">types </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s3">null</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">for </span><span class="s2">(</span><span class="s1">name </span><span class="s3">in </span><span class="s1">Syntax</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">Syntax</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s1">types</span><span class="s2">[</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">Syntax</span><span class="s2">[</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">Object</span><span class="s2">.</span><span class="s1">freeze</span><span class="s2">(</span><span class="s1">types</span><span class="s2">);</span>
        <span class="s2">}</span>

        <span class="s3">return </span><span class="s1">types</span><span class="s2">;</span>
    <span class="s2">}());</span>

<span class="s2">}));</span>
<span class="s0">/* vim: set sw=4 ts=4 et tw=80 : */</span>

<span class="s2">},{}],</span><span class="s5">1</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">process</span><span class="s2">){</span>
<span class="s0">/* parser generated by jison 0.4.13 */</span>
<span class="s0">/* 
  Returns a Parser object of the following structure: 
 
  Parser: { 
    yy: {} 
  } 
 
  Parser.prototype: { 
    yy: {}, 
    trace: function(), 
    symbols_: {associative list: name ==&gt; number}, 
    terminals_: {associative list: number ==&gt; name}, 
    productions_: [...], 
    performAction: function anonymous(yytext, yyleng, yylineno, yy, yystate, $$, _$), 
    table: [...], 
    defaultActions: {...}, 
    parseError: function(str, hash), 
    parse: function(input), 
 
    lexer: { 
        EOF: 1, 
        parseError: function(str, hash), 
        setInput: function(input), 
        input: function(), 
        unput: function(str), 
        more: function(), 
        less: function(n), 
        pastInput: function(), 
        upcomingInput: function(), 
        showPosition: function(), 
        test_match: function(regex_match_array, rule_index), 
        next: function(), 
        lex: function(), 
        begin: function(condition), 
        popState: function(), 
        _currentRules: function(), 
        topState: function(), 
        pushState: function(condition), 
 
        options: { 
            ranges: boolean           (optional: true ==&gt; token location info will include a .range[] member) 
            flex: boolean             (optional: true ==&gt; flex-like lexing behaviour where the rules are tested exhaustively to find the longest match) 
            backtrack_lexer: boolean  (optional: true ==&gt; lexer regexes are tested in order and for each matching regex the action code is invoked; the lexer terminates the scan when a token is returned by the action code) 
        }, 
 
        performAction: function(yy, yy_, $avoiding_name_collisions, YY_START), 
        rules: [...], 
        conditions: {associative list: name ==&gt; set}, 
    } 
  } 
 
 
  token location info (@$, _$, etc.): { 
    first_line: n, 
    last_line: n, 
    first_column: n, 
    last_column: n, 
    range: [start_number, end_number]       (where the numbers are indexes into the input string, regular zero-based) 
  } 
 
 
  the parseError function receives a 'hash' object with these members for lexer and parser errors: { 
    text:        (matched text) 
    token:       (the produced terminal token, if any) 
    line:        (yylineno) 
  } 
  while parser (grammar) errors will also provide these members, i.e. parser errors deliver a superset of attributes: { 
    loc:         (yylloc) 
    expected:    (string describing the set of expected tokens) 
    recoverable: (boolean: TRUE when the parser has a error recovery rule available for this particular error) 
  } 
*/</span>
<span class="s3">var </span><span class="s1">parser </span><span class="s2">= (</span><span class="s3">function</span><span class="s2">(){</span>
<span class="s3">var </span><span class="s1">parser </span><span class="s2">= {</span><span class="s1">trace</span><span class="s2">: </span><span class="s3">function </span><span class="s1">trace</span><span class="s2">() { },</span>
<span class="s1">yy</span><span class="s2">: {},</span>
<span class="s1">symbols_</span><span class="s2">: {</span><span class="s4">&quot;error&quot;</span><span class="s2">:</span><span class="s5">2</span><span class="s2">,</span><span class="s4">&quot;JSON_PATH&quot;</span><span class="s2">:</span><span class="s5">3</span><span class="s2">,</span><span class="s4">&quot;DOLLAR&quot;</span><span class="s2">:</span><span class="s5">4</span><span class="s2">,</span><span class="s4">&quot;PATH_COMPONENTS&quot;</span><span class="s2">:</span><span class="s5">5</span><span class="s2">,</span><span class="s4">&quot;LEADING_CHILD_MEMBER_EXPRESSION&quot;</span><span class="s2">:</span><span class="s5">6</span><span class="s2">,</span><span class="s4">&quot;PATH_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">7</span><span class="s2">,</span><span class="s4">&quot;MEMBER_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">8</span><span class="s2">,</span><span class="s4">&quot;SUBSCRIPT_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">9</span><span class="s2">,</span><span class="s4">&quot;CHILD_MEMBER_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">10</span><span class="s2">,</span><span class="s4">&quot;DESCENDANT_MEMBER_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">11</span><span class="s2">,</span><span class="s4">&quot;DOT&quot;</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s4">&quot;MEMBER_EXPRESSION&quot;</span><span class="s2">:</span><span class="s5">13</span><span class="s2">,</span><span class="s4">&quot;DOT_DOT&quot;</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s4">&quot;STAR&quot;</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s4">&quot;IDENTIFIER&quot;</span><span class="s2">:</span><span class="s5">16</span><span class="s2">,</span><span class="s4">&quot;SCRIPT_EXPRESSION&quot;</span><span class="s2">:</span><span class="s5">17</span><span class="s2">,</span><span class="s4">&quot;INTEGER&quot;</span><span class="s2">:</span><span class="s5">18</span><span class="s2">,</span><span class="s4">&quot;END&quot;</span><span class="s2">:</span><span class="s5">19</span><span class="s2">,</span><span class="s4">&quot;CHILD_SUBSCRIPT_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">20</span><span class="s2">,</span><span class="s4">&quot;DESCENDANT_SUBSCRIPT_COMPONENT&quot;</span><span class="s2">:</span><span class="s5">21</span><span class="s2">,</span><span class="s4">&quot;[&quot;</span><span class="s2">:</span><span class="s5">22</span><span class="s2">,</span><span class="s4">&quot;SUBSCRIPT&quot;</span><span class="s2">:</span><span class="s5">23</span><span class="s2">,</span><span class="s4">&quot;]&quot;</span><span class="s2">:</span><span class="s5">24</span><span class="s2">,</span><span class="s4">&quot;SUBSCRIPT_EXPRESSION&quot;</span><span class="s2">:</span><span class="s5">25</span><span class="s2">,</span><span class="s4">&quot;SUBSCRIPT_EXPRESSION_LIST&quot;</span><span class="s2">:</span><span class="s5">26</span><span class="s2">,</span><span class="s4">&quot;SUBSCRIPT_EXPRESSION_LISTABLE&quot;</span><span class="s2">:</span><span class="s5">27</span><span class="s2">,</span><span class="s4">&quot;,&quot;</span><span class="s2">:</span><span class="s5">28</span><span class="s2">,</span><span class="s4">&quot;STRING_LITERAL&quot;</span><span class="s2">:</span><span class="s5">29</span><span class="s2">,</span><span class="s4">&quot;ARRAY_SLICE&quot;</span><span class="s2">:</span><span class="s5">30</span><span class="s2">,</span><span class="s4">&quot;FILTER_EXPRESSION&quot;</span><span class="s2">:</span><span class="s5">31</span><span class="s2">,</span><span class="s4">&quot;QQ_STRING&quot;</span><span class="s2">:</span><span class="s5">32</span><span class="s2">,</span><span class="s4">&quot;Q_STRING&quot;</span><span class="s2">:</span><span class="s5">33</span><span class="s2">,</span><span class="s4">&quot;$accept&quot;</span><span class="s2">:</span><span class="s5">0</span><span class="s2">,</span><span class="s4">&quot;$end&quot;</span><span class="s2">:</span><span class="s5">1</span><span class="s2">},</span>
<span class="s1">terminals_</span><span class="s2">: {</span><span class="s5">2</span><span class="s2">:</span><span class="s4">&quot;error&quot;</span><span class="s2">,</span><span class="s5">4</span><span class="s2">:</span><span class="s4">&quot;DOLLAR&quot;</span><span class="s2">,</span><span class="s5">12</span><span class="s2">:</span><span class="s4">&quot;DOT&quot;</span><span class="s2">,</span><span class="s5">14</span><span class="s2">:</span><span class="s4">&quot;DOT_DOT&quot;</span><span class="s2">,</span><span class="s5">15</span><span class="s2">:</span><span class="s4">&quot;STAR&quot;</span><span class="s2">,</span><span class="s5">16</span><span class="s2">:</span><span class="s4">&quot;IDENTIFIER&quot;</span><span class="s2">,</span><span class="s5">17</span><span class="s2">:</span><span class="s4">&quot;SCRIPT_EXPRESSION&quot;</span><span class="s2">,</span><span class="s5">18</span><span class="s2">:</span><span class="s4">&quot;INTEGER&quot;</span><span class="s2">,</span><span class="s5">19</span><span class="s2">:</span><span class="s4">&quot;END&quot;</span><span class="s2">,</span><span class="s5">22</span><span class="s2">:</span><span class="s4">&quot;[&quot;</span><span class="s2">,</span><span class="s5">24</span><span class="s2">:</span><span class="s4">&quot;]&quot;</span><span class="s2">,</span><span class="s5">28</span><span class="s2">:</span><span class="s4">&quot;,&quot;</span><span class="s2">,</span><span class="s5">30</span><span class="s2">:</span><span class="s4">&quot;ARRAY_SLICE&quot;</span><span class="s2">,</span><span class="s5">31</span><span class="s2">:</span><span class="s4">&quot;FILTER_EXPRESSION&quot;</span><span class="s2">,</span><span class="s5">32</span><span class="s2">:</span><span class="s4">&quot;QQ_STRING&quot;</span><span class="s2">,</span><span class="s5">33</span><span class="s2">:</span><span class="s4">&quot;Q_STRING&quot;</span><span class="s2">},</span>
<span class="s1">productions_</span><span class="s2">: [</span><span class="s5">0</span><span class="s2">,[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">3</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">5</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],[</span><span class="s5">7</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">7</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">8</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">8</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">10</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],[</span><span class="s5">6</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">11</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],[</span><span class="s5">13</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">13</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">13</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">13</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">13</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">9</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">9</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">20</span><span class="s2">,</span><span class="s5">3</span><span class="s2">],[</span><span class="s5">21</span><span class="s2">,</span><span class="s5">4</span><span class="s2">],[</span><span class="s5">23</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">23</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">26</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">26</span><span class="s2">,</span><span class="s5">3</span><span class="s2">],[</span><span class="s5">27</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">27</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">27</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">25</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">25</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">25</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">29</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],[</span><span class="s5">29</span><span class="s2">,</span><span class="s5">1</span><span class="s2">]],</span>
<span class="s1">performAction</span><span class="s2">: </span><span class="s3">function </span><span class="s1">anonymous</span><span class="s2">(</span><span class="s1">yytext</span><span class="s2">, </span><span class="s1">yyleng</span><span class="s2">, </span><span class="s1">yylineno</span><span class="s2">, </span><span class="s1">yy</span><span class="s2">, </span><span class="s1">yystate </span><span class="s0">/* action[1] */</span><span class="s2">, </span><span class="s1">$$ </span><span class="s0">/* vstack */</span><span class="s2">, </span><span class="s1">_$ </span><span class="s0">/* lstack */</span>
<span class="s0">/**/</span><span class="s2">) {</span>
<span class="s0">/* this == yyval */</span>
<span class="s3">if </span><span class="s2">(!</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">) {</span>
    <span class="s1">yy</span><span class="s2">.</span><span class="s1">ast </span><span class="s2">= </span><span class="s1">_ast</span><span class="s2">;</span>
    <span class="s1">_ast</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s3">var </span><span class="s1">$0 </span><span class="s2">= </span><span class="s1">$$</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
<span class="s3">switch </span><span class="s2">(</span><span class="s1">yystate</span><span class="s2">) {</span>
<span class="s3">case </span><span class="s5">1</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;root&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }); </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(); </span><span class="s3">return </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">yield</span><span class="s2">()</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">2</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;root&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">-</span><span class="s5">1</span><span class="s2">] } }); </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(); </span><span class="s3">return </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">yield</span><span class="s2">()</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">3</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(); </span><span class="s3">return </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">yield</span><span class="s2">()</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">4</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">&quot;member&quot;</span><span class="s2">, </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;child&quot;</span><span class="s2">, </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;identifier&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">-</span><span class="s5">1</span><span class="s2">] }}); </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(); </span><span class="s3">return </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">yield</span><span class="s2">()</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">5</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">6</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">7</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">&quot;member&quot; </span><span class="s2">}); </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">push</span><span class="s2">()</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">8</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">&quot;subscript&quot; </span><span class="s2">}); </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">push</span><span class="s2">() </span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">9</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;child&quot; </span><span class="s2">})</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">10</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;descendant&quot; </span><span class="s2">})</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">11</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">12</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;child&quot;</span><span class="s2">, </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">&quot;member&quot; </span><span class="s2">})</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">13</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">14</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;wildcard&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } })</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">15</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;identifier&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } })</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">16</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;script_expression&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } })</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">17</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;numeric_literal&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]) } })</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">18</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">19</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;child&quot; </span><span class="s2">})</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">20</span><span class="s2">:</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">&quot;descendant&quot; </span><span class="s2">})</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">21</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">22</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">23</span><span class="s2">:</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">24</span><span class="s2">:</span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">].</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">? </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">({ </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;union&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }) : </span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">25</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= [</span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]]</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">26</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">-</span><span class="s5">2</span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">])</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">27</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;numeric_literal&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]) } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">28</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;string_literal&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">29</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;slice&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">30</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;wildcard&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">31</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;script_expression&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">32</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;filter_expression&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">] } }; </span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">set</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$</span><span class="s2">)</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">33</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">34</span><span class="s2">:</span><span class="s3">this</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= </span><span class="s1">$$</span><span class="s2">[</span><span class="s1">$0</span><span class="s2">]</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s2">},</span>
<span class="s1">table</span><span class="s2">: [{</span><span class="s5">3</span><span class="s2">:</span><span class="s5">1</span><span class="s2">,</span><span class="s5">4</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],</span><span class="s5">6</span><span class="s2">:</span><span class="s5">3</span><span class="s2">,</span><span class="s5">13</span><span class="s2">:</span><span class="s5">4</span><span class="s2">,</span><span class="s5">15</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">16</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">17</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">19</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">9</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">3</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">1</span><span class="s2">],</span><span class="s5">5</span><span class="s2">:</span><span class="s5">10</span><span class="s2">,</span><span class="s5">7</span><span class="s2">:</span><span class="s5">11</span><span class="s2">,</span><span class="s5">8</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s5">9</span><span class="s2">:</span><span class="s5">13</span><span class="s2">,</span><span class="s5">10</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s5">11</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">20</span><span class="s2">:</span><span class="s5">16</span><span class="s2">,</span><span class="s5">21</span><span class="s2">:</span><span class="s5">17</span><span class="s2">,</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">20</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">3</span><span class="s2">],</span><span class="s5">5</span><span class="s2">:</span><span class="s5">21</span><span class="s2">,</span><span class="s5">7</span><span class="s2">:</span><span class="s5">11</span><span class="s2">,</span><span class="s5">8</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s5">9</span><span class="s2">:</span><span class="s5">13</span><span class="s2">,</span><span class="s5">10</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s5">11</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">20</span><span class="s2">:</span><span class="s5">16</span><span class="s2">,</span><span class="s5">21</span><span class="s2">:</span><span class="s5">17</span><span class="s2">,</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">20</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">12</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">12</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">12</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">12</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">14</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">14</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">14</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">14</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">15</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">15</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">15</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">15</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">16</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">16</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">16</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">16</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">17</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">17</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">17</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">17</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">18</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">2</span><span class="s2">],</span><span class="s5">7</span><span class="s2">:</span><span class="s5">22</span><span class="s2">,</span><span class="s5">8</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s5">9</span><span class="s2">:</span><span class="s5">13</span><span class="s2">,</span><span class="s5">10</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s5">11</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">20</span><span class="s2">:</span><span class="s5">16</span><span class="s2">,</span><span class="s5">21</span><span class="s2">:</span><span class="s5">17</span><span class="s2">,</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">20</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">5</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">7</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">8</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">9</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">9</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">9</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">9</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">10</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">10</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">10</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">10</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">19</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">20</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">20</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">20</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">20</span><span class="s2">]},{</span><span class="s5">13</span><span class="s2">:</span><span class="s5">23</span><span class="s2">,</span><span class="s5">15</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">16</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">17</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">19</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">9</span><span class="s2">]},{</span><span class="s5">13</span><span class="s2">:</span><span class="s5">24</span><span class="s2">,</span><span class="s5">15</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">5</span><span class="s2">],</span><span class="s5">16</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">17</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">7</span><span class="s2">],</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">8</span><span class="s2">],</span><span class="s5">19</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">9</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">25</span><span class="s2">]},{</span><span class="s5">15</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">29</span><span class="s2">],</span><span class="s5">17</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">30</span><span class="s2">],</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">33</span><span class="s2">],</span><span class="s5">23</span><span class="s2">:</span><span class="s5">26</span><span class="s2">,</span><span class="s5">25</span><span class="s2">:</span><span class="s5">27</span><span class="s2">,</span><span class="s5">26</span><span class="s2">:</span><span class="s5">28</span><span class="s2">,</span><span class="s5">27</span><span class="s2">:</span><span class="s5">32</span><span class="s2">,</span><span class="s5">29</span><span class="s2">:</span><span class="s5">34</span><span class="s2">,</span><span class="s5">30</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">35</span><span class="s2">],</span><span class="s5">31</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">31</span><span class="s2">],</span><span class="s5">32</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">36</span><span class="s2">],</span><span class="s5">33</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">37</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">4</span><span class="s2">],</span><span class="s5">7</span><span class="s2">:</span><span class="s5">22</span><span class="s2">,</span><span class="s5">8</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s5">9</span><span class="s2">:</span><span class="s5">13</span><span class="s2">,</span><span class="s5">10</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s5">11</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">18</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">19</span><span class="s2">],</span><span class="s5">20</span><span class="s2">:</span><span class="s5">16</span><span class="s2">,</span><span class="s5">21</span><span class="s2">:</span><span class="s5">17</span><span class="s2">,</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">20</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">6</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">6</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">11</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">11</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">11</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">11</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">13</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">13</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">13</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">13</span><span class="s2">]},{</span><span class="s5">15</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">29</span><span class="s2">],</span><span class="s5">17</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">30</span><span class="s2">],</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">33</span><span class="s2">],</span><span class="s5">23</span><span class="s2">:</span><span class="s5">38</span><span class="s2">,</span><span class="s5">25</span><span class="s2">:</span><span class="s5">27</span><span class="s2">,</span><span class="s5">26</span><span class="s2">:</span><span class="s5">28</span><span class="s2">,</span><span class="s5">27</span><span class="s2">:</span><span class="s5">32</span><span class="s2">,</span><span class="s5">29</span><span class="s2">:</span><span class="s5">34</span><span class="s2">,</span><span class="s5">30</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">35</span><span class="s2">],</span><span class="s5">31</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">31</span><span class="s2">],</span><span class="s5">32</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">36</span><span class="s2">],</span><span class="s5">33</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">37</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">39</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">23</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">24</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">40</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">30</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">31</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">32</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">25</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">25</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">27</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">27</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">28</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">28</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">29</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">29</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">33</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">33</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">34</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">34</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">41</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">21</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">21</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">21</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">21</span><span class="s2">]},{</span><span class="s5">18</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">33</span><span class="s2">],</span><span class="s5">27</span><span class="s2">:</span><span class="s5">42</span><span class="s2">,</span><span class="s5">29</span><span class="s2">:</span><span class="s5">34</span><span class="s2">,</span><span class="s5">30</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">35</span><span class="s2">],</span><span class="s5">32</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">36</span><span class="s2">],</span><span class="s5">33</span><span class="s2">:[</span><span class="s5">1</span><span class="s2">,</span><span class="s5">37</span><span class="s2">]},{</span><span class="s5">1</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">22</span><span class="s2">],</span><span class="s5">12</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">22</span><span class="s2">],</span><span class="s5">14</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">22</span><span class="s2">],</span><span class="s5">22</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">22</span><span class="s2">]},{</span><span class="s5">24</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">26</span><span class="s2">],</span><span class="s5">28</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">26</span><span class="s2">]}],</span>
<span class="s1">defaultActions</span><span class="s2">: {</span><span class="s5">27</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">23</span><span class="s2">],</span><span class="s5">29</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">30</span><span class="s2">],</span><span class="s5">30</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">31</span><span class="s2">],</span><span class="s5">31</span><span class="s2">:[</span><span class="s5">2</span><span class="s2">,</span><span class="s5">32</span><span class="s2">]},</span>
<span class="s1">parseError</span><span class="s2">: </span><span class="s3">function </span><span class="s1">parseError</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">hash</span><span class="s2">.</span><span class="s1">recoverable</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">(</span><span class="s1">str</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">str</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">},</span>
<span class="s1">parse</span><span class="s2">: </span><span class="s3">function </span><span class="s1">parse</span><span class="s2">(</span><span class="s1">input</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">, </span><span class="s1">stack </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">], </span><span class="s1">vstack </span><span class="s2">= [</span><span class="s3">null</span><span class="s2">], </span><span class="s1">lstack </span><span class="s2">= [], </span><span class="s1">table </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">table</span><span class="s2">, </span><span class="s1">yytext </span><span class="s2">= </span><span class="s4">''</span><span class="s2">, </span><span class="s1">yylineno </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">yyleng </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">recovering </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">TERROR </span><span class="s2">= </span><span class="s5">2</span><span class="s2">, </span><span class="s1">EOF </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">setInput</span><span class="s2">(</span><span class="s1">input</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yy </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">lexer </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parser </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylloc </span><span class="s2">== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylloc </span><span class="s2">= {};</span>
    <span class="s2">}</span>
    <span class="s3">var </span><span class="s1">yyloc </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">;</span>
    <span class="s1">lstack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">yyloc</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">ranges </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">options </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parseError </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">parseError </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">parseError </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">getPrototypeOf</span><span class="s2">(</span><span class="s3">this</span><span class="s2">).</span><span class="s1">parseError</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">function </span><span class="s1">popStack</span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
        <span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2 </span><span class="s2">* </span><span class="s1">n</span><span class="s2">;</span>
        <span class="s1">vstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">= </span><span class="s1">vstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">n</span><span class="s2">;</span>
        <span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">= </span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">n</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">function </span><span class="s1">lex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">;</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">lex</span><span class="s2">() || </span><span class="s1">EOF</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">token </span><span class="s2">!== </span><span class="s4">'number'</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">symbols_</span><span class="s2">[</span><span class="s1">token</span><span class="s2">] || </span><span class="s1">token</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">var </span><span class="s1">symbol</span><span class="s2">, </span><span class="s1">preErrorSymbol</span><span class="s2">, </span><span class="s1">state</span><span class="s2">, </span><span class="s1">action</span><span class="s2">, </span><span class="s1">a</span><span class="s2">, </span><span class="s1">r</span><span class="s2">, </span><span class="s1">yyval </span><span class="s2">= {}, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">len</span><span class="s2">, </span><span class="s1">newState</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">;</span>
    <span class="s3">while </span><span class="s2">(</span><span class="s3">true</span><span class="s2">) {</span>
        <span class="s1">state </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">];</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaultActions</span><span class="s2">[</span><span class="s1">state</span><span class="s2">]) {</span>
            <span class="s1">action </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">defaultActions</span><span class="s2">[</span><span class="s1">state</span><span class="s2">];</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">symbol </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">|| </span><span class="s3">typeof </span><span class="s1">symbol </span><span class="s2">== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s1">symbol </span><span class="s2">= </span><span class="s1">lex</span><span class="s2">();</span>
            <span class="s2">}</span>
            <span class="s1">action </span><span class="s2">= </span><span class="s1">table</span><span class="s2">[</span><span class="s1">state</span><span class="s2">] &amp;&amp; </span><span class="s1">table</span><span class="s2">[</span><span class="s1">state</span><span class="s2">][</span><span class="s1">symbol</span><span class="s2">];</span>
        <span class="s2">}</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">action </span><span class="s2">=== </span><span class="s4">'undefined' </span><span class="s2">|| !</span><span class="s1">action</span><span class="s2">.</span><span class="s1">length </span><span class="s2">|| !</span><span class="s1">action</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
                <span class="s3">var </span><span class="s1">errStr </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
                <span class="s1">expected </span><span class="s2">= [];</span>
                <span class="s3">for </span><span class="s2">(</span><span class="s1">p </span><span class="s3">in </span><span class="s1">table</span><span class="s2">[</span><span class="s1">state</span><span class="s2">]) {</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">terminals_</span><span class="s2">[</span><span class="s1">p</span><span class="s2">] &amp;&amp; </span><span class="s1">p </span><span class="s2">&gt; </span><span class="s1">TERROR</span><span class="s2">) {</span>
                        <span class="s1">expected</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">terminals_</span><span class="s2">[</span><span class="s1">p</span><span class="s2">] + </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">);</span>
                    <span class="s2">}</span>
                <span class="s2">}</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">showPosition</span><span class="s2">) {</span>
                    <span class="s1">errStr </span><span class="s2">= </span><span class="s4">'Parse error on line ' </span><span class="s2">+ (</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) + </span><span class="s4">':</span><span class="s3">\n</span><span class="s4">' </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">showPosition</span><span class="s2">() + </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">Expecting ' </span><span class="s2">+ </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">', '</span><span class="s2">) + </span><span class="s4">', got </span><span class="s3">\'</span><span class="s4">' </span><span class="s2">+ (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">terminals_</span><span class="s2">[</span><span class="s1">symbol</span><span class="s2">] || </span><span class="s1">symbol</span><span class="s2">) + </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">;</span>
                <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                    <span class="s1">errStr </span><span class="s2">= </span><span class="s4">'Parse error on line ' </span><span class="s2">+ (</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) + </span><span class="s4">': Unexpected ' </span><span class="s2">+ (</span><span class="s1">symbol </span><span class="s2">== </span><span class="s1">EOF </span><span class="s2">? </span><span class="s4">'end of input' </span><span class="s2">: </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">+ (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">terminals_</span><span class="s2">[</span><span class="s1">symbol</span><span class="s2">] || </span><span class="s1">symbol</span><span class="s2">) + </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">);</span>
                <span class="s2">}</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">(</span><span class="s1">errStr</span><span class="s2">, {</span>
                    <span class="s1">text</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">match</span><span class="s2">,</span>
                    <span class="s1">token</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">terminals_</span><span class="s2">[</span><span class="s1">symbol</span><span class="s2">] || </span><span class="s1">symbol</span><span class="s2">,</span>
                    <span class="s1">line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylineno</span><span class="s2">,</span>
                    <span class="s1">loc</span><span class="s2">: </span><span class="s1">yyloc</span><span class="s2">,</span>
                    <span class="s1">expected</span><span class="s2">: </span><span class="s1">expected</span>
                <span class="s2">});</span>
            <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">action</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] </span><span class="s3">instanceof </span><span class="s1">Array </span><span class="s2">&amp;&amp; </span><span class="s1">action</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'Parse Error: multiple actions possible at state: ' </span><span class="s2">+ </span><span class="s1">state </span><span class="s2">+ </span><span class="s4">', token: ' </span><span class="s2">+ </span><span class="s1">symbol</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">switch </span><span class="s2">(</span><span class="s1">action</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]) {</span>
        <span class="s3">case </span><span class="s5">1</span><span class="s2">:</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">symbol</span><span class="s2">);</span>
            <span class="s1">vstack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">);</span>
            <span class="s1">lstack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">);</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">action</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]);</span>
            <span class="s1">symbol </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(!</span><span class="s1">preErrorSymbol</span><span class="s2">) {</span>
                <span class="s1">yyleng </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">;</span>
                <span class="s1">yytext </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">;</span>
                <span class="s1">yylineno </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylineno</span><span class="s2">;</span>
                <span class="s1">yyloc </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">lexer</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">recovering </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
                    <span class="s1">recovering</span><span class="s2">--;</span>
                <span class="s2">}</span>
            <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                <span class="s1">symbol </span><span class="s2">= </span><span class="s1">preErrorSymbol</span><span class="s2">;</span>
                <span class="s1">preErrorSymbol </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">break</span><span class="s2">;</span>
        <span class="s3">case </span><span class="s5">2</span><span class="s2">:</span>
            <span class="s1">len </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">productions_</span><span class="s2">[</span><span class="s1">action</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]][</span><span class="s5">1</span><span class="s2">];</span>
            <span class="s1">yyval</span><span class="s2">.</span><span class="s1">$ </span><span class="s2">= </span><span class="s1">vstack</span><span class="s2">[</span><span class="s1">vstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">len</span><span class="s2">];</span>
            <span class="s1">yyval</span><span class="s2">.</span><span class="s1">_$ </span><span class="s2">= {</span>
                <span class="s1">first_line</span><span class="s2">: </span><span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- (</span><span class="s1">len </span><span class="s2">|| </span><span class="s5">1</span><span class="s2">)].</span><span class="s1">first_line</span><span class="s2">,</span>
                <span class="s1">last_line</span><span class="s2">: </span><span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">last_line</span><span class="s2">,</span>
                <span class="s1">first_column</span><span class="s2">: </span><span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- (</span><span class="s1">len </span><span class="s2">|| </span><span class="s5">1</span><span class="s2">)].</span><span class="s1">first_column</span><span class="s2">,</span>
                <span class="s1">last_column</span><span class="s2">: </span><span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">last_column</span>
            <span class="s2">};</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ranges</span><span class="s2">) {</span>
                <span class="s1">yyval</span><span class="s2">.</span><span class="s1">_$</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span>
                    <span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- (</span><span class="s1">len </span><span class="s2">|| </span><span class="s5">1</span><span class="s2">)].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">0</span><span class="s2">],</span>
                    <span class="s1">lstack</span><span class="s2">[</span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]</span>
                <span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s1">r </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">performAction</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">yyval</span><span class="s2">, [</span>
                <span class="s1">yytext</span><span class="s2">,</span>
                <span class="s1">yyleng</span><span class="s2">,</span>
                <span class="s1">yylineno</span><span class="s2">,</span>
                <span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">,</span>
                <span class="s1">action</span><span class="s2">[</span><span class="s5">1</span><span class="s2">],</span>
                <span class="s1">vstack</span><span class="s2">,</span>
                <span class="s1">lstack</span>
            <span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">args</span><span class="s2">));</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">r </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">len</span><span class="s2">) {</span>
                <span class="s1">stack </span><span class="s2">= </span><span class="s1">stack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1 </span><span class="s2">* </span><span class="s1">len </span><span class="s2">* </span><span class="s5">2</span><span class="s2">);</span>
                <span class="s1">vstack </span><span class="s2">= </span><span class="s1">vstack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1 </span><span class="s2">* </span><span class="s1">len</span><span class="s2">);</span>
                <span class="s1">lstack </span><span class="s2">= </span><span class="s1">lstack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, -</span><span class="s5">1 </span><span class="s2">* </span><span class="s1">len</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">productions_</span><span class="s2">[</span><span class="s1">action</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]][</span><span class="s5">0</span><span class="s2">]);</span>
            <span class="s1">vstack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">yyval</span><span class="s2">.</span><span class="s1">$</span><span class="s2">);</span>
            <span class="s1">lstack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">yyval</span><span class="s2">.</span><span class="s1">_$</span><span class="s2">);</span>
            <span class="s1">newState </span><span class="s2">= </span><span class="s1">table</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">]][</span><span class="s1">stack</span><span class="s2">[</span><span class="s1">stack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]];</span>
            <span class="s1">stack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">newState</span><span class="s2">);</span>
            <span class="s3">break</span><span class="s2">;</span>
        <span class="s3">case </span><span class="s5">3</span><span class="s2">:</span>
            <span class="s3">return true</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s3">return true</span><span class="s2">;</span>
<span class="s2">}};</span>
<span class="s3">var </span><span class="s1">_ast </span><span class="s2">= {</span>

  <span class="s1">initialize</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_nodes </span><span class="s2">= [];</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_node </span><span class="s2">= {};</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_stash </span><span class="s2">= [];</span>
  <span class="s2">},</span>

  <span class="s1">set</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">props</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">k </span><span class="s3">in </span><span class="s1">props</span><span class="s2">) </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_node</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">props</span><span class="s2">[</span><span class="s1">k</span><span class="s2">];</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">_node</span><span class="s2">;</span>
  <span class="s2">},</span>

  <span class="s1">node</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_node </span><span class="s2">= </span><span class="s1">obj</span><span class="s2">;</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">_node</span><span class="s2">;</span>
  <span class="s2">},</span>

  <span class="s1">push</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_nodes</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_node</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_node </span><span class="s2">= {};</span>
  <span class="s2">},</span>

  <span class="s1">unshift</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_nodes</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_node</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">_node </span><span class="s2">= {};</span>
  <span class="s2">},</span>

  <span class="s3">yield</span><span class="s2">: </span><span class="s3">function</span><span class="s2">() {</span>
    <span class="s3">var </span><span class="s1">_nodes </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_nodes</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">();</span>
    <span class="s3">return </span><span class="s1">_nodes</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">};</span>
<span class="s0">/* generated by jison-lex 0.2.1 */</span>
<span class="s3">var </span><span class="s1">lexer </span><span class="s2">= (</span><span class="s3">function</span><span class="s2">(){</span>
<span class="s3">var </span><span class="s1">lexer </span><span class="s2">= {</span>

<span class="s1">EOF</span><span class="s2">:</span><span class="s5">1</span><span class="s2">,</span>

<span class="s1">parseError</span><span class="s2">:</span><span class="s3">function </span><span class="s1">parseError</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">hash</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">str</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// resets the lexer, sets new input</span>
<span class="s1">setInput</span><span class="s2">:</span><span class="s3">function </span><span class="s2">(</span><span class="s1">input</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_input </span><span class="s2">= </span><span class="s1">input</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_more </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_backtrack </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack </span><span class="s2">= [</span><span class="s4">'INITIAL'</span><span class="s2">];</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc </span><span class="s2">= {</span>
            <span class="s1">first_line</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">first_column</span><span class="s2">: </span><span class="s5">0</span><span class="s2">,</span>
            <span class="s1">last_line</span><span class="s2">: </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">last_column</span><span class="s2">: </span><span class="s5">0</span>
        <span class="s2">};</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s5">0</span><span class="s2">,</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
        <span class="s3">return this</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// consumes and returns one char from the input</span>
<span class="s1">input</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">ch </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">[</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">++;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">++;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">match </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">matched </span><span class="s2">+= </span><span class="s1">ch</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">lines </span><span class="s2">= </span><span class="s1">ch</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/(?:\r\n?|\n).*/g</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lines</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno</span><span class="s2">++;</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_line</span><span class="s2">++;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_column</span><span class="s2">++;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]++;</span>
        <span class="s2">}</span>

        <span class="s3">this</span><span class="s2">.</span><span class="s1">_input </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s1">ch</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// unshifts one char (or a string) into the input</span>
<span class="s1">unput</span><span class="s2">:</span><span class="s3">function </span><span class="s2">(</span><span class="s1">ch</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">len </span><span class="s2">= </span><span class="s1">ch</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">lines </span><span class="s2">= </span><span class="s1">ch</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s6">/(?:\r\n?|\n)/g</span><span class="s2">);</span>

        <span class="s3">this</span><span class="s2">.</span><span class="s1">_input </span><span class="s2">= </span><span class="s1">ch </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">len </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
        <span class="s0">//this.yyleng -= len;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">-= </span><span class="s1">len</span><span class="s2">;</span>
        <span class="s3">var </span><span class="s1">oldLines </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s6">/(?:\r\n?|\n)/g</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">match </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">matched </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">-= </span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">var </span><span class="s1">r </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range</span><span class="s2">;</span>

        <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc </span><span class="s2">= {</span>
            <span class="s1">first_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_line</span><span class="s2">,</span>
            <span class="s1">last_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">first_column</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_column</span><span class="s2">,</span>
            <span class="s1">last_column</span><span class="s2">: </span><span class="s1">lines </span><span class="s2">?</span>
                <span class="s2">(</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s1">oldLines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">? </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_column </span><span class="s2">: </span><span class="s5">0</span><span class="s2">)</span>
                 <span class="s2">+ </span><span class="s1">oldLines</span><span class="s2">[</span><span class="s1">oldLines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length</span><span class="s2">].</span><span class="s1">length </span><span class="s2">- </span><span class="s1">lines</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length </span><span class="s2">:</span>
              <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_column </span><span class="s2">- </span><span class="s1">len</span>
        <span class="s2">};</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s1">r</span><span class="s2">[</span><span class="s5">0</span><span class="s2">], </span><span class="s1">r</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng </span><span class="s2">- </span><span class="s1">len</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s3">return this</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// When called from action, caches matched text and appends it on next action</span>
<span class="s1">more</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_more </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s3">return this</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// When called from action, signals the lexer that this rule fails to match the input, so the next matching rule (regex) should be tested instead.</span>
<span class="s1">reject</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">backtrack_lexer</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">_backtrack </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">(</span><span class="s4">'Lexical error on line ' </span><span class="s2">+ (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) + </span><span class="s4">'. You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).</span><span class="s3">\n</span><span class="s4">' </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">showPosition</span><span class="s2">(), {</span>
                <span class="s1">text</span><span class="s2">: </span><span class="s4">&quot;&quot;</span><span class="s2">,</span>
                <span class="s1">token</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno</span>
            <span class="s2">});</span>

        <span class="s2">}</span>
        <span class="s3">return this</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// retain first n characters of the match</span>
<span class="s1">less</span><span class="s2">:</span><span class="s3">function </span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">unput</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">n</span><span class="s2">));</span>
    <span class="s2">},</span>

<span class="s0">// displays already matched input, i.e. for error messages</span>
<span class="s1">pastInput</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">past </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">past</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">20 </span><span class="s2">? </span><span class="s4">'...'</span><span class="s2">:</span><span class="s4">''</span><span class="s2">) + </span><span class="s1">past</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(-</span><span class="s5">20</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\n/g</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">);</span>
    <span class="s2">},</span>

<span class="s0">// displays upcoming input, i.e. for error messages</span>
<span class="s1">upcomingInput</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">next </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">next</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&lt; </span><span class="s5">20</span><span class="s2">) {</span>
            <span class="s1">next </span><span class="s2">+= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s5">20</span><span class="s2">-</span><span class="s1">next</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">return </span><span class="s2">(</span><span class="s1">next</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">,</span><span class="s5">20</span><span class="s2">) + (</span><span class="s1">next</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">20 </span><span class="s2">? </span><span class="s4">'...' </span><span class="s2">: </span><span class="s4">''</span><span class="s2">)).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\n/g</span><span class="s2">, </span><span class="s4">&quot;&quot;</span><span class="s2">);</span>
    <span class="s2">},</span>

<span class="s0">// displays the character position where the lexing error occurred, i.e. for error messages</span>
<span class="s1">showPosition</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">pre </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">pastInput</span><span class="s2">();</span>
        <span class="s3">var </span><span class="s1">c </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Array</span><span class="s2">(</span><span class="s1">pre</span><span class="s2">.</span><span class="s1">length </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">&quot;-&quot;</span><span class="s2">);</span>
        <span class="s3">return </span><span class="s1">pre </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">upcomingInput</span><span class="s2">() + </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s2">+ </span><span class="s1">c </span><span class="s2">+ </span><span class="s4">&quot;^&quot;</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// test the lexed token: return FALSE when not a match, otherwise return token</span>
<span class="s1">test_match</span><span class="s2">:</span><span class="s3">function </span><span class="s2">(</span><span class="s1">match</span><span class="s2">, </span><span class="s1">indexed_rule</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">token</span><span class="s2">,</span>
            <span class="s1">lines</span><span class="s2">,</span>
            <span class="s1">backup</span><span class="s2">;</span>

        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">backtrack_lexer</span><span class="s2">) {</span>
            <span class="s0">// save context</span>
            <span class="s1">backup </span><span class="s2">= {</span>
                <span class="s1">yylineno</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno</span><span class="s2">,</span>
                <span class="s1">yylloc</span><span class="s2">: {</span>
                    <span class="s1">first_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_line</span><span class="s2">,</span>
                    <span class="s1">last_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">last_line</span><span class="s2">,</span>
                    <span class="s1">first_column</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">first_column</span><span class="s2">,</span>
                    <span class="s1">last_column</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_column</span>
                <span class="s2">},</span>
                <span class="s1">yytext</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">,</span>
                <span class="s1">match</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">match</span><span class="s2">,</span>
                <span class="s1">matches</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matches</span><span class="s2">,</span>
                <span class="s1">matched</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">matched</span><span class="s2">,</span>
                <span class="s1">yyleng</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">,</span>
                <span class="s1">offset</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">,</span>
                <span class="s1">_more</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_more</span><span class="s2">,</span>
                <span class="s1">_input</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">,</span>
                <span class="s1">yy</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">,</span>
                <span class="s1">conditionStack</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">),</span>
                <span class="s1">done</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">done</span>
            <span class="s2">};</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">) {</span>
                <span class="s1">backup</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">);</span>
            <span class="s2">}</span>
        <span class="s2">}</span>

        <span class="s1">lines </span><span class="s2">= </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/(?:\r\n?|\n).*/g</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">lines</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">+= </span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc </span><span class="s2">= {</span>
            <span class="s1">first_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_line</span><span class="s2">,</span>
            <span class="s1">last_line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">,</span>
            <span class="s1">first_column</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_column</span><span class="s2">,</span>
            <span class="s1">last_column</span><span class="s2">: </span><span class="s1">lines </span><span class="s2">?</span>
                         <span class="s1">lines</span><span class="s2">[</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">length </span><span class="s2">- </span><span class="s1">lines</span><span class="s2">[</span><span class="s1">lines</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">].</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/\r?\n?/</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length </span><span class="s2">:</span>
                         <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">last_column </span><span class="s2">+ </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length</span>
        <span class="s2">};</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">+= </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">match </span><span class="s2">+= </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">matches </span><span class="s2">= </span><span class="s1">match</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">ranges</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yylloc</span><span class="s2">.</span><span class="s1">range </span><span class="s2">= [</span><span class="s3">this</span><span class="s2">.</span><span class="s1">offset</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">offset </span><span class="s2">+= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_more </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_backtrack </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">_input </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length</span><span class="s2">);</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">matched </span><span class="s2">+= </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s1">token </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">performAction</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">, </span><span class="s3">this</span><span class="s2">, </span><span class="s1">indexed_rule</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">done </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">token</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_backtrack</span><span class="s2">) {</span>
            <span class="s0">// recover context</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">k </span><span class="s3">in </span><span class="s1">backup</span><span class="s2">) {</span>
                <span class="s3">this</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] = </span><span class="s1">backup</span><span class="s2">[</span><span class="s1">k</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">return false</span><span class="s2">; </span><span class="s0">// rule action called reject() implying the next rule should be tested instead.</span>
        <span class="s2">}</span>
        <span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">},</span>

<span class="s0">// return next match in input</span>
<span class="s1">next</span><span class="s2">:</span><span class="s3">function </span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">done</span><span class="s2">) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">done </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
        <span class="s2">}</span>

        <span class="s3">var </span><span class="s1">token</span><span class="s2">,</span>
            <span class="s1">match</span><span class="s2">,</span>
            <span class="s1">tempMatch</span><span class="s2">,</span>
            <span class="s1">index</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_more</span><span class="s2">) {</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
            <span class="s3">this</span><span class="s2">.</span><span class="s1">match </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">var </span><span class="s1">rules </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_currentRules</span><span class="s2">();</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">rules</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
            <span class="s1">tempMatch </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">rules</span><span class="s2">[</span><span class="s1">rules</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]]);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">tempMatch </span><span class="s2">&amp;&amp; (!</span><span class="s1">match </span><span class="s2">|| </span><span class="s1">tempMatch</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s1">match</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">length</span><span class="s2">)) {</span>
                <span class="s1">match </span><span class="s2">= </span><span class="s1">tempMatch</span><span class="s2">;</span>
                <span class="s1">index </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">backtrack_lexer</span><span class="s2">) {</span>
                    <span class="s1">token </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">test_match</span><span class="s2">(</span><span class="s1">tempMatch</span><span class="s2">, </span><span class="s1">rules</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                    <span class="s3">if </span><span class="s2">(</span><span class="s1">token </span><span class="s2">!== </span><span class="s3">false</span><span class="s2">) {</span>
                        <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
                    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_backtrack</span><span class="s2">) {</span>
                        <span class="s1">match </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
                        <span class="s3">continue</span><span class="s2">; </span><span class="s0">// rule action called reject() implying a rule MISmatch.</span>
                    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
                        <span class="s0">// else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)</span>
                        <span class="s3">return false</span><span class="s2">;</span>
                    <span class="s2">}</span>
                <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s3">this</span><span class="s2">.</span><span class="s1">options</span><span class="s2">.</span><span class="s1">flex</span><span class="s2">) {</span>
                    <span class="s3">break</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">match</span><span class="s2">) {</span>
            <span class="s1">token </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">test_match</span><span class="s2">(</span><span class="s1">match</span><span class="s2">, </span><span class="s1">rules</span><span class="s2">[</span><span class="s1">index</span><span class="s2">]);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">token </span><span class="s2">!== </span><span class="s3">false</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">token</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s0">// else: this is a lexer rule which consumes input without producing a token (e.g. whitespace)</span>
            <span class="s3">return false</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">_input </span><span class="s2">=== </span><span class="s4">&quot;&quot;</span><span class="s2">) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">EOF</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">(</span><span class="s4">'Lexical error on line ' </span><span class="s2">+ (</span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) + </span><span class="s4">'. Unrecognized text.</span><span class="s3">\n</span><span class="s4">' </span><span class="s2">+ </span><span class="s3">this</span><span class="s2">.</span><span class="s1">showPosition</span><span class="s2">(), {</span>
                <span class="s1">text</span><span class="s2">: </span><span class="s4">&quot;&quot;</span><span class="s2">,</span>
                <span class="s1">token</span><span class="s2">: </span><span class="s3">null</span><span class="s2">,</span>
                <span class="s1">line</span><span class="s2">: </span><span class="s3">this</span><span class="s2">.</span><span class="s1">yylineno</span>
            <span class="s2">});</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// return next match that has a token</span>
<span class="s1">lex</span><span class="s2">:</span><span class="s3">function </span><span class="s1">lex</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">r </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">next</span><span class="s2">();</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">r</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">r</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">lex</span><span class="s2">();</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// activates a new lexer condition state (pushes the new lexer condition state onto the condition stack)</span>
<span class="s1">begin</span><span class="s2">:</span><span class="s3">function </span><span class="s1">begin</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">);</span>
    <span class="s2">},</span>

<span class="s0">// pop the previously active lexer condition state off the condition stack</span>
<span class="s1">popState</span><span class="s2">:</span><span class="s3">function </span><span class="s1">popState</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">n </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">n </span><span class="s2">&gt; </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">[</span><span class="s5">0</span><span class="s2">];</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// produce the lexer rule set which is active for the currently active lexer condition state</span>
<span class="s1">_currentRules</span><span class="s2">:</span><span class="s3">function </span><span class="s1">_currentRules</span><span class="s2">() {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditions</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">[</span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">]].</span><span class="s1">rules</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditions</span><span class="s2">[</span><span class="s4">&quot;INITIAL&quot;</span><span class="s2">].</span><span class="s1">rules</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// return the currently active lexer condition state; when an index argument is provided it produces the N-th previous condition state, if available</span>
<span class="s1">topState</span><span class="s2">:</span><span class="s3">function </span><span class="s1">topState</span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
        <span class="s1">n </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1 </span><span class="s2">- </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">abs</span><span class="s2">(</span><span class="s1">n </span><span class="s2">|| </span><span class="s5">0</span><span class="s2">);</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">n </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">) {</span>
            <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">[</span><span class="s1">n</span><span class="s2">];</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s3">return </span><span class="s4">&quot;INITIAL&quot;</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">},</span>

<span class="s0">// alias for begin(condition)</span>
<span class="s1">pushState</span><span class="s2">:</span><span class="s3">function </span><span class="s1">pushState</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">begin</span><span class="s2">(</span><span class="s1">condition</span><span class="s2">);</span>
    <span class="s2">},</span>

<span class="s0">// return the number of states currently on the stack</span>
<span class="s1">stateStackSize</span><span class="s2">:</span><span class="s3">function </span><span class="s1">stateStackSize</span><span class="s2">() {</span>
        <span class="s3">return this</span><span class="s2">.</span><span class="s1">conditionStack</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
    <span class="s2">},</span>
<span class="s1">options</span><span class="s2">: {},</span>
<span class="s1">performAction</span><span class="s2">: </span><span class="s3">function </span><span class="s1">anonymous</span><span class="s2">(</span><span class="s1">yy</span><span class="s2">,</span><span class="s1">yy_</span><span class="s2">,</span><span class="s1">$avoiding_name_collisions</span><span class="s2">,</span><span class="s1">YY_START</span>
<span class="s0">/**/</span><span class="s2">) {</span>

<span class="s3">var </span><span class="s1">YYSTATE</span><span class="s2">=</span><span class="s1">YY_START</span><span class="s2">;</span>
<span class="s3">switch</span><span class="s2">(</span><span class="s1">$avoiding_name_collisions</span><span class="s2">) {</span>
<span class="s3">case </span><span class="s5">0</span><span class="s2">:</span><span class="s3">return </span><span class="s5">4</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">1</span><span class="s2">:</span><span class="s3">return </span><span class="s5">14</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">2</span><span class="s2">:</span><span class="s3">return </span><span class="s5">12</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">3</span><span class="s2">:</span><span class="s3">return </span><span class="s5">15</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">4</span><span class="s2">:</span><span class="s3">return </span><span class="s5">16</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">5</span><span class="s2">:</span><span class="s3">return </span><span class="s5">22</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">6</span><span class="s2">:</span><span class="s3">return </span><span class="s5">24</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">7</span><span class="s2">:</span><span class="s3">return </span><span class="s5">28</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">8</span><span class="s2">:</span><span class="s3">return </span><span class="s5">30</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">9</span><span class="s2">:</span><span class="s3">return </span><span class="s5">18</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">10</span><span class="s2">:</span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">= </span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">-</span><span class="s5">2</span><span class="s2">); </span><span class="s3">return </span><span class="s5">32</span><span class="s2">;</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">11</span><span class="s2">:</span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yytext </span><span class="s2">= </span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yytext</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">,</span><span class="s1">yy_</span><span class="s2">.</span><span class="s1">yyleng</span><span class="s2">-</span><span class="s5">2</span><span class="s2">); </span><span class="s3">return </span><span class="s5">33</span><span class="s2">;</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">12</span><span class="s2">:</span><span class="s3">return </span><span class="s5">17</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s3">case </span><span class="s5">13</span><span class="s2">:</span><span class="s3">return </span><span class="s5">31</span>
<span class="s3">break</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s2">},</span>
<span class="s1">rules</span><span class="s2">: [</span><span class="s6">/^(?:\$)/</span><span class="s2">,</span><span class="s6">/^(?:\.\.)/</span><span class="s2">,</span><span class="s6">/^(?:\.)/</span><span class="s2">,</span><span class="s6">/^(?:\*)/</span><span class="s2">,</span><span class="s6">/^(?:[a-zA-Z_]+[a-zA-Z0-9_]*)/</span><span class="s2">,</span><span class="s6">/^(?:\[)/</span><span class="s2">,</span><span class="s6">/^(?:\])/</span><span class="s2">,</span><span class="s6">/^(?:,)/</span><span class="s2">,</span><span class="s6">/^(?:((-?(?:0|[1-9][0-9]*)))?\:((-?(?:0|[1-9][0-9]*)))?(\:((-?(?:0|[1-9][0-9]*)))?)?)/</span><span class="s2">,</span><span class="s6">/^(?:(-?(?:0|[1-9][0-9]*)))/</span><span class="s2">,</span><span class="s6">/^(?:&quot;(?:\\[&quot;bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^&quot;\\])*&quot;)/</span><span class="s2">,</span><span class="s6">/^(?:'(?:\\['bfnrt/\\]|\\u[a-fA-F0-9]{4}|[^'\\])*')/</span><span class="s2">,</span><span class="s6">/^(?:\(.+?\)(?=\]))/</span><span class="s2">,</span><span class="s6">/^(?:\?\(.+?\)(?=\]))/</span><span class="s2">],</span>
<span class="s1">conditions</span><span class="s2">: {</span><span class="s4">&quot;INITIAL&quot;</span><span class="s2">:{</span><span class="s4">&quot;rules&quot;</span><span class="s2">:[</span><span class="s5">0</span><span class="s2">,</span><span class="s5">1</span><span class="s2">,</span><span class="s5">2</span><span class="s2">,</span><span class="s5">3</span><span class="s2">,</span><span class="s5">4</span><span class="s2">,</span><span class="s5">5</span><span class="s2">,</span><span class="s5">6</span><span class="s2">,</span><span class="s5">7</span><span class="s2">,</span><span class="s5">8</span><span class="s2">,</span><span class="s5">9</span><span class="s2">,</span><span class="s5">10</span><span class="s2">,</span><span class="s5">11</span><span class="s2">,</span><span class="s5">12</span><span class="s2">,</span><span class="s5">13</span><span class="s2">],</span><span class="s4">&quot;inclusive&quot;</span><span class="s2">:</span><span class="s3">true</span><span class="s2">}}</span>
<span class="s2">};</span>
<span class="s3">return </span><span class="s1">lexer</span><span class="s2">;</span>
<span class="s2">})();</span>
<span class="s1">parser</span><span class="s2">.</span><span class="s1">lexer </span><span class="s2">= </span><span class="s1">lexer</span><span class="s2">;</span>
<span class="s3">function </span><span class="s1">Parser </span><span class="s2">() {</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">yy </span><span class="s2">= {};</span>
<span class="s2">}</span>
<span class="s1">Parser</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">;</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">Parser </span><span class="s2">= </span><span class="s1">Parser</span><span class="s2">;</span>
<span class="s3">return new </span><span class="s1">Parser</span><span class="s2">;</span>
<span class="s2">})();</span>


<span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">require </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">exports </span><span class="s2">!== </span><span class="s4">'undefined'</span><span class="s2">) {</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">parser </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">;</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">Parser </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">.</span><span class="s1">Parser</span><span class="s2">;</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">parse </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() { </span><span class="s3">return </span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">parser</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">); };</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">main </span><span class="s2">= </span><span class="s3">function </span><span class="s1">commonjsMain</span><span class="s2">(</span><span class="s1">args</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">args</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s4">'Usage: '</span><span class="s2">+</span><span class="s1">args</span><span class="s2">[</span><span class="s5">0</span><span class="s2">]+</span><span class="s4">' FILE'</span><span class="s2">);</span>
        <span class="s1">process</span><span class="s2">.</span><span class="s1">exit</span><span class="s2">(</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">var </span><span class="s1">source </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'fs'</span><span class="s2">).</span><span class="s1">readFileSync</span><span class="s2">(</span><span class="s1">require</span><span class="s2">(</span><span class="s4">'path'</span><span class="s2">).</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s5">1</span><span class="s2">]), </span><span class="s4">&quot;utf8&quot;</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">source</span><span class="s2">);</span>
<span class="s2">};</span>
<span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">module </span><span class="s2">!== </span><span class="s4">'undefined' </span><span class="s2">&amp;&amp; </span><span class="s1">require</span><span class="s2">.</span><span class="s1">main </span><span class="s2">=== </span><span class="s1">module</span><span class="s2">) {</span>
  <span class="s1">exports</span><span class="s2">.</span><span class="s1">main</span><span class="s2">(</span><span class="s1">process</span><span class="s2">.</span><span class="s1">argv</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">));</span>
<span class="s2">}</span>
<span class="s2">}</span>

<span class="s2">}).</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">,</span><span class="s1">require</span><span class="s2">(</span><span class="s4">'_process'</span><span class="s2">))</span>
<span class="s2">},{</span><span class="s4">&quot;_process&quot;</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s4">&quot;fs&quot;</span><span class="s2">:</span><span class="s5">12</span><span class="s2">,</span><span class="s4">&quot;path&quot;</span><span class="s2">:</span><span class="s5">13</span><span class="s2">}],</span><span class="s5">2</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= {</span>
  <span class="s1">identifier</span><span class="s2">: </span><span class="s4">&quot;[a-zA-Z_]+[a-zA-Z0-9_]*&quot;</span><span class="s2">,</span>
  <span class="s1">integer</span><span class="s2">: </span><span class="s4">&quot;-?(?:0|[1-9][0-9]*)&quot;</span><span class="s2">,</span>
  <span class="s1">qq_string</span><span class="s2">: </span><span class="s4">&quot;</span><span class="s3">\&quot;</span><span class="s4">(?:</span><span class="s3">\\\\</span><span class="s4">[</span><span class="s3">\&quot;</span><span class="s4">bfnrt/</span><span class="s3">\\\\</span><span class="s4">]|</span><span class="s3">\\\\</span><span class="s4">u[a-fA-F0-9]{4}|[^</span><span class="s3">\&quot;\\\\</span><span class="s4">])*</span><span class="s3">\&quot;</span><span class="s4">&quot;</span><span class="s2">,</span>
  <span class="s1">q_string</span><span class="s2">: </span><span class="s4">&quot;'(?:</span><span class="s3">\\\\</span><span class="s4">[</span><span class="s3">\'</span><span class="s4">bfnrt/</span><span class="s3">\\\\</span><span class="s4">]|</span><span class="s3">\\\\</span><span class="s4">u[a-fA-F0-9]{4}|[^</span><span class="s3">\'\\\\</span><span class="s4">])*'&quot;</span>
<span class="s2">};</span>

<span class="s2">},{}],</span><span class="s5">3</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">var </span><span class="s1">dict </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./dict'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">fs </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'fs'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">grammar </span><span class="s2">= {</span>

    <span class="s1">lex</span><span class="s2">: {</span>

        <span class="s1">macros</span><span class="s2">: {</span>
            <span class="s1">esc</span><span class="s2">: </span><span class="s4">&quot;</span><span class="s3">\\\\</span><span class="s4">&quot;</span><span class="s2">,</span>
            <span class="s1">int</span><span class="s2">: </span><span class="s1">dict</span><span class="s2">.</span><span class="s1">integer</span>
        <span class="s2">},</span>

        <span class="s1">rules</span><span class="s2">: [</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">$&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'DOLLAR'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">.</span><span class="s3">\\</span><span class="s4">.&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'DOT_DOT'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">.&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'DOT'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">*&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'STAR'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">dict</span><span class="s2">.</span><span class="s1">identifier</span><span class="s2">, </span><span class="s4">&quot;return 'IDENTIFIER'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">[&quot;</span><span class="s2">, </span><span class="s4">&quot;return '['&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">]&quot;</span><span class="s2">, </span><span class="s4">&quot;return ']'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;,&quot;</span><span class="s2">, </span><span class="s4">&quot;return ','&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;({int})?</span><span class="s3">\\</span><span class="s4">:({int})?(</span><span class="s3">\\</span><span class="s4">:({int})?)?&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'ARRAY_SLICE'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;{int}&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'INTEGER'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">dict</span><span class="s2">.</span><span class="s1">qq_string</span><span class="s2">, </span><span class="s4">&quot;yytext = yytext.substr(1,yyleng-2); return 'QQ_STRING';&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s1">dict</span><span class="s2">.</span><span class="s1">q_string</span><span class="s2">, </span><span class="s4">&quot;yytext = yytext.substr(1,yyleng-2); return 'Q_STRING';&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">(.+?</span><span class="s3">\\</span><span class="s4">)(?=</span><span class="s3">\\</span><span class="s4">])&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'SCRIPT_EXPRESSION'&quot;</span><span class="s2">],</span>
            <span class="s2">[</span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">?</span><span class="s3">\\</span><span class="s4">(.+?</span><span class="s3">\\</span><span class="s4">)(?=</span><span class="s3">\\</span><span class="s4">])&quot;</span><span class="s2">, </span><span class="s4">&quot;return 'FILTER_EXPRESSION'&quot;</span><span class="s2">]</span>
        <span class="s2">]</span>
    <span class="s2">},</span>

    <span class="s1">start</span><span class="s2">: </span><span class="s4">&quot;JSON_PATH&quot;</span><span class="s2">,</span>

    <span class="s1">bnf</span><span class="s2">: {</span>

        <span class="s1">JSON_PATH</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'DOLLAR'</span><span class="s2">,                 </span><span class="s4">'yy.ast.set({ expression: { type: &quot;root&quot;, value: $1 } }); yy.ast.unshift(); return yy.ast.yield()' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'DOLLAR PATH_COMPONENTS'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ expression: { type: &quot;root&quot;, value: $1 } }); yy.ast.unshift(); return yy.ast.yield()' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'LEADING_CHILD_MEMBER_EXPRESSION'</span><span class="s2">,                 </span><span class="s4">'yy.ast.unshift(); return yy.ast.yield()' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'LEADING_CHILD_MEMBER_EXPRESSION PATH_COMPONENTS'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ operation: &quot;member&quot;, scope: &quot;child&quot;, expression: { type: &quot;identifier&quot;, value: $1 }}); yy.ast.unshift(); return yy.ast.yield()' </span><span class="s2">] ],</span>

        <span class="s1">PATH_COMPONENTS</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'PATH_COMPONENT'</span><span class="s2">,                 </span><span class="s4">'' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'PATH_COMPONENTS PATH_COMPONENT'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">PATH_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'MEMBER_COMPONENT'</span><span class="s2">,    </span><span class="s4">'yy.ast.set({ operation: &quot;member&quot; }); yy.ast.push()' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'SUBSCRIPT_COMPONENT'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ operation: &quot;subscript&quot; }); yy.ast.push() ' </span><span class="s2">] ],</span>

        <span class="s1">MEMBER_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'CHILD_MEMBER_COMPONENT'</span><span class="s2">,      </span><span class="s4">'yy.ast.set({ scope: &quot;child&quot; })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'DESCENDANT_MEMBER_COMPONENT'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ scope: &quot;descendant&quot; })' </span><span class="s2">] ],</span>

        <span class="s1">CHILD_MEMBER_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'DOT MEMBER_EXPRESSION'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">LEADING_CHILD_MEMBER_EXPRESSION</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'MEMBER_EXPRESSION'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ scope: &quot;child&quot;, operation: &quot;member&quot; })' </span><span class="s2">] ],</span>

        <span class="s1">DESCENDANT_MEMBER_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'DOT_DOT MEMBER_EXPRESSION'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">MEMBER_EXPRESSION</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'STAR'</span><span class="s2">,              </span><span class="s4">'yy.ast.set({ expression: { type: &quot;wildcard&quot;, value: $1 } })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'IDENTIFIER'</span><span class="s2">,        </span><span class="s4">'yy.ast.set({ expression: { type: &quot;identifier&quot;, value: $1 } })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'SCRIPT_EXPRESSION'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ expression: { type: &quot;script_expression&quot;, value: $1 } })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'INTEGER'</span><span class="s2">,           </span><span class="s4">'yy.ast.set({ expression: { type: &quot;numeric_literal&quot;, value: parseInt($1) } })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'END'</span><span class="s2">,               </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">SUBSCRIPT_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'CHILD_SUBSCRIPT_COMPONENT'</span><span class="s2">,      </span><span class="s4">'yy.ast.set({ scope: &quot;child&quot; })' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'DESCENDANT_SUBSCRIPT_COMPONENT'</span><span class="s2">, </span><span class="s4">'yy.ast.set({ scope: &quot;descendant&quot; })' </span><span class="s2">] ],</span>

        <span class="s1">CHILD_SUBSCRIPT_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'[ SUBSCRIPT ]'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">DESCENDANT_SUBSCRIPT_COMPONENT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'DOT_DOT [ SUBSCRIPT ]'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">] ],</span>

        <span class="s1">SUBSCRIPT</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'SUBSCRIPT_EXPRESSION'</span><span class="s2">, </span><span class="s4">'' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'SUBSCRIPT_EXPRESSION_LIST'</span><span class="s2">, </span><span class="s4">'$1.length &gt; 1? yy.ast.set({ expression: { type: &quot;union&quot;, value: $1 } }) : $$ = $1' </span><span class="s2">] ],</span>

        <span class="s1">SUBSCRIPT_EXPRESSION_LIST</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'SUBSCRIPT_EXPRESSION_LISTABLE'</span><span class="s2">, </span><span class="s4">'$$ = [$1]'</span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'SUBSCRIPT_EXPRESSION_LIST , SUBSCRIPT_EXPRESSION_LISTABLE'</span><span class="s2">, </span><span class="s4">'$$ = $1.concat($3)' </span><span class="s2">] ],</span>

        <span class="s1">SUBSCRIPT_EXPRESSION_LISTABLE</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'INTEGER'</span><span class="s2">,           </span><span class="s4">'$$ = { expression: { type: &quot;numeric_literal&quot;, value: parseInt($1) } }; yy.ast.set($$)' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'STRING_LITERAL'</span><span class="s2">,    </span><span class="s4">'$$ = { expression: { type: &quot;string_literal&quot;, value: $1 } }; yy.ast.set($$)' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'ARRAY_SLICE'</span><span class="s2">,       </span><span class="s4">'$$ = { expression: { type: &quot;slice&quot;, value: $1 } }; yy.ast.set($$)' </span><span class="s2">] ],</span>

        <span class="s1">SUBSCRIPT_EXPRESSION</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'STAR'</span><span class="s2">,              </span><span class="s4">'$$ = { expression: { type: &quot;wildcard&quot;, value: $1 } }; yy.ast.set($$)' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'SCRIPT_EXPRESSION'</span><span class="s2">, </span><span class="s4">'$$ = { expression: { type: &quot;script_expression&quot;, value: $1 } }; yy.ast.set($$)' </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'FILTER_EXPRESSION'</span><span class="s2">, </span><span class="s4">'$$ = { expression: { type: &quot;filter_expression&quot;, value: $1 } }; yy.ast.set($$)' </span><span class="s2">] ],</span>

        <span class="s1">STRING_LITERAL</span><span class="s2">: [</span>
                <span class="s2">[ </span><span class="s4">'QQ_STRING'</span><span class="s2">, </span><span class="s4">&quot;$$ = $1&quot; </span><span class="s2">],</span>
                <span class="s2">[ </span><span class="s4">'Q_STRING'</span><span class="s2">,  </span><span class="s4">&quot;$$ = $1&quot; </span><span class="s2">] ]</span>
    <span class="s2">}</span>
<span class="s2">};</span>
<span class="s3">if </span><span class="s2">(</span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFileSync</span><span class="s2">) {</span>
  <span class="s1">grammar</span><span class="s2">.</span><span class="s1">moduleInclude </span><span class="s2">= </span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFileSync</span><span class="s2">(</span><span class="s1">require</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s4">&quot;../include/module.js&quot;</span><span class="s2">));</span>
  <span class="s1">grammar</span><span class="s2">.</span><span class="s1">actionInclude </span><span class="s2">= </span><span class="s1">fs</span><span class="s2">.</span><span class="s1">readFileSync</span><span class="s2">(</span><span class="s1">require</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s4">&quot;../include/action.js&quot;</span><span class="s2">));</span>
<span class="s2">}</span>

<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">grammar</span><span class="s2">;</span>

<span class="s2">},{</span><span class="s4">&quot;./dict&quot;</span><span class="s2">:</span><span class="s5">2</span><span class="s2">,</span><span class="s4">&quot;fs&quot;</span><span class="s2">:</span><span class="s5">12</span><span class="s2">}],</span><span class="s5">4</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">var </span><span class="s1">aesprim </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./aesprim'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">slice </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./slice'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">_evaluate </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'static-eval'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">_uniq </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'underscore'</span><span class="s2">).</span><span class="s1">uniq</span><span class="s2">;</span>

<span class="s3">var </span><span class="s1">Handlers </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">return this</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">initialize </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">traverse </span><span class="s2">= </span><span class="s1">traverser</span><span class="s2">(</span><span class="s3">true</span><span class="s2">);</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">descend </span><span class="s2">= </span><span class="s1">traverser</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">;</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">resolve </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">) {</span>

  <span class="s3">var </span><span class="s1">key </span><span class="s2">= [ </span><span class="s1">component</span><span class="s2">.</span><span class="s1">operation</span><span class="s2">, </span><span class="s1">component</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">].</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">method </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>

  <span class="s3">if </span><span class="s2">(!</span><span class="s1">method</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;couldn't resolve key: &quot; </span><span class="s2">+ </span><span class="s1">key</span><span class="s2">);</span>
  <span class="s3">return </span><span class="s1">method</span><span class="s2">.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">register </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">handler</span><span class="s2">) {</span>

  <span class="s3">if </span><span class="s2">(!</span><span class="s1">handler </span><span class="s3">instanceof </span><span class="s1">Function</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;handler must be a function&quot;</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">this</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">handler</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns </span><span class="s2">= {</span>

  <span class="s4">'member-child-identifier'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">value </span><span class="s3">instanceof </span><span class="s1">Object </span><span class="s2">&amp;&amp; </span><span class="s1">key </span><span class="s3">in </span><span class="s1">value</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s2">[ { </span><span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">path</span><span class="s2">: </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) } ]</span>
    <span class="s2">}</span>
  <span class="s2">},</span>

  <span class="s4">'member-descendant-identifier'</span><span class="s2">:</span>
    <span class="s1">_traverse</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">key </span><span class="s2">== </span><span class="s1">ref </span><span class="s2">}),</span>

  <span class="s4">'subscript-child-numeric_literal'</span><span class="s2">:</span>
    <span class="s1">_descend</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">key </span><span class="s2">=== </span><span class="s1">ref </span><span class="s2">}),</span>

  <span class="s4">'member-child-numeric_literal'</span><span class="s2">:</span>
    <span class="s1">_descend</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) === </span><span class="s1">String</span><span class="s2">(</span><span class="s1">ref</span><span class="s2">) }),</span>

  <span class="s4">'subscript-descendant-numeric_literal'</span><span class="s2">:</span>
    <span class="s1">_traverse</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">key </span><span class="s2">=== </span><span class="s1">ref </span><span class="s2">}),</span>

  <span class="s4">'member-child-wildcard'</span><span class="s2">:</span>
    <span class="s1">_descend</span><span class="s2">(</span><span class="s3">function</span><span class="s2">() { </span><span class="s3">return true </span><span class="s2">}),</span>

  <span class="s4">'member-descendant-wildcard'</span><span class="s2">:</span>
    <span class="s1">_traverse</span><span class="s2">(</span><span class="s3">function</span><span class="s2">() { </span><span class="s3">return true </span><span class="s2">}),</span>

  <span class="s4">'subscript-descendant-wildcard'</span><span class="s2">:</span>
    <span class="s1">_traverse</span><span class="s2">(</span><span class="s3">function</span><span class="s2">() { </span><span class="s3">return true </span><span class="s2">}),</span>

  <span class="s4">'subscript-child-wildcard'</span><span class="s2">:</span>
    <span class="s1">_descend</span><span class="s2">(</span><span class="s3">function</span><span class="s2">() { </span><span class="s3">return true </span><span class="s2">}),</span>

  <span class="s4">'subscript-child-slice'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">is_array</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s1">_parse_nullable_int</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">values </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">v</span><span class="s2">, </span><span class="s1">i</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">{ </span><span class="s1">value</span><span class="s2">: </span><span class="s1">v</span><span class="s2">, </span><span class="s1">path</span><span class="s2">: </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) } });</span>
      <span class="s3">return </span><span class="s1">slice</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, [</span><span class="s1">values</span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">args</span><span class="s2">));</span>
    <span class="s2">}</span>
  <span class="s2">},</span>

  <span class="s4">'subscript-child-union'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">results </span><span class="s2">= [];</span>
    <span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">_component </span><span class="s2">= { </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">'subscript'</span><span class="s2">, </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">'child'</span><span class="s2">, </span><span class="s1">expression</span><span class="s2">: </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression </span><span class="s2">};</span>
      <span class="s3">var </span><span class="s1">handler </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">_component</span><span class="s2">);</span>
      <span class="s3">var </span><span class="s1">_results </span><span class="s2">= </span><span class="s1">handler</span><span class="s2">(</span><span class="s1">_component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">_results</span><span class="s2">) {</span>
        <span class="s1">results </span><span class="s2">= </span><span class="s1">results</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">_results</span><span class="s2">);</span>
      <span class="s2">}</span>
    <span class="s2">}, </span><span class="s3">this</span><span class="s2">);</span>

    <span class="s3">return </span><span class="s1">unique</span><span class="s2">(</span><span class="s1">results</span><span class="s2">);</span>
  <span class="s2">},</span>

  <span class="s4">'subscript-descendant-union'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

    <span class="s3">var </span><span class="s1">jp </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'..'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">results </span><span class="s2">= [];</span>
    <span class="s3">var </span><span class="s1">nodes </span><span class="s2">= </span><span class="s1">jp</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s4">'$..*'</span><span class="s2">).</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">);</span>

    <span class="s1">nodes</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) </span><span class="s3">return</span><span class="s2">;</span>
      <span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">) {</span>
        <span class="s3">var </span><span class="s1">_component </span><span class="s2">= { </span><span class="s1">operation</span><span class="s2">: </span><span class="s4">'subscript'</span><span class="s2">, </span><span class="s1">scope</span><span class="s2">: </span><span class="s4">'child'</span><span class="s2">, </span><span class="s1">expression</span><span class="s2">: </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression </span><span class="s2">};</span>
        <span class="s3">var </span><span class="s1">handler </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">_component</span><span class="s2">);</span>
        <span class="s3">var </span><span class="s1">_results </span><span class="s2">= </span><span class="s1">handler</span><span class="s2">(</span><span class="s1">_component</span><span class="s2">, </span><span class="s1">node</span><span class="s2">);</span>
        <span class="s1">results </span><span class="s2">= </span><span class="s1">results</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">_results</span><span class="s2">);</span>
      <span class="s2">});</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">unique</span><span class="s2">(</span><span class="s1">results</span><span class="s2">);</span>
  <span class="s2">},</span>

  <span class="s4">'subscript-child-filter_expression'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

    <span class="s0">// slice out the expression from ?(expression)</span>
    <span class="s3">var </span><span class="s1">src </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">ast </span><span class="s2">= </span><span class="s1">aesprim</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">src</span><span class="s2">).</span><span class="s1">body</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">expression</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">passable </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">ast</span><span class="s2">, { </span><span class="s4">'@'</span><span class="s2">: </span><span class="s1">value </span><span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">return this</span><span class="s2">.</span><span class="s1">descend</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s3">null</span><span class="s2">, </span><span class="s1">passable</span><span class="s2">, </span><span class="s1">count</span><span class="s2">);</span>

  <span class="s2">},</span>

  <span class="s4">'subscript-descendant-filter_expression'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

    <span class="s0">// slice out the expression from ?(expression)</span>
    <span class="s3">var </span><span class="s1">src </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">2</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">ast </span><span class="s2">= </span><span class="s1">aesprim</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">src</span><span class="s2">).</span><span class="s1">body</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">expression</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">passable </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">ast</span><span class="s2">, { </span><span class="s4">'@'</span><span class="s2">: </span><span class="s1">value </span><span class="s2">});</span>
    <span class="s2">}</span>

    <span class="s3">return this</span><span class="s2">.</span><span class="s1">traverse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s3">null</span><span class="s2">, </span><span class="s1">passable</span><span class="s2">, </span><span class="s1">count</span><span class="s2">);</span>
  <span class="s2">},</span>

  <span class="s4">'subscript-child-script_expression'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">exp </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">eval_recurse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s4">'$[{{value}}]'</span><span class="s2">);</span>
  <span class="s2">},</span>

  <span class="s4">'member-child-script_expression'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">exp </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">eval_recurse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s4">'$.{{value}}'</span><span class="s2">);</span>
  <span class="s2">},</span>

  <span class="s4">'member-descendant-script_expression'</span><span class="s2">: </span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">exp </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">eval_recurse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">exp</span><span class="s2">, </span><span class="s4">'$..value'</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s4">'subscript-child-string_literal'</span><span class="s2">] =</span>
	<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s4">'member-child-identifier'</span><span class="s2">];</span>

<span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s4">'member-descendant-numeric_literal'</span><span class="s2">] =</span>
    <span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s4">'subscript-descendant-string_literal'</span><span class="s2">] =</span>
    <span class="s1">Handlers</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_fns</span><span class="s2">[</span><span class="s4">'member-descendant-identifier'</span><span class="s2">];</span>

<span class="s3">function </span><span class="s1">eval_recurse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">src</span><span class="s2">, </span><span class="s1">template</span><span class="s2">) {</span>

  <span class="s3">var </span><span class="s1">jp </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./index'</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">ast </span><span class="s2">= </span><span class="s1">aesprim</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">src</span><span class="s2">).</span><span class="s1">body</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">expression</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">evaluate</span><span class="s2">(</span><span class="s1">ast</span><span class="s2">, { </span><span class="s4">'@'</span><span class="s2">: </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value </span><span class="s2">});</span>
  <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">template</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\{\{\s*value\s*\}\}/g</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">results </span><span class="s2">= </span><span class="s1">jp</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
  <span class="s1">results</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">r</span><span class="s2">) {</span>
    <span class="s1">r</span><span class="s2">.</span><span class="s1">path </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">r</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">1</span><span class="s2">));</span>
  <span class="s2">});</span>

  <span class="s3">return </span><span class="s1">results</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">is_array</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">is_object</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) {</span>
  <span class="s0">// is this a non-array, non-null object?</span>
  <span class="s3">return </span><span class="s1">val </span><span class="s2">&amp;&amp; !(</span><span class="s1">val </span><span class="s3">instanceof </span><span class="s1">Array</span><span class="s2">) &amp;&amp; </span><span class="s1">val </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">traverser</span><span class="s2">(</span><span class="s1">recurse</span><span class="s2">) {</span>

  <span class="s3">return function</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">, </span><span class="s1">passable</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

    <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s1">partial</span><span class="s2">.</span><span class="s1">path</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">results </span><span class="s2">= [];</span>

    <span class="s3">var </span><span class="s1">descend </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">path</span><span class="s2">) {</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">is_array</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
        <span class="s1">value</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">passable</span><span class="s2">(</span><span class="s1">index</span><span class="s2">, </span><span class="s1">element</span><span class="s2">, </span><span class="s1">ref</span><span class="s2">)) {</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({ </span><span class="s1">path</span><span class="s2">: </span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">index</span><span class="s2">), </span><span class="s1">value</span><span class="s2">: </span><span class="s1">element </span><span class="s2">});</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
        <span class="s1">value</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">recurse</span><span class="s2">) {</span>
            <span class="s1">descend</span><span class="s2">(</span><span class="s1">element</span><span class="s2">, </span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">index</span><span class="s2">));</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">is_object</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">value</span><span class="s2">).</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">k</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">passable</span><span class="s2">(</span><span class="s1">k</span><span class="s2">, </span><span class="s1">value</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">ref</span><span class="s2">)) {</span>
            <span class="s1">results</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({ </span><span class="s1">path</span><span class="s2">: </span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">k</span><span class="s2">), </span><span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">[</span><span class="s1">k</span><span class="s2">] });</span>
          <span class="s2">}</span>
        <span class="s2">})</span>
        <span class="s3">this</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">value</span><span class="s2">).</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">k</span><span class="s2">) {</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">results</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">}</span>
          <span class="s3">if </span><span class="s2">(</span><span class="s1">recurse</span><span class="s2">) {</span>
            <span class="s1">descend</span><span class="s2">(</span><span class="s1">value</span><span class="s2">[</span><span class="s1">k</span><span class="s2">], </span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">k</span><span class="s2">));</span>
          <span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">}.</span><span class="s1">bind</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
    <span class="s1">descend</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">results</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">_descend</span><span class="s2">(</span><span class="s1">passable</span><span class="s2">) {</span>
  <span class="s3">return function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">descend</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">passable</span><span class="s2">, </span><span class="s1">count</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">_traverse</span><span class="s2">(</span><span class="s1">passable</span><span class="s2">) {</span>
  <span class="s3">return function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">partial</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>
    <span class="s3">return this</span><span class="s2">.</span><span class="s1">traverse</span><span class="s2">(</span><span class="s1">partial</span><span class="s2">, </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">passable</span><span class="s2">, </span><span class="s1">count</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">evaluate</span><span class="s2">() {</span>
  <span class="s3">try </span><span class="s2">{ </span><span class="s3">return </span><span class="s1">_evaluate</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">) }</span>
  <span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) { }</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">unique</span><span class="s2">(</span><span class="s1">results</span><span class="s2">) {</span>
  <span class="s1">results </span><span class="s2">= </span><span class="s1">results</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">d </span><span class="s2">})</span>
  <span class="s3">return </span><span class="s1">_uniq</span><span class="s2">(</span>
    <span class="s1">results</span><span class="s2">,</span>
    <span class="s3">function</span><span class="s2">(</span><span class="s1">r</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">r</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">c</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">c</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">, </span><span class="s4">'--'</span><span class="s2">) }).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">) }</span>
  <span class="s2">);</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">_parse_nullable_int</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">sval </span><span class="s2">= </span><span class="s1">String</span><span class="s2">(</span><span class="s1">val</span><span class="s2">);</span>
  <span class="s3">return </span><span class="s1">sval</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/^-?[0-9]+$/</span><span class="s2">) ? </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">sval</span><span class="s2">) : </span><span class="s3">null</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">Handlers</span><span class="s2">;</span>

<span class="s2">},{</span><span class="s4">&quot;..&quot;</span><span class="s2">:</span><span class="s4">&quot;jsonpath&quot;</span><span class="s2">,</span><span class="s4">&quot;./aesprim&quot;</span><span class="s2">:</span><span class="s4">&quot;./aesprim&quot;</span><span class="s2">,</span><span class="s4">&quot;./index&quot;</span><span class="s2">:</span><span class="s5">5</span><span class="s2">,</span><span class="s4">&quot;./slice&quot;</span><span class="s2">:</span><span class="s5">7</span><span class="s2">,</span><span class="s4">&quot;static-eval&quot;</span><span class="s2">:</span><span class="s5">15</span><span class="s2">,</span><span class="s4">&quot;underscore&quot;</span><span class="s2">:</span><span class="s5">12</span><span class="s2">}],</span><span class="s5">5</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">var </span><span class="s1">assert </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'assert'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">dict </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./dict'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">Parser </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./parser'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">Handlers </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./handlers'</span><span class="s2">);</span>

<span class="s3">var </span><span class="s1">JSONPath </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">initialize </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">parser </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Parser</span><span class="s2">();</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">handlers </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Handlers</span><span class="s2">();</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">parse </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">string</span><span class="s2">) {</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">_is_string</span><span class="s2">(</span><span class="s1">string</span><span class="s2">), </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>
  <span class="s3">return this</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">string</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">parent </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">string</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">node </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">];</span>
  <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">(); </span><span class="s0">/* jshint unused:false */</span>
  <span class="s3">return this</span><span class="s2">.</span><span class="s1">value</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">apply </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">fn</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">string</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">equal</span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">fn</span><span class="s2">, </span><span class="s4">&quot;function&quot;</span><span class="s2">, </span><span class="s4">&quot;fn needs to be function&quot;</span><span class="s2">)</span>

  <span class="s3">var </span><span class="s1">nodes </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">).</span><span class="s1">sort</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) {</span>
    <span class="s0">// sort nodes so we apply from the bottom up</span>
    <span class="s3">return </span><span class="s1">b</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">a</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
  <span class="s2">});</span>

  <span class="s1">nodes</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">node</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">parent </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">value</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">));</span>
    <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s1">fn</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">parent</span><span class="s2">[</span><span class="s1">key</span><span class="s2">]);</span>
    <span class="s1">parent</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">val</span><span class="s2">;</span>
  <span class="s2">}, </span><span class="s3">this</span><span class="s2">);</span>

  <span class="s3">return </span><span class="s1">nodes</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">value </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s5">3</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">node </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">path</span><span class="s2">).</span><span class="s1">shift</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">node</span><span class="s2">) </span><span class="s3">return this</span><span class="s2">.</span><span class="s1">_vivify</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">).</span><span class="s1">shift</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">parent </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">parent</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">path</span><span class="s2">));</span>
    <span class="s1">parent</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">return this</span><span class="s2">.</span><span class="s1">query</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">path</span><span class="s2">), </span><span class="s5">1</span><span class="s2">).</span><span class="s1">shift</span><span class="s2">();</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_vivify </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>

  <span class="s3">var </span><span class="s1">self </span><span class="s2">= </span><span class="s3">this</span><span class="s2">;</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">string</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">string</span><span class="s2">)</span>
    <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value </span><span class="s2">});</span>

  <span class="s3">var </span><span class="s1">setValue </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>
    <span class="s3">var </span><span class="s1">node </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">node</span><span class="s2">) {</span>
      <span class="s1">setValue</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(), </span><span class="s3">typeof </span><span class="s1">key </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">? {} : []);</span>
      <span class="s1">node </span><span class="s2">= </span><span class="s1">self</span><span class="s2">.</span><span class="s1">value</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">path</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s1">node</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s1">setValue</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>
  <span class="s3">return this</span><span class="s2">.</span><span class="s1">query</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">)[</span><span class="s5">0</span><span class="s2">];</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">query </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">_is_string</span><span class="s2">(</span><span class="s1">string</span><span class="s2">), </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">results </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">count</span><span class="s2">)</span>
    <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">r</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">r</span><span class="s2">.</span><span class="s1">value </span><span class="s2">});</span>

  <span class="s3">return </span><span class="s1">results</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">paths </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">string</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">results </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">nodes</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">count</span><span class="s2">)</span>
    <span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">r</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">r</span><span class="s2">.</span><span class="s1">path </span><span class="s2">});</span>

  <span class="s3">return </span><span class="s1">results</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">nodes </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">string</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">obj </span><span class="s3">instanceof </span><span class="s1">Object</span><span class="s2">, </span><span class="s4">&quot;obj needs to be an object&quot;</span><span class="s2">);</span>
  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">string</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">count </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) </span><span class="s3">return </span><span class="s2">[];</span>

  <span class="s3">var </span><span class="s1">path </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">string</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">handlers </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">handlers</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">partials </span><span class="s2">= [ { </span><span class="s1">path</span><span class="s2">: [</span><span class="s4">'$'</span><span class="s2">], </span><span class="s1">value</span><span class="s2">: </span><span class="s1">obj </span><span class="s2">} ];</span>
  <span class="s3">var </span><span class="s1">matches </span><span class="s2">= [];</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&amp;&amp; </span><span class="s1">path</span><span class="s2">[</span><span class="s5">0</span><span class="s2">].</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s4">'root'</span><span class="s2">) </span><span class="s1">path</span><span class="s2">.</span><span class="s1">shift</span><span class="s2">();</span>

  <span class="s3">if </span><span class="s2">(!</span><span class="s1">path</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) </span><span class="s3">return </span><span class="s1">partials</span><span class="s2">;</span>

  <span class="s1">path</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">matches</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) </span><span class="s3">return</span><span class="s2">;</span>
    <span class="s3">var </span><span class="s1">handler </span><span class="s2">= </span><span class="s1">handlers</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">component</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">_partials </span><span class="s2">= [];</span>

    <span class="s1">partials</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) {</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">matches</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s1">count</span><span class="s2">) </span><span class="s3">return</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">results </span><span class="s2">= </span><span class="s1">handler</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">p</span><span class="s2">, </span><span class="s1">count</span><span class="s2">);</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">index </span><span class="s2">== </span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">) {</span>
        <span class="s0">// if we're through the components we're done</span>
        <span class="s1">matches </span><span class="s2">= </span><span class="s1">matches</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">results </span><span class="s2">|| []);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s0">// otherwise accumulate and carry on through</span>
        <span class="s1">_partials </span><span class="s2">= </span><span class="s1">_partials</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">results </span><span class="s2">|| []);</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s1">partials </span><span class="s2">= </span><span class="s1">_partials</span><span class="s2">;</span>

  <span class="s2">});</span>

  <span class="s3">return </span><span class="s1">count </span><span class="s2">? </span><span class="s1">matches</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">count</span><span class="s2">) : </span><span class="s1">matches</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">stringify </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">string </span><span class="s2">= </span><span class="s4">'$'</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">templates </span><span class="s2">= {</span>
    <span class="s4">'descendant-member'</span><span class="s2">: </span><span class="s4">'..{{value}}'</span><span class="s2">,</span>
    <span class="s4">'child-member'</span><span class="s2">: </span><span class="s4">'.{{value}}'</span><span class="s2">,</span>
    <span class="s4">'descendant-subscript'</span><span class="s2">: </span><span class="s4">'..[{{value}}]'</span><span class="s2">,</span>
    <span class="s4">'child-subscript'</span><span class="s2">: </span><span class="s4">'[{{value}}]'</span>
  <span class="s2">};</span>

  <span class="s1">path </span><span class="s2">= </span><span class="s3">this</span><span class="s2">.</span><span class="s1">_normalize</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>

  <span class="s1">path</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">) {</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s4">'root'</span><span class="s2">) </span><span class="s3">return</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">key </span><span class="s2">= [</span><span class="s1">component</span><span class="s2">.</span><span class="s1">scope</span><span class="s2">, </span><span class="s1">component</span><span class="s2">.</span><span class="s1">operation</span><span class="s2">].</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'-'</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">template </span><span class="s2">= </span><span class="s1">templates</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
    <span class="s3">var </span><span class="s1">value</span><span class="s2">;</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s4">'string_literal'</span><span class="s2">) {</span>
      <span class="s1">value </span><span class="s2">= </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">value </span><span class="s2">= </span><span class="s1">component</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(!</span><span class="s1">template</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;couldn't find template &quot; </span><span class="s2">+ </span><span class="s1">key</span><span class="s2">);</span>

    <span class="s1">string </span><span class="s2">+= </span><span class="s1">template</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/{{value}}/</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">});</span>

  <span class="s3">return </span><span class="s1">string</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">_normalize </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>

  <span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s4">&quot;we need a path&quot;</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">path </span><span class="s2">== </span><span class="s4">&quot;string&quot;</span><span class="s2">) {</span>

    <span class="s3">return this</span><span class="s2">.</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parse</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>

  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) &amp;&amp; </span><span class="s3">typeof </span><span class="s1">path</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s4">&quot;string&quot;</span><span class="s2">) {</span>

    <span class="s3">var </span><span class="s1">_path </span><span class="s2">= [ { </span><span class="s1">expression</span><span class="s2">: { </span><span class="s1">type</span><span class="s2">: </span><span class="s4">&quot;root&quot;</span><span class="s2">, </span><span class="s1">value</span><span class="s2">: </span><span class="s4">&quot;$&quot; </span><span class="s2">} } ];</span>

    <span class="s1">path</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">component</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s1">component </span><span class="s2">== </span><span class="s4">'$' </span><span class="s2">&amp;&amp; </span><span class="s1">index </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) </span><span class="s3">return</span><span class="s2">;</span>

      <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">component </span><span class="s2">== </span><span class="s4">&quot;string&quot; </span><span class="s2">&amp;&amp; </span><span class="s1">component</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s4">&quot;^&quot; </span><span class="s2">+ </span><span class="s1">dict</span><span class="s2">.</span><span class="s1">identifier </span><span class="s2">+ </span><span class="s4">&quot;$&quot;</span><span class="s2">)) {</span>

        <span class="s1">_path</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
          <span class="s1">operation</span><span class="s2">: </span><span class="s4">'member'</span><span class="s2">,</span>
          <span class="s1">scope</span><span class="s2">: </span><span class="s4">'child'</span><span class="s2">,</span>
          <span class="s1">expression</span><span class="s2">: { </span><span class="s1">value</span><span class="s2">: </span><span class="s1">component</span><span class="s2">, </span><span class="s1">type</span><span class="s2">: </span><span class="s4">'identifier' </span><span class="s2">}</span>
        <span class="s2">});</span>

      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>

        <span class="s3">var </span><span class="s1">type </span><span class="s2">= </span><span class="s3">typeof </span><span class="s1">component </span><span class="s2">== </span><span class="s4">&quot;number&quot; </span><span class="s2">?</span>
          <span class="s4">'numeric_literal' </span><span class="s2">: </span><span class="s4">'string_literal'</span><span class="s2">;</span>

        <span class="s1">_path</span><span class="s2">.</span><span class="s1">push</span><span class="s2">({</span>
          <span class="s1">operation</span><span class="s2">: </span><span class="s4">'subscript'</span><span class="s2">,</span>
          <span class="s1">scope</span><span class="s2">: </span><span class="s4">'child'</span><span class="s2">,</span>
          <span class="s1">expression</span><span class="s2">: { </span><span class="s1">value</span><span class="s2">: </span><span class="s1">component</span><span class="s2">, </span><span class="s1">type</span><span class="s2">: </span><span class="s1">type </span><span class="s2">}</span>
        <span class="s2">});</span>
      <span class="s2">}</span>
    <span class="s2">});</span>

    <span class="s3">return </span><span class="s1">_path</span><span class="s2">;</span>

  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) &amp;&amp; </span><span class="s3">typeof </span><span class="s1">path</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] == </span><span class="s4">&quot;object&quot;</span><span class="s2">) {</span>

    <span class="s3">return </span><span class="s1">path</span>
  <span class="s2">}</span>

  <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;couldn't understand path &quot; </span><span class="s2">+ </span><span class="s1">path</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">_is_string</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) == </span><span class="s4">'[object String]'</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">Handlers </span><span class="s2">= </span><span class="s1">Handlers</span><span class="s2">;</span>
<span class="s1">JSONPath</span><span class="s2">.</span><span class="s1">Parser </span><span class="s2">= </span><span class="s1">Parser</span><span class="s2">;</span>

<span class="s3">var </span><span class="s1">instance </span><span class="s2">= </span><span class="s3">new </span><span class="s1">JSONPath</span><span class="s2">;</span>
<span class="s1">instance</span><span class="s2">.</span><span class="s1">JSONPath </span><span class="s2">= </span><span class="s1">JSONPath</span><span class="s2">;</span>

<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">instance</span><span class="s2">;</span>

<span class="s2">},{</span><span class="s4">&quot;./dict&quot;</span><span class="s2">:</span><span class="s5">2</span><span class="s2">,</span><span class="s4">&quot;./handlers&quot;</span><span class="s2">:</span><span class="s5">4</span><span class="s2">,</span><span class="s4">&quot;./parser&quot;</span><span class="s2">:</span><span class="s5">6</span><span class="s2">,</span><span class="s4">&quot;assert&quot;</span><span class="s2">:</span><span class="s5">8</span><span class="s2">}],</span><span class="s5">6</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">var </span><span class="s1">grammar </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./grammar'</span><span class="s2">);</span>
<span class="s3">var </span><span class="s1">gparser </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'../generated/parser'</span><span class="s2">);</span>

<span class="s3">var </span><span class="s1">Parser </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>

  <span class="s3">var </span><span class="s1">parser </span><span class="s2">= </span><span class="s3">new </span><span class="s1">gparser</span><span class="s2">.</span><span class="s1">Parser</span><span class="s2">();</span>

  <span class="s3">var </span><span class="s1">_parseError </span><span class="s2">= </span><span class="s1">parser</span><span class="s2">.</span><span class="s1">parseError</span><span class="s2">;</span>
  <span class="s1">parser</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">parseError </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">parser</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">) {</span>
      <span class="s1">parser</span><span class="s2">.</span><span class="s1">yy</span><span class="s2">.</span><span class="s1">ast</span><span class="s2">.</span><span class="s1">initialize</span><span class="s2">();</span>
    <span class="s2">}</span>
    <span class="s1">_parseError</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">parser</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">parser</span><span class="s2">;</span>

<span class="s2">};</span>

<span class="s1">Parser</span><span class="s2">.</span><span class="s1">grammar </span><span class="s2">= </span><span class="s1">grammar</span><span class="s2">;</span>
<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">Parser</span><span class="s2">;</span>

<span class="s2">},{</span><span class="s4">&quot;../generated/parser&quot;</span><span class="s2">:</span><span class="s5">1</span><span class="s2">,</span><span class="s4">&quot;./grammar&quot;</span><span class="s2">:</span><span class="s5">3</span><span class="s2">}],</span><span class="s5">7</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">, </span><span class="s1">step</span><span class="s2">) {</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">start </span><span class="s2">== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;start cannot be a string&quot;</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">end </span><span class="s2">== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;end cannot be a string&quot;</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">step </span><span class="s2">== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;step cannot be a string&quot;</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">len </span><span class="s2">= </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">step </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) </span><span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">&quot;step cannot be zero&quot;</span><span class="s2">);</span>
  <span class="s1">step </span><span class="s2">= </span><span class="s1">step </span><span class="s2">? </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">step</span><span class="s2">) : </span><span class="s5">1</span><span class="s2">;</span>

  <span class="s0">// normalize negative values</span>
  <span class="s1">start </span><span class="s2">= </span><span class="s1">start </span><span class="s2">&lt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s1">len </span><span class="s2">+ </span><span class="s1">start </span><span class="s2">: </span><span class="s1">start</span><span class="s2">;</span>
  <span class="s1">end </span><span class="s2">= </span><span class="s1">end </span><span class="s2">&lt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s1">len </span><span class="s2">+ </span><span class="s1">end </span><span class="s2">: </span><span class="s1">end</span><span class="s2">;</span>

  <span class="s0">// default extents to extents</span>
  <span class="s1">start </span><span class="s2">= </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">start </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">? </span><span class="s5">0 </span><span class="s2">: !</span><span class="s1">start </span><span class="s2">? (</span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s5">0 </span><span class="s2">: </span><span class="s1">len </span><span class="s2">- </span><span class="s5">1</span><span class="s2">) : </span><span class="s1">start</span><span class="s2">);</span>
  <span class="s1">end </span><span class="s2">= </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">end </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">? </span><span class="s5">0 </span><span class="s2">: !</span><span class="s1">end </span><span class="s2">? (</span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s1">len </span><span class="s2">: -</span><span class="s5">1</span><span class="s2">) : </span><span class="s1">end</span><span class="s2">);</span>

  <span class="s0">// clamp extents</span>
  <span class="s1">start </span><span class="s2">= </span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">start</span><span class="s2">) : </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">len</span><span class="s2">, </span><span class="s1">start</span><span class="s2">);</span>
  <span class="s1">end </span><span class="s2">= </span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">? </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">end</span><span class="s2">, </span><span class="s1">len</span><span class="s2">) : </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">max</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">, </span><span class="s1">end</span><span class="s2">);</span>

  <span class="s0">// return empty if extents are backwards</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">end </span><span class="s2">&lt;= </span><span class="s1">start</span><span class="s2">) </span><span class="s3">return </span><span class="s2">[];</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">step </span><span class="s2">&lt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">start </span><span class="s2">&lt;= </span><span class="s1">end</span><span class="s2">) </span><span class="s3">return </span><span class="s2">[];</span>

  <span class="s3">var </span><span class="s1">result </span><span class="s2">= [];</span>

  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">start</span><span class="s2">; </span><span class="s1">i </span><span class="s2">!= </span><span class="s1">end</span><span class="s2">; </span><span class="s1">i </span><span class="s2">+= </span><span class="s1">step</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">((</span><span class="s1">step </span><span class="s2">&lt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">i </span><span class="s2">&lt;= </span><span class="s1">end</span><span class="s2">) || (</span><span class="s1">step </span><span class="s2">&gt; </span><span class="s5">0 </span><span class="s2">&amp;&amp; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s1">end</span><span class="s2">)) </span><span class="s3">break</span><span class="s2">;</span>
    <span class="s1">result</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">result</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">integer</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">val</span><span class="s2">).</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/^[0-9]+$/</span><span class="s2">) ? </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) :</span>
    <span class="s1">Number</span><span class="s2">.</span><span class="s1">isFinite</span><span class="s2">(</span><span class="s1">val</span><span class="s2">) ? </span><span class="s1">parseInt</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s5">10</span><span class="s2">) : </span><span class="s5">0</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s2">},{}],</span><span class="s5">8</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s0">// http://wiki.commonjs.org/wiki/Unit_Testing/1.0</span>
<span class="s0">//</span>
<span class="s0">// THIS IS NOT TESTED NOR LIKELY TO WORK OUTSIDE V8!</span>
<span class="s0">//</span>
<span class="s0">// Originally from narwhal.js (http://narwhaljs.org)</span>
<span class="s0">// Copyright (c) 2009 Thomas Robinson &lt;280north.com&gt;</span>
<span class="s0">//</span>
<span class="s0">// Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="s0">// of this software and associated documentation files (the 'Software'), to</span>
<span class="s0">// deal in the Software without restriction, including without limitation the</span>
<span class="s0">// rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span>
<span class="s0">// sell copies of the Software, and to permit persons to whom the Software is</span>
<span class="s0">// furnished to do so, subject to the following conditions:</span>
<span class="s0">//</span>
<span class="s0">// The above copyright notice and this permission notice shall be included in</span>
<span class="s0">// all copies or substantial portions of the Software.</span>
<span class="s0">//</span>
<span class="s0">// THE SOFTWARE IS PROVIDED 'AS IS', WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="s0">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="s0">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="s0">// AUTHORS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="s0">// ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION</span>
<span class="s0">// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="s0">// when used in node, this will actually load the util module we depend on</span>
<span class="s0">// versus loading the builtin util module as happens otherwise</span>
<span class="s0">// this is a bug in node module loading as far as I am concerned</span>
<span class="s3">var </span><span class="s1">util </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'util/'</span><span class="s2">);</span>

<span class="s3">var </span><span class="s1">pSlice </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">;</span>
<span class="s3">var </span><span class="s1">hasOwn </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">;</span>

<span class="s0">// 1. The assert module provides functions that throw</span>
<span class="s0">// AssertionError's when particular conditions are not met. The</span>
<span class="s0">// assert module must conform to the following interface.</span>

<span class="s3">var </span><span class="s1">assert </span><span class="s2">= </span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">ok</span><span class="s2">;</span>

<span class="s0">// 2. The AssertionError is defined in assert.</span>
<span class="s0">// new assert.AssertionError({ message: message,</span>
<span class="s0">//                             actual: actual,</span>
<span class="s0">//                             expected: expected })</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">AssertionError </span><span class="s2">= </span><span class="s3">function </span><span class="s1">AssertionError</span><span class="s2">(</span><span class="s1">options</span><span class="s2">) {</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">name </span><span class="s2">= </span><span class="s4">'AssertionError'</span><span class="s2">;</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">actual </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">actual</span><span class="s2">;</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">expected </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">expected</span><span class="s2">;</span>
  <span class="s3">this</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">operator</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">options</span><span class="s2">.</span><span class="s1">message</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">message </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">message</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">generatedMessage </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">message </span><span class="s2">= </span><span class="s1">getMessage</span><span class="s2">(</span><span class="s3">this</span><span class="s2">);</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">generatedMessage </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">var </span><span class="s1">stackStartFunction </span><span class="s2">= </span><span class="s1">options</span><span class="s2">.</span><span class="s1">stackStartFunction </span><span class="s2">|| </span><span class="s1">fail</span><span class="s2">;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">Error</span><span class="s2">.</span><span class="s1">captureStackTrace</span><span class="s2">) {</span>
    <span class="s1">Error</span><span class="s2">.</span><span class="s1">captureStackTrace</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">stackStartFunction</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s3">else </span><span class="s2">{</span>
    <span class="s0">// non v8 browsers so we can have a stacktrace</span>
    <span class="s3">var </span><span class="s1">err </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Error</span><span class="s2">();</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">err</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">) {</span>
      <span class="s3">var </span><span class="s1">out </span><span class="s2">= </span><span class="s1">err</span><span class="s2">.</span><span class="s1">stack</span><span class="s2">;</span>

      <span class="s0">// try to strip useless frames</span>
      <span class="s3">var </span><span class="s1">fn_name </span><span class="s2">= </span><span class="s1">stackStartFunction</span><span class="s2">.</span><span class="s1">name</span><span class="s2">;</span>
      <span class="s3">var </span><span class="s1">idx </span><span class="s2">= </span><span class="s1">out</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">' </span><span class="s2">+ </span><span class="s1">fn_name</span><span class="s2">);</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">idx </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">) {</span>
        <span class="s0">// once we have located the function frame</span>
        <span class="s0">// we need to strip out everything before it (and its line)</span>
        <span class="s3">var </span><span class="s1">next_line </span><span class="s2">= </span><span class="s1">out</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">, </span><span class="s1">idx </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
        <span class="s1">out </span><span class="s2">= </span><span class="s1">out</span><span class="s2">.</span><span class="s1">substring</span><span class="s2">(</span><span class="s1">next_line </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
      <span class="s2">}</span>

      <span class="s3">this</span><span class="s2">.</span><span class="s1">stack </span><span class="s2">= </span><span class="s1">out</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s0">// assert.AssertionError instanceof Error</span>
<span class="s1">util</span><span class="s2">.</span><span class="s1">inherits</span><span class="s2">(</span><span class="s1">assert</span><span class="s2">.</span><span class="s1">AssertionError</span><span class="s2">, </span><span class="s1">Error</span><span class="s2">);</span>

<span class="s3">function </span><span class="s1">replacer</span><span class="s2">(</span><span class="s1">key</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">value</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) &amp;&amp; !</span><span class="s1">isFinite</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">value</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) || </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">value</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">();</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">value</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">truncate</span><span class="s2">(</span><span class="s1">s</span><span class="s2">, </span><span class="s1">n</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isString</span><span class="s2">(</span><span class="s1">s</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">s</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&lt; </span><span class="s1">n </span><span class="s2">? </span><span class="s1">s </span><span class="s2">: </span><span class="s1">s</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">n</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s3">return </span><span class="s1">s</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">getMessage</span><span class="s2">(</span><span class="s1">self</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">truncate</span><span class="s2">(</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">replacer</span><span class="s2">), </span><span class="s5">128</span><span class="s2">) + </span><span class="s4">' ' </span><span class="s2">+</span>
         <span class="s1">self</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+</span>
         <span class="s1">truncate</span><span class="s2">(</span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">self</span><span class="s2">.</span><span class="s1">expected</span><span class="s2">, </span><span class="s1">replacer</span><span class="s2">), </span><span class="s5">128</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">// At present only the three keys mentioned above are used and</span>
<span class="s0">// understood by the spec. Implementations or sub modules can pass</span>
<span class="s0">// other keys to the AssertionError's constructor - they will be</span>
<span class="s0">// ignored.</span>

<span class="s0">// 3. All of the following functions must throw an AssertionError</span>
<span class="s0">// when a corresponding condition is not met, with a message that</span>
<span class="s0">// may be undefined if not provided.  All assertion methods provide</span>
<span class="s0">// both the actual and expected values to the assertion error for</span>
<span class="s0">// display purposes.</span>

<span class="s3">function </span><span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s1">operator</span><span class="s2">, </span><span class="s1">stackStartFunction</span><span class="s2">) {</span>
  <span class="s3">throw new </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">AssertionError</span><span class="s2">({</span>
    <span class="s1">message</span><span class="s2">: </span><span class="s1">message</span><span class="s2">,</span>
    <span class="s1">actual</span><span class="s2">: </span><span class="s1">actual</span><span class="s2">,</span>
    <span class="s1">expected</span><span class="s2">: </span><span class="s1">expected</span><span class="s2">,</span>
    <span class="s1">operator</span><span class="s2">: </span><span class="s1">operator</span><span class="s2">,</span>
    <span class="s1">stackStartFunction</span><span class="s2">: </span><span class="s1">stackStartFunction</span>
  <span class="s2">});</span>
<span class="s2">}</span>

<span class="s0">// EXTENSION! allows for well behaved errors defined elsewhere.</span>
<span class="s1">assert</span><span class="s2">.</span><span class="s1">fail </span><span class="s2">= </span><span class="s1">fail</span><span class="s2">;</span>

<span class="s0">// 4. Pure assertion tests whether a value is truthy, as determined</span>
<span class="s0">// by !!guard.</span>
<span class="s0">// assert.ok(guard, message_opt);</span>
<span class="s0">// This statement is equivalent to assert.equal(true, !!guard,</span>
<span class="s0">// message_opt);. To test strictly for the value true, use</span>
<span class="s0">// assert.strictEqual(true, guard, message_opt);.</span>

<span class="s3">function </span><span class="s1">ok</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">value</span><span class="s2">) </span><span class="s1">fail</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s3">true</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'=='</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">ok</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s1">assert</span><span class="s2">.</span><span class="s1">ok </span><span class="s2">= </span><span class="s1">ok</span><span class="s2">;</span>

<span class="s0">// 5. The equality assertion tests shallow, coercive equality with</span>
<span class="s0">// ==.</span>
<span class="s0">// assert.equal(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">equal </span><span class="s2">= </span><span class="s3">function </span><span class="s1">equal</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">actual </span><span class="s2">!= </span><span class="s1">expected</span><span class="s2">) </span><span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'=='</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">equal</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s0">// 6. The non-equality assertion tests for whether two objects are not equal</span>
<span class="s0">// with != assert.notEqual(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">notEqual </span><span class="s2">= </span><span class="s3">function </span><span class="s1">notEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">actual </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'!='</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">notEqual</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s0">// 7. The equivalence assertion tests a deep equality relation.</span>
<span class="s0">// assert.deepEqual(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">deepEqual </span><span class="s2">= </span><span class="s3">function </span><span class="s1">deepEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">_deepEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'deepEqual'</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">deepEqual</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s3">function </span><span class="s1">_deepEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">) {</span>
  <span class="s0">// 7.1. All identical values are equivalent, as determined by ===.</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">actual </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s3">return true</span><span class="s2">;</span>

  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isBuffer</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) &amp;&amp; </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isBuffer</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">actual</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!= </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) </span><span class="s3">return false</span><span class="s2">;</span>

    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">actual</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">actual</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] !== </span><span class="s1">expected</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) </span><span class="s3">return false</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">return true</span><span class="s2">;</span>

  <span class="s0">// 7.2. If the expected value is a Date object, the actual value is</span>
  <span class="s0">// equivalent if it is also a Date object that refers to the same time.</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isDate</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) &amp;&amp; </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isDate</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">actual</span><span class="s2">.</span><span class="s1">getTime</span><span class="s2">() === </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">getTime</span><span class="s2">();</span>

  <span class="s0">// 7.3 If the expected value is a RegExp object, the actual value is</span>
  <span class="s0">// equivalent if it is also a RegExp object with the same source and</span>
  <span class="s0">// properties (`global`, `multiline`, `lastIndex`, `ignoreCase`).</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) &amp;&amp; </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">actual</span><span class="s2">.</span><span class="s1">source </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">source </span><span class="s2">&amp;&amp;</span>
           <span class="s1">actual</span><span class="s2">.</span><span class="s1">global </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">global </span><span class="s2">&amp;&amp;</span>
           <span class="s1">actual</span><span class="s2">.</span><span class="s1">multiline </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">multiline </span><span class="s2">&amp;&amp;</span>
           <span class="s1">actual</span><span class="s2">.</span><span class="s1">lastIndex </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">lastIndex </span><span class="s2">&amp;&amp;</span>
           <span class="s1">actual</span><span class="s2">.</span><span class="s1">ignoreCase </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">ignoreCase</span><span class="s2">;</span>

  <span class="s0">// 7.4. Other pairs that do not both pass typeof value == 'object',</span>
  <span class="s0">// equivalence is determined by ==.</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">) &amp;&amp; !</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">actual </span><span class="s2">== </span><span class="s1">expected</span><span class="s2">;</span>

  <span class="s0">// 7.5 For all other Object pairs, including Array objects, equivalence is</span>
  <span class="s0">// determined by having the same number of owned properties (as verified</span>
  <span class="s0">// with Object.prototype.hasOwnProperty.call), the same set of keys</span>
  <span class="s0">// (although not necessarily the same order), equivalent values for every</span>
  <span class="s0">// corresponding key, and an identical 'prototype' property. Note: this</span>
  <span class="s0">// accounts for both named and indexed properties on Arrays.</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s3">return </span><span class="s1">objEquiv</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">isArguments</span><span class="s2">(</span><span class="s1">object</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">object</span><span class="s2">) == </span><span class="s4">'[object Arguments]'</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">objEquiv</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isNullOrUndefined</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) || </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isNullOrUndefined</span><span class="s2">(</span><span class="s1">b</span><span class="s2">))</span>
    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s0">// an identical 'prototype' property.</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">a</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">!== </span><span class="s1">b</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">) </span><span class="s3">return false</span><span class="s2">;</span>
  <span class="s0">// if one is a primitive, the other must be same</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isPrimitive</span><span class="s2">(</span><span class="s1">a</span><span class="s2">) || </span><span class="s1">util</span><span class="s2">.</span><span class="s1">isPrimitive</span><span class="s2">(</span><span class="s1">b</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">a </span><span class="s2">=== </span><span class="s1">b</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">var </span><span class="s1">aIsArgs </span><span class="s2">= </span><span class="s1">isArguments</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
      <span class="s1">bIsArgs </span><span class="s2">= </span><span class="s1">isArguments</span><span class="s2">(</span><span class="s1">b</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">((</span><span class="s1">aIsArgs </span><span class="s2">&amp;&amp; !</span><span class="s1">bIsArgs</span><span class="s2">) || (!</span><span class="s1">aIsArgs </span><span class="s2">&amp;&amp; </span><span class="s1">bIsArgs</span><span class="s2">))</span>
    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">aIsArgs</span><span class="s2">) {</span>
    <span class="s1">a </span><span class="s2">= </span><span class="s1">pSlice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">a</span><span class="s2">);</span>
    <span class="s1">b </span><span class="s2">= </span><span class="s1">pSlice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">b</span><span class="s2">);</span>
    <span class="s3">return </span><span class="s1">_deepEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">, </span><span class="s1">b</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s3">var </span><span class="s1">ka </span><span class="s2">= </span><span class="s1">objectKeys</span><span class="s2">(</span><span class="s1">a</span><span class="s2">),</span>
      <span class="s1">kb </span><span class="s2">= </span><span class="s1">objectKeys</span><span class="s2">(</span><span class="s1">b</span><span class="s2">),</span>
      <span class="s1">key</span><span class="s2">, </span><span class="s1">i</span><span class="s2">;</span>
  <span class="s0">// having the same number of owned properties (keys incorporates</span>
  <span class="s0">// hasOwnProperty)</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">ka</span><span class="s2">.</span><span class="s1">length </span><span class="s2">!= </span><span class="s1">kb</span><span class="s2">.</span><span class="s1">length</span><span class="s2">)</span>
    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s0">//the same set of keys (although not necessarily the same order),</span>
  <span class="s1">ka</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">();</span>
  <span class="s1">kb</span><span class="s2">.</span><span class="s1">sort</span><span class="s2">();</span>
  <span class="s0">//~~~cheap key test</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">ka</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i</span><span class="s2">--) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">ka</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] != </span><span class="s1">kb</span><span class="s2">[</span><span class="s1">i</span><span class="s2">])</span>
      <span class="s3">return false</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s0">//equivalent values for every corresponding key, and</span>
  <span class="s0">//~~~possibly expensive deep test</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">ka</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i</span><span class="s2">--) {</span>
    <span class="s1">key </span><span class="s2">= </span><span class="s1">ka</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">_deepEqual</span><span class="s2">(</span><span class="s1">a</span><span class="s2">[</span><span class="s1">key</span><span class="s2">], </span><span class="s1">b</span><span class="s2">[</span><span class="s1">key</span><span class="s2">])) </span><span class="s3">return false</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">return true</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">// 8. The non-equivalence assertion tests for any deep inequality.</span>
<span class="s0">// assert.notDeepEqual(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">notDeepEqual </span><span class="s2">= </span><span class="s3">function </span><span class="s1">notDeepEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">_deepEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'notDeepEqual'</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">notDeepEqual</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s0">// 9. The strict equality assertion tests strict equality, as determined by ===.</span>
<span class="s0">// assert.strictEqual(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">strictEqual </span><span class="s2">= </span><span class="s3">function </span><span class="s1">strictEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">actual </span><span class="s2">!== </span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'==='</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">strictEqual</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s0">// 10. The strict non-equality assertion tests for strict inequality, as</span>
<span class="s0">// determined by !==.  assert.notStrictEqual(actual, expected, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">notStrictEqual </span><span class="s2">= </span><span class="s3">function </span><span class="s1">notStrictEqual</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">actual </span><span class="s2">=== </span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">, </span><span class="s4">'!=='</span><span class="s2">, </span><span class="s1">assert</span><span class="s2">.</span><span class="s1">notStrictEqual</span><span class="s2">);</span>
  <span class="s2">}</span>
<span class="s2">};</span>

<span class="s3">function </span><span class="s1">expectedException</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">actual </span><span class="s2">|| !</span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s3">return false</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">) == </span><span class="s4">'[object RegExp]'</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">test</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">actual </span><span class="s3">instanceof </span><span class="s1">expected</span><span class="s2">) {</span>
    <span class="s3">return true</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">expected</span><span class="s2">.</span><span class="s1">call</span><span class="s2">({}, </span><span class="s1">actual</span><span class="s2">) === </span><span class="s3">true</span><span class="s2">) {</span>
    <span class="s3">return true</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">return false</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">_throws</span><span class="s2">(</span><span class="s1">shouldThrow</span><span class="s2">, </span><span class="s1">block</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">actual</span><span class="s2">;</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">util</span><span class="s2">.</span><span class="s1">isString</span><span class="s2">(</span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s1">message </span><span class="s2">= </span><span class="s1">expected</span><span class="s2">;</span>
    <span class="s1">expected </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">try </span><span class="s2">{</span>
    <span class="s1">block</span><span class="s2">();</span>
  <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
    <span class="s1">actual </span><span class="s2">= </span><span class="s1">e</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s1">message </span><span class="s2">= (</span><span class="s1">expected </span><span class="s2">&amp;&amp; </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">name </span><span class="s2">? </span><span class="s4">' (' </span><span class="s2">+ </span><span class="s1">expected</span><span class="s2">.</span><span class="s1">name </span><span class="s2">+ </span><span class="s4">').' </span><span class="s2">: </span><span class="s4">'.'</span><span class="s2">) +</span>
            <span class="s2">(</span><span class="s1">message </span><span class="s2">? </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">message </span><span class="s2">: </span><span class="s4">'.'</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">shouldThrow </span><span class="s2">&amp;&amp; !</span><span class="s1">actual</span><span class="s2">) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s4">'Missing expected exception' </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(!</span><span class="s1">shouldThrow </span><span class="s2">&amp;&amp; </span><span class="s1">expectedException</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)) {</span>
    <span class="s1">fail</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">, </span><span class="s4">'Got unwanted exception' </span><span class="s2">+ </span><span class="s1">message</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">((</span><span class="s1">shouldThrow </span><span class="s2">&amp;&amp; </span><span class="s1">actual </span><span class="s2">&amp;&amp; </span><span class="s1">expected </span><span class="s2">&amp;&amp;</span>
      <span class="s2">!</span><span class="s1">expectedException</span><span class="s2">(</span><span class="s1">actual</span><span class="s2">, </span><span class="s1">expected</span><span class="s2">)) || (!</span><span class="s1">shouldThrow </span><span class="s2">&amp;&amp; </span><span class="s1">actual</span><span class="s2">)) {</span>
    <span class="s3">throw </span><span class="s1">actual</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s0">// 11. Expected to throw an error:</span>
<span class="s0">// assert.throws(block, Error_opt, message_opt);</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">throws </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">block</span><span class="s2">, </span><span class="s0">/*optional*/</span><span class="s1">error</span><span class="s2">, </span><span class="s0">/*optional*/</span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s1">_throws</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, [</span><span class="s3">true</span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">pSlice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">)));</span>
<span class="s2">};</span>

<span class="s0">// EXTENSION! This is annoying to write outside this module.</span>
<span class="s1">assert</span><span class="s2">.</span><span class="s1">doesNotThrow </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">block</span><span class="s2">, </span><span class="s0">/*optional*/</span><span class="s1">message</span><span class="s2">) {</span>
  <span class="s1">_throws</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, [</span><span class="s3">false</span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">pSlice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">)));</span>
<span class="s2">};</span>

<span class="s1">assert</span><span class="s2">.</span><span class="s1">ifError </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">err</span><span class="s2">) { </span><span class="s3">if </span><span class="s2">(</span><span class="s1">err</span><span class="s2">) {</span><span class="s3">throw </span><span class="s1">err</span><span class="s2">;}};</span>

<span class="s3">var </span><span class="s1">objectKeys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys </span><span class="s2">|| </span><span class="s3">function </span><span class="s2">(</span><span class="s1">obj</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">keys </span><span class="s2">= [];</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">key </span><span class="s3">in </span><span class="s1">obj</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwn</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">key</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">keys</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s2">},{</span><span class="s4">&quot;util/&quot;</span><span class="s2">:</span><span class="s5">11</span><span class="s2">}],</span><span class="s5">9</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
  <span class="s0">// implementation from standard node.js 'util' module</span>
  <span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function </span><span class="s1">inherits</span><span class="s2">(</span><span class="s1">ctor</span><span class="s2">, </span><span class="s1">superCtor</span><span class="s2">) {</span>
    <span class="s1">ctor</span><span class="s2">.</span><span class="s1">super_ </span><span class="s2">= </span><span class="s1">superCtor</span>
    <span class="s1">ctor</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">create</span><span class="s2">(</span><span class="s1">superCtor</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">, {</span>
      <span class="s1">constructor</span><span class="s2">: {</span>
        <span class="s1">value</span><span class="s2">: </span><span class="s1">ctor</span><span class="s2">,</span>
        <span class="s1">enumerable</span><span class="s2">: </span><span class="s3">false</span><span class="s2">,</span>
        <span class="s1">writable</span><span class="s2">: </span><span class="s3">true</span><span class="s2">,</span>
        <span class="s1">configurable</span><span class="s2">: </span><span class="s3">true</span>
      <span class="s2">}</span>
    <span class="s2">});</span>
  <span class="s2">};</span>
<span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
  <span class="s0">// old school shim for old browsers</span>
  <span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function </span><span class="s1">inherits</span><span class="s2">(</span><span class="s1">ctor</span><span class="s2">, </span><span class="s1">superCtor</span><span class="s2">) {</span>
    <span class="s1">ctor</span><span class="s2">.</span><span class="s1">super_ </span><span class="s2">= </span><span class="s1">superCtor</span>
    <span class="s3">var </span><span class="s1">TempCtor </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {}</span>
    <span class="s1">TempCtor</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s1">superCtor</span><span class="s2">.</span><span class="s1">prototype</span>
    <span class="s1">ctor</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">= </span><span class="s3">new </span><span class="s1">TempCtor</span><span class="s2">()</span>
    <span class="s1">ctor</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">= </span><span class="s1">ctor</span>
  <span class="s2">}</span>
<span class="s2">}</span>

<span class="s2">},{}],</span><span class="s5">10</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function </span><span class="s1">isBuffer</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">arg </span><span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'object'</span>
    <span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">copy </span><span class="s2">=== </span><span class="s4">'function'</span>
    <span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">fill </span><span class="s2">=== </span><span class="s4">'function'</span>
    <span class="s2">&amp;&amp; </span><span class="s3">typeof </span><span class="s1">arg</span><span class="s2">.</span><span class="s1">readUInt8 </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s2">},{}],</span><span class="s5">11</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">process</span><span class="s2">,</span><span class="s1">global</span><span class="s2">){</span>
<span class="s0">// Copyright Joyent, Inc. and other Node contributors.</span>
<span class="s0">//</span>
<span class="s0">// Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="s0">// copy of this software and associated documentation files (the</span>
<span class="s0">// &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="s0">// without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="s0">// distribute, sublicense, and/or sell copies of the Software, and to permit</span>
<span class="s0">// persons to whom the Software is furnished to do so, subject to the</span>
<span class="s0">// following conditions:</span>
<span class="s0">//</span>
<span class="s0">// The above copyright notice and this permission notice shall be included</span>
<span class="s0">// in all copies or substantial portions of the Software.</span>
<span class="s0">//</span>
<span class="s0">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="s0">// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="s0">// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN</span>
<span class="s0">// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,</span>
<span class="s0">// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<span class="s0">// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE</span>
<span class="s0">// USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="s3">var </span><span class="s1">formatRegExp </span><span class="s2">= </span><span class="s6">/%[sdj%]/g</span><span class="s2">;</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">format </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">f</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">isString</span><span class="s2">(</span><span class="s1">f</span><span class="s2">)) {</span>
    <span class="s3">var </span><span class="s1">objects </span><span class="s2">= [];</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
      <span class="s1">objects</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">inspect</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]));</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">objects</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">' '</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">len </span><span class="s2">= </span><span class="s1">args</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">str </span><span class="s2">= </span><span class="s1">String</span><span class="s2">(</span><span class="s1">f</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s1">formatRegExp</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">x </span><span class="s2">=== </span><span class="s4">'%%'</span><span class="s2">) </span><span class="s3">return </span><span class="s4">'%'</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s1">len</span><span class="s2">) </span><span class="s3">return </span><span class="s1">x</span><span class="s2">;</span>
    <span class="s3">switch </span><span class="s2">(</span><span class="s1">x</span><span class="s2">) {</span>
      <span class="s3">case </span><span class="s4">'%s'</span><span class="s2">: </span><span class="s3">return </span><span class="s1">String</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">++]);</span>
      <span class="s3">case </span><span class="s4">'%d'</span><span class="s2">: </span><span class="s3">return </span><span class="s1">Number</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">++]);</span>
      <span class="s3">case </span><span class="s4">'%j'</span><span class="s2">:</span>
        <span class="s3">try </span><span class="s2">{</span>
          <span class="s3">return </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">++]);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">_</span><span class="s2">) {</span>
          <span class="s3">return </span><span class="s4">'[Circular]'</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s3">default</span><span class="s2">:</span>
        <span class="s3">return </span><span class="s1">x</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">});</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">x </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">; </span><span class="s1">x </span><span class="s2">= </span><span class="s1">args</span><span class="s2">[++</span><span class="s1">i</span><span class="s2">]) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isNull</span><span class="s2">(</span><span class="s1">x</span><span class="s2">) || !</span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">x</span><span class="s2">)) {</span>
      <span class="s1">str </span><span class="s2">+= </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">x</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">str </span><span class="s2">+= </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">inspect</span><span class="s2">(</span><span class="s1">x</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">str</span><span class="s2">;</span>
<span class="s2">};</span>


<span class="s0">// Mark that a method should not be used.</span>
<span class="s0">// Returns a modified function which warns once by default.</span>
<span class="s0">// If --no-deprecation is set, then it is a no-op.</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">deprecate </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">) {</span>
  <span class="s0">// Allow for deprecating things in the process of starting up.</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">global</span><span class="s2">.</span><span class="s1">process</span><span class="s2">)) {</span>
    <span class="s3">return function</span><span class="s2">() {</span>
      <span class="s3">return </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">deprecate</span><span class="s2">(</span><span class="s1">fn</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">).</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
    <span class="s2">};</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">process</span><span class="s2">.</span><span class="s1">noDeprecation </span><span class="s2">=== </span><span class="s3">true</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">fn</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">warned </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s3">function </span><span class="s1">deprecated</span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">warned</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">process</span><span class="s2">.</span><span class="s1">throwDeprecation</span><span class="s2">) {</span>
        <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">process</span><span class="s2">.</span><span class="s1">traceDeprecation</span><span class="s2">) {</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">trace</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s1">msg</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s1">warned </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">fn</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">deprecated</span><span class="s2">;</span>
<span class="s2">};</span>


<span class="s3">var </span><span class="s1">debugs </span><span class="s2">= {};</span>
<span class="s3">var </span><span class="s1">debugEnviron</span><span class="s2">;</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">debuglog </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">set</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">debugEnviron</span><span class="s2">))</span>
    <span class="s1">debugEnviron </span><span class="s2">= </span><span class="s1">process</span><span class="s2">.</span><span class="s1">env</span><span class="s2">.</span><span class="s1">NODE_DEBUG </span><span class="s2">|| </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s1">set </span><span class="s2">= </span><span class="s1">set</span><span class="s2">.</span><span class="s1">toUpperCase</span><span class="s2">();</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">debugs</span><span class="s2">[</span><span class="s1">set</span><span class="s2">]) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">new </span><span class="s1">RegExp</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\\</span><span class="s4">b' </span><span class="s2">+ </span><span class="s1">set </span><span class="s2">+ </span><span class="s4">'</span><span class="s3">\\</span><span class="s4">b'</span><span class="s2">, </span><span class="s4">'i'</span><span class="s2">).</span><span class="s1">test</span><span class="s2">(</span><span class="s1">debugEnviron</span><span class="s2">)) {</span>
      <span class="s3">var </span><span class="s1">pid </span><span class="s2">= </span><span class="s1">process</span><span class="s2">.</span><span class="s1">pid</span><span class="s2">;</span>
      <span class="s1">debugs</span><span class="s2">[</span><span class="s1">set</span><span class="s2">] = </span><span class="s3">function</span><span class="s2">() {</span>
        <span class="s3">var </span><span class="s1">msg </span><span class="s2">= </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">format</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">exports</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">);</span>
        <span class="s1">console</span><span class="s2">.</span><span class="s1">error</span><span class="s2">(</span><span class="s4">'%s %d: %s'</span><span class="s2">, </span><span class="s1">set</span><span class="s2">, </span><span class="s1">pid</span><span class="s2">, </span><span class="s1">msg</span><span class="s2">);</span>
      <span class="s2">};</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">debugs</span><span class="s2">[</span><span class="s1">set</span><span class="s2">] = </span><span class="s3">function</span><span class="s2">() {};</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">debugs</span><span class="s2">[</span><span class="s1">set</span><span class="s2">];</span>
<span class="s2">};</span>


<span class="s7">/**</span>
 <span class="s7">* Echos the value of a value. Trys to print the value out</span>
 <span class="s7">* in the best way possible given the different types.</span>
 <span class="s7">*</span>
 <span class="s7">* </span><span class="s8">@param </span><span class="s7">{Object} obj The object to print out.</span>
 <span class="s7">* </span><span class="s8">@param </span><span class="s7">{Object} opts Optional options object that alters the output.</span>
 <span class="s7">*/</span>
<span class="s0">/* legacy: obj, showHidden, depth, colors*/</span>
<span class="s3">function </span><span class="s1">inspect</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">opts</span><span class="s2">) {</span>
  <span class="s0">// default options</span>
  <span class="s3">var </span><span class="s1">ctx </span><span class="s2">= {</span>
    <span class="s1">seen</span><span class="s2">: [],</span>
    <span class="s1">stylize</span><span class="s2">: </span><span class="s1">stylizeNoColor</span>
  <span class="s2">};</span>
  <span class="s0">// legacy...</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s5">3</span><span class="s2">) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">depth </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">[</span><span class="s5">2</span><span class="s2">];</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt;= </span><span class="s5">4</span><span class="s2">) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">colors </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">[</span><span class="s5">3</span><span class="s2">];</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isBoolean</span><span class="s2">(</span><span class="s1">opts</span><span class="s2">)) {</span>
    <span class="s0">// legacy...</span>
    <span class="s1">ctx</span><span class="s2">.</span><span class="s1">showHidden </span><span class="s2">= </span><span class="s1">opts</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">opts</span><span class="s2">) {</span>
    <span class="s0">// got an &quot;options&quot; object</span>
    <span class="s1">exports</span><span class="s2">.</span><span class="s1">_extend</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">opts</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s0">// set default options</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">showHidden</span><span class="s2">)) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">showHidden </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">depth</span><span class="s2">)) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">depth </span><span class="s2">= </span><span class="s5">2</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">)) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">colors </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">customInspect</span><span class="s2">)) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">customInspect </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">) </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize </span><span class="s2">= </span><span class="s1">stylizeWithColor</span><span class="s2">;</span>
  <span class="s3">return </span><span class="s1">formatValue</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">obj</span><span class="s2">, </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">depth</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">inspect </span><span class="s2">= </span><span class="s1">inspect</span><span class="s2">;</span>


<span class="s0">// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics</span>
<span class="s1">inspect</span><span class="s2">.</span><span class="s1">colors </span><span class="s2">= {</span>
  <span class="s4">'bold' </span><span class="s2">: [</span><span class="s5">1</span><span class="s2">, </span><span class="s5">22</span><span class="s2">],</span>
  <span class="s4">'italic' </span><span class="s2">: [</span><span class="s5">3</span><span class="s2">, </span><span class="s5">23</span><span class="s2">],</span>
  <span class="s4">'underline' </span><span class="s2">: [</span><span class="s5">4</span><span class="s2">, </span><span class="s5">24</span><span class="s2">],</span>
  <span class="s4">'inverse' </span><span class="s2">: [</span><span class="s5">7</span><span class="s2">, </span><span class="s5">27</span><span class="s2">],</span>
  <span class="s4">'white' </span><span class="s2">: [</span><span class="s5">37</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'grey' </span><span class="s2">: [</span><span class="s5">90</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'black' </span><span class="s2">: [</span><span class="s5">30</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'blue' </span><span class="s2">: [</span><span class="s5">34</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'cyan' </span><span class="s2">: [</span><span class="s5">36</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'green' </span><span class="s2">: [</span><span class="s5">32</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'magenta' </span><span class="s2">: [</span><span class="s5">35</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'red' </span><span class="s2">: [</span><span class="s5">31</span><span class="s2">, </span><span class="s5">39</span><span class="s2">],</span>
  <span class="s4">'yellow' </span><span class="s2">: [</span><span class="s5">33</span><span class="s2">, </span><span class="s5">39</span><span class="s2">]</span>
<span class="s2">};</span>

<span class="s0">// Don't use 'blue' not visible on cmd.exe</span>
<span class="s1">inspect</span><span class="s2">.</span><span class="s1">styles </span><span class="s2">= {</span>
  <span class="s4">'special'</span><span class="s2">: </span><span class="s4">'cyan'</span><span class="s2">,</span>
  <span class="s4">'number'</span><span class="s2">: </span><span class="s4">'yellow'</span><span class="s2">,</span>
  <span class="s4">'boolean'</span><span class="s2">: </span><span class="s4">'yellow'</span><span class="s2">,</span>
  <span class="s4">'undefined'</span><span class="s2">: </span><span class="s4">'grey'</span><span class="s2">,</span>
  <span class="s4">'null'</span><span class="s2">: </span><span class="s4">'bold'</span><span class="s2">,</span>
  <span class="s4">'string'</span><span class="s2">: </span><span class="s4">'green'</span><span class="s2">,</span>
  <span class="s4">'date'</span><span class="s2">: </span><span class="s4">'magenta'</span><span class="s2">,</span>
  <span class="s0">// &quot;name&quot;: intentionally not styling</span>
  <span class="s4">'regexp'</span><span class="s2">: </span><span class="s4">'red'</span>
<span class="s2">};</span>


<span class="s3">function </span><span class="s1">stylizeWithColor</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">styleType</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">style </span><span class="s2">= </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">styles</span><span class="s2">[</span><span class="s1">styleType</span><span class="s2">];</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">style</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s4">'</span><span class="s3">\u001b</span><span class="s4">[' </span><span class="s2">+ </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">[</span><span class="s1">style</span><span class="s2">][</span><span class="s5">0</span><span class="s2">] + </span><span class="s4">'m' </span><span class="s2">+ </span><span class="s1">str </span><span class="s2">+</span>
           <span class="s4">'</span><span class="s3">\u001b</span><span class="s4">[' </span><span class="s2">+ </span><span class="s1">inspect</span><span class="s2">.</span><span class="s1">colors</span><span class="s2">[</span><span class="s1">style</span><span class="s2">][</span><span class="s5">1</span><span class="s2">] + </span><span class="s4">'m'</span><span class="s2">;</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s3">return </span><span class="s1">str</span><span class="s2">;</span>
  <span class="s2">}</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">stylizeNoColor</span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">styleType</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">str</span><span class="s2">;</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">arrayToHash</span><span class="s2">(</span><span class="s1">array</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">hash </span><span class="s2">= {};</span>

  <span class="s1">array</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">val</span><span class="s2">, </span><span class="s1">idx</span><span class="s2">) {</span>
    <span class="s1">hash</span><span class="s2">[</span><span class="s1">val</span><span class="s2">] = </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s2">});</span>

  <span class="s3">return </span><span class="s1">hash</span><span class="s2">;</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">formatValue</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">) {</span>
  <span class="s0">// Provide a hook for user-specified inspect functions.</span>
  <span class="s0">// Check that value is an object with an inspect function on it</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">customInspect </span><span class="s2">&amp;&amp;</span>
      <span class="s1">value </span><span class="s2">&amp;&amp;</span>
      <span class="s1">isFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">inspect</span><span class="s2">) &amp;&amp;</span>
      <span class="s0">// Filter out the util module, it's inspect function is special</span>
      <span class="s1">value</span><span class="s2">.</span><span class="s1">inspect </span><span class="s2">!== </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">inspect </span><span class="s2">&amp;&amp;</span>
      <span class="s0">// Also filter out any prototype objects using the circular check.</span>
      <span class="s2">!(</span><span class="s1">value</span><span class="s2">.</span><span class="s1">constructor </span><span class="s2">&amp;&amp; </span><span class="s1">value</span><span class="s2">.</span><span class="s1">constructor</span><span class="s2">.</span><span class="s1">prototype </span><span class="s2">=== </span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">var </span><span class="s1">ret </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">inspect</span><span class="s2">(</span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">ctx</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">isString</span><span class="s2">(</span><span class="s1">ret</span><span class="s2">)) {</span>
      <span class="s1">ret </span><span class="s2">= </span><span class="s1">formatValue</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">ret</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">ret</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s0">// Primitive types cannot have properties</span>
  <span class="s3">var </span><span class="s1">primitive </span><span class="s2">= </span><span class="s1">formatPrimitive</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">primitive</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">primitive</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s0">// Look up the keys of the object.</span>
  <span class="s3">var </span><span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">visibleKeys </span><span class="s2">= </span><span class="s1">arrayToHash</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">showHidden</span><span class="s2">) {</span>
    <span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">getOwnPropertyNames</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">// IE doesn't make error fields non-enumerable</span>
  <span class="s0">// http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)</span>
      <span class="s2">&amp;&amp; (</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'message'</span><span class="s2">) &gt;= </span><span class="s5">0 </span><span class="s2">|| </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'description'</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">formatError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">// Some type of object without properties can be shortcutted.</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">var </span><span class="s1">name </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">name </span><span class="s2">? </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">value</span><span class="s2">.</span><span class="s1">name </span><span class="s2">: </span><span class="s4">''</span><span class="s2">;</span>
      <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Function' </span><span class="s2">+ </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">']'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">RegExp</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s4">'regexp'</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isDate</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">Date</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s4">'date'</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">formatError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">base </span><span class="s2">= </span><span class="s4">''</span><span class="s2">, </span><span class="s1">array </span><span class="s2">= </span><span class="s3">false</span><span class="s2">, </span><span class="s1">braces </span><span class="s2">= [</span><span class="s4">'{'</span><span class="s2">, </span><span class="s4">'}'</span><span class="s2">];</span>

  <span class="s0">// Make Array say that they are Array</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s1">array </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
    <span class="s1">braces </span><span class="s2">= [</span><span class="s4">'['</span><span class="s2">, </span><span class="s4">']'</span><span class="s2">];</span>
  <span class="s2">}</span>

  <span class="s0">// Make functions say that they are functions</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">var </span><span class="s1">n </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">name </span><span class="s2">? </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">value</span><span class="s2">.</span><span class="s1">name </span><span class="s2">: </span><span class="s4">''</span><span class="s2">;</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s4">' [Function' </span><span class="s2">+ </span><span class="s1">n </span><span class="s2">+ </span><span class="s4">']'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s0">// Make RegExps say that they are RegExps</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">RegExp</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">// Make dates with properties first say the date</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isDate</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">Date</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toUTCString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s0">// Make error with message first say the error</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s1">base </span><span class="s2">= </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">formatError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">&amp;&amp; (!</span><span class="s1">array </span><span class="s2">|| </span><span class="s1">value</span><span class="s2">.</span><span class="s1">length </span><span class="s2">== </span><span class="s5">0</span><span class="s2">)) {</span>
    <span class="s3">return </span><span class="s1">braces</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">base </span><span class="s2">+ </span><span class="s1">braces</span><span class="s2">[</span><span class="s5">1</span><span class="s2">];</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">recurseTimes </span><span class="s2">&lt; </span><span class="s5">0</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">RegExp</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">), </span><span class="s4">'regexp'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Object]'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s1">ctx</span><span class="s2">.</span><span class="s1">seen</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">value</span><span class="s2">);</span>

  <span class="s3">var </span><span class="s1">output</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">array</span><span class="s2">) {</span>
    <span class="s1">output </span><span class="s2">= </span><span class="s1">formatArray</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">);</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s1">output </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
      <span class="s3">return </span><span class="s1">formatProperty</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">array</span><span class="s2">);</span>
    <span class="s2">});</span>
  <span class="s2">}</span>

  <span class="s1">ctx</span><span class="s2">.</span><span class="s1">seen</span><span class="s2">.</span><span class="s1">pop</span><span class="s2">();</span>

  <span class="s3">return </span><span class="s1">reduceToSingleString</span><span class="s2">(</span><span class="s1">output</span><span class="s2">, </span><span class="s1">base</span><span class="s2">, </span><span class="s1">braces</span><span class="s2">);</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">formatPrimitive</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
    <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'undefined'</span><span class="s2">, </span><span class="s4">'undefined'</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isString</span><span class="s2">(</span><span class="s1">value</span><span class="s2">)) {</span>
    <span class="s3">var </span><span class="s1">simple </span><span class="s2">= </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">' </span><span class="s2">+ </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s1">value</span><span class="s2">).</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/^&quot;|&quot;$/g</span><span class="s2">, </span><span class="s4">''</span><span class="s2">)</span>
                                             <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/'/g</span><span class="s2">, </span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">'&quot;</span><span class="s2">)</span>
                                             <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\\&quot;/g</span><span class="s2">, </span><span class="s4">'&quot;'</span><span class="s2">) + </span><span class="s4">'</span><span class="s3">\'</span><span class="s4">'</span><span class="s2">;</span>
    <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">simple</span><span class="s2">, </span><span class="s4">'string'</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
    <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">value</span><span class="s2">, </span><span class="s4">'number'</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isBoolean</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
    <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">value</span><span class="s2">, </span><span class="s4">'boolean'</span><span class="s2">);</span>
  <span class="s0">// For some reason typeof null is &quot;object&quot;, so special case here.</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isNull</span><span class="s2">(</span><span class="s1">value</span><span class="s2">))</span>
    <span class="s3">return </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'null'</span><span class="s2">, </span><span class="s4">'null'</span><span class="s2">);</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">formatError</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s4">'[' </span><span class="s2">+ </span><span class="s1">Error</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">value</span><span class="s2">) + </span><span class="s4">']'</span><span class="s2">;</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">formatArray</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">, </span><span class="s1">keys</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">output </span><span class="s2">= [];</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">l </span><span class="s2">= </span><span class="s1">value</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">l</span><span class="s2">; ++</span><span class="s1">i</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">String</span><span class="s2">(</span><span class="s1">i</span><span class="s2">))) {</span>
      <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">formatProperty</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">,</span>
          <span class="s1">String</span><span class="s2">(</span><span class="s1">i</span><span class="s2">), </span><span class="s3">true</span><span class="s2">));</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s4">''</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s1">keys</span><span class="s2">.</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">key</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/^\d+$/</span><span class="s2">)) {</span>
      <span class="s1">output</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">formatProperty</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">,</span>
          <span class="s1">key</span><span class="s2">, </span><span class="s3">true</span><span class="s2">));</span>
    <span class="s2">}</span>
  <span class="s2">});</span>
  <span class="s3">return </span><span class="s1">output</span><span class="s2">;</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">formatProperty</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes</span><span class="s2">, </span><span class="s1">visibleKeys</span><span class="s2">, </span><span class="s1">key</span><span class="s2">, </span><span class="s1">array</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">name</span><span class="s2">, </span><span class="s1">str</span><span class="s2">, </span><span class="s1">desc</span><span class="s2">;</span>
  <span class="s1">desc </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">getOwnPropertyDescriptor</span><span class="s2">(</span><span class="s1">value</span><span class="s2">, </span><span class="s1">key</span><span class="s2">) || { </span><span class="s1">value</span><span class="s2">: </span><span class="s1">value</span><span class="s2">[</span><span class="s1">key</span><span class="s2">] };</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">desc</span><span class="s2">.</span><span class="s1">get</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">desc</span><span class="s2">.</span><span class="s1">set</span><span class="s2">) {</span>
      <span class="s1">str </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Getter/Setter]'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">str </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Getter]'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">desc</span><span class="s2">.</span><span class="s1">set</span><span class="s2">) {</span>
      <span class="s1">str </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Setter]'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">visibleKeys</span><span class="s2">, </span><span class="s1">key</span><span class="s2">)) {</span>
    <span class="s1">name </span><span class="s2">= </span><span class="s4">'[' </span><span class="s2">+ </span><span class="s1">key </span><span class="s2">+ </span><span class="s4">']'</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">str</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">seen</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s1">desc</span><span class="s2">.</span><span class="s1">value</span><span class="s2">) &lt; </span><span class="s5">0</span><span class="s2">) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">isNull</span><span class="s2">(</span><span class="s1">recurseTimes</span><span class="s2">)) {</span>
        <span class="s1">str </span><span class="s2">= </span><span class="s1">formatValue</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">desc</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s3">null</span><span class="s2">);</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">str </span><span class="s2">= </span><span class="s1">formatValue</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">desc</span><span class="s2">.</span><span class="s1">value</span><span class="s2">, </span><span class="s1">recurseTimes </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
      <span class="s2">}</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">str</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">) &gt; -</span><span class="s5">1</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">array</span><span class="s2">) {</span>
          <span class="s1">str </span><span class="s2">= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">line</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s4">'  ' </span><span class="s2">+ </span><span class="s1">line</span><span class="s2">;</span>
          <span class="s2">}).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">).</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">2</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
          <span class="s1">str </span><span class="s2">= </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">' </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">).</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">line</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s4">'   ' </span><span class="s2">+ </span><span class="s1">line</span><span class="s2">;</span>
          <span class="s2">}).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">);</span>
        <span class="s2">}</span>
      <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">str </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s4">'[Circular]'</span><span class="s2">, </span><span class="s4">'special'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">name</span><span class="s2">)) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">array </span><span class="s2">&amp;&amp; </span><span class="s1">key</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/^\d+$/</span><span class="s2">)) {</span>
      <span class="s3">return </span><span class="s1">str</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s1">name </span><span class="s2">= </span><span class="s1">JSON</span><span class="s2">.</span><span class="s1">stringify</span><span class="s2">(</span><span class="s4">'' </span><span class="s2">+ </span><span class="s1">key</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">name</span><span class="s2">.</span><span class="s1">match</span><span class="s2">(</span><span class="s6">/^&quot;([a-zA-Z_][a-zA-Z_0-9]*)&quot;$/</span><span class="s2">)) {</span>
      <span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">, </span><span class="s1">name</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">2</span><span class="s2">);</span>
      <span class="s1">name </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s4">'name'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s1">name </span><span class="s2">= </span><span class="s1">name</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/'/g</span><span class="s2">, </span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">'&quot;</span><span class="s2">)</span>
                 <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\\&quot;/g</span><span class="s2">, </span><span class="s4">'&quot;'</span><span class="s2">)</span>
                 <span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/(^&quot;|&quot;$)/g</span><span class="s2">, </span><span class="s4">&quot;'&quot;</span><span class="s2">);</span>
      <span class="s1">name </span><span class="s2">= </span><span class="s1">ctx</span><span class="s2">.</span><span class="s1">stylize</span><span class="s2">(</span><span class="s1">name</span><span class="s2">, </span><span class="s4">'string'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">name </span><span class="s2">+ </span><span class="s4">': ' </span><span class="s2">+ </span><span class="s1">str</span><span class="s2">;</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">reduceToSingleString</span><span class="s2">(</span><span class="s1">output</span><span class="s2">, </span><span class="s1">base</span><span class="s2">, </span><span class="s1">braces</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">numLinesEst </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">length </span><span class="s2">= </span><span class="s1">output</span><span class="s2">.</span><span class="s1">reduce</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">prev</span><span class="s2">, </span><span class="s1">cur</span><span class="s2">) {</span>
    <span class="s1">numLinesEst</span><span class="s2">++;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">cur</span><span class="s2">.</span><span class="s1">indexOf</span><span class="s2">(</span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s2">) &gt;= </span><span class="s5">0</span><span class="s2">) </span><span class="s1">numLinesEst</span><span class="s2">++;</span>
    <span class="s3">return </span><span class="s1">prev </span><span class="s2">+ </span><span class="s1">cur</span><span class="s2">.</span><span class="s1">replace</span><span class="s2">(</span><span class="s6">/\u001b\[\d\d?m/g</span><span class="s2">, </span><span class="s4">''</span><span class="s2">).</span><span class="s1">length </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
  <span class="s2">}, </span><span class="s5">0</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">60</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s1">braces</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] +</span>
           <span class="s2">(</span><span class="s1">base </span><span class="s2">=== </span><span class="s4">'' </span><span class="s2">? </span><span class="s4">'' </span><span class="s2">: </span><span class="s1">base </span><span class="s2">+ </span><span class="s4">'</span><span class="s3">\n </span><span class="s4">'</span><span class="s2">) +</span>
           <span class="s4">' ' </span><span class="s2">+</span>
           <span class="s1">output</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">',</span><span class="s3">\n  </span><span class="s4">'</span><span class="s2">) +</span>
           <span class="s4">' ' </span><span class="s2">+</span>
           <span class="s1">braces</span><span class="s2">[</span><span class="s5">1</span><span class="s2">];</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">braces</span><span class="s2">[</span><span class="s5">0</span><span class="s2">] + </span><span class="s1">base </span><span class="s2">+ </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">output</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">', '</span><span class="s2">) + </span><span class="s4">' ' </span><span class="s2">+ </span><span class="s1">braces</span><span class="s2">[</span><span class="s5">1</span><span class="s2">];</span>
<span class="s2">}</span>


<span class="s0">// NOTE: These type checking functions intentionally don't use `instanceof`</span>
<span class="s0">// because it is fragile and can be easily faked with `Object.create()`.</span>
<span class="s3">function </span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">ar</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">isArray</span><span class="s2">(</span><span class="s1">ar</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isArray </span><span class="s2">= </span><span class="s1">isArray</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isBoolean</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'boolean'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isBoolean </span><span class="s2">= </span><span class="s1">isBoolean</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isNull</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">arg </span><span class="s2">=== </span><span class="s3">null</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isNull </span><span class="s2">= </span><span class="s1">isNull</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isNullOrUndefined</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">arg </span><span class="s2">== </span><span class="s3">null</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isNullOrUndefined </span><span class="s2">= </span><span class="s1">isNullOrUndefined</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isNumber</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'number'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isNumber </span><span class="s2">= </span><span class="s1">isNumber</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isString</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'string'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isString </span><span class="s2">= </span><span class="s1">isString</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isSymbol</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'symbol'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isSymbol </span><span class="s2">= </span><span class="s1">isSymbol</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isUndefined</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">arg </span><span class="s2">=== </span><span class="s3">void </span><span class="s5">0</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isUndefined </span><span class="s2">= </span><span class="s1">isUndefined</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isRegExp</span><span class="s2">(</span><span class="s1">re</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">re</span><span class="s2">) &amp;&amp; </span><span class="s1">objectToString</span><span class="s2">(</span><span class="s1">re</span><span class="s2">) === </span><span class="s4">'[object RegExp]'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isRegExp </span><span class="s2">= </span><span class="s1">isRegExp</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'object' </span><span class="s2">&amp;&amp; </span><span class="s1">arg </span><span class="s2">!== </span><span class="s3">null</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isObject </span><span class="s2">= </span><span class="s1">isObject</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isDate</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) &amp;&amp; </span><span class="s1">objectToString</span><span class="s2">(</span><span class="s1">d</span><span class="s2">) === </span><span class="s4">'[object Date]'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isDate </span><span class="s2">= </span><span class="s1">isDate</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isError</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) &amp;&amp;</span>
      <span class="s2">(</span><span class="s1">objectToString</span><span class="s2">(</span><span class="s1">e</span><span class="s2">) === </span><span class="s4">'[object Error]' </span><span class="s2">|| </span><span class="s1">e </span><span class="s3">instanceof </span><span class="s1">Error</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isError </span><span class="s2">= </span><span class="s1">isError</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isFunction</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isFunction </span><span class="s2">= </span><span class="s1">isFunction</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">isPrimitive</span><span class="s2">(</span><span class="s1">arg</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">arg </span><span class="s2">=== </span><span class="s3">null </span><span class="s2">||</span>
         <span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'boolean' </span><span class="s2">||</span>
         <span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'number' </span><span class="s2">||</span>
         <span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'string' </span><span class="s2">||</span>
         <span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'symbol' </span><span class="s2">||  </span><span class="s0">// ES6 symbol</span>
         <span class="s3">typeof </span><span class="s1">arg </span><span class="s2">=== </span><span class="s4">'undefined'</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isPrimitive </span><span class="s2">= </span><span class="s1">isPrimitive</span><span class="s2">;</span>

<span class="s1">exports</span><span class="s2">.</span><span class="s1">isBuffer </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./support/isBuffer'</span><span class="s2">);</span>

<span class="s3">function </span><span class="s1">objectToString</span><span class="s2">(</span><span class="s1">o</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">o</span><span class="s2">);</span>
<span class="s2">}</span>


<span class="s3">function </span><span class="s1">pad</span><span class="s2">(</span><span class="s1">n</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">n </span><span class="s2">&lt; </span><span class="s5">10 </span><span class="s2">? </span><span class="s4">'0' </span><span class="s2">+ </span><span class="s1">n</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">(</span><span class="s5">10</span><span class="s2">) : </span><span class="s1">n</span><span class="s2">.</span><span class="s1">toString</span><span class="s2">(</span><span class="s5">10</span><span class="s2">);</span>
<span class="s2">}</span>


<span class="s3">var </span><span class="s1">months </span><span class="s2">= [</span><span class="s4">'Jan'</span><span class="s2">, </span><span class="s4">'Feb'</span><span class="s2">, </span><span class="s4">'Mar'</span><span class="s2">, </span><span class="s4">'Apr'</span><span class="s2">, </span><span class="s4">'May'</span><span class="s2">, </span><span class="s4">'Jun'</span><span class="s2">, </span><span class="s4">'Jul'</span><span class="s2">, </span><span class="s4">'Aug'</span><span class="s2">, </span><span class="s4">'Sep'</span><span class="s2">,</span>
              <span class="s4">'Oct'</span><span class="s2">, </span><span class="s4">'Nov'</span><span class="s2">, </span><span class="s4">'Dec'</span><span class="s2">];</span>

<span class="s0">// 26 Feb 16:19:34</span>
<span class="s3">function </span><span class="s1">timestamp</span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">d </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Date</span><span class="s2">();</span>
  <span class="s3">var </span><span class="s1">time </span><span class="s2">= [</span><span class="s1">pad</span><span class="s2">(</span><span class="s1">d</span><span class="s2">.</span><span class="s1">getHours</span><span class="s2">()),</span>
              <span class="s1">pad</span><span class="s2">(</span><span class="s1">d</span><span class="s2">.</span><span class="s1">getMinutes</span><span class="s2">()),</span>
              <span class="s1">pad</span><span class="s2">(</span><span class="s1">d</span><span class="s2">.</span><span class="s1">getSeconds</span><span class="s2">())].</span><span class="s1">join</span><span class="s2">(</span><span class="s4">':'</span><span class="s2">);</span>
  <span class="s3">return </span><span class="s2">[</span><span class="s1">d</span><span class="s2">.</span><span class="s1">getDate</span><span class="s2">(), </span><span class="s1">months</span><span class="s2">[</span><span class="s1">d</span><span class="s2">.</span><span class="s1">getMonth</span><span class="s2">()], </span><span class="s1">time</span><span class="s2">].</span><span class="s1">join</span><span class="s2">(</span><span class="s4">' '</span><span class="s2">);</span>
<span class="s2">}</span>


<span class="s0">// log is just a thin wrapper to console.log that prepends a timestamp</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">log </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s1">console</span><span class="s2">.</span><span class="s1">log</span><span class="s2">(</span><span class="s4">'%s - %s'</span><span class="s2">, </span><span class="s1">timestamp</span><span class="s2">(), </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">format</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">exports</span><span class="s2">, </span><span class="s1">arguments</span><span class="s2">));</span>
<span class="s2">};</span>


<span class="s7">/**</span>
 <span class="s7">* Inherit the prototype methods from one constructor into another.</span>
 <span class="s7">*</span>
 <span class="s7">* The Function.prototype.inherits from lang.js rewritten as a standalone</span>
 <span class="s7">* function (not on Function.prototype). NOTE: If this file is to be loaded</span>
 <span class="s7">* during bootstrapping this function needs to be rewritten using some native</span>
 <span class="s7">* functions as prototype setup using normal JavaScript does not work as</span>
 <span class="s7">* expected during bootstrapping (see mirror.js in r114903).</span>
 <span class="s7">*</span>
 <span class="s7">* </span><span class="s8">@param </span><span class="s7">{function} ctor Constructor function which needs to inherit the</span>
 <span class="s7">*     prototype.</span>
 <span class="s7">* </span><span class="s8">@param </span><span class="s7">{function} superCtor Constructor function to inherit prototype from.</span>
 <span class="s7">*/</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">inherits </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'inherits'</span><span class="s2">);</span>

<span class="s1">exports</span><span class="s2">.</span><span class="s1">_extend </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">origin</span><span class="s2">, </span><span class="s1">add</span><span class="s2">) {</span>
  <span class="s0">// Don't do anything if add isn't an object</span>
  <span class="s3">if </span><span class="s2">(!</span><span class="s1">add </span><span class="s2">|| !</span><span class="s1">isObject</span><span class="s2">(</span><span class="s1">add</span><span class="s2">)) </span><span class="s3">return </span><span class="s1">origin</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">add</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
  <span class="s3">while </span><span class="s2">(</span><span class="s1">i</span><span class="s2">--) {</span>
    <span class="s1">origin</span><span class="s2">[</span><span class="s1">keys</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]] = </span><span class="s1">add</span><span class="s2">[</span><span class="s1">keys</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]];</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">origin</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s3">function </span><span class="s1">hasOwnProperty</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">obj</span><span class="s2">, </span><span class="s1">prop</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s2">}).</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">,</span><span class="s1">require</span><span class="s2">(</span><span class="s4">'_process'</span><span class="s2">),</span><span class="s3">typeof </span><span class="s1">global </span><span class="s2">!== </span><span class="s4">&quot;undefined&quot; </span><span class="s2">? </span><span class="s1">global </span><span class="s2">: </span><span class="s3">typeof </span><span class="s1">self </span><span class="s2">!== </span><span class="s4">&quot;undefined&quot; </span><span class="s2">? </span><span class="s1">self </span><span class="s2">: </span><span class="s3">typeof </span><span class="s1">window </span><span class="s2">!== </span><span class="s4">&quot;undefined&quot; </span><span class="s2">? </span><span class="s1">window </span><span class="s2">: {})</span>
<span class="s2">},{</span><span class="s4">&quot;./support/isBuffer&quot;</span><span class="s2">:</span><span class="s5">10</span><span class="s2">,</span><span class="s4">&quot;_process&quot;</span><span class="s2">:</span><span class="s5">14</span><span class="s2">,</span><span class="s4">&quot;inherits&quot;</span><span class="s2">:</span><span class="s5">9</span><span class="s2">}],</span><span class="s5">12</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>

<span class="s2">},{}],</span><span class="s5">13</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">(</span><span class="s1">process</span><span class="s2">){</span>
<span class="s0">// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,</span>
<span class="s0">// backported and transplited with Babel, with backwards-compat fixes</span>

<span class="s0">// Copyright Joyent, Inc. and other Node contributors.</span>
<span class="s0">//</span>
<span class="s0">// Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="s0">// copy of this software and associated documentation files (the</span>
<span class="s0">// &quot;Software&quot;), to deal in the Software without restriction, including</span>
<span class="s0">// without limitation the rights to use, copy, modify, merge, publish,</span>
<span class="s0">// distribute, sublicense, and/or sell copies of the Software, and to permit</span>
<span class="s0">// persons to whom the Software is furnished to do so, subject to the</span>
<span class="s0">// following conditions:</span>
<span class="s0">//</span>
<span class="s0">// The above copyright notice and this permission notice shall be included</span>
<span class="s0">// in all copies or substantial portions of the Software.</span>
<span class="s0">//</span>
<span class="s0">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="s0">// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="s0">// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN</span>
<span class="s0">// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,</span>
<span class="s0">// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR</span>
<span class="s0">// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE</span>
<span class="s0">// USE OR OTHER DEALINGS IN THE SOFTWARE.</span>

<span class="s0">// resolves . and .. elements in a path array with directory names there</span>
<span class="s0">// must be no slashes, empty elements, or device names (c:\) in the array</span>
<span class="s0">// (so also no leading and trailing slashes - it does not distinguish</span>
<span class="s0">// relative and absolute paths)</span>
<span class="s3">function </span><span class="s1">normalizeArray</span><span class="s2">(</span><span class="s1">parts</span><span class="s2">, </span><span class="s1">allowAboveRoot</span><span class="s2">) {</span>
  <span class="s0">// if the path tries to go above the root, `up` ends up &gt; 0</span>
  <span class="s3">var </span><span class="s1">up </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i</span><span class="s2">--) {</span>
    <span class="s3">var </span><span class="s1">last </span><span class="s2">= </span><span class="s1">parts</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">last </span><span class="s2">=== </span><span class="s4">'.'</span><span class="s2">) {</span>
      <span class="s1">parts</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s5">1</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">last </span><span class="s2">=== </span><span class="s4">'..'</span><span class="s2">) {</span>
      <span class="s1">parts</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s5">1</span><span class="s2">);</span>
      <span class="s1">up</span><span class="s2">++;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">up</span><span class="s2">) {</span>
      <span class="s1">parts</span><span class="s2">.</span><span class="s1">splice</span><span class="s2">(</span><span class="s1">i</span><span class="s2">, </span><span class="s5">1</span><span class="s2">);</span>
      <span class="s1">up</span><span class="s2">--;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s0">// if the path is allowed to go above the root, restore leading ..s</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">allowAboveRoot</span><span class="s2">) {</span>
    <span class="s3">for </span><span class="s2">(; </span><span class="s1">up</span><span class="s2">--; </span><span class="s1">up</span><span class="s2">) {</span>
      <span class="s1">parts</span><span class="s2">.</span><span class="s1">unshift</span><span class="s2">(</span><span class="s4">'..'</span><span class="s2">);</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s1">parts</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">// path.resolve([from ...], to)</span>
<span class="s0">// posix version</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">resolve </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">resolvedPath </span><span class="s2">= </span><span class="s4">''</span><span class="s2">,</span>
      <span class="s1">resolvedAbsolute </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>

  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= -</span><span class="s5">1 </span><span class="s2">&amp;&amp; !</span><span class="s1">resolvedAbsolute</span><span class="s2">; </span><span class="s1">i</span><span class="s2">--) {</span>
    <span class="s3">var </span><span class="s1">path </span><span class="s2">= (</span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">) ? </span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] : </span><span class="s1">process</span><span class="s2">.</span><span class="s1">cwd</span><span class="s2">();</span>

    <span class="s0">// Skip empty and invalid entries</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">path </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Arguments to path.resolve must be strings'</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(!</span><span class="s1">path</span><span class="s2">) {</span>
      <span class="s3">continue</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s1">resolvedPath </span><span class="s2">= </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">'/' </span><span class="s2">+ </span><span class="s1">resolvedPath</span><span class="s2">;</span>
    <span class="s1">resolvedAbsolute </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) === </span><span class="s4">'/'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s0">// At this point the path should be resolved to a full absolute path, but</span>
  <span class="s0">// handle relative paths to be safe (might happen when process.cwd() fails)</span>

  <span class="s0">// Normalize the path</span>
  <span class="s1">resolvedPath </span><span class="s2">= </span><span class="s1">normalizeArray</span><span class="s2">(</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">resolvedPath</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">), </span><span class="s3">function</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">!!</span><span class="s1">p</span><span class="s2">;</span>
  <span class="s2">}), !</span><span class="s1">resolvedAbsolute</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>

  <span class="s3">return </span><span class="s2">((</span><span class="s1">resolvedAbsolute </span><span class="s2">? </span><span class="s4">'/' </span><span class="s2">: </span><span class="s4">''</span><span class="s2">) + </span><span class="s1">resolvedPath</span><span class="s2">) || </span><span class="s4">'.'</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s0">// path.normalize(path)</span>
<span class="s0">// posix version</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">normalize </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">isAbsolute </span><span class="s2">= </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">isAbsolute</span><span class="s2">(</span><span class="s1">path</span><span class="s2">),</span>
      <span class="s1">trailingSlash </span><span class="s2">= </span><span class="s1">substr</span><span class="s2">(</span><span class="s1">path</span><span class="s2">, -</span><span class="s5">1</span><span class="s2">) === </span><span class="s4">'/'</span><span class="s2">;</span>

  <span class="s0">// Normalize the path</span>
  <span class="s1">path </span><span class="s2">= </span><span class="s1">normalizeArray</span><span class="s2">(</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">), </span><span class="s3">function</span><span class="s2">(</span><span class="s1">p</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s2">!!</span><span class="s1">p</span><span class="s2">;</span>
  <span class="s2">}), !</span><span class="s1">isAbsolute</span><span class="s2">).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>

  <span class="s3">if </span><span class="s2">(!</span><span class="s1">path </span><span class="s2">&amp;&amp; !</span><span class="s1">isAbsolute</span><span class="s2">) {</span>
    <span class="s1">path </span><span class="s2">= </span><span class="s4">'.'</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">path </span><span class="s2">&amp;&amp; </span><span class="s1">trailingSlash</span><span class="s2">) {</span>
    <span class="s1">path </span><span class="s2">+= </span><span class="s4">'/'</span><span class="s2">;</span>
  <span class="s2">}</span>

  <span class="s3">return </span><span class="s2">(</span><span class="s1">isAbsolute </span><span class="s2">? </span><span class="s4">'/' </span><span class="s2">: </span><span class="s4">''</span><span class="s2">) + </span><span class="s1">path</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s0">// posix version</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">isAbsolute </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s3">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">) === </span><span class="s4">'/'</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s0">// posix version</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">join </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() {</span>
  <span class="s3">var </span><span class="s1">paths </span><span class="s2">= </span><span class="s1">Array</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
  <span class="s3">return </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">normalize</span><span class="s2">(</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">paths</span><span class="s2">, </span><span class="s3">function</span><span class="s2">(</span><span class="s1">p</span><span class="s2">, </span><span class="s1">index</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">p </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) {</span>
      <span class="s3">throw new </span><span class="s1">TypeError</span><span class="s2">(</span><span class="s4">'Arguments to path.join must be strings'</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">p</span><span class="s2">;</span>
  <span class="s2">}).</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">));</span>
<span class="s2">};</span>


<span class="s0">// path.relative(from, to)</span>
<span class="s0">// posix version</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">relative </span><span class="s2">= </span><span class="s3">function</span><span class="s2">(</span><span class="s1">from</span><span class="s2">, </span><span class="s1">to</span><span class="s2">) {</span>
  <span class="s1">from </span><span class="s2">= </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">from</span><span class="s2">).</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">);</span>
  <span class="s1">to </span><span class="s2">= </span><span class="s1">exports</span><span class="s2">.</span><span class="s1">resolve</span><span class="s2">(</span><span class="s1">to</span><span class="s2">).</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">1</span><span class="s2">);</span>

  <span class="s3">function </span><span class="s1">trim</span><span class="s2">(</span><span class="s1">arr</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">start </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
    <span class="s3">for </span><span class="s2">(; </span><span class="s1">start </span><span class="s2">&lt; </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">start</span><span class="s2">++) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">arr</span><span class="s2">[</span><span class="s1">start</span><span class="s2">] !== </span><span class="s4">''</span><span class="s2">) </span><span class="s3">break</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">var </span><span class="s1">end </span><span class="s2">= </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s3">for </span><span class="s2">(; </span><span class="s1">end </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">end</span><span class="s2">--) {</span>
      <span class="s3">if </span><span class="s2">(</span><span class="s1">arr</span><span class="s2">[</span><span class="s1">end</span><span class="s2">] !== </span><span class="s4">''</span><span class="s2">) </span><span class="s3">break</span><span class="s2">;</span>
    <span class="s2">}</span>

    <span class="s3">if </span><span class="s2">(</span><span class="s1">start </span><span class="s2">&gt; </span><span class="s1">end</span><span class="s2">) </span><span class="s3">return </span><span class="s2">[];</span>
    <span class="s3">return </span><span class="s1">arr</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end </span><span class="s2">- </span><span class="s1">start </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">fromParts </span><span class="s2">= </span><span class="s1">trim</span><span class="s2">(</span><span class="s1">from</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">));</span>
  <span class="s3">var </span><span class="s1">toParts </span><span class="s2">= </span><span class="s1">trim</span><span class="s2">(</span><span class="s1">to</span><span class="s2">.</span><span class="s1">split</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">));</span>

  <span class="s3">var </span><span class="s1">length </span><span class="s2">= </span><span class="s1">Math</span><span class="s2">.</span><span class="s1">min</span><span class="s2">(</span><span class="s1">fromParts</span><span class="s2">.</span><span class="s1">length</span><span class="s2">, </span><span class="s1">toParts</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">samePartsLength </span><span class="s2">= </span><span class="s1">length</span><span class="s2">;</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">fromParts</span><span class="s2">[</span><span class="s1">i</span><span class="s2">] !== </span><span class="s1">toParts</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) {</span>
      <span class="s1">samePartsLength </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
      <span class="s3">break</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">var </span><span class="s1">outputParts </span><span class="s2">= [];</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">samePartsLength</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">fromParts</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
    <span class="s1">outputParts</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s4">'..'</span><span class="s2">);</span>
  <span class="s2">}</span>

  <span class="s1">outputParts </span><span class="s2">= </span><span class="s1">outputParts</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">toParts</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">samePartsLength</span><span class="s2">));</span>

  <span class="s3">return </span><span class="s1">outputParts</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">'/'</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s1">exports</span><span class="s2">.</span><span class="s1">sep </span><span class="s2">= </span><span class="s4">'/'</span><span class="s2">;</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">delimiter </span><span class="s2">= </span><span class="s4">':'</span><span class="s2">;</span>

<span class="s1">exports</span><span class="s2">.</span><span class="s1">dirname </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">path </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s1">path </span><span class="s2">= </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">0</span><span class="s2">) </span><span class="s3">return </span><span class="s4">'.'</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">code </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s5">0</span><span class="s2">);</span>
  <span class="s3">var </span><span class="s1">hasRoot </span><span class="s2">= </span><span class="s1">code </span><span class="s2">=== </span><span class="s5">47 </span><span class="s0">/*/*/</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">end </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">1</span><span class="s2">; --</span><span class="s1">i</span><span class="s2">) {</span>
    <span class="s1">code </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">i</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">47 </span><span class="s0">/*/*/</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">matchedSlash</span><span class="s2">) {</span>
          <span class="s1">end </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
          <span class="s3">break</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
      <span class="s0">// We saw the first non-path separator</span>
      <span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">end </span><span class="s2">=== -</span><span class="s5">1</span><span class="s2">) </span><span class="s3">return </span><span class="s1">hasRoot </span><span class="s2">? </span><span class="s4">'/' </span><span class="s2">: </span><span class="s4">'.'</span><span class="s2">;</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">hasRoot </span><span class="s2">&amp;&amp; </span><span class="s1">end </span><span class="s2">=== </span><span class="s5">1</span><span class="s2">) {</span>
    <span class="s0">// return '//';</span>
    <span class="s0">// Backwards-compat fix:</span>
    <span class="s3">return </span><span class="s4">'/'</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">end</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s3">function </span><span class="s1">basename</span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">path </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s1">path </span><span class="s2">= </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">''</span><span class="s2">;</span>

  <span class="s3">var </span><span class="s1">start </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">end </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">i</span><span class="s2">;</span>

  <span class="s3">for </span><span class="s2">(</span><span class="s1">i </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; --</span><span class="s1">i</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">path</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">i</span><span class="s2">) === </span><span class="s5">47 </span><span class="s0">/*/*/</span><span class="s2">) {</span>
        <span class="s0">// If we reached a path separator that was not part of a set of path</span>
        <span class="s0">// separators at the end of the string, stop now</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">matchedSlash</span><span class="s2">) {</span>
          <span class="s1">start </span><span class="s2">= </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
          <span class="s3">break</span><span class="s2">;</span>
        <span class="s2">}</span>
      <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">end </span><span class="s2">=== -</span><span class="s5">1</span><span class="s2">) {</span>
      <span class="s0">// We saw the first non-path separator, mark this as the end of our</span>
      <span class="s0">// path component</span>
      <span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s1">end </span><span class="s2">= </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">end </span><span class="s2">=== -</span><span class="s5">1</span><span class="s2">) </span><span class="s3">return </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s3">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">end</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s0">// Uses a mixed approach for backwards-compatibility, as ext behavior changed</span>
<span class="s0">// in new Node.js versions, so only basename() above is backported here</span>
<span class="s1">exports</span><span class="s2">.</span><span class="s1">basename </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">, </span><span class="s1">ext</span><span class="s2">) {</span>
  <span class="s3">var </span><span class="s1">f </span><span class="s2">= </span><span class="s1">basename</span><span class="s2">(</span><span class="s1">path</span><span class="s2">);</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s1">ext </span><span class="s2">&amp;&amp; </span><span class="s1">f</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(-</span><span class="s5">1 </span><span class="s2">* </span><span class="s1">ext</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) === </span><span class="s1">ext</span><span class="s2">) {</span>
    <span class="s1">f </span><span class="s2">= </span><span class="s1">f</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s5">0</span><span class="s2">, </span><span class="s1">f</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s1">ext</span><span class="s2">.</span><span class="s1">length</span><span class="s2">);</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">f</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s1">exports</span><span class="s2">.</span><span class="s1">extname </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">path</span><span class="s2">) {</span>
  <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">path </span><span class="s2">!== </span><span class="s4">'string'</span><span class="s2">) </span><span class="s1">path </span><span class="s2">= </span><span class="s1">path </span><span class="s2">+ </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">startDot </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">startPart </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">end </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
  <span class="s3">var </span><span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
  <span class="s0">// Track the state of characters (if any) we see before our first dot and</span>
  <span class="s0">// after any path separator we find</span>
  <span class="s3">var </span><span class="s1">preDotState </span><span class="s2">= </span><span class="s5">0</span><span class="s2">;</span>
  <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&gt;= </span><span class="s5">0</span><span class="s2">; --</span><span class="s1">i</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">code </span><span class="s2">= </span><span class="s1">path</span><span class="s2">.</span><span class="s1">charCodeAt</span><span class="s2">(</span><span class="s1">i</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">47 </span><span class="s0">/*/*/</span><span class="s2">) {</span>
        <span class="s0">// If we reached a path separator that was not part of a set of path</span>
        <span class="s0">// separators at the end of the string, stop now</span>
        <span class="s3">if </span><span class="s2">(!</span><span class="s1">matchedSlash</span><span class="s2">) {</span>
          <span class="s1">startPart </span><span class="s2">= </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
          <span class="s3">break</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">continue</span><span class="s2">;</span>
      <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">end </span><span class="s2">=== -</span><span class="s5">1</span><span class="s2">) {</span>
      <span class="s0">// We saw the first non-path separator, mark this as the end of our</span>
      <span class="s0">// extension</span>
      <span class="s1">matchedSlash </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
      <span class="s1">end </span><span class="s2">= </span><span class="s1">i </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">code </span><span class="s2">=== </span><span class="s5">46 </span><span class="s0">/*.*/</span><span class="s2">) {</span>
        <span class="s0">// If this is our first dot, mark it as the start of our extension</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">startDot </span><span class="s2">=== -</span><span class="s5">1</span><span class="s2">)</span>
          <span class="s1">startDot </span><span class="s2">= </span><span class="s1">i</span><span class="s2">;</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">preDotState </span><span class="s2">!== </span><span class="s5">1</span><span class="s2">)</span>
          <span class="s1">preDotState </span><span class="s2">= </span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">} </span><span class="s3">else if </span><span class="s2">(</span><span class="s1">startDot </span><span class="s2">!== -</span><span class="s5">1</span><span class="s2">) {</span>
      <span class="s0">// We saw a non-dot and non-path separator before our dot, so we should</span>
      <span class="s0">// have a good chance at having a non-empty extension</span>
      <span class="s1">preDotState </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
  <span class="s2">}</span>

  <span class="s3">if </span><span class="s2">(</span><span class="s1">startDot </span><span class="s2">=== -</span><span class="s5">1 </span><span class="s2">|| </span><span class="s1">end </span><span class="s2">=== -</span><span class="s5">1 </span><span class="s2">||</span>
      <span class="s0">// We saw a non-dot character immediately before the dot</span>
      <span class="s1">preDotState </span><span class="s2">=== </span><span class="s5">0 </span><span class="s2">||</span>
      <span class="s0">// The (right-most) trimmed path component is exactly '..'</span>
      <span class="s1">preDotState </span><span class="s2">=== </span><span class="s5">1 </span><span class="s2">&amp;&amp; </span><span class="s1">startDot </span><span class="s2">=== </span><span class="s1">end </span><span class="s2">- </span><span class="s5">1 </span><span class="s2">&amp;&amp; </span><span class="s1">startDot </span><span class="s2">=== </span><span class="s1">startPart </span><span class="s2">+ </span><span class="s5">1</span><span class="s2">) {</span>
    <span class="s3">return </span><span class="s4">''</span><span class="s2">;</span>
  <span class="s2">}</span>
  <span class="s3">return </span><span class="s1">path</span><span class="s2">.</span><span class="s1">slice</span><span class="s2">(</span><span class="s1">startDot</span><span class="s2">, </span><span class="s1">end</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s3">function </span><span class="s1">filter </span><span class="s2">(</span><span class="s1">xs</span><span class="s2">, </span><span class="s1">f</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">xs</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">) </span><span class="s3">return </span><span class="s1">xs</span><span class="s2">.</span><span class="s1">filter</span><span class="s2">(</span><span class="s1">f</span><span class="s2">);</span>
    <span class="s3">var </span><span class="s1">res </span><span class="s2">= [];</span>
    <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">xs</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">f</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">], </span><span class="s1">i</span><span class="s2">, </span><span class="s1">xs</span><span class="s2">)) </span><span class="s1">res</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">xs</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
    <span class="s2">}</span>
    <span class="s3">return </span><span class="s1">res</span><span class="s2">;</span>
<span class="s2">}</span>

<span class="s0">// String.prototype.substr - negative index don't work in IE8</span>
<span class="s3">var </span><span class="s1">substr </span><span class="s2">= </span><span class="s4">'ab'</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(-</span><span class="s5">1</span><span class="s2">) === </span><span class="s4">'b'</span>
    <span class="s2">? </span><span class="s3">function </span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">len</span><span class="s2">) { </span><span class="s3">return </span><span class="s1">str</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">len</span><span class="s2">) }</span>
    <span class="s2">: </span><span class="s3">function </span><span class="s2">(</span><span class="s1">str</span><span class="s2">, </span><span class="s1">start</span><span class="s2">, </span><span class="s1">len</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">start </span><span class="s2">&lt; </span><span class="s5">0</span><span class="s2">) </span><span class="s1">start </span><span class="s2">= </span><span class="s1">str</span><span class="s2">.</span><span class="s1">length </span><span class="s2">+ </span><span class="s1">start</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">str</span><span class="s2">.</span><span class="s1">substr</span><span class="s2">(</span><span class="s1">start</span><span class="s2">, </span><span class="s1">len</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">;</span>

<span class="s2">}).</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">,</span><span class="s1">require</span><span class="s2">(</span><span class="s4">'_process'</span><span class="s2">))</span>
<span class="s2">},{</span><span class="s4">&quot;_process&quot;</span><span class="s2">:</span><span class="s5">14</span><span class="s2">}],</span><span class="s5">14</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s0">// shim for using process in browser</span>
<span class="s3">var </span><span class="s1">process </span><span class="s2">= </span><span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= {};</span>

<span class="s0">// cached from whatever global is present so that test runners that stub it</span>
<span class="s0">// don't break things.  But we need to wrap it in a try catch in case it is</span>
<span class="s0">// wrapped in strict mode code which doesn't define any globals.  It's inside a</span>
<span class="s0">// function because try/catches deoptimize in certain engines.</span>

<span class="s3">var </span><span class="s1">cachedSetTimeout</span><span class="s2">;</span>
<span class="s3">var </span><span class="s1">cachedClearTimeout</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">defaultSetTimout</span><span class="s2">() {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'setTimeout has not been defined'</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s3">function </span><span class="s1">defaultClearTimeout </span><span class="s2">() {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'clearTimeout has not been defined'</span><span class="s2">);</span>
<span class="s2">}</span>
<span class="s2">(</span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">try </span><span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">setTimeout </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">cachedSetTimeout </span><span class="s2">= </span><span class="s1">setTimeout</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">cachedSetTimeout </span><span class="s2">= </span><span class="s1">defaultSetTimout</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s1">cachedSetTimeout </span><span class="s2">= </span><span class="s1">defaultSetTimout</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">try </span><span class="s2">{</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">clearTimeout </span><span class="s2">=== </span><span class="s4">'function'</span><span class="s2">) {</span>
            <span class="s1">cachedClearTimeout </span><span class="s2">= </span><span class="s1">clearTimeout</span><span class="s2">;</span>
        <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
            <span class="s1">cachedClearTimeout </span><span class="s2">= </span><span class="s1">defaultClearTimeout</span><span class="s2">;</span>
        <span class="s2">}</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">) {</span>
        <span class="s1">cachedClearTimeout </span><span class="s2">= </span><span class="s1">defaultClearTimeout</span><span class="s2">;</span>
    <span class="s2">}</span>
<span class="s2">} ())</span>
<span class="s3">function </span><span class="s1">runTimeout</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">cachedSetTimeout </span><span class="s2">=== </span><span class="s1">setTimeout</span><span class="s2">) {</span>
        <span class="s0">//normal enviroments in sane situations</span>
        <span class="s3">return </span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">// if setTimeout wasn't available but was latter defined</span>
    <span class="s3">if </span><span class="s2">((</span><span class="s1">cachedSetTimeout </span><span class="s2">=== </span><span class="s1">defaultSetTimout </span><span class="s2">|| !</span><span class="s1">cachedSetTimeout</span><span class="s2">) &amp;&amp; </span><span class="s1">setTimeout</span><span class="s2">) {</span>
        <span class="s1">cachedSetTimeout </span><span class="s2">= </span><span class="s1">setTimeout</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">setTimeout</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">try </span><span class="s2">{</span>
        <span class="s0">// when when somebody has screwed with setTimeout but no I.E. maddness</span>
        <span class="s3">return </span><span class="s1">cachedSetTimeout</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">){</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s0">// When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally</span>
            <span class="s3">return </span><span class="s1">cachedSetTimeout</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">fun</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch</span><span class="s2">(</span><span class="s1">e</span><span class="s2">){</span>
            <span class="s0">// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error</span>
            <span class="s3">return </span><span class="s1">cachedSetTimeout</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">fun</span><span class="s2">, </span><span class="s5">0</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>


<span class="s2">}</span>
<span class="s3">function </span><span class="s1">runClearTimeout</span><span class="s2">(</span><span class="s1">marker</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">cachedClearTimeout </span><span class="s2">=== </span><span class="s1">clearTimeout</span><span class="s2">) {</span>
        <span class="s0">//normal enviroments in sane situations</span>
        <span class="s3">return </span><span class="s1">clearTimeout</span><span class="s2">(</span><span class="s1">marker</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s0">// if clearTimeout wasn't available but was latter defined</span>
    <span class="s3">if </span><span class="s2">((</span><span class="s1">cachedClearTimeout </span><span class="s2">=== </span><span class="s1">defaultClearTimeout </span><span class="s2">|| !</span><span class="s1">cachedClearTimeout</span><span class="s2">) &amp;&amp; </span><span class="s1">clearTimeout</span><span class="s2">) {</span>
        <span class="s1">cachedClearTimeout </span><span class="s2">= </span><span class="s1">clearTimeout</span><span class="s2">;</span>
        <span class="s3">return </span><span class="s1">clearTimeout</span><span class="s2">(</span><span class="s1">marker</span><span class="s2">);</span>
    <span class="s2">}</span>
    <span class="s3">try </span><span class="s2">{</span>
        <span class="s0">// when when somebody has screwed with setTimeout but no I.E. maddness</span>
        <span class="s3">return </span><span class="s1">cachedClearTimeout</span><span class="s2">(</span><span class="s1">marker</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">){</span>
        <span class="s3">try </span><span class="s2">{</span>
            <span class="s0">// When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally</span>
            <span class="s3">return </span><span class="s1">cachedClearTimeout</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
        <span class="s2">} </span><span class="s3">catch </span><span class="s2">(</span><span class="s1">e</span><span class="s2">){</span>
            <span class="s0">// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.</span>
            <span class="s0">// Some versions of I.E. have different rules for clearTimeout vs setTimeout</span>
            <span class="s3">return </span><span class="s1">cachedClearTimeout</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s3">this</span><span class="s2">, </span><span class="s1">marker</span><span class="s2">);</span>
        <span class="s2">}</span>
    <span class="s2">}</span>



<span class="s2">}</span>
<span class="s3">var </span><span class="s1">queue </span><span class="s2">= [];</span>
<span class="s3">var </span><span class="s1">draining </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
<span class="s3">var </span><span class="s1">currentQueue</span><span class="s2">;</span>
<span class="s3">var </span><span class="s1">queueIndex </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>

<span class="s3">function </span><span class="s1">cleanUpNextTick</span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">draining </span><span class="s2">|| !</span><span class="s1">currentQueue</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s1">draining </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">currentQueue</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s1">queue </span><span class="s2">= </span><span class="s1">currentQueue</span><span class="s2">.</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">queue</span><span class="s2">);</span>
    <span class="s2">} </span><span class="s3">else </span><span class="s2">{</span>
        <span class="s1">queueIndex </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">queue</span><span class="s2">.</span><span class="s1">length</span><span class="s2">) {</span>
        <span class="s1">drainQueue</span><span class="s2">();</span>
    <span class="s2">}</span>
<span class="s2">}</span>

<span class="s3">function </span><span class="s1">drainQueue</span><span class="s2">() {</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">draining</span><span class="s2">) {</span>
        <span class="s3">return</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s3">var </span><span class="s1">timeout </span><span class="s2">= </span><span class="s1">runTimeout</span><span class="s2">(</span><span class="s1">cleanUpNextTick</span><span class="s2">);</span>
    <span class="s1">draining </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>

    <span class="s3">var </span><span class="s1">len </span><span class="s2">= </span><span class="s1">queue</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
    <span class="s3">while</span><span class="s2">(</span><span class="s1">len</span><span class="s2">) {</span>
        <span class="s1">currentQueue </span><span class="s2">= </span><span class="s1">queue</span><span class="s2">;</span>
        <span class="s1">queue </span><span class="s2">= [];</span>
        <span class="s3">while </span><span class="s2">(++</span><span class="s1">queueIndex </span><span class="s2">&lt; </span><span class="s1">len</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">currentQueue</span><span class="s2">) {</span>
                <span class="s1">currentQueue</span><span class="s2">[</span><span class="s1">queueIndex</span><span class="s2">].</span><span class="s1">run</span><span class="s2">();</span>
            <span class="s2">}</span>
        <span class="s2">}</span>
        <span class="s1">queueIndex </span><span class="s2">= -</span><span class="s5">1</span><span class="s2">;</span>
        <span class="s1">len </span><span class="s2">= </span><span class="s1">queue</span><span class="s2">.</span><span class="s1">length</span><span class="s2">;</span>
    <span class="s2">}</span>
    <span class="s1">currentQueue </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>
    <span class="s1">draining </span><span class="s2">= </span><span class="s3">false</span><span class="s2">;</span>
    <span class="s1">runClearTimeout</span><span class="s2">(</span><span class="s1">timeout</span><span class="s2">);</span>
<span class="s2">}</span>

<span class="s1">process</span><span class="s2">.</span><span class="s1">nextTick </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">fun</span><span class="s2">) {</span>
    <span class="s3">var </span><span class="s1">args </span><span class="s2">= </span><span class="s3">new </span><span class="s1">Array</span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">- </span><span class="s5">1</span><span class="s2">);</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length </span><span class="s2">&gt; </span><span class="s5">1</span><span class="s2">) {</span>
        <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">1</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
            <span class="s1">args</span><span class="s2">[</span><span class="s1">i </span><span class="s2">- </span><span class="s5">1</span><span class="s2">] = </span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
        <span class="s2">}</span>
    <span class="s2">}</span>
    <span class="s1">queue</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s3">new </span><span class="s1">Item</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">, </span><span class="s1">args</span><span class="s2">));</span>
    <span class="s3">if </span><span class="s2">(</span><span class="s1">queue</span><span class="s2">.</span><span class="s1">length </span><span class="s2">=== </span><span class="s5">1 </span><span class="s2">&amp;&amp; !</span><span class="s1">draining</span><span class="s2">) {</span>
        <span class="s1">runTimeout</span><span class="s2">(</span><span class="s1">drainQueue</span><span class="s2">);</span>
    <span class="s2">}</span>
<span class="s2">};</span>

<span class="s0">// v8 likes predictible objects</span>
<span class="s3">function </span><span class="s1">Item</span><span class="s2">(</span><span class="s1">fun</span><span class="s2">, </span><span class="s1">array</span><span class="s2">) {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">fun </span><span class="s2">= </span><span class="s1">fun</span><span class="s2">;</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">array </span><span class="s2">= </span><span class="s1">array</span><span class="s2">;</span>
<span class="s2">}</span>
<span class="s1">Item</span><span class="s2">.</span><span class="s1">prototype</span><span class="s2">.</span><span class="s1">run </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() {</span>
    <span class="s3">this</span><span class="s2">.</span><span class="s1">fun</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s3">this</span><span class="s2">.</span><span class="s1">array</span><span class="s2">);</span>
<span class="s2">};</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">title </span><span class="s2">= </span><span class="s4">'browser'</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">browser </span><span class="s2">= </span><span class="s3">true</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">env </span><span class="s2">= {};</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">argv </span><span class="s2">= [];</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">version </span><span class="s2">= </span><span class="s4">''</span><span class="s2">; </span><span class="s0">// empty string to avoid regexp issues</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">versions </span><span class="s2">= {};</span>

<span class="s3">function </span><span class="s1">noop</span><span class="s2">() {}</span>

<span class="s1">process</span><span class="s2">.</span><span class="s1">on </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">addListener </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">once </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">off </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">removeListener </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">removeAllListeners </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">emit </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">prependListener </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">prependOnceListener </span><span class="s2">= </span><span class="s1">noop</span><span class="s2">;</span>

<span class="s1">process</span><span class="s2">.</span><span class="s1">listeners </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) { </span><span class="s3">return </span><span class="s2">[] }</span>

<span class="s1">process</span><span class="s2">.</span><span class="s1">binding </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">name</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'process.binding is not supported'</span><span class="s2">);</span>
<span class="s2">};</span>

<span class="s1">process</span><span class="s2">.</span><span class="s1">cwd </span><span class="s2">= </span><span class="s3">function </span><span class="s2">() { </span><span class="s3">return </span><span class="s4">'/' </span><span class="s2">};</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">chdir </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">dir</span><span class="s2">) {</span>
    <span class="s3">throw new </span><span class="s1">Error</span><span class="s2">(</span><span class="s4">'process.chdir is not supported'</span><span class="s2">);</span>
<span class="s2">};</span>
<span class="s1">process</span><span class="s2">.</span><span class="s1">umask </span><span class="s2">= </span><span class="s3">function</span><span class="s2">() { </span><span class="s3">return </span><span class="s5">0</span><span class="s2">; };</span>

<span class="s2">},{}],</span><span class="s5">15</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s3">var </span><span class="s1">unparse </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'escodegen'</span><span class="s2">).</span><span class="s1">generate</span><span class="s2">;</span>

<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s3">function </span><span class="s2">(</span><span class="s1">ast</span><span class="s2">, </span><span class="s1">vars</span><span class="s2">) {</span>
    <span class="s3">if </span><span class="s2">(!</span><span class="s1">vars</span><span class="s2">) </span><span class="s1">vars </span><span class="s2">= {};</span>
    <span class="s3">var </span><span class="s1">FAIL </span><span class="s2">= {};</span>
    
    <span class="s3">var </span><span class="s1">result </span><span class="s2">= (</span><span class="s3">function </span><span class="s1">walk </span><span class="s2">(</span><span class="s1">node</span><span class="s2">, </span><span class="s1">scopeVars</span><span class="s2">) {</span>
        <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Literal'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'UnaryExpression'</span><span class="s2">){</span>
            <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">argument</span><span class="s2">)</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'+'</span><span class="s2">) </span><span class="s3">return </span><span class="s2">+</span><span class="s1">val</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'-'</span><span class="s2">) </span><span class="s3">return </span><span class="s2">-</span><span class="s1">val</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'~'</span><span class="s2">) </span><span class="s3">return </span><span class="s2">~</span><span class="s1">val</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator </span><span class="s2">=== </span><span class="s4">'!'</span><span class="s2">) </span><span class="s3">return </span><span class="s2">!</span><span class="s1">val</span>
            <span class="s3">return </span><span class="s1">FAIL</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ArrayExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">xs </span><span class="s2">= [];</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">l </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">l</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s3">var </span><span class="s1">x </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">elements</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">x </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
                <span class="s1">xs</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">x</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">xs</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ObjectExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">obj </span><span class="s2">= {};</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">node</span><span class="s2">.</span><span class="s1">properties</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s3">var </span><span class="s1">prop </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">properties</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s3">var </span><span class="s1">value </span><span class="s2">= </span><span class="s1">prop</span><span class="s2">.</span><span class="s1">value </span><span class="s2">=== </span><span class="s3">null</span>
                    <span class="s2">? </span><span class="s1">prop</span><span class="s2">.</span><span class="s1">value</span>
                    <span class="s2">: </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">prop</span><span class="s2">.</span><span class="s1">value</span><span class="s2">)</span>
                <span class="s2">;</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">value </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
                <span class="s1">obj</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">value </span><span class="s2">|| </span><span class="s1">prop</span><span class="s2">.</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">] = </span><span class="s1">value</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">obj</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'BinaryExpression' </span><span class="s2">||</span>
                 <span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'LogicalExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">l </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">left</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">l </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">var </span><span class="s1">r </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">right</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">r </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            
            <span class="s3">var </span><span class="s1">op </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">operator</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'=='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">== </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'==='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">=== </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'!='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">!= </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'!=='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">!== </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'+'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">+ </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'-'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">- </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'*'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">* </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'/'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">/ </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'%'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">% </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&lt;'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&lt; </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&lt;='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&lt;= </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&gt; </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&gt;='</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&gt;= </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'|'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">| </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&amp;'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&amp; </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'^'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">^ </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'&amp;&amp;'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">&amp;&amp; </span><span class="s1">r</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">op </span><span class="s2">=== </span><span class="s4">'||'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">l </span><span class="s2">|| </span><span class="s1">r</span><span class="s2">;</span>
            
            <span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Identifier'</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">({}.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">, </span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">)) {</span>
                <span class="s3">return </span><span class="s1">vars</span><span class="s2">[</span><span class="s1">node</span><span class="s2">.</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">else return </span><span class="s1">FAIL</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ThisExpression'</span><span class="s2">) {</span>
            <span class="s3">if </span><span class="s2">({}.</span><span class="s1">hasOwnProperty</span><span class="s2">.</span><span class="s1">call</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">, </span><span class="s4">'this'</span><span class="s2">)) {</span>
                <span class="s3">return </span><span class="s1">vars</span><span class="s2">[</span><span class="s4">'this'</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">else return </span><span class="s1">FAIL</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'CallExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">callee </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">callee</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">callee </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s3">typeof </span><span class="s1">callee </span><span class="s2">!== </span><span class="s4">'function'</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            
            <span class="s3">var </span><span class="s1">ctx </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">callee</span><span class="s2">.</span><span class="s1">object </span><span class="s2">? </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">callee</span><span class="s2">.</span><span class="s1">object</span><span class="s2">) : </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">ctx </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s1">ctx </span><span class="s2">= </span><span class="s3">null</span><span class="s2">;</span>

            <span class="s3">var </span><span class="s1">args </span><span class="s2">= [];</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">, </span><span class="s1">l </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">l</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s3">var </span><span class="s1">x </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">arguments</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                <span class="s3">if </span><span class="s2">(</span><span class="s1">x </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
                <span class="s1">args</span><span class="s2">.</span><span class="s1">push</span><span class="s2">(</span><span class="s1">x</span><span class="s2">);</span>
            <span class="s2">}</span>
            <span class="s3">return </span><span class="s1">callee</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s1">ctx</span><span class="s2">, </span><span class="s1">args</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'MemberExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">obj </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">object</span><span class="s2">);</span>
            <span class="s0">// do not allow access to methods on Function </span>
            <span class="s3">if</span><span class="s2">((</span><span class="s1">obj </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) || (</span><span class="s3">typeof </span><span class="s1">obj </span><span class="s2">== </span><span class="s4">'function'</span><span class="s2">)){</span>
                <span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">property</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'Identifier'</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">node</span><span class="s2">.</span><span class="s1">property</span><span class="s2">.</span><span class="s1">name</span><span class="s2">];</span>
            <span class="s2">}</span>
            <span class="s3">var </span><span class="s1">prop </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">property</span><span class="s2">);</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">prop </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s1">obj</span><span class="s2">[</span><span class="s1">prop</span><span class="s2">];</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ConditionalExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">test</span><span class="s2">)</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">val </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s1">val </span><span class="s2">? </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">consequent</span><span class="s2">) : </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">alternate</span><span class="s2">)</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ExpressionStatement'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">val </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">expression</span><span class="s2">)</span>
            <span class="s3">if </span><span class="s2">(</span><span class="s1">val </span><span class="s2">=== </span><span class="s1">FAIL</span><span class="s2">) </span><span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s3">return </span><span class="s1">val</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'ReturnStatement'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">argument</span><span class="s2">)</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'FunctionExpression'</span><span class="s2">) {</span>
            
            <span class="s3">var </span><span class="s1">bodies </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">body</span><span class="s2">.</span><span class="s1">body</span><span class="s2">;</span>
            
            <span class="s0">// Create a &quot;scope&quot; for our arguments</span>
            <span class="s3">var </span><span class="s1">oldVars </span><span class="s2">= {};</span>
            <span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">).</span><span class="s1">forEach</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">element</span><span class="s2">){</span>
                <span class="s1">oldVars</span><span class="s2">[</span><span class="s1">element</span><span class="s2">] = </span><span class="s1">vars</span><span class="s2">[</span><span class="s1">element</span><span class="s2">];</span>
            <span class="s2">})</span>

            <span class="s3">for</span><span class="s2">(</span><span class="s3">var </span><span class="s1">i</span><span class="s2">=</span><span class="s5">0</span><span class="s2">; </span><span class="s1">i</span><span class="s2">&lt;</span><span class="s1">node</span><span class="s2">.</span><span class="s1">params</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++){</span>
                <span class="s3">var </span><span class="s1">key </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">params</span><span class="s2">[</span><span class="s1">i</span><span class="s2">];</span>
                <span class="s3">if</span><span class="s2">(</span><span class="s1">key</span><span class="s2">.</span><span class="s1">type </span><span class="s2">== </span><span class="s4">'Identifier'</span><span class="s2">){</span>
                  <span class="s1">vars</span><span class="s2">[</span><span class="s1">key</span><span class="s2">.</span><span class="s1">name</span><span class="s2">] = </span><span class="s3">null</span><span class="s2">;</span>
                <span class="s2">}</span>
                <span class="s3">else return </span><span class="s1">FAIL</span><span class="s2">;</span>
            <span class="s2">}</span>
            <span class="s3">for</span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s3">in </span><span class="s1">bodies</span><span class="s2">){</span>
                <span class="s3">if</span><span class="s2">(</span><span class="s1">walk</span><span class="s2">(</span><span class="s1">bodies</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]) === </span><span class="s1">FAIL</span><span class="s2">){</span>
                    <span class="s3">return </span><span class="s1">FAIL</span><span class="s2">;</span>
                <span class="s2">}</span>
            <span class="s2">}</span>
            <span class="s0">// restore the vars and scope after we walk</span>
            <span class="s1">vars </span><span class="s2">= </span><span class="s1">oldVars</span><span class="s2">;</span>
            
            <span class="s3">var </span><span class="s1">keys </span><span class="s2">= </span><span class="s1">Object</span><span class="s2">.</span><span class="s1">keys</span><span class="s2">(</span><span class="s1">vars</span><span class="s2">);</span>
            <span class="s3">var </span><span class="s1">vals </span><span class="s2">= </span><span class="s1">keys</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s3">function</span><span class="s2">(</span><span class="s1">key</span><span class="s2">) {</span>
                <span class="s3">return </span><span class="s1">vars</span><span class="s2">[</span><span class="s1">key</span><span class="s2">];</span>
            <span class="s2">});</span>
            <span class="s3">return </span><span class="s1">Function</span><span class="s2">(</span><span class="s1">keys</span><span class="s2">.</span><span class="s1">join</span><span class="s2">(</span><span class="s4">', '</span><span class="s2">), </span><span class="s4">'return ' </span><span class="s2">+ </span><span class="s1">unparse</span><span class="s2">(</span><span class="s1">node</span><span class="s2">)).</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, </span><span class="s1">vals</span><span class="s2">);</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'TemplateLiteral'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">str </span><span class="s2">= </span><span class="s4">''</span><span class="s2">;</span>
            <span class="s3">for </span><span class="s2">(</span><span class="s3">var </span><span class="s1">i </span><span class="s2">= </span><span class="s5">0</span><span class="s2">; </span><span class="s1">i </span><span class="s2">&lt; </span><span class="s1">node</span><span class="s2">.</span><span class="s1">expressions</span><span class="s2">.</span><span class="s1">length</span><span class="s2">; </span><span class="s1">i</span><span class="s2">++) {</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">quasis</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
                <span class="s1">str </span><span class="s2">+= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">expressions</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
            <span class="s2">}</span>
            <span class="s1">str </span><span class="s2">+= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">quasis</span><span class="s2">[</span><span class="s1">i</span><span class="s2">]);</span>
            <span class="s3">return </span><span class="s1">str</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'TaggedTemplateExpression'</span><span class="s2">) {</span>
            <span class="s3">var </span><span class="s1">tag </span><span class="s2">= </span><span class="s1">walk</span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">tag</span><span class="s2">);</span>
            <span class="s3">var </span><span class="s1">quasi </span><span class="s2">= </span><span class="s1">node</span><span class="s2">.</span><span class="s1">quasi</span><span class="s2">;</span>
            <span class="s3">var </span><span class="s1">strings </span><span class="s2">= </span><span class="s1">quasi</span><span class="s2">.</span><span class="s1">quasis</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">walk</span><span class="s2">);</span>
            <span class="s3">var </span><span class="s1">values </span><span class="s2">= </span><span class="s1">quasi</span><span class="s2">.</span><span class="s1">expressions</span><span class="s2">.</span><span class="s1">map</span><span class="s2">(</span><span class="s1">walk</span><span class="s2">);</span>
            <span class="s3">return </span><span class="s1">tag</span><span class="s2">.</span><span class="s1">apply</span><span class="s2">(</span><span class="s3">null</span><span class="s2">, [</span><span class="s1">strings</span><span class="s2">].</span><span class="s1">concat</span><span class="s2">(</span><span class="s1">values</span><span class="s2">));</span>
        <span class="s2">}</span>
        <span class="s3">else if </span><span class="s2">(</span><span class="s1">node</span><span class="s2">.</span><span class="s1">type </span><span class="s2">=== </span><span class="s4">'TemplateElement'</span><span class="s2">) {</span>
            <span class="s3">return </span><span class="s1">node</span><span class="s2">.</span><span class="s1">value</span><span class="s2">.</span><span class="s1">cooked</span><span class="s2">;</span>
        <span class="s2">}</span>
        <span class="s3">else return </span><span class="s1">FAIL</span><span class="s2">;</span>
    <span class="s2">})(</span><span class="s1">ast</span><span class="s2">);</span>
    
    <span class="s3">return </span><span class="s1">result </span><span class="s2">=== </span><span class="s1">FAIL </span><span class="s2">? </span><span class="s1">undefined </span><span class="s2">: </span><span class="s1">result</span><span class="s2">;</span>
<span class="s2">};</span>

<span class="s2">},{</span><span class="s4">&quot;escodegen&quot;</span><span class="s2">:</span><span class="s5">12</span><span class="s2">}],</span><span class="s4">&quot;jsonpath&quot;</span><span class="s2">:[</span><span class="s3">function</span><span class="s2">(</span><span class="s1">require</span><span class="s2">,</span><span class="s1">module</span><span class="s2">,</span><span class="s1">exports</span><span class="s2">){</span>
<span class="s1">module</span><span class="s2">.</span><span class="s1">exports </span><span class="s2">= </span><span class="s1">require</span><span class="s2">(</span><span class="s4">'./lib/index'</span><span class="s2">);</span>

<span class="s2">},{</span><span class="s4">&quot;./lib/index&quot;</span><span class="s2">:</span><span class="s5">5</span><span class="s2">}]},{},[</span><span class="s4">&quot;jsonpath&quot;</span><span class="s2">])(</span><span class="s4">&quot;jsonpath&quot;</span><span class="s2">)</span>
<span class="s2">});</span>
</pre>
</body>
</html>