<html>
<head>
<title>linter.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #67a37c; font-style: italic;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #bcbec4;}
.s5 { color: #7a7e85;}
.s6 { color: #cf8e6d;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
linter.js</font>
</center></td></tr></table>
<pre><span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@fileoverview </span><span class="s0">Main Linter Class</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">Gyandeep Singh</span>
 <span class="s0">* </span><span class="s1">@author </span><span class="s0">aladdin-add</span>
 <span class="s0">*/</span>

<span class="s3">&quot;use strict&quot;</span><span class="s4">;</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Requirements</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s6">const</span>
    <span class="s2">path </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;path&quot;</span><span class="s4">),</span>
    <span class="s2">eslintScope </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;eslint-scope&quot;</span><span class="s4">),</span>
    <span class="s2">evk </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;eslint-visitor-keys&quot;</span><span class="s4">),</span>
    <span class="s2">espree </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;espree&quot;</span><span class="s4">),</span>
    <span class="s2">merge </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;lodash.merge&quot;</span><span class="s4">),</span>
    <span class="s2">pkg </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../../package.json&quot;</span><span class="s4">),</span>
    <span class="s2">astUtils </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/ast-utils&quot;</span><span class="s4">),</span>
    <span class="s4">{</span>
        <span class="s2">directivesPattern</span>
    <span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/directives&quot;</span><span class="s4">),</span>
    <span class="s4">{</span>
        <span class="s2">Legacy</span><span class="s4">: {</span>
            <span class="s2">ConfigOps</span><span class="s4">,</span>
            <span class="s2">ConfigValidator</span><span class="s4">,</span>
            <span class="s2">environments</span><span class="s4">: </span><span class="s2">BuiltInEnvironments</span>
        <span class="s4">}</span>
    <span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;@eslint/eslintrc/universal&quot;</span><span class="s4">),</span>
    <span class="s2">Traverser </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/traverser&quot;</span><span class="s4">),</span>
    <span class="s4">{ </span><span class="s2">SourceCode </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../source-code&quot;</span><span class="s4">),</span>
    <span class="s2">CodePathAnalyzer </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./code-path-analysis/code-path-analyzer&quot;</span><span class="s4">),</span>
    <span class="s2">applyDisableDirectives </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./apply-disable-directives&quot;</span><span class="s4">),</span>
    <span class="s2">ConfigCommentParser </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./config-comment-parser&quot;</span><span class="s4">),</span>
    <span class="s2">NodeEventGenerator </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./node-event-generator&quot;</span><span class="s4">),</span>
    <span class="s2">createReportTranslator </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./report-translator&quot;</span><span class="s4">),</span>
    <span class="s2">Rules </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./rules&quot;</span><span class="s4">),</span>
    <span class="s2">createEmitter </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./safe-emitter&quot;</span><span class="s4">),</span>
    <span class="s2">SourceCodeFixer </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./source-code-fixer&quot;</span><span class="s4">),</span>
    <span class="s2">timing </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;./timing&quot;</span><span class="s4">),</span>
    <span class="s2">ruleReplacements </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../../conf/replacements.json&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">getRuleFromConfig </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-helpers&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">FlatConfigArray </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-array&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">RuleValidator </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/rule-validator&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">assertIsRuleOptions</span><span class="s4">, </span><span class="s2">assertIsRuleSeverity </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../config/flat-config-schema&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s4">{ </span><span class="s2">normalizeSeverityToString </span><span class="s4">} = </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;../shared/severity&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">debug </span><span class="s4">= </span><span class="s2">require</span><span class="s4">(</span><span class="s3">&quot;debug&quot;</span><span class="s4">)(</span><span class="s3">&quot;eslint:linter&quot;</span><span class="s4">);</span>
<span class="s6">const </span><span class="s2">MAX_AUTOFIX_PASSES </span><span class="s4">= </span><span class="s7">10</span><span class="s4">;</span>
<span class="s6">const </span><span class="s2">DEFAULT_PARSER_NAME </span><span class="s4">= </span><span class="s3">&quot;espree&quot;</span><span class="s4">;</span>
<span class="s6">const </span><span class="s2">DEFAULT_ECMA_VERSION </span><span class="s4">= </span><span class="s7">5</span><span class="s4">;</span>
<span class="s6">const </span><span class="s2">commentParser </span><span class="s4">= </span><span class="s6">new </span><span class="s2">ConfigCommentParser</span><span class="s4">();</span>
<span class="s6">const </span><span class="s2">DEFAULT_ERROR_LOC </span><span class="s4">= { </span><span class="s2">start</span><span class="s4">: { </span><span class="s2">line</span><span class="s4">: </span><span class="s7">1</span><span class="s4">, </span><span class="s2">column</span><span class="s4">: </span><span class="s7">0 </span><span class="s4">}, </span><span class="s2">end</span><span class="s4">: { </span><span class="s2">line</span><span class="s4">: </span><span class="s7">1</span><span class="s4">, </span><span class="s2">column</span><span class="s4">: </span><span class="s7">1 </span><span class="s4">} };</span>
<span class="s6">const </span><span class="s2">parserSymbol </span><span class="s4">= </span><span class="s2">Symbol</span><span class="s4">.</span><span class="s2">for</span><span class="s4">(</span><span class="s3">&quot;eslint.RuleTester.parser&quot;</span><span class="s4">);</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Typedefs</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{InstanceType&lt;import(&quot;../cli-engine/config-array&quot;).ConfigArray&gt;} ConfigArray */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{InstanceType&lt;import(&quot;../cli-engine/config-array&quot;).ExtractedConfig&gt;} ExtractedConfig */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).ConfigData} ConfigData */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Environment} Environment */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).GlobalConf} GlobalConf */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).LintMessage} LintMessage */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).SuppressedLintMessage} SuppressedLintMessage */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).ParserOptions} ParserOptions */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).LanguageOptions} LanguageOptions */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Processor} Processor */</span>
<span class="s0">/** </span><span class="s1">@typedef </span><span class="s0">{import(&quot;../shared/types&quot;).Rule} Rule */</span>

<span class="s5">/* eslint-disable jsdoc/valid-types -- https://github.com/jsdoc-type-pratt-parser/jsdoc-type-pratt-parser/issues/4#issuecomment-778805577 */</span>
<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@template </span><span class="s0">T</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{{ [P in keyof T]-?: T[P] }} Required</span>
 <span class="s0">*/</span>
<span class="s5">/* eslint-enable jsdoc/valid-types -- https://github.com/jsdoc-type-pratt-parser/jsdoc-type-pratt-parser/issues/4#issuecomment-778805577 */</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} DisableDirective</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{(&quot;disable&quot;|&quot;enable&quot;|&quot;disable-line&quot;|&quot;disable-next-line&quot;)} type Type of directive</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} line The line number</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{number} column The column number</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{(string|null)} ruleId The rule ID</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} justification The justification of directive</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* The private data for `Linter` instance.</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} LinterInternalSlots</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{ConfigArray|null} lastConfigArray The `ConfigArray` instance that the last `verify()` call used.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{SourceCode|null} lastSourceCode The `SourceCode` instance that the last `verify()` call used.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{SuppressedLintMessage[]} lastSuppressedMessages The `SuppressedLintMessage[]` instance that the last `verify()` call produced.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Map&lt;string, Parser&gt;} parserMap The loaded parsers.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Rules} ruleMap The loaded rules.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} VerifyOptions</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [allowInlineConfig] Allow/disallow inline comments' ability</span>
 <span class="s0">*      to change config once it is set. Defaults to true if not supplied.</span>
 <span class="s0">*      Useful if you want to validate JS without comments overriding rules.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean} [disableFixes] if `true` then the linter doesn't make `fix`</span>
 <span class="s0">*      properties into the lint result.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string} [filename] the filename of the source code.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean | &quot;off&quot; | &quot;warn&quot; | &quot;error&quot;} [reportUnusedDisableDirectives] Adds reported errors for</span>
 <span class="s0">*      unused `eslint-disable` directives.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} ProcessorOptions</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{(filename:string, text:string) =&gt; boolean} [filterCodeBlock] the</span>
 <span class="s0">*      predicate function that selects adopt code blocks.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Processor.postprocess} [postprocess] postprocessor for report</span>
 <span class="s0">*      messages. If provided, this should accept an array of the message lists</span>
 <span class="s0">*      for each code block returned from the preprocessor, apply a mapping to</span>
 <span class="s0">*      the messages as appropriate, and return a one-dimensional array of</span>
 <span class="s0">*      messages.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{Processor.preprocess} [preprocess] preprocessor for source text.</span>
 <span class="s0">*      If provided, this should accept a string of source text, and return an</span>
 <span class="s0">*      array of code blocks to lint.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} FixOptions</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{boolean | ((message: LintMessage) =&gt; boolean)} [fix] Determines</span>
 <span class="s0">*      whether fixes should be applied.</span>
 <span class="s0">*/</span>

<span class="s0">/**</span>
 <span class="s0">* </span><span class="s1">@typedef </span><span class="s0">{Object} InternalOptions</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{string | null} warnInlineConfig The config name what `noInlineConfig` setting came from. If `noInlineConfig` setting didn't exist, this is null. If this is a config name, then the linter warns directive comments.</span>
 <span class="s0">* </span><span class="s1">@property </span><span class="s0">{&quot;off&quot; | &quot;warn&quot; | &quot;error&quot;} reportUnusedDisableDirectives (boolean values were normalized)</span>
 <span class="s0">*/</span>

<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Helpers</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Determines if a given object is Espree.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} parser The parser to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{boolean} True if the parser is Espree or false if not.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">isEspree</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s4">!!(</span><span class="s2">parser </span><span class="s4">=== </span><span class="s2">espree </span><span class="s4">|| </span><span class="s2">parser</span><span class="s4">[</span><span class="s2">parserSymbol</span><span class="s4">] === </span><span class="s2">espree</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Ensures that variables representing built-in properties of the Global Object,</span>
 <span class="s0">* and any globals declared by special block comments, are present in the global</span>
 <span class="s0">* scope.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Scope} globalScope The global scope.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} configGlobals The globals declared in configuration</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{{exportedVariables: Object, enabledGlobals: Object}} commentDirectives Directives from comment configuration</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">addDeclaredGlobals</span><span class="s4">(</span><span class="s2">globalScope</span><span class="s4">, </span><span class="s2">configGlobals</span><span class="s4">, { </span><span class="s2">exportedVariables</span><span class="s4">, </span><span class="s2">enabledGlobals </span><span class="s4">}) {</span>

    <span class="s5">// Define configured global variables.</span>
    <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">id of </span><span class="s6">new </span><span class="s2">Set</span><span class="s4">([</span><span class="s2">...Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">configGlobals</span><span class="s4">), </span><span class="s2">...Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">enabledGlobals</span><span class="s4">)])) {</span>

        <span class="s5">/* 
         * `ConfigOps.normalizeConfigGlobal` will throw an error if a configured global value is invalid. However, these errors would 
         * typically be caught when validating a config anyway (validity for inline global comments is checked separately). 
         */</span>
        <span class="s6">const </span><span class="s2">configValue </span><span class="s4">= </span><span class="s2">configGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] === </span><span class="s6">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s6">void </span><span class="s7">0 </span><span class="s4">: </span><span class="s2">ConfigOps</span><span class="s4">.</span><span class="s2">normalizeConfigGlobal</span><span class="s4">(</span><span class="s2">configGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">]);</span>
        <span class="s6">const </span><span class="s2">commentValue </span><span class="s4">= </span><span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] &amp;&amp; </span><span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">].</span><span class="s2">value</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">value </span><span class="s4">= </span><span class="s2">commentValue </span><span class="s4">|| </span><span class="s2">configValue</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">sourceComments </span><span class="s4">= </span><span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] &amp;&amp; </span><span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">].</span><span class="s2">comments</span><span class="s4">;</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">value </span><span class="s4">=== </span><span class="s3">&quot;off&quot;</span><span class="s4">) {</span>
            <span class="s6">continue</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">let </span><span class="s2">variable </span><span class="s4">= </span><span class="s2">globalScope</span><span class="s4">.</span><span class="s2">set</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">id</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">variable</span><span class="s4">) {</span>
            <span class="s2">variable </span><span class="s4">= </span><span class="s6">new </span><span class="s2">eslintScope</span><span class="s4">.</span><span class="s2">Variable</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, </span><span class="s2">globalScope</span><span class="s4">);</span>

            <span class="s2">globalScope</span><span class="s4">.</span><span class="s2">variables</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">variable</span><span class="s4">);</span>
            <span class="s2">globalScope</span><span class="s4">.</span><span class="s2">set</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">id</span><span class="s4">, </span><span class="s2">variable</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s2">variable</span><span class="s4">.</span><span class="s2">eslintImplicitGlobalSetting </span><span class="s4">= </span><span class="s2">configValue</span><span class="s4">;</span>
        <span class="s2">variable</span><span class="s4">.</span><span class="s2">eslintExplicitGlobal </span><span class="s4">= </span><span class="s2">sourceComments </span><span class="s4">!== </span><span class="s6">void </span><span class="s7">0</span><span class="s4">;</span>
        <span class="s2">variable</span><span class="s4">.</span><span class="s2">eslintExplicitGlobalComments </span><span class="s4">= </span><span class="s2">sourceComments</span><span class="s4">;</span>
        <span class="s2">variable</span><span class="s4">.</span><span class="s2">writeable </span><span class="s4">= (</span><span class="s2">value </span><span class="s4">=== </span><span class="s3">&quot;writable&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s5">// mark all exported variables as such</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">exportedVariables</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">name </span><span class="s4">=&gt; {</span>
        <span class="s6">const </span><span class="s2">variable </span><span class="s4">= </span><span class="s2">globalScope</span><span class="s4">.</span><span class="s2">set</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">variable</span><span class="s4">) {</span>
            <span class="s2">variable</span><span class="s4">.</span><span class="s2">eslintUsed </span><span class="s4">= </span><span class="s6">true</span><span class="s4">;</span>
            <span class="s2">variable</span><span class="s4">.</span><span class="s2">eslintExported </span><span class="s4">= </span><span class="s6">true</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">});</span>

    <span class="s5">/* 
     * &quot;through&quot; contains all references which definitions cannot be found. 
     * Since we augment the global scope using configuration, we need to update 
     * references and remove the ones that were added by configuration. 
     */</span>
    <span class="s2">globalScope</span><span class="s4">.</span><span class="s2">through </span><span class="s4">= </span><span class="s2">globalScope</span><span class="s4">.</span><span class="s2">through</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">reference </span><span class="s4">=&gt; {</span>
        <span class="s6">const </span><span class="s2">name </span><span class="s4">= </span><span class="s2">reference</span><span class="s4">.</span><span class="s2">identifier</span><span class="s4">.</span><span class="s2">name</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">variable </span><span class="s4">= </span><span class="s2">globalScope</span><span class="s4">.</span><span class="s2">set</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">variable</span><span class="s4">) {</span>

            <span class="s5">/* 
             * Links the variable and the reference. 
             * And this reference is removed from `Scope#through`. 
             */</span>
            <span class="s2">reference</span><span class="s4">.</span><span class="s2">resolved </span><span class="s4">= </span><span class="s2">variable</span><span class="s4">;</span>
            <span class="s2">variable</span><span class="s4">.</span><span class="s2">references</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">reference</span><span class="s4">);</span>

            <span class="s6">return false</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">return true</span><span class="s4">;</span>
    <span class="s4">});</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* creates a missing-rule message.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} ruleId the ruleId to create</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} created error message</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createMissingRuleMessage</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">prototype</span><span class="s4">.</span><span class="s2">hasOwnProperty</span><span class="s4">.</span><span class="s2">call</span><span class="s4">(</span><span class="s2">ruleReplacements</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">, </span><span class="s2">ruleId</span><span class="s4">)</span>
        <span class="s4">? </span><span class="s3">`Rule '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">' was removed and replaced by: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleReplacements</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">].</span><span class="s2">join</span><span class="s4">(</span><span class="s3">&quot;, &quot;</span><span class="s4">)}</span><span class="s3">`</span>
        <span class="s4">: </span><span class="s3">`Definition for rule '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">' was not found.`</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* creates a linting problem</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options to create linting error</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [options.ruleId] the ruleId to report</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [options.loc] the loc to report</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [options.message] the error message to report</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [options.severity] the error message to report</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintMessage} created problem, returns a missing-rule problem if only provided ruleId.</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createLintingProblem</span><span class="s4">(</span><span class="s2">options</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s4">{</span>
        <span class="s2">ruleId </span><span class="s4">= </span><span class="s6">null</span><span class="s4">,</span>
        <span class="s2">loc </span><span class="s4">= </span><span class="s2">DEFAULT_ERROR_LOC</span><span class="s4">,</span>
        <span class="s2">message </span><span class="s4">= </span><span class="s2">createMissingRuleMessage</span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">),</span>
        <span class="s2">severity </span><span class="s4">= </span><span class="s7">2</span>
    <span class="s4">} = </span><span class="s2">options</span><span class="s4">;</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">ruleId</span><span class="s4">,</span>
        <span class="s2">message</span><span class="s4">,</span>
        <span class="s2">line</span><span class="s4">: </span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">line</span><span class="s4">,</span>
        <span class="s2">column</span><span class="s4">: </span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">column </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">,</span>
        <span class="s2">endLine</span><span class="s4">: </span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">line</span><span class="s4">,</span>
        <span class="s2">endColumn</span><span class="s4">: </span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">column </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">,</span>
        <span class="s2">severity</span><span class="s4">,</span>
        <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Creates a collection of disable directives from a comment</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} options to create disable directives</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{(&quot;disable&quot;|&quot;enable&quot;|&quot;disable-line&quot;|&quot;disable-next-line&quot;)} options.type The type of directive comment</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{token} options.commentToken The Comment token</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.value The value after the directive in the comment</span>
 <span class="s0">* comment specified no specific rules, so it applies to all rules (e.g. `eslint-disable`)</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} options.justification The justification of the directive</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{function(string): {create: Function}} options.ruleMapper A map from rule IDs to defined rules</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} Directives and problems from the comment</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createDisableDirectives</span><span class="s4">(</span><span class="s2">options</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s4">{ </span><span class="s2">commentToken</span><span class="s4">, </span><span class="s2">type</span><span class="s4">, </span><span class="s2">value</span><span class="s4">, </span><span class="s2">justification</span><span class="s4">, </span><span class="s2">ruleMapper </span><span class="s4">} = </span><span class="s2">options</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">ruleIds </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">parseListConfig</span><span class="s4">(</span><span class="s2">value</span><span class="s4">));</span>
    <span class="s6">const </span><span class="s2">directiveRules </span><span class="s4">= </span><span class="s2">ruleIds</span><span class="s4">.</span><span class="s2">length </span><span class="s4">? </span><span class="s2">ruleIds </span><span class="s4">: [</span><span class="s6">null</span><span class="s4">];</span>
    <span class="s6">const </span><span class="s2">result </span><span class="s4">= {</span>
        <span class="s2">directives</span><span class="s4">: [], </span><span class="s5">// valid disable directives</span>
        <span class="s2">directiveProblems</span><span class="s4">: [] </span><span class="s5">// problems in directives</span>
    <span class="s4">};</span>

    <span class="s6">const </span><span class="s2">parentComment </span><span class="s4">= { </span><span class="s2">commentToken</span><span class="s4">, </span><span class="s2">ruleIds </span><span class="s4">};</span>

    <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">ruleId of directiveRules</span><span class="s4">) {</span>

        <span class="s5">// push to directives, if the rule is defined(including null, e.g. /*eslint enable*/)</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">ruleId </span><span class="s4">=== </span><span class="s6">null </span><span class="s4">|| !!</span><span class="s2">ruleMapper</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">)) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">type </span><span class="s4">=== </span><span class="s3">&quot;disable-next-line&quot;</span><span class="s4">) {</span>
                <span class="s2">result</span><span class="s4">.</span><span class="s2">directives</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                    <span class="s2">parentComment</span><span class="s4">,</span>
                    <span class="s2">type</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s2">commentToken</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">line</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s2">commentToken</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">column </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">,</span>
                    <span class="s2">ruleId</span><span class="s4">,</span>
                    <span class="s2">justification</span>
                <span class="s4">});</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">result</span><span class="s4">.</span><span class="s2">directives</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({</span>
                    <span class="s2">parentComment</span><span class="s4">,</span>
                    <span class="s2">type</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s2">commentToken</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">line</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s2">commentToken</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">column </span><span class="s4">+ </span><span class="s7">1</span><span class="s4">,</span>
                    <span class="s2">ruleId</span><span class="s4">,</span>
                    <span class="s2">justification</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">result</span><span class="s4">.</span><span class="s2">directiveProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({ </span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">loc</span><span class="s4">: </span><span class="s2">commentToken</span><span class="s4">.</span><span class="s2">loc </span><span class="s4">}));</span>
        <span class="s4">}</span>
    <span class="s4">}</span>
    <span class="s6">return </span><span class="s2">result</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Parses comments in file to extract file-specific config of rules, globals</span>
 <span class="s0">* and environments and merges them with global config; also code blocks</span>
 <span class="s0">* where reporting is disabled or enabled and merges them with reporting config.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{SourceCode} sourceCode The SourceCode object to get comments from.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{function(string): {create: Function}} ruleMapper A map from rule IDs to defined rules</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|null} warnInlineConfig If a string then it should warn directive comments as disabled. The string value is the config name what the setting came from.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{{configuredRules: Object, enabledGlobals: {value:string,comment:Token}[], exportedVariables: Object, problems: LintMessage[], disableDirectives: DisableDirective[]}}</span>
 <span class="s0">* A collection of the directive comments that were found, along with any problems that occurred when parsing</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getDirectiveComments</span><span class="s4">(</span><span class="s2">sourceCode</span><span class="s4">, </span><span class="s2">ruleMapper</span><span class="s4">, </span><span class="s2">warnInlineConfig</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">configuredRules </span><span class="s4">= {};</span>
    <span class="s6">const </span><span class="s2">enabledGlobals </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s6">null</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s2">exportedVariables </span><span class="s4">= {};</span>
    <span class="s6">const </span><span class="s2">problems </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">disableDirectives </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">validator </span><span class="s4">= </span><span class="s6">new </span><span class="s2">ConfigValidator</span><span class="s4">({</span>
        <span class="s2">builtInRules</span><span class="s4">: </span><span class="s2">Rules</span>
    <span class="s4">});</span>

    <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getInlineConfigNodes</span><span class="s4">().</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">token </span><span class="s4">=&gt; </span><span class="s2">token</span><span class="s4">.</span><span class="s2">type </span><span class="s4">!== </span><span class="s3">&quot;Shebang&quot;</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">comment </span><span class="s4">=&gt; {</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">directivePart</span><span class="s4">, </span><span class="s2">justificationPart </span><span class="s4">} = </span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">extractDirectiveComment</span><span class="s4">(</span><span class="s2">comment</span><span class="s4">.</span><span class="s2">value</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">match </span><span class="s4">= </span><span class="s2">directivesPattern</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">directivePart</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) {</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s6">const </span><span class="s2">directiveText </span><span class="s4">= </span><span class="s2">match</span><span class="s4">[</span><span class="s7">1</span><span class="s4">];</span>
        <span class="s6">const </span><span class="s2">lineCommentSupported </span><span class="s4">= </span><span class="s8">/^eslint-disable-(next-)?line$/u</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">directiveText</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">comment</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s3">&quot;Line&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">lineCommentSupported</span><span class="s4">) {</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">warnInlineConfig</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">kind </span><span class="s4">= </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s3">&quot;Block&quot; </span><span class="s4">? </span><span class="s3">`/*</span><span class="s2">$</span><span class="s4">{</span><span class="s2">directiveText</span><span class="s4">}</span><span class="s3">*/` </span><span class="s4">: </span><span class="s3">`//</span><span class="s2">$</span><span class="s4">{</span><span class="s2">directiveText</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>

            <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                <span class="s2">message</span><span class="s4">: </span><span class="s3">`'</span><span class="s2">$</span><span class="s4">{</span><span class="s2">kind</span><span class="s4">}</span><span class="s3">' has no effect because you have 'noInlineConfig' setting in </span><span class="s2">$</span><span class="s4">{</span><span class="s2">warnInlineConfig</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">,</span>
                <span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">,</span>
                <span class="s2">severity</span><span class="s4">: </span><span class="s7">1</span>
            <span class="s4">}));</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">directiveText </span><span class="s4">=== </span><span class="s3">&quot;eslint-disable-line&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">line </span><span class="s4">!== </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">line</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">directiveText</span><span class="s4">} </span><span class="s3">comment should not span multiple lines.`</span><span class="s4">;</span>

            <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                <span class="s2">message</span><span class="s4">,</span>
                <span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span>
            <span class="s4">}));</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">directiveValue </span><span class="s4">= </span><span class="s2">directivePart</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">index </span><span class="s4">+ </span><span class="s2">directiveText</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>

        <span class="s6">switch </span><span class="s4">(</span><span class="s2">directiveText</span><span class="s4">) {</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-enable&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable-next-line&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable-line&quot;</span><span class="s4">: {</span>
                <span class="s6">const </span><span class="s2">directiveType </span><span class="s4">= </span><span class="s2">directiveText</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s3">&quot;eslint-&quot;</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>
                <span class="s6">const </span><span class="s2">options </span><span class="s4">= { </span><span class="s2">commentToken</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">, </span><span class="s2">type</span><span class="s4">: </span><span class="s2">directiveType</span><span class="s4">, </span><span class="s2">value</span><span class="s4">: </span><span class="s2">directiveValue</span><span class="s4">, </span><span class="s2">justification</span><span class="s4">: </span><span class="s2">justificationPart</span><span class="s4">, </span><span class="s2">ruleMapper </span><span class="s4">};</span>
                <span class="s6">const </span><span class="s4">{ </span><span class="s2">directives</span><span class="s4">, </span><span class="s2">directiveProblems </span><span class="s4">} = </span><span class="s2">createDisableDirectives</span><span class="s4">(</span><span class="s2">options</span><span class="s4">);</span>

                <span class="s2">disableDirectives</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...directives</span><span class="s4">);</span>
                <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...directiveProblems</span><span class="s4">);</span>
                <span class="s6">break</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">case </span><span class="s3">&quot;exported&quot;</span><span class="s4">:</span>
                <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">exportedVariables</span><span class="s4">, </span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">parseStringConfig</span><span class="s4">(</span><span class="s2">directiveValue</span><span class="s4">, </span><span class="s2">comment</span><span class="s4">));</span>
                <span class="s6">break</span><span class="s4">;</span>

            <span class="s6">case </span><span class="s3">&quot;globals&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;global&quot;</span><span class="s4">:</span>
                <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s4">[</span><span class="s2">id</span><span class="s4">, { </span><span class="s2">value </span><span class="s4">}] </span><span class="s2">of Object</span><span class="s4">.</span><span class="s2">entries</span><span class="s4">(</span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">parseStringConfig</span><span class="s4">(</span><span class="s2">directiveValue</span><span class="s4">, </span><span class="s2">comment</span><span class="s4">))) {</span>
                    <span class="s6">let </span><span class="s2">normalizedValue</span><span class="s4">;</span>

                    <span class="s6">try </span><span class="s4">{</span>
                        <span class="s2">normalizedValue </span><span class="s4">= </span><span class="s2">ConfigOps</span><span class="s4">.</span><span class="s2">normalizeConfigGlobal</span><span class="s4">(</span><span class="s2">value</span><span class="s4">);</span>
                    <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
                        <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                            <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                            <span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">,</span>
                            <span class="s2">message</span><span class="s4">: </span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span>
                        <span class="s4">}));</span>
                        <span class="s6">continue</span><span class="s4">;</span>
                    <span class="s4">}</span>

                    <span class="s6">if </span><span class="s4">(</span><span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">]) {</span>
                        <span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">].</span><span class="s2">comments</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">comment</span><span class="s4">);</span>
                        <span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">].</span><span class="s2">value </span><span class="s4">= </span><span class="s2">normalizedValue</span><span class="s4">;</span>
                    <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                        <span class="s2">enabledGlobals</span><span class="s4">[</span><span class="s2">id</span><span class="s4">] = {</span>
                            <span class="s2">comments</span><span class="s4">: [</span><span class="s2">comment</span><span class="s4">],</span>
                            <span class="s2">value</span><span class="s4">: </span><span class="s2">normalizedValue</span>
                        <span class="s4">};</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>
                <span class="s6">break</span><span class="s4">;</span>

            <span class="s6">case </span><span class="s3">&quot;eslint&quot;</span><span class="s4">: {</span>
                <span class="s6">const </span><span class="s2">parseResult </span><span class="s4">= </span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">parseJsonConfig</span><span class="s4">(</span><span class="s2">directiveValue</span><span class="s4">, </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">);</span>

                <span class="s6">if </span><span class="s4">(</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">success</span><span class="s4">) {</span>
                    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">config</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">name </span><span class="s4">=&gt; {</span>
                        <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">ruleMapper</span><span class="s4">(</span><span class="s2">name</span><span class="s4">);</span>
                        <span class="s6">const </span><span class="s2">ruleValue </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">config</span><span class="s4">[</span><span class="s2">name</span><span class="s4">];</span>

                        <span class="s6">if </span><span class="s4">(!</span><span class="s2">rule</span><span class="s4">) {</span>
                            <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({ </span><span class="s2">ruleId</span><span class="s4">: </span><span class="s2">name</span><span class="s4">, </span><span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc </span><span class="s4">}));</span>
                            <span class="s6">return</span><span class="s4">;</span>
                        <span class="s4">}</span>

                        <span class="s6">try </span><span class="s4">{</span>
                            <span class="s2">validator</span><span class="s4">.</span><span class="s2">validateRuleOptions</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">, </span><span class="s2">name</span><span class="s4">, </span><span class="s2">ruleValue</span><span class="s4">);</span>
                        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
                            <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                                <span class="s2">ruleId</span><span class="s4">: </span><span class="s2">name</span><span class="s4">,</span>
                                <span class="s2">message</span><span class="s4">: </span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">,</span>
                                <span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span>
                            <span class="s4">}));</span>

                            <span class="s5">// do not apply the config, if found invalid options.</span>
                            <span class="s6">return</span><span class="s4">;</span>
                        <span class="s4">}</span>

                        <span class="s2">configuredRules</span><span class="s4">[</span><span class="s2">name</span><span class="s4">] = </span><span class="s2">ruleValue</span><span class="s4">;</span>
                    <span class="s4">});</span>
                <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                    <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">);</span>
                <span class="s4">}</span>

                <span class="s6">break</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s5">// no default</span>
        <span class="s4">}</span>
    <span class="s4">});</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">configuredRules</span><span class="s4">,</span>
        <span class="s2">enabledGlobals</span><span class="s4">,</span>
        <span class="s2">exportedVariables</span><span class="s4">,</span>
        <span class="s2">problems</span><span class="s4">,</span>
        <span class="s2">disableDirectives</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Parses comments in file to extract disable directives.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{SourceCode} sourceCode The SourceCode object to get comments from.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{function(string): {create: Function}} ruleMapper A map from rule IDs to defined rules</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{{problems: LintMessage[], disableDirectives: DisableDirective[]}}</span>
 <span class="s0">* A collection of the directive comments that were found, along with any problems that occurred when parsing</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getDirectiveCommentsForFlatConfig</span><span class="s4">(</span><span class="s2">sourceCode</span><span class="s4">, </span><span class="s2">ruleMapper</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">problems </span><span class="s4">= [];</span>
    <span class="s6">const </span><span class="s2">disableDirectives </span><span class="s4">= [];</span>

    <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getInlineConfigNodes</span><span class="s4">().</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">token </span><span class="s4">=&gt; </span><span class="s2">token</span><span class="s4">.</span><span class="s2">type </span><span class="s4">!== </span><span class="s3">&quot;Shebang&quot;</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">comment </span><span class="s4">=&gt; {</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">directivePart</span><span class="s4">, </span><span class="s2">justificationPart </span><span class="s4">} = </span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">extractDirectiveComment</span><span class="s4">(</span><span class="s2">comment</span><span class="s4">.</span><span class="s2">value</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">match </span><span class="s4">= </span><span class="s2">directivesPattern</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">directivePart</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">match</span><span class="s4">) {</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>
        <span class="s6">const </span><span class="s2">directiveText </span><span class="s4">= </span><span class="s2">match</span><span class="s4">[</span><span class="s7">1</span><span class="s4">];</span>
        <span class="s6">const </span><span class="s2">lineCommentSupported </span><span class="s4">= </span><span class="s8">/^eslint-disable-(next-)?line$/u</span><span class="s4">.</span><span class="s2">test</span><span class="s4">(</span><span class="s2">directiveText</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">comment</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s3">&quot;Line&quot; </span><span class="s4">&amp;&amp; !</span><span class="s2">lineCommentSupported</span><span class="s4">) {</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">directiveText </span><span class="s4">=== </span><span class="s3">&quot;eslint-disable-line&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">.</span><span class="s2">line </span><span class="s4">!== </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">end</span><span class="s4">.</span><span class="s2">line</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">directiveText</span><span class="s4">} </span><span class="s3">comment should not span multiple lines.`</span><span class="s4">;</span>

            <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                <span class="s2">message</span><span class="s4">,</span>
                <span class="s2">loc</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">.</span><span class="s2">loc</span>
            <span class="s4">}));</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">directiveValue </span><span class="s4">= </span><span class="s2">directivePart</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">match</span><span class="s4">.</span><span class="s2">index </span><span class="s4">+ </span><span class="s2">directiveText</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>

        <span class="s6">switch </span><span class="s4">(</span><span class="s2">directiveText</span><span class="s4">) {</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-enable&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable-next-line&quot;</span><span class="s4">:</span>
            <span class="s6">case </span><span class="s3">&quot;eslint-disable-line&quot;</span><span class="s4">: {</span>
                <span class="s6">const </span><span class="s2">directiveType </span><span class="s4">= </span><span class="s2">directiveText</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s3">&quot;eslint-&quot;</span><span class="s4">.</span><span class="s2">length</span><span class="s4">);</span>
                <span class="s6">const </span><span class="s2">options </span><span class="s4">= { </span><span class="s2">commentToken</span><span class="s4">: </span><span class="s2">comment</span><span class="s4">, </span><span class="s2">type</span><span class="s4">: </span><span class="s2">directiveType</span><span class="s4">, </span><span class="s2">value</span><span class="s4">: </span><span class="s2">directiveValue</span><span class="s4">, </span><span class="s2">justification</span><span class="s4">: </span><span class="s2">justificationPart</span><span class="s4">, </span><span class="s2">ruleMapper </span><span class="s4">};</span>
                <span class="s6">const </span><span class="s4">{ </span><span class="s2">directives</span><span class="s4">, </span><span class="s2">directiveProblems </span><span class="s4">} = </span><span class="s2">createDisableDirectives</span><span class="s4">(</span><span class="s2">options</span><span class="s4">);</span>

                <span class="s2">disableDirectives</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...directives</span><span class="s4">);</span>
                <span class="s2">problems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">...directiveProblems</span><span class="s4">);</span>
                <span class="s6">break</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s5">// no default</span>
        <span class="s4">}</span>
    <span class="s4">});</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">problems</span><span class="s4">,</span>
        <span class="s2">disableDirectives</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Normalize ECMAScript version from the initial config</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Parser} parser The parser which uses this options.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{number} ecmaVersion ECMAScript version from the initial config</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{number} normalized ECMAScript version</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeEcmaVersion</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">, </span><span class="s2">ecmaVersion</span><span class="s4">) {</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">isEspree</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">)) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">ecmaVersion </span><span class="s4">=== </span><span class="s3">&quot;latest&quot;</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s2">espree</span><span class="s4">.</span><span class="s2">latestEcmaVersion</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/* 
     * Calculate ECMAScript edition number from official year version starting with 
     * ES2015, which corresponds with ES6 (or a difference of 2009). 
     */</span>
    <span class="s6">return </span><span class="s2">ecmaVersion </span><span class="s4">&gt;= </span><span class="s7">2015 </span><span class="s4">? </span><span class="s2">ecmaVersion </span><span class="s4">- </span><span class="s7">2009 </span><span class="s4">: </span><span class="s2">ecmaVersion</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Normalize ECMAScript version from the initial config into languageOptions (year)</span>
 <span class="s0">* format.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{any} [ecmaVersion] ECMAScript version from the initial config</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{number} normalized ECMAScript version</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeEcmaVersionForLanguageOptions</span><span class="s4">(</span><span class="s2">ecmaVersion</span><span class="s4">) {</span>

    <span class="s6">switch </span><span class="s4">(</span><span class="s2">ecmaVersion</span><span class="s4">) {</span>
        <span class="s6">case </span><span class="s7">3</span><span class="s4">:</span>
            <span class="s6">return </span><span class="s7">3</span><span class="s4">;</span>

        <span class="s5">// void 0 = no ecmaVersion specified so use the default</span>
        <span class="s6">case </span><span class="s7">5</span><span class="s4">:</span>
        <span class="s6">case void </span><span class="s7">0</span><span class="s4">:</span>
            <span class="s6">return </span><span class="s7">5</span><span class="s4">;</span>

        <span class="s6">default</span><span class="s4">:</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">ecmaVersion </span><span class="s4">=== </span><span class="s3">&quot;number&quot;</span><span class="s4">) {</span>
                <span class="s6">return </span><span class="s2">ecmaVersion </span><span class="s4">&gt;= </span><span class="s7">2015 </span><span class="s4">? </span><span class="s2">ecmaVersion </span><span class="s4">: </span><span class="s2">ecmaVersion </span><span class="s4">+ </span><span class="s7">2009</span><span class="s4">;</span>
            <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s5">/* 
     * We default to the latest supported ecmaVersion for everything else. 
     * Remember, this is for languageOptions.ecmaVersion, which sets the version 
     * that is used for a number of processes inside of ESLint. It's normally 
     * safe to assume people want the latest unless otherwise specified. 
     */</span>
    <span class="s6">return </span><span class="s2">espree</span><span class="s4">.</span><span class="s2">latestEcmaVersion </span><span class="s4">+ </span><span class="s7">2009</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s6">const </span><span class="s2">eslintEnvPattern </span><span class="s4">= </span><span class="s8">/\/\*\s*eslint-env\s(.+?)(?:\*\/|$)/gsu</span><span class="s4">;</span>

<span class="s0">/**</span>
 <span class="s0">* Checks whether or not there is a comment which has &quot;eslint-env *&quot; in a given text.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text A source code text to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object|null} A result of parseListConfig() with &quot;eslint-env *&quot; comment.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">findEslintEnv</span><span class="s4">(</span><span class="s2">text</span><span class="s4">) {</span>
    <span class="s6">let </span><span class="s2">match</span><span class="s4">, </span><span class="s2">retv</span><span class="s4">;</span>

    <span class="s2">eslintEnvPattern</span><span class="s4">.</span><span class="s2">lastIndex </span><span class="s4">= </span><span class="s7">0</span><span class="s4">;</span>

    <span class="s6">while </span><span class="s4">((</span><span class="s2">match </span><span class="s4">= </span><span class="s2">eslintEnvPattern</span><span class="s4">.</span><span class="s2">exec</span><span class="s4">(</span><span class="s2">text</span><span class="s4">)) !== </span><span class="s6">null</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">match</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s3">&quot;*/&quot;</span><span class="s4">)) {</span>
            <span class="s2">retv </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span>
                <span class="s2">retv </span><span class="s4">|| {},</span>
                <span class="s2">commentParser</span><span class="s4">.</span><span class="s2">parseListConfig</span><span class="s4">(</span><span class="s2">commentParser</span><span class="s4">.</span><span class="s2">extractDirectiveComment</span><span class="s4">(</span><span class="s2">match</span><span class="s4">[</span><span class="s7">1</span><span class="s4">]).</span><span class="s2">directivePart</span><span class="s4">)</span>
            <span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">retv</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Convert &quot;/path/to/&lt;text&gt;&quot; to &quot;&lt;text&gt;&quot;.</span>
 <span class="s0">* `CLIEngine#executeOnText()` method gives &quot;/path/to/&lt;text&gt;&quot; if the filename</span>
 <span class="s0">* was omitted because `configArray.extractConfig()` requires an absolute path.</span>
 <span class="s0">* But the linter should pass `&lt;text&gt;` to `RuleContext#filename` in that</span>
 <span class="s0">* case.</span>
 <span class="s0">* Also, code blocks can have their virtual filename. If the parent filename was</span>
 <span class="s0">* `&lt;text&gt;`, the virtual filename is `&lt;text&gt;/0_foo.js` or something like (i.e.,</span>
 <span class="s0">* it's not an absolute path).</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filename The filename to normalize.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The normalized filename.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeFilename</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">parts </span><span class="s4">= </span><span class="s2">filename</span><span class="s4">.</span><span class="s2">split</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">sep</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s2">index </span><span class="s4">= </span><span class="s2">parts</span><span class="s4">.</span><span class="s2">lastIndexOf</span><span class="s4">(</span><span class="s3">&quot;&lt;text&gt;&quot;</span><span class="s4">);</span>

    <span class="s6">return </span><span class="s2">index </span><span class="s4">=== -</span><span class="s7">1 </span><span class="s4">? </span><span class="s2">filename </span><span class="s4">: </span><span class="s2">parts</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">index</span><span class="s4">).</span><span class="s2">join</span><span class="s4">(</span><span class="s2">path</span><span class="s4">.</span><span class="s2">sep</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Normalizes the possible options for `linter.verify` and `linter.verifyAndFix` to a</span>
 <span class="s0">* consistent shape.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions} providedOptions Options</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData} config Config.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Required&lt;VerifyOptions&gt; &amp; InternalOptions} Normalized options</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeVerifyOptions</span><span class="s4">(</span><span class="s2">providedOptions</span><span class="s4">, </span><span class="s2">config</span><span class="s4">) {</span>

    <span class="s6">const </span><span class="s2">linterOptions </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">linterOptions </span><span class="s4">|| </span><span class="s2">config</span><span class="s4">;</span>

    <span class="s5">// .noInlineConfig for eslintrc, .linterOptions.noInlineConfig for flat</span>
    <span class="s6">const </span><span class="s2">disableInlineConfig </span><span class="s4">= </span><span class="s2">linterOptions</span><span class="s4">.</span><span class="s2">noInlineConfig </span><span class="s4">=== </span><span class="s6">true</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">ignoreInlineConfig </span><span class="s4">= </span><span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">allowInlineConfig </span><span class="s4">=== </span><span class="s6">false</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">configNameOfNoInlineConfig </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">configNameOfNoInlineConfig</span>
        <span class="s4">? </span><span class="s3">` (</span><span class="s2">$</span><span class="s4">{</span><span class="s2">config</span><span class="s4">.</span><span class="s2">configNameOfNoInlineConfig</span><span class="s4">}</span><span class="s3">)`</span>
        <span class="s4">: </span><span class="s3">&quot;&quot;</span><span class="s4">;</span>

    <span class="s6">let </span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">= </span><span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives</span><span class="s4">;</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">=== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
        <span class="s2">reportUnusedDisableDirectives </span><span class="s4">= </span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">? </span><span class="s3">&quot;error&quot; </span><span class="s4">: </span><span class="s3">&quot;off&quot;</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">!== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">linterOptions</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">=== </span><span class="s3">&quot;boolean&quot;</span><span class="s4">) {</span>
            <span class="s2">reportUnusedDisableDirectives </span><span class="s4">= </span><span class="s2">linterOptions</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">? </span><span class="s3">&quot;warn&quot; </span><span class="s4">: </span><span class="s3">&quot;off&quot;</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">reportUnusedDisableDirectives </span><span class="s4">= </span><span class="s2">linterOptions</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives </span><span class="s4">=== </span><span class="s6">void </span><span class="s7">0 </span><span class="s4">? </span><span class="s3">&quot;off&quot; </span><span class="s4">: </span><span class="s2">normalizeSeverityToString</span><span class="s4">(</span><span class="s2">linterOptions</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives</span><span class="s4">);</span>
        <span class="s4">}</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">filename</span><span class="s4">: </span><span class="s2">normalizeFilename</span><span class="s4">(</span><span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;&lt;input&gt;&quot;</span><span class="s4">),</span>
        <span class="s2">allowInlineConfig</span><span class="s4">: !</span><span class="s2">ignoreInlineConfig</span><span class="s4">,</span>
        <span class="s2">warnInlineConfig</span><span class="s4">: </span><span class="s2">disableInlineConfig </span><span class="s4">&amp;&amp; !</span><span class="s2">ignoreInlineConfig</span>
            <span class="s4">? </span><span class="s3">`your config</span><span class="s2">$</span><span class="s4">{</span><span class="s2">configNameOfNoInlineConfig</span><span class="s4">}</span><span class="s3">`</span>
            <span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
        <span class="s2">reportUnusedDisableDirectives</span><span class="s4">,</span>
        <span class="s2">disableFixes</span><span class="s4">: </span><span class="s2">Boolean</span><span class="s4">(</span><span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">disableFixes</span><span class="s4">)</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Combines the provided parserOptions with the options from environments</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Parser} parser The parser which uses this options.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ParserOptions} providedOptions The provided 'parserOptions' key in a config</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Environment[]} enabledEnvironments The environments enabled in configuration and with inline comments</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{ParserOptions} Resulting parser options after merge</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">resolveParserOptions</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">, </span><span class="s2">providedOptions</span><span class="s4">, </span><span class="s2">enabledEnvironments</span><span class="s4">) {</span>

    <span class="s6">const </span><span class="s2">parserOptionsFromEnv </span><span class="s4">= </span><span class="s2">enabledEnvironments</span>
        <span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">env </span><span class="s4">=&gt; </span><span class="s2">env</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">)</span>
        <span class="s4">.</span><span class="s2">reduce</span><span class="s4">((</span><span class="s2">parserOptions</span><span class="s4">, </span><span class="s2">env</span><span class="s4">) =&gt; </span><span class="s2">merge</span><span class="s4">(</span><span class="s2">parserOptions</span><span class="s4">, </span><span class="s2">env</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">), {});</span>
    <span class="s6">const </span><span class="s2">mergedParserOptions </span><span class="s4">= </span><span class="s2">merge</span><span class="s4">(</span><span class="s2">parserOptionsFromEnv</span><span class="s4">, </span><span class="s2">providedOptions </span><span class="s4">|| {});</span>
    <span class="s6">const </span><span class="s2">isModule </span><span class="s4">= </span><span class="s2">mergedParserOptions</span><span class="s4">.</span><span class="s2">sourceType </span><span class="s4">=== </span><span class="s3">&quot;module&quot;</span><span class="s4">;</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">isModule</span><span class="s4">) {</span>

        <span class="s5">/* 
         * can't have global return inside of modules 
         * TODO: espree validate parserOptions.globalReturn when sourceType is setting to module.(@aladdin-add) 
         */</span>
        <span class="s2">mergedParserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">mergedParserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures</span><span class="s4">, { </span><span class="s2">globalReturn</span><span class="s4">: </span><span class="s6">false </span><span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s2">mergedParserOptions</span><span class="s4">.</span><span class="s2">ecmaVersion </span><span class="s4">= </span><span class="s2">normalizeEcmaVersion</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">, </span><span class="s2">mergedParserOptions</span><span class="s4">.</span><span class="s2">ecmaVersion</span><span class="s4">);</span>

    <span class="s6">return </span><span class="s2">mergedParserOptions</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Converts parserOptions to languageOptions for backwards compatibility with eslintrc.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData} config Config object.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} config.globals Global variable definitions.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Parser} config.parser The parser to use.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ParserOptions} config.parserOptions The parserOptions to use.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LanguageOptions} The languageOptions equivalent.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createLanguageOptions</span><span class="s4">({ </span><span class="s2">globals</span><span class="s4">: </span><span class="s2">configuredGlobals</span><span class="s4">, </span><span class="s2">parser</span><span class="s4">, </span><span class="s2">parserOptions </span><span class="s4">}) {</span>

    <span class="s6">const </span><span class="s4">{</span>
        <span class="s2">ecmaVersion</span><span class="s4">,</span>
        <span class="s2">sourceType</span>
    <span class="s4">} = </span><span class="s2">parserOptions</span><span class="s4">;</span>

    <span class="s6">return </span><span class="s4">{</span>
        <span class="s2">globals</span><span class="s4">: </span><span class="s2">configuredGlobals</span><span class="s4">,</span>
        <span class="s2">ecmaVersion</span><span class="s4">: </span><span class="s2">normalizeEcmaVersionForLanguageOptions</span><span class="s4">(</span><span class="s2">ecmaVersion</span><span class="s4">),</span>
        <span class="s2">sourceType</span><span class="s4">,</span>
        <span class="s2">parser</span><span class="s4">,</span>
        <span class="s2">parserOptions</span>
    <span class="s4">};</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Combines the provided globals object with the globals from environments</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Record&lt;string, GlobalConf&gt;} providedGlobals The 'globals' key in a config</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Environment[]} enabledEnvironments The environments enabled in configuration and with inline comments</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Record&lt;string, GlobalConf&gt;} The resolved globals object</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">resolveGlobals</span><span class="s4">(</span><span class="s2">providedGlobals</span><span class="s4">, </span><span class="s2">enabledEnvironments</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s6">null</span><span class="s4">),</span>
        <span class="s2">...enabledEnvironments</span><span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">env </span><span class="s4">=&gt; </span><span class="s2">env</span><span class="s4">.</span><span class="s2">globals</span><span class="s4">).</span><span class="s2">map</span><span class="s4">(</span><span class="s2">env </span><span class="s4">=&gt; </span><span class="s2">env</span><span class="s4">.</span><span class="s2">globals</span><span class="s4">),</span>
        <span class="s2">providedGlobals</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Strips Unicode BOM from a given text.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text A text to strip.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The stripped text.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">stripUnicodeBOM</span><span class="s4">(</span><span class="s2">text</span><span class="s4">) {</span>

    <span class="s5">/* 
     * Check Unicode BOM. 
     * In JavaScript, string data is stored as UTF-16, so BOM is 0xFEFF. 
     * http://www.ecma-international.org/ecma-262/6.0/#sec-unicode-format-control-characters 
     */</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">text</span><span class="s4">.</span><span class="s2">charCodeAt</span><span class="s4">(</span><span class="s7">0</span><span class="s4">) === </span><span class="s7">0xFEFF</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">text</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">return </span><span class="s2">text</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Get the options for a rule (not including severity), if any</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array|number} ruleConfig rule configuration</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Array} of rule options, empty Array if none</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getRuleOptions</span><span class="s4">(</span><span class="s2">ruleConfig</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">ruleConfig</span><span class="s4">)) {</span>
        <span class="s6">return </span><span class="s2">ruleConfig</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">1</span><span class="s4">);</span>
    <span class="s4">}</span>
    <span class="s6">return </span><span class="s4">[];</span>

<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Analyze scope of the given AST.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ASTNode} ast The `Program` node to analyze.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LanguageOptions} languageOptions The parser options.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Record&lt;string, string[]&gt;} visitorKeys The visitor keys.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{ScopeManager} The analysis result.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">analyzeScope</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">, </span><span class="s2">visitorKeys</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">parserOptions </span><span class="s4">= </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">ecmaFeatures </span><span class="s4">= </span><span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures </span><span class="s4">|| {};</span>
    <span class="s6">const </span><span class="s2">ecmaVersion </span><span class="s4">= </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">ecmaVersion </span><span class="s4">|| </span><span class="s2">DEFAULT_ECMA_VERSION</span><span class="s4">;</span>

    <span class="s6">return </span><span class="s2">eslintScope</span><span class="s4">.</span><span class="s2">analyze</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">, {</span>
        <span class="s2">ignoreEval</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
        <span class="s2">nodejsScope</span><span class="s4">: </span><span class="s2">ecmaFeatures</span><span class="s4">.</span><span class="s2">globalReturn</span><span class="s4">,</span>
        <span class="s2">impliedStrict</span><span class="s4">: </span><span class="s2">ecmaFeatures</span><span class="s4">.</span><span class="s2">impliedStrict</span><span class="s4">,</span>
        <span class="s2">ecmaVersion</span><span class="s4">: </span><span class="s6">typeof </span><span class="s2">ecmaVersion </span><span class="s4">=== </span><span class="s3">&quot;number&quot; </span><span class="s4">? </span><span class="s2">ecmaVersion </span><span class="s4">: </span><span class="s7">6</span><span class="s4">,</span>
        <span class="s2">sourceType</span><span class="s4">: </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">sourceType </span><span class="s4">|| </span><span class="s3">&quot;script&quot;</span><span class="s4">,</span>
        <span class="s2">childVisitorKeys</span><span class="s4">: </span><span class="s2">visitorKeys </span><span class="s4">|| </span><span class="s2">evk</span><span class="s4">.</span><span class="s2">KEYS</span><span class="s4">,</span>
        <span class="s2">fallback</span><span class="s4">: </span><span class="s2">Traverser</span><span class="s4">.</span><span class="s2">getKeys</span>
    <span class="s4">});</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Parses text into an AST. Moved out here because the try-catch prevents</span>
 <span class="s0">* optimization of functions, so it's best to keep the try-catch as isolated</span>
 <span class="s0">* as possible</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text The text to parse.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LanguageOptions} languageOptions Options to pass to the parser</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filePath The path to the file being parsed.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{{success: false, error: LintMessage}|{success: true, sourceCode: SourceCode}}</span>
 <span class="s0">* An object containing the AST and parser services if parsing was successful, or the error if parsing failed</span>
 <span class="s0">* </span><span class="s1">@private</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">parse</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">textToParse </span><span class="s4">= </span><span class="s2">stripUnicodeBOM</span><span class="s4">(</span><span class="s2">text</span><span class="s4">).</span><span class="s2">replace</span><span class="s4">(</span><span class="s2">astUtils</span><span class="s4">.</span><span class="s2">shebangPattern</span><span class="s4">, (</span><span class="s2">match</span><span class="s4">, </span><span class="s2">captured</span><span class="s4">) =&gt; </span><span class="s3">`//</span><span class="s2">$</span><span class="s4">{</span><span class="s2">captured</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
    <span class="s6">const </span><span class="s4">{ </span><span class="s2">ecmaVersion</span><span class="s4">, </span><span class="s2">sourceType</span><span class="s4">, </span><span class="s2">parser </span><span class="s4">} = </span><span class="s2">languageOptions</span><span class="s4">;</span>
    <span class="s6">const </span><span class="s2">parserOptions </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span>
        <span class="s4">{ </span><span class="s2">ecmaVersion</span><span class="s4">, </span><span class="s2">sourceType </span><span class="s4">},</span>
        <span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">,</span>
        <span class="s4">{</span>
            <span class="s2">loc</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">range</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">raw</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">tokens</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">comment</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">eslintVisitorKeys</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">eslintScopeManager</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
            <span class="s2">filePath</span>
        <span class="s4">}</span>
    <span class="s4">);</span>

    <span class="s5">/* 
     * Check for parsing errors first. If there's a parsing error, nothing 
     * else can happen. However, a parsing error does not throw an error 
     * from this method - it's just considered a fatal error message, a 
     * problem that ESLint identified just like any other. 
     */</span>
    <span class="s6">try </span><span class="s4">{</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Parsing:&quot;</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">parseResult </span><span class="s4">= (</span><span class="s6">typeof </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parseForESLint </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">)</span>
            <span class="s4">? </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parseForESLint</span><span class="s4">(</span><span class="s2">textToParse</span><span class="s4">, </span><span class="s2">parserOptions</span><span class="s4">)</span>
            <span class="s4">: { </span><span class="s2">ast</span><span class="s4">: </span><span class="s2">parser</span><span class="s4">.</span><span class="s2">parse</span><span class="s4">(</span><span class="s2">textToParse</span><span class="s4">, </span><span class="s2">parserOptions</span><span class="s4">) };</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Parsing successful:&quot;</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">ast </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">parserServices </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">services </span><span class="s4">|| {};</span>
        <span class="s6">const </span><span class="s2">visitorKeys </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">visitorKeys </span><span class="s4">|| </span><span class="s2">evk</span><span class="s4">.</span><span class="s2">KEYS</span><span class="s4">;</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Scope analysis:&quot;</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">scopeManager </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">scopeManager </span><span class="s4">|| </span><span class="s2">analyzeScope</span><span class="s4">(</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">, </span><span class="s2">visitorKeys</span><span class="s4">);</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Scope analysis successful:&quot;</span><span class="s4">, </span><span class="s2">filePath</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s4">{</span>
            <span class="s2">success</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>

            <span class="s5">/* 
             * Save all values that `parseForESLint()` returned. 
             * If a `SourceCode` object is given as the first parameter instead of source code text, 
             * linter skips the parsing process and reuses the source code object. 
             * In that case, linter needs all the values that `parseForESLint()` returned. 
             */</span>
            <span class="s2">sourceCode</span><span class="s4">: </span><span class="s6">new </span><span class="s2">SourceCode</span><span class="s4">({</span>
                <span class="s2">text</span><span class="s4">,</span>
                <span class="s2">ast</span><span class="s4">,</span>
                <span class="s2">parserServices</span><span class="s4">,</span>
                <span class="s2">scopeManager</span><span class="s4">,</span>
                <span class="s2">visitorKeys</span>
            <span class="s4">})</span>
        <span class="s4">};</span>
    <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">ex</span><span class="s4">) {</span>

        <span class="s5">// If the message includes a leading line number, strip it:</span>
        <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s3">`Parsing error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ex</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^line \d+:/iu</span><span class="s4">, </span><span class="s3">&quot;&quot;</span><span class="s4">).</span><span class="s2">trim</span><span class="s4">()}</span><span class="s3">`</span><span class="s4">;</span>

        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;%s</span><span class="s6">\n</span><span class="s3">%s&quot;</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">);</span>

        <span class="s6">return </span><span class="s4">{</span>
            <span class="s2">success</span><span class="s4">: </span><span class="s6">false</span><span class="s4">,</span>
            <span class="s2">error</span><span class="s4">: {</span>
                <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                <span class="s2">fatal</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
                <span class="s2">severity</span><span class="s4">: </span><span class="s7">2</span><span class="s4">,</span>
                <span class="s2">message</span><span class="s4">,</span>
                <span class="s2">line</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">lineNumber</span><span class="s4">,</span>
                <span class="s2">column</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">column</span><span class="s4">,</span>
                <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
            <span class="s4">}</span>
        <span class="s4">};</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Runs a rule, and gets its listeners</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Rule} rule A normalized rule with a `create` method</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Context} ruleContext The context that should be passed to the rule</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{any} Any error during the rule's `create`</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Object} A map of selector listeners provided by the rule</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">createRuleListeners</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">, </span><span class="s2">ruleContext</span><span class="s4">) {</span>
    <span class="s6">try </span><span class="s4">{</span>
        <span class="s6">return </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s2">ruleContext</span><span class="s4">);</span>
    <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">ex</span><span class="s4">) {</span>
        <span class="s2">ex</span><span class="s4">.</span><span class="s2">message </span><span class="s4">= </span><span class="s3">`Error while loading rule '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleContext</span><span class="s4">.</span><span class="s2">id</span><span class="s4">}</span><span class="s3">': </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ex</span><span class="s4">.</span><span class="s2">message</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
        <span class="s6">throw </span><span class="s2">ex</span><span class="s4">;</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s5">// methods that exist on SourceCode object</span>
<span class="s6">const </span><span class="s2">DEPRECATED_SOURCECODE_PASSTHROUGHS </span><span class="s4">= {</span>
    <span class="s2">getSource</span><span class="s4">: </span><span class="s3">&quot;getText&quot;</span><span class="s4">,</span>
    <span class="s2">getSourceLines</span><span class="s4">: </span><span class="s3">&quot;getLines&quot;</span><span class="s4">,</span>
    <span class="s2">getAllComments</span><span class="s4">: </span><span class="s3">&quot;getAllComments&quot;</span><span class="s4">,</span>
    <span class="s2">getNodeByRangeIndex</span><span class="s4">: </span><span class="s3">&quot;getNodeByRangeIndex&quot;</span><span class="s4">,</span>
    <span class="s2">getComments</span><span class="s4">: </span><span class="s3">&quot;getComments&quot;</span><span class="s4">,</span>
    <span class="s2">getCommentsBefore</span><span class="s4">: </span><span class="s3">&quot;getCommentsBefore&quot;</span><span class="s4">,</span>
    <span class="s2">getCommentsAfter</span><span class="s4">: </span><span class="s3">&quot;getCommentsAfter&quot;</span><span class="s4">,</span>
    <span class="s2">getCommentsInside</span><span class="s4">: </span><span class="s3">&quot;getCommentsInside&quot;</span><span class="s4">,</span>
    <span class="s2">getJSDocComment</span><span class="s4">: </span><span class="s3">&quot;getJSDocComment&quot;</span><span class="s4">,</span>
    <span class="s2">getFirstToken</span><span class="s4">: </span><span class="s3">&quot;getFirstToken&quot;</span><span class="s4">,</span>
    <span class="s2">getFirstTokens</span><span class="s4">: </span><span class="s3">&quot;getFirstTokens&quot;</span><span class="s4">,</span>
    <span class="s2">getLastToken</span><span class="s4">: </span><span class="s3">&quot;getLastToken&quot;</span><span class="s4">,</span>
    <span class="s2">getLastTokens</span><span class="s4">: </span><span class="s3">&quot;getLastTokens&quot;</span><span class="s4">,</span>
    <span class="s2">getTokenAfter</span><span class="s4">: </span><span class="s3">&quot;getTokenAfter&quot;</span><span class="s4">,</span>
    <span class="s2">getTokenBefore</span><span class="s4">: </span><span class="s3">&quot;getTokenBefore&quot;</span><span class="s4">,</span>
    <span class="s2">getTokenByRangeStart</span><span class="s4">: </span><span class="s3">&quot;getTokenByRangeStart&quot;</span><span class="s4">,</span>
    <span class="s2">getTokens</span><span class="s4">: </span><span class="s3">&quot;getTokens&quot;</span><span class="s4">,</span>
    <span class="s2">getTokensAfter</span><span class="s4">: </span><span class="s3">&quot;getTokensAfter&quot;</span><span class="s4">,</span>
    <span class="s2">getTokensBefore</span><span class="s4">: </span><span class="s3">&quot;getTokensBefore&quot;</span><span class="s4">,</span>
    <span class="s2">getTokensBetween</span><span class="s4">: </span><span class="s3">&quot;getTokensBetween&quot;</span>
<span class="s4">};</span>


<span class="s6">const </span><span class="s2">BASE_TRAVERSAL_CONTEXT </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">(</span>
    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">DEPRECATED_SOURCECODE_PASSTHROUGHS</span><span class="s4">).</span><span class="s2">reduce</span><span class="s4">(</span>
        <span class="s4">(</span><span class="s2">contextInfo</span><span class="s4">, </span><span class="s2">methodName</span><span class="s4">) =&gt;</span>
            <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span><span class="s2">contextInfo</span><span class="s4">, {</span>
                <span class="s4">[</span><span class="s2">methodName</span><span class="s4">](</span><span class="s2">...args</span><span class="s4">) {</span>
                    <span class="s6">return this</span><span class="s4">.</span><span class="s2">sourceCode</span><span class="s4">[</span><span class="s2">DEPRECATED_SOURCECODE_PASSTHROUGHS</span><span class="s4">[</span><span class="s2">methodName</span><span class="s4">]](</span><span class="s2">...args</span><span class="s4">);</span>
                <span class="s4">}</span>
            <span class="s4">}),</span>
        <span class="s4">{}</span>
    <span class="s4">)</span>
<span class="s4">);</span>

<span class="s0">/**</span>
 <span class="s0">* Runs the given rules on the given SourceCode object</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{SourceCode} sourceCode A SourceCode object for the given text</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} configuredRules The rules configuration</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{function(string): Rule} ruleMapper A mapper function from rule names to rules</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string | undefined} parserName The name of the parser in the config</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LanguageOptions} languageOptions The options for parsing the code.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} settings The settings that were enabled in the config</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} filename The reported filename of the code</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} disableFixes If true, it doesn't make `fix` properties.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string | undefined} cwd cwd of the cli</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} physicalFilename The full path of the file on disk without any code block information</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintMessage[]} An array of reported problems</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">runRules</span><span class="s4">(</span><span class="s2">sourceCode</span><span class="s4">, </span><span class="s2">configuredRules</span><span class="s4">, </span><span class="s2">ruleMapper</span><span class="s4">, </span><span class="s2">parserName</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">, </span><span class="s2">settings</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">, </span><span class="s2">disableFixes</span><span class="s4">, </span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">physicalFilename</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s2">emitter </span><span class="s4">= </span><span class="s2">createEmitter</span><span class="s4">();</span>
    <span class="s6">const </span><span class="s2">nodeQueue </span><span class="s4">= [];</span>
    <span class="s6">let </span><span class="s2">currentNode </span><span class="s4">= </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">;</span>

    <span class="s2">Traverser</span><span class="s4">.</span><span class="s2">traverse</span><span class="s4">(</span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">, {</span>
        <span class="s2">enter</span><span class="s4">(</span><span class="s2">node</span><span class="s4">, </span><span class="s2">parent</span><span class="s4">) {</span>
            <span class="s2">node</span><span class="s4">.</span><span class="s2">parent </span><span class="s4">= </span><span class="s2">parent</span><span class="s4">;</span>
            <span class="s2">nodeQueue</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">isEntering</span><span class="s4">: </span><span class="s6">true</span><span class="s4">, </span><span class="s2">node </span><span class="s4">});</span>
        <span class="s4">},</span>
        <span class="s2">leave</span><span class="s4">(</span><span class="s2">node</span><span class="s4">) {</span>
            <span class="s2">nodeQueue</span><span class="s4">.</span><span class="s2">push</span><span class="s4">({ </span><span class="s2">isEntering</span><span class="s4">: </span><span class="s6">false</span><span class="s4">, </span><span class="s2">node </span><span class="s4">});</span>
        <span class="s4">},</span>
        <span class="s2">visitorKeys</span><span class="s4">: </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">visitorKeys</span>
    <span class="s4">});</span>

    <span class="s5">/* 
     * Create a frozen object with the ruleContext properties and methods that are shared by all rules. 
     * All rule contexts will inherit from this object. This avoids the performance penalty of copying all the 
     * properties once for each rule. 
     */</span>
    <span class="s6">const </span><span class="s2">sharedTraversalContext </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">(</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span>
            <span class="s2">Object</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s2">BASE_TRAVERSAL_CONTEXT</span><span class="s4">),</span>
            <span class="s4">{</span>
                <span class="s2">getAncestors</span><span class="s4">: () =&gt; </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getAncestors</span><span class="s4">(</span><span class="s2">currentNode</span><span class="s4">),</span>
                <span class="s2">getDeclaredVariables</span><span class="s4">: </span><span class="s2">node </span><span class="s4">=&gt; </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getDeclaredVariables</span><span class="s4">(</span><span class="s2">node</span><span class="s4">),</span>
                <span class="s2">getCwd</span><span class="s4">: () =&gt; </span><span class="s2">cwd</span><span class="s4">,</span>
                <span class="s2">cwd</span><span class="s4">,</span>
                <span class="s2">getFilename</span><span class="s4">: () =&gt; </span><span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">getPhysicalFilename</span><span class="s4">: () =&gt; </span><span class="s2">physicalFilename </span><span class="s4">|| </span><span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">physicalFilename</span><span class="s4">: </span><span class="s2">physicalFilename </span><span class="s4">|| </span><span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">getScope</span><span class="s4">: () =&gt; </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getScope</span><span class="s4">(</span><span class="s2">currentNode</span><span class="s4">),</span>
                <span class="s2">getSourceCode</span><span class="s4">: () =&gt; </span><span class="s2">sourceCode</span><span class="s4">,</span>
                <span class="s2">sourceCode</span><span class="s4">,</span>
                <span class="s2">markVariableAsUsed</span><span class="s4">: </span><span class="s2">name </span><span class="s4">=&gt; </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">markVariableAsUsed</span><span class="s4">(</span><span class="s2">name</span><span class="s4">, </span><span class="s2">currentNode</span><span class="s4">),</span>
                <span class="s2">parserOptions</span><span class="s4">: {</span>
                    <span class="s2">...languageOptions</span><span class="s4">.</span><span class="s2">parserOptions</span>
                <span class="s4">},</span>
                <span class="s2">parserPath</span><span class="s4">: </span><span class="s2">parserName</span><span class="s4">,</span>
                <span class="s2">languageOptions</span><span class="s4">,</span>
                <span class="s2">parserServices</span><span class="s4">: </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">parserServices</span><span class="s4">,</span>
                <span class="s2">settings</span>
            <span class="s4">}</span>
        <span class="s4">)</span>
    <span class="s4">);</span>

    <span class="s6">const </span><span class="s2">lintingProblems </span><span class="s4">= [];</span>

    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">configuredRules</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">ruleId </span><span class="s4">=&gt; {</span>
        <span class="s6">const </span><span class="s2">severity </span><span class="s4">= </span><span class="s2">ConfigOps</span><span class="s4">.</span><span class="s2">getRuleSeverity</span><span class="s4">(</span><span class="s2">configuredRules</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">]);</span>

        <span class="s5">// not load disabled rules</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">severity </span><span class="s4">=== </span><span class="s7">0</span><span class="s4">) {</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">ruleMapper</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">rule</span><span class="s4">) {</span>
            <span class="s2">lintingProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({ </span><span class="s2">ruleId </span><span class="s4">}));</span>
            <span class="s6">return</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">messageIds </span><span class="s4">= </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">messages</span><span class="s4">;</span>
        <span class="s6">let </span><span class="s2">reportTranslator </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">ruleContext </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">freeze</span><span class="s4">(</span>
            <span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">(</span>
                <span class="s2">Object</span><span class="s4">.</span><span class="s2">create</span><span class="s4">(</span><span class="s2">sharedTraversalContext</span><span class="s4">),</span>
                <span class="s4">{</span>
                    <span class="s2">id</span><span class="s4">: </span><span class="s2">ruleId</span><span class="s4">,</span>
                    <span class="s2">options</span><span class="s4">: </span><span class="s2">getRuleOptions</span><span class="s4">(</span><span class="s2">configuredRules</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">]),</span>
                    <span class="s2">report</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">) {</span>

                        <span class="s5">/* 
                         * Create a report translator lazily. 
                         * In a vast majority of cases, any given rule reports zero errors on a given 
                         * piece of code. Creating a translator lazily avoids the performance cost of 
                         * creating a new translator function for each rule that usually doesn't get 
                         * called. 
                         * 
                         * Using lazy report translators improves end-to-end performance by about 3% 
                         * with Node 8.4.0. 
                         */</span>
                        <span class="s6">if </span><span class="s4">(</span><span class="s2">reportTranslator </span><span class="s4">=== </span><span class="s6">null</span><span class="s4">) {</span>
                            <span class="s2">reportTranslator </span><span class="s4">= </span><span class="s2">createReportTranslator</span><span class="s4">({</span>
                                <span class="s2">ruleId</span><span class="s4">,</span>
                                <span class="s2">severity</span><span class="s4">,</span>
                                <span class="s2">sourceCode</span><span class="s4">,</span>
                                <span class="s2">messageIds</span><span class="s4">,</span>
                                <span class="s2">disableFixes</span>
                            <span class="s4">});</span>
                        <span class="s4">}</span>
                        <span class="s6">const </span><span class="s2">problem </span><span class="s4">= </span><span class="s2">reportTranslator</span><span class="s4">(</span><span class="s2">...args</span><span class="s4">);</span>

                        <span class="s6">if </span><span class="s4">(</span><span class="s2">problem</span><span class="s4">.</span><span class="s2">fix </span><span class="s4">&amp;&amp; !(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">fixable</span><span class="s4">)) {</span>
                            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;Fixable rules must set the `meta.fixable` property to </span><span class="s6">\&quot;</span><span class="s3">code</span><span class="s6">\&quot; </span><span class="s3">or </span><span class="s6">\&quot;</span><span class="s3">whitespace</span><span class="s6">\&quot;</span><span class="s3">.&quot;</span><span class="s4">);</span>
                        <span class="s4">}</span>
                        <span class="s6">if </span><span class="s4">(</span><span class="s2">problem</span><span class="s4">.</span><span class="s2">suggestions </span><span class="s4">&amp;&amp; !(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">hasSuggestions </span><span class="s4">=== </span><span class="s6">true</span><span class="s4">)) {</span>
                            <span class="s6">if </span><span class="s4">(</span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta </span><span class="s4">&amp;&amp; </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">docs </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">rule</span><span class="s4">.</span><span class="s2">meta</span><span class="s4">.</span><span class="s2">docs</span><span class="s4">.</span><span class="s2">suggestion </span><span class="s4">!== </span><span class="s3">&quot;undefined&quot;</span><span class="s4">) {</span>

                                <span class="s5">// Encourage migration from the former property name.</span>
                                <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;Rules with suggestions must set the `meta.hasSuggestions` property to `true`. `meta.docs.suggestion` is ignored by ESLint.&quot;</span><span class="s4">);</span>
                            <span class="s4">}</span>
                            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;Rules with suggestions must set the `meta.hasSuggestions` property to `true`.&quot;</span><span class="s4">);</span>
                        <span class="s4">}</span>
                        <span class="s2">lintingProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">problem</span><span class="s4">);</span>
                    <span class="s4">}</span>
                <span class="s4">}</span>
            <span class="s4">)</span>
        <span class="s4">);</span>

        <span class="s6">const </span><span class="s2">ruleListeners </span><span class="s4">= </span><span class="s2">timing</span><span class="s4">.</span><span class="s2">enabled </span><span class="s4">? </span><span class="s2">timing</span><span class="s4">.</span><span class="s2">time</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">createRuleListeners</span><span class="s4">)(</span><span class="s2">rule</span><span class="s4">, </span><span class="s2">ruleContext</span><span class="s4">) : </span><span class="s2">createRuleListeners</span><span class="s4">(</span><span class="s2">rule</span><span class="s4">, </span><span class="s2">ruleContext</span><span class="s4">);</span>

        <span class="s0">/**</span>
         <span class="s0">* Include `ruleId` in error logs</span>
         <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function} ruleListener A rule method that listens for a node.</span>
         <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Function} ruleListener wrapped in error handler</span>
         <span class="s0">*/</span>
        <span class="s6">function </span><span class="s2">addRuleErrorHandler</span><span class="s4">(</span><span class="s2">ruleListener</span><span class="s4">) {</span>
            <span class="s6">return function </span><span class="s2">ruleErrorHandler</span><span class="s4">(</span><span class="s2">...listenerArgs</span><span class="s4">) {</span>
                <span class="s6">try </span><span class="s4">{</span>
                    <span class="s6">return </span><span class="s2">ruleListener</span><span class="s4">(</span><span class="s2">...listenerArgs</span><span class="s4">);</span>
                <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">e</span><span class="s4">) {</span>
                    <span class="s2">e</span><span class="s4">.</span><span class="s2">ruleId </span><span class="s4">= </span><span class="s2">ruleId</span><span class="s4">;</span>
                    <span class="s6">throw </span><span class="s2">e</span><span class="s4">;</span>
                <span class="s4">}</span>
            <span class="s4">};</span>
        <span class="s4">}</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">ruleListeners </span><span class="s4">=== </span><span class="s3">&quot;undefined&quot; </span><span class="s4">|| </span><span class="s2">ruleListeners </span><span class="s4">=== </span><span class="s6">null</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">`The create() function for rule '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">' did not return an object.`</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// add all the selectors from the rule as listeners</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">ruleListeners</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">selector </span><span class="s4">=&gt; {</span>
            <span class="s6">const </span><span class="s2">ruleListener </span><span class="s4">= </span><span class="s2">timing</span><span class="s4">.</span><span class="s2">enabled</span>
                <span class="s4">? </span><span class="s2">timing</span><span class="s4">.</span><span class="s2">time</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleListeners</span><span class="s4">[</span><span class="s2">selector</span><span class="s4">])</span>
                <span class="s4">: </span><span class="s2">ruleListeners</span><span class="s4">[</span><span class="s2">selector</span><span class="s4">];</span>

            <span class="s2">emitter</span><span class="s4">.</span><span class="s2">on</span><span class="s4">(</span>
                <span class="s2">selector</span><span class="s4">,</span>
                <span class="s2">addRuleErrorHandler</span><span class="s4">(</span><span class="s2">ruleListener</span><span class="s4">)</span>
            <span class="s4">);</span>
        <span class="s4">});</span>
    <span class="s4">});</span>

    <span class="s5">// only run code path analyzer if the top level node is &quot;Program&quot;, skip otherwise</span>
    <span class="s6">const </span><span class="s2">eventGenerator </span><span class="s4">= </span><span class="s2">nodeQueue</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">node</span><span class="s4">.</span><span class="s2">type </span><span class="s4">=== </span><span class="s3">&quot;Program&quot;</span>
        <span class="s4">? </span><span class="s6">new </span><span class="s2">CodePathAnalyzer</span><span class="s4">(</span><span class="s6">new </span><span class="s2">NodeEventGenerator</span><span class="s4">(</span><span class="s2">emitter</span><span class="s4">, { </span><span class="s2">visitorKeys</span><span class="s4">: </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">visitorKeys</span><span class="s4">, </span><span class="s2">fallback</span><span class="s4">: </span><span class="s2">Traverser</span><span class="s4">.</span><span class="s2">getKeys </span><span class="s4">}))</span>
        <span class="s4">: </span><span class="s6">new </span><span class="s2">NodeEventGenerator</span><span class="s4">(</span><span class="s2">emitter</span><span class="s4">, { </span><span class="s2">visitorKeys</span><span class="s4">: </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">visitorKeys</span><span class="s4">, </span><span class="s2">fallback</span><span class="s4">: </span><span class="s2">Traverser</span><span class="s4">.</span><span class="s2">getKeys </span><span class="s4">});</span>

    <span class="s2">nodeQueue</span><span class="s4">.</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">traversalInfo </span><span class="s4">=&gt; {</span>
        <span class="s2">currentNode </span><span class="s4">= </span><span class="s2">traversalInfo</span><span class="s4">.</span><span class="s2">node</span><span class="s4">;</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">traversalInfo</span><span class="s4">.</span><span class="s2">isEntering</span><span class="s4">) {</span>
                <span class="s2">eventGenerator</span><span class="s4">.</span><span class="s2">enterNode</span><span class="s4">(</span><span class="s2">currentNode</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">eventGenerator</span><span class="s4">.</span><span class="s2">leaveNode</span><span class="s4">(</span><span class="s2">currentNode</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
            <span class="s2">err</span><span class="s4">.</span><span class="s2">currentNode </span><span class="s4">= </span><span class="s2">currentNode</span><span class="s4">;</span>
            <span class="s6">throw </span><span class="s2">err</span><span class="s4">;</span>
        <span class="s4">}</span>
    <span class="s4">});</span>

    <span class="s6">return </span><span class="s2">lintingProblems</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Ensure the source code to be a string.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The text or source code object.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The source code text.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">ensureText</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">textOrSourceCode </span><span class="s4">=== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">hasBOM</span><span class="s4">, </span><span class="s2">text </span><span class="s4">} = </span><span class="s2">textOrSourceCode</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">bom </span><span class="s4">= </span><span class="s2">hasBOM </span><span class="s4">? </span><span class="s3">&quot;</span><span class="s6">\uFEFF</span><span class="s3">&quot; </span><span class="s4">: </span><span class="s3">&quot;&quot;</span><span class="s4">;</span>

        <span class="s6">return </span><span class="s2">bom </span><span class="s4">+ </span><span class="s2">text</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s6">return </span><span class="s2">String</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Get an environment.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LinterInternalSlots} slots The internal slots of Linter.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} envId The environment ID to get.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Environment|null} The environment.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getEnv</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">, </span><span class="s2">envId</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s4">(</span>
        <span class="s4">(</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastConfigArray </span><span class="s4">&amp;&amp; </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastConfigArray</span><span class="s4">.</span><span class="s2">pluginEnvironments</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">envId</span><span class="s4">)) ||</span>
        <span class="s2">BuiltInEnvironments</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">envId</span><span class="s4">) ||</span>
        <span class="s6">null</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Get a rule.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{LinterInternalSlots} slots The internal slots of Linter.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} ruleId The rule ID to get.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Rule|null} The rule.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">getRule</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">, </span><span class="s2">ruleId</span><span class="s4">) {</span>
    <span class="s6">return </span><span class="s4">(</span>
        <span class="s4">(</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastConfigArray </span><span class="s4">&amp;&amp; </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastConfigArray</span><span class="s4">.</span><span class="s2">pluginRules</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">)) ||</span>
        <span class="s2">slots</span><span class="s4">.</span><span class="s2">ruleMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">)</span>
    <span class="s4">);</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* Normalize the value of the cwd</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string | undefined} cwd raw value of the cwd, path to a directory that should be considered as the current working directory, can be undefined.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string | undefined} normalized cwd</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">normalizeCwd</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) {</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">cwd</span><span class="s4">;</span>
    <span class="s4">}</span>
    <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">process </span><span class="s4">=== </span><span class="s3">&quot;object&quot;</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">process</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">();</span>
    <span class="s4">}</span>

    <span class="s5">// It's more explicit to assign the undefined</span>
    <span class="s5">// eslint-disable-next-line no-undefined -- Consistently returning a value</span>
    <span class="s6">return </span><span class="s2">undefined</span><span class="s4">;</span>
<span class="s4">}</span>

<span class="s0">/**</span>
 <span class="s0">* The map to store private data.</span>
 <span class="s0">* </span><span class="s1">@type </span><span class="s0">{WeakMap&lt;Linter, LinterInternalSlots&gt;}</span>
 <span class="s0">*/</span>
<span class="s6">const </span><span class="s2">internalSlotsMap </span><span class="s4">= </span><span class="s6">new </span><span class="s2">WeakMap</span><span class="s4">();</span>

<span class="s0">/**</span>
 <span class="s0">* Throws an error when the given linter is in flat config mode.</span>
 <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Linter} linter The linter to check.</span>
 <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
 <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} If the linter is in flat config mode.</span>
 <span class="s0">*/</span>
<span class="s6">function </span><span class="s2">assertEslintrcConfig</span><span class="s4">(</span><span class="s2">linter</span><span class="s4">) {</span>
    <span class="s6">const </span><span class="s4">{ </span><span class="s2">configType </span><span class="s4">} = </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">linter</span><span class="s4">);</span>

    <span class="s6">if </span><span class="s4">(</span><span class="s2">configType </span><span class="s4">=== </span><span class="s3">&quot;flat&quot;</span><span class="s4">) {</span>
        <span class="s6">throw new </span><span class="s2">Error</span><span class="s4">(</span><span class="s3">&quot;This method cannot be used with flat config. Add your entries directly into the config array.&quot;</span><span class="s4">);</span>
    <span class="s4">}</span>
<span class="s4">}</span>


<span class="s5">//------------------------------------------------------------------------------</span>
<span class="s5">// Public Interface</span>
<span class="s5">//------------------------------------------------------------------------------</span>

<span class="s0">/**</span>
 <span class="s0">* Object that is responsible for verifying JavaScript text</span>
 <span class="s0">* </span><span class="s1">@name </span><span class="s0">Linter</span>
 <span class="s0">*/</span>
<span class="s6">class </span><span class="s2">Linter </span><span class="s4">{</span>

    <span class="s0">/**</span>
     <span class="s0">* Initialize the Linter.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Object} [config] the config object</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} [config.cwd] path to a directory that should be considered as the current working directory, can be undefined.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{&quot;flat&quot;|&quot;eslintrc&quot;} [config.configType=&quot;eslintrc&quot;] the type of config used.</span>
     <span class="s0">*/</span>
    <span class="s2">constructor</span><span class="s4">({ </span><span class="s2">cwd</span><span class="s4">, </span><span class="s2">configType </span><span class="s4">} = {}) {</span>
        <span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s6">this</span><span class="s4">, {</span>
            <span class="s2">cwd</span><span class="s4">: </span><span class="s2">normalizeCwd</span><span class="s4">(</span><span class="s2">cwd</span><span class="s4">),</span>
            <span class="s2">lastConfigArray</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
            <span class="s2">lastSourceCode</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
            <span class="s2">lastSuppressedMessages</span><span class="s4">: [],</span>
            <span class="s2">configType</span><span class="s4">, </span><span class="s5">// TODO: Remove after flat config conversion</span>
            <span class="s2">parserMap</span><span class="s4">: </span><span class="s6">new </span><span class="s2">Map</span><span class="s4">([[</span><span class="s3">&quot;espree&quot;</span><span class="s4">, </span><span class="s2">espree</span><span class="s4">]]),</span>
            <span class="s2">ruleMap</span><span class="s4">: </span><span class="s6">new </span><span class="s2">Rules</span><span class="s4">()</span>
        <span class="s4">});</span>

        <span class="s6">this</span><span class="s4">.</span><span class="s2">version </span><span class="s4">= </span><span class="s2">pkg</span><span class="s4">.</span><span class="s2">version</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Getter for package version.</span>
     <span class="s0">* </span><span class="s1">@static</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{string} The version from package.json.</span>
     <span class="s0">*/</span>
    <span class="s6">static </span><span class="s2">get version</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">pkg</span><span class="s4">.</span><span class="s2">version</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Same as linter.verify, except without support for processors.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The text to parse or a SourceCode object.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData} providedConfig An ESLintConfig instance to configure everything.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions} [providedOptions] The optional filename of the file being checked.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} If during rule execution.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The results as an array of messages or an empty array if no messages.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithoutProcessors</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">providedConfig</span><span class="s4">, </span><span class="s2">providedOptions</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">slots </span><span class="s4">= </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">providedConfig </span><span class="s4">|| {};</span>
        <span class="s6">const </span><span class="s2">options </span><span class="s4">= </span><span class="s2">normalizeVerifyOptions</span><span class="s4">(</span><span class="s2">providedOptions</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>
        <span class="s6">let </span><span class="s2">text</span><span class="s4">;</span>

        <span class="s5">// evaluate arguments</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">textOrSourceCode </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>
            <span class="s2">text </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">;</span>
            <span class="s2">text </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">.</span><span class="s2">text</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s5">// Resolve parser.</span>
        <span class="s6">let </span><span class="s2">parserName </span><span class="s4">= </span><span class="s2">DEFAULT_PARSER_NAME</span><span class="s4">;</span>
        <span class="s6">let </span><span class="s2">parser </span><span class="s4">= </span><span class="s2">espree</span><span class="s4">;</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser </span><span class="s4">=== </span><span class="s3">&quot;object&quot; </span><span class="s4">&amp;&amp; </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser </span><span class="s4">!== </span><span class="s6">null</span><span class="s4">) {</span>
            <span class="s2">parserName </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">.</span><span class="s2">filePath</span><span class="s4">;</span>
            <span class="s2">parser </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">.</span><span class="s2">definition</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">parserMap</span><span class="s4">.</span><span class="s2">has</span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">)) {</span>
                <span class="s6">return </span><span class="s4">[{</span>
                    <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                    <span class="s2">fatal</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
                    <span class="s2">severity</span><span class="s4">: </span><span class="s7">2</span><span class="s4">,</span>
                    <span class="s2">message</span><span class="s4">: </span><span class="s3">`Configured parser '</span><span class="s2">$</span><span class="s4">{</span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">}</span><span class="s3">' was not found.`</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
                    <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
                <span class="s4">}];</span>
            <span class="s4">}</span>
            <span class="s2">parserName </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">;</span>
            <span class="s2">parser </span><span class="s4">= </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">parserMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// search and apply &quot;eslint-env *&quot;.</span>
        <span class="s6">const </span><span class="s2">envInFile </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">allowInlineConfig </span><span class="s4">&amp;&amp; !</span><span class="s2">options</span><span class="s4">.</span><span class="s2">warnInlineConfig</span>
            <span class="s4">? </span><span class="s2">findEslintEnv</span><span class="s4">(</span><span class="s2">text</span><span class="s4">)</span>
            <span class="s4">: {};</span>
        <span class="s6">const </span><span class="s2">resolvedEnvConfig </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({ </span><span class="s2">builtin</span><span class="s4">: </span><span class="s6">true </span><span class="s4">}, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">env</span><span class="s4">, </span><span class="s2">envInFile</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">enabledEnvs </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">resolvedEnvConfig</span><span class="s4">)</span>
            <span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">envName </span><span class="s4">=&gt; </span><span class="s2">resolvedEnvConfig</span><span class="s4">[</span><span class="s2">envName</span><span class="s4">])</span>
            <span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">envName </span><span class="s4">=&gt; </span><span class="s2">getEnv</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">, </span><span class="s2">envName</span><span class="s4">))</span>
            <span class="s4">.</span><span class="s2">filter</span><span class="s4">(</span><span class="s2">env </span><span class="s4">=&gt; </span><span class="s2">env</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">parserOptions </span><span class="s4">= </span><span class="s2">resolveParserOptions</span><span class="s4">(</span><span class="s2">parser</span><span class="s4">, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">parserOptions </span><span class="s4">|| {}, </span><span class="s2">enabledEnvs</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">configuredGlobals </span><span class="s4">= </span><span class="s2">resolveGlobals</span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">globals </span><span class="s4">|| {}, </span><span class="s2">enabledEnvs</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">settings </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">settings </span><span class="s4">|| {};</span>
        <span class="s6">const </span><span class="s2">languageOptions </span><span class="s4">= </span><span class="s2">createLanguageOptions</span><span class="s4">({</span>
            <span class="s2">globals</span><span class="s4">: </span><span class="s2">config</span><span class="s4">.</span><span class="s2">globals</span><span class="s4">,</span>
            <span class="s2">parser</span><span class="s4">,</span>
            <span class="s2">parserOptions</span>
        <span class="s4">});</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">parseResult </span><span class="s4">= </span><span class="s2">parse</span><span class="s4">(</span>
                <span class="s2">text</span><span class="s4">,</span>
                <span class="s2">languageOptions</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span>
            <span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(!</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">success</span><span class="s4">) {</span>
                <span class="s6">return </span><span class="s4">[</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">];</span>
            <span class="s4">}</span>

            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">sourceCode</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>

            <span class="s5">/* 
             * If the given source code object as the first argument does not have scopeManager, analyze the scope. 
             * This is for backward compatibility (SourceCode is frozen so it cannot rebind). 
             */</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">scopeManager</span><span class="s4">) {</span>
                <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s6">new </span><span class="s2">SourceCode</span><span class="s4">({</span>
                    <span class="s2">text</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">text</span><span class="s4">,</span>
                    <span class="s2">ast</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">,</span>
                    <span class="s2">parserServices</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">parserServices</span><span class="s4">,</span>
                    <span class="s2">visitorKeys</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">visitorKeys</span><span class="s4">,</span>
                    <span class="s2">scopeManager</span><span class="s4">: </span><span class="s2">analyzeScope</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">)</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">sourceCode </span><span class="s4">= </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">commentDirectives </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">allowInlineConfig</span>
            <span class="s4">? </span><span class="s2">getDirectiveComments</span><span class="s4">(</span><span class="s2">sourceCode</span><span class="s4">, </span><span class="s2">ruleId </span><span class="s4">=&gt; </span><span class="s2">getRule</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">, </span><span class="s2">ruleId</span><span class="s4">), </span><span class="s2">options</span><span class="s4">.</span><span class="s2">warnInlineConfig</span><span class="s4">)</span>
            <span class="s4">: { </span><span class="s2">configuredRules</span><span class="s4">: {}, </span><span class="s2">enabledGlobals</span><span class="s4">: {}, </span><span class="s2">exportedVariables</span><span class="s4">: {}, </span><span class="s2">problems</span><span class="s4">: [], </span><span class="s2">disableDirectives</span><span class="s4">: [] };</span>

        <span class="s5">// augment global scope with declared global variables</span>
        <span class="s2">addDeclaredGlobals</span><span class="s4">(</span>
            <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">scopeManager</span><span class="s4">.</span><span class="s2">scopes</span><span class="s4">[</span><span class="s7">0</span><span class="s4">],</span>
            <span class="s2">configuredGlobals</span><span class="s4">,</span>
            <span class="s4">{ </span><span class="s2">exportedVariables</span><span class="s4">: </span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">exportedVariables</span><span class="s4">, </span><span class="s2">enabledGlobals</span><span class="s4">: </span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">enabledGlobals </span><span class="s4">}</span>
        <span class="s4">);</span>

        <span class="s6">const </span><span class="s2">configuredRules </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">, </span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">configuredRules</span><span class="s4">);</span>
        <span class="s6">let </span><span class="s2">lintingProblems</span><span class="s4">;</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s2">lintingProblems </span><span class="s4">= </span><span class="s2">runRules</span><span class="s4">(</span>
                <span class="s2">sourceCode</span><span class="s4">,</span>
                <span class="s2">configuredRules</span><span class="s4">,</span>
                <span class="s2">ruleId </span><span class="s4">=&gt; </span><span class="s2">getRule</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">, </span><span class="s2">ruleId</span><span class="s4">),</span>
                <span class="s2">parserName</span><span class="s4">,</span>
                <span class="s2">languageOptions</span><span class="s4">,</span>
                <span class="s2">settings</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes</span><span class="s4">,</span>
                <span class="s2">slots</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">,</span>
                <span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">physicalFilename</span>
            <span class="s4">);</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
            <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`</span><span class="s6">\n</span><span class="s3">Occurred while linting </span><span class="s2">$</span><span class="s4">{</span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;An error occurred while traversing&quot;</span><span class="s4">);</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Filename:&quot;</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">);</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">currentNode</span><span class="s4">) {</span>
                <span class="s6">const </span><span class="s4">{ </span><span class="s2">line </span><span class="s4">} = </span><span class="s2">err</span><span class="s4">.</span><span class="s2">currentNode</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">;</span>

                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Line:&quot;</span><span class="s4">, </span><span class="s2">line</span><span class="s4">);</span>
                <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">line</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Parser Options:&quot;</span><span class="s4">, </span><span class="s2">parserOptions</span><span class="s4">);</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Parser Path:&quot;</span><span class="s4">, </span><span class="s2">parserName</span><span class="s4">);</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Settings:&quot;</span><span class="s4">, </span><span class="s2">settings</span><span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">) {</span>
                <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`</span><span class="s6">\n</span><span class="s3">Rule: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">err</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">&quot;`</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">throw </span><span class="s2">err</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">return </span><span class="s2">applyDisableDirectives</span><span class="s4">({</span>
            <span class="s2">directives</span><span class="s4">: </span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">disableDirectives</span><span class="s4">,</span>
            <span class="s2">disableFixes</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes</span><span class="s4">,</span>
            <span class="s2">problems</span><span class="s4">: </span><span class="s2">lintingProblems</span>
                <span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">problems</span><span class="s4">)</span>
                <span class="s4">.</span><span class="s2">sort</span><span class="s4">((</span><span class="s2">problemA</span><span class="s4">, </span><span class="s2">problemB</span><span class="s4">) =&gt; </span><span class="s2">problemA</span><span class="s4">.</span><span class="s2">line </span><span class="s4">- </span><span class="s2">problemB</span><span class="s4">.</span><span class="s2">line </span><span class="s4">|| </span><span class="s2">problemA</span><span class="s4">.</span><span class="s2">column </span><span class="s4">- </span><span class="s2">problemB</span><span class="s4">.</span><span class="s2">column</span><span class="s4">),</span>
            <span class="s2">reportUnusedDisableDirectives</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Verifies the text against the rules specified by the second argument.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The text to parse or a SourceCode object.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData|ConfigArray} config An ESLintConfig instance to configure everything.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{(string|(VerifyOptions&amp;ProcessorOptions))} [filenameOrOptions] The optional filename of the file being checked.</span>
     <span class="s0">*      If this is not set, the filename will default to '&lt;input&gt;' in the rule context. If</span>
     <span class="s0">*      an object, then it has &quot;filename&quot;, &quot;allowInlineConfig&quot;, and some properties.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintMessage[]} The results as an array of messages or an empty array if no messages.</span>
     <span class="s0">*/</span>
    <span class="s2">verify</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">filenameOrOptions</span><span class="s4">) {</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Verify&quot;</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s4">{ </span><span class="s2">configType</span><span class="s4">, </span><span class="s2">cwd </span><span class="s4">} = </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">options </span><span class="s4">= </span><span class="s6">typeof </span><span class="s2">filenameOrOptions </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span>
            <span class="s4">? { </span><span class="s2">filename</span><span class="s4">: </span><span class="s2">filenameOrOptions </span><span class="s4">}</span>
            <span class="s4">: </span><span class="s2">filenameOrOptions </span><span class="s4">|| {};</span>

        <span class="s6">if </span><span class="s4">(</span><span class="s2">config</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">configType </span><span class="s4">=== </span><span class="s3">&quot;flat&quot;</span><span class="s4">) {</span>

                <span class="s5">/* 
                 * Because of how Webpack packages up the files, we can't 
                 * compare directly to `FlatConfigArray` using `instanceof` 
                 * because it's not the same `FlatConfigArray` as in the tests. 
                 * So, we work around it by assuming an array is, in fact, a 
                 * `FlatConfigArray` if it has a `getConfig()` method. 
                 */</span>
                <span class="s6">let </span><span class="s2">configArray </span><span class="s4">= </span><span class="s2">config</span><span class="s4">;</span>

                <span class="s6">if </span><span class="s4">(!</span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">config</span><span class="s4">) || </span><span class="s6">typeof </span><span class="s2">config</span><span class="s4">.</span><span class="s2">getConfig </span><span class="s4">!== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
                    <span class="s2">configArray </span><span class="s4">= </span><span class="s6">new </span><span class="s2">FlatConfigArray</span><span class="s4">(</span><span class="s2">config</span><span class="s4">, { </span><span class="s2">basePath</span><span class="s4">: </span><span class="s2">cwd </span><span class="s4">});</span>
                    <span class="s2">configArray</span><span class="s4">.</span><span class="s2">normalizeSync</span><span class="s4">();</span>
                <span class="s4">}</span>

                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_distinguishSuppressedMessages</span><span class="s4">(</span><span class="s6">this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArray</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">configArray</span><span class="s4">, </span><span class="s2">options</span><span class="s4">, </span><span class="s6">true</span><span class="s4">));</span>
            <span class="s4">}</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">config</span><span class="s4">.</span><span class="s2">extractConfig </span><span class="s4">=== </span><span class="s3">&quot;function&quot;</span><span class="s4">) {</span>
                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_distinguishSuppressedMessages</span><span class="s4">(</span><span class="s6">this</span><span class="s4">.</span><span class="s2">_verifyWithConfigArray</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">));</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s5">/* 
         * If we get to here, it means `config` is just an object rather 
         * than a config array so we can go right into linting. 
         */</span>

        <span class="s5">/* 
         * `Linter` doesn't support `overrides` property in configuration. 
         * So we cannot apply multiple processors. 
         */</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">preprocess </span><span class="s4">|| </span><span class="s2">options</span><span class="s4">.</span><span class="s2">postprocess</span><span class="s4">) {</span>
            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_distinguishSuppressedMessages</span><span class="s4">(</span><span class="s6">this</span><span class="s4">.</span><span class="s2">_verifyWithProcessor</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">));</span>
        <span class="s4">}</span>
        <span class="s6">return this</span><span class="s4">.</span><span class="s2">_distinguishSuppressedMessages</span><span class="s4">(</span><span class="s6">this</span><span class="s4">.</span><span class="s2">_verifyWithoutProcessors</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">));</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Verify with a processor.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The source code.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfig} config The config array.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions&amp;ProcessorOptions} options The options.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} [configForRecursive] The `ConfigArray` object to apply multiple processors recursively.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The found problems.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithFlatConfigArrayAndProcessor</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">, </span><span class="s2">configForRecursive</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">filename </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;&lt;input&gt;&quot;</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">filenameToExpose </span><span class="s4">= </span><span class="s2">normalizeFilename</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">physicalFilename </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">physicalFilename </span><span class="s4">|| </span><span class="s2">filenameToExpose</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">text </span><span class="s4">= </span><span class="s2">ensureText</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">preprocess </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">preprocess </span><span class="s4">|| (</span><span class="s2">rawText </span><span class="s4">=&gt; [</span><span class="s2">rawText</span><span class="s4">]);</span>
        <span class="s6">const </span><span class="s2">postprocess </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">postprocess </span><span class="s4">|| (</span><span class="s2">messagesList </span><span class="s4">=&gt; </span><span class="s2">messagesList</span><span class="s4">.</span><span class="s2">flat</span><span class="s4">());</span>
        <span class="s6">const </span><span class="s2">filterCodeBlock </span><span class="s4">=</span>
            <span class="s2">options</span><span class="s4">.</span><span class="s2">filterCodeBlock </span><span class="s4">||</span>
            <span class="s4">(</span><span class="s2">blockFilename </span><span class="s4">=&gt; </span><span class="s2">blockFilename</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s3">&quot;.js&quot;</span><span class="s4">));</span>
        <span class="s6">const </span><span class="s2">originalExtname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">extname</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">);</span>

        <span class="s6">let </span><span class="s2">blocks</span><span class="s4">;</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s2">blocks </span><span class="s4">= </span><span class="s2">preprocess</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">filenameToExpose</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">ex</span><span class="s4">) {</span>

            <span class="s5">// If the message includes a leading line number, strip it:</span>
            <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s3">`Preprocessing error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ex</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^line \d+:/iu</span><span class="s4">, </span><span class="s3">&quot;&quot;</span><span class="s4">).</span><span class="s2">trim</span><span class="s4">()}</span><span class="s3">`</span><span class="s4">;</span>

            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;%s</span><span class="s6">\n</span><span class="s3">%s&quot;</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">);</span>

            <span class="s6">return </span><span class="s4">[</span>
                <span class="s4">{</span>
                    <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                    <span class="s2">fatal</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
                    <span class="s2">severity</span><span class="s4">: </span><span class="s7">2</span><span class="s4">,</span>
                    <span class="s2">message</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">lineNumber</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">column</span><span class="s4">,</span>
                    <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
                <span class="s4">}</span>
            <span class="s4">];</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">messageLists </span><span class="s4">= </span><span class="s2">blocks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">block</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; {</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;A code block was found: %o&quot;</span><span class="s4">, </span><span class="s2">block</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;(unnamed)&quot;</span><span class="s4">);</span>

            <span class="s5">// Keep the legacy behavior.</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">block </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArrayAndWithoutProcessors</span><span class="s4">(</span><span class="s2">block</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">blockText </span><span class="s4">= </span><span class="s2">block</span><span class="s4">.</span><span class="s2">text</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">blockName </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">, </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">i</span><span class="s4">}</span><span class="s3">_</span><span class="s2">$</span><span class="s4">{</span><span class="s2">block</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

            <span class="s5">// Skip this block if filtered.</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">filterCodeBlock</span><span class="s4">(</span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">blockText</span><span class="s4">)) {</span>
                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;This code block was skipped.&quot;</span><span class="s4">);</span>
                <span class="s6">return </span><span class="s4">[];</span>
            <span class="s4">}</span>

            <span class="s5">// Resolve configuration again if the file content or extension was changed.</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">configForRecursive </span><span class="s4">&amp;&amp; (</span><span class="s2">text </span><span class="s4">!== </span><span class="s2">blockText </span><span class="s4">|| </span><span class="s2">path</span><span class="s4">.</span><span class="s2">extname</span><span class="s4">(</span><span class="s2">blockName</span><span class="s4">) !== </span><span class="s2">originalExtname</span><span class="s4">)) {</span>
                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Resolving configuration again because the file content or extension was changed.&quot;</span><span class="s4">);</span>
                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArray</span><span class="s4">(</span>
                    <span class="s2">blockText</span><span class="s4">,</span>
                    <span class="s2">configForRecursive</span><span class="s4">,</span>
                    <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">: </span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">physicalFilename </span><span class="s4">}</span>
                <span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s5">// Does lint.</span>
            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArrayAndWithoutProcessors</span><span class="s4">(</span>
                <span class="s2">blockText</span><span class="s4">,</span>
                <span class="s2">config</span><span class="s4">,</span>
                <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">: </span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">physicalFilename </span><span class="s4">}</span>
            <span class="s4">);</span>
        <span class="s4">});</span>

        <span class="s6">return </span><span class="s2">postprocess</span><span class="s4">(</span><span class="s2">messageLists</span><span class="s4">, </span><span class="s2">filenameToExpose</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Same as linter.verify, except without support for processors.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The text to parse or a SourceCode object.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfig} providedConfig An ESLintConfig instance to configure everything.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions} [providedOptions] The optional filename of the file being checked.</span>
     <span class="s0">* </span><span class="s1">@throws </span><span class="s0">{Error} If during rule execution.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The results as an array of messages or an empty array if no messages.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithFlatConfigArrayAndWithoutProcessors</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">providedConfig</span><span class="s4">, </span><span class="s2">providedOptions</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">slots </span><span class="s4">= </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">providedConfig </span><span class="s4">|| {};</span>
        <span class="s6">const </span><span class="s2">options </span><span class="s4">= </span><span class="s2">normalizeVerifyOptions</span><span class="s4">(</span><span class="s2">providedOptions</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>
        <span class="s6">let </span><span class="s2">text</span><span class="s4">;</span>

        <span class="s5">// evaluate arguments</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">textOrSourceCode </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s6">null</span><span class="s4">;</span>
            <span class="s2">text </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">;</span>
            <span class="s2">text </span><span class="s4">= </span><span class="s2">textOrSourceCode</span><span class="s4">.</span><span class="s2">text</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">languageOptions </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">languageOptions</span><span class="s4">;</span>

        <span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">ecmaVersion </span><span class="s4">= </span><span class="s2">normalizeEcmaVersionForLanguageOptions</span><span class="s4">(</span>
            <span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">ecmaVersion</span>
        <span class="s4">);</span>

        <span class="s5">// double check that there is a parser to avoid mysterious error messages</span>
        <span class="s6">if </span><span class="s4">(!</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">) {</span>
            <span class="s6">throw new </span><span class="s2">TypeError</span><span class="s4">(</span><span class="s3">`No parser specified for </span><span class="s2">$</span><span class="s4">{</span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// Espree expects this information to be passed in</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">isEspree</span><span class="s4">(</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parser</span><span class="s4">)) {</span>
            <span class="s6">const </span><span class="s2">parserOptions </span><span class="s4">= </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">sourceType</span><span class="s4">) {</span>

                <span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">sourceType </span><span class="s4">= </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">sourceType</span><span class="s4">;</span>

                <span class="s6">if </span><span class="s4">(</span>
                    <span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">sourceType </span><span class="s4">=== </span><span class="s3">&quot;module&quot; </span><span class="s4">&amp;&amp;</span>
                    <span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures </span><span class="s4">&amp;&amp;</span>
                    <span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures</span><span class="s4">.</span><span class="s2">globalReturn</span>
                <span class="s4">) {</span>
                    <span class="s2">parserOptions</span><span class="s4">.</span><span class="s2">ecmaFeatures</span><span class="s4">.</span><span class="s2">globalReturn </span><span class="s4">= </span><span class="s6">false</span><span class="s4">;</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">settings </span><span class="s4">= </span><span class="s2">config</span><span class="s4">.</span><span class="s2">settings </span><span class="s4">|| {};</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">) {</span>
            <span class="s6">const </span><span class="s2">parseResult </span><span class="s4">= </span><span class="s2">parse</span><span class="s4">(</span>
                <span class="s2">text</span><span class="s4">,</span>
                <span class="s2">languageOptions</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span>
            <span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(!</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">success</span><span class="s4">) {</span>
                <span class="s6">return </span><span class="s4">[</span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">error</span><span class="s4">];</span>
            <span class="s4">}</span>

            <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s2">parseResult</span><span class="s4">.</span><span class="s2">sourceCode</span><span class="s4">;</span>
        <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>

            <span class="s5">/* 
             * If the given source code object as the first argument does not have scopeManager, analyze the scope. 
             * This is for backward compatibility (SourceCode is frozen so it cannot rebind). 
             */</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">scopeManager</span><span class="s4">) {</span>
                <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode </span><span class="s4">= </span><span class="s6">new </span><span class="s2">SourceCode</span><span class="s4">({</span>
                    <span class="s2">text</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">text</span><span class="s4">,</span>
                    <span class="s2">ast</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">,</span>
                    <span class="s2">parserServices</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">parserServices</span><span class="s4">,</span>
                    <span class="s2">visitorKeys</span><span class="s4">: </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">visitorKeys</span><span class="s4">,</span>
                    <span class="s2">scopeManager</span><span class="s4">: </span><span class="s2">analyzeScope</span><span class="s4">(</span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">.</span><span class="s2">ast</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">)</span>
                <span class="s4">});</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">sourceCode </span><span class="s4">= </span><span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSourceCode</span><span class="s4">;</span>

        <span class="s5">/* 
         * Make adjustments based on the language options. For JavaScript, 
         * this is primarily about adding variables into the global scope 
         * to account for ecmaVersion and configured globals. 
         */</span>
        <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">applyLanguageOptions</span><span class="s4">(</span><span class="s2">languageOptions</span><span class="s4">);</span>

        <span class="s6">const </span><span class="s2">mergedInlineConfig </span><span class="s4">= {</span>
            <span class="s2">rules</span><span class="s4">: {}</span>
        <span class="s4">};</span>
        <span class="s6">const </span><span class="s2">inlineConfigProblems </span><span class="s4">= [];</span>

        <span class="s5">/* 
         * Inline config can be either enabled or disabled. If disabled, it's possible 
         * to detect the inline config and emit a warning (though this is not required). 
         * So we first check to see if inline config is allowed at all, and if so, we 
         * need to check if it's a warning or not. 
         */</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">allowInlineConfig</span><span class="s4">) {</span>

            <span class="s5">// if inline config should warn then add the warnings</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">warnInlineConfig</span><span class="s4">) {</span>
                <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">getInlineConfigNodes</span><span class="s4">().</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">node </span><span class="s4">=&gt; {</span>
                    <span class="s2">inlineConfigProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                        <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                        <span class="s2">message</span><span class="s4">: </span><span class="s3">`'</span><span class="s2">$</span><span class="s4">{</span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">text</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s2">node</span><span class="s4">.</span><span class="s2">range</span><span class="s4">[</span><span class="s7">0</span><span class="s4">], </span><span class="s2">node</span><span class="s4">.</span><span class="s2">range</span><span class="s4">[</span><span class="s7">1</span><span class="s4">])}</span><span class="s3">' has no effect because you have 'noInlineConfig' setting in </span><span class="s2">$</span><span class="s4">{</span><span class="s2">options</span><span class="s4">.</span><span class="s2">warnInlineConfig</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">,</span>
                        <span class="s2">loc</span><span class="s4">: </span><span class="s2">node</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">,</span>
                        <span class="s2">severity</span><span class="s4">: </span><span class="s7">1</span>
                    <span class="s4">}));</span>

                <span class="s4">});</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s6">const </span><span class="s2">inlineConfigResult </span><span class="s4">= </span><span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">applyInlineConfig</span><span class="s4">();</span>

                <span class="s2">inlineConfigProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span>
                    <span class="s2">...inlineConfigResult</span><span class="s4">.</span><span class="s2">problems</span>
                        <span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">)</span>
                        <span class="s4">.</span><span class="s2">map</span><span class="s4">(</span><span class="s2">problem </span><span class="s4">=&gt; {</span>
                            <span class="s2">problem</span><span class="s4">.</span><span class="s2">fatal </span><span class="s4">= </span><span class="s6">true</span><span class="s4">;</span>
                            <span class="s6">return </span><span class="s2">problem</span><span class="s4">;</span>
                        <span class="s4">})</span>
                <span class="s4">);</span>

                <span class="s5">// next we need to verify information about the specified rules</span>
                <span class="s6">const </span><span class="s2">ruleValidator </span><span class="s4">= </span><span class="s6">new </span><span class="s2">RuleValidator</span><span class="s4">();</span>

                <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s4">{ </span><span class="s2">config</span><span class="s4">: </span><span class="s2">inlineConfig</span><span class="s4">, </span><span class="s2">node </span><span class="s4">} </span><span class="s2">of inlineConfigResult</span><span class="s4">.</span><span class="s2">configs</span><span class="s4">) {</span>

                    <span class="s2">Object</span><span class="s4">.</span><span class="s2">keys</span><span class="s4">(</span><span class="s2">inlineConfig</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">ruleId </span><span class="s4">=&gt; {</span>
                        <span class="s6">const </span><span class="s2">rule </span><span class="s4">= </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">);</span>
                        <span class="s6">const </span><span class="s2">ruleValue </span><span class="s4">= </span><span class="s2">inlineConfig</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">];</span>

                        <span class="s6">if </span><span class="s4">(!</span><span class="s2">rule</span><span class="s4">) {</span>
                            <span class="s2">inlineConfigProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({ </span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">loc</span><span class="s4">: </span><span class="s2">node</span><span class="s4">.</span><span class="s2">loc </span><span class="s4">}));</span>
                            <span class="s6">return</span><span class="s4">;</span>
                        <span class="s4">}</span>

                        <span class="s6">try </span><span class="s4">{</span>

                            <span class="s6">const </span><span class="s2">ruleOptions </span><span class="s4">= </span><span class="s2">Array</span><span class="s4">.</span><span class="s2">isArray</span><span class="s4">(</span><span class="s2">ruleValue</span><span class="s4">) ? </span><span class="s2">ruleValue </span><span class="s4">: [</span><span class="s2">ruleValue</span><span class="s4">];</span>

                            <span class="s2">assertIsRuleOptions</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleValue</span><span class="s4">);</span>
                            <span class="s2">assertIsRuleSeverity</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleOptions</span><span class="s4">[</span><span class="s7">0</span><span class="s4">]);</span>

                            <span class="s2">ruleValidator</span><span class="s4">.</span><span class="s2">validate</span><span class="s4">({</span>
                                <span class="s2">plugins</span><span class="s4">: </span><span class="s2">config</span><span class="s4">.</span><span class="s2">plugins</span><span class="s4">,</span>
                                <span class="s2">rules</span><span class="s4">: {</span>
                                    <span class="s4">[</span><span class="s2">ruleId</span><span class="s4">]: </span><span class="s2">ruleOptions</span>
                                <span class="s4">}</span>
                            <span class="s4">});</span>
                            <span class="s2">mergedInlineConfig</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">] = </span><span class="s2">ruleValue</span><span class="s4">;</span>
                        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>

                            <span class="s6">let </span><span class="s2">baseMessage </span><span class="s4">= </span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span>
                                <span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">startsWith</span><span class="s4">(</span><span class="s3">&quot;Key </span><span class="s6">\&quot;</span><span class="s3">rules</span><span class="s6">\&quot;</span><span class="s3">:&quot;</span><span class="s4">)</span>
                                    <span class="s4">? </span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s3">&quot;:&quot;</span><span class="s4">, </span><span class="s7">12</span><span class="s4">) + </span><span class="s7">1</span>
                                    <span class="s4">: </span><span class="s2">err</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">indexOf</span><span class="s4">(</span><span class="s3">&quot;:&quot;</span><span class="s4">) + </span><span class="s7">1</span>
                            <span class="s4">).</span><span class="s2">trim</span><span class="s4">();</span>

                            <span class="s6">if </span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">messageTemplate</span><span class="s4">) {</span>
                                <span class="s2">baseMessage </span><span class="s4">+= </span><span class="s3">` You passed &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleValue</span><span class="s4">}</span><span class="s3">&quot;.`</span><span class="s4">;</span>
                            <span class="s4">}</span>

                            <span class="s2">inlineConfigProblems</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">createLintingProblem</span><span class="s4">({</span>
                                <span class="s2">ruleId</span><span class="s4">,</span>
                                <span class="s2">message</span><span class="s4">: </span><span class="s3">`Inline configuration for rule &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">&quot; is invalid:</span><span class="s6">\n\t</span><span class="s2">$</span><span class="s4">{</span><span class="s2">baseMessage</span><span class="s4">}</span><span class="s6">\n</span><span class="s3">`</span><span class="s4">,</span>
                                <span class="s2">loc</span><span class="s4">: </span><span class="s2">node</span><span class="s4">.</span><span class="s2">loc</span>
                            <span class="s4">}));</span>
                        <span class="s4">}</span>
                    <span class="s4">});</span>
                <span class="s4">}</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">commentDirectives </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">allowInlineConfig </span><span class="s4">&amp;&amp; !</span><span class="s2">options</span><span class="s4">.</span><span class="s2">warnInlineConfig</span>
            <span class="s4">? </span><span class="s2">getDirectiveCommentsForFlatConfig</span><span class="s4">(</span>
                <span class="s2">sourceCode</span><span class="s4">,</span>
                <span class="s2">ruleId </span><span class="s4">=&gt; </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">)</span>
            <span class="s4">)</span>
            <span class="s4">: { </span><span class="s2">problems</span><span class="s4">: [], </span><span class="s2">disableDirectives</span><span class="s4">: [] };</span>

        <span class="s6">const </span><span class="s2">configuredRules </span><span class="s4">= </span><span class="s2">Object</span><span class="s4">.</span><span class="s2">assign</span><span class="s4">({}, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">, </span><span class="s2">mergedInlineConfig</span><span class="s4">.</span><span class="s2">rules</span><span class="s4">);</span>
        <span class="s6">let </span><span class="s2">lintingProblems</span><span class="s4">;</span>

        <span class="s2">sourceCode</span><span class="s4">.</span><span class="s2">finalize</span><span class="s4">();</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s2">lintingProblems </span><span class="s4">= </span><span class="s2">runRules</span><span class="s4">(</span>
                <span class="s2">sourceCode</span><span class="s4">,</span>
                <span class="s2">configuredRules</span><span class="s4">,</span>
                <span class="s2">ruleId </span><span class="s4">=&gt; </span><span class="s2">getRuleFromConfig</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">config</span><span class="s4">),</span>
                <span class="s6">void </span><span class="s7">0</span><span class="s4">,</span>
                <span class="s2">languageOptions</span><span class="s4">,</span>
                <span class="s2">settings</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">,</span>
                <span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes</span><span class="s4">,</span>
                <span class="s2">slots</span><span class="s4">.</span><span class="s2">cwd</span><span class="s4">,</span>
                <span class="s2">providedOptions</span><span class="s4">.</span><span class="s2">physicalFilename</span>
            <span class="s4">);</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">err</span><span class="s4">) {</span>
            <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`</span><span class="s6">\n</span><span class="s3">Occurred while linting </span><span class="s2">$</span><span class="s4">{</span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;An error occurred while traversing&quot;</span><span class="s4">);</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Filename:&quot;</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">);</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">currentNode</span><span class="s4">) {</span>
                <span class="s6">const </span><span class="s4">{ </span><span class="s2">line </span><span class="s4">} = </span><span class="s2">err</span><span class="s4">.</span><span class="s2">currentNode</span><span class="s4">.</span><span class="s2">loc</span><span class="s4">.</span><span class="s2">start</span><span class="s4">;</span>

                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Line:&quot;</span><span class="s4">, </span><span class="s2">line</span><span class="s4">);</span>
                <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`:</span><span class="s2">$</span><span class="s4">{</span><span class="s2">line</span><span class="s4">}</span><span class="s3">`</span><span class="s4">;</span>
            <span class="s4">}</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Parser Options:&quot;</span><span class="s4">, </span><span class="s2">languageOptions</span><span class="s4">.</span><span class="s2">parserOptions</span><span class="s4">);</span>

            <span class="s5">// debug(&quot;Parser Path:&quot;, parserName);</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Settings:&quot;</span><span class="s4">, </span><span class="s2">settings</span><span class="s4">);</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">err</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">) {</span>
                <span class="s2">err</span><span class="s4">.</span><span class="s2">message </span><span class="s4">+= </span><span class="s3">`</span><span class="s6">\n</span><span class="s3">Rule: &quot;</span><span class="s2">$</span><span class="s4">{</span><span class="s2">err</span><span class="s4">.</span><span class="s2">ruleId</span><span class="s4">}</span><span class="s3">&quot;`</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s6">throw </span><span class="s2">err</span><span class="s4">;</span>
        <span class="s4">}</span>

        <span class="s6">return </span><span class="s2">applyDisableDirectives</span><span class="s4">({</span>
            <span class="s2">directives</span><span class="s4">: </span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">disableDirectives</span><span class="s4">,</span>
            <span class="s2">disableFixes</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes</span><span class="s4">,</span>
            <span class="s2">problems</span><span class="s4">: </span><span class="s2">lintingProblems</span>
                <span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">commentDirectives</span><span class="s4">.</span><span class="s2">problems</span><span class="s4">)</span>
                <span class="s4">.</span><span class="s2">concat</span><span class="s4">(</span><span class="s2">inlineConfigProblems</span><span class="s4">)</span>
                <span class="s4">.</span><span class="s2">sort</span><span class="s4">((</span><span class="s2">problemA</span><span class="s4">, </span><span class="s2">problemB</span><span class="s4">) =&gt; </span><span class="s2">problemA</span><span class="s4">.</span><span class="s2">line </span><span class="s4">- </span><span class="s2">problemB</span><span class="s4">.</span><span class="s2">line </span><span class="s4">|| </span><span class="s2">problemA</span><span class="s4">.</span><span class="s2">column </span><span class="s4">- </span><span class="s2">problemB</span><span class="s4">.</span><span class="s2">column</span><span class="s4">),</span>
            <span class="s2">reportUnusedDisableDirectives</span><span class="s4">: </span><span class="s2">options</span><span class="s4">.</span><span class="s2">reportUnusedDisableDirectives</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Verify a given code with `ConfigArray`.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The source code.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigArray} configArray The config array.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions&amp;ProcessorOptions} options The options.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The found problems.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithConfigArray</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">configArray</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;With ConfigArray: %s&quot;</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">);</span>

        <span class="s5">// Store the config array in order to get plugin envs and rules later.</span>
        <span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">lastConfigArray </span><span class="s4">= </span><span class="s2">configArray</span><span class="s4">;</span>

        <span class="s5">// Extract the final config for this file.</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configArray</span><span class="s4">.</span><span class="s2">extractConfig</span><span class="s4">(</span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">processor </span><span class="s4">=</span>
            <span class="s2">config</span><span class="s4">.</span><span class="s2">processor </span><span class="s4">&amp;&amp;</span>
            <span class="s2">configArray</span><span class="s4">.</span><span class="s2">pluginProcessors</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">processor</span><span class="s4">);</span>

        <span class="s5">// Verify.</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">processor</span><span class="s4">) {</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Apply the processor: %o&quot;</span><span class="s4">, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">processor</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s4">{ </span><span class="s2">preprocess</span><span class="s4">, </span><span class="s2">postprocess</span><span class="s4">, </span><span class="s2">supportsAutofix </span><span class="s4">} = </span><span class="s2">processor</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">disableFixes </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes </span><span class="s4">|| !</span><span class="s2">supportsAutofix</span><span class="s4">;</span>

            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithProcessor</span><span class="s4">(</span>
                <span class="s2">textOrSourceCode</span><span class="s4">,</span>
                <span class="s2">config</span><span class="s4">,</span>
                <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">disableFixes</span><span class="s4">, </span><span class="s2">postprocess</span><span class="s4">, </span><span class="s2">preprocess </span><span class="s4">},</span>
                <span class="s2">configArray</span>
            <span class="s4">);</span>
        <span class="s4">}</span>
        <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithoutProcessors</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Verify a given code with a flat config.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The source code.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{FlatConfigArray} configArray The config array.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions&amp;ProcessorOptions} options The options.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{boolean} [firstCall=false] Indicates if this is being called directly</span>
     <span class="s0">*      from verify(). (TODO: Remove once eslintrc is removed.)</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The found problems.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithFlatConfigArray</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">configArray</span><span class="s4">, </span><span class="s2">options</span><span class="s4">, </span><span class="s2">firstCall </span><span class="s4">= </span><span class="s6">false</span><span class="s4">) {</span>
        <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;With flat config: %s&quot;</span><span class="s4">, </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">);</span>

        <span class="s5">// we need a filename to match configs against</span>
        <span class="s6">const </span><span class="s2">filename </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;__placeholder__.js&quot;</span><span class="s4">;</span>

        <span class="s5">// Store the config array in order to get plugin envs and rules later.</span>
        <span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">lastConfigArray </span><span class="s4">= </span><span class="s2">configArray</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">config </span><span class="s4">= </span><span class="s2">configArray</span><span class="s4">.</span><span class="s2">getConfig</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">);</span>

        <span class="s6">if </span><span class="s4">(!</span><span class="s2">config</span><span class="s4">) {</span>
            <span class="s6">return </span><span class="s4">[</span>
                <span class="s4">{</span>
                    <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                    <span class="s2">severity</span><span class="s4">: </span><span class="s7">1</span><span class="s4">,</span>
                    <span class="s2">message</span><span class="s4">: </span><span class="s3">`No matching configuration found for </span><span class="s2">$</span><span class="s4">{</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">.`</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s7">0</span><span class="s4">,</span>
                    <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
                <span class="s4">}</span>
            <span class="s4">];</span>
        <span class="s4">}</span>

        <span class="s5">// Verify.</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">config</span><span class="s4">.</span><span class="s2">processor</span><span class="s4">) {</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Apply the processor: %o&quot;</span><span class="s4">, </span><span class="s2">config</span><span class="s4">.</span><span class="s2">processor</span><span class="s4">);</span>
            <span class="s6">const </span><span class="s4">{ </span><span class="s2">preprocess</span><span class="s4">, </span><span class="s2">postprocess</span><span class="s4">, </span><span class="s2">supportsAutofix </span><span class="s4">} = </span><span class="s2">config</span><span class="s4">.</span><span class="s2">processor</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">disableFixes </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">disableFixes </span><span class="s4">|| !</span><span class="s2">supportsAutofix</span><span class="s4">;</span>

            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArrayAndProcessor</span><span class="s4">(</span>
                <span class="s2">textOrSourceCode</span><span class="s4">,</span>
                <span class="s2">config</span><span class="s4">,</span>
                <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">, </span><span class="s2">disableFixes</span><span class="s4">, </span><span class="s2">postprocess</span><span class="s4">, </span><span class="s2">preprocess </span><span class="s4">},</span>
                <span class="s2">configArray</span>
            <span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// check for options-based processing</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">firstCall </span><span class="s4">&amp;&amp; (</span><span class="s2">options</span><span class="s4">.</span><span class="s2">preprocess </span><span class="s4">|| </span><span class="s2">options</span><span class="s4">.</span><span class="s2">postprocess</span><span class="s4">)) {</span>
            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArrayAndProcessor</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithFlatConfigArrayAndWithoutProcessors</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Verify with a processor.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string|SourceCode} textOrSourceCode The source code.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData|ExtractedConfig} config The config array.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions&amp;ProcessorOptions} options The options.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigArray} [configForRecursive] The `ConfigArray` object to apply multiple processors recursively.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{(LintMessage|SuppressedLintMessage)[]} The found problems.</span>
     <span class="s0">*/</span>
    <span class="s2">_verifyWithProcessor</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">, </span><span class="s2">configForRecursive</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">filename </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;&lt;input&gt;&quot;</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">filenameToExpose </span><span class="s4">= </span><span class="s2">normalizeFilename</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">physicalFilename </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">physicalFilename </span><span class="s4">|| </span><span class="s2">filenameToExpose</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">text </span><span class="s4">= </span><span class="s2">ensureText</span><span class="s4">(</span><span class="s2">textOrSourceCode</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s2">preprocess </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">preprocess </span><span class="s4">|| (</span><span class="s2">rawText </span><span class="s4">=&gt; [</span><span class="s2">rawText</span><span class="s4">]);</span>
        <span class="s6">const </span><span class="s2">postprocess </span><span class="s4">= </span><span class="s2">options</span><span class="s4">.</span><span class="s2">postprocess </span><span class="s4">|| (</span><span class="s2">messagesList </span><span class="s4">=&gt; </span><span class="s2">messagesList</span><span class="s4">.</span><span class="s2">flat</span><span class="s4">());</span>
        <span class="s6">const </span><span class="s2">filterCodeBlock </span><span class="s4">=</span>
            <span class="s2">options</span><span class="s4">.</span><span class="s2">filterCodeBlock </span><span class="s4">||</span>
            <span class="s4">(</span><span class="s2">blockFilename </span><span class="s4">=&gt; </span><span class="s2">blockFilename</span><span class="s4">.</span><span class="s2">endsWith</span><span class="s4">(</span><span class="s3">&quot;.js&quot;</span><span class="s4">));</span>
        <span class="s6">const </span><span class="s2">originalExtname </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">extname</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">);</span>

        <span class="s6">let </span><span class="s2">blocks</span><span class="s4">;</span>

        <span class="s6">try </span><span class="s4">{</span>
            <span class="s2">blocks </span><span class="s4">= </span><span class="s2">preprocess</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">filenameToExpose</span><span class="s4">);</span>
        <span class="s4">} </span><span class="s6">catch </span><span class="s4">(</span><span class="s2">ex</span><span class="s4">) {</span>

            <span class="s5">// If the message includes a leading line number, strip it:</span>
            <span class="s6">const </span><span class="s2">message </span><span class="s4">= </span><span class="s3">`Preprocessing error: </span><span class="s2">$</span><span class="s4">{</span><span class="s2">ex</span><span class="s4">.</span><span class="s2">message</span><span class="s4">.</span><span class="s2">replace</span><span class="s4">(</span><span class="s8">/^line \d+:/iu</span><span class="s4">, </span><span class="s3">&quot;&quot;</span><span class="s4">).</span><span class="s2">trim</span><span class="s4">()}</span><span class="s3">`</span><span class="s4">;</span>

            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;%s</span><span class="s6">\n</span><span class="s3">%s&quot;</span><span class="s4">, </span><span class="s2">message</span><span class="s4">, </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">stack</span><span class="s4">);</span>

            <span class="s6">return </span><span class="s4">[</span>
                <span class="s4">{</span>
                    <span class="s2">ruleId</span><span class="s4">: </span><span class="s6">null</span><span class="s4">,</span>
                    <span class="s2">fatal</span><span class="s4">: </span><span class="s6">true</span><span class="s4">,</span>
                    <span class="s2">severity</span><span class="s4">: </span><span class="s7">2</span><span class="s4">,</span>
                    <span class="s2">message</span><span class="s4">,</span>
                    <span class="s2">line</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">lineNumber</span><span class="s4">,</span>
                    <span class="s2">column</span><span class="s4">: </span><span class="s2">ex</span><span class="s4">.</span><span class="s2">column</span><span class="s4">,</span>
                    <span class="s2">nodeType</span><span class="s4">: </span><span class="s6">null</span>
                <span class="s4">}</span>
            <span class="s4">];</span>
        <span class="s4">}</span>

        <span class="s6">const </span><span class="s2">messageLists </span><span class="s4">= </span><span class="s2">blocks</span><span class="s4">.</span><span class="s2">map</span><span class="s4">((</span><span class="s2">block</span><span class="s4">, </span><span class="s2">i</span><span class="s4">) =&gt; {</span>
            <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;A code block was found: %o&quot;</span><span class="s4">, </span><span class="s2">block</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">&quot;(unnamed)&quot;</span><span class="s4">);</span>

            <span class="s5">// Keep the legacy behavior.</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s6">typeof </span><span class="s2">block </span><span class="s4">=== </span><span class="s3">&quot;string&quot;</span><span class="s4">) {</span>
                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithoutProcessors</span><span class="s4">(</span><span class="s2">block</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s6">const </span><span class="s2">blockText </span><span class="s4">= </span><span class="s2">block</span><span class="s4">.</span><span class="s2">text</span><span class="s4">;</span>
            <span class="s6">const </span><span class="s2">blockName </span><span class="s4">= </span><span class="s2">path</span><span class="s4">.</span><span class="s2">join</span><span class="s4">(</span><span class="s2">filename</span><span class="s4">, </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">i</span><span class="s4">}</span><span class="s3">_</span><span class="s2">$</span><span class="s4">{</span><span class="s2">block</span><span class="s4">.</span><span class="s2">filename</span><span class="s4">}</span><span class="s3">`</span><span class="s4">);</span>

            <span class="s5">// Skip this block if filtered.</span>
            <span class="s6">if </span><span class="s4">(!</span><span class="s2">filterCodeBlock</span><span class="s4">(</span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">blockText</span><span class="s4">)) {</span>
                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;This code block was skipped.&quot;</span><span class="s4">);</span>
                <span class="s6">return </span><span class="s4">[];</span>
            <span class="s4">}</span>

            <span class="s5">// Resolve configuration again if the file content or extension was changed.</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">configForRecursive </span><span class="s4">&amp;&amp; (</span><span class="s2">text </span><span class="s4">!== </span><span class="s2">blockText </span><span class="s4">|| </span><span class="s2">path</span><span class="s4">.</span><span class="s2">extname</span><span class="s4">(</span><span class="s2">blockName</span><span class="s4">) !== </span><span class="s2">originalExtname</span><span class="s4">)) {</span>
                <span class="s2">debug</span><span class="s4">(</span><span class="s3">&quot;Resolving configuration again because the file content or extension was changed.&quot;</span><span class="s4">);</span>
                <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithConfigArray</span><span class="s4">(</span>
                    <span class="s2">blockText</span><span class="s4">,</span>
                    <span class="s2">configForRecursive</span><span class="s4">,</span>
                    <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">: </span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">physicalFilename </span><span class="s4">}</span>
                <span class="s4">);</span>
            <span class="s4">}</span>

            <span class="s5">// Does lint.</span>
            <span class="s6">return this</span><span class="s4">.</span><span class="s2">_verifyWithoutProcessors</span><span class="s4">(</span>
                <span class="s2">blockText</span><span class="s4">,</span>
                <span class="s2">config</span><span class="s4">,</span>
                <span class="s4">{ </span><span class="s2">...options</span><span class="s4">, </span><span class="s2">filename</span><span class="s4">: </span><span class="s2">blockName</span><span class="s4">, </span><span class="s2">physicalFilename </span><span class="s4">}</span>
            <span class="s4">);</span>
        <span class="s4">});</span>

        <span class="s6">return </span><span class="s2">postprocess</span><span class="s4">(</span><span class="s2">messageLists</span><span class="s4">, </span><span class="s2">filenameToExpose</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Given a list of reported problems, distinguish problems between normal messages and suppressed messages.</span>
     <span class="s0">* The normal messages will be returned and the suppressed messages will be stored as lastSuppressedMessages.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Array&lt;LintMessage|SuppressedLintMessage&gt;} problems A list of reported problems.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LintMessage[]} A list of LintMessage.</span>
     <span class="s0">*/</span>
    <span class="s2">_distinguishSuppressedMessages</span><span class="s4">(</span><span class="s2">problems</span><span class="s4">) {</span>
        <span class="s6">const </span><span class="s2">messages </span><span class="s4">= [];</span>
        <span class="s6">const </span><span class="s2">suppressedMessages </span><span class="s4">= [];</span>
        <span class="s6">const </span><span class="s2">slots </span><span class="s4">= </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>

        <span class="s6">for </span><span class="s4">(</span><span class="s6">const </span><span class="s2">problem of problems</span><span class="s4">) {</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">problem</span><span class="s4">.</span><span class="s2">suppressions</span><span class="s4">) {</span>
                <span class="s2">suppressedMessages</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">problem</span><span class="s4">);</span>
            <span class="s4">} </span><span class="s6">else </span><span class="s4">{</span>
                <span class="s2">messages</span><span class="s4">.</span><span class="s2">push</span><span class="s4">(</span><span class="s2">problem</span><span class="s4">);</span>
            <span class="s4">}</span>
        <span class="s4">}</span>

        <span class="s2">slots</span><span class="s4">.</span><span class="s2">lastSuppressedMessages </span><span class="s4">= </span><span class="s2">suppressedMessages</span><span class="s4">;</span>

        <span class="s6">return </span><span class="s2">messages</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Gets the SourceCode object representing the parsed source.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{SourceCode} The SourceCode object.</span>
     <span class="s0">*/</span>
    <span class="s2">getSourceCode</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">lastSourceCode</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Gets the list of SuppressedLintMessage produced in the last running.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{SuppressedLintMessage[]} The list of SuppressedLintMessage</span>
     <span class="s0">*/</span>
    <span class="s2">getSuppressedMessages</span><span class="s4">() {</span>
        <span class="s6">return </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">lastSuppressedMessages</span><span class="s4">;</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Defines a new linting rule.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} ruleId A unique rule identifier</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Function | Rule} ruleModule Function from context to object mapping AST node types to event handlers</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s2">defineRule</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleModule</span><span class="s4">) {</span>
        <span class="s2">assertEslintrcConfig</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">ruleMap</span><span class="s4">.</span><span class="s2">define</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">ruleModule</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Defines many new linting rules.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Record&lt;string, Function | Rule&gt;} rulesToDefine map from unique rule identifier to rule</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s2">defineRules</span><span class="s4">(</span><span class="s2">rulesToDefine</span><span class="s4">) {</span>
        <span class="s2">assertEslintrcConfig</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s2">Object</span><span class="s4">.</span><span class="s2">getOwnPropertyNames</span><span class="s4">(</span><span class="s2">rulesToDefine</span><span class="s4">).</span><span class="s2">forEach</span><span class="s4">(</span><span class="s2">ruleId </span><span class="s4">=&gt; {</span>
            <span class="s6">this</span><span class="s4">.</span><span class="s2">defineRule</span><span class="s4">(</span><span class="s2">ruleId</span><span class="s4">, </span><span class="s2">rulesToDefine</span><span class="s4">[</span><span class="s2">ruleId</span><span class="s4">]);</span>
        <span class="s4">});</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Gets an object with all loaded rules.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{Map&lt;string, Rule&gt;} All loaded rules</span>
     <span class="s0">*/</span>
    <span class="s2">getRules</span><span class="s4">() {</span>
        <span class="s2">assertEslintrcConfig</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s6">const </span><span class="s4">{ </span><span class="s2">lastConfigArray</span><span class="s4">, </span><span class="s2">ruleMap </span><span class="s4">} = </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>

        <span class="s6">return new </span><span class="s2">Map</span><span class="s4">(</span><span class="s6">function </span><span class="s4">*() {</span>
            <span class="s6">yield</span><span class="s4">* </span><span class="s2">ruleMap</span><span class="s4">;</span>

            <span class="s6">if </span><span class="s4">(</span><span class="s2">lastConfigArray</span><span class="s4">) {</span>
                <span class="s6">yield</span><span class="s4">* </span><span class="s2">lastConfigArray</span><span class="s4">.</span><span class="s2">pluginRules</span><span class="s4">;</span>
            <span class="s4">}</span>
        <span class="s4">}());</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Define a new parser module</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} parserId Name of the parser</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Parser} parserModule The parser object</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{void}</span>
     <span class="s0">*/</span>
    <span class="s2">defineParser</span><span class="s4">(</span><span class="s2">parserId</span><span class="s4">, </span><span class="s2">parserModule</span><span class="s4">) {</span>
        <span class="s2">assertEslintrcConfig</span><span class="s4">(</span><span class="s6">this</span><span class="s4">);</span>
        <span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s6">this</span><span class="s4">).</span><span class="s2">parserMap</span><span class="s4">.</span><span class="s2">set</span><span class="s4">(</span><span class="s2">parserId</span><span class="s4">, </span><span class="s2">parserModule</span><span class="s4">);</span>
    <span class="s4">}</span>

    <span class="s0">/**</span>
     <span class="s0">* Performs multiple autofix passes over the text until as many fixes as possible</span>
     <span class="s0">* have been applied.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{string} text The source text to apply fixes to.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{ConfigData|ConfigArray|FlatConfigArray} config The ESLint config object to use.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{VerifyOptions&amp;ProcessorOptions&amp;FixOptions} options The ESLint options object to use.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{{fixed:boolean,messages:LintMessage[],output:string}} The result of the fix operation as returned from the</span>
     <span class="s0">*      SourceCodeFixer.</span>
     <span class="s0">*/</span>
    <span class="s2">verifyAndFix</span><span class="s4">(</span><span class="s2">text</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">) {</span>
        <span class="s6">let </span><span class="s2">messages </span><span class="s4">= [],</span>
            <span class="s2">fixedResult</span><span class="s4">,</span>
            <span class="s2">fixed </span><span class="s4">= </span><span class="s6">false</span><span class="s4">,</span>
            <span class="s2">passNumber </span><span class="s4">= </span><span class="s7">0</span><span class="s4">,</span>
            <span class="s2">currentText </span><span class="s4">= </span><span class="s2">text</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">debugTextDescription </span><span class="s4">= </span><span class="s2">options </span><span class="s4">&amp;&amp; </span><span class="s2">options</span><span class="s4">.</span><span class="s2">filename </span><span class="s4">|| </span><span class="s3">`</span><span class="s2">$</span><span class="s4">{</span><span class="s2">text</span><span class="s4">.</span><span class="s2">slice</span><span class="s4">(</span><span class="s7">0</span><span class="s4">, </span><span class="s7">10</span><span class="s4">)}</span><span class="s3">...`</span><span class="s4">;</span>
        <span class="s6">const </span><span class="s2">shouldFix </span><span class="s4">= </span><span class="s2">options </span><span class="s4">&amp;&amp; </span><span class="s6">typeof </span><span class="s2">options</span><span class="s4">.</span><span class="s2">fix </span><span class="s4">!== </span><span class="s3">&quot;undefined&quot; </span><span class="s4">? </span><span class="s2">options</span><span class="s4">.</span><span class="s2">fix </span><span class="s4">: </span><span class="s6">true</span><span class="s4">;</span>

        <span class="s0">/**</span>
         <span class="s0">* This loop continues until one of the following is true:</span>
         <span class="s0">*</span>
         <span class="s0">* 1. No more fixes have been applied.</span>
         <span class="s0">* 2. Ten passes have been made.</span>
         <span class="s0">*</span>
         <span class="s0">* That means anytime a fix is successfully applied, there will be another pass.</span>
         <span class="s0">* Essentially, guaranteeing a minimum of two passes.</span>
         <span class="s0">*/</span>
        <span class="s6">do </span><span class="s4">{</span>
            <span class="s2">passNumber</span><span class="s4">++;</span>

            <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Linting code for </span><span class="s2">$</span><span class="s4">{</span><span class="s2">debugTextDescription</span><span class="s4">} </span><span class="s3">(pass </span><span class="s2">$</span><span class="s4">{</span><span class="s2">passNumber</span><span class="s4">}</span><span class="s3">)`</span><span class="s4">);</span>
            <span class="s2">messages </span><span class="s4">= </span><span class="s6">this</span><span class="s4">.</span><span class="s2">verify</span><span class="s4">(</span><span class="s2">currentText</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>

            <span class="s2">debug</span><span class="s4">(</span><span class="s3">`Generating fixed text for </span><span class="s2">$</span><span class="s4">{</span><span class="s2">debugTextDescription</span><span class="s4">} </span><span class="s3">(pass </span><span class="s2">$</span><span class="s4">{</span><span class="s2">passNumber</span><span class="s4">}</span><span class="s3">)`</span><span class="s4">);</span>
            <span class="s2">fixedResult </span><span class="s4">= </span><span class="s2">SourceCodeFixer</span><span class="s4">.</span><span class="s2">applyFixes</span><span class="s4">(</span><span class="s2">currentText</span><span class="s4">, </span><span class="s2">messages</span><span class="s4">, </span><span class="s2">shouldFix</span><span class="s4">);</span>

            <span class="s5">/* 
             * stop if there are any syntax errors. 
             * 'fixedResult.output' is a empty string. 
             */</span>
            <span class="s6">if </span><span class="s4">(</span><span class="s2">messages</span><span class="s4">.</span><span class="s2">length </span><span class="s4">=== </span><span class="s7">1 </span><span class="s4">&amp;&amp; </span><span class="s2">messages</span><span class="s4">[</span><span class="s7">0</span><span class="s4">].</span><span class="s2">fatal</span><span class="s4">) {</span>
                <span class="s6">break</span><span class="s4">;</span>
            <span class="s4">}</span>

            <span class="s5">// keep track if any fixes were ever applied - important for return value</span>
            <span class="s2">fixed </span><span class="s4">= </span><span class="s2">fixed </span><span class="s4">|| </span><span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">fixed</span><span class="s4">;</span>

            <span class="s5">// update to use the fixed output instead of the original text</span>
            <span class="s2">currentText </span><span class="s4">= </span><span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">output</span><span class="s4">;</span>

        <span class="s4">} </span><span class="s6">while </span><span class="s4">(</span>
            <span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">fixed </span><span class="s4">&amp;&amp;</span>
            <span class="s2">passNumber </span><span class="s4">&lt; </span><span class="s2">MAX_AUTOFIX_PASSES</span>
        <span class="s4">);</span>

        <span class="s5">/* 
         * If the last result had fixes, we need to lint again to be sure we have 
         * the most up-to-date information. 
         */</span>
        <span class="s6">if </span><span class="s4">(</span><span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">fixed</span><span class="s4">) {</span>
            <span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">messages </span><span class="s4">= </span><span class="s6">this</span><span class="s4">.</span><span class="s2">verify</span><span class="s4">(</span><span class="s2">currentText</span><span class="s4">, </span><span class="s2">config</span><span class="s4">, </span><span class="s2">options</span><span class="s4">);</span>
        <span class="s4">}</span>

        <span class="s5">// ensure the last result properly reflects if fixes were done</span>
        <span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">fixed </span><span class="s4">= </span><span class="s2">fixed</span><span class="s4">;</span>
        <span class="s2">fixedResult</span><span class="s4">.</span><span class="s2">output </span><span class="s4">= </span><span class="s2">currentText</span><span class="s4">;</span>

        <span class="s6">return </span><span class="s2">fixedResult</span><span class="s4">;</span>
    <span class="s4">}</span>
<span class="s4">}</span>

<span class="s2">module</span><span class="s4">.</span><span class="s2">exports </span><span class="s4">= {</span>
    <span class="s2">Linter</span><span class="s4">,</span>

    <span class="s0">/**</span>
     <span class="s0">* Get the internal slots of a given Linter instance for tests.</span>
     <span class="s0">* </span><span class="s1">@param </span><span class="s0">{Linter} instance The Linter instance to get.</span>
     <span class="s0">* </span><span class="s1">@returns </span><span class="s0">{LinterInternalSlots} The internal slots.</span>
     <span class="s0">*/</span>
    <span class="s2">getLinterInternalSlots</span><span class="s4">(</span><span class="s2">instance</span><span class="s4">) {</span>
        <span class="s6">return </span><span class="s2">internalSlotsMap</span><span class="s4">.</span><span class="s2">get</span><span class="s4">(</span><span class="s2">instance</span><span class="s4">);</span>
    <span class="s4">}</span>
<span class="s4">};</span>
</pre>
</body>
</html>