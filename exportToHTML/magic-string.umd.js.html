<html>
<head>
<title>magic-string.umd.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #7a7e85;}
.s6 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
magic-string.umd.js</font>
</center></td></tr></table>
<pre><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">global</span><span class="s0">, </span><span class="s2">factory</span><span class="s0">) {</span>
	<span class="s1">typeof </span><span class="s2">exports </span><span class="s0">=== </span><span class="s3">'object' </span><span class="s0">&amp;&amp; </span><span class="s1">typeof </span><span class="s2">module </span><span class="s0">!== </span><span class="s3">'undefined' </span><span class="s0">? </span><span class="s2">module</span><span class="s0">.</span><span class="s2">exports </span><span class="s0">= </span><span class="s2">factory</span><span class="s0">() :</span>
	<span class="s1">typeof </span><span class="s2">define </span><span class="s0">=== </span><span class="s3">'function' </span><span class="s0">&amp;&amp; </span><span class="s2">define</span><span class="s0">.</span><span class="s2">amd </span><span class="s0">? </span><span class="s2">define</span><span class="s0">(</span><span class="s2">factory</span><span class="s0">) :</span>
	<span class="s0">(</span><span class="s2">global </span><span class="s0">= </span><span class="s1">typeof </span><span class="s2">globalThis </span><span class="s0">!== </span><span class="s3">'undefined' </span><span class="s0">? </span><span class="s2">globalThis </span><span class="s0">: </span><span class="s2">global </span><span class="s0">|| </span><span class="s2">self</span><span class="s0">, </span><span class="s2">global</span><span class="s0">.</span><span class="s2">MagicString </span><span class="s0">= </span><span class="s2">factory</span><span class="s0">());</span>
<span class="s0">})(</span><span class="s1">this</span><span class="s0">, (</span><span class="s1">function </span><span class="s0">() { </span><span class="s3">'use strict'</span><span class="s0">;</span>

	<span class="s1">var </span><span class="s2">BitSet </span><span class="s0">= </span><span class="s1">function </span><span class="s2">BitSet</span><span class="s0">(</span><span class="s2">arg</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">bits </span><span class="s0">= </span><span class="s2">arg </span><span class="s1">instanceof </span><span class="s2">BitSet </span><span class="s0">? </span><span class="s2">arg</span><span class="s0">.</span><span class="s2">bits</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">() : [];</span>
	<span class="s0">};</span>

	<span class="s2">BitSet</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">add </span><span class="s0">= </span><span class="s1">function </span><span class="s2">add </span><span class="s0">(</span><span class="s2">n</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">bits</span><span class="s0">[</span><span class="s2">n </span><span class="s0">&gt;&gt; </span><span class="s4">5</span><span class="s0">] |= </span><span class="s4">1 </span><span class="s0">&lt;&lt; (</span><span class="s2">n </span><span class="s0">&amp; </span><span class="s4">31</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">BitSet</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">has </span><span class="s0">= </span><span class="s1">function </span><span class="s2">has </span><span class="s0">(</span><span class="s2">n</span><span class="s0">) {</span>
		<span class="s1">return </span><span class="s0">!!(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">bits</span><span class="s0">[</span><span class="s2">n </span><span class="s0">&gt;&gt; </span><span class="s4">5</span><span class="s0">] &amp; (</span><span class="s4">1 </span><span class="s0">&lt;&lt; (</span><span class="s2">n </span><span class="s0">&amp; </span><span class="s4">31</span><span class="s0">)));</span>
	<span class="s0">};</span>

	<span class="s1">var </span><span class="s2">Chunk </span><span class="s0">= </span><span class="s1">function </span><span class="s2">Chunk</span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">start </span><span class="s0">= </span><span class="s2">start</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">end </span><span class="s0">= </span><span class="s2">end</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">original </span><span class="s0">= </span><span class="s2">content</span><span class="s0">;</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s2">content</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">= </span><span class="s1">false</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">= </span><span class="s1">false</span><span class="s0">;</span>

		<span class="s5">// we make these non-enumerable, for sanity while debugging</span>
		<span class="s2">Object</span><span class="s0">.</span><span class="s2">defineProperties</span><span class="s0">(</span><span class="s1">this</span><span class="s0">, {</span>
			<span class="s2">previous</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s1">null </span><span class="s0">},</span>
			<span class="s2">next</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s1">null </span><span class="s0">},</span>
		<span class="s0">});</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">appendLeft </span><span class="s0">= </span><span class="s1">function </span><span class="s2">appendLeft </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">+= </span><span class="s2">content</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">appendRight </span><span class="s0">= </span><span class="s1">function </span><span class="s2">appendRight </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+ </span><span class="s2">content</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">clone </span><span class="s0">= </span><span class="s1">function </span><span class="s2">clone </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Chunk</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">start</span><span class="s0">, </span><span class="s1">this</span><span class="s0">.</span><span class="s2">end</span><span class="s0">, </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">);</span>

		<span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
		<span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
		<span class="s2">chunk</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content</span><span class="s0">;</span>
		<span class="s2">chunk</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">storeName</span><span class="s0">;</span>
		<span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">edited</span><span class="s0">;</span>

		<span class="s1">return </span><span class="s2">chunk</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">contains </span><span class="s0">= </span><span class="s1">function </span><span class="s2">contains </span><span class="s0">(</span><span class="s2">index</span><span class="s0">) {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s2">index </span><span class="s0">&amp;&amp; </span><span class="s2">index </span><span class="s0">&lt; </span><span class="s1">this</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">eachNext </span><span class="s0">= </span><span class="s1">function </span><span class="s2">eachNext </span><span class="s0">(</span><span class="s2">fn</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">fn</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">);</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">}</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">eachPrevious </span><span class="s0">= </span><span class="s1">function </span><span class="s2">eachPrevious </span><span class="s0">(</span><span class="s2">fn</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">fn</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">);</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">;</span>
		<span class="s0">}</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">edit </span><span class="s0">= </span><span class="s1">function </span><span class="s2">edit </span><span class="s0">(</span><span class="s2">content</span><span class="s0">, </span><span class="s2">storeName</span><span class="s0">, </span><span class="s2">contentOnly</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s2">content</span><span class="s0">;</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">contentOnly</span><span class="s0">) {</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">= </span><span class="s2">storeName</span><span class="s0">;</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prependLeft </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prependLeft </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prependRight </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prependRight </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">split </span><span class="s0">= </span><span class="s1">function </span><span class="s2">split </span><span class="s0">(</span><span class="s2">index</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">sliceIndex </span><span class="s0">= </span><span class="s2">index </span><span class="s0">- </span><span class="s1">this</span><span class="s0">.</span><span class="s2">start</span><span class="s0">;</span>

		<span class="s1">var </span><span class="s2">originalBefore </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">(</span><span class="s4">0</span><span class="s0">, </span><span class="s2">sliceIndex</span><span class="s0">);</span>
		<span class="s1">var </span><span class="s2">originalAfter </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">(</span><span class="s2">sliceIndex</span><span class="s0">);</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">original </span><span class="s0">= </span><span class="s2">originalBefore</span><span class="s0">;</span>

		<span class="s1">var </span><span class="s2">newChunk </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Chunk</span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s1">this</span><span class="s0">.</span><span class="s2">end</span><span class="s0">, </span><span class="s2">originalAfter</span><span class="s0">);</span>
		<span class="s2">newChunk</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">end </span><span class="s0">= </span><span class="s2">index</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">edited</span><span class="s0">) {</span>
			<span class="s5">// TODO is this block necessary?...</span>
			<span class="s2">newChunk</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s1">false</span><span class="s0">);</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s2">originalBefore</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s2">newChunk</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">newChunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">) { </span><span class="s2">newChunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">newChunk</span><span class="s0">; }</span>
		<span class="s2">newChunk</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">newChunk</span><span class="s0">;</span>

		<span class="s1">return </span><span class="s2">newChunk</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">toString </span><span class="s0">() {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimEnd </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimEnd </span><span class="s0">(</span><span class="s2">rx</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">trimmed </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">trimmed</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">trimmed </span><span class="s0">!== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content</span><span class="s0">) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">start </span><span class="s0">+ </span><span class="s2">trimmed</span><span class="s0">.</span><span class="s2">length</span><span class="s0">).</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s2">undefined</span><span class="s0">, </span><span class="s1">true</span><span class="s0">);</span>
			<span class="s0">}</span>
			<span class="s1">return true</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s2">undefined</span><span class="s0">, </span><span class="s1">true</span><span class="s0">);</span>

			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>
		<span class="s0">}</span>
	<span class="s0">};</span>

	<span class="s2">Chunk</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimStart </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimStart </span><span class="s0">(</span><span class="s2">rx</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">trimmed </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">trimmed</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">trimmed </span><span class="s0">!== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">content</span><span class="s0">) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">end </span><span class="s0">- </span><span class="s2">trimmed</span><span class="s0">.</span><span class="s2">length</span><span class="s0">);</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s2">undefined</span><span class="s0">, </span><span class="s1">true</span><span class="s0">);</span>
			<span class="s0">}</span>
			<span class="s1">return true</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s2">undefined</span><span class="s0">, </span><span class="s1">true</span><span class="s0">);</span>

			<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>
		<span class="s0">}</span>
	<span class="s0">};</span>

	<span class="s1">var </span><span class="s2">charToInteger </span><span class="s0">= {};</span>
	<span class="s1">var </span><span class="s2">chars </span><span class="s0">= </span><span class="s3">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/='</span><span class="s0">;</span>
	<span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">chars</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; </span><span class="s2">i</span><span class="s0">++) {</span>
	    <span class="s2">charToInteger</span><span class="s0">[</span><span class="s2">chars</span><span class="s0">.</span><span class="s2">charCodeAt</span><span class="s0">(</span><span class="s2">i</span><span class="s0">)] = </span><span class="s2">i</span><span class="s0">;</span>
	<span class="s0">}</span>
	<span class="s1">function </span><span class="s2">encode</span><span class="s0">(</span><span class="s2">decoded</span><span class="s0">) {</span>
	    <span class="s1">var </span><span class="s2">sourceFileIndex </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s5">// second field</span>
	    <span class="s1">var </span><span class="s2">sourceCodeLine </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s5">// third field</span>
	    <span class="s1">var </span><span class="s2">sourceCodeColumn </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s5">// fourth field</span>
	    <span class="s1">var </span><span class="s2">nameIndex </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s5">// fifth field</span>
	    <span class="s1">var </span><span class="s2">mappings </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
	    <span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">decoded</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; </span><span class="s2">i</span><span class="s0">++) {</span>
	        <span class="s1">var </span><span class="s2">line </span><span class="s0">= </span><span class="s2">decoded</span><span class="s0">[</span><span class="s2">i</span><span class="s0">];</span>
	        <span class="s1">if </span><span class="s0">(</span><span class="s2">i </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">)</span>
	            <span class="s2">mappings </span><span class="s0">+= </span><span class="s3">';'</span><span class="s0">;</span>
	        <span class="s1">if </span><span class="s0">(</span><span class="s2">line</span><span class="s0">.</span><span class="s2">length </span><span class="s0">=== </span><span class="s4">0</span><span class="s0">)</span>
	            <span class="s1">continue</span><span class="s0">;</span>
	        <span class="s1">var </span><span class="s2">generatedCodeColumn </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s5">// first field</span>
	        <span class="s1">var </span><span class="s2">lineMappings </span><span class="s0">= [];</span>
	        <span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">_i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">, </span><span class="s2">line_1 </span><span class="s0">= </span><span class="s2">line</span><span class="s0">; </span><span class="s2">_i </span><span class="s0">&lt; </span><span class="s2">line_1</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; </span><span class="s2">_i</span><span class="s0">++) {</span>
	            <span class="s1">var </span><span class="s2">segment </span><span class="s0">= </span><span class="s2">line_1</span><span class="s0">[</span><span class="s2">_i</span><span class="s0">];</span>
	            <span class="s1">var </span><span class="s2">segmentMappings </span><span class="s0">= </span><span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">[</span><span class="s4">0</span><span class="s0">] - </span><span class="s2">generatedCodeColumn</span><span class="s0">);</span>
	            <span class="s2">generatedCodeColumn </span><span class="s0">= </span><span class="s2">segment</span><span class="s0">[</span><span class="s4">0</span><span class="s0">];</span>
	            <span class="s1">if </span><span class="s0">(</span><span class="s2">segment</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt; </span><span class="s4">1</span><span class="s0">) {</span>
	                <span class="s2">segmentMappings </span><span class="s0">+=</span>
	                    <span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">[</span><span class="s4">1</span><span class="s0">] - </span><span class="s2">sourceFileIndex</span><span class="s0">) +</span>
	                        <span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">[</span><span class="s4">2</span><span class="s0">] - </span><span class="s2">sourceCodeLine</span><span class="s0">) +</span>
	                        <span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">[</span><span class="s4">3</span><span class="s0">] - </span><span class="s2">sourceCodeColumn</span><span class="s0">);</span>
	                <span class="s2">sourceFileIndex </span><span class="s0">= </span><span class="s2">segment</span><span class="s0">[</span><span class="s4">1</span><span class="s0">];</span>
	                <span class="s2">sourceCodeLine </span><span class="s0">= </span><span class="s2">segment</span><span class="s0">[</span><span class="s4">2</span><span class="s0">];</span>
	                <span class="s2">sourceCodeColumn </span><span class="s0">= </span><span class="s2">segment</span><span class="s0">[</span><span class="s4">3</span><span class="s0">];</span>
	            <span class="s0">}</span>
	            <span class="s1">if </span><span class="s0">(</span><span class="s2">segment</span><span class="s0">.</span><span class="s2">length </span><span class="s0">=== </span><span class="s4">5</span><span class="s0">) {</span>
	                <span class="s2">segmentMappings </span><span class="s0">+= </span><span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">[</span><span class="s4">4</span><span class="s0">] - </span><span class="s2">nameIndex</span><span class="s0">);</span>
	                <span class="s2">nameIndex </span><span class="s0">= </span><span class="s2">segment</span><span class="s0">[</span><span class="s4">4</span><span class="s0">];</span>
	            <span class="s0">}</span>
	            <span class="s2">lineMappings</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">segmentMappings</span><span class="s0">);</span>
	        <span class="s0">}</span>
	        <span class="s2">mappings </span><span class="s0">+= </span><span class="s2">lineMappings</span><span class="s0">.</span><span class="s2">join</span><span class="s0">(</span><span class="s3">','</span><span class="s0">);</span>
	    <span class="s0">}</span>
	    <span class="s1">return </span><span class="s2">mappings</span><span class="s0">;</span>
	<span class="s0">}</span>
	<span class="s1">function </span><span class="s2">encodeInteger</span><span class="s0">(</span><span class="s2">num</span><span class="s0">) {</span>
	    <span class="s1">var </span><span class="s2">result </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
	    <span class="s2">num </span><span class="s0">= </span><span class="s2">num </span><span class="s0">&lt; </span><span class="s4">0 </span><span class="s0">? (-</span><span class="s2">num </span><span class="s0">&lt;&lt; </span><span class="s4">1</span><span class="s0">) | </span><span class="s4">1 </span><span class="s0">: </span><span class="s2">num </span><span class="s0">&lt;&lt; </span><span class="s4">1</span><span class="s0">;</span>
	    <span class="s1">do </span><span class="s0">{</span>
	        <span class="s1">var </span><span class="s2">clamped </span><span class="s0">= </span><span class="s2">num </span><span class="s0">&amp; </span><span class="s4">31</span><span class="s0">;</span>
	        <span class="s2">num </span><span class="s0">&gt;&gt;&gt;= </span><span class="s4">5</span><span class="s0">;</span>
	        <span class="s1">if </span><span class="s0">(</span><span class="s2">num </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">) {</span>
	            <span class="s2">clamped </span><span class="s0">|= </span><span class="s4">32</span><span class="s0">;</span>
	        <span class="s0">}</span>
	        <span class="s2">result </span><span class="s0">+= </span><span class="s2">chars</span><span class="s0">[</span><span class="s2">clamped</span><span class="s0">];</span>
	    <span class="s0">} </span><span class="s1">while </span><span class="s0">(</span><span class="s2">num </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">);</span>
	    <span class="s1">return </span><span class="s2">result</span><span class="s0">;</span>
	<span class="s0">}</span>

	<span class="s1">var </span><span class="s2">btoa </span><span class="s0">= </span><span class="s1">function </span><span class="s0">() {</span>
		<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'Unsupported environment: `window.btoa` or `Buffer` should be supported.'</span><span class="s0">);</span>
	<span class="s0">};</span>
	<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">window </span><span class="s0">!== </span><span class="s3">'undefined' </span><span class="s0">&amp;&amp; </span><span class="s1">typeof </span><span class="s2">window</span><span class="s0">.</span><span class="s2">btoa </span><span class="s0">=== </span><span class="s3">'function'</span><span class="s0">) {</span>
		<span class="s2">btoa </span><span class="s0">= </span><span class="s1">function </span><span class="s0">(</span><span class="s2">str</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">window</span><span class="s0">.</span><span class="s2">btoa</span><span class="s0">(</span><span class="s2">unescape</span><span class="s0">(</span><span class="s2">encodeURIComponent</span><span class="s0">(</span><span class="s2">str</span><span class="s0">))); };</span>
	<span class="s0">} </span><span class="s1">else if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">Buffer </span><span class="s0">=== </span><span class="s3">'function'</span><span class="s0">) {</span>
		<span class="s2">btoa </span><span class="s0">= </span><span class="s1">function </span><span class="s0">(</span><span class="s2">str</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">Buffer</span><span class="s0">.</span><span class="s2">from</span><span class="s0">(</span><span class="s2">str</span><span class="s0">, </span><span class="s3">'utf-8'</span><span class="s0">).</span><span class="s2">toString</span><span class="s0">(</span><span class="s3">'base64'</span><span class="s0">); };</span>
	<span class="s0">}</span>

	<span class="s1">var </span><span class="s2">SourceMap </span><span class="s0">= </span><span class="s1">function </span><span class="s2">SourceMap</span><span class="s0">(</span><span class="s2">properties</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">version </span><span class="s0">= </span><span class="s4">3</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">file </span><span class="s0">= </span><span class="s2">properties</span><span class="s0">.</span><span class="s2">file</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources </span><span class="s0">= </span><span class="s2">properties</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">sourcesContent </span><span class="s0">= </span><span class="s2">properties</span><span class="s0">.</span><span class="s2">sourcesContent</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">names </span><span class="s0">= </span><span class="s2">properties</span><span class="s0">.</span><span class="s2">names</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">mappings </span><span class="s0">= </span><span class="s2">encode</span><span class="s0">(</span><span class="s2">properties</span><span class="s0">.</span><span class="s2">mappings</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">SourceMap</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">toString </span><span class="s0">() {</span>
		<span class="s1">return </span><span class="s2">JSON</span><span class="s0">.</span><span class="s2">stringify</span><span class="s0">(</span><span class="s1">this</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">SourceMap</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toUrl </span><span class="s0">= </span><span class="s1">function </span><span class="s2">toUrl </span><span class="s0">() {</span>
		<span class="s1">return </span><span class="s3">'data:application/json;charset=utf-8;base64,' </span><span class="s0">+ </span><span class="s2">btoa</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">toString</span><span class="s0">());</span>
	<span class="s0">};</span>

	<span class="s1">function </span><span class="s2">guessIndent</span><span class="s0">(</span><span class="s2">code</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">lines </span><span class="s0">= </span><span class="s2">code</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">tabbed </span><span class="s0">= </span><span class="s2">lines</span><span class="s0">.</span><span class="s2">filter</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">line</span><span class="s0">) { </span><span class="s1">return </span><span class="s6">/^\t+/</span><span class="s0">.</span><span class="s2">test</span><span class="s0">(</span><span class="s2">line</span><span class="s0">); });</span>
		<span class="s1">var </span><span class="s2">spaced </span><span class="s0">= </span><span class="s2">lines</span><span class="s0">.</span><span class="s2">filter</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">line</span><span class="s0">) { </span><span class="s1">return </span><span class="s6">/^ {2,}/</span><span class="s0">.</span><span class="s2">test</span><span class="s0">(</span><span class="s2">line</span><span class="s0">); });</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">tabbed</span><span class="s0">.</span><span class="s2">length </span><span class="s0">=== </span><span class="s4">0 </span><span class="s0">&amp;&amp; </span><span class="s2">spaced</span><span class="s0">.</span><span class="s2">length </span><span class="s0">=== </span><span class="s4">0</span><span class="s0">) {</span>
			<span class="s1">return null</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s5">// More lines tabbed than spaced? Assume tabs, and</span>
		<span class="s5">// default to tabs in the case of a tie (or nothing</span>
		<span class="s5">// to go on)</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">tabbed</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt;= </span><span class="s2">spaced</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s1">return </span><span class="s3">'</span><span class="s1">\t</span><span class="s3">'</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s5">// Otherwise, we need to guess the multiple</span>
		<span class="s1">var </span><span class="s2">min </span><span class="s0">= </span><span class="s2">spaced</span><span class="s0">.</span><span class="s2">reduce</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">previous</span><span class="s0">, </span><span class="s2">current</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">numSpaces </span><span class="s0">= </span><span class="s6">/^ +/</span><span class="s0">.</span><span class="s2">exec</span><span class="s0">(</span><span class="s2">current</span><span class="s0">)[</span><span class="s4">0</span><span class="s0">].</span><span class="s2">length</span><span class="s0">;</span>
			<span class="s1">return </span><span class="s2">Math</span><span class="s0">.</span><span class="s2">min</span><span class="s0">(</span><span class="s2">numSpaces</span><span class="s0">, </span><span class="s2">previous</span><span class="s0">);</span>
		<span class="s0">}, </span><span class="s2">Infinity</span><span class="s0">);</span>

		<span class="s1">return new </span><span class="s2">Array</span><span class="s0">(</span><span class="s2">min </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">).</span><span class="s2">join</span><span class="s0">(</span><span class="s3">' '</span><span class="s0">);</span>
	<span class="s0">}</span>

	<span class="s1">function </span><span class="s2">getRelativePath</span><span class="s0">(</span><span class="s2">from</span><span class="s0">, </span><span class="s2">to</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">fromParts </span><span class="s0">= </span><span class="s2">from</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s6">/[/\\]/</span><span class="s0">);</span>
		<span class="s1">var </span><span class="s2">toParts </span><span class="s0">= </span><span class="s2">to</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s6">/[/\\]/</span><span class="s0">);</span>

		<span class="s2">fromParts</span><span class="s0">.</span><span class="s2">pop</span><span class="s0">(); </span><span class="s5">// get dirname</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">fromParts</span><span class="s0">[</span><span class="s4">0</span><span class="s0">] === </span><span class="s2">toParts</span><span class="s0">[</span><span class="s4">0</span><span class="s0">]) {</span>
			<span class="s2">fromParts</span><span class="s0">.</span><span class="s2">shift</span><span class="s0">();</span>
			<span class="s2">toParts</span><span class="s0">.</span><span class="s2">shift</span><span class="s0">();</span>
		<span class="s0">}</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">fromParts</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s2">fromParts</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>
			<span class="s1">while </span><span class="s0">(</span><span class="s2">i</span><span class="s0">--) { </span><span class="s2">fromParts</span><span class="s0">[</span><span class="s2">i</span><span class="s0">] = </span><span class="s3">'..'</span><span class="s0">; }</span>
		<span class="s0">}</span>

		<span class="s1">return </span><span class="s2">fromParts</span><span class="s0">.</span><span class="s2">concat</span><span class="s0">(</span><span class="s2">toParts</span><span class="s0">).</span><span class="s2">join</span><span class="s0">(</span><span class="s3">'/'</span><span class="s0">);</span>
	<span class="s0">}</span>

	<span class="s1">var </span><span class="s2">toString </span><span class="s0">= </span><span class="s2">Object</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toString</span><span class="s0">;</span>

	<span class="s1">function </span><span class="s2">isObject</span><span class="s0">(</span><span class="s2">thing</span><span class="s0">) {</span>
		<span class="s1">return </span><span class="s2">toString</span><span class="s0">.</span><span class="s2">call</span><span class="s0">(</span><span class="s2">thing</span><span class="s0">) === </span><span class="s3">'[object Object]'</span><span class="s0">;</span>
	<span class="s0">}</span>

	<span class="s1">function </span><span class="s2">getLocator</span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">originalLines </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">);</span>
		<span class="s1">var </span><span class="s2">lineOffsets </span><span class="s0">= [];</span>

		<span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">, </span><span class="s2">pos </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">originalLines</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; </span><span class="s2">i</span><span class="s0">++) {</span>
			<span class="s2">lineOffsets</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">pos</span><span class="s0">);</span>
			<span class="s2">pos </span><span class="s0">+= </span><span class="s2">originalLines</span><span class="s0">[</span><span class="s2">i</span><span class="s0">].</span><span class="s2">length </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">return function </span><span class="s2">locate</span><span class="s0">(</span><span class="s2">index</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">j </span><span class="s0">= </span><span class="s2">lineOffsets</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>
			<span class="s1">while </span><span class="s0">(</span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">j</span><span class="s0">) {</span>
				<span class="s1">var </span><span class="s2">m </span><span class="s0">= (</span><span class="s2">i </span><span class="s0">+ </span><span class="s2">j</span><span class="s0">) &gt;&gt; </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">index </span><span class="s0">&lt; </span><span class="s2">lineOffsets</span><span class="s0">[</span><span class="s2">m</span><span class="s0">]) {</span>
					<span class="s2">j </span><span class="s0">= </span><span class="s2">m</span><span class="s0">;</span>
				<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
					<span class="s2">i </span><span class="s0">= </span><span class="s2">m </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s0">}</span>
			<span class="s0">}</span>
			<span class="s1">var </span><span class="s2">line </span><span class="s0">= </span><span class="s2">i </span><span class="s0">- </span><span class="s4">1</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">column </span><span class="s0">= </span><span class="s2">index </span><span class="s0">- </span><span class="s2">lineOffsets</span><span class="s0">[</span><span class="s2">line</span><span class="s0">];</span>
			<span class="s1">return </span><span class="s0">{ </span><span class="s2">line</span><span class="s0">: </span><span class="s2">line</span><span class="s0">, </span><span class="s2">column</span><span class="s0">: </span><span class="s2">column </span><span class="s0">};</span>
		<span class="s0">};</span>
	<span class="s0">}</span>

	<span class="s1">var </span><span class="s2">Mappings </span><span class="s0">= </span><span class="s1">function </span><span class="s2">Mappings</span><span class="s0">(</span><span class="s2">hires</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">hires </span><span class="s0">= </span><span class="s2">hires</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">raw </span><span class="s0">= [];</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">raw</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine</span><span class="s0">] = [];</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">pending </span><span class="s0">= </span><span class="s1">null</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Mappings</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">addEdit </span><span class="s0">= </span><span class="s1">function </span><span class="s2">addEdit </span><span class="s0">(</span><span class="s2">sourceIndex</span><span class="s0">, </span><span class="s2">content</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">, </span><span class="s2">nameIndex</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">segment </span><span class="s0">= [</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn</span><span class="s0">, </span><span class="s2">sourceIndex</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">.</span><span class="s2">line</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">.</span><span class="s2">column</span><span class="s0">];</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">nameIndex </span><span class="s0">&gt;= </span><span class="s4">0</span><span class="s0">) {</span>
				<span class="s2">segment</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">nameIndex</span><span class="s0">);</span>
			<span class="s0">}</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">segment</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">pending</span><span class="s0">) {</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">pending</span><span class="s0">);</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">content</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">pending </span><span class="s0">= </span><span class="s1">null</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Mappings</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">addUneditedChunk </span><span class="s0">= </span><span class="s1">function </span><span class="s2">addUneditedChunk </span><span class="s0">(</span><span class="s2">sourceIndex</span><span class="s0">, </span><span class="s2">chunk</span><span class="s0">, </span><span class="s2">original</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">, </span><span class="s2">sourcemapLocations</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">originalCharIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">first </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">originalCharIndex </span><span class="s0">&lt; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">hires </span><span class="s0">|| </span><span class="s2">first </span><span class="s0">|| </span><span class="s2">sourcemapLocations</span><span class="s0">.</span><span class="s2">has</span><span class="s0">(</span><span class="s2">originalCharIndex</span><span class="s0">)) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments</span><span class="s0">.</span><span class="s2">push</span><span class="s0">([</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn</span><span class="s0">, </span><span class="s2">sourceIndex</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">.</span><span class="s2">line</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">.</span><span class="s2">column</span><span class="s0">]);</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">original</span><span class="s0">[</span><span class="s2">originalCharIndex</span><span class="s0">] === </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">) {</span>
				<span class="s2">loc</span><span class="s0">.</span><span class="s2">line </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s2">loc</span><span class="s0">.</span><span class="s2">column </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">raw</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine</span><span class="s0">] = </span><span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments </span><span class="s0">= [];</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
				<span class="s2">first </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
			<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
				<span class="s2">loc</span><span class="s0">.</span><span class="s2">column </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s2">first </span><span class="s0">= </span><span class="s1">false</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s2">originalCharIndex </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">pending </span><span class="s0">= </span><span class="s1">null</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Mappings</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">advance </span><span class="s0">= </span><span class="s1">function </span><span class="s2">advance </span><span class="s0">(</span><span class="s2">str</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">str</span><span class="s0">) { </span><span class="s1">return</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">lines </span><span class="s0">= </span><span class="s2">str</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">lines</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt; </span><span class="s4">1</span><span class="s0">) {</span>
			<span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">; </span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">lines</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">; </span><span class="s2">i</span><span class="s0">++) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine</span><span class="s0">++;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">raw</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeLine</span><span class="s0">] = </span><span class="s1">this</span><span class="s0">.</span><span class="s2">rawSegments </span><span class="s0">= [];</span>
			<span class="s0">}</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">generatedCodeColumn </span><span class="s0">+= </span><span class="s2">lines</span><span class="s0">[</span><span class="s2">lines</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">].</span><span class="s2">length</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s1">var </span><span class="s2">n </span><span class="s0">= </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">;</span>

	<span class="s1">var </span><span class="s2">warned </span><span class="s0">= {</span>
		<span class="s2">insertLeft</span><span class="s0">: </span><span class="s1">false</span><span class="s0">,</span>
		<span class="s2">insertRight</span><span class="s0">: </span><span class="s1">false</span><span class="s0">,</span>
		<span class="s2">storeName</span><span class="s0">: </span><span class="s1">false</span><span class="s0">,</span>
	<span class="s0">};</span>

	<span class="s1">var </span><span class="s2">MagicString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">MagicString</span><span class="s0">(</span><span class="s2">string</span><span class="s0">, </span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">( </span><span class="s2">options </span><span class="s0">=== </span><span class="s1">void </span><span class="s4">0 </span><span class="s0">) </span><span class="s2">options </span><span class="s0">= {};</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Chunk</span><span class="s0">(</span><span class="s4">0</span><span class="s0">, </span><span class="s2">string</span><span class="s0">.</span><span class="s2">length</span><span class="s0">, </span><span class="s2">string</span><span class="s0">);</span>

		<span class="s2">Object</span><span class="s0">.</span><span class="s2">defineProperties</span><span class="s0">(</span><span class="s1">this</span><span class="s0">, {</span>
			<span class="s2">original</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">string </span><span class="s0">},</span>
			<span class="s2">outro</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s3">'' </span><span class="s0">},</span>
			<span class="s2">intro</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s3">'' </span><span class="s0">},</span>
			<span class="s2">firstChunk</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">chunk </span><span class="s0">},</span>
			<span class="s2">lastChunk</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">chunk </span><span class="s0">},</span>
			<span class="s2">lastSearchedChunk</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">chunk </span><span class="s0">},</span>
			<span class="s2">byStart</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: {} },</span>
			<span class="s2">byEnd</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: {} },</span>
			<span class="s2">filename</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">options</span><span class="s0">.</span><span class="s2">filename </span><span class="s0">},</span>
			<span class="s2">indentExclusionRanges</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">options</span><span class="s0">.</span><span class="s2">indentExclusionRanges </span><span class="s0">},</span>
			<span class="s2">sourcemapLocations</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s1">new </span><span class="s2">BitSet</span><span class="s0">() },</span>
			<span class="s2">storedNames</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: {} },</span>
			<span class="s2">indentStr</span><span class="s0">: { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s2">guessIndent</span><span class="s0">(</span><span class="s2">string</span><span class="s0">) },</span>
		<span class="s0">});</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s4">0</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">string</span><span class="s0">.</span><span class="s2">length</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">addSourcemapLocation </span><span class="s0">= </span><span class="s1">function </span><span class="s2">addSourcemapLocation </span><span class="s0">(</span><span class="s2">char</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">sourcemapLocations</span><span class="s0">.</span><span class="s2">add</span><span class="s0">(</span><span class="s2">char</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">append </span><span class="s0">= </span><span class="s1">function </span><span class="s2">append </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'outro content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">+= </span><span class="s2">content</span><span class="s0">;</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">appendLeft </span><span class="s0">= </span><span class="s1">function </span><span class="s2">appendLeft </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'inserted content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">index</span><span class="s0">];</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">appendLeft</span><span class="s0">(</span><span class="s2">content</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+= </span><span class="s2">content</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">appendRight </span><span class="s0">= </span><span class="s1">function </span><span class="s2">appendRight </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'inserted content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">index</span><span class="s0">];</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">appendRight</span><span class="s0">(</span><span class="s2">content</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">+= </span><span class="s2">content</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">clone </span><span class="s0">= </span><span class="s1">function </span><span class="s2">clone </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">cloned </span><span class="s0">= </span><span class="s1">new </span><span class="s2">MagicString</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">, { </span><span class="s2">filename</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">filename </span><span class="s0">});</span>

		<span class="s1">var </span><span class="s2">originalChunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">clonedChunk </span><span class="s0">= (</span><span class="s2">cloned</span><span class="s0">.</span><span class="s2">firstChunk </span><span class="s0">= </span><span class="s2">cloned</span><span class="s0">.</span><span class="s2">lastSearchedChunk </span><span class="s0">= </span><span class="s2">originalChunk</span><span class="s0">.</span><span class="s2">clone</span><span class="s0">());</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">originalChunk</span><span class="s0">) {</span>
			<span class="s2">cloned</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">clonedChunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">] = </span><span class="s2">clonedChunk</span><span class="s0">;</span>
			<span class="s2">cloned</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">clonedChunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">clonedChunk</span><span class="s0">;</span>

			<span class="s1">var </span><span class="s2">nextOriginalChunk </span><span class="s0">= </span><span class="s2">originalChunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">nextClonedChunk </span><span class="s0">= </span><span class="s2">nextOriginalChunk </span><span class="s0">&amp;&amp; </span><span class="s2">nextOriginalChunk</span><span class="s0">.</span><span class="s2">clone</span><span class="s0">();</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">nextClonedChunk</span><span class="s0">) {</span>
				<span class="s2">clonedChunk</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">nextClonedChunk</span><span class="s0">;</span>
				<span class="s2">nextClonedChunk</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">clonedChunk</span><span class="s0">;</span>

				<span class="s2">clonedChunk </span><span class="s0">= </span><span class="s2">nextClonedChunk</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s2">originalChunk </span><span class="s0">= </span><span class="s2">nextOriginalChunk</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s2">cloned</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">clonedChunk</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">indentExclusionRanges</span><span class="s0">) {</span>
			<span class="s2">cloned</span><span class="s0">.</span><span class="s2">indentExclusionRanges </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">indentExclusionRanges</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">();</span>
		<span class="s0">}</span>

		<span class="s2">cloned</span><span class="s0">.</span><span class="s2">sourcemapLocations </span><span class="s0">= </span><span class="s1">new </span><span class="s2">BitSet</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">sourcemapLocations</span><span class="s0">);</span>

		<span class="s2">cloned</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
		<span class="s2">cloned</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>

		<span class="s1">return </span><span class="s2">cloned</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">generateDecodedMap </span><span class="s0">= </span><span class="s1">function </span><span class="s2">generateDecodedMap </span><span class="s0">(</span><span class="s2">options</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">this$1$1 </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>

		<span class="s2">options </span><span class="s0">= </span><span class="s2">options </span><span class="s0">|| {};</span>

		<span class="s1">var </span><span class="s2">sourceIndex </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">names </span><span class="s0">= </span><span class="s2">Object</span><span class="s0">.</span><span class="s2">keys</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">storedNames</span><span class="s0">);</span>
		<span class="s1">var </span><span class="s2">mappings </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Mappings</span><span class="s0">(</span><span class="s2">options</span><span class="s0">.</span><span class="s2">hires</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">locate </span><span class="s0">= </span><span class="s2">getLocator</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">) {</span>
			<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">);</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">.</span><span class="s2">eachNext</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">loc </span><span class="s0">= </span><span class="s2">locate</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">);</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">); }</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited</span><span class="s0">) {</span>
				<span class="s2">mappings</span><span class="s0">.</span><span class="s2">addEdit</span><span class="s0">(</span>
					<span class="s2">sourceIndex</span><span class="s0">,</span>
					<span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">,</span>
					<span class="s2">loc</span><span class="s0">,</span>
					<span class="s2">chunk</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">? </span><span class="s2">names</span><span class="s0">.</span><span class="s2">indexOf</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">original</span><span class="s0">) : -</span><span class="s4">1</span>
				<span class="s0">);</span>
			<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
				<span class="s2">mappings</span><span class="s0">.</span><span class="s2">addUneditedChunk</span><span class="s0">(</span><span class="s2">sourceIndex</span><span class="s0">, </span><span class="s2">chunk</span><span class="s0">, </span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">original</span><span class="s0">, </span><span class="s2">loc</span><span class="s0">, </span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">sourcemapLocations</span><span class="s0">);</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">); }</span>
		<span class="s0">});</span>

		<span class="s1">return </span><span class="s0">{</span>
			<span class="s2">file</span><span class="s0">: </span><span class="s2">options</span><span class="s0">.</span><span class="s2">file </span><span class="s0">? </span><span class="s2">options</span><span class="s0">.</span><span class="s2">file</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s6">/[/\\]/</span><span class="s0">).</span><span class="s2">pop</span><span class="s0">() : </span><span class="s1">null</span><span class="s0">,</span>
			<span class="s2">sources</span><span class="s0">: [</span><span class="s2">options</span><span class="s0">.</span><span class="s2">source </span><span class="s0">? </span><span class="s2">getRelativePath</span><span class="s0">(</span><span class="s2">options</span><span class="s0">.</span><span class="s2">file </span><span class="s0">|| </span><span class="s3">''</span><span class="s0">, </span><span class="s2">options</span><span class="s0">.</span><span class="s2">source</span><span class="s0">) : </span><span class="s1">null</span><span class="s0">],</span>
			<span class="s2">sourcesContent</span><span class="s0">: </span><span class="s2">options</span><span class="s0">.</span><span class="s2">includeContent </span><span class="s0">? [</span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">] : [</span><span class="s1">null</span><span class="s0">],</span>
			<span class="s2">names</span><span class="s0">: </span><span class="s2">names</span><span class="s0">,</span>
			<span class="s2">mappings</span><span class="s0">: </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">raw</span><span class="s0">,</span>
		<span class="s0">};</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">generateMap </span><span class="s0">= </span><span class="s1">function </span><span class="s2">generateMap </span><span class="s0">(</span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">return new </span><span class="s2">SourceMap</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generateDecodedMap</span><span class="s0">(</span><span class="s2">options</span><span class="s0">));</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">getIndentString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">getIndentString </span><span class="s0">() {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">indentStr </span><span class="s0">=== </span><span class="s1">null </span><span class="s0">? </span><span class="s3">'</span><span class="s1">\t</span><span class="s3">' </span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">indentStr</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">indent </span><span class="s0">= </span><span class="s1">function </span><span class="s2">indent </span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">, </span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">pattern </span><span class="s0">= </span><span class="s6">/^[^\r\n]/gm</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">isObject</span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">)) {</span>
			<span class="s2">options </span><span class="s0">= </span><span class="s2">indentStr</span><span class="s0">;</span>
			<span class="s2">indentStr </span><span class="s0">= </span><span class="s2">undefined</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s2">indentStr </span><span class="s0">= </span><span class="s2">indentStr </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">indentStr </span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">indentStr </span><span class="s0">|| </span><span class="s3">'</span><span class="s1">\t</span><span class="s3">'</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">indentStr </span><span class="s0">=== </span><span class="s3">''</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">; } </span><span class="s5">// noop</span>

		<span class="s2">options </span><span class="s0">= </span><span class="s2">options </span><span class="s0">|| {};</span>

		<span class="s5">// Process exclusion ranges</span>
		<span class="s1">var </span><span class="s2">isExcluded </span><span class="s0">= {};</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">options</span><span class="s0">.</span><span class="s2">exclude</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">exclusions </span><span class="s0">=</span>
				<span class="s1">typeof </span><span class="s2">options</span><span class="s0">.</span><span class="s2">exclude</span><span class="s0">[</span><span class="s4">0</span><span class="s0">] === </span><span class="s3">'number' </span><span class="s0">? [</span><span class="s2">options</span><span class="s0">.</span><span class="s2">exclude</span><span class="s0">] : </span><span class="s2">options</span><span class="s0">.</span><span class="s2">exclude</span><span class="s0">;</span>
			<span class="s2">exclusions</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">exclusion</span><span class="s0">) {</span>
				<span class="s1">for </span><span class="s0">(</span><span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s2">exclusion</span><span class="s0">[</span><span class="s4">0</span><span class="s0">]; </span><span class="s2">i </span><span class="s0">&lt; </span><span class="s2">exclusion</span><span class="s0">[</span><span class="s4">1</span><span class="s0">]; </span><span class="s2">i </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">) {</span>
					<span class="s2">isExcluded</span><span class="s0">[</span><span class="s2">i</span><span class="s0">] = </span><span class="s1">true</span><span class="s0">;</span>
				<span class="s0">}</span>
			<span class="s0">});</span>
		<span class="s0">}</span>

		<span class="s1">var </span><span class="s2">shouldIndentNextCharacter </span><span class="s0">= </span><span class="s2">options</span><span class="s0">.</span><span class="s2">indentStart </span><span class="s0">!== </span><span class="s1">false</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">replacer </span><span class="s0">= </span><span class="s1">function </span><span class="s0">(</span><span class="s2">match</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">shouldIndentNextCharacter</span><span class="s0">) { </span><span class="s1">return </span><span class="s0">(</span><span class="s3">&quot;&quot; </span><span class="s0">+ </span><span class="s2">indentStr </span><span class="s0">+ </span><span class="s2">match</span><span class="s0">); }</span>
			<span class="s2">shouldIndentNextCharacter </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
			<span class="s1">return </span><span class="s2">match</span><span class="s0">;</span>
		<span class="s0">};</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">pattern</span><span class="s0">, </span><span class="s2">replacer</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">charIndex </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">end </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited</span><span class="s0">) {</span>
				<span class="s1">if </span><span class="s0">(!</span><span class="s2">isExcluded</span><span class="s0">[</span><span class="s2">charIndex</span><span class="s0">]) {</span>
					<span class="s2">chunk</span><span class="s0">.</span><span class="s2">content </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">pattern</span><span class="s0">, </span><span class="s2">replacer</span><span class="s0">);</span>

					<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
						<span class="s2">shouldIndentNextCharacter </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">] === </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">;</span>
					<span class="s0">}</span>
				<span class="s0">}</span>
			<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
				<span class="s2">charIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">;</span>

				<span class="s1">while </span><span class="s0">(</span><span class="s2">charIndex </span><span class="s0">&lt; </span><span class="s2">end</span><span class="s0">) {</span>
					<span class="s1">if </span><span class="s0">(!</span><span class="s2">isExcluded</span><span class="s0">[</span><span class="s2">charIndex</span><span class="s0">]) {</span>
						<span class="s1">var </span><span class="s2">char </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">[</span><span class="s2">charIndex</span><span class="s0">];</span>

						<span class="s1">if </span><span class="s0">(</span><span class="s2">char </span><span class="s0">=== </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">) {</span>
							<span class="s2">shouldIndentNextCharacter </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
						<span class="s0">} </span><span class="s1">else if </span><span class="s0">(</span><span class="s2">char </span><span class="s0">!== </span><span class="s3">'</span><span class="s1">\r</span><span class="s3">' </span><span class="s0">&amp;&amp; </span><span class="s2">shouldIndentNextCharacter</span><span class="s0">) {</span>
							<span class="s2">shouldIndentNextCharacter </span><span class="s0">= </span><span class="s1">false</span><span class="s0">;</span>

							<span class="s1">if </span><span class="s0">(</span><span class="s2">charIndex </span><span class="s0">=== </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">) {</span>
								<span class="s2">chunk</span><span class="s0">.</span><span class="s2">prependRight</span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">);</span>
							<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
								<span class="s1">this</span><span class="s0">.</span><span class="s2">_splitChunk</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">, </span><span class="s2">charIndex</span><span class="s0">);</span>
								<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
								<span class="s2">chunk</span><span class="s0">.</span><span class="s2">prependRight</span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">);</span>
							<span class="s0">}</span>
						<span class="s0">}</span>
					<span class="s0">}</span>

					<span class="s2">charIndex </span><span class="s0">+= </span><span class="s4">1</span><span class="s0">;</span>
				<span class="s0">}</span>
			<span class="s0">}</span>

			<span class="s2">charIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">pattern</span><span class="s0">, </span><span class="s2">replacer</span><span class="s0">);</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">insert </span><span class="s0">= </span><span class="s1">function </span><span class="s2">insert </span><span class="s0">() {</span>
		<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span>
			<span class="s3">'magicString.insert(...) is deprecated. Use prependRight(...) or appendLeft(...)'</span>
		<span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">insertLeft </span><span class="s0">= </span><span class="s1">function </span><span class="s2">insertLeft </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">warned</span><span class="s0">.</span><span class="s2">insertLeft</span><span class="s0">) {</span>
			<span class="s2">console</span><span class="s0">.</span><span class="s2">warn</span><span class="s0">(</span>
				<span class="s3">'magicString.insertLeft(...) is deprecated. Use magicString.appendLeft(...) instead'</span>
			<span class="s0">); </span><span class="s5">// eslint-disable-line no-console</span>
			<span class="s2">warned</span><span class="s0">.</span><span class="s2">insertLeft </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">return this</span><span class="s0">.</span><span class="s2">appendLeft</span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">insertRight </span><span class="s0">= </span><span class="s1">function </span><span class="s2">insertRight </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">warned</span><span class="s0">.</span><span class="s2">insertRight</span><span class="s0">) {</span>
			<span class="s2">console</span><span class="s0">.</span><span class="s2">warn</span><span class="s0">(</span>
				<span class="s3">'magicString.insertRight(...) is deprecated. Use magicString.prependRight(...) instead'</span>
			<span class="s0">); </span><span class="s5">// eslint-disable-line no-console</span>
			<span class="s2">warned</span><span class="s0">.</span><span class="s2">insertRight </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">return this</span><span class="s0">.</span><span class="s2">prependRight</span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">move </span><span class="s0">= </span><span class="s1">function </span><span class="s2">move </span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">, </span><span class="s2">index</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">index </span><span class="s0">&gt;= </span><span class="s2">start </span><span class="s0">&amp;&amp; </span><span class="s2">index </span><span class="s0">&lt;= </span><span class="s2">end</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'Cannot move a selection inside itself'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">start</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">end</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">first </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">start</span><span class="s0">];</span>
		<span class="s1">var </span><span class="s2">last </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">end</span><span class="s0">];</span>

		<span class="s1">var </span><span class="s2">oldLeft </span><span class="s0">= </span><span class="s2">first</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">oldRight </span><span class="s0">= </span><span class="s2">last</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>

		<span class="s1">var </span><span class="s2">newRight </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">index</span><span class="s0">];</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">newRight </span><span class="s0">&amp;&amp; </span><span class="s2">last </span><span class="s0">=== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">; }</span>
		<span class="s1">var </span><span class="s2">newLeft </span><span class="s0">= </span><span class="s2">newRight </span><span class="s0">? </span><span class="s2">newRight</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">oldLeft</span><span class="s0">) { </span><span class="s2">oldLeft</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">oldRight</span><span class="s0">; }</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">oldRight</span><span class="s0">) { </span><span class="s2">oldRight</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">oldLeft</span><span class="s0">; }</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">newLeft</span><span class="s0">) { </span><span class="s2">newLeft</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">first</span><span class="s0">; }</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">newRight</span><span class="s0">) { </span><span class="s2">newRight</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">last</span><span class="s0">; }</span>

		<span class="s1">if </span><span class="s0">(!</span><span class="s2">first</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">) { </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk </span><span class="s0">= </span><span class="s2">last</span><span class="s0">.</span><span class="s2">next</span><span class="s0">; }</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">last</span><span class="s0">.</span><span class="s2">next</span><span class="s0">) {</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">first</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">;</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s1">null</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s2">first</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">newLeft</span><span class="s0">;</span>
		<span class="s2">last</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">newRight </span><span class="s0">|| </span><span class="s1">null</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(!</span><span class="s2">newLeft</span><span class="s0">) { </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk </span><span class="s0">= </span><span class="s2">first</span><span class="s0">; }</span>
		<span class="s1">if </span><span class="s0">(!</span><span class="s2">newRight</span><span class="s0">) { </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">last</span><span class="s0">; }</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">overwrite </span><span class="s0">= </span><span class="s1">function </span><span class="s2">overwrite </span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">, </span><span class="s2">content</span><span class="s0">, </span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'replacement content must be a string'</span><span class="s0">); }</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">start </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">end </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">end </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">end </span><span class="s0">&gt; </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'end is out of bounds'</span><span class="s0">); }</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">start </span><span class="s0">=== </span><span class="s2">end</span><span class="s0">)</span>
			<span class="s0">{ </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span>
				<span class="s3">'Cannot overwrite a zero-length range  use appendLeft or prependRight instead'</span>
			<span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">start</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">end</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">options </span><span class="s0">=== </span><span class="s1">true</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(!</span><span class="s2">warned</span><span class="s0">.</span><span class="s2">storeName</span><span class="s0">) {</span>
				<span class="s2">console</span><span class="s0">.</span><span class="s2">warn</span><span class="s0">(</span>
					<span class="s3">'The final argument to magicString.overwrite(...) should be an options object. See https://github.com/rich-harris/magic-string'</span>
				<span class="s0">); </span><span class="s5">// eslint-disable-line no-console</span>
				<span class="s2">warned</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">= </span><span class="s1">true</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s2">options </span><span class="s0">= { </span><span class="s2">storeName</span><span class="s0">: </span><span class="s1">true </span><span class="s0">};</span>
		<span class="s0">}</span>
		<span class="s1">var </span><span class="s2">storeName </span><span class="s0">= </span><span class="s2">options </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">options</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">: </span><span class="s1">false</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">contentOnly </span><span class="s0">= </span><span class="s2">options </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">options</span><span class="s0">.</span><span class="s2">contentOnly </span><span class="s0">: </span><span class="s1">false</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">storeName</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">original </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">);</span>
			<span class="s2">Object</span><span class="s0">.</span><span class="s2">defineProperty</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">storedNames</span><span class="s0">, </span><span class="s2">original</span><span class="s0">, { </span><span class="s2">writable</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">value</span><span class="s0">: </span><span class="s1">true</span><span class="s0">, </span><span class="s2">enumerable</span><span class="s0">: </span><span class="s1">true </span><span class="s0">});</span>
		<span class="s0">}</span>

		<span class="s1">var </span><span class="s2">first </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">start</span><span class="s0">];</span>
		<span class="s1">var </span><span class="s2">last </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">end</span><span class="s0">];</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">first</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s2">first</span><span class="s0">;</span>
			<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk </span><span class="s0">!== </span><span class="s2">last</span><span class="s0">) {</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next </span><span class="s0">!== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">]) {</span>
					<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'Cannot overwrite across a split point'</span><span class="s0">);</span>
				<span class="s0">}</span>
				<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
				<span class="s2">chunk</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">, </span><span class="s1">false</span><span class="s0">);</span>
			<span class="s0">}</span>

			<span class="s2">first</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s2">content</span><span class="s0">, </span><span class="s2">storeName</span><span class="s0">, </span><span class="s2">contentOnly</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s5">// must be inserting at the end</span>
			<span class="s1">var </span><span class="s2">newChunk </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Chunk</span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">, </span><span class="s3">''</span><span class="s0">).</span><span class="s2">edit</span><span class="s0">(</span><span class="s2">content</span><span class="s0">, </span><span class="s2">storeName</span><span class="s0">);</span>

			<span class="s5">// TODO last chunk in the array may not be the last chunk, if it's moved...</span>
			<span class="s2">last</span><span class="s0">.</span><span class="s2">next </span><span class="s0">= </span><span class="s2">newChunk</span><span class="s0">;</span>
			<span class="s2">newChunk</span><span class="s0">.</span><span class="s2">previous </span><span class="s0">= </span><span class="s2">last</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prepend </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prepend </span><span class="s0">(</span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'outro content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prependLeft </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prependLeft </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'inserted content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">index</span><span class="s0">];</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">prependLeft</span><span class="s0">(</span><span class="s2">content</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prependRight </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prependRight </span><span class="s0">(</span><span class="s2">index</span><span class="s0">, </span><span class="s2">content</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">typeof </span><span class="s2">content </span><span class="s0">!== </span><span class="s3">'string'</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">TypeError</span><span class="s0">(</span><span class="s3">'inserted content must be a string'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">index</span><span class="s0">];</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">prependRight</span><span class="s0">(</span><span class="s2">content</span><span class="s0">);</span>
		<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s2">content </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">remove </span><span class="s0">= </span><span class="s1">function </span><span class="s2">remove </span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">) {</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">start </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">end </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">end </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">start </span><span class="s0">=== </span><span class="s2">end</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">; }</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s4">0 </span><span class="s0">|| </span><span class="s2">end </span><span class="s0">&gt; </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'Character is out of bounds'</span><span class="s0">); }</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">start </span><span class="s0">&gt; </span><span class="s2">end</span><span class="s0">) { </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span><span class="s3">'end must be greater than start'</span><span class="s0">); }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">start</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">_split</span><span class="s0">(</span><span class="s2">end</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">start</span><span class="s0">];</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>
			<span class="s2">chunk</span><span class="s0">.</span><span class="s2">edit</span><span class="s0">(</span><span class="s3">''</span><span class="s0">);</span>

			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">end </span><span class="s0">&gt; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">? </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] : </span><span class="s1">null</span><span class="s0">;</span>
		<span class="s0">}</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">lastChar </span><span class="s0">= </span><span class="s1">function </span><span class="s2">lastChar </span><span class="s0">() {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">]; }</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">;</span>
		<span class="s1">do </span><span class="s0">{</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">]; }</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">]; }</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">]; }</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">((</span><span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">));</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">]; }</span>
		<span class="s1">return </span><span class="s3">''</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">lastLine </span><span class="s0">= </span><span class="s1">function </span><span class="s2">lastLine </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">lineIndex </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">lastIndexOf</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">!== -</span><span class="s4">1</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">substr</span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">); }</span>
		<span class="s1">var </span><span class="s2">lineStr </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">;</span>
		<span class="s1">do </span><span class="s0">{</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">) {</span>
				<span class="s2">lineIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">lastIndexOf</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">!== -</span><span class="s4">1</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">substr</span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">) + </span><span class="s2">lineStr</span><span class="s0">; }</span>
				<span class="s2">lineStr </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">+ </span><span class="s2">lineStr</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">) {</span>
				<span class="s2">lineIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">lastIndexOf</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">!== -</span><span class="s4">1</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">substr</span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">) + </span><span class="s2">lineStr</span><span class="s0">; }</span>
				<span class="s2">lineStr </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content </span><span class="s0">+ </span><span class="s2">lineStr</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">) {</span>
				<span class="s2">lineIndex </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">lastIndexOf</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">!== -</span><span class="s4">1</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">substr</span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">) + </span><span class="s2">lineStr</span><span class="s0">; }</span>
				<span class="s2">lineStr </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+ </span><span class="s2">lineStr</span><span class="s0">;</span>
			<span class="s0">}</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">((</span><span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">));</span>
		<span class="s2">lineIndex </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">lastIndexOf</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">!== -</span><span class="s4">1</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">substr</span><span class="s0">(</span><span class="s2">lineIndex </span><span class="s0">+ </span><span class="s4">1</span><span class="s0">) + </span><span class="s2">lineStr</span><span class="s0">; }</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+ </span><span class="s2">lineStr</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">slice </span><span class="s0">= </span><span class="s1">function </span><span class="s2">slice </span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">( </span><span class="s2">start </span><span class="s0">=== </span><span class="s1">void </span><span class="s4">0 </span><span class="s0">) </span><span class="s2">start </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
			<span class="s1">if </span><span class="s0">( </span><span class="s2">end </span><span class="s0">=== </span><span class="s1">void </span><span class="s4">0 </span><span class="s0">) </span><span class="s2">end </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">start </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">end </span><span class="s0">&lt; </span><span class="s4">0</span><span class="s0">) { </span><span class="s2">end </span><span class="s0">+= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">result </span><span class="s0">= </span><span class="s3">''</span><span class="s0">;</span>

		<span class="s5">// find start chunk</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk </span><span class="s0">&amp;&amp; (</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">&gt; </span><span class="s2">start </span><span class="s0">|| </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">&lt;= </span><span class="s2">start</span><span class="s0">)) {</span>
			<span class="s5">// found end chunk before start</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s2">end </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">&gt;= </span><span class="s2">end</span><span class="s0">) {</span>
				<span class="s1">return </span><span class="s2">result</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">!== </span><span class="s2">start</span><span class="s0">)</span>
			<span class="s0">{ </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">((</span><span class="s3">&quot;Cannot use replaced character &quot; </span><span class="s0">+ </span><span class="s2">start </span><span class="s0">+ </span><span class="s3">&quot; as slice start anchor.&quot;</span><span class="s0">)); }</span>

		<span class="s1">var </span><span class="s2">startChunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">;</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">&amp;&amp; (</span><span class="s2">startChunk </span><span class="s0">!== </span><span class="s2">chunk </span><span class="s0">|| </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">=== </span><span class="s2">start</span><span class="s0">)) {</span>
				<span class="s2">result </span><span class="s0">+= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">var </span><span class="s2">containsEnd </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">&lt; </span><span class="s2">end </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">&gt;= </span><span class="s2">end</span><span class="s0">;</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">containsEnd </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">!== </span><span class="s2">end</span><span class="s0">)</span>
				<span class="s0">{ </span><span class="s1">throw new </span><span class="s2">Error</span><span class="s0">((</span><span class="s3">&quot;Cannot use replaced character &quot; </span><span class="s0">+ </span><span class="s2">end </span><span class="s0">+ </span><span class="s3">&quot; as slice end anchor.&quot;</span><span class="s0">)); }</span>

			<span class="s1">var </span><span class="s2">sliceStart </span><span class="s0">= </span><span class="s2">startChunk </span><span class="s0">=== </span><span class="s2">chunk </span><span class="s0">? </span><span class="s2">start </span><span class="s0">- </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start </span><span class="s0">: </span><span class="s4">0</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">sliceEnd </span><span class="s0">= </span><span class="s2">containsEnd </span><span class="s0">? </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">+ </span><span class="s2">end </span><span class="s0">- </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">: </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>

			<span class="s2">result </span><span class="s0">+= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">(</span><span class="s2">sliceStart</span><span class="s0">, </span><span class="s2">sliceEnd</span><span class="s0">);</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">&amp;&amp; (!</span><span class="s2">containsEnd </span><span class="s0">|| </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">=== </span><span class="s2">end</span><span class="s0">)) {</span>
				<span class="s2">result </span><span class="s0">+= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">containsEnd</span><span class="s0">) {</span>
				<span class="s1">break</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">return </span><span class="s2">result</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s5">// TODO deprecate this? not really very useful</span>
	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">snip </span><span class="s0">= </span><span class="s1">function </span><span class="s2">snip </span><span class="s0">(</span><span class="s2">start</span><span class="s0">, </span><span class="s2">end</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">clone </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">clone</span><span class="s0">();</span>
		<span class="s2">clone</span><span class="s0">.</span><span class="s2">remove</span><span class="s0">(</span><span class="s4">0</span><span class="s0">, </span><span class="s2">start</span><span class="s0">);</span>
		<span class="s2">clone</span><span class="s0">.</span><span class="s2">remove</span><span class="s0">(</span><span class="s2">end</span><span class="s0">, </span><span class="s2">clone</span><span class="s0">.</span><span class="s2">original</span><span class="s0">.</span><span class="s2">length</span><span class="s0">);</span>

		<span class="s1">return </span><span class="s2">clone</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">_split </span><span class="s0">= </span><span class="s1">function </span><span class="s2">_split </span><span class="s0">(</span><span class="s2">index</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">index</span><span class="s0">] || </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">index</span><span class="s0">]) { </span><span class="s1">return</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastSearchedChunk</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">searchForward </span><span class="s0">= </span><span class="s2">index </span><span class="s0">&gt; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>

		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">contains</span><span class="s0">(</span><span class="s2">index</span><span class="s0">)) { </span><span class="s1">return this</span><span class="s0">.</span><span class="s2">_splitChunk</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">, </span><span class="s2">index</span><span class="s0">); }</span>

			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">searchForward </span><span class="s0">? </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] : </span><span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">];</span>
		<span class="s0">}</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">_splitChunk </span><span class="s0">= </span><span class="s1">function </span><span class="s2">_splitChunk </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">, </span><span class="s2">index</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s5">// zero-length edited chunks are a special case (overlapping replacements)</span>
			<span class="s1">var </span><span class="s2">loc </span><span class="s0">= </span><span class="s2">getLocator</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">original</span><span class="s0">)(</span><span class="s2">index</span><span class="s0">);</span>
			<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span>
				<span class="s0">(</span><span class="s3">&quot;Cannot split a chunk that has already been edited (&quot; </span><span class="s0">+ (</span><span class="s2">loc</span><span class="s0">.</span><span class="s2">line</span><span class="s0">) + </span><span class="s3">&quot;:&quot; </span><span class="s0">+ (</span><span class="s2">loc</span><span class="s0">.</span><span class="s2">column</span><span class="s0">) + </span><span class="s3">&quot;  </span><span class="s1">\&quot;</span><span class="s3">&quot; </span><span class="s0">+ (</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">original</span><span class="s0">) + </span><span class="s3">&quot;</span><span class="s1">\&quot;</span><span class="s3">)&quot;</span><span class="s0">)</span>
			<span class="s0">);</span>
		<span class="s0">}</span>

		<span class="s1">var </span><span class="s2">newChunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s2">index</span><span class="s0">);</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">index</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">index</span><span class="s0">] = </span><span class="s2">newChunk</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">newChunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">newChunk</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk </span><span class="s0">=== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">) { </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">newChunk</span><span class="s0">; }</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">lastSearchedChunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">;</span>
		<span class="s1">return true</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">toString </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">str </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>
		<span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
			<span class="s2">str </span><span class="s0">+= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">toString</span><span class="s0">();</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">return </span><span class="s2">str </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">isEmpty </span><span class="s0">= </span><span class="s1">function </span><span class="s2">isEmpty </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>
		<span class="s1">do </span><span class="s0">{</span>
			<span class="s1">if </span><span class="s0">(</span>
				<span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">()) ||</span>
				<span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">()) ||</span>
				<span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&amp;&amp; </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">())</span>
			<span class="s0">)</span>
				<span class="s0">{ </span><span class="s1">return false</span><span class="s0">; }</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">((</span><span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">));</span>
		<span class="s1">return true</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">length </span><span class="s0">= </span><span class="s1">function </span><span class="s2">length </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">length </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>
		<span class="s1">do </span><span class="s0">{</span>
			<span class="s2">length </span><span class="s0">+= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">+ </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length </span><span class="s0">+ </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">((</span><span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">));</span>
		<span class="s1">return </span><span class="s2">length</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimLines </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimLines </span><span class="s0">() {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">(</span><span class="s3">'[</span><span class="s1">\\</span><span class="s3">r</span><span class="s1">\\</span><span class="s3">n]'</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trim </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trim </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">trimStart</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">).</span><span class="s2">trimEnd</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimEndAborted </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimEndAborted </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">rx </span><span class="s0">= </span><span class="s1">new </span><span class="s2">RegExp</span><span class="s0">((</span><span class="s2">charType </span><span class="s0">|| </span><span class="s3">'</span><span class="s1">\\</span><span class="s3">s'</span><span class="s0">) + </span><span class="s3">'+$'</span><span class="s0">);</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">outro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">;</span>

		<span class="s1">do </span><span class="s0">{</span>
			<span class="s1">var </span><span class="s2">end </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">aborted </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">trimEnd</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">);</span>

			<span class="s5">// if chunk was trimmed, we have a new lastChunk</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">!== </span><span class="s2">end</span><span class="s0">) {</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">=== </span><span class="s2">chunk</span><span class="s0">) {</span>
					<span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
				<span class="s0">}</span>

				<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">.</span><span class="s2">start</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">aborted</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">previous</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">);</span>

		<span class="s1">return false</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimEnd </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimEnd </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">trimEndAborted</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">);</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>
	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimStartAborted </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimStartAborted </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">rx </span><span class="s0">= </span><span class="s1">new </span><span class="s2">RegExp</span><span class="s0">(</span><span class="s3">'^' </span><span class="s0">+ (</span><span class="s2">charType </span><span class="s0">|| </span><span class="s3">'</span><span class="s1">\\</span><span class="s3">s'</span><span class="s0">) + </span><span class="s3">'+'</span><span class="s0">);</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>

		<span class="s1">var </span><span class="s2">chunk </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">;</span>

		<span class="s1">do </span><span class="s0">{</span>
			<span class="s1">var </span><span class="s2">end </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">aborted </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">trimStart</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">);</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end </span><span class="s0">!== </span><span class="s2">end</span><span class="s0">) {</span>
				<span class="s5">// special case...</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk </span><span class="s0">=== </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk</span><span class="s0">) { </span><span class="s1">this</span><span class="s0">.</span><span class="s2">lastChunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">; }</span>

				<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">byStart</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">.</span><span class="s2">start</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">byEnd</span><span class="s0">[</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">.</span><span class="s2">end</span><span class="s0">] = </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
			<span class="s0">}</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">aborted</span><span class="s0">) { </span><span class="s1">return true</span><span class="s0">; }</span>
			<span class="s2">chunk </span><span class="s0">= </span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">next</span><span class="s0">;</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">);</span>

		<span class="s1">return false</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimStart </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimStart </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">trimStartAborted</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">);</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s1">var </span><span class="s2">hasOwnProp </span><span class="s0">= </span><span class="s2">Object</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">hasOwnProperty</span><span class="s0">;</span>

	<span class="s1">var </span><span class="s2">Bundle </span><span class="s0">= </span><span class="s1">function </span><span class="s2">Bundle</span><span class="s0">(</span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">( </span><span class="s2">options </span><span class="s0">=== </span><span class="s1">void </span><span class="s4">0 </span><span class="s0">) </span><span class="s2">options </span><span class="s0">= {};</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s2">options</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">|| </span><span class="s3">''</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">= </span><span class="s2">options</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">options</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">: </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">;</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources </span><span class="s0">= [];</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources </span><span class="s0">= [];</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSourceIndexByFilename </span><span class="s0">= {};</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">addSource </span><span class="s0">= </span><span class="s1">function </span><span class="s2">addSource </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s2">source </span><span class="s1">instanceof </span><span class="s2">MagicString</span><span class="s0">) {</span>
			<span class="s1">return this</span><span class="s0">.</span><span class="s2">addSource</span><span class="s0">({</span>
				<span class="s2">content</span><span class="s0">: </span><span class="s2">source</span><span class="s0">,</span>
				<span class="s2">filename</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">,</span>
				<span class="s2">separator</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">,</span>
			<span class="s0">});</span>
		<span class="s0">}</span>

		<span class="s1">if </span><span class="s0">(!</span><span class="s2">isObject</span><span class="s0">(</span><span class="s2">source</span><span class="s0">) || !</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">) {</span>
			<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">(</span>
				<span class="s3">'bundle.addSource() takes an object with a `content` property, which should be an instance of MagicString, and an optional `filename`'</span>
			<span class="s0">);</span>
		<span class="s0">}</span>

		<span class="s0">[</span><span class="s3">'filename'</span><span class="s0">, </span><span class="s3">'indentExclusionRanges'</span><span class="s0">, </span><span class="s3">'separator'</span><span class="s0">].</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">option</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(!</span><span class="s2">hasOwnProp</span><span class="s0">.</span><span class="s2">call</span><span class="s0">(</span><span class="s2">source</span><span class="s0">, </span><span class="s2">option</span><span class="s0">)) { </span><span class="s2">source</span><span class="s0">[</span><span class="s2">option</span><span class="s0">] = </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">[</span><span class="s2">option</span><span class="s0">]; }</span>
		<span class="s0">});</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">=== </span><span class="s2">undefined</span><span class="s0">) {</span>
			<span class="s5">// TODO there's a bunch of this sort of thing, needs cleaning up</span>
			<span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">;</span>
		<span class="s0">}</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(!</span><span class="s2">hasOwnProp</span><span class="s0">.</span><span class="s2">call</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSourceIndexByFilename</span><span class="s0">, </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">)) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSourceIndexByFilename</span><span class="s0">[</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">] = </span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources</span><span class="s0">.</span><span class="s2">length</span><span class="s0">;</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources</span><span class="s0">.</span><span class="s2">push</span><span class="s0">({ </span><span class="s2">filename</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">, </span><span class="s2">content</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">original </span><span class="s0">});</span>
			<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
				<span class="s1">var </span><span class="s2">uniqueSource </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources</span><span class="s0">[</span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSourceIndexByFilename</span><span class="s0">[</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">]];</span>
				<span class="s1">if </span><span class="s0">(</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">original </span><span class="s0">!== </span><span class="s2">uniqueSource</span><span class="s0">.</span><span class="s2">content</span><span class="s0">) {</span>
					<span class="s1">throw new </span><span class="s2">Error</span><span class="s0">((</span><span class="s3">&quot;Illegal source: same filename (&quot; </span><span class="s0">+ (</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">) + </span><span class="s3">&quot;), different contents&quot;</span><span class="s0">));</span>
				<span class="s0">}</span>
			<span class="s0">}</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">source</span><span class="s0">);</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">append </span><span class="s0">= </span><span class="s1">function </span><span class="s2">append </span><span class="s0">(</span><span class="s2">str</span><span class="s0">, </span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">addSource</span><span class="s0">({</span>
			<span class="s2">content</span><span class="s0">: </span><span class="s1">new </span><span class="s2">MagicString</span><span class="s0">(</span><span class="s2">str</span><span class="s0">),</span>
			<span class="s2">separator</span><span class="s0">: (</span><span class="s2">options </span><span class="s0">&amp;&amp; </span><span class="s2">options</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">) || </span><span class="s3">''</span><span class="s0">,</span>
		<span class="s0">});</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">clone </span><span class="s0">= </span><span class="s1">function </span><span class="s2">clone </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">bundle </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Bundle</span><span class="s0">({</span>
			<span class="s2">intro</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">,</span>
			<span class="s2">separator</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">,</span>
		<span class="s0">});</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
			<span class="s2">bundle</span><span class="s0">.</span><span class="s2">addSource</span><span class="s0">({</span>
				<span class="s2">filename</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">,</span>
				<span class="s2">content</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">clone</span><span class="s0">(),</span>
				<span class="s2">separator</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">,</span>
			<span class="s0">});</span>
		<span class="s0">});</span>

		<span class="s1">return </span><span class="s2">bundle</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">generateDecodedMap </span><span class="s0">= </span><span class="s1">function </span><span class="s2">generateDecodedMap </span><span class="s0">(</span><span class="s2">options</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">this$1$1 </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>
			<span class="s1">if </span><span class="s0">( </span><span class="s2">options </span><span class="s0">=== </span><span class="s1">void </span><span class="s4">0 </span><span class="s0">) </span><span class="s2">options </span><span class="s0">= {};</span>

		<span class="s1">var </span><span class="s2">names </span><span class="s0">= [];</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
			<span class="s2">Object</span><span class="s0">.</span><span class="s2">keys</span><span class="s0">(</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">storedNames</span><span class="s0">).</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">name</span><span class="s0">) {</span>
				<span class="s1">if </span><span class="s0">(!~</span><span class="s2">names</span><span class="s0">.</span><span class="s2">indexOf</span><span class="s0">(</span><span class="s2">name</span><span class="s0">)) { </span><span class="s2">names</span><span class="s0">.</span><span class="s2">push</span><span class="s0">(</span><span class="s2">name</span><span class="s0">); }</span>
			<span class="s0">});</span>
		<span class="s0">});</span>

		<span class="s1">var </span><span class="s2">mappings </span><span class="s0">= </span><span class="s1">new </span><span class="s2">Mappings</span><span class="s0">(</span><span class="s2">options</span><span class="s0">.</span><span class="s2">hires</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">) {</span>
			<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">);</span>
		<span class="s0">}</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">, </span><span class="s2">i</span><span class="s0">) {</span>
			<span class="s1">if </span><span class="s0">(</span><span class="s2">i </span><span class="s0">&gt; </span><span class="s4">0</span><span class="s0">) {</span>
				<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">);</span>
			<span class="s0">}</span>

			<span class="s1">var </span><span class="s2">sourceIndex </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename </span><span class="s0">? </span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">uniqueSourceIndexByFilename</span><span class="s0">[</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">] : -</span><span class="s4">1</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">magicString </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">locate </span><span class="s0">= </span><span class="s2">getLocator</span><span class="s0">(</span><span class="s2">magicString</span><span class="s0">.</span><span class="s2">original</span><span class="s0">);</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">magicString</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">) {</span>
				<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">magicString</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">);</span>
			<span class="s0">}</span>

			<span class="s2">magicString</span><span class="s0">.</span><span class="s2">firstChunk</span><span class="s0">.</span><span class="s2">eachNext</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">) {</span>
				<span class="s1">var </span><span class="s2">loc </span><span class="s0">= </span><span class="s2">locate</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">start</span><span class="s0">);</span>

				<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">); }</span>

				<span class="s1">if </span><span class="s0">(</span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">) {</span>
					<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">edited</span><span class="s0">) {</span>
						<span class="s2">mappings</span><span class="s0">.</span><span class="s2">addEdit</span><span class="s0">(</span>
							<span class="s2">sourceIndex</span><span class="s0">,</span>
							<span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">,</span>
							<span class="s2">loc</span><span class="s0">,</span>
							<span class="s2">chunk</span><span class="s0">.</span><span class="s2">storeName </span><span class="s0">? </span><span class="s2">names</span><span class="s0">.</span><span class="s2">indexOf</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">original</span><span class="s0">) : -</span><span class="s4">1</span>
						<span class="s0">);</span>
					<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
						<span class="s2">mappings</span><span class="s0">.</span><span class="s2">addUneditedChunk</span><span class="s0">(</span>
							<span class="s2">sourceIndex</span><span class="s0">,</span>
							<span class="s2">chunk</span><span class="s0">,</span>
							<span class="s2">magicString</span><span class="s0">.</span><span class="s2">original</span><span class="s0">,</span>
							<span class="s2">loc</span><span class="s0">,</span>
							<span class="s2">magicString</span><span class="s0">.</span><span class="s2">sourcemapLocations</span>
						<span class="s0">);</span>
					<span class="s0">}</span>
				<span class="s0">} </span><span class="s1">else </span><span class="s0">{</span>
					<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">content</span><span class="s0">);</span>
				<span class="s0">}</span>

				<span class="s1">if </span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) { </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">chunk</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">); }</span>
			<span class="s0">});</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">magicString</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">) {</span>
				<span class="s2">mappings</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">(</span><span class="s2">magicString</span><span class="s0">.</span><span class="s2">outro</span><span class="s0">);</span>
			<span class="s0">}</span>
		<span class="s0">});</span>

		<span class="s1">return </span><span class="s0">{</span>
			<span class="s2">file</span><span class="s0">: </span><span class="s2">options</span><span class="s0">.</span><span class="s2">file </span><span class="s0">? </span><span class="s2">options</span><span class="s0">.</span><span class="s2">file</span><span class="s0">.</span><span class="s2">split</span><span class="s0">(</span><span class="s6">/[/\\]/</span><span class="s0">).</span><span class="s2">pop</span><span class="s0">() : </span><span class="s1">null</span><span class="s0">,</span>
			<span class="s2">sources</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources</span><span class="s0">.</span><span class="s2">map</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
				<span class="s1">return </span><span class="s2">options</span><span class="s0">.</span><span class="s2">file </span><span class="s0">? </span><span class="s2">getRelativePath</span><span class="s0">(</span><span class="s2">options</span><span class="s0">.</span><span class="s2">file</span><span class="s0">, </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">) : </span><span class="s2">source</span><span class="s0">.</span><span class="s2">filename</span><span class="s0">;</span>
			<span class="s0">}),</span>
			<span class="s2">sourcesContent</span><span class="s0">: </span><span class="s1">this</span><span class="s0">.</span><span class="s2">uniqueSources</span><span class="s0">.</span><span class="s2">map</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
				<span class="s1">return </span><span class="s2">options</span><span class="s0">.</span><span class="s2">includeContent </span><span class="s0">? </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content </span><span class="s0">: </span><span class="s1">null</span><span class="s0">;</span>
			<span class="s0">}),</span>
			<span class="s2">names</span><span class="s0">: </span><span class="s2">names</span><span class="s0">,</span>
			<span class="s2">mappings</span><span class="s0">: </span><span class="s2">mappings</span><span class="s0">.</span><span class="s2">raw</span><span class="s0">,</span>
		<span class="s0">};</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">generateMap </span><span class="s0">= </span><span class="s1">function </span><span class="s2">generateMap </span><span class="s0">(</span><span class="s2">options</span><span class="s0">) {</span>
		<span class="s1">return new </span><span class="s2">SourceMap</span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">generateDecodedMap</span><span class="s0">(</span><span class="s2">options</span><span class="s0">));</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">getIndentString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">getIndentString </span><span class="s0">() {</span>
		<span class="s1">var </span><span class="s2">indentStringCounts </span><span class="s0">= {};</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">indentStr </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">indentStr</span><span class="s0">;</span>

			<span class="s1">if </span><span class="s0">(</span><span class="s2">indentStr </span><span class="s0">=== </span><span class="s1">null</span><span class="s0">) { </span><span class="s1">return</span><span class="s0">; }</span>

			<span class="s1">if </span><span class="s0">(!</span><span class="s2">indentStringCounts</span><span class="s0">[</span><span class="s2">indentStr</span><span class="s0">]) { </span><span class="s2">indentStringCounts</span><span class="s0">[</span><span class="s2">indentStr</span><span class="s0">] = </span><span class="s4">0</span><span class="s0">; }</span>
			<span class="s2">indentStringCounts</span><span class="s0">[</span><span class="s2">indentStr</span><span class="s0">] += </span><span class="s4">1</span><span class="s0">;</span>
		<span class="s0">});</span>

		<span class="s1">return </span><span class="s0">(</span>
			<span class="s2">Object</span><span class="s0">.</span><span class="s2">keys</span><span class="s0">(</span><span class="s2">indentStringCounts</span><span class="s0">).</span><span class="s2">sort</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">a</span><span class="s0">, </span><span class="s2">b</span><span class="s0">) {</span>
				<span class="s1">return </span><span class="s2">indentStringCounts</span><span class="s0">[</span><span class="s2">a</span><span class="s0">] - </span><span class="s2">indentStringCounts</span><span class="s0">[</span><span class="s2">b</span><span class="s0">];</span>
			<span class="s0">})[</span><span class="s4">0</span><span class="s0">] || </span><span class="s3">'</span><span class="s1">\t</span><span class="s3">'</span>
		<span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">indent </span><span class="s0">= </span><span class="s1">function </span><span class="s2">indent </span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">this$1$1 </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>

		<span class="s1">if </span><span class="s0">(!</span><span class="s2">arguments</span><span class="s0">.</span><span class="s2">length</span><span class="s0">) {</span>
			<span class="s2">indentStr </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">getIndentString</span><span class="s0">();</span>
		<span class="s0">}</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s2">indentStr </span><span class="s0">=== </span><span class="s3">''</span><span class="s0">) { </span><span class="s1">return this</span><span class="s0">; } </span><span class="s5">// noop</span>

		<span class="s1">var </span><span class="s2">trailingNewline </span><span class="s0">= !</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">|| </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">slice</span><span class="s0">(-</span><span class="s4">1</span><span class="s0">) === </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">;</span>

		<span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">forEach</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">, </span><span class="s2">i</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">separator </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">: </span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">indentStart </span><span class="s0">= </span><span class="s2">trailingNewline </span><span class="s0">|| (</span><span class="s2">i </span><span class="s0">&gt; </span><span class="s4">0 </span><span class="s0">&amp;&amp; </span><span class="s6">/\r?\n$/</span><span class="s0">.</span><span class="s2">test</span><span class="s0">(</span><span class="s2">separator</span><span class="s0">));</span>

			<span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">indent</span><span class="s0">(</span><span class="s2">indentStr</span><span class="s0">, {</span>
				<span class="s2">exclude</span><span class="s0">: </span><span class="s2">source</span><span class="s0">.</span><span class="s2">indentExclusionRanges</span><span class="s0">,</span>
				<span class="s2">indentStart</span><span class="s0">: </span><span class="s2">indentStart</span><span class="s0">, </span><span class="s5">//: trailingNewline || /\r?\n$/.test( separator )  //true///\r?\n/.test( separator )</span>
			<span class="s0">});</span>

			<span class="s2">trailingNewline </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">lastChar</span><span class="s0">() === </span><span class="s3">'</span><span class="s1">\n</span><span class="s3">'</span><span class="s0">;</span>
		<span class="s0">});</span>

		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">) {</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">=</span>
				<span class="s2">indentStr </span><span class="s0">+</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s6">/^[^\n]/gm</span><span class="s0">, </span><span class="s1">function </span><span class="s0">(</span><span class="s2">match</span><span class="s0">, </span><span class="s2">index</span><span class="s0">) {</span>
					<span class="s1">return </span><span class="s2">index </span><span class="s0">&gt; </span><span class="s4">0 </span><span class="s0">? </span><span class="s2">indentStr </span><span class="s0">+ </span><span class="s2">match </span><span class="s0">: </span><span class="s2">match</span><span class="s0">;</span>
				<span class="s0">});</span>
		<span class="s0">}</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">prepend </span><span class="s0">= </span><span class="s1">function </span><span class="s2">prepend </span><span class="s0">(</span><span class="s2">str</span><span class="s0">) {</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s2">str </span><span class="s0">+ </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">;</span>
		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">toString </span><span class="s0">= </span><span class="s1">function </span><span class="s2">toString </span><span class="s0">() {</span>
			<span class="s1">var </span><span class="s2">this$1$1 </span><span class="s0">= </span><span class="s1">this</span><span class="s0">;</span>

		<span class="s1">var </span><span class="s2">body </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span>
			<span class="s0">.</span><span class="s2">map</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">, </span><span class="s2">i</span><span class="s0">) {</span>
				<span class="s1">var </span><span class="s2">separator </span><span class="s0">= </span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">!== </span><span class="s2">undefined </span><span class="s0">? </span><span class="s2">source</span><span class="s0">.</span><span class="s2">separator </span><span class="s0">: </span><span class="s2">this$1$1</span><span class="s0">.</span><span class="s2">separator</span><span class="s0">;</span>
				<span class="s1">var </span><span class="s2">str </span><span class="s0">= (</span><span class="s2">i </span><span class="s0">&gt; </span><span class="s4">0 </span><span class="s0">? </span><span class="s2">separator </span><span class="s0">: </span><span class="s3">''</span><span class="s0">) + </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">toString</span><span class="s0">();</span>

				<span class="s1">return </span><span class="s2">str</span><span class="s0">;</span>
			<span class="s0">})</span>
			<span class="s0">.</span><span class="s2">join</span><span class="s0">(</span><span class="s3">''</span><span class="s0">);</span>

		<span class="s1">return this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">+ </span><span class="s2">body</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">isEmpty </span><span class="s0">= </span><span class="s1">function </span><span class="s2">isEmpty </span><span class="s0">() {</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length </span><span class="s0">&amp;&amp; </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">()) { </span><span class="s1">return false</span><span class="s0">; }</span>
		<span class="s1">if </span><span class="s0">(</span><span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">some</span><span class="s0">(</span><span class="s1">function </span><span class="s0">(</span><span class="s2">source</span><span class="s0">) { </span><span class="s1">return </span><span class="s0">!</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">isEmpty</span><span class="s0">(); })) { </span><span class="s1">return false</span><span class="s0">; }</span>
		<span class="s1">return true</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">length </span><span class="s0">= </span><span class="s1">function </span><span class="s2">length </span><span class="s0">() {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">reduce</span><span class="s0">(</span>
			<span class="s1">function </span><span class="s0">(</span><span class="s2">length</span><span class="s0">, </span><span class="s2">source</span><span class="s0">) { </span><span class="s1">return </span><span class="s2">length </span><span class="s0">+ </span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">length</span><span class="s0">(); },</span>
			<span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">length</span>
		<span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimLines </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimLines </span><span class="s0">() {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">trim</span><span class="s0">(</span><span class="s3">'[</span><span class="s1">\\</span><span class="s3">r</span><span class="s1">\\</span><span class="s3">n]'</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trim </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trim </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">return this</span><span class="s0">.</span><span class="s2">trimStart</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">).</span><span class="s2">trimEnd</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">);</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimStart </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimStart </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">rx </span><span class="s0">= </span><span class="s1">new </span><span class="s2">RegExp</span><span class="s0">(</span><span class="s3">'^' </span><span class="s0">+ (</span><span class="s2">charType </span><span class="s0">|| </span><span class="s3">'</span><span class="s1">\\</span><span class="s3">s'</span><span class="s0">) + </span><span class="s3">'+'</span><span class="s0">);</span>
		<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>

		<span class="s1">if </span><span class="s0">(!</span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">) {</span>
			<span class="s1">var </span><span class="s2">source</span><span class="s0">;</span>
			<span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s4">0</span><span class="s0">;</span>

			<span class="s1">do </span><span class="s0">{</span>
				<span class="s2">source </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">[</span><span class="s2">i</span><span class="s0">++];</span>
				<span class="s1">if </span><span class="s0">(!</span><span class="s2">source</span><span class="s0">) {</span>
					<span class="s1">break</span><span class="s0">;</span>
				<span class="s0">}</span>
			<span class="s0">} </span><span class="s1">while </span><span class="s0">(!</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">trimStartAborted</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">));</span>
		<span class="s0">}</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">Bundle</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">trimEnd </span><span class="s0">= </span><span class="s1">function </span><span class="s2">trimEnd </span><span class="s0">(</span><span class="s2">charType</span><span class="s0">) {</span>
		<span class="s1">var </span><span class="s2">rx </span><span class="s0">= </span><span class="s1">new </span><span class="s2">RegExp</span><span class="s0">((</span><span class="s2">charType </span><span class="s0">|| </span><span class="s3">'</span><span class="s1">\\</span><span class="s3">s'</span><span class="s0">) + </span><span class="s3">'+$'</span><span class="s0">);</span>

		<span class="s1">var </span><span class="s2">source</span><span class="s0">;</span>
		<span class="s1">var </span><span class="s2">i </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">.</span><span class="s2">length </span><span class="s0">- </span><span class="s4">1</span><span class="s0">;</span>

		<span class="s1">do </span><span class="s0">{</span>
			<span class="s2">source </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">sources</span><span class="s0">[</span><span class="s2">i</span><span class="s0">--];</span>
			<span class="s1">if </span><span class="s0">(!</span><span class="s2">source</span><span class="s0">) {</span>
				<span class="s1">this</span><span class="s0">.</span><span class="s2">intro </span><span class="s0">= </span><span class="s1">this</span><span class="s0">.</span><span class="s2">intro</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s2">rx</span><span class="s0">, </span><span class="s3">''</span><span class="s0">);</span>
				<span class="s1">break</span><span class="s0">;</span>
			<span class="s0">}</span>
		<span class="s0">} </span><span class="s1">while </span><span class="s0">(!</span><span class="s2">source</span><span class="s0">.</span><span class="s2">content</span><span class="s0">.</span><span class="s2">trimEndAborted</span><span class="s0">(</span><span class="s2">charType</span><span class="s0">));</span>

		<span class="s1">return this</span><span class="s0">;</span>
	<span class="s0">};</span>

	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">Bundle </span><span class="s0">= </span><span class="s2">Bundle</span><span class="s0">;</span>
	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">SourceMap </span><span class="s0">= </span><span class="s2">SourceMap</span><span class="s0">;</span>
	<span class="s2">MagicString</span><span class="s0">.</span><span class="s2">default </span><span class="s0">= </span><span class="s2">MagicString</span><span class="s0">; </span><span class="s5">// work around TypeScript bug https://github.com/Rich-Harris/magic-string/pull/121</span>

	<span class="s1">return </span><span class="s2">MagicString</span><span class="s0">;</span>

<span class="s0">}));</span>
<span class="s5">//# sourceMappingURL=magic-string.umd.js.map</span>
</pre>
</body>
</html>