<html>
<head>
<title>output.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #5f826b; font-style: italic;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #bcbec4;}
.s4 { color: #cf8e6d;}
.s5 { color: #2aacb8;}
.s6 { color: #42c3d4;}
.s7 { color: #7a7e85;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
output.js</font>
</center></td></tr></table>
<pre><span class="s0">/***********************************************************************</span>

  <span class="s0">A JavaScript tokenizer / parser / beautifier / compressor.</span>
  <span class="s0">https://github.com/mishoo/UglifyJS2</span>

  <span class="s0">-------------------------------- (C) ---------------------------------</span>

                           <span class="s0">Author: Mihai Bazon</span>
                         <span class="s0">&lt;mihai.bazon@gmail.com&gt;</span>
                       <span class="s0">http://mihai.bazon.net/blog</span>

  <span class="s0">Distributed under the BSD license:</span>

    <span class="s0">Copyright 2012 (c) Mihai Bazon &lt;mihai.bazon@gmail.com&gt;</span>

    <span class="s0">Redistribution and use in source and binary forms, with or without</span>
    <span class="s0">modification, are permitted provided that the following conditions</span>
    <span class="s0">are met:</span>

        <span class="s0">* Redistributions of source code must retain the above</span>
          <span class="s0">copyright notice, this list of conditions and the following</span>
          <span class="s0">disclaimer.</span>

        <span class="s0">* Redistributions in binary form must reproduce the above</span>
          <span class="s0">copyright notice, this list of conditions and the following</span>
          <span class="s0">disclaimer in the documentation and/or other materials</span>
          <span class="s0">provided with the distribution.</span>

    <span class="s0">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDER “AS IS” AND ANY</span>
    <span class="s0">EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
    <span class="s0">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
    <span class="s0">PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER BE</span>
    <span class="s0">LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,</span>
    <span class="s0">OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
    <span class="s0">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
    <span class="s0">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
    <span class="s0">THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR</span>
    <span class="s0">TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span>
    <span class="s0">THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
    <span class="s0">SUCH DAMAGE.</span>

 <span class="s0">***********************************************************************/</span>

<span class="s2">&quot;use strict&quot;</span><span class="s3">;</span>

<span class="s4">import </span><span class="s3">{</span>
    <span class="s1">defaults</span><span class="s3">,</span>
    <span class="s1">makePredicate</span><span class="s3">,</span>
    <span class="s1">noop</span><span class="s3">,</span>
    <span class="s1">regexp_source_fix</span><span class="s3">,</span>
    <span class="s1">sort_regexp_flags</span><span class="s3">,</span>
    <span class="s1">return_false</span><span class="s3">,</span>
    <span class="s1">return_true</span><span class="s3">,</span>
<span class="s3">} </span><span class="s1">from </span><span class="s2">&quot;./utils/index.js&quot;</span><span class="s3">;</span>
<span class="s4">import </span><span class="s3">{ </span><span class="s1">first_in_statement</span><span class="s3">, </span><span class="s1">left_is_object </span><span class="s3">} </span><span class="s1">from </span><span class="s2">&quot;./utils/first_in_statement.js&quot;</span><span class="s3">;</span>
<span class="s4">import </span><span class="s3">{</span>
    <span class="s1">AST_Array</span><span class="s3">,</span>
    <span class="s1">AST_Arrow</span><span class="s3">,</span>
    <span class="s1">AST_Assign</span><span class="s3">,</span>
    <span class="s1">AST_Await</span><span class="s3">,</span>
    <span class="s1">AST_BigInt</span><span class="s3">,</span>
    <span class="s1">AST_Binary</span><span class="s3">,</span>
    <span class="s1">AST_BlockStatement</span><span class="s3">,</span>
    <span class="s1">AST_Break</span><span class="s3">,</span>
    <span class="s1">AST_Call</span><span class="s3">,</span>
    <span class="s1">AST_Case</span><span class="s3">,</span>
    <span class="s1">AST_Catch</span><span class="s3">,</span>
    <span class="s1">AST_Chain</span><span class="s3">,</span>
    <span class="s1">AST_Class</span><span class="s3">,</span>
    <span class="s1">AST_ClassExpression</span><span class="s3">,</span>
    <span class="s1">AST_ClassPrivateProperty</span><span class="s3">,</span>
    <span class="s1">AST_ClassProperty</span><span class="s3">,</span>
    <span class="s1">AST_ClassStaticBlock</span><span class="s3">,</span>
    <span class="s1">AST_ConciseMethod</span><span class="s3">,</span>
    <span class="s1">AST_PrivateGetter</span><span class="s3">,</span>
    <span class="s1">AST_PrivateMethod</span><span class="s3">,</span>
    <span class="s1">AST_SymbolPrivateProperty</span><span class="s3">,</span>
    <span class="s1">AST_PrivateSetter</span><span class="s3">,</span>
    <span class="s1">AST_PrivateIn</span><span class="s3">,</span>
    <span class="s1">AST_Conditional</span><span class="s3">,</span>
    <span class="s1">AST_Const</span><span class="s3">,</span>
    <span class="s1">AST_Constant</span><span class="s3">,</span>
    <span class="s1">AST_Continue</span><span class="s3">,</span>
    <span class="s1">AST_Debugger</span><span class="s3">,</span>
    <span class="s1">AST_Default</span><span class="s3">,</span>
    <span class="s1">AST_DefaultAssign</span><span class="s3">,</span>
    <span class="s1">AST_Definitions</span><span class="s3">,</span>
    <span class="s1">AST_Defun</span><span class="s3">,</span>
    <span class="s1">AST_Destructuring</span><span class="s3">,</span>
    <span class="s1">AST_Directive</span><span class="s3">,</span>
    <span class="s1">AST_Do</span><span class="s3">,</span>
    <span class="s1">AST_Dot</span><span class="s3">,</span>
    <span class="s1">AST_DotHash</span><span class="s3">,</span>
    <span class="s1">AST_EmptyStatement</span><span class="s3">,</span>
    <span class="s1">AST_Exit</span><span class="s3">,</span>
    <span class="s1">AST_Expansion</span><span class="s3">,</span>
    <span class="s1">AST_Export</span><span class="s3">,</span>
    <span class="s1">AST_Finally</span><span class="s3">,</span>
    <span class="s1">AST_For</span><span class="s3">,</span>
    <span class="s1">AST_ForIn</span><span class="s3">,</span>
    <span class="s1">AST_ForOf</span><span class="s3">,</span>
    <span class="s1">AST_Function</span><span class="s3">,</span>
    <span class="s1">AST_Hole</span><span class="s3">,</span>
    <span class="s1">AST_If</span><span class="s3">,</span>
    <span class="s1">AST_Import</span><span class="s3">,</span>
    <span class="s1">AST_ImportMeta</span><span class="s3">,</span>
    <span class="s1">AST_Jump</span><span class="s3">,</span>
    <span class="s1">AST_LabeledStatement</span><span class="s3">,</span>
    <span class="s1">AST_Lambda</span><span class="s3">,</span>
    <span class="s1">AST_Let</span><span class="s3">,</span>
    <span class="s1">AST_LoopControl</span><span class="s3">,</span>
    <span class="s1">AST_NameMapping</span><span class="s3">,</span>
    <span class="s1">AST_New</span><span class="s3">,</span>
    <span class="s1">AST_NewTarget</span><span class="s3">,</span>
    <span class="s1">AST_Node</span><span class="s3">,</span>
    <span class="s1">AST_Number</span><span class="s3">,</span>
    <span class="s1">AST_Object</span><span class="s3">,</span>
    <span class="s1">AST_ObjectGetter</span><span class="s3">,</span>
    <span class="s1">AST_ObjectKeyVal</span><span class="s3">,</span>
    <span class="s1">AST_ObjectProperty</span><span class="s3">,</span>
    <span class="s1">AST_ObjectSetter</span><span class="s3">,</span>
    <span class="s1">AST_PrefixedTemplateString</span><span class="s3">,</span>
    <span class="s1">AST_PropAccess</span><span class="s3">,</span>
    <span class="s1">AST_RegExp</span><span class="s3">,</span>
    <span class="s1">AST_Return</span><span class="s3">,</span>
    <span class="s1">AST_Scope</span><span class="s3">,</span>
    <span class="s1">AST_Sequence</span><span class="s3">,</span>
    <span class="s1">AST_SimpleStatement</span><span class="s3">,</span>
    <span class="s1">AST_Statement</span><span class="s3">,</span>
    <span class="s1">AST_StatementWithBody</span><span class="s3">,</span>
    <span class="s1">AST_String</span><span class="s3">,</span>
    <span class="s1">AST_Sub</span><span class="s3">,</span>
    <span class="s1">AST_Super</span><span class="s3">,</span>
    <span class="s1">AST_Switch</span><span class="s3">,</span>
    <span class="s1">AST_SwitchBranch</span><span class="s3">,</span>
    <span class="s1">AST_Symbol</span><span class="s3">,</span>
    <span class="s1">AST_SymbolClassProperty</span><span class="s3">,</span>
    <span class="s1">AST_SymbolMethod</span><span class="s3">,</span>
    <span class="s1">AST_SymbolRef</span><span class="s3">,</span>
    <span class="s1">AST_TemplateSegment</span><span class="s3">,</span>
    <span class="s1">AST_TemplateString</span><span class="s3">,</span>
    <span class="s1">AST_This</span><span class="s3">,</span>
    <span class="s1">AST_Throw</span><span class="s3">,</span>
    <span class="s1">AST_Toplevel</span><span class="s3">,</span>
    <span class="s1">AST_Try</span><span class="s3">,</span>
    <span class="s1">AST_TryBlock</span><span class="s3">,</span>
    <span class="s1">AST_Unary</span><span class="s3">,</span>
    <span class="s1">AST_UnaryPostfix</span><span class="s3">,</span>
    <span class="s1">AST_UnaryPrefix</span><span class="s3">,</span>
    <span class="s1">AST_Var</span><span class="s3">,</span>
    <span class="s1">AST_VarDef</span><span class="s3">,</span>
    <span class="s1">AST_While</span><span class="s3">,</span>
    <span class="s1">AST_With</span><span class="s3">,</span>
    <span class="s1">AST_Yield</span><span class="s3">,</span>
    <span class="s1">TreeWalker</span><span class="s3">,</span>
    <span class="s1">walk</span><span class="s3">,</span>
    <span class="s1">walk_abort</span>
<span class="s3">} </span><span class="s1">from </span><span class="s2">&quot;./ast.js&quot;</span><span class="s3">;</span>
<span class="s4">import </span><span class="s3">{</span>
    <span class="s1">get_full_char_code</span><span class="s3">,</span>
    <span class="s1">get_full_char</span><span class="s3">,</span>
    <span class="s1">is_identifier_char</span><span class="s3">,</span>
    <span class="s1">is_basic_identifier_string</span><span class="s3">,</span>
    <span class="s1">is_identifier_string</span><span class="s3">,</span>
    <span class="s1">PRECEDENCE</span><span class="s3">,</span>
    <span class="s1">ALL_RESERVED_WORDS</span><span class="s3">,</span>
<span class="s3">} </span><span class="s1">from </span><span class="s2">&quot;./parse.js&quot;</span><span class="s3">;</span>

<span class="s4">const </span><span class="s1">CODE_LINE_BREAK </span><span class="s3">= </span><span class="s5">10</span><span class="s3">;</span>
<span class="s4">const </span><span class="s1">CODE_SPACE </span><span class="s3">= </span><span class="s5">32</span><span class="s3">;</span>

<span class="s4">const </span><span class="s1">r_annotation </span><span class="s3">= </span><span class="s6">/[@#]__(PURE|INLINE|NOINLINE)__/</span><span class="s3">;</span>

<span class="s4">function </span><span class="s1">is_some_comments</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">) {</span>
    <span class="s7">// multiline comment</span>
    <span class="s4">return </span><span class="s3">(</span>
        <span class="s3">(</span><span class="s1">comment</span><span class="s3">.</span><span class="s1">type </span><span class="s3">=== </span><span class="s2">&quot;comment2&quot; </span><span class="s3">|| </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">type </span><span class="s3">=== </span><span class="s2">&quot;comment1&quot;</span><span class="s3">)</span>
        <span class="s3">&amp;&amp; </span><span class="s6">/@preserve|@copyright|@lic|@cc_on|^\**!/i</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)</span>
    <span class="s3">);</span>
<span class="s3">}</span>

<span class="s4">const </span><span class="s1">ROPE_COMMIT_WHEN </span><span class="s3">= </span><span class="s5">8 </span><span class="s3">* </span><span class="s5">1000</span><span class="s3">;</span>
<span class="s4">class </span><span class="s1">Rope </span><span class="s3">{</span>
    <span class="s1">constructor</span><span class="s3">() {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">= </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">current </span><span class="s3">= </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">append</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
        <span class="s0">/** When `this.current` is too long, commit it. */</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">current</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s1">ROPE_COMMIT_WHEN</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">+= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">current </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">;</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">current </span><span class="s3">= </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">current </span><span class="s3">+= </span><span class="s1">str</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s1">insertAt</span><span class="s3">(</span><span class="s1">char</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) {</span>
        <span class="s4">const </span><span class="s3">{ </span><span class="s1">committed</span><span class="s3">, </span><span class="s1">current </span><span class="s3">} = </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&lt; </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">= </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) + </span><span class="s1">char </span><span class="s3">+ </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">=== </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">+= </span><span class="s1">char</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">index </span><span class="s3">-= </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">+= </span><span class="s1">current</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) + </span><span class="s1">char</span><span class="s3">;</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">current </span><span class="s3">= </span><span class="s1">current</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s1">charAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
        <span class="s4">const </span><span class="s3">{ </span><span class="s1">committed </span><span class="s3">} = </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&lt; </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) </span><span class="s4">return </span><span class="s1">committed</span><span class="s3">[</span><span class="s1">index</span><span class="s3">];</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">current</span><span class="s3">[</span><span class="s1">index </span><span class="s3">- </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">];</span>
    <span class="s3">}</span>

    <span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">) {</span>
        <span class="s4">const </span><span class="s3">{ </span><span class="s1">committed </span><span class="s3">} = </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&lt; </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) </span><span class="s4">return </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">index</span><span class="s3">);</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">current</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">index </span><span class="s3">- </span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s1">length</span><span class="s3">() {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">committed</span><span class="s3">.</span><span class="s1">length </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">current</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">expectDirective</span><span class="s3">() {</span>
        <span class="s7">// /^$|[;{][\s\n]*$/</span>

        <span class="s4">let </span><span class="s1">ch</span><span class="s3">, </span><span class="s1">n </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">length</span><span class="s3">();</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">n </span><span class="s3">&lt;= </span><span class="s5">0</span><span class="s3">) </span><span class="s4">return true</span><span class="s3">;</span>

        <span class="s7">// Skip N whitespace from the end</span>
        <span class="s4">while </span><span class="s3">(</span>
            <span class="s3">(</span><span class="s1">ch </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(--</span><span class="s1">n</span><span class="s3">))</span>
            <span class="s3">&amp;&amp; (</span><span class="s1">ch </span><span class="s3">== </span><span class="s1">CODE_SPACE </span><span class="s3">|| </span><span class="s1">ch </span><span class="s3">== </span><span class="s1">CODE_LINE_BREAK</span><span class="s3">)</span>
        <span class="s3">);</span>

        <span class="s7">// either &quot;;&quot;, or &quot;{&quot;, or the string ended</span>
        <span class="s4">return </span><span class="s3">!</span><span class="s1">ch </span><span class="s3">|| </span><span class="s1">ch </span><span class="s3">=== </span><span class="s5">59 </span><span class="s3">|| </span><span class="s1">ch </span><span class="s3">=== </span><span class="s5">123</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">hasNLB</span><span class="s3">() {</span>
        <span class="s4">let </span><span class="s1">n </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">length</span><span class="s3">() - </span><span class="s5">1</span><span class="s3">;</span>
        <span class="s4">while </span><span class="s3">(</span><span class="s1">n </span><span class="s3">&gt;= </span><span class="s5">0</span><span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">code </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">n</span><span class="s3">--);</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">code </span><span class="s3">=== </span><span class="s1">CODE_LINE_BREAK</span><span class="s3">) </span><span class="s4">return true</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">code </span><span class="s3">!== </span><span class="s1">CODE_SPACE</span><span class="s3">) </span><span class="s4">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">}</span>


    <span class="s1">toString</span><span class="s3">() {</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">committed </span><span class="s3">+ </span><span class="s4">this</span><span class="s3">.</span><span class="s1">current</span><span class="s3">;</span>
    <span class="s3">}</span>
<span class="s3">}</span>

<span class="s4">function </span><span class="s1">OutputStream</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>

    <span class="s4">var </span><span class="s1">readonly </span><span class="s3">= !</span><span class="s1">options</span><span class="s3">;</span>
    <span class="s1">options </span><span class="s3">= </span><span class="s1">defaults</span><span class="s3">(</span><span class="s1">options</span><span class="s3">, {</span>
        <span class="s1">ascii_only           </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">beautify             </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">braces               </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">comments             </span><span class="s3">: </span><span class="s2">&quot;some&quot;</span><span class="s3">,</span>
        <span class="s1">ecma                 </span><span class="s3">: </span><span class="s5">5</span><span class="s3">,</span>
        <span class="s1">ie8                  </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">indent_level         </span><span class="s3">: </span><span class="s5">4</span><span class="s3">,</span>
        <span class="s1">indent_start         </span><span class="s3">: </span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">inline_script        </span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
        <span class="s1">keep_numbers         </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">keep_quoted_props    </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">max_line_len         </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">preamble             </span><span class="s3">: </span><span class="s4">null</span><span class="s3">,</span>
        <span class="s1">preserve_annotations </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">quote_keys           </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">quote_style          </span><span class="s3">: </span><span class="s5">0</span><span class="s3">,</span>
        <span class="s1">safari10             </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">semicolons           </span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
        <span class="s1">shebang              </span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>
        <span class="s1">shorthand            </span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
        <span class="s1">source_map           </span><span class="s3">: </span><span class="s4">null</span><span class="s3">,</span>
        <span class="s1">webkit               </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">width                </span><span class="s3">: </span><span class="s5">80</span><span class="s3">,</span>
        <span class="s1">wrap_iife            </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">wrap_func_args       </span><span class="s3">: </span><span class="s4">true</span><span class="s3">,</span>

        <span class="s1">_destroy_ast         </span><span class="s3">: </span><span class="s4">false</span>
    <span class="s3">}, </span><span class="s4">true</span><span class="s3">);</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">shorthand </span><span class="s3">=== </span><span class="s1">undefined</span><span class="s3">)</span>
        <span class="s1">options</span><span class="s3">.</span><span class="s1">shorthand </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">ecma </span><span class="s3">&gt; </span><span class="s5">5</span><span class="s3">;</span>

    <span class="s7">// Convert comment option to RegExp if necessary and set up comments filter</span>
    <span class="s4">var </span><span class="s1">comment_filter </span><span class="s3">= </span><span class="s1">return_false</span><span class="s3">; </span><span class="s7">// Default case, throw all comments away</span>
    <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">) {</span>
        <span class="s4">let </span><span class="s1">comments </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">options</span><span class="s3">.</span><span class="s1">comments </span><span class="s3">=== </span><span class="s2">&quot;string&quot; </span><span class="s3">&amp;&amp; </span><span class="s6">/^\/.*\/[a-zA-Z]*$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">regex_pos </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">.</span><span class="s1">lastIndexOf</span><span class="s3">(</span><span class="s2">&quot;/&quot;</span><span class="s3">);</span>
            <span class="s1">comments </span><span class="s3">= </span><span class="s4">new </span><span class="s1">RegExp</span><span class="s3">(</span>
                <span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">.</span><span class="s1">substr</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">regex_pos </span><span class="s3">- </span><span class="s5">1</span><span class="s3">),</span>
                <span class="s1">options</span><span class="s3">.</span><span class="s1">comments</span><span class="s3">.</span><span class="s1">substr</span><span class="s3">(</span><span class="s1">regex_pos </span><span class="s3">+ </span><span class="s5">1</span><span class="s3">)</span>
            <span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">comments </span><span class="s4">instanceof </span><span class="s1">RegExp</span><span class="s3">) {</span>
            <span class="s1">comment_filter </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">) {</span>
                <span class="s4">return </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">type </span><span class="s3">!= </span><span class="s2">&quot;comment5&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
            <span class="s3">};</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s4">typeof </span><span class="s1">comments </span><span class="s3">=== </span><span class="s2">&quot;function&quot;</span><span class="s3">) {</span>
            <span class="s1">comment_filter </span><span class="s3">= </span><span class="s4">function</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">) {</span>
                <span class="s4">return </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">type </span><span class="s3">!= </span><span class="s2">&quot;comment5&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">comments</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">comment</span><span class="s3">);</span>
            <span class="s3">};</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">comments </span><span class="s3">=== </span><span class="s2">&quot;some&quot;</span><span class="s3">) {</span>
            <span class="s1">comment_filter </span><span class="s3">= </span><span class="s1">is_some_comments</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{ </span><span class="s7">// NOTE includes &quot;all&quot; option</span>
            <span class="s1">comment_filter </span><span class="s3">= </span><span class="s1">return_true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">preserve_annotations</span><span class="s3">) {</span>
        <span class="s4">let </span><span class="s1">prev_comment_filter </span><span class="s3">= </span><span class="s1">comment_filter</span><span class="s3">;</span>
        <span class="s1">comment_filter </span><span class="s3">= </span><span class="s4">function </span><span class="s3">(</span><span class="s1">comment</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">r_annotation</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) || </span><span class="s1">prev_comment_filter</span><span class="s3">.</span><span class="s1">apply</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">arguments</span><span class="s3">);</span>
        <span class="s3">};</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">indentation </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">current_col </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">current_line </span><span class="s3">= </span><span class="s5">1</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">current_pos </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">OUTPUT </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Rope</span><span class="s3">();</span>
    <span class="s4">let </span><span class="s1">printed_comments </span><span class="s3">= </span><span class="s4">new </span><span class="s1">Set</span><span class="s3">();</span>

    <span class="s4">var </span><span class="s1">to_utf8 </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">ascii_only </span><span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">identifier </span><span class="s3">= </span><span class="s4">false</span><span class="s3">, </span><span class="s1">regexp </span><span class="s3">= </span><span class="s4">false</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">ecma </span><span class="s3">&gt;= </span><span class="s5">2015 </span><span class="s3">&amp;&amp; !</span><span class="s1">options</span><span class="s3">.</span><span class="s1">safari10 </span><span class="s3">&amp;&amp; !</span><span class="s1">regexp</span><span class="s3">) {</span>
            <span class="s1">str </span><span class="s3">= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/[\ud800-\udbff][\udc00-\udfff]/g</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">code </span><span class="s3">= </span><span class="s1">get_full_char_code</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">, </span><span class="s5">0</span><span class="s3">).</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">16</span><span class="s3">);</span>
                <span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">u{&quot; </span><span class="s3">+ </span><span class="s1">code </span><span class="s3">+ </span><span class="s2">&quot;}&quot;</span><span class="s3">;</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/[\u0000-\u001f\u007f-\uffff]/g</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">code </span><span class="s3">= </span><span class="s1">ch</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s5">0</span><span class="s3">).</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">16</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">code</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt;= </span><span class="s5">2 </span><span class="s3">&amp;&amp; !</span><span class="s1">identifier</span><span class="s3">) {</span>
                <span class="s4">while </span><span class="s3">(</span><span class="s1">code</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt; </span><span class="s5">2</span><span class="s3">) </span><span class="s1">code </span><span class="s3">= </span><span class="s2">&quot;0&quot; </span><span class="s3">+ </span><span class="s1">code</span><span class="s3">;</span>
                <span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">x&quot; </span><span class="s3">+ </span><span class="s1">code</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">while </span><span class="s3">(</span><span class="s1">code</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&lt; </span><span class="s5">4</span><span class="s3">) </span><span class="s1">code </span><span class="s3">= </span><span class="s2">&quot;0&quot; </span><span class="s3">+ </span><span class="s1">code</span><span class="s3">;</span>
                <span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">u&quot; </span><span class="s3">+ </span><span class="s1">code</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
    <span class="s3">} : </span><span class="s4">function</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/[\ud800-\udbff][\udc00-\udfff]|([\ud800-\udbff]|[\udc00-\udfff])/g</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">match</span><span class="s3">, </span><span class="s1">lone</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">lone</span><span class="s3">) {</span>
                <span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">u&quot; </span><span class="s3">+ </span><span class="s1">lone</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s5">0</span><span class="s3">).</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">16</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s4">return </span><span class="s1">match</span><span class="s3">;</span>
        <span class="s3">});</span>
    <span class="s3">};</span>

    <span class="s4">function </span><span class="s1">make_string</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">dq </span><span class="s3">= </span><span class="s5">0</span><span class="s3">, </span><span class="s1">sq </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/[\\\b\f\n\r\v\t\x22\x27\u2028\u2029\0\ufeff]/g</span><span class="s3">,</span>
          <span class="s4">function</span><span class="s3">(</span><span class="s1">s</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">switch </span><span class="s3">(</span><span class="s1">s</span><span class="s3">) {</span>
              <span class="s4">case </span><span class="s2">'&quot;'</span><span class="s3">: ++</span><span class="s1">dq</span><span class="s3">; </span><span class="s4">return </span><span class="s2">'&quot;'</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;'&quot;</span><span class="s3">: ++</span><span class="s1">sq</span><span class="s3">; </span><span class="s4">return </span><span class="s2">&quot;'&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\\\</span><span class="s2">&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">n&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\r</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">r&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\t</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">t&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\b</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">b&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\f</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">f&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\x0B</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s1">options</span><span class="s3">.</span><span class="s1">ie8 </span><span class="s3">? </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">x0B&quot; </span><span class="s3">: </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">v&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\u2028</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">u2028&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\u2029</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">u2029&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\ufeff</span><span class="s2">&quot;</span><span class="s3">: </span><span class="s4">return </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">ufeff&quot;</span><span class="s3">;</span>
              <span class="s4">case </span><span class="s2">&quot;</span><span class="s4">\0</span><span class="s2">&quot;</span><span class="s3">:</span>
                  <span class="s4">return </span><span class="s6">/[0-9]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">get_full_char</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">i</span><span class="s3">+</span><span class="s5">1</span><span class="s3">)) ? </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">x00&quot; </span><span class="s3">: </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">0&quot;</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">return </span><span class="s1">s</span><span class="s3">;</span>
        <span class="s3">});</span>
        <span class="s4">function </span><span class="s1">quote_single</span><span class="s3">() {</span>
            <span class="s4">return </span><span class="s2">&quot;'&quot; </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\x27/g</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">'&quot;</span><span class="s3">) + </span><span class="s2">&quot;'&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">function </span><span class="s1">quote_double</span><span class="s3">() {</span>
            <span class="s4">return </span><span class="s2">'&quot;' </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\x22/g</span><span class="s3">, </span><span class="s2">'</span><span class="s4">\\</span><span class="s2">&quot;'</span><span class="s3">) + </span><span class="s2">'&quot;'</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">function </span><span class="s1">quote_template</span><span class="s3">() {</span>
            <span class="s4">return </span><span class="s2">&quot;`&quot; </span><span class="s3">+ </span><span class="s1">str</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/`/g</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">`&quot;</span><span class="s3">) + </span><span class="s2">&quot;`&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s1">to_utf8</span><span class="s3">(</span><span class="s1">str</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">quote </span><span class="s3">=== </span><span class="s2">&quot;`&quot;</span><span class="s3">) </span><span class="s4">return </span><span class="s1">quote_template</span><span class="s3">();</span>
        <span class="s4">switch </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">quote_style</span><span class="s3">) {</span>
          <span class="s4">case </span><span class="s5">1</span><span class="s3">:</span>
            <span class="s4">return </span><span class="s1">quote_single</span><span class="s3">();</span>
          <span class="s4">case </span><span class="s5">2</span><span class="s3">:</span>
            <span class="s4">return </span><span class="s1">quote_double</span><span class="s3">();</span>
          <span class="s4">case </span><span class="s5">3</span><span class="s3">:</span>
            <span class="s4">return </span><span class="s1">quote </span><span class="s3">== </span><span class="s2">&quot;'&quot; </span><span class="s3">? </span><span class="s1">quote_single</span><span class="s3">() : </span><span class="s1">quote_double</span><span class="s3">();</span>
          <span class="s4">default</span><span class="s3">:</span>
            <span class="s4">return </span><span class="s1">dq </span><span class="s3">&gt; </span><span class="s1">sq </span><span class="s3">? </span><span class="s1">quote_single</span><span class="s3">() : </span><span class="s1">quote_double</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">encode_string</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">make_string</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">inline_script</span><span class="s3">) {</span>
            <span class="s1">ret </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/&lt;\x2f(script)([&gt;\/\t\n\f\r ])/gi</span><span class="s3">, </span><span class="s2">&quot;&lt;</span><span class="s4">\\</span><span class="s2">/$1$2&quot;</span><span class="s3">);</span>
            <span class="s1">ret </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\x3c!--/g</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">x3c!--&quot;</span><span class="s3">);</span>
            <span class="s1">ret </span><span class="s3">= </span><span class="s1">ret</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/--\x3e/g</span><span class="s3">, </span><span class="s2">&quot;--</span><span class="s4">\\</span><span class="s2">x3e&quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">make_name</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) {</span>
        <span class="s1">name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
        <span class="s1">name </span><span class="s3">= </span><span class="s1">to_utf8</span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">name</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">make_indent</span><span class="s3">(</span><span class="s1">back</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s2">&quot; &quot;</span><span class="s3">.</span><span class="s1">repeat</span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">indent_start </span><span class="s3">+ </span><span class="s1">indentation </span><span class="s3">- </span><span class="s1">back </span><span class="s3">* </span><span class="s1">options</span><span class="s3">.</span><span class="s1">indent_level</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s7">/* -----[ beautification/minification ]----- */</span>

    <span class="s4">var </span><span class="s1">has_parens </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">might_need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">might_need_semicolon </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">might_add_newline </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">need_newline_indented </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">newline_insert </span><span class="s3">= -</span><span class="s5">1</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">last </span><span class="s3">= </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
    <span class="s4">var </span><span class="s1">mapping_token</span><span class="s3">, </span><span class="s1">mapping_name</span><span class="s3">, </span><span class="s1">mappings </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">source_map </span><span class="s3">&amp;&amp; [];</span>

    <span class="s4">var </span><span class="s1">do_add_mapping </span><span class="s3">= </span><span class="s1">mappings </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">mappings</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">mapping</span><span class="s3">) {</span>
            <span class="s4">try </span><span class="s3">{</span>
                <span class="s4">let </span><span class="s3">{ </span><span class="s1">name</span><span class="s3">, </span><span class="s1">token </span><span class="s3">} = </span><span class="s1">mapping</span><span class="s3">;</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">name </span><span class="s3">!== </span><span class="s4">false</span><span class="s3">) {</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">token</span><span class="s3">.</span><span class="s1">type </span><span class="s3">== </span><span class="s2">&quot;name&quot; </span><span class="s3">|| </span><span class="s1">token</span><span class="s3">.</span><span class="s1">type </span><span class="s3">=== </span><span class="s2">&quot;privatename&quot;</span><span class="s3">) {</span>
                        <span class="s1">name </span><span class="s3">= </span><span class="s1">token</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
                    <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">name </span><span class="s4">instanceof </span><span class="s1">AST_Symbol</span><span class="s3">) {</span>
                        <span class="s1">name </span><span class="s3">= </span><span class="s1">token</span><span class="s3">.</span><span class="s1">type </span><span class="s3">=== </span><span class="s2">&quot;string&quot; </span><span class="s3">? </span><span class="s1">token</span><span class="s3">.</span><span class="s1">value </span><span class="s3">: </span><span class="s1">name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">;</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>
                <span class="s1">options</span><span class="s3">.</span><span class="s1">source_map</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span>
                    <span class="s1">mapping</span><span class="s3">.</span><span class="s1">token</span><span class="s3">.</span><span class="s1">file</span><span class="s3">,</span>
                    <span class="s1">mapping</span><span class="s3">.</span><span class="s1">line</span><span class="s3">, </span><span class="s1">mapping</span><span class="s3">.</span><span class="s1">col</span><span class="s3">,</span>
                    <span class="s1">mapping</span><span class="s3">.</span><span class="s1">token</span><span class="s3">.</span><span class="s1">line</span><span class="s3">, </span><span class="s1">mapping</span><span class="s3">.</span><span class="s1">token</span><span class="s3">.</span><span class="s1">col</span><span class="s3">,</span>
                    <span class="s1">is_basic_identifier_string</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) ? </span><span class="s1">name </span><span class="s3">: </span><span class="s1">undefined</span>
                <span class="s3">);</span>
            <span class="s3">} </span><span class="s4">catch</span><span class="s3">(</span><span class="s1">ex</span><span class="s3">) {</span>
                <span class="s7">// Ignore bad mapping</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s1">mappings </span><span class="s3">= [];</span>
    <span class="s3">} : </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">ensure_line_len </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">max_line_len </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">current_col </span><span class="s3">&gt; </span><span class="s1">options</span><span class="s3">.</span><span class="s1">max_line_len</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">might_add_newline</span><span class="s3">) {</span>
                <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">insertAt</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">, </span><span class="s1">might_add_newline</span><span class="s3">);</span>
                <span class="s4">const </span><span class="s1">len_after_newline </span><span class="s3">= </span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">length</span><span class="s3">() - </span><span class="s1">might_add_newline </span><span class="s3">- </span><span class="s5">1</span><span class="s3">;</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">mappings</span><span class="s3">) {</span>
                    <span class="s4">var </span><span class="s1">delta </span><span class="s3">= </span><span class="s1">len_after_newline </span><span class="s3">- </span><span class="s1">current_col</span><span class="s3">;</span>
                    <span class="s1">mappings</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">mapping</span><span class="s3">) {</span>
                        <span class="s1">mapping</span><span class="s3">.</span><span class="s1">line</span><span class="s3">++;</span>
                        <span class="s1">mapping</span><span class="s3">.</span><span class="s1">col </span><span class="s3">+= </span><span class="s1">delta</span><span class="s3">;</span>
                    <span class="s3">});</span>
                <span class="s3">}</span>
                <span class="s1">current_line</span><span class="s3">++;</span>
                <span class="s1">current_pos</span><span class="s3">++;</span>
                <span class="s1">current_col </span><span class="s3">= </span><span class="s1">len_after_newline</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">might_add_newline</span><span class="s3">) {</span>
            <span class="s1">might_add_newline </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
            <span class="s1">do_add_mapping</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">} : </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">requireSemicolonChars </span><span class="s3">= </span><span class="s1">makePredicate</span><span class="s3">(</span><span class="s2">&quot;( [ + * / - , . `&quot;</span><span class="s3">);</span>

    <span class="s4">function </span><span class="s1">print</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
        <span class="s1">str </span><span class="s3">= </span><span class="s1">String</span><span class="s3">(</span><span class="s1">str</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">ch </span><span class="s3">= </span><span class="s1">get_full_char</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s5">0</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">need_newline_indented </span><span class="s3">&amp;&amp; </span><span class="s1">ch</span><span class="s3">) {</span>
            <span class="s1">need_newline_indented </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">ch </span><span class="s3">!== </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                <span class="s1">indent</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">need_space </span><span class="s3">&amp;&amp; </span><span class="s1">ch</span><span class="s3">) {</span>
            <span class="s1">need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s6">/[\s;})]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">)) {</span>
                <span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">newline_insert </span><span class="s3">= -</span><span class="s5">1</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">prev </span><span class="s3">= </span><span class="s1">last</span><span class="s3">.</span><span class="s1">charAt</span><span class="s3">(</span><span class="s1">last</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">might_need_semicolon</span><span class="s3">) {</span>
            <span class="s1">might_need_semicolon </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s1">prev </span><span class="s3">=== </span><span class="s2">&quot;:&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">ch </span><span class="s3">=== </span><span class="s2">&quot;}&quot; </span><span class="s3">|| (!</span><span class="s1">ch </span><span class="s3">|| !</span><span class="s2">&quot;;}&quot;</span><span class="s3">.</span><span class="s1">includes</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">)) &amp;&amp; </span><span class="s1">prev </span><span class="s3">!== </span><span class="s2">&quot;;&quot;</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">semicolons </span><span class="s3">|| </span><span class="s1">requireSemicolonChars</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">)) {</span>
                    <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
                    <span class="s1">current_col</span><span class="s3">++;</span>
                    <span class="s1">current_pos</span><span class="s3">++;</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s1">ensure_line_len</span><span class="s3">();</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">current_col </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) {</span>
                        <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                        <span class="s1">current_pos</span><span class="s3">++;</span>
                        <span class="s1">current_line</span><span class="s3">++;</span>
                        <span class="s1">current_col </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
                    <span class="s3">}</span>

                    <span class="s4">if </span><span class="s3">(</span><span class="s6">/^\s+$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)) {</span>
                        <span class="s7">// reset the semicolon flag, since we didn't print one</span>
                        <span class="s7">// now and might still have to later</span>
                        <span class="s1">might_need_semicolon </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
                    <span class="s3">}</span>
                <span class="s3">}</span>

                <span class="s4">if </span><span class="s3">(!</span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify</span><span class="s3">)</span>
                    <span class="s1">might_need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">might_need_space</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">((</span><span class="s1">is_identifier_char</span><span class="s3">(</span><span class="s1">prev</span><span class="s3">)</span>
                    <span class="s3">&amp;&amp; (</span><span class="s1">is_identifier_char</span><span class="s3">(</span><span class="s1">ch</span><span class="s3">) || </span><span class="s1">ch </span><span class="s3">== </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">&quot;</span><span class="s3">))</span>
                <span class="s3">|| (</span><span class="s1">ch </span><span class="s3">== </span><span class="s2">&quot;/&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">ch </span><span class="s3">== </span><span class="s1">prev</span><span class="s3">)</span>
                <span class="s3">|| ((</span><span class="s1">ch </span><span class="s3">== </span><span class="s2">&quot;+&quot; </span><span class="s3">|| </span><span class="s1">ch </span><span class="s3">== </span><span class="s2">&quot;-&quot;</span><span class="s3">) &amp;&amp; </span><span class="s1">ch </span><span class="s3">== </span><span class="s1">last</span><span class="s3">)</span>
            <span class="s3">) {</span>
                <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
                <span class="s1">current_col</span><span class="s3">++;</span>
                <span class="s1">current_pos</span><span class="s3">++;</span>
            <span class="s3">}</span>
            <span class="s1">might_need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">mapping_token</span><span class="s3">) {</span>
            <span class="s1">mappings</span><span class="s3">.</span><span class="s1">push</span><span class="s3">({</span>
                <span class="s1">token</span><span class="s3">: </span><span class="s1">mapping_token</span><span class="s3">,</span>
                <span class="s1">name</span><span class="s3">: </span><span class="s1">mapping_name</span><span class="s3">,</span>
                <span class="s1">line</span><span class="s3">: </span><span class="s1">current_line</span><span class="s3">,</span>
                <span class="s1">col</span><span class="s3">: </span><span class="s1">current_col</span>
            <span class="s3">});</span>
            <span class="s1">mapping_token </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">might_add_newline</span><span class="s3">) </span><span class="s1">do_add_mapping</span><span class="s3">();</span>
        <span class="s3">}</span>

        <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">append</span><span class="s3">(</span><span class="s1">str</span><span class="s3">);</span>
        <span class="s1">has_parens </span><span class="s3">= </span><span class="s1">str</span><span class="s3">[</span><span class="s1">str</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">] == </span><span class="s2">&quot;(&quot;</span><span class="s3">;</span>
        <span class="s1">current_pos </span><span class="s3">+= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">a </span><span class="s3">= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">split</span><span class="s3">(</span><span class="s6">/\r?\n/</span><span class="s3">), </span><span class="s1">n </span><span class="s3">= </span><span class="s1">a</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">;</span>
        <span class="s1">current_line </span><span class="s3">+= </span><span class="s1">n</span><span class="s3">;</span>
        <span class="s1">current_col </span><span class="s3">+= </span><span class="s1">a</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">length</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">n </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) {</span>
            <span class="s1">ensure_line_len</span><span class="s3">();</span>
            <span class="s1">current_col </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s1">n</span><span class="s3">].</span><span class="s1">length</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">last </span><span class="s3">= </span><span class="s1">str</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">star </span><span class="s3">= </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;*&quot;</span><span class="s3">);</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">space </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
    <span class="s3">} : </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">might_need_space </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">var </span><span class="s1">indent </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify </span><span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">half</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify</span><span class="s3">) {</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">make_indent</span><span class="s3">(</span><span class="s1">half </span><span class="s3">? </span><span class="s5">0.5 </span><span class="s3">: </span><span class="s5">0</span><span class="s3">));</span>
        <span class="s3">}</span>
    <span class="s3">} : </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">with_indent </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify </span><span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">col</span><span class="s3">, </span><span class="s1">cont</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">col </span><span class="s3">=== </span><span class="s4">true</span><span class="s3">) </span><span class="s1">col </span><span class="s3">= </span><span class="s1">next_indent</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">save_indentation </span><span class="s3">= </span><span class="s1">indentation</span><span class="s3">;</span>
        <span class="s1">indentation </span><span class="s3">= </span><span class="s1">col</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">cont</span><span class="s3">();</span>
        <span class="s1">indentation </span><span class="s3">= </span><span class="s1">save_indentation</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">} : </span><span class="s4">function</span><span class="s3">(</span><span class="s1">col</span><span class="s3">, </span><span class="s1">cont</span><span class="s3">) { </span><span class="s4">return </span><span class="s1">cont</span><span class="s3">(); };</span>

    <span class="s4">var </span><span class="s1">newline </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">newline_insert </span><span class="s3">&lt; </span><span class="s5">0</span><span class="s3">) </span><span class="s4">return </span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">charAt</span><span class="s3">(</span><span class="s1">newline_insert</span><span class="s3">) != </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">) {</span>
            <span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">insertAt</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">, </span><span class="s1">newline_insert</span><span class="s3">);</span>
            <span class="s1">current_pos</span><span class="s3">++;</span>
            <span class="s1">current_line</span><span class="s3">++;</span>
        <span class="s3">}</span>
        <span class="s1">newline_insert</span><span class="s3">++;</span>
    <span class="s3">} : </span><span class="s1">options</span><span class="s3">.</span><span class="s1">max_line_len </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">ensure_line_len</span><span class="s3">();</span>
        <span class="s1">might_add_newline </span><span class="s3">= </span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">length</span><span class="s3">();</span>
    <span class="s3">} : </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">semicolon </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">beautify </span><span class="s3">? </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
    <span class="s3">} : </span><span class="s4">function</span><span class="s3">() {</span>
        <span class="s1">might_need_semicolon </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
    <span class="s3">};</span>

    <span class="s4">function </span><span class="s1">force_semicolon</span><span class="s3">() {</span>
        <span class="s1">might_need_semicolon </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">next_indent</span><span class="s3">() {</span>
        <span class="s4">return </span><span class="s1">indentation </span><span class="s3">+ </span><span class="s1">options</span><span class="s3">.</span><span class="s1">indent_level</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">with_block</span><span class="s3">(</span><span class="s1">cont</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">ret</span><span class="s3">;</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{&quot;</span><span class="s3">);</span>
        <span class="s1">newline</span><span class="s3">();</span>
        <span class="s1">with_indent</span><span class="s3">(</span><span class="s1">next_indent</span><span class="s3">(), </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">ret </span><span class="s3">= </span><span class="s1">cont</span><span class="s3">();</span>
        <span class="s3">});</span>
        <span class="s1">indent</span><span class="s3">();</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">with_parens</span><span class="s3">(</span><span class="s1">cont</span><span class="s3">) {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
        <span class="s7">//XXX: still nice to have that for argument lists</span>
        <span class="s7">//var ret = with_indent(current_col, cont);</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">cont</span><span class="s3">();</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">with_square</span><span class="s3">(</span><span class="s1">cont</span><span class="s3">) {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;[&quot;</span><span class="s3">);</span>
        <span class="s7">//var ret = with_indent(current_col, cont);</span>
        <span class="s4">var </span><span class="s1">ret </span><span class="s3">= </span><span class="s1">cont</span><span class="s3">();</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;]&quot;</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">ret</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">comma</span><span class="s3">() {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;,&quot;</span><span class="s3">);</span>
        <span class="s1">space</span><span class="s3">();</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">colon</span><span class="s3">() {</span>
        <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;:&quot;</span><span class="s3">);</span>
        <span class="s1">space</span><span class="s3">();</span>
    <span class="s3">}</span>

    <span class="s4">var </span><span class="s1">add_mapping </span><span class="s3">= </span><span class="s1">mappings </span><span class="s3">? </span><span class="s4">function</span><span class="s3">(</span><span class="s1">token</span><span class="s3">, </span><span class="s1">name</span><span class="s3">) {</span>
        <span class="s1">mapping_token </span><span class="s3">= </span><span class="s1">token</span><span class="s3">;</span>
        <span class="s1">mapping_name </span><span class="s3">= </span><span class="s1">name</span><span class="s3">;</span>
    <span class="s3">} : </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">function </span><span class="s1">get</span><span class="s3">() {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">might_add_newline</span><span class="s3">) {</span>
            <span class="s1">ensure_line_len</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">();</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">filter_comment</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">options</span><span class="s3">.</span><span class="s1">preserve_annotations</span><span class="s3">) {</span>
            <span class="s1">comment </span><span class="s3">= </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s1">r_annotation</span><span class="s3">, </span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s6">/^\s*$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">comment</span><span class="s3">)) {</span>
            <span class="s4">return </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">comment</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/(&lt;\s*\/\s*)(script)/i</span><span class="s3">, </span><span class="s2">&quot;&lt;</span><span class="s4">\\</span><span class="s2">/$2&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">prepend_comments</span><span class="s3">(</span><span class="s1">node</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">start </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">start</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">start</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">printed_comments </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">printed_comments</span><span class="s3">;</span>

        <span class="s7">// There cannot be a newline between return/yield and its value.</span>
        <span class="s4">const </span><span class="s1">keyword_with_value </span><span class="s3">= </span>
            <span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Exit </span><span class="s3">&amp;&amp; </span><span class="s1">node</span><span class="s3">.</span><span class="s1">value</span>
            <span class="s3">|| (</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Await </span><span class="s3">|| </span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Yield</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; </span><span class="s1">node</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(</span>
            <span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before</span>
            <span class="s3">&amp;&amp; </span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">keyword_with_value</span><span class="s3">) {</span>
                <span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before </span><span class="s3">= [];</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">return</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">var </span><span class="s1">comments </span><span class="s3">= </span><span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">comments</span><span class="s3">) {</span>
            <span class="s1">comments </span><span class="s3">= </span><span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before </span><span class="s3">= [];</span>
        <span class="s3">}</span>
        <span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">comments</span><span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">keyword_with_value</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">tw </span><span class="s3">= </span><span class="s4">new </span><span class="s1">TreeWalker</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">tw</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Exit</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Await</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Yield</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">TYPE </span><span class="s3">== </span><span class="s2">&quot;Call&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Conditional </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">condition </span><span class="s3">=== </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Dot </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Sequence </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expressions</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] === </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Sub </span><span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s1">node</span>
                    <span class="s3">|| </span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_UnaryPostfix</span><span class="s3">) {</span>
                    <span class="s4">if </span><span class="s3">(!</span><span class="s1">node</span><span class="s3">.</span><span class="s1">start</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
                    <span class="s4">var </span><span class="s1">text </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before</span><span class="s3">;</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">text </span><span class="s3">&amp;&amp; !</span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">text</span><span class="s3">)) {</span>
                        <span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">text</span><span class="s3">);</span>
                        <span class="s1">comments </span><span class="s3">= </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">concat</span><span class="s3">(</span><span class="s1">text</span><span class="s3">);</span>
                    <span class="s3">}</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s4">return true</span><span class="s3">;</span>
                <span class="s3">}</span>
            <span class="s3">});</span>
            <span class="s1">tw</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">node</span><span class="s3">);</span>
            <span class="s1">keyword_with_value</span><span class="s3">.</span><span class="s1">walk</span><span class="s3">(</span><span class="s1">tw</span><span class="s3">);</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">current_pos </span><span class="s3">== </span><span class="s5">0</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">comments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s5">0 </span><span class="s3">&amp;&amp; </span><span class="s1">options</span><span class="s3">.</span><span class="s1">shebang </span><span class="s3">&amp;&amp; </span><span class="s1">comments</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">type </span><span class="s3">=== </span><span class="s2">&quot;comment5&quot;</span>
                <span class="s3">&amp;&amp; !</span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">comments</span><span class="s3">[</span><span class="s5">0</span><span class="s3">])) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;#!&quot; </span><span class="s3">+ </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">shift</span><span class="s3">().</span><span class="s1">value </span><span class="s3">+ </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                <span class="s1">indent</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s4">var </span><span class="s1">preamble </span><span class="s3">= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">preamble</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">preamble</span><span class="s3">) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s1">preamble</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\r\n?|[\n\u2028\u2029]|\s*$/g</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">));</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s1">comments </span><span class="s3">= </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">comment_filter</span><span class="s3">, </span><span class="s1">node</span><span class="s3">).</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">c </span><span class="s3">=&gt; !</span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">c</span><span class="s3">));</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">comments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">== </span><span class="s5">0</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">last_nlb </span><span class="s3">= </span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">hasNLB</span><span class="s3">();</span>
        <span class="s1">comments</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">c</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">last_nlb</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">nlb</span><span class="s3">) {</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                    <span class="s1">indent</span><span class="s3">();</span>
                    <span class="s1">last_nlb </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
                <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) {</span>
                    <span class="s1">space</span><span class="s3">();</span>
                <span class="s3">}</span>
            <span class="s3">}</span>

            <span class="s4">if </span><span class="s3">(</span><span class="s6">/comment[134]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">type</span><span class="s3">)) {</span>
                <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">filter_comment</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;//&quot; </span><span class="s3">+ </span><span class="s1">value </span><span class="s3">+ </span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                    <span class="s1">indent</span><span class="s3">();</span>
                <span class="s3">}</span>
                <span class="s1">last_nlb </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">type </span><span class="s3">== </span><span class="s2">&quot;comment2&quot;</span><span class="s3">) {</span>
                <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s1">filter_comment</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;/*&quot; </span><span class="s3">+ </span><span class="s1">value </span><span class="s3">+ </span><span class="s2">&quot;*/&quot;</span><span class="s3">);</span>
                <span class="s3">}</span>
                <span class="s1">last_nlb </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">last_nlb</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">start</span><span class="s3">.</span><span class="s1">nlb</span><span class="s3">) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                <span class="s1">indent</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">append_comments</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">tail</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">token </span><span class="s3">= </span><span class="s1">node</span><span class="s3">.</span><span class="s1">end</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">token</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">printed_comments </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">printed_comments</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">comments </span><span class="s3">= </span><span class="s1">token</span><span class="s3">[</span><span class="s1">tail </span><span class="s3">? </span><span class="s2">&quot;comments_before&quot; </span><span class="s3">: </span><span class="s2">&quot;comments_after&quot;</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">comments </span><span class="s3">|| </span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">comments</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!(</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Statement </span><span class="s3">|| </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">every</span><span class="s3">((</span><span class="s1">c</span><span class="s3">) =&gt;</span>
            <span class="s3">!</span><span class="s6">/comment[134]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">type</span><span class="s3">)</span>
        <span class="s3">))) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">comments</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">insert </span><span class="s3">= </span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">length</span><span class="s3">();</span>
        <span class="s1">comments</span><span class="s3">.</span><span class="s1">filter</span><span class="s3">(</span><span class="s1">comment_filter</span><span class="s3">, </span><span class="s1">node</span><span class="s3">).</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">c</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">c</span><span class="s3">)) </span><span class="s4">return</span><span class="s3">;</span>
            <span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">add</span><span class="s3">(</span><span class="s1">c</span><span class="s3">);</span>
            <span class="s1">need_space </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">need_newline_indented</span><span class="s3">) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                <span class="s1">indent</span><span class="s3">();</span>
                <span class="s1">need_newline_indented </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">nlb </span><span class="s3">&amp;&amp; (</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s5">0 </span><span class="s3">|| !</span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">hasNLB</span><span class="s3">())) {</span>
                <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\n</span><span class="s2">&quot;</span><span class="s3">);</span>
                <span class="s1">indent</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s5">0 </span><span class="s3">|| !</span><span class="s1">tail</span><span class="s3">) {</span>
                <span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s6">/comment[134]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">type</span><span class="s3">)) {</span>
                <span class="s4">const </span><span class="s1">value </span><span class="s3">= </span><span class="s1">filter_comment</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;//&quot; </span><span class="s3">+ </span><span class="s1">value</span><span class="s3">);</span>
                <span class="s3">}</span>
                <span class="s1">need_newline_indented </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">type </span><span class="s3">== </span><span class="s2">&quot;comment2&quot;</span><span class="s3">) {</span>
                <span class="s4">const </span><span class="s1">value </span><span class="s3">= </span><span class="s1">filter_comment</span><span class="s3">(</span><span class="s1">c</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">) {</span>
                    <span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;/*&quot; </span><span class="s3">+ </span><span class="s1">value </span><span class="s3">+ </span><span class="s2">&quot;*/&quot;</span><span class="s3">);</span>
                <span class="s3">}</span>
                <span class="s1">need_space </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">length</span><span class="s3">() &gt; </span><span class="s1">insert</span><span class="s3">) </span><span class="s1">newline_insert </span><span class="s3">= </span><span class="s1">insert</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s0">/**</span>
     <span class="s0">* When output.option(&quot;_destroy_ast&quot;) is enabled, destroy the function.</span>
     <span class="s0">* Call this after printing it.</span>
     <span class="s0">*/</span>
    <span class="s4">const </span><span class="s1">gc_scope </span><span class="s3">=</span>
      <span class="s1">options</span><span class="s3">[</span><span class="s2">&quot;_destroy_ast&quot;</span><span class="s3">]</span>
        <span class="s3">? </span><span class="s4">function </span><span class="s1">gc_scope</span><span class="s3">(</span><span class="s1">scope</span><span class="s3">) {</span>
            <span class="s1">scope</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
            <span class="s1">scope</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">.</span><span class="s1">length </span><span class="s3">= </span><span class="s5">0</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s3">: </span><span class="s1">noop</span><span class="s3">;</span>

    <span class="s4">var </span><span class="s1">stack </span><span class="s3">= [];</span>
    <span class="s4">return </span><span class="s3">{</span>
        <span class="s1">get             </span><span class="s3">: </span><span class="s1">get</span><span class="s3">,</span>
        <span class="s1">toString        </span><span class="s3">: </span><span class="s1">get</span><span class="s3">,</span>
        <span class="s1">indent          </span><span class="s3">: </span><span class="s1">indent</span><span class="s3">,</span>
        <span class="s1">in_directive    </span><span class="s3">: </span><span class="s4">false</span><span class="s3">,</span>
        <span class="s1">use_asm         </span><span class="s3">: </span><span class="s4">null</span><span class="s3">,</span>
        <span class="s1">active_scope    </span><span class="s3">: </span><span class="s4">null</span><span class="s3">,</span>
        <span class="s1">indentation     </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">indentation</span><span class="s3">; },</span>
        <span class="s1">current_width   </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">current_col </span><span class="s3">- </span><span class="s1">indentation</span><span class="s3">; },</span>
        <span class="s1">should_break    </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">options</span><span class="s3">.</span><span class="s1">width </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">current_width</span><span class="s3">() &gt;= </span><span class="s1">options</span><span class="s3">.</span><span class="s1">width</span><span class="s3">; },</span>
        <span class="s1">has_parens      </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">has_parens</span><span class="s3">; },</span>
        <span class="s1">newline         </span><span class="s3">: </span><span class="s1">newline</span><span class="s3">,</span>
        <span class="s1">print           </span><span class="s3">: </span><span class="s1">print</span><span class="s3">,</span>
        <span class="s1">star            </span><span class="s3">: </span><span class="s1">star</span><span class="s3">,</span>
        <span class="s1">space           </span><span class="s3">: </span><span class="s1">space</span><span class="s3">,</span>
        <span class="s1">comma           </span><span class="s3">: </span><span class="s1">comma</span><span class="s3">,</span>
        <span class="s1">colon           </span><span class="s3">: </span><span class="s1">colon</span><span class="s3">,</span>
        <span class="s1">last            </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">last</span><span class="s3">; },</span>
        <span class="s1">semicolon       </span><span class="s3">: </span><span class="s1">semicolon</span><span class="s3">,</span>
        <span class="s1">force_semicolon </span><span class="s3">: </span><span class="s1">force_semicolon</span><span class="s3">,</span>
        <span class="s1">to_utf8         </span><span class="s3">: </span><span class="s1">to_utf8</span><span class="s3">,</span>
        <span class="s1">print_name      </span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">name</span><span class="s3">) { </span><span class="s1">print</span><span class="s3">(</span><span class="s1">make_name</span><span class="s3">(</span><span class="s1">name</span><span class="s3">)); },</span>
        <span class="s1">print_string    </span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">, </span><span class="s1">escape_directive</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">encoded </span><span class="s3">= </span><span class="s1">encode_string</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">escape_directive </span><span class="s3">=== </span><span class="s4">true </span><span class="s3">&amp;&amp; !</span><span class="s1">encoded</span><span class="s3">.</span><span class="s1">includes</span><span class="s3">(</span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">&quot;</span><span class="s3">)) {</span>
                <span class="s7">// Insert semicolons to break directive prologue</span>
                <span class="s4">if </span><span class="s3">(!</span><span class="s1">OUTPUT</span><span class="s3">.</span><span class="s1">expectDirective</span><span class="s3">()) {</span>
                    <span class="s1">force_semicolon</span><span class="s3">();</span>
                <span class="s3">}</span>
                <span class="s1">force_semicolon</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s1">print</span><span class="s3">(</span><span class="s1">encoded</span><span class="s3">);</span>
        <span class="s3">},</span>
        <span class="s1">print_template_string_chars</span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">str</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">encoded </span><span class="s3">= </span><span class="s1">encode_string</span><span class="s3">(</span><span class="s1">str</span><span class="s3">, </span><span class="s2">&quot;`&quot;</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/\${/g</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">${&quot;</span><span class="s3">);</span>
            <span class="s4">return </span><span class="s1">print</span><span class="s3">(</span><span class="s1">encoded</span><span class="s3">.</span><span class="s1">substr</span><span class="s3">(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">encoded</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">2</span><span class="s3">));</span>
        <span class="s3">},</span>
        <span class="s1">encode_string   </span><span class="s3">: </span><span class="s1">encode_string</span><span class="s3">,</span>
        <span class="s1">next_indent     </span><span class="s3">: </span><span class="s1">next_indent</span><span class="s3">,</span>
        <span class="s1">with_indent     </span><span class="s3">: </span><span class="s1">with_indent</span><span class="s3">,</span>
        <span class="s1">with_block      </span><span class="s3">: </span><span class="s1">with_block</span><span class="s3">,</span>
        <span class="s1">with_parens     </span><span class="s3">: </span><span class="s1">with_parens</span><span class="s3">,</span>
        <span class="s1">with_square     </span><span class="s3">: </span><span class="s1">with_square</span><span class="s3">,</span>
        <span class="s1">add_mapping     </span><span class="s3">: </span><span class="s1">add_mapping</span><span class="s3">,</span>
        <span class="s1">option          </span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">opt</span><span class="s3">) { </span><span class="s4">return </span><span class="s1">options</span><span class="s3">[</span><span class="s1">opt</span><span class="s3">]; },</span>
        <span class="s1">gc_scope</span><span class="s3">,</span>
        <span class="s1">printed_comments</span><span class="s3">: </span><span class="s1">printed_comments</span><span class="s3">,</span>
        <span class="s1">prepend_comments</span><span class="s3">: </span><span class="s1">readonly </span><span class="s3">? </span><span class="s1">noop </span><span class="s3">: </span><span class="s1">prepend_comments</span><span class="s3">,</span>
        <span class="s1">append_comments </span><span class="s3">: </span><span class="s1">readonly </span><span class="s3">|| </span><span class="s1">comment_filter </span><span class="s3">=== </span><span class="s1">return_false </span><span class="s3">? </span><span class="s1">noop </span><span class="s3">: </span><span class="s1">append_comments</span><span class="s3">,</span>
        <span class="s1">line            </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">current_line</span><span class="s3">; },</span>
        <span class="s1">col             </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">current_col</span><span class="s3">; },</span>
        <span class="s1">pos             </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">current_pos</span><span class="s3">; },</span>
        <span class="s1">push_node       </span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">) { </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">node</span><span class="s3">); },</span>
        <span class="s1">pop_node        </span><span class="s3">: </span><span class="s4">function</span><span class="s3">() { </span><span class="s4">return </span><span class="s1">stack</span><span class="s3">.</span><span class="s1">pop</span><span class="s3">(); },</span>
        <span class="s1">parent          </span><span class="s3">: </span><span class="s4">function</span><span class="s3">(</span><span class="s1">n</span><span class="s3">) {</span>
            <span class="s4">return </span><span class="s1">stack</span><span class="s3">[</span><span class="s1">stack</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">2 </span><span class="s3">- (</span><span class="s1">n </span><span class="s3">|| </span><span class="s5">0</span><span class="s3">)];</span>
        <span class="s3">}</span>
    <span class="s3">};</span>

<span class="s3">}</span>

<span class="s7">/* -----[ code generators ]----- */</span>

<span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>

    <span class="s7">/* -----[ utils ]----- */</span>

    <span class="s4">function </span><span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">, </span><span class="s1">generator</span><span class="s3">) {</span>
        <span class="s1">nodetype</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_codegen&quot;</span><span class="s3">, </span><span class="s1">generator</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">force_parens</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">, </span><span class="s1">generator </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">_codegen</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self </span><span class="s4">instanceof </span><span class="s1">AST_Scope</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">active_scope </span><span class="s3">= </span><span class="s1">self</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(!</span><span class="s1">output</span><span class="s3">.</span><span class="s1">use_asm </span><span class="s3">&amp;&amp; </span><span class="s1">self </span><span class="s4">instanceof </span><span class="s1">AST_Directive </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">value </span><span class="s3">== </span><span class="s2">&quot;use asm&quot;</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">use_asm </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">active_scope</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">function </span><span class="s1">doit</span><span class="s3">() {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">prepend_comments</span><span class="s3">(</span><span class="s1">self</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">add_source_map</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">generator</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">append_comments</span><span class="s3">(</span><span class="s1">self</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">push_node</span><span class="s3">(</span><span class="s1">self</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">force_parens </span><span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">needs_parens</span><span class="s3">(</span><span class="s1">output</span><span class="s3">)) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s1">doit</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">doit</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">pop_node</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self </span><span class="s3">=== </span><span class="s1">output</span><span class="s3">.</span><span class="s1">use_asm</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">use_asm </span><span class="s3">= </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
    <span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_print&quot;</span><span class="s3">, </span><span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">print</span><span class="s3">);</span>

    <span class="s1">AST_Node</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;print_to_string&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">options</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">output </span><span class="s3">= </span><span class="s1">OutputStream</span><span class="s3">(</span><span class="s1">options</span><span class="s3">);</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">return </span><span class="s1">output</span><span class="s3">.</span><span class="s1">get</span><span class="s3">();</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ PARENTHESES ]----- */</span>

    <span class="s4">function </span><span class="s1">PARENS</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">, </span><span class="s1">func</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">Array</span><span class="s3">.</span><span class="s1">isArray</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">)) {</span>
            <span class="s1">nodetype</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">) {</span>
                <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">nodetype</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;needs_parens&quot;</span><span class="s3">, </span><span class="s1">func</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Node</span><span class="s3">, </span><span class="s1">return_false</span><span class="s3">);</span>

    <span class="s7">// a function expression needs parens around it when it's provably</span>
    <span class="s7">// the first token to appear in a statement.</span>
    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Function</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">output</span><span class="s3">.</span><span class="s1">has_parens</span><span class="s3">() &amp;&amp; </span><span class="s1">first_in_statement</span><span class="s3">(</span><span class="s1">output</span><span class="s3">)) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;webkit&quot;</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;wrap_iife&quot;</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;wrap_func_args&quot;</span><span class="s3">)) {</span>
            <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">args</span><span class="s3">.</span><span class="s1">includes</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>

        <span class="s4">return false</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Arrow</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>

        <span class="s4">if </span><span class="s3">(</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;wrap_func_args&quot;</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call</span>
            <span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">args</span><span class="s3">.</span><span class="s1">includes</span><span class="s3">(</span><span class="s4">this</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Conditional </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">condition </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s7">// same goes for an object literal (as in AST_Function), because</span>
    <span class="s7">// otherwise {...} would be interpreted as a block of code.</span>
    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">return </span><span class="s3">!</span><span class="s1">output</span><span class="s3">.</span><span class="s1">has_parens</span><span class="s3">() &amp;&amp; </span><span class="s1">first_in_statement</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_ClassExpression</span><span class="s3">, </span><span class="s1">first_in_statement</span><span class="s3">);</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Unary</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">return </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary</span>
                <span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">=== </span><span class="s2">&quot;**&quot;</span>
                <span class="s3">&amp;&amp; </span><span class="s4">this instanceof </span><span class="s1">AST_UnaryPrefix</span>
                <span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s4">this</span>
                <span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">!== </span><span class="s2">&quot;++&quot;</span>
                <span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">!== </span><span class="s2">&quot;--&quot;</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Await</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">return </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">=== </span><span class="s2">&quot;**&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;safari10&quot;</span><span class="s3">) &amp;&amp; </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_UnaryPrefix</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">return </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call                          </span><span class="s7">// (foo, bar)() or foo(1, (2, 3), 4)</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Unary                         </span><span class="s7">// !(foo, bar, baz)</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary                        </span><span class="s7">// 1 + (2, 3) + 4 ==&gt; 8</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_VarDef                        </span><span class="s7">// var a = (1, 2), b = a + a; ==&gt; b == 4</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess                    </span><span class="s7">// (1, {foo:2}).foo or (1, {foo:2})[&quot;foo&quot;] ==&gt; 2</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Array                         </span><span class="s7">// [ 1, (2, 3), 4 ] ==&gt; [ 1, 3, 4 ]</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_ObjectProperty                </span><span class="s7">// { foo: (1, 2) }.foo ==&gt; 2</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Conditional                   </span><span class="s7">/* (false, true) ? (a = 10, b = 20) : (c = 30) 
                                                               * ==&gt; 20 (side effect, set a := 10 and b := 20) */</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Arrow                         </span><span class="s7">// x =&gt; (x, x)</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_DefaultAssign                 </span><span class="s7">// x =&gt; (x = (0, function(){}))</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Expansion                     </span><span class="s7">// [...(a, b)]</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_ForOf </span><span class="s3">&amp;&amp; </span><span class="s4">this </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">.</span><span class="s1">object    </span><span class="s7">// for (e of (foo, bar)) {}</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Yield                         </span><span class="s7">// yield (foo, bar)</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Export                        </span><span class="s7">// export default (foo, bar)</span>
        <span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s7">// (foo &amp;&amp; bar)()</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// typeof (foo &amp;&amp; bar)</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (foo &amp;&amp; bar)[&quot;prop&quot;], (foo &amp;&amp; bar).prop</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// this deals with precedence: 3 * (2 + 1)</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary</span><span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">parent_op </span><span class="s3">= </span><span class="s1">p</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>
            <span class="s4">const </span><span class="s1">op </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>

            <span class="s7">// It is forbidden for ?? to be used with || or &amp;&amp; without parens.</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">op </span><span class="s3">=== </span><span class="s2">&quot;??&quot; </span><span class="s3">&amp;&amp; (</span><span class="s1">parent_op </span><span class="s3">=== </span><span class="s2">&quot;||&quot; </span><span class="s3">|| </span><span class="s1">parent_op </span><span class="s3">=== </span><span class="s2">&quot;&amp;&amp;&quot;</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">parent_op </span><span class="s3">=== </span><span class="s2">&quot;??&quot; </span><span class="s3">&amp;&amp; (</span><span class="s1">op </span><span class="s3">=== </span><span class="s2">&quot;||&quot; </span><span class="s3">|| </span><span class="s1">op </span><span class="s3">=== </span><span class="s2">&quot;&amp;&amp;&quot;</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>

            <span class="s4">const </span><span class="s1">pp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s1">parent_op</span><span class="s3">];</span>
            <span class="s4">const </span><span class="s1">sp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s1">op</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">pp </span><span class="s3">&gt; </span><span class="s1">sp</span>
                <span class="s3">|| (</span><span class="s1">pp </span><span class="s3">== </span><span class="s1">sp</span>
                    <span class="s3">&amp;&amp; (</span><span class="s4">this </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">.</span><span class="s1">right </span><span class="s3">|| </span><span class="s1">parent_op </span><span class="s3">== </span><span class="s2">&quot;**&quot;</span><span class="s3">))) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PrivateIn</span><span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">op </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>

            <span class="s4">const </span><span class="s1">pp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s2">&quot;in&quot;</span><span class="s3">];</span>
            <span class="s4">const </span><span class="s1">sp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s1">op</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">pp </span><span class="s3">&gt; </span><span class="s1">sp </span><span class="s3">|| (</span><span class="s1">pp </span><span class="s3">== </span><span class="s1">sp </span><span class="s3">&amp;&amp; </span><span class="s4">this </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">.</span><span class="s1">value</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_PrivateIn</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s7">// (#x in this)()</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s7">// typeof (#x in this)</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span><span class="s3">) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s7">// (#x in this)[&quot;prop&quot;], (#x in this).prop</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s7">// same precedence as regular in operator</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary</span><span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">parent_op </span><span class="s3">= </span><span class="s1">p</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>

            <span class="s4">const </span><span class="s1">pp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s1">parent_op</span><span class="s3">];</span>
            <span class="s4">const </span><span class="s1">sp </span><span class="s3">= </span><span class="s1">PRECEDENCE</span><span class="s3">[</span><span class="s2">&quot;in&quot;</span><span class="s3">];</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">pp </span><span class="s3">&gt; </span><span class="s1">sp</span>
                <span class="s3">|| (</span><span class="s1">pp </span><span class="s3">== </span><span class="s1">sp</span>
                    <span class="s3">&amp;&amp; (</span><span class="s4">this </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">.</span><span class="s1">right </span><span class="s3">|| </span><span class="s1">parent_op </span><span class="s3">== </span><span class="s2">&quot;**&quot;</span><span class="s3">))) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s7">// rules are the same as binary in, but the class differs</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PrivateIn </span><span class="s3">&amp;&amp; </span><span class="s4">this </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Yield</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s7">// (yield 1) + (yield 2)</span>
        <span class="s7">// a = yield 3</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">!== </span><span class="s2">&quot;=&quot;</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (yield 1)()</span>
        <span class="s7">// new (yield 1)()</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (yield 1) ? yield 2 : yield 3</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Conditional </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">condition </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// -(yield 4)</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (yield x).foo</span>
        <span class="s7">// (yield x)['foo']</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Chain</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(!(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess</span><span class="s3">)) </span><span class="s4">return false</span><span class="s3">;</span>
        <span class="s4">return </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_PropAccess</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_New </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
            <span class="s7">// i.e. new (foo.bar().baz)</span>
            <span class="s7">//</span>
            <span class="s7">// if there's one call into this subtree, then we need</span>
            <span class="s7">// parens around it too, otherwise the call will be</span>
            <span class="s7">// interpreted as passing the arguments to the upper New</span>
            <span class="s7">// expression.</span>
            <span class="s4">return </span><span class="s1">walk</span><span class="s3">(</span><span class="s4">this</span><span class="s3">, </span><span class="s1">node </span><span class="s3">=&gt; {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Scope</span><span class="s3">) </span><span class="s4">return true</span><span class="s3">;</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Call</span><span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">walk_abort</span><span class="s3">;  </span><span class="s7">// makes walk() return true.</span>
                <span class="s3">}</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Call</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">(), </span><span class="s1">p1</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_New </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Export </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">is_default </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_Function</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>

        <span class="s7">// workaround for Safari bug.</span>
        <span class="s7">// https://bugs.webkit.org/show_bug.cgi?id=123506</span>
        <span class="s4">return this</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_Function</span>
            <span class="s3">&amp;&amp; </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess</span>
            <span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
            <span class="s3">&amp;&amp; (</span><span class="s1">p1 </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">(</span><span class="s5">1</span><span class="s3">)) </span><span class="s4">instanceof </span><span class="s1">AST_Assign</span>
            <span class="s3">&amp;&amp; </span><span class="s1">p1</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s1">p</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_New</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">args</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">0</span>
            <span class="s3">&amp;&amp; (</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s7">// (new Date).getTime(), (new Date)[&quot;getTime&quot;]()</span>
                <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span>
                <span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PrefixedTemplateString </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">prefix </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)) </span><span class="s7">// (new foo)(bar)</span>
            <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_Number</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">value </span><span class="s3">&lt; </span><span class="s5">0 </span><span class="s3">|| </span><span class="s6">/^0/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">make_num</span><span class="s3">(</span><span class="s1">value</span><span class="s3">))) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">(</span><span class="s1">AST_BigInt</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">value </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">value</span><span class="s3">.</span><span class="s1">startsWith</span><span class="s3">(</span><span class="s2">&quot;-&quot;</span><span class="s3">)) {</span>
                <span class="s4">return true</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">PARENS</span><span class="s3">([ </span><span class="s1">AST_Assign</span><span class="s3">, </span><span class="s1">AST_Conditional </span><span class="s3">], </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s7">// !(a = false) → true</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// 1 + (a = 2) + 3 → 6, side effect setting a = 2</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp; !(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Assign</span><span class="s3">))</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (a = func)() —or— new (a = Object)()</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (a = foo) ? bar : baz</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_Conditional </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">condition </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// (a = foo)[&quot;prop&quot;] —or— (a = foo).prop</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">expression </span><span class="s3">=== </span><span class="s4">this</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
        <span class="s7">// ({a, b} = {a: 1, b: 2}), a destructuring assignment</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this instanceof </span><span class="s1">AST_Assign </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">left </span><span class="s4">instanceof </span><span class="s1">AST_Destructuring </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">is_array </span><span class="s3">=== </span><span class="s4">false</span><span class="s3">)</span>
            <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ PRINTERS ]----- */</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Directive</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Expansion</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;...&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Destructuring</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_array </span><span class="s3">? </span><span class="s2">&quot;[&quot; </span><span class="s3">: </span><span class="s2">&quot;{&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">len </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">names</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">names</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function </span><span class="s3">(</span><span class="s1">name</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
            <span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s7">// If the final element is a hole, we need to make sure it</span>
            <span class="s7">// doesn't look like a trailing comma, by inserting an actual</span>
            <span class="s7">// trailing comma.</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">== </span><span class="s1">len </span><span class="s3">- </span><span class="s5">1 </span><span class="s3">&amp;&amp; </span><span class="s1">name </span><span class="s4">instanceof </span><span class="s1">AST_Hole</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_array </span><span class="s3">? </span><span class="s2">&quot;]&quot; </span><span class="s3">: </span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Debugger</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;debugger&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ statements ]----- */</span>

    <span class="s4">function </span><span class="s1">display_body</span><span class="s3">(</span><span class="s1">body</span><span class="s3">, </span><span class="s1">is_toplevel</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s1">allow_directives</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">last </span><span class="s3">= </span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">;</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">= </span><span class="s1">allow_directives</span><span class="s3">;</span>
        <span class="s1">body</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">stmt</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">=== </span><span class="s4">true </span><span class="s3">&amp;&amp; !(</span><span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_Directive </span><span class="s3">||</span>
                <span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_EmptyStatement </span><span class="s3">||</span>
                <span class="s3">(</span><span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_SimpleStatement </span><span class="s3">&amp;&amp; </span><span class="s1">stmt</span><span class="s3">.</span><span class="s1">body </span><span class="s4">instanceof </span><span class="s1">AST_String</span><span class="s3">)</span>
            <span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(!(</span><span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_EmptyStatement</span><span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
                <span class="s1">stmt</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(!(</span><span class="s1">i </span><span class="s3">== </span><span class="s1">last </span><span class="s3">&amp;&amp; </span><span class="s1">is_toplevel</span><span class="s3">)) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">is_toplevel</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">=== </span><span class="s4">true </span><span class="s3">&amp;&amp;</span>
                <span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_SimpleStatement </span><span class="s3">&amp;&amp;</span>
                <span class="s1">stmt</span><span class="s3">.</span><span class="s1">body </span><span class="s4">instanceof </span><span class="s1">AST_String</span>
            <span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">AST_StatementWithBody</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print_body&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">print_maybe_braced_body</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Statement</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Toplevel</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">display_body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_LabeledStatement</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">label</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_SimpleStatement</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s4">function </span><span class="s1">print_braced_empty</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_indent</span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">next_indent</span><span class="s3">(), </span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">append_comments</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s4">function </span><span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s1">allow_directives</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_block</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">display_body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s1">allow_directives</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s1">print_braced_empty</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_BlockStatement</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_EmptyStatement</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Do</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;do&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">make_block</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;while&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_While</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;while&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_For</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;for&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">init</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">init </span><span class="s4">instanceof </span><span class="s1">AST_Definitions</span><span class="s3">) {</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">init</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s1">parenthesize_for_noin</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">init</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
                <span class="s3">}</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">) {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;;&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">step</span><span class="s3">) {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">step</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ForIn</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;for&quot;</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">await</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;await&quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">init</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self </span><span class="s4">instanceof </span><span class="s1">AST_ForOf </span><span class="s3">? </span><span class="s2">&quot;of&quot; </span><span class="s3">: </span><span class="s2">&quot;in&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">object</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_With</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;with&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ functions ]----- */</span>
    <span class="s1">AST_Lambda</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">nokeyword</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">nokeyword</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;async&quot;</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;function&quot;</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_generator</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">star</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s4">instanceof </span><span class="s1">AST_Symbol</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">nokeyword </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name </span><span class="s4">instanceof </span><span class="s1">AST_Node</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_square</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">); </span><span class="s7">// Computed method name</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
                <span class="s1">arg</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Lambda</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">gc_scope</span><span class="s3">(</span><span class="s1">self</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_PrefixedTemplateString</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">tag </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">prefix</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">parenthesize_tag </span><span class="s3">= </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Lambda</span>
            <span class="s3">|| </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Binary</span>
            <span class="s3">|| </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Conditional</span>
            <span class="s3">|| </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Sequence</span>
            <span class="s3">|| </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span>
            <span class="s3">|| </span><span class="s1">tag </span><span class="s4">instanceof </span><span class="s1">AST_Dot </span><span class="s3">&amp;&amp; </span><span class="s1">tag</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_Object</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parenthesize_tag</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">prefix</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parenthesize_tag</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">template_string</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_TemplateString</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">is_tagged </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">() </span><span class="s4">instanceof </span><span class="s1">AST_PrefixedTemplateString</span><span class="s3">;</span>

        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;`&quot;</span><span class="s3">);</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s5">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
            <span class="s4">if </span><span class="s3">(!(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">] </span><span class="s4">instanceof </span><span class="s1">AST_TemplateSegment</span><span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;${&quot;</span><span class="s3">);</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">is_tagged</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">raw</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print_template_string_chars</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">segments</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">value</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;`&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_TemplateSegment</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_template_string_chars</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">AST_Arrow</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">needs_parens </span><span class="s3">= (</span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp;</span>
                <span class="s3">!(</span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Assign</span><span class="s3">) &amp;&amp;</span>
                <span class="s3">!(</span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_DefaultAssign</span><span class="s3">)) ||</span>
            <span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Unary </span><span class="s3">||</span>
            <span class="s3">(</span><span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">&amp;&amp; </span><span class="s1">self </span><span class="s3">=== </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">needs_parens</span><span class="s3">) { </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">); }</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;async&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">1 </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] </span><span class="s4">instanceof </span><span class="s1">AST_Symbol</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">argnames</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">arg</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
                    <span class="s1">arg</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s3">});</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;=&gt;&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">const </span><span class="s1">first_statement </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">[</span><span class="s5">0</span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">1</span>
            <span class="s3">&amp;&amp; </span><span class="s1">first_statement </span><span class="s4">instanceof </span><span class="s1">AST_Return</span>
        <span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">returned </span><span class="s3">= </span><span class="s1">first_statement</span><span class="s3">.</span><span class="s1">value</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">returned</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{}&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">left_is_object</span><span class="s3">(</span><span class="s1">returned</span><span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
                <span class="s1">returned</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">returned</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">needs_parens</span><span class="s3">) { </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">); }</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">gc_scope</span><span class="s3">(</span><span class="s1">self</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ exits ]----- */</span>
    <span class="s1">AST_Exit</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">kind</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">kind</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s4">const </span><span class="s1">comments </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">start</span><span class="s3">.</span><span class="s1">comments_before</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">comments </span><span class="s3">&amp;&amp; </span><span class="s1">comments</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&amp;&amp; !</span><span class="s1">output</span><span class="s3">.</span><span class="s1">printed_comments</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">comments</span><span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
                <span class="s4">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">this</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Return</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;return&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Throw</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;throw&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ yield ]----- */</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Yield</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">star </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_star </span><span class="s3">? </span><span class="s2">&quot;*&quot; </span><span class="s3">: </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;yield&quot; </span><span class="s3">+ </span><span class="s1">star</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Await</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;await&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">e </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">parens </span><span class="s3">= !(</span>
               <span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_Call</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_SymbolRef</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_Unary</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_Constant</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_Await</span>
            <span class="s3">|| </span><span class="s1">e </span><span class="s4">instanceof </span><span class="s1">AST_Object</span>
        <span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parens</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">parens</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ loop control ]----- */</span>
    <span class="s1">AST_LoopControl</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">kind</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">kind</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">label</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s4">this</span><span class="s3">.</span><span class="s1">label</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Break</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;break&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Continue</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;continue&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ if ]----- */</span>
    <span class="s4">function </span><span class="s1">make_then</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">b </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;braces&quot;</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;ie8&quot;</span><span class="s3">) &amp;&amp; </span><span class="s1">b </span><span class="s4">instanceof </span><span class="s1">AST_Do</span><span class="s3">)</span>
            <span class="s4">return </span><span class="s1">make_block</span><span class="s3">(</span><span class="s1">b</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s7">// The squeezer replaces &quot;block&quot;-s that contain only a single</span>
        <span class="s7">// statement with the statement itself; technically, the AST</span>
        <span class="s7">// is correct, but this can create problems when we output an</span>
        <span class="s7">// IF having an ELSE clause where the THEN clause ends in an</span>
        <span class="s7">// IF *without* an ELSE block (then the outer ELSE would refer</span>
        <span class="s7">// to the inner IF).  This function checks for this case and</span>
        <span class="s7">// adds the block braces if needed.</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">b</span><span class="s3">) </span><span class="s4">return </span><span class="s1">output</span><span class="s3">.</span><span class="s1">force_semicolon</span><span class="s3">();</span>
        <span class="s4">while </span><span class="s3">(</span><span class="s4">true</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">b </span><span class="s4">instanceof </span><span class="s1">AST_If</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(!</span><span class="s1">b</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">) {</span>
                    <span class="s1">make_block</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
                    <span class="s4">return</span><span class="s3">;</span>
                <span class="s3">}</span>
                <span class="s1">b </span><span class="s3">= </span><span class="s1">b</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">b </span><span class="s4">instanceof </span><span class="s1">AST_StatementWithBody</span><span class="s3">) {</span>
                <span class="s1">b </span><span class="s3">= </span><span class="s1">b</span><span class="s3">.</span><span class="s1">body</span><span class="s3">;</span>
            <span class="s3">} </span><span class="s4">else break</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">print_maybe_braced_body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">}</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_If</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;if&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">) {</span>
            <span class="s1">make_then</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;else&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">alternative </span><span class="s4">instanceof </span><span class="s1">AST_If</span><span class="s3">)</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">else</span>
                <span class="s1">print_maybe_braced_body</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ switch ]----- */</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Switch</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;switch&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">last </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">last </span><span class="s3">&lt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">print_braced_empty</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">else </span><span class="s1">output</span><span class="s3">.</span><span class="s1">with_block</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">branch</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">(</span><span class="s4">true</span><span class="s3">);</span>
                <span class="s1">branch</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">last </span><span class="s3">&amp;&amp; </span><span class="s1">branch</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">)</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
            <span class="s3">});</span>
        <span class="s3">});</span>
    <span class="s3">});</span>
    <span class="s1">AST_SwitchBranch</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print_body&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">stmt</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
            <span class="s1">stmt</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
        <span class="s3">});</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Default</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;default:&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Case</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;case&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;:&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print_body</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ exceptions ]----- */</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Try</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;try&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">body</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">bcatch</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">bcatch</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">bfinally</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">bfinally</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_TryBlock</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Catch</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;catch&quot;</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">argname</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">argname</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Finally</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;finally&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ var/const ]----- */</span>
    <span class="s1">AST_Definitions</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">kind</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">kind</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">definitions</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">def</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
            <span class="s1">def</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
        <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">in_for </span><span class="s3">= </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_For </span><span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_ForIn</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">output_semicolon </span><span class="s3">= !</span><span class="s1">in_for </span><span class="s3">|| </span><span class="s1">p </span><span class="s3">&amp;&amp; </span><span class="s1">p</span><span class="s3">.</span><span class="s1">init </span><span class="s3">!== </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">output_semicolon</span><span class="s3">)</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Let</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;let&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Var</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;var&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Const</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s2">&quot;const&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Import</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;import&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_name</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">imported_name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_name </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;,&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">1 </span><span class="s3">&amp;&amp;</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;*&quot; </span><span class="s3">&amp;&amp;</span>
                <span class="s3">!</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">) {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{&quot;</span><span class="s3">);</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function </span><span class="s3">(</span><span class="s1">name_import</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
                    <span class="s1">name_import</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">) {</span>
                        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;,&quot;</span><span class="s3">);</span>
                    <span class="s3">}</span>
                <span class="s3">});</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_name </span><span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">imported_names</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;from&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">module_name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">attributes</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;with&quot;</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">attributes</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ImportMeta</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;import.meta&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_NameMapping</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">is_import </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">() </span><span class="s4">instanceof </span><span class="s1">AST_Import</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">definition </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">();</span>
        <span class="s4">var </span><span class="s1">foreign_name </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">foreign_name</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">names_are_different </span><span class="s3">=</span>
            <span class="s3">(</span><span class="s1">definition </span><span class="s3">&amp;&amp; </span><span class="s1">definition</span><span class="s3">.</span><span class="s1">mangled_name </span><span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">) !==</span>
            <span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">names_are_different </span><span class="s3">&amp;&amp;</span>
            <span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;*&quot; </span><span class="s3">&amp;&amp;</span>
            <span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">quote </span><span class="s3">!= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">) {</span>
                <span class="s7">// export * as &quot;*&quot;</span>
            <span class="s1">names_are_different </span><span class="s3">= </span><span class="s4">true</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">var </span><span class="s1">foreign_name_is_name </span><span class="s3">= </span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">quote </span><span class="s3">== </span><span class="s4">null</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">names_are_different</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">is_import</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">foreign_name_is_name</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote </span><span class="s3">== </span><span class="s4">null</span><span class="s3">) {</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">);</span>
                <span class="s3">}</span>
                
            <span class="s3">}</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;as&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">is_import</span><span class="s3">) {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">foreign_name_is_name</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
                <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">foreign_name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote </span><span class="s3">== </span><span class="s4">null</span><span class="s3">) {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Export</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;export&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_default</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;default&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">1 </span><span class="s3">&amp;&amp;</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">name</span><span class="s3">.</span><span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;*&quot; </span><span class="s3">&amp;&amp;</span>
                <span class="s3">!</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">name</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">) {</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{&quot;</span><span class="s3">);</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">name_export</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
                    <span class="s1">name_export</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                    <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span><span class="s3">.</span><span class="s1">length </span><span class="s3">- </span><span class="s5">1</span><span class="s3">) {</span>
                        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;,&quot;</span><span class="s3">);</span>
                    <span class="s3">}</span>
                <span class="s3">});</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;}&quot;</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_definition</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_definition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_definition </span><span class="s4">instanceof </span><span class="s1">AST_Definitions</span><span class="s3">) </span><span class="s4">return</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">module_name</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;from&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">module_name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">attributes</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;with&quot;</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">attributes</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value</span>
                <span class="s3">&amp;&amp; !(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value </span><span class="s4">instanceof </span><span class="s1">AST_Defun </span><span class="s3">||</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value </span><span class="s4">instanceof </span><span class="s1">AST_Function </span><span class="s3">||</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">exported_value </span><span class="s4">instanceof </span><span class="s1">AST_Class</span><span class="s3">)</span>
            <span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">module_name</span>
            <span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">exported_names</span>
        <span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s4">function </span><span class="s1">parenthesize_for_noin</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s1">noin</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">parens </span><span class="s3">= </span><span class="s4">false</span><span class="s3">;</span>
        <span class="s7">// need to take some precautions here:</span>
        <span class="s7">//    https://github.com/mishoo/UglifyJS2/issues/60</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">noin</span><span class="s3">) {</span>
            <span class="s1">parens </span><span class="s3">= </span><span class="s1">walk</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">node </span><span class="s3">=&gt; {</span>
                <span class="s7">// Don't go into scopes -- except arrow functions:</span>
                <span class="s7">// https://github.com/terser/terser/issues/1019#issuecomment-877642607</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Scope </span><span class="s3">&amp;&amp; !(</span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Arrow</span><span class="s3">)) {</span>
                    <span class="s4">return true</span><span class="s3">;</span>
                <span class="s3">}</span>
                <span class="s4">if </span><span class="s3">(</span>
                    <span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_Binary </span><span class="s3">&amp;&amp; </span><span class="s1">node</span><span class="s3">.</span><span class="s1">operator </span><span class="s3">== </span><span class="s2">&quot;in&quot;</span>
                    <span class="s3">|| </span><span class="s1">node </span><span class="s4">instanceof </span><span class="s1">AST_PrivateIn</span>
                <span class="s3">) {</span>
                    <span class="s4">return </span><span class="s1">walk_abort</span><span class="s3">;  </span><span class="s7">// makes walk() return true</span>
                <span class="s3">}</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">node</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s1">parens</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_VarDef</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;=&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s4">var </span><span class="s1">p </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">(</span><span class="s5">1</span><span class="s3">);</span>
            <span class="s4">var </span><span class="s1">noin </span><span class="s3">= </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_For </span><span class="s3">|| </span><span class="s1">p </span><span class="s4">instanceof </span><span class="s1">AST_ForIn</span><span class="s3">;</span>
            <span class="s1">parenthesize_for_noin</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">, </span><span class="s1">output</span><span class="s3">, </span><span class="s1">noin</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ other expressions ]----- */</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Call</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self </span><span class="s4">instanceof </span><span class="s1">AST_New </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">args</span><span class="s3">.</span><span class="s1">length </span><span class="s3">=== </span><span class="s5">0</span><span class="s3">)</span>
            <span class="s4">return</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_Call </span><span class="s3">|| </span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_Lambda</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">start</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;?.&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_parens</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">args</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">expr</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
                <span class="s1">expr</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">});</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_New</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;new&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">AST_Call</span><span class="s3">.</span><span class="s1">prototype</span><span class="s3">.</span><span class="s1">_codegen</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">AST_Sequence</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">this</span><span class="s3">.</span><span class="s1">expressions</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">node</span><span class="s3">, </span><span class="s1">index</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">index </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">should_break</span><span class="s3">()) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
            <span class="s1">node</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">});</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Sequence</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s7">// var p = output.parent();</span>
        <span class="s7">// if (p instanceof AST_Statement) {</span>
        <span class="s7">//     output.with_indent(output.next_indent(), function(){</span>
        <span class="s7">//         self._do_print(output);</span>
        <span class="s7">//     });</span>
        <span class="s7">// } else {</span>
        <span class="s7">//     self._do_print(output);</span>
        <span class="s7">// }</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Dot</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">expr </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
        <span class="s1">expr</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">prop </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">property</span><span class="s3">;</span>
        <span class="s4">var </span><span class="s1">print_computed </span><span class="s3">= </span><span class="s1">ALL_RESERVED_WORDS</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">)</span>
            <span class="s3">? </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;ie8&quot;</span><span class="s3">)</span>
            <span class="s3">: !</span><span class="s1">is_identifier_string</span><span class="s3">(</span>
                <span class="s1">prop</span><span class="s3">,</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;ecma&quot;</span><span class="s3">) &gt;= </span><span class="s5">2015 </span><span class="s3">&amp;&amp; !</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;safari10&quot;</span><span class="s3">)</span>
            <span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;?.&quot;</span><span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">print_computed</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;[&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;]&quot;</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">expr </span><span class="s4">instanceof </span><span class="s1">AST_Number </span><span class="s3">&amp;&amp; </span><span class="s1">expr</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">() &gt;= </span><span class="s5">0</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(!</span><span class="s6">/[xa-f.)]/i</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">last</span><span class="s3">())) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;.&quot;</span><span class="s3">);</span>
                <span class="s3">}</span>
            <span class="s3">}</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">self</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;.&quot;</span><span class="s3">);</span>
            <span class="s7">// the name after dot would be mapped about here.</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print_name</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_DotHash</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">expr </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">;</span>
        <span class="s1">expr</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">prop </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">property</span><span class="s3">;</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;?&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;.#&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_name</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Sub</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">optional</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;?.&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;[&quot;</span><span class="s3">);</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">property</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;]&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Chain</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_UnaryPrefix</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">op </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">op </span><span class="s3">=== </span><span class="s2">&quot;--&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">output</span><span class="s3">.</span><span class="s1">last</span><span class="s3">().</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;!&quot;</span><span class="s3">)) {</span>
            <span class="s7">// avoid printing &quot;&lt;!--&quot;</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">op</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s6">/^[a-z]/i</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">op</span><span class="s3">)</span>
            <span class="s3">|| (</span><span class="s6">/[+-]$/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">op</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression </span><span class="s4">instanceof </span><span class="s1">AST_UnaryPrefix</span>
                <span class="s3">&amp;&amp; </span><span class="s6">/^[+-]/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">))) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_UnaryPostfix</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">expression</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Binary</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">op </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">;</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">op</span><span class="s3">[</span><span class="s5">0</span><span class="s3">] == </span><span class="s2">&quot;&gt;&quot; </span><span class="s7">/* &quot;&gt;&gt;&quot; &quot;&gt;&gt;&gt;&quot; &quot;&gt;&quot; &quot;&gt;=&quot; */</span>
            <span class="s3">&amp;&amp; </span><span class="s1">output</span><span class="s3">.</span><span class="s1">last</span><span class="s3">().</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;--&quot;</span><span class="s3">)) {</span>
            <span class="s7">// space is mandatory to avoid outputting --&gt;</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s7">// the space is optional depending on &quot;beautify&quot;</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">op</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Conditional</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">condition</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;?&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">consequent</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">alternative</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s7">/* -----[ literals ]----- */</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Array</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">with_square</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s4">var </span><span class="s1">a </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">elements</span><span class="s3">, </span><span class="s1">len </span><span class="s3">= </span><span class="s1">a</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">len </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">a</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">exp</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
                <span class="s1">exp</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s7">// If the final element is a hole, we need to make sure it</span>
                <span class="s7">// doesn't look like a trailing comma, by inserting an actual</span>
                <span class="s7">// trailing comma.</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i </span><span class="s3">=== </span><span class="s1">len </span><span class="s3">- </span><span class="s5">1 </span><span class="s3">&amp;&amp; </span><span class="s1">exp </span><span class="s4">instanceof </span><span class="s1">AST_Hole</span><span class="s3">)</span>
                  <span class="s1">output</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">();</span>
            <span class="s3">});</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">len </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">});</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Object</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">with_block</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;,&quot;</span><span class="s3">);</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
                <span class="s3">}</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
                <span class="s1">prop</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
        <span class="s3">});</span>
        <span class="s4">else </span><span class="s1">print_braced_empty</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Class</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;class&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">) {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extends</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">parens </span><span class="s3">= (</span>
                   <span class="s3">!(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extends </span><span class="s4">instanceof </span><span class="s1">AST_SymbolRef</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; !(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extends </span><span class="s4">instanceof </span><span class="s1">AST_PropAccess</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; !(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extends </span><span class="s4">instanceof </span><span class="s1">AST_ClassExpression</span><span class="s3">)</span>
                <span class="s3">&amp;&amp; !(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">extends </span><span class="s4">instanceof </span><span class="s1">AST_Function</span><span class="s3">)</span>
            <span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;extends&quot;</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">parens</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;(&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">extends</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">parens</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;)&quot;</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&gt; </span><span class="s5">0</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">with_block</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">properties</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">prop</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) {</span>
                <span class="s4">if </span><span class="s3">(</span><span class="s1">i</span><span class="s3">) {</span>
                    <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
                <span class="s3">}</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
                <span class="s1">prop</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
        <span class="s3">});</span>
        <span class="s4">else </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{}&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_NewTarget</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;new.target&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s0">/** Prints a prop name. Returns whether it can be used as a shorthand. */</span>
    <span class="s4">function </span><span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;quote_keys&quot;</span><span class="s3">)) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
            <span class="s4">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s2">&quot;&quot; </span><span class="s3">+ +</span><span class="s1">key </span><span class="s3">== </span><span class="s1">key </span><span class="s3">&amp;&amp; </span><span class="s1">key </span><span class="s3">&gt;= </span><span class="s5">0</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;keep_numbers&quot;</span><span class="s3">)) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
                <span class="s4">return false</span><span class="s3">;</span>
            <span class="s3">}</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">make_num</span><span class="s3">(</span><span class="s1">key</span><span class="s3">));</span>
            <span class="s4">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s4">var </span><span class="s1">print_string </span><span class="s3">= </span><span class="s1">ALL_RESERVED_WORDS</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
            <span class="s3">? </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;ie8&quot;</span><span class="s3">)</span>
            <span class="s3">: (</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;ecma&quot;</span><span class="s3">) &lt; </span><span class="s5">2015 </span><span class="s3">|| </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;safari10&quot;</span><span class="s3">)</span>
                    <span class="s3">? !</span><span class="s1">is_basic_identifier_string</span><span class="s3">(</span><span class="s1">key</span><span class="s3">)</span>
                    <span class="s3">: !</span><span class="s1">is_identifier_string</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s4">true</span><span class="s3">)</span>
            <span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">print_string </span><span class="s3">|| (</span><span class="s1">quote </span><span class="s3">&amp;&amp; </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;keep_quoted_props&quot;</span><span class="s3">))) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">key</span><span class="s3">, </span><span class="s1">quote</span><span class="s3">);</span>
            <span class="s4">return false</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_name</span><span class="s3">(</span><span class="s1">key</span><span class="s3">);</span>
        <span class="s4">return true</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ObjectKeyVal</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">function </span><span class="s1">get_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">) {</span>
            <span class="s4">var </span><span class="s1">def </span><span class="s3">= </span><span class="s1">self</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">();</span>
            <span class="s4">return </span><span class="s1">def </span><span class="s3">? </span><span class="s1">def</span><span class="s3">.</span><span class="s1">mangled_name </span><span class="s3">|| </span><span class="s1">def</span><span class="s3">.</span><span class="s1">name </span><span class="s3">: </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">;</span>
        <span class="s3">}</span>

        <span class="s4">const </span><span class="s1">try_shorthand </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;shorthand&quot;</span><span class="s3">) &amp;&amp; !(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key </span><span class="s4">instanceof </span><span class="s1">AST_Node</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span>
            <span class="s1">try_shorthand</span>
            <span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">value </span><span class="s4">instanceof </span><span class="s1">AST_Symbol</span>
            <span class="s3">&amp;&amp; </span><span class="s1">get_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) === </span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span>
            <span class="s3">&amp;&amp; !</span><span class="s1">ALL_RESERVED_WORDS</span><span class="s3">.</span><span class="s1">has</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">)</span>
        <span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">was_shorthand </span><span class="s3">= </span><span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">was_shorthand</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">();</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">}</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span>
            <span class="s1">try_shorthand</span>
            <span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">value </span><span class="s4">instanceof </span><span class="s1">AST_DefaultAssign</span>
            <span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">left </span><span class="s4">instanceof </span><span class="s1">AST_Symbol</span>
            <span class="s3">&amp;&amp; </span><span class="s1">get_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">left</span><span class="s3">) === </span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span>
        <span class="s3">) {</span>
            <span class="s4">const </span><span class="s1">was_shorthand </span><span class="s3">= </span><span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">was_shorthand</span><span class="s3">) {</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">();</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">left</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">}</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;=&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">right</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(!(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key </span><span class="s4">instanceof </span><span class="s1">AST_Node</span><span class="s3">)) {</span>
                <span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">with_square</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                    <span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
                <span class="s3">});</span>
            <span class="s3">}</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">();</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ClassPrivateProperty</span><span class="s3">, (</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) =&gt; {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">static</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;static&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>

        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;#&quot;</span><span class="s3">);</span>
        
        <span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;=&quot;</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>

        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ClassProperty</span><span class="s3">, (</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) =&gt; {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">static</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;static&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key </span><span class="s4">instanceof </span><span class="s1">AST_SymbolClassProperty</span><span class="s3">) {</span>
            <span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;[&quot;</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;]&quot;</span><span class="s3">);</span>
        <span class="s3">}</span>

        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;=&quot;</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>

        <span class="s1">output</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">();</span>
    <span class="s3">});</span>
    <span class="s1">AST_ObjectProperty</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_print_getter_setter&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s1">is_private</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">self </span><span class="s3">= </span><span class="s4">this</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">static</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;static&quot;</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">type</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">type</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s3">}</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key </span><span class="s4">instanceof </span><span class="s1">AST_SymbolMethod</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">is_private</span><span class="s3">) </span><span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;#&quot;</span><span class="s3">);</span>
            <span class="s1">print_property_name</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">name</span><span class="s3">, </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">add_source_map</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">with_square</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
                <span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s3">});</span>
        <span class="s3">}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">, </span><span class="s4">true</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ObjectSetter</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s2">&quot;set&quot;</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ObjectGetter</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s2">&quot;get&quot;</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_PrivateSetter</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s2">&quot;set&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_PrivateGetter</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s2">&quot;get&quot;</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ConciseMethod</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">type</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_generator </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;async*&quot;</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_generator</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;*&quot;</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;async&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_PrivateMethod</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">type</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_generator </span><span class="s3">&amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;async*&quot;</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">is_generator</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;*&quot;</span><span class="s3">;</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">async</span><span class="s3">) {</span>
            <span class="s1">type </span><span class="s3">= </span><span class="s2">&quot;async&quot;</span><span class="s3">;</span>
        <span class="s3">}</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_print_getter_setter</span><span class="s3">(</span><span class="s1">type</span><span class="s3">, </span><span class="s4">true</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_PrivateIn</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">key</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;in&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">value</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_SymbolPrivateProperty</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;#&quot; </span><span class="s3">+ </span><span class="s1">self</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_ClassStaticBlock</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;static&quot;</span><span class="s3">);</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">space</span><span class="s3">();</span>
        <span class="s1">print_braced</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">AST_Symbol</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;_do_print&quot;</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">def </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">definition</span><span class="s3">();</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_name</span><span class="s3">(</span><span class="s1">def </span><span class="s3">? </span><span class="s1">def</span><span class="s3">.</span><span class="s1">mangled_name </span><span class="s3">|| </span><span class="s1">def</span><span class="s3">.</span><span class="s1">name </span><span class="s3">: </span><span class="s4">this</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Symbol</span><span class="s3">, </span><span class="s4">function </span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">self</span><span class="s3">.</span><span class="s1">_do_print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Hole</span><span class="s3">, </span><span class="s1">noop</span><span class="s3">);</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_This</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;this&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Super</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;super&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Constant</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">());</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_String</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print_string</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">(), </span><span class="s1">self</span><span class="s3">.</span><span class="s1">quote</span><span class="s3">, </span><span class="s1">output</span><span class="s3">.</span><span class="s1">in_directive</span><span class="s3">);</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_Number</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">((</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;keep_numbers&quot;</span><span class="s3">) || </span><span class="s1">output</span><span class="s3">.</span><span class="s1">use_asm</span><span class="s3">) &amp;&amp; </span><span class="s1">self</span><span class="s3">.</span><span class="s1">raw</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">raw</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">make_num</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">()));</span>
        <span class="s3">}</span>
    <span class="s3">});</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_BigInt</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">self</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">() + </span><span class="s2">&quot;n&quot;</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s4">const </span><span class="s1">r_slash_script </span><span class="s3">= </span><span class="s6">/(&lt;\s*\/\s*script)/i</span><span class="s3">;</span>
    <span class="s4">const </span><span class="s1">r_starts_with_script </span><span class="s3">= </span><span class="s6">/^\s*script/i</span><span class="s3">;</span>
    <span class="s4">const </span><span class="s1">slash_script_replace </span><span class="s3">= (</span><span class="s1">_</span><span class="s3">, </span><span class="s1">$1</span><span class="s3">) =&gt; </span><span class="s1">$1</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s2">&quot;/&quot;</span><span class="s3">, </span><span class="s2">&quot;</span><span class="s4">\\</span><span class="s2">/&quot;</span><span class="s3">);</span>
    <span class="s1">DEFPRINT</span><span class="s3">(</span><span class="s1">AST_RegExp</span><span class="s3">, </span><span class="s4">function</span><span class="s3">(</span><span class="s1">self</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">let </span><span class="s3">{ </span><span class="s1">source</span><span class="s3">, </span><span class="s1">flags </span><span class="s3">} = </span><span class="s1">self</span><span class="s3">.</span><span class="s1">getValue</span><span class="s3">();</span>
        <span class="s1">source </span><span class="s3">= </span><span class="s1">regexp_source_fix</span><span class="s3">(</span><span class="s1">source</span><span class="s3">);</span>
        <span class="s1">flags </span><span class="s3">= </span><span class="s1">flags </span><span class="s3">? </span><span class="s1">sort_regexp_flags</span><span class="s3">(</span><span class="s1">flags</span><span class="s3">) : </span><span class="s2">&quot;&quot;</span><span class="s3">;</span>

        <span class="s7">// Avoid outputting end of script tag</span>
        <span class="s1">source </span><span class="s3">= </span><span class="s1">source</span><span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s1">r_slash_script</span><span class="s3">, </span><span class="s1">slash_script_replace</span><span class="s3">);</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">r_starts_with_script</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">source</span><span class="s3">) &amp;&amp; </span><span class="s1">output</span><span class="s3">.</span><span class="s1">last</span><span class="s3">().</span><span class="s1">endsWith</span><span class="s3">(</span><span class="s2">&quot;&lt;&quot;</span><span class="s3">)) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
        <span class="s3">}</span>

        <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">to_utf8</span><span class="s3">(</span><span class="s2">`/</span><span class="s1">$</span><span class="s3">{</span><span class="s1">source</span><span class="s3">}</span><span class="s2">/</span><span class="s1">$</span><span class="s3">{</span><span class="s1">flags</span><span class="s3">}</span><span class="s2">`</span><span class="s3">, </span><span class="s4">false</span><span class="s3">, </span><span class="s4">true</span><span class="s3">));</span>

        <span class="s4">const </span><span class="s1">parent </span><span class="s3">= </span><span class="s1">output</span><span class="s3">.</span><span class="s1">parent</span><span class="s3">();</span>
        <span class="s4">if </span><span class="s3">(</span>
            <span class="s1">parent </span><span class="s4">instanceof </span><span class="s1">AST_Binary</span>
            <span class="s3">&amp;&amp; </span><span class="s6">/^\w/</span><span class="s3">.</span><span class="s1">test</span><span class="s3">(</span><span class="s1">parent</span><span class="s3">.</span><span class="s1">operator</span><span class="s3">)</span>
            <span class="s3">&amp;&amp; </span><span class="s1">parent</span><span class="s3">.</span><span class="s1">left </span><span class="s3">=== </span><span class="s1">self</span>
        <span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot; &quot;</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s0">/** if, for, while, may or may not have braces surrounding its body */</span>
    <span class="s4">function </span><span class="s1">print_maybe_braced_body</span><span class="s3">(</span><span class="s1">stat</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">output</span><span class="s3">.</span><span class="s1">option</span><span class="s3">(</span><span class="s2">&quot;braces&quot;</span><span class="s3">)) {</span>
            <span class="s1">make_block</span><span class="s3">(</span><span class="s1">stat</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s4">if </span><span class="s3">(!</span><span class="s1">stat </span><span class="s3">|| </span><span class="s1">stat </span><span class="s4">instanceof </span><span class="s1">AST_EmptyStatement</span><span class="s3">)</span>
                <span class="s1">output</span><span class="s3">.</span><span class="s1">force_semicolon</span><span class="s3">();</span>
            <span class="s4">else if </span><span class="s3">(</span><span class="s1">stat </span><span class="s4">instanceof </span><span class="s1">AST_Let </span><span class="s3">|| </span><span class="s1">stat </span><span class="s4">instanceof </span><span class="s1">AST_Const </span><span class="s3">|| </span><span class="s1">stat </span><span class="s4">instanceof </span><span class="s1">AST_Class</span><span class="s3">)</span>
                <span class="s1">make_block</span><span class="s3">(</span><span class="s1">stat</span><span class="s3">, </span><span class="s1">output</span><span class="s3">);</span>
            <span class="s4">else</span>
                <span class="s1">stat</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">best_of</span><span class="s3">(</span><span class="s1">a</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">best </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s5">0</span><span class="s3">], </span><span class="s1">len </span><span class="s3">= </span><span class="s1">best</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
        <span class="s4">for </span><span class="s3">(</span><span class="s4">var </span><span class="s1">i </span><span class="s3">= </span><span class="s5">1</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s1">a</span><span class="s3">.</span><span class="s1">length</span><span class="s3">; ++</span><span class="s1">i</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">a</span><span class="s3">[</span><span class="s1">i</span><span class="s3">].</span><span class="s1">length </span><span class="s3">&lt; </span><span class="s1">len</span><span class="s3">) {</span>
                <span class="s1">best </span><span class="s3">= </span><span class="s1">a</span><span class="s3">[</span><span class="s1">i</span><span class="s3">];</span>
                <span class="s1">len </span><span class="s3">= </span><span class="s1">best</span><span class="s3">.</span><span class="s1">length</span><span class="s3">;</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">best</span><span class="s3">;</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">make_num</span><span class="s3">(</span><span class="s1">num</span><span class="s3">) {</span>
        <span class="s4">var </span><span class="s1">str </span><span class="s3">= </span><span class="s1">num</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">10</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s6">/^0\./</span><span class="s3">, </span><span class="s2">&quot;.&quot;</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s2">&quot;e+&quot;</span><span class="s3">, </span><span class="s2">&quot;e&quot;</span><span class="s3">);</span>
        <span class="s4">var </span><span class="s1">candidates </span><span class="s3">= [ </span><span class="s1">str </span><span class="s3">];</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">Math</span><span class="s3">.</span><span class="s1">floor</span><span class="s3">(</span><span class="s1">num</span><span class="s3">) === </span><span class="s1">num</span><span class="s3">) {</span>
            <span class="s4">if </span><span class="s3">(</span><span class="s1">num </span><span class="s3">&lt; </span><span class="s5">0</span><span class="s3">) {</span>
                <span class="s1">candidates</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s2">&quot;-0x&quot; </span><span class="s3">+ (-</span><span class="s1">num</span><span class="s3">).</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">16</span><span class="s3">).</span><span class="s1">toLowerCase</span><span class="s3">());</span>
            <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
                <span class="s1">candidates</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s2">&quot;0x&quot; </span><span class="s3">+ </span><span class="s1">num</span><span class="s3">.</span><span class="s1">toString</span><span class="s3">(</span><span class="s5">16</span><span class="s3">).</span><span class="s1">toLowerCase</span><span class="s3">());</span>
            <span class="s3">}</span>
        <span class="s3">}</span>
        <span class="s4">var </span><span class="s1">match</span><span class="s3">, </span><span class="s1">len</span><span class="s3">, </span><span class="s1">digits</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">match </span><span class="s3">= </span><span class="s6">/^\.0+/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)) {</span>
            <span class="s1">len </span><span class="s3">= </span><span class="s1">match</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">length</span><span class="s3">;</span>
            <span class="s1">digits </span><span class="s3">= </span><span class="s1">str</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">len</span><span class="s3">);</span>
            <span class="s1">candidates</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">digits </span><span class="s3">+ </span><span class="s2">&quot;e-&quot; </span><span class="s3">+ (</span><span class="s1">digits</span><span class="s3">.</span><span class="s1">length </span><span class="s3">+ </span><span class="s1">len </span><span class="s3">- </span><span class="s5">1</span><span class="s3">));</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">match </span><span class="s3">= </span><span class="s6">/0+$/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)) {</span>
            <span class="s1">len </span><span class="s3">= </span><span class="s1">match</span><span class="s3">[</span><span class="s5">0</span><span class="s3">].</span><span class="s1">length</span><span class="s3">;</span>
            <span class="s1">candidates</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">str</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s5">0</span><span class="s3">, -</span><span class="s1">len</span><span class="s3">) + </span><span class="s2">&quot;e&quot; </span><span class="s3">+ </span><span class="s1">len</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else if </span><span class="s3">(</span><span class="s1">match </span><span class="s3">= </span><span class="s6">/^(\d)\.(\d+)e(-?\d+)$/</span><span class="s3">.</span><span class="s1">exec</span><span class="s3">(</span><span class="s1">str</span><span class="s3">)) {</span>
            <span class="s1">candidates</span><span class="s3">.</span><span class="s1">push</span><span class="s3">(</span><span class="s1">match</span><span class="s3">[</span><span class="s5">1</span><span class="s3">] + </span><span class="s1">match</span><span class="s3">[</span><span class="s5">2</span><span class="s3">] + </span><span class="s2">&quot;e&quot; </span><span class="s3">+ (</span><span class="s1">match</span><span class="s3">[</span><span class="s5">3</span><span class="s3">] - </span><span class="s1">match</span><span class="s3">[</span><span class="s5">2</span><span class="s3">].</span><span class="s1">length</span><span class="s3">));</span>
        <span class="s3">}</span>
        <span class="s4">return </span><span class="s1">best_of</span><span class="s3">(</span><span class="s1">candidates</span><span class="s3">);</span>
    <span class="s3">}</span>

    <span class="s4">function </span><span class="s1">make_block</span><span class="s3">(</span><span class="s1">stmt</span><span class="s3">, </span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">if </span><span class="s3">(!</span><span class="s1">stmt </span><span class="s3">|| </span><span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_EmptyStatement</span><span class="s3">)</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s2">&quot;{}&quot;</span><span class="s3">);</span>
        <span class="s4">else if </span><span class="s3">(</span><span class="s1">stmt </span><span class="s4">instanceof </span><span class="s1">AST_BlockStatement</span><span class="s3">)</span>
            <span class="s1">stmt</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
        <span class="s4">else </span><span class="s1">output</span><span class="s3">.</span><span class="s1">with_block</span><span class="s3">(</span><span class="s4">function</span><span class="s3">() {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">indent</span><span class="s3">();</span>
            <span class="s1">stmt</span><span class="s3">.</span><span class="s1">print</span><span class="s3">(</span><span class="s1">output</span><span class="s3">);</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">newline</span><span class="s3">();</span>
        <span class="s3">});</span>
    <span class="s3">}</span>

    <span class="s7">/* -----[ source map generators ]----- */</span>

    <span class="s4">function </span><span class="s1">DEFMAP</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">, </span><span class="s1">generator</span><span class="s3">) {</span>
        <span class="s1">nodetype</span><span class="s3">.</span><span class="s1">forEach</span><span class="s3">(</span><span class="s4">function</span><span class="s3">(</span><span class="s1">nodetype</span><span class="s3">) {</span>
            <span class="s1">nodetype</span><span class="s3">.</span><span class="s1">DEFMETHOD</span><span class="s3">(</span><span class="s2">&quot;add_source_map&quot;</span><span class="s3">, </span><span class="s1">generator</span><span class="s3">);</span>
        <span class="s3">});</span>
    <span class="s3">}</span>

    <span class="s1">DEFMAP</span><span class="s3">([</span>
        <span class="s7">// We could easily add info for ALL nodes, but it seems to me that</span>
        <span class="s7">// would be quite wasteful, hence this noop in the base class.</span>
        <span class="s1">AST_Node</span><span class="s3">,</span>
        <span class="s7">// since the label symbol will mark it</span>
        <span class="s1">AST_LabeledStatement</span><span class="s3">,</span>
        <span class="s1">AST_Toplevel</span><span class="s3">,</span>
    <span class="s3">], </span><span class="s1">noop</span><span class="s3">);</span>

    <span class="s7">// XXX: I'm not exactly sure if we need it for all of these nodes,</span>
    <span class="s7">// or if we should add even more.</span>
    <span class="s1">DEFMAP</span><span class="s3">([</span>
        <span class="s1">AST_Array</span><span class="s3">,</span>
        <span class="s1">AST_BlockStatement</span><span class="s3">,</span>
        <span class="s1">AST_Catch</span><span class="s3">,</span>
        <span class="s1">AST_Class</span><span class="s3">,</span>
        <span class="s1">AST_Constant</span><span class="s3">,</span>
        <span class="s1">AST_Debugger</span><span class="s3">,</span>
        <span class="s1">AST_Definitions</span><span class="s3">,</span>
        <span class="s1">AST_Directive</span><span class="s3">,</span>
        <span class="s1">AST_Finally</span><span class="s3">,</span>
        <span class="s1">AST_Jump</span><span class="s3">,</span>
        <span class="s1">AST_Lambda</span><span class="s3">,</span>
        <span class="s1">AST_New</span><span class="s3">,</span>
        <span class="s1">AST_Object</span><span class="s3">,</span>
        <span class="s1">AST_StatementWithBody</span><span class="s3">,</span>
        <span class="s1">AST_Symbol</span><span class="s3">,</span>
        <span class="s1">AST_Switch</span><span class="s3">,</span>
        <span class="s1">AST_SwitchBranch</span><span class="s3">,</span>
        <span class="s1">AST_TemplateString</span><span class="s3">,</span>
        <span class="s1">AST_TemplateSegment</span><span class="s3">,</span>
        <span class="s1">AST_Try</span><span class="s3">,</span>
    <span class="s3">], </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">start</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFMAP</span><span class="s3">([</span>
        <span class="s1">AST_ObjectGetter</span><span class="s3">,</span>
        <span class="s1">AST_ObjectSetter</span><span class="s3">,</span>
        <span class="s1">AST_PrivateGetter</span><span class="s3">,</span>
        <span class="s1">AST_PrivateSetter</span><span class="s3">,</span>
        <span class="s1">AST_ConciseMethod</span><span class="s3">,</span>
        <span class="s1">AST_PrivateMethod</span><span class="s3">,</span>
    <span class="s3">], </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">start</span><span class="s3">, </span><span class="s4">false </span><span class="s7">/*name handled below*/</span><span class="s3">);</span>
    <span class="s3">});</span>

    <span class="s1">DEFMAP</span><span class="s3">([</span>
        <span class="s1">AST_SymbolMethod</span><span class="s3">,</span>
        <span class="s1">AST_SymbolPrivateProperty</span>
    <span class="s3">], </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s4">const </span><span class="s1">tok_type </span><span class="s3">= </span><span class="s4">this</span><span class="s3">.</span><span class="s1">end </span><span class="s3">&amp;&amp; </span><span class="s4">this</span><span class="s3">.</span><span class="s1">end</span><span class="s3">.</span><span class="s1">type</span><span class="s3">;</span>
        <span class="s4">if </span><span class="s3">(</span><span class="s1">tok_type </span><span class="s3">=== </span><span class="s2">&quot;name&quot; </span><span class="s3">|| </span><span class="s1">tok_type </span><span class="s3">=== </span><span class="s2">&quot;privatename&quot;</span><span class="s3">) {</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">end</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">name</span><span class="s3">);</span>
        <span class="s3">} </span><span class="s4">else </span><span class="s3">{</span>
            <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">end</span><span class="s3">);</span>
        <span class="s3">}</span>
    <span class="s3">});</span>

    <span class="s1">DEFMAP</span><span class="s3">([ </span><span class="s1">AST_ObjectProperty </span><span class="s3">], </span><span class="s4">function</span><span class="s3">(</span><span class="s1">output</span><span class="s3">) {</span>
        <span class="s1">output</span><span class="s3">.</span><span class="s1">add_mapping</span><span class="s3">(</span><span class="s4">this</span><span class="s3">.</span><span class="s1">start</span><span class="s3">, </span><span class="s4">this</span><span class="s3">.</span><span class="s1">key</span><span class="s3">);</span>
    <span class="s3">});</span>
<span class="s3">})();</span>

<span class="s4">export </span><span class="s3">{</span>
    <span class="s1">OutputStream</span><span class="s3">,</span>
<span class="s3">};</span>
</pre>
</body>
</html>