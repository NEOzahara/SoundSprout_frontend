<html>
<head>
<title>umd-with-async-ittr.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #bcbec4;}
.s1 { color: #cf8e6d;}
.s2 { color: #bcbec4;}
.s3 { color: #6aab73;}
.s4 { color: #2aacb8;}
.s5 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
umd-with-async-ittr.js</font>
</center></td></tr></table>
<pre><span class="s0">!</span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">){</span><span class="s3">&quot;object&quot;</span><span class="s0">==</span><span class="s1">typeof </span><span class="s2">exports</span><span class="s0">&amp;&amp;</span><span class="s3">&quot;undefined&quot;</span><span class="s0">!=</span><span class="s1">typeof </span><span class="s2">module</span><span class="s0">?</span><span class="s2">t</span><span class="s0">(</span><span class="s2">exports</span><span class="s0">):</span><span class="s3">&quot;function&quot;</span><span class="s0">==</span><span class="s1">typeof </span><span class="s2">define</span><span class="s0">&amp;&amp;</span><span class="s2">define</span><span class="s0">.</span><span class="s2">amd</span><span class="s0">?</span><span class="s2">define</span><span class="s0">([</span><span class="s3">&quot;exports&quot;</span><span class="s0">],</span><span class="s2">t</span><span class="s0">):</span><span class="s2">t</span><span class="s0">((</span><span class="s2">e</span><span class="s0">=</span><span class="s3">&quot;undefined&quot;</span><span class="s0">!=</span><span class="s1">typeof </span><span class="s2">globalThis</span><span class="s0">?</span><span class="s2">globalThis</span><span class="s0">:</span><span class="s2">e</span><span class="s0">||</span><span class="s2">self</span><span class="s0">).</span><span class="s2">idb</span><span class="s0">={})}(</span><span class="s1">this</span><span class="s0">,(</span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s3">&quot;use strict&quot;</span><span class="s0">;</span><span class="s1">const </span><span class="s2">t</span><span class="s0">=(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">)=&gt;</span><span class="s2">t</span><span class="s0">.</span><span class="s2">some</span><span class="s0">((</span><span class="s2">t</span><span class="s0">=&gt;</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">t</span><span class="s0">));</span><span class="s1">let </span><span class="s2">n</span><span class="s0">,</span><span class="s2">r</span><span class="s0">;</span><span class="s1">const </span><span class="s2">o</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">s</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">i</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">a</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">c</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">;</span><span class="s1">let </span><span class="s2">u</span><span class="s0">={</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">IDBTransaction</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(</span><span class="s3">&quot;done&quot;</span><span class="s0">===</span><span class="s2">t</span><span class="s0">)</span><span class="s1">return </span><span class="s2">s</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">if</span><span class="s0">(</span><span class="s3">&quot;objectStoreNames&quot;</span><span class="s0">===</span><span class="s2">t</span><span class="s0">)</span><span class="s1">return </span><span class="s2">e</span><span class="s0">.</span><span class="s2">objectStoreNames</span><span class="s0">||</span><span class="s2">i</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">if</span><span class="s0">(</span><span class="s3">&quot;store&quot;</span><span class="s0">===</span><span class="s2">t</span><span class="s0">)</span><span class="s1">return </span><span class="s2">n</span><span class="s0">.</span><span class="s2">objectStoreNames</span><span class="s0">[</span><span class="s4">1</span><span class="s0">]?</span><span class="s1">void </span><span class="s4">0</span><span class="s0">:</span><span class="s2">n</span><span class="s0">.</span><span class="s2">objectStore</span><span class="s0">(</span><span class="s2">n</span><span class="s0">.</span><span class="s2">objectStoreNames</span><span class="s0">[</span><span class="s4">0</span><span class="s0">])}</span><span class="s1">return </span><span class="s2">p</span><span class="s0">(</span><span class="s2">e</span><span class="s0">[</span><span class="s2">t</span><span class="s0">])},</span><span class="s2">set</span><span class="s0">:(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)=&gt;(</span><span class="s2">e</span><span class="s0">[</span><span class="s2">t</span><span class="s0">]=</span><span class="s2">n</span><span class="s0">,!</span><span class="s4">0</span><span class="s0">),</span><span class="s2">has</span><span class="s0">:(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">)=&gt;</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">IDBTransaction</span><span class="s0">&amp;&amp;(</span><span class="s3">&quot;done&quot;</span><span class="s0">===</span><span class="s2">t</span><span class="s0">||</span><span class="s3">&quot;store&quot;</span><span class="s0">===</span><span class="s2">t</span><span class="s0">)||</span><span class="s2">t </span><span class="s1">in </span><span class="s2">e</span><span class="s0">};</span><span class="s1">function </span><span class="s2">d</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s2">u</span><span class="s0">=</span><span class="s2">e</span><span class="s0">(</span><span class="s2">u</span><span class="s0">)}</span><span class="s1">function </span><span class="s2">f</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s1">return </span><span class="s2">e</span><span class="s0">!==</span><span class="s2">IDBDatabase</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">transaction</span><span class="s0">||</span><span class="s3">&quot;objectStoreNames&quot;</span><span class="s1">in </span><span class="s2">IDBTransaction</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">?(</span><span class="s2">r</span><span class="s0">||(</span><span class="s2">r</span><span class="s0">=[</span><span class="s2">IDBCursor</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">advance</span><span class="s0">,</span><span class="s2">IDBCursor</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">continue</span><span class="s0">,</span><span class="s2">IDBCursor</span><span class="s0">.</span><span class="s2">prototype</span><span class="s0">.</span><span class="s2">continuePrimaryKey</span><span class="s0">])).</span><span class="s2">includes</span><span class="s0">(</span><span class="s2">e</span><span class="s0">)?</span><span class="s1">function</span><span class="s0">(</span><span class="s2">...t</span><span class="s0">){</span><span class="s1">return </span><span class="s2">e</span><span class="s0">.</span><span class="s2">apply</span><span class="s0">(</span><span class="s2">D</span><span class="s0">(</span><span class="s1">this</span><span class="s0">),</span><span class="s2">t</span><span class="s0">),</span><span class="s2">p</span><span class="s0">(</span><span class="s2">o</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s1">this</span><span class="s0">))}:</span><span class="s1">function</span><span class="s0">(</span><span class="s2">...t</span><span class="s0">){</span><span class="s1">return </span><span class="s2">p</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">apply</span><span class="s0">(</span><span class="s2">D</span><span class="s0">(</span><span class="s1">this</span><span class="s0">),</span><span class="s2">t</span><span class="s0">))}:</span><span class="s1">function</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">...n</span><span class="s0">){</span><span class="s1">const </span><span class="s2">r</span><span class="s0">=</span><span class="s2">e</span><span class="s0">.</span><span class="s2">call</span><span class="s0">(</span><span class="s2">D</span><span class="s0">(</span><span class="s1">this</span><span class="s0">),</span><span class="s2">t</span><span class="s0">,</span><span class="s2">...n</span><span class="s0">);</span><span class="s1">return </span><span class="s2">i</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">r</span><span class="s0">,</span><span class="s2">t</span><span class="s0">.</span><span class="s2">sort</span><span class="s0">?</span><span class="s2">t</span><span class="s0">.</span><span class="s2">sort</span><span class="s0">():[</span><span class="s2">t</span><span class="s0">]),</span><span class="s2">p</span><span class="s0">(</span><span class="s2">r</span><span class="s0">)}}</span><span class="s1">function </span><span class="s2">l</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s1">return</span><span class="s3">&quot;function&quot;</span><span class="s0">==</span><span class="s1">typeof </span><span class="s2">e</span><span class="s0">?</span><span class="s2">f</span><span class="s0">(</span><span class="s2">e</span><span class="s0">):(</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">IDBTransaction</span><span class="s0">&amp;&amp;</span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(</span><span class="s2">s</span><span class="s0">.</span><span class="s2">has</span><span class="s0">(</span><span class="s2">e</span><span class="s0">))</span><span class="s1">return</span><span class="s0">;</span><span class="s1">const </span><span class="s2">t</span><span class="s0">=</span><span class="s1">new </span><span class="s2">Promise</span><span class="s0">(((</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)=&gt;{</span><span class="s1">const </span><span class="s2">r</span><span class="s0">=()=&gt;{</span><span class="s2">e</span><span class="s0">.</span><span class="s2">removeEventListener</span><span class="s0">(</span><span class="s3">&quot;complete&quot;</span><span class="s0">,</span><span class="s2">o</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">removeEventListener</span><span class="s0">(</span><span class="s3">&quot;error&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">removeEventListener</span><span class="s0">(</span><span class="s3">&quot;abort&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">)},</span><span class="s2">o</span><span class="s0">=()=&gt;{</span><span class="s2">t</span><span class="s0">(),</span><span class="s2">r</span><span class="s0">()},</span><span class="s2">s</span><span class="s0">=()=&gt;{</span><span class="s2">n</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">error</span><span class="s0">||</span><span class="s1">new </span><span class="s2">DOMException</span><span class="s0">(</span><span class="s3">&quot;AbortError&quot;</span><span class="s0">,</span><span class="s3">&quot;AbortError&quot;</span><span class="s0">)),</span><span class="s2">r</span><span class="s0">()};</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;complete&quot;</span><span class="s0">,</span><span class="s2">o</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;error&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;abort&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">)}));</span><span class="s2">s</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">)}(</span><span class="s2">e</span><span class="s0">),</span><span class="s2">t</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">n</span><span class="s0">||(</span><span class="s2">n</span><span class="s0">=[</span><span class="s2">IDBDatabase</span><span class="s0">,</span><span class="s2">IDBObjectStore</span><span class="s0">,</span><span class="s2">IDBIndex</span><span class="s0">,</span><span class="s2">IDBCursor</span><span class="s0">,</span><span class="s2">IDBTransaction</span><span class="s0">]))?</span><span class="s1">new </span><span class="s2">Proxy</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">u</span><span class="s0">):</span><span class="s2">e</span><span class="s0">)}</span><span class="s1">function </span><span class="s2">p</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">IDBRequest</span><span class="s0">)</span><span class="s1">return function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">){</span><span class="s1">const </span><span class="s2">t</span><span class="s0">=</span><span class="s1">new </span><span class="s2">Promise</span><span class="s0">(((</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)=&gt;{</span><span class="s1">const </span><span class="s2">r</span><span class="s0">=()=&gt;{</span><span class="s2">e</span><span class="s0">.</span><span class="s2">removeEventListener</span><span class="s0">(</span><span class="s3">&quot;success&quot;</span><span class="s0">,</span><span class="s2">o</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">removeEventListener</span><span class="s0">(</span><span class="s3">&quot;error&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">)},</span><span class="s2">o</span><span class="s0">=()=&gt;{</span><span class="s2">t</span><span class="s0">(</span><span class="s2">p</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">result</span><span class="s0">)),</span><span class="s2">r</span><span class="s0">()},</span><span class="s2">s</span><span class="s0">=()=&gt;{</span><span class="s2">n</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">error</span><span class="s0">),</span><span class="s2">r</span><span class="s0">()};</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;success&quot;</span><span class="s0">,</span><span class="s2">o</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;error&quot;</span><span class="s0">,</span><span class="s2">s</span><span class="s0">)}));</span><span class="s1">return </span><span class="s2">t</span><span class="s0">.</span><span class="s2">then</span><span class="s0">((</span><span class="s2">t</span><span class="s0">=&gt;{</span><span class="s2">t </span><span class="s1">instanceof </span><span class="s2">IDBCursor</span><span class="s0">&amp;&amp;</span><span class="s2">o</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">e</span><span class="s0">)})).</span><span class="s2">catch</span><span class="s0">((()=&gt;{})),</span><span class="s2">c</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">e</span><span class="s0">),</span><span class="s2">t</span><span class="s0">}(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">if</span><span class="s0">(</span><span class="s2">a</span><span class="s0">.</span><span class="s2">has</span><span class="s0">(</span><span class="s2">e</span><span class="s0">))</span><span class="s1">return </span><span class="s2">a</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">const </span><span class="s2">t</span><span class="s0">=</span><span class="s2">l</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">return </span><span class="s2">t</span><span class="s0">!==</span><span class="s2">e</span><span class="s0">&amp;&amp;(</span><span class="s2">a</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">),</span><span class="s2">c</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">e</span><span class="s0">)),</span><span class="s2">t</span><span class="s0">}</span><span class="s1">const </span><span class="s2">D</span><span class="s0">=</span><span class="s2">e</span><span class="s0">=&gt;</span><span class="s2">c</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">const </span><span class="s2">I</span><span class="s0">=[</span><span class="s3">&quot;get&quot;</span><span class="s0">,</span><span class="s3">&quot;getKey&quot;</span><span class="s0">,</span><span class="s3">&quot;getAll&quot;</span><span class="s0">,</span><span class="s3">&quot;getAllKeys&quot;</span><span class="s0">,</span><span class="s3">&quot;count&quot;</span><span class="s0">],</span><span class="s2">b</span><span class="s0">=[</span><span class="s3">&quot;put&quot;</span><span class="s0">,</span><span class="s3">&quot;add&quot;</span><span class="s0">,</span><span class="s3">&quot;delete&quot;</span><span class="s0">,</span><span class="s3">&quot;clear&quot;</span><span class="s0">],</span><span class="s2">y</span><span class="s0">=</span><span class="s1">new </span><span class="s2">Map</span><span class="s0">;</span><span class="s1">function </span><span class="s2">B</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(!(</span><span class="s2">e </span><span class="s1">instanceof </span><span class="s2">IDBDatabase</span><span class="s0">)||</span><span class="s2">t </span><span class="s1">in </span><span class="s2">e</span><span class="s0">||</span><span class="s3">&quot;string&quot;</span><span class="s0">!=</span><span class="s1">typeof </span><span class="s2">t</span><span class="s0">)</span><span class="s1">return</span><span class="s0">;</span><span class="s1">if</span><span class="s0">(</span><span class="s2">y</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">t</span><span class="s0">))</span><span class="s1">return </span><span class="s2">y</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">t</span><span class="s0">);</span><span class="s1">const </span><span class="s2">n</span><span class="s0">=</span><span class="s2">t</span><span class="s0">.</span><span class="s2">replace</span><span class="s0">(</span><span class="s5">/FromIndex$/</span><span class="s0">,</span><span class="s3">&quot;&quot;</span><span class="s0">),</span><span class="s2">r</span><span class="s0">=</span><span class="s2">t</span><span class="s0">!==</span><span class="s2">n</span><span class="s0">,</span><span class="s2">o</span><span class="s0">=</span><span class="s2">b</span><span class="s0">.</span><span class="s2">includes</span><span class="s0">(</span><span class="s2">n</span><span class="s0">);</span><span class="s1">if</span><span class="s0">(!(</span><span class="s2">n </span><span class="s1">in</span><span class="s0">(</span><span class="s2">r</span><span class="s0">?</span><span class="s2">IDBIndex</span><span class="s0">:</span><span class="s2">IDBObjectStore</span><span class="s0">).</span><span class="s2">prototype</span><span class="s0">)||!</span><span class="s2">o</span><span class="s0">&amp;&amp;!</span><span class="s2">I</span><span class="s0">.</span><span class="s2">includes</span><span class="s0">(</span><span class="s2">n</span><span class="s0">))</span><span class="s1">return</span><span class="s0">;</span><span class="s1">const </span><span class="s2">s</span><span class="s0">=</span><span class="s2">async </span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">...t</span><span class="s0">){</span><span class="s1">const </span><span class="s2">s</span><span class="s0">=</span><span class="s1">this</span><span class="s0">.</span><span class="s2">transaction</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">o</span><span class="s0">?</span><span class="s3">&quot;readwrite&quot;</span><span class="s0">:</span><span class="s3">&quot;readonly&quot;</span><span class="s0">);</span><span class="s1">let </span><span class="s2">i</span><span class="s0">=</span><span class="s2">s</span><span class="s0">.</span><span class="s2">store</span><span class="s0">;</span><span class="s1">return </span><span class="s2">r</span><span class="s0">&amp;&amp;(</span><span class="s2">i</span><span class="s0">=</span><span class="s2">i</span><span class="s0">.</span><span class="s2">index</span><span class="s0">(</span><span class="s2">t</span><span class="s0">.</span><span class="s2">shift</span><span class="s0">())),(</span><span class="s1">await </span><span class="s2">Promise</span><span class="s0">.</span><span class="s2">all</span><span class="s0">([</span><span class="s2">i</span><span class="s0">[</span><span class="s2">n</span><span class="s0">](</span><span class="s2">...t</span><span class="s0">),</span><span class="s2">o</span><span class="s0">&amp;&amp;</span><span class="s2">s</span><span class="s0">.</span><span class="s2">done</span><span class="s0">]))[</span><span class="s4">0</span><span class="s0">]};</span><span class="s1">return </span><span class="s2">y</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">s</span><span class="s0">),</span><span class="s2">s</span><span class="s0">}</span><span class="s2">d</span><span class="s0">((</span><span class="s2">e</span><span class="s0">=&gt;({</span><span class="s2">...e</span><span class="s0">,</span><span class="s2">get</span><span class="s0">:(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">,</span><span class="s2">r</span><span class="s0">)=&gt;</span><span class="s2">B</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)||</span><span class="s2">e</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">,</span><span class="s2">r</span><span class="s0">),</span><span class="s2">has</span><span class="s0">:(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)=&gt;!!</span><span class="s2">B</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)||</span><span class="s2">e</span><span class="s0">.</span><span class="s2">has</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)})));</span><span class="s1">const </span><span class="s2">g</span><span class="s0">=[</span><span class="s3">&quot;continue&quot;</span><span class="s0">,</span><span class="s3">&quot;continuePrimaryKey&quot;</span><span class="s0">,</span><span class="s3">&quot;advance&quot;</span><span class="s0">],</span><span class="s2">h</span><span class="s0">={},</span><span class="s2">v</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">m</span><span class="s0">=</span><span class="s1">new </span><span class="s2">WeakMap</span><span class="s0">,</span><span class="s2">w</span><span class="s0">={</span><span class="s2">get</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">){</span><span class="s1">if</span><span class="s0">(!</span><span class="s2">g</span><span class="s0">.</span><span class="s2">includes</span><span class="s0">(</span><span class="s2">t</span><span class="s0">))</span><span class="s1">return </span><span class="s2">e</span><span class="s0">[</span><span class="s2">t</span><span class="s0">];</span><span class="s1">let </span><span class="s2">n</span><span class="s0">=</span><span class="s2">h</span><span class="s0">[</span><span class="s2">t</span><span class="s0">];</span><span class="s1">return </span><span class="s2">n</span><span class="s0">||(</span><span class="s2">n</span><span class="s0">=</span><span class="s2">h</span><span class="s0">[</span><span class="s2">t</span><span class="s0">]=</span><span class="s1">function</span><span class="s0">(</span><span class="s2">...e</span><span class="s0">){</span><span class="s2">v</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s1">this</span><span class="s0">,</span><span class="s2">m</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s1">this</span><span class="s0">)[</span><span class="s2">t</span><span class="s0">](</span><span class="s2">...e</span><span class="s0">))}),</span><span class="s2">n</span><span class="s0">}};</span><span class="s2">async </span><span class="s1">function</span><span class="s0">*</span><span class="s2">E</span><span class="s0">(</span><span class="s2">...e</span><span class="s0">){</span><span class="s1">let </span><span class="s2">t</span><span class="s0">=</span><span class="s1">this</span><span class="s0">;</span><span class="s1">if</span><span class="s0">(</span><span class="s2">t </span><span class="s1">instanceof </span><span class="s2">IDBCursor</span><span class="s0">||(</span><span class="s2">t</span><span class="s0">=</span><span class="s1">await </span><span class="s2">t</span><span class="s0">.</span><span class="s2">openCursor</span><span class="s0">(</span><span class="s2">...e</span><span class="s0">)),!</span><span class="s2">t</span><span class="s0">)</span><span class="s1">return</span><span class="s0">;</span><span class="s1">const </span><span class="s2">n</span><span class="s0">=</span><span class="s1">new </span><span class="s2">Proxy</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">w</span><span class="s0">);</span><span class="s1">for</span><span class="s0">(</span><span class="s2">m</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">n</span><span class="s0">,</span><span class="s2">t</span><span class="s0">),</span><span class="s2">c</span><span class="s0">.</span><span class="s2">set</span><span class="s0">(</span><span class="s2">n</span><span class="s0">,</span><span class="s2">D</span><span class="s0">(</span><span class="s2">t</span><span class="s0">));</span><span class="s2">t</span><span class="s0">;)</span><span class="s1">yield </span><span class="s2">n</span><span class="s0">,</span><span class="s2">t</span><span class="s0">=</span><span class="s1">await</span><span class="s0">(</span><span class="s2">v</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">n</span><span class="s0">)||</span><span class="s2">t</span><span class="s0">.</span><span class="s2">continue</span><span class="s0">()),</span><span class="s2">v</span><span class="s0">.</span><span class="s2">delete</span><span class="s0">(</span><span class="s2">n</span><span class="s0">)}</span><span class="s1">function </span><span class="s2">L</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">n</span><span class="s0">){</span><span class="s1">return </span><span class="s2">n</span><span class="s0">===</span><span class="s2">Symbol</span><span class="s0">.</span><span class="s2">asyncIterator</span><span class="s0">&amp;&amp;</span><span class="s2">t</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,[</span><span class="s2">IDBIndex</span><span class="s0">,</span><span class="s2">IDBObjectStore</span><span class="s0">,</span><span class="s2">IDBCursor</span><span class="s0">])||</span><span class="s3">&quot;iterate&quot;</span><span class="s0">===</span><span class="s2">n</span><span class="s0">&amp;&amp;</span><span class="s2">t</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,[</span><span class="s2">IDBIndex</span><span class="s0">,</span><span class="s2">IDBObjectStore</span><span class="s0">])}</span><span class="s2">d</span><span class="s0">((</span><span class="s2">e</span><span class="s0">=&gt;({</span><span class="s2">...e</span><span class="s0">,</span><span class="s2">get</span><span class="s0">:(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">,</span><span class="s2">r</span><span class="s0">)=&gt;</span><span class="s2">L</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)?</span><span class="s2">E</span><span class="s0">:</span><span class="s2">e</span><span class="s0">.</span><span class="s2">get</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">,</span><span class="s2">r</span><span class="s0">),</span><span class="s2">has</span><span class="s0">:(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)=&gt;</span><span class="s2">L</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)||</span><span class="s2">e</span><span class="s0">.</span><span class="s2">has</span><span class="s0">(</span><span class="s2">t</span><span class="s0">,</span><span class="s2">n</span><span class="s0">)}))),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">deleteDB</span><span class="s0">=</span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,{</span><span class="s2">blocked</span><span class="s0">:</span><span class="s2">t</span><span class="s0">}={}){</span><span class="s1">const </span><span class="s2">n</span><span class="s0">=</span><span class="s2">indexedDB</span><span class="s0">.</span><span class="s2">deleteDatabase</span><span class="s0">(</span><span class="s2">e</span><span class="s0">);</span><span class="s1">return </span><span class="s2">t</span><span class="s0">&amp;&amp;</span><span class="s2">n</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;blocked&quot;</span><span class="s0">,(</span><span class="s2">e</span><span class="s0">=&gt;</span><span class="s2">t</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">oldVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">))),</span><span class="s2">p</span><span class="s0">(</span><span class="s2">n</span><span class="s0">).</span><span class="s2">then</span><span class="s0">((()=&gt;{}))},</span><span class="s2">e</span><span class="s0">.</span><span class="s2">openDB</span><span class="s0">=</span><span class="s1">function</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">,{</span><span class="s2">blocked</span><span class="s0">:</span><span class="s2">n</span><span class="s0">,</span><span class="s2">upgrade</span><span class="s0">:</span><span class="s2">r</span><span class="s0">,</span><span class="s2">blocking</span><span class="s0">:</span><span class="s2">o</span><span class="s0">,</span><span class="s2">terminated</span><span class="s0">:</span><span class="s2">s</span><span class="s0">}={}){</span><span class="s1">const </span><span class="s2">i</span><span class="s0">=</span><span class="s2">indexedDB</span><span class="s0">.</span><span class="s2">open</span><span class="s0">(</span><span class="s2">e</span><span class="s0">,</span><span class="s2">t</span><span class="s0">),</span><span class="s2">a</span><span class="s0">=</span><span class="s2">p</span><span class="s0">(</span><span class="s2">i</span><span class="s0">);</span><span class="s1">return </span><span class="s2">r</span><span class="s0">&amp;&amp;</span><span class="s2">i</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;upgradeneeded&quot;</span><span class="s0">,(</span><span class="s2">e</span><span class="s0">=&gt;{</span><span class="s2">r</span><span class="s0">(</span><span class="s2">p</span><span class="s0">(</span><span class="s2">i</span><span class="s0">.</span><span class="s2">result</span><span class="s0">),</span><span class="s2">e</span><span class="s0">.</span><span class="s2">oldVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">.</span><span class="s2">newVersion</span><span class="s0">,</span><span class="s2">p</span><span class="s0">(</span><span class="s2">i</span><span class="s0">.</span><span class="s2">transaction</span><span class="s0">),</span><span class="s2">e</span><span class="s0">)})),</span><span class="s2">n</span><span class="s0">&amp;&amp;</span><span class="s2">i</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;blocked&quot;</span><span class="s0">,(</span><span class="s2">e</span><span class="s0">=&gt;</span><span class="s2">n</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">oldVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">.</span><span class="s2">newVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">))),</span><span class="s2">a</span><span class="s0">.</span><span class="s2">then</span><span class="s0">((</span><span class="s2">e</span><span class="s0">=&gt;{</span><span class="s2">s</span><span class="s0">&amp;&amp;</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;close&quot;</span><span class="s0">,(()=&gt;</span><span class="s2">s</span><span class="s0">())),</span><span class="s2">o</span><span class="s0">&amp;&amp;</span><span class="s2">e</span><span class="s0">.</span><span class="s2">addEventListener</span><span class="s0">(</span><span class="s3">&quot;versionchange&quot;</span><span class="s0">,(</span><span class="s2">e</span><span class="s0">=&gt;</span><span class="s2">o</span><span class="s0">(</span><span class="s2">e</span><span class="s0">.</span><span class="s2">oldVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">.</span><span class="s2">newVersion</span><span class="s0">,</span><span class="s2">e</span><span class="s0">)))})).</span><span class="s2">catch</span><span class="s0">((()=&gt;{})),</span><span class="s2">a</span><span class="s0">},</span><span class="s2">e</span><span class="s0">.</span><span class="s2">unwrap</span><span class="s0">=</span><span class="s2">D</span><span class="s0">,</span><span class="s2">e</span><span class="s0">.</span><span class="s2">wrap</span><span class="s0">=</span><span class="s2">p</span><span class="s0">}));</span>
</pre>
</body>
</html>