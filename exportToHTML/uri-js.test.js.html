<html>
<head>
<title>uri-js.test.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6aab73;}
.s1 { color: #bcbec4;}
.s2 { color: #cf8e6d;}
.s3 { color: #bcbec4;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #67a37c; font-style: italic;}
.s6 { color: #7a7e85;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
uri-js.test.js</font>
</center></td></tr></table>
<pre><span class="s0">'use strict'</span>

<span class="s2">const </span><span class="s1">test </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'tape'</span><span class="s3">)</span>
<span class="s2">const </span><span class="s1">URI </span><span class="s3">= </span><span class="s1">require</span><span class="s3">(</span><span class="s0">'../index'</span><span class="s3">)</span>

<span class="s4">/**</span>
 <span class="s4">* URI.js</span>
 <span class="s4">*</span>
 <span class="s4">* </span><span class="s5">@fileoverview </span><span class="s4">An RFC 3986 compliant, scheme extendable URI parsing/normalizing/resolving/serializing library for JavaScript.</span>
 <span class="s4">* </span><span class="s5">@author </span><span class="s4">&lt;a href=&quot;mailto:gary.court@gmail.com&quot;&gt;Gary Court&lt;/a&gt;</span>
 <span class="s4">* </span><span class="s5">@see </span><span class="s4">http://github.com/garycourt/uri-js</span>
 <span class="s4">*/</span>

<span class="s4">/**</span>
 <span class="s4">* Copyright 2011 Gary Court. All rights reserved.</span>
 <span class="s4">*</span>
 <span class="s4">* Redistribution and use in source and binary forms, with or without modification, are</span>
 <span class="s4">* permitted provided that the following conditions are met:</span>
 <span class="s4">*</span>
 <span class="s4">*    1. Redistributions of source code must retain the above copyright notice, this list of</span>
 <span class="s4">*       conditions and the following disclaimer.</span>
 <span class="s4">*</span>
 <span class="s4">*    2. Redistributions in binary form must reproduce the above copyright notice, this list</span>
 <span class="s4">*       of conditions and the following disclaimer in the documentation and/or other materials</span>
 <span class="s4">*       provided with the distribution.</span>
 <span class="s4">*</span>
 <span class="s4">* THIS SOFTWARE IS PROVIDED BY GARY COURT ``AS IS'' AND ANY EXPRESS OR IMPLIED</span>
 <span class="s4">* WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND</span>
 <span class="s4">* FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL GARY COURT OR</span>
 <span class="s4">* CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
 <span class="s4">* CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
 <span class="s4">* SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON</span>
 <span class="s4">* ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
 <span class="s4">* NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF</span>
 <span class="s4">* ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
 <span class="s4">*</span>
 <span class="s4">* The views and conclusions contained in the software and documentation are those of the</span>
 <span class="s4">* authors and should not be interpreted as representing official policies, either expressed</span>
 <span class="s4">* or implied, of Gary Court.</span>
 <span class="s4">*/</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'Acquire URI'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">ok</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'URI Parsing'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">let </span><span class="s1">components</span>

  <span class="s6">// scheme</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri:'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'uri'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// userinfo</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//@'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// host</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// port</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//:'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// path</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">''</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// query</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'?'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment with character tabulation</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#</span><span class="s2">\t</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'%09'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment with line feed</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#</span><span class="s2">\n</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'%0A'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment with line tabulation</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#</span><span class="s2">\v</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'%0B'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment with form feed</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#</span><span class="s2">\f</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'%0C'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// fragment with carriage return</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'#</span><span class="s2">\r</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'%0D'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// all</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://user:pass@example.com:123/one/two.three?q1=a1&amp;q2=a2#body'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'all errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'uri'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s0">'user:pass'</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s7">123</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">'/one/two.three'</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s0">'q1=a1&amp;q2=a2'</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv4address</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//10.10.10.10'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv4address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'10.10.10.10'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv6address</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[2001:db8::7]'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv4address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'2001:db8::7'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// mixed IPv4address &amp; IPv6address</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[::ffff:129.144.52.38]'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv4address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'::ffff:129.144.52.38'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// mixed IPv4address &amp; reg-name, example from terion-name (https://github.com/garycourt/uri-js/issues/4)</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://10.10.10.10.example.com/en/process'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'mixed errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'uri'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'10.10.10.10.example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">'/en/process'</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv6address, example from bkw (https://github.com/garycourt/uri-js/pull/16)</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[2606:2800:220:1:248:1893:25c8:1946]/test'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv6address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'2606:2800:220:1:248:1893:25c8:1946'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">'/test'</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv6address, example from RFC 5952</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[2001:db8::1]:80'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv6address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'2001:db8::1'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s7">80</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv6address with zone identifier, RFC 6874</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[fe80::a%25en1]'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv4address errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'fe80::a%en1'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s6">// IPv6address with an unescaped interface specifier, example from pekkanikander (https://github.com/garycourt/uri-js/pull/22)</span>
  <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'//[2001:db8::7%en0]'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'IPv6address interface errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'2001:db8::7%en0'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'URI Serialization'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">let </span><span class="s1">components </span><span class="s3">= {</span>
    <span class="s1">scheme</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">userinfo</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">host</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">port</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">path</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">query</span><span class="s3">: </span><span class="s1">undefined</span><span class="s3">,</span>
    <span class="s1">fragment</span><span class="s3">: </span><span class="s1">undefined</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">''</span><span class="s3">, </span><span class="s0">'Undefined Components'</span><span class="s3">)</span>

  <span class="s1">components </span><span class="s3">= {</span>
    <span class="s1">scheme</span><span class="s3">: </span><span class="s0">''</span><span class="s3">,</span>
    <span class="s1">userinfo</span><span class="s3">: </span><span class="s0">''</span><span class="s3">,</span>
    <span class="s1">host</span><span class="s3">: </span><span class="s0">''</span><span class="s3">,</span>
    <span class="s1">port</span><span class="s3">: </span><span class="s7">0</span><span class="s3">,</span>
    <span class="s1">path</span><span class="s3">: </span><span class="s0">''</span><span class="s3">,</span>
    <span class="s1">query</span><span class="s3">: </span><span class="s0">''</span><span class="s3">,</span>
    <span class="s1">fragment</span><span class="s3">: </span><span class="s0">''</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'//@:0?#'</span><span class="s3">, </span><span class="s0">'Empty Components'</span><span class="s3">)</span>

  <span class="s1">components </span><span class="s3">= {</span>
    <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'uri'</span><span class="s3">,</span>
    <span class="s1">userinfo</span><span class="s3">: </span><span class="s0">'foo:bar'</span><span class="s3">,</span>
    <span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">,</span>
    <span class="s1">port</span><span class="s3">: </span><span class="s7">1</span><span class="s3">,</span>
    <span class="s1">path</span><span class="s3">: </span><span class="s0">'path'</span><span class="s3">,</span>
    <span class="s1">query</span><span class="s3">: </span><span class="s0">'query'</span><span class="s3">,</span>
    <span class="s1">fragment</span><span class="s3">: </span><span class="s0">'fragment'</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'uri://foo:bar@example.com:1/path?query#fragment'</span><span class="s3">, </span><span class="s0">'All Components'</span><span class="s3">)</span>

  <span class="s1">components </span><span class="s3">= {</span>
    <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'uri'</span><span class="s3">,</span>
    <span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">,</span>
    <span class="s1">port</span><span class="s3">: </span><span class="s0">'9000'</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'uri://example.com:9000'</span><span class="s3">, </span><span class="s0">'String port'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">path</span><span class="s3">: </span><span class="s0">'//path' </span><span class="s3">}), </span><span class="s0">'/%2Fpath'</span><span class="s3">, </span><span class="s0">'Double slash path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">path</span><span class="s3">: </span><span class="s0">'foo:bar' </span><span class="s3">}), </span><span class="s0">'foo%3Abar'</span><span class="s3">, </span><span class="s0">'Colon path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">path</span><span class="s3">: </span><span class="s0">'?query' </span><span class="s3">}), </span><span class="s0">'%3Fquery'</span><span class="s3">, </span><span class="s0">'Query path'</span><span class="s3">)</span>

  <span class="s6">// mixed IPv4address &amp; reg-name, example from terion-name (https://github.com/garycourt/uri-js/issues/4)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'10.10.10.10.example.com' </span><span class="s3">}), </span><span class="s0">'//10.10.10.10.example.com'</span><span class="s3">, </span><span class="s0">'Mixed IPv4address &amp; reg-name'</span><span class="s3">)</span>

  <span class="s6">// IPv6address</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'2001:db8::7' </span><span class="s3">}), </span><span class="s0">'//[2001:db8::7]'</span><span class="s3">, </span><span class="s0">'IPv6 Host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'::ffff:129.144.52.38' </span><span class="s3">}), </span><span class="s0">'//[::ffff:129.144.52.38]'</span><span class="s3">, </span><span class="s0">'IPv6 Mixed Host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'2606:2800:220:1:248:1893:25c8:1946' </span><span class="s3">}), </span><span class="s0">'//[2606:2800:220:1:248:1893:25c8:1946]'</span><span class="s3">, </span><span class="s0">'IPv6 Full Host'</span><span class="s3">)</span>

  <span class="s6">// IPv6address with zone identifier, RFC 6874</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'fe80::a%en1' </span><span class="s3">}), </span><span class="s0">'//[fe80::a%25en1]'</span><span class="s3">, </span><span class="s0">'IPv6 Zone Unescaped Host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'fe80::a%25en1' </span><span class="s3">}), </span><span class="s0">'//[fe80::a%25en1]'</span><span class="s3">, </span><span class="s0">'IPv6 Zone Escaped Host'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'URI Resolving'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// normal examples from RFC 3986</span>
  <span class="s2">const </span><span class="s1">base </span><span class="s3">= </span><span class="s0">'uri://a/b/c/d;p?q'</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g:h'</span><span class="s3">), </span><span class="s0">'g:h'</span><span class="s3">, </span><span class="s0">'g:h'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g'</span><span class="s3">, </span><span class="s0">'g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'./g'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g'</span><span class="s3">, </span><span class="s0">'./g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g/'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g/'</span><span class="s3">, </span><span class="s0">'g/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'/g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'/g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'//g'</span><span class="s3">), </span><span class="s0">'uri://g'</span><span class="s3">, </span><span class="s0">'//g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'?y'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/d;p?y'</span><span class="s3">, </span><span class="s0">'?y'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g?y'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g?y'</span><span class="s3">, </span><span class="s0">'g?y'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'#s'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/d;p?q#s'</span><span class="s3">, </span><span class="s0">'#s'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g#s'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g#s'</span><span class="s3">, </span><span class="s0">'g#s'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g?y#s'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g?y#s'</span><span class="s3">, </span><span class="s0">'g?y#s'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">';x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/;x'</span><span class="s3">, </span><span class="s0">';x'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g;x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g;x'</span><span class="s3">, </span><span class="s0">'g;x'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g;x?y#s'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g;x?y#s'</span><span class="s3">, </span><span class="s0">'g;x?y#s'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">''</span><span class="s3">), </span><span class="s0">'uri://a/b/c/d;p?q'</span><span class="s3">, </span><span class="s0">''</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'.'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/'</span><span class="s3">, </span><span class="s0">'.'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'./'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/'</span><span class="s3">, </span><span class="s0">'./'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'..'</span><span class="s3">), </span><span class="s0">'uri://a/b/'</span><span class="s3">, </span><span class="s0">'..'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../'</span><span class="s3">), </span><span class="s0">'uri://a/b/'</span><span class="s3">, </span><span class="s0">'../'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../g'</span><span class="s3">), </span><span class="s0">'uri://a/b/g'</span><span class="s3">, </span><span class="s0">'../g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../..'</span><span class="s3">), </span><span class="s0">'uri://a/'</span><span class="s3">, </span><span class="s0">'../..'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../../'</span><span class="s3">), </span><span class="s0">'uri://a/'</span><span class="s3">, </span><span class="s0">'../../'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../../g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'../../g'</span><span class="s3">)</span>

  <span class="s6">// abnormal examples from RFC 3986</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../../../g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'../../../g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'../../../../g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'../../../../g'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'/./g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'/./g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'/../g'</span><span class="s3">), </span><span class="s0">'uri://a/g'</span><span class="s3">, </span><span class="s0">'/../g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g.'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g.'</span><span class="s3">, </span><span class="s0">'g.'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'.g'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/.g'</span><span class="s3">, </span><span class="s0">'.g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g..'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g..'</span><span class="s3">, </span><span class="s0">'g..'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'..g'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/..g'</span><span class="s3">, </span><span class="s0">'..g'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'./../g'</span><span class="s3">), </span><span class="s0">'uri://a/b/g'</span><span class="s3">, </span><span class="s0">'./../g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'./g/.'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g/'</span><span class="s3">, </span><span class="s0">'./g/.'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g/./h'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g/h'</span><span class="s3">, </span><span class="s0">'g/./h'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g/../h'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/h'</span><span class="s3">, </span><span class="s0">'g/../h'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g;x=1/./y'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g;x=1/y'</span><span class="s3">, </span><span class="s0">'g;x=1/./y'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g;x=1/../y'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/y'</span><span class="s3">, </span><span class="s0">'g;x=1/../y'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g?y/./x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g?y/./x'</span><span class="s3">, </span><span class="s0">'g?y/./x'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g?y/../x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g?y/../x'</span><span class="s3">, </span><span class="s0">'g?y/../x'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g#s/./x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g#s/./x'</span><span class="s3">, </span><span class="s0">'g#s/./x'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'g#s/../x'</span><span class="s3">), </span><span class="s0">'uri://a/b/c/g#s/../x'</span><span class="s3">, </span><span class="s0">'g#s/../x'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'uri:g'</span><span class="s3">), </span><span class="s0">'uri:g'</span><span class="s3">, </span><span class="s0">'uri:g'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s1">base</span><span class="s3">, </span><span class="s0">'uri:g'</span><span class="s3">, { </span><span class="s1">tolerant</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'uri://a/b/c/g'</span><span class="s3">, </span><span class="s0">'uri:g'</span><span class="s3">)</span>

  <span class="s6">// examples by PAEz</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">'//www.g.com/'</span><span class="s3">, </span><span class="s0">'/adf</span><span class="s2">\n</span><span class="s0">gf'</span><span class="s3">), </span><span class="s0">'//www.g.com/adf%0Agf'</span><span class="s3">, </span><span class="s0">'/adf</span><span class="s2">\\</span><span class="s0">ngf'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">'//www.g.com/error</span><span class="s2">\n</span><span class="s0">/bleh/bleh'</span><span class="s3">, </span><span class="s0">'..'</span><span class="s3">), </span><span class="s0">'//www.g.com/error%0A/'</span><span class="s3">, </span><span class="s0">'//www.g.com/error</span><span class="s2">\\</span><span class="s0">n/bleh/bleh'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'URI Normalizing'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// test from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'uri://www.example.org/red%09ros</span><span class="s2">\xE9</span><span class="s0">#red'</span><span class="s3">), </span><span class="s0">'uri://www.example.org/red%09ros%C3%A9#red'</span><span class="s3">)</span>

  <span class="s6">// IPv4address</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//192.068.001.000'</span><span class="s3">), </span><span class="s0">'//192.68.1.0'</span><span class="s3">)</span>

  <span class="s6">// IPv6address, example from RFC 3513</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'http://[1080::8:800:200C:417A]/'</span><span class="s3">), </span><span class="s0">'http://[1080::8:800:200c:417a]/'</span><span class="s3">)</span>

  <span class="s6">// IPv6address, examples from RFC 5952</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:0db8::0001]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8::1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:db8::1:0000:1]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8::1:0:1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:db8:0:0:0:0:2:1]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8::2:1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:db8:0:1:1:1:1:1]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8:0:1:1:1:1:1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:0:0:1:0:0:0:1]/'</span><span class="s3">), </span><span class="s0">'//[2001:0:0:1::1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:db8:0:0:1:0:0:1]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8::1:0:0:1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[2001:DB8::1]/'</span><span class="s3">), </span><span class="s0">'//[2001:db8::1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[0:0:0:0:0:ffff:192.0.2.1]/'</span><span class="s3">), </span><span class="s0">'//[::ffff:192.0.2.1]/'</span><span class="s3">)</span>

  <span class="s6">// Mixed IPv4 and IPv6 address</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[1:2:3:4:5:6:192.0.2.1]/'</span><span class="s3">), </span><span class="s0">'//[1:2:3:4:5:6:192.0.2.1]/'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'//[1:2:3:4:5:6:192.068.001.000]/'</span><span class="s3">), </span><span class="s0">'//[1:2:3:4:5:6:192.68.1.0]/'</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'URI Equals'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// test from RFC 3986</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'example://a/b/c/%7Bfoo%7D'</span><span class="s3">, </span><span class="s0">'eXAMPLE://a/./b/../b/%63/%7bfoo%7d'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>

  <span class="s6">// test from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'http://example.org/~user'</span><span class="s3">, </span><span class="s0">'http://example.org/%7euser'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>

  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'Escape Component'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">let </span><span class="s1">chr</span>
  <span class="s2">for </span><span class="s3">(</span><span class="s2">let </span><span class="s1">d </span><span class="s3">= </span><span class="s7">0</span><span class="s3">; </span><span class="s1">d </span><span class="s3">&lt;= </span><span class="s7">129</span><span class="s3">; ++</span><span class="s1">d</span><span class="s3">) {</span>
    <span class="s1">chr </span><span class="s3">= </span><span class="s1">String</span><span class="s3">.</span><span class="s1">fromCharCode</span><span class="s3">(</span><span class="s1">d</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s3">(!</span><span class="s1">chr</span><span class="s3">.</span><span class="s1">match</span><span class="s3">(</span><span class="s8">/[$&amp;+,;=]/</span><span class="s3">)) {</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s1">chr</span><span class="s3">), </span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s1">chr</span><span class="s3">))</span>
    <span class="s3">} </span><span class="s2">else </span><span class="s3">{</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s1">chr</span><span class="s3">), </span><span class="s1">chr</span><span class="s3">)</span>
    <span class="s3">}</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u00c0</span><span class="s0">'</span><span class="s3">), </span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u00c0</span><span class="s0">'</span><span class="s3">))</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u07ff</span><span class="s0">'</span><span class="s3">), </span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u07ff</span><span class="s0">'</span><span class="s3">))</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u0800</span><span class="s0">'</span><span class="s3">), </span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u0800</span><span class="s0">'</span><span class="s3">))</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">escapeComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u30a2</span><span class="s0">'</span><span class="s3">), </span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u30a2</span><span class="s0">'</span><span class="s3">))</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'Unescape Component'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">let </span><span class="s1">chr</span>
  <span class="s2">for </span><span class="s3">(</span><span class="s2">let </span><span class="s1">d </span><span class="s3">= </span><span class="s7">0</span><span class="s3">; </span><span class="s1">d </span><span class="s3">&lt;= </span><span class="s7">129</span><span class="s3">; ++</span><span class="s1">d</span><span class="s3">) {</span>
    <span class="s1">chr </span><span class="s3">= </span><span class="s1">String</span><span class="s3">.</span><span class="s1">fromCharCode</span><span class="s3">(</span><span class="s1">d</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">unescapeComponent</span><span class="s3">(</span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s1">chr</span><span class="s3">)), </span><span class="s1">chr</span><span class="s3">)</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">unescapeComponent</span><span class="s3">(</span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u00c0</span><span class="s0">'</span><span class="s3">)), </span><span class="s0">'</span><span class="s2">\u00c0</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">unescapeComponent</span><span class="s3">(</span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u07ff</span><span class="s0">'</span><span class="s3">)), </span><span class="s0">'</span><span class="s2">\u07ff</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">unescapeComponent</span><span class="s3">(</span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u0800</span><span class="s0">'</span><span class="s3">)), </span><span class="s0">'</span><span class="s2">\u0800</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">unescapeComponent</span><span class="s3">(</span><span class="s1">encodeURIComponent</span><span class="s3">(</span><span class="s0">'</span><span class="s2">\u30a2</span><span class="s0">'</span><span class="s3">)), </span><span class="s0">'</span><span class="s2">\u30a2</span><span class="s0">'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s2">const </span><span class="s1">IRI_OPTION </span><span class="s3">= { </span><span class="s1">iri</span><span class="s3">: </span><span class="s2">true</span><span class="s3">, </span><span class="s1">unicodeSupport</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'IRI Parsing'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">const </span><span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://us</span><span class="s2">\xA0</span><span class="s0">er:pa</span><span class="s2">\uD7FF</span><span class="s0">ss@example.com:123/o</span><span class="s2">\uF900</span><span class="s0">ne/t</span><span class="s2">\uFDCF</span><span class="s0">wo.t</span><span class="s2">\uFDF0</span><span class="s0">hree?q1=a1</span><span class="s2">\uF8FF\uE000</span><span class="s0">&amp;q2=a2#bo</span><span class="s2">\uFFEF</span><span class="s0">dy'</span><span class="s3">, </span><span class="s1">IRI_OPTION</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'all errors'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'uri'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s0">'us</span><span class="s2">\xA0</span><span class="s0">er:pa</span><span class="s2">\uD7FF</span><span class="s0">ss'</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s7">123</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s0">'/o</span><span class="s2">\uF900</span><span class="s0">ne/t</span><span class="s2">\uFDCF</span><span class="s0">wo.t</span><span class="s2">\uFDF0</span><span class="s0">hree'</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s0">'q1=a1</span><span class="s2">\uF8FF\uE000</span><span class="s0">&amp;q2=a2'</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s0">'bo</span><span class="s2">\uFFEF</span><span class="s0">dy'</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'IRI Serialization'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s2">const </span><span class="s1">components </span><span class="s3">= {</span>
    <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'uri'</span><span class="s3">,</span>
    <span class="s1">userinfo</span><span class="s3">: </span><span class="s0">'us</span><span class="s2">\xA0</span><span class="s0">er:pa</span><span class="s2">\uD7FF</span><span class="s0">ss'</span><span class="s3">,</span>
    <span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">,</span>
    <span class="s1">port</span><span class="s3">: </span><span class="s7">123</span><span class="s3">,</span>
    <span class="s1">path</span><span class="s3">: </span><span class="s0">'/o</span><span class="s2">\uF900</span><span class="s0">ne/t</span><span class="s2">\uFDCF</span><span class="s0">wo.t</span><span class="s2">\uFDF0</span><span class="s0">hree'</span><span class="s3">,</span>
    <span class="s1">query</span><span class="s3">: </span><span class="s0">'q1=a1</span><span class="s2">\uF8FF\uE000</span><span class="s0">&amp;q2=a2'</span><span class="s3">,</span>
    <span class="s1">fragment</span><span class="s3">: </span><span class="s0">'bo</span><span class="s2">\uFFEF</span><span class="s0">dy</span><span class="s2">\uE001</span><span class="s0">'</span>
  <span class="s3">}</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">, </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s0">'uri://us</span><span class="s2">\xA0</span><span class="s0">er:pa</span><span class="s2">\uD7FF</span><span class="s0">ss@example.com:123/o</span><span class="s2">\uF900</span><span class="s0">ne/t</span><span class="s2">\uFDCF</span><span class="s0">wo.t</span><span class="s2">\uFDF0</span><span class="s0">hree?q1=a1</span><span class="s2">\uF8FF\uE000</span><span class="s0">&amp;q2=a2#bo</span><span class="s2">\uFFEF</span><span class="s0">dy%EE%80%81'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'IRI Normalizing'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'uri://www.example.org/red%09ros</span><span class="s2">\xE9</span><span class="s0">#red'</span><span class="s3">, </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s0">'uri://www.example.org/red%09ros</span><span class="s2">\xE9</span><span class="s0">#red'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'IRI Equals'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// example from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'example://a/b/c/%7Bfoo%7D/ros</span><span class="s2">\xE9</span><span class="s0">'</span><span class="s3">, </span><span class="s0">'eXAMPLE://a/./b/../b/%63/%7bfoo%7d/ros%C3%A9'</span><span class="s3">, </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'Convert IRI to URI'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// example from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://www.example.org/red%09ros</span><span class="s2">\xE9</span><span class="s0">#red'</span><span class="s3">, </span><span class="s1">IRI_OPTION</span><span class="s3">)), </span><span class="s0">'uri://www.example.org/red%09ros%C3%A9#red'</span><span class="s3">)</span>

  <span class="s6">// Internationalized Domain Name conversion via punycode example from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://r</span><span class="s2">\xE9</span><span class="s0">sum</span><span class="s2">\xE9</span><span class="s0">.example.org'</span><span class="s3">, { </span><span class="s1">iri</span><span class="s3">: </span><span class="s2">true</span><span class="s3">, </span><span class="s1">domainHost</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), { </span><span class="s1">domainHost</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'uri://xn--rsum-bpad.example.org'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s1">test</span><span class="s3">(</span><span class="s0">'Convert URI to IRI'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
  <span class="s6">// examples from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://www.example.org/D%C3%BCrst'</span><span class="s3">), </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s0">'uri://www.example.org/D</span><span class="s2">\xFC</span><span class="s0">rst'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://www.example.org/D%FCrst'</span><span class="s3">), </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s0">'uri://www.example.org/D%FCrst'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://xn--99zt52a.example.org/%e2%80%ae'</span><span class="s3">), </span><span class="s1">IRI_OPTION</span><span class="s3">), </span><span class="s0">'uri://xn--99zt52a.example.org/%E2%80%AE'</span><span class="s3">) </span><span class="s6">// or uri://\u7D0D\u8C46.example.org/%E2%80%AE</span>

  <span class="s6">// Internationalized Domain Name conversion via punycode example from RFC 3987</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'uri://xn--rsum-bpad.example.org'</span><span class="s3">, { </span><span class="s1">domainHost</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), { </span><span class="s1">iri</span><span class="s3">: </span><span class="s2">true</span><span class="s3">, </span><span class="s1">domainHost</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'uri://r</span><span class="s2">\xE9</span><span class="s0">sum</span><span class="s2">\xE9</span><span class="s0">.example.org'</span><span class="s3">)</span>
  <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
<span class="s3">})</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">http</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'HTTP Equals'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// test from RFC 2616</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'http://abc.com:80/~smith/home.html'</span><span class="s3">, </span><span class="s0">'http://abc.com/~smith/home.html'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'http://ABC.com/%7Esmith/home.html'</span><span class="s3">, </span><span class="s0">'http://abc.com/~smith/home.html'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'http://ABC.com:/%7esmith/home.html'</span><span class="s3">, </span><span class="s0">'http://abc.com/~smith/home.html'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'HTTP://ABC.COM'</span><span class="s3">, </span><span class="s0">'http://abc.com/'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s6">// test from RFC 3986</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'http://example.com:/'</span><span class="s3">, </span><span class="s0">'http://example.com:80/'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">https</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'HTTPS Equals'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'https://example.com'</span><span class="s3">, </span><span class="s0">'https://example.com:443/'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'https://example.com:/'</span><span class="s3">, </span><span class="s0">'https://example.com:443/'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">urn</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'URN Parsing'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// example from RFC 2141</span>
    <span class="s2">const </span><span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'urn:foo:a123,456'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'errors'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'urn'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nid</span><span class="s3">, </span><span class="s0">'foo'</span><span class="s3">, </span><span class="s0">'nid'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nss</span><span class="s3">, </span><span class="s0">'a123,456'</span><span class="s3">, </span><span class="s0">'nss'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'URN Serialization'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// example from RFC 2141</span>
    <span class="s2">const </span><span class="s1">components </span><span class="s3">= {</span>
      <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'urn'</span><span class="s3">,</span>
      <span class="s1">nid</span><span class="s3">: </span><span class="s0">'foo'</span><span class="s3">,</span>
      <span class="s1">nss</span><span class="s3">: </span><span class="s0">'a123,456'</span>
    <span class="s3">}</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'urn:foo:a123,456'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'URN Equals'</span><span class="s3">, { </span><span class="s1">skip</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// test from RFC 2141</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'urn:foo:a123,456'</span><span class="s3">, </span><span class="s0">'urn:foo:a123,456'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'urn:foo:a123,456'</span><span class="s3">, </span><span class="s0">'URN:foo:a123,456'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'urn:foo:a123,456'</span><span class="s3">, </span><span class="s0">'urn:FOO:a123,456'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'urn:foo:a123,456'</span><span class="s3">, </span><span class="s0">'urn:foo:A123,456'</span><span class="s3">), </span><span class="s2">false</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'urn:foo:a123%2C456'</span><span class="s3">, </span><span class="s0">'URN:FOO:a123%2c456'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'URN Resolving'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// example from epoberezkin</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">''</span><span class="s3">, </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">), </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">'#'</span><span class="s3">, </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">), </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">'urn:some:ip:prop'</span><span class="s3">, </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">), </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">resolve</span><span class="s3">(</span><span class="s0">'urn:some:other:prop'</span><span class="s3">, </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">), </span><span class="s0">'urn:some:ip:prop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'UUID Parsing'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// example from RFC 4122</span>
    <span class="s2">let </span><span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'errors'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'urn'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nid</span><span class="s3">, </span><span class="s0">'uuid'</span><span class="s3">, </span><span class="s0">'nid'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nss</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'nss'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">uuid</span><span class="s3">, </span><span class="s0">'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">, </span><span class="s0">'uuid'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'urn:uuid:notauuid-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">notEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'errors'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'UUID Serialization'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// example from RFC 4122</span>
    <span class="s2">let </span><span class="s1">components </span><span class="s3">= {</span>
      <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'urn'</span><span class="s3">,</span>
      <span class="s1">nid</span><span class="s3">: </span><span class="s0">'uuid'</span><span class="s3">,</span>
      <span class="s1">uuid</span><span class="s3">: </span><span class="s0">'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span>
    <span class="s3">}</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= {</span>
      <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'urn'</span><span class="s3">,</span>
      <span class="s1">nid</span><span class="s3">: </span><span class="s0">'uuid'</span><span class="s3">,</span>
      <span class="s1">uuid</span><span class="s3">: </span><span class="s0">'notauuid-7dec-11d0-a765-00a0c91e6bf6'</span>
    <span class="s3">}</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">), </span><span class="s0">'urn:uuid:notauuid-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'UUID Equals'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'URN:UUID:F81D4FAE-7DEC-11D0-A765-00A0C91E6BF6'</span><span class="s3">, </span><span class="s0">'urn:uuid:f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'URN NID Override'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s2">let </span><span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'urn:foo:f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">, { </span><span class="s1">nid</span><span class="s3">: </span><span class="s0">'uuid' </span><span class="s3">})</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'errors'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'urn'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nid</span><span class="s3">, </span><span class="s0">'foo'</span><span class="s3">, </span><span class="s0">'nid'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">nss</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'nss'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">uuid</span><span class="s3">, </span><span class="s0">'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">, </span><span class="s0">'uuid'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= {</span>
      <span class="s1">scheme</span><span class="s3">: </span><span class="s0">'urn'</span><span class="s3">,</span>
      <span class="s1">nid</span><span class="s3">: </span><span class="s0">'foo'</span><span class="s3">,</span>
      <span class="s1">uuid</span><span class="s3">: </span><span class="s0">'f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span>
    <span class="s3">}</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">(</span><span class="s1">components</span><span class="s3">, { </span><span class="s1">nid</span><span class="s3">: </span><span class="s0">'uuid' </span><span class="s3">}), </span><span class="s0">'urn:foo:f81d4fae-7dec-11d0-a765-00a0c91e6bf6'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">mailto</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'Mailto Parse'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s2">let </span><span class="s1">components</span>

    <span class="s6">// tests from RFC 6068</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:chris@example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'error'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'chris@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'headers'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:infobot@example.com?subject=current-issue'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'current-issue'</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:infobot@example.com?body=send%20current-issue'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'send current-issue'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:infobot@example.com?body=send%20current-issue%0D%0Asend%20index'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'send current-issue</span><span class="s2">\x0D\x0A</span><span class="s0">send index'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:list@example.org?In-Reply-To=%3C3469A91.D10AF4C@example.com%3E'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'list@example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">, { </span><span class="s0">'In-Reply-To'</span><span class="s3">: </span><span class="s0">'&lt;3469A91.D10AF4C@example.com&gt;' </span><span class="s3">}, </span><span class="s0">'headers'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:majordomo@example.com?body=subscribe%20bamboo-l'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'majordomo@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'subscribe bamboo-l'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:joe@example.com?cc=bob@example.com&amp;body=hello'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'joe@example.com'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'hello'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">, { </span><span class="s1">cc</span><span class="s3">: </span><span class="s0">'bob@example.com' </span><span class="s3">}, </span><span class="s0">'headers'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:joe@example.com?cc=bob@example.com?body=hello'</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">VALIDATE_SUPPORT</span><span class="s3">) </span><span class="s1">t</span><span class="s3">.</span><span class="s1">ok</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s0">'invalid header fields'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:gorby%25kremvax@example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'gorby%kremvax@example.com'</span><span class="s3">], </span><span class="s0">'to gorby%kremvax@example.com'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:unlikely%3Faddress@example.com?blat=foop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'unlikely?address@example.com'</span><span class="s3">], </span><span class="s0">'to unlikely?address@example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">headers</span><span class="s3">, { </span><span class="s1">blat</span><span class="s3">: </span><span class="s0">'foop' </span><span class="s3">}, </span><span class="s0">'headers'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:Mike%26family@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'Mike&amp;family@example.org'</span><span class="s3">], </span><span class="s0">'to Mike&amp;family@example.org'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:%22not%40me%22@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'&quot;not@me&quot;@example.org'</span><span class="s3">], </span><span class="s0">'to ' </span><span class="s3">+ </span><span class="s0">'&quot;not@me&quot;@example.org'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:%22oh%5C%5Cno%22@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'&quot;oh</span><span class="s2">\\\\</span><span class="s0">no&quot;@example.org'</span><span class="s3">], </span><span class="s0">'to ' </span><span class="s3">+ </span><span class="s0">'&quot;oh</span><span class="s2">\\\\</span><span class="s0">no&quot;@example.org'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">&quot;mailto:%22%5C%5C%5C%22it's%5C%20ugly%5C%5C%5C%22%22@example.org&quot;</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'&quot;</span><span class="s2">\\\\\\</span><span class="s0">&quot;it</span><span class="s2">\'</span><span class="s0">s</span><span class="s2">\\ </span><span class="s0">ugly</span><span class="s2">\\\\\\</span><span class="s0">&quot;&quot;@example.org'</span><span class="s3">], </span><span class="s0">'to ' </span><span class="s3">+ </span><span class="s0">'&quot;</span><span class="s2">\\\\\\</span><span class="s0">&quot;it</span><span class="s2">\'</span><span class="s0">s</span><span class="s2">\\ </span><span class="s0">ugly</span><span class="s2">\\\\\\</span><span class="s0">&quot;&quot;@example.org'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:user@example.org?subject=caf%C3%A9'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">'</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:user@example.org?subject=%3D%3Futf-8%3FQ%3Fcaf%3DC3%3DA9%3F%3D'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'=?utf-8?Q?caf=C3=A9?='</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">) </span><span class="s6">// TODO: Verify this</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:user@example.org?subject=%3D%3Fiso-8859-1%3FQ%3Fcaf%3DE9%3F%3D'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'=?iso-8859-1?Q?caf=E9?='</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">) </span><span class="s6">// TODO: Verify this</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:user@example.org?subject=caf%C3%A9&amp;body=caf%C3%A9'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">'</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>

    <span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">IRI_SUPPORT</span><span class="s3">) {</span>
      <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'mailto:user@%E7%B4%8D%E8%B1%86.example.org?subject=Test&amp;body=NATTO'</span><span class="s3">)</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">deepEqual</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">to</span><span class="s3">, [</span><span class="s0">'user@xn--99zt52a.example.org'</span><span class="s3">], </span><span class="s0">'to'</span><span class="s3">)</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">subject</span><span class="s3">, </span><span class="s0">'Test'</span><span class="s3">, </span><span class="s0">'subject'</span><span class="s3">)</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">body</span><span class="s3">, </span><span class="s0">'NATTO'</span><span class="s3">, </span><span class="s0">'body'</span><span class="s3">)</span>
    <span class="s3">}</span>

    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'Mailto Serialize'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// tests from RFC 6068</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'chris@example.com'</span><span class="s3">] }), </span><span class="s0">'mailto:chris@example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'current-issue' </span><span class="s3">}), </span><span class="s0">'mailto:infobot@example.com?body=current-issue'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'send current-issue' </span><span class="s3">}), </span><span class="s0">'mailto:infobot@example.com?body=send%20current-issue'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'infobot@example.com'</span><span class="s3">], </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'send current-issue</span><span class="s2">\x0D\x0A</span><span class="s0">send index' </span><span class="s3">}), </span><span class="s0">'mailto:infobot@example.com?body=send%20current-issue%0D%0Asend%20index'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'list@example.org'</span><span class="s3">], </span><span class="s1">headers</span><span class="s3">: { </span><span class="s0">'In-Reply-To'</span><span class="s3">: </span><span class="s0">'&lt;3469A91.D10AF4C@example.com&gt;' </span><span class="s3">} }), </span><span class="s0">'mailto:list@example.org?In-Reply-To=%3C3469A91.D10AF4C@example.com%3E'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'majordomo@example.com'</span><span class="s3">], </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'subscribe bamboo-l' </span><span class="s3">}), </span><span class="s0">'mailto:majordomo@example.com?body=subscribe%20bamboo-l'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'joe@example.com'</span><span class="s3">], </span><span class="s1">headers</span><span class="s3">: { </span><span class="s1">cc</span><span class="s3">: </span><span class="s0">'bob@example.com'</span><span class="s3">, </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'hello' </span><span class="s3">} }), </span><span class="s0">'mailto:joe@example.com?cc=bob@example.com&amp;body=hello'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'gorby%25kremvax@example.com'</span><span class="s3">] }), </span><span class="s0">'mailto:gorby%25kremvax@example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'unlikely%3Faddress@example.com'</span><span class="s3">], </span><span class="s1">headers</span><span class="s3">: { </span><span class="s1">blat</span><span class="s3">: </span><span class="s0">'foop' </span><span class="s3">} }), </span><span class="s0">'mailto:unlikely%3Faddress@example.com?blat=foop'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'Mike&amp;family@example.org'</span><span class="s3">] }), </span><span class="s0">'mailto:Mike%26family@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'&quot;not@me&quot;@example.org'</span><span class="s3">] }), </span><span class="s0">'mailto:%22not%40me%22@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'&quot;oh</span><span class="s2">\\\\</span><span class="s0">no&quot;@example.org'</span><span class="s3">] }), </span><span class="s0">'mailto:%22oh%5C%5Cno%22@example.org'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'&quot;</span><span class="s2">\\\\\\</span><span class="s0">&quot;it</span><span class="s2">\'</span><span class="s0">s</span><span class="s2">\\ </span><span class="s0">ugly</span><span class="s2">\\\\\\</span><span class="s0">&quot;&quot;@example.org'</span><span class="s3">] }), </span><span class="s0">&quot;mailto:%22%5C%5C%5C%22it's%5C%20ugly%5C%5C%5C%22%22@example.org&quot;</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s1">subject</span><span class="s3">: </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">' </span><span class="s3">}), </span><span class="s0">'mailto:user@example.org?subject=caf%C3%A9'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s1">subject</span><span class="s3">: </span><span class="s0">'=?utf-8?Q?caf=C3=A9?=' </span><span class="s3">}), </span><span class="s0">'mailto:user@example.org?subject=%3D%3Futf-8%3FQ%3Fcaf%3DC3%3DA9%3F%3D'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s1">subject</span><span class="s3">: </span><span class="s0">'=?iso-8859-1?Q?caf=E9?=' </span><span class="s3">}), </span><span class="s0">'mailto:user@example.org?subject=%3D%3Fiso-8859-1%3FQ%3Fcaf%3DE9%3F%3D'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'user@example.org'</span><span class="s3">], </span><span class="s1">subject</span><span class="s3">: </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">'</span><span class="s3">, </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'caf</span><span class="s2">\xE9</span><span class="s0">' </span><span class="s3">}), </span><span class="s0">'mailto:user@example.org?subject=caf%C3%A9&amp;body=caf%C3%A9'</span><span class="s3">)</span>
    <span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">IRI_SUPPORT</span><span class="s3">) {</span>
      <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'mailto'</span><span class="s3">, </span><span class="s1">to</span><span class="s3">: [</span><span class="s0">'us</span><span class="s2">\xE9</span><span class="s0">r@</span><span class="s2">\u7d0d\u8c46</span><span class="s0">.example.org'</span><span class="s3">], </span><span class="s1">subject</span><span class="s3">: </span><span class="s0">'Test'</span><span class="s3">, </span><span class="s1">body</span><span class="s3">: </span><span class="s0">'NATTO' </span><span class="s3">}), </span><span class="s0">'mailto:us%C3%A9r@xn--99zt52a.example.org?subject=Test&amp;body=NATTO'</span><span class="s3">)</span>
    <span class="s3">}</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'Mailto Equals'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s6">// tests from RFC 6068</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'mailto:addr1@an.example,addr2@an.example'</span><span class="s3">, </span><span class="s0">'mailto:?to=addr1@an.example,addr2@an.example'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'mailto:?to=addr1@an.example,addr2@an.example'</span><span class="s3">, </span><span class="s0">'mailto:addr1@an.example?to=addr2@an.example'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">ws</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WS Parse'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s2">let </span><span class="s1">components</span>

    <span class="s6">// example from RFC 6455, Sec 4.1</span>
    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'ws://example.com/chat'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'error'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/chat'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">secure</span><span class="s3">, </span><span class="s2">false</span><span class="s3">, </span><span class="s0">'secure'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'ws://example.com/foo?bar=baz'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'error'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/foo?bar=baz'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">secure</span><span class="s3">, </span><span class="s2">false</span><span class="s3">, </span><span class="s0">'secure'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'ws://example.com/?bar=baz'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/?bar=baz'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>

    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WS Serialize'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws' </span><span class="s3">}), </span><span class="s0">'ws:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com' </span><span class="s3">}), </span><span class="s0">'ws://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/' </span><span class="s3">}), </span><span class="s0">'ws:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo' </span><span class="s3">}), </span><span class="s0">'ws:/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar' </span><span class="s3">}), </span><span class="s0">'ws:/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo' </span><span class="s3">}), </span><span class="s0">'ws://example.com/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar' </span><span class="s3">}), </span><span class="s0">'ws://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'ws'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WS Equal'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'WS://ABC.COM:80/chat#one'</span><span class="s3">, </span><span class="s0">'ws://abc.com/chat'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WS Normalize'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'ws://example.com:80/foo#hash'</span><span class="s3">), </span><span class="s0">'ws://example.com/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>

<span class="s2">if </span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">SCHEMES</span><span class="s3">.</span><span class="s1">wss</span><span class="s3">) {</span>
  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WSS Parse'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s2">let </span><span class="s1">components</span>

    <span class="s6">// example from RFC 6455, Sec 4.1</span>
    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'wss://example.com/chat'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'error'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/chat'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">secure</span><span class="s3">, </span><span class="s2">true</span><span class="s3">, </span><span class="s0">'secure'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'wss://example.com/foo?bar=baz'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">error</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'error'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">scheme</span><span class="s3">, </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s0">'scheme'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">userinfo</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'userinfo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">host</span><span class="s3">, </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s0">'host'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">port</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'port'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">path</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'path'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">query</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'query'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">fragment</span><span class="s3">, </span><span class="s1">undefined</span><span class="s3">, </span><span class="s0">'fragment'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/foo?bar=baz'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">secure</span><span class="s3">, </span><span class="s2">true</span><span class="s3">, </span><span class="s0">'secure'</span><span class="s3">)</span>

    <span class="s1">components </span><span class="s3">= </span><span class="s1">URI</span><span class="s3">.</span><span class="s1">parse</span><span class="s3">(</span><span class="s0">'wss://example.com/?bar=baz'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">components</span><span class="s3">.</span><span class="s1">resourceName</span><span class="s3">, </span><span class="s0">'/?bar=baz'</span><span class="s3">, </span><span class="s0">'resourceName'</span><span class="s3">)</span>

    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WSS Serialize'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss' </span><span class="s3">}), </span><span class="s0">'wss:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com' </span><span class="s3">}), </span><span class="s0">'wss://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/' </span><span class="s3">}), </span><span class="s0">'wss:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo' </span><span class="s3">}), </span><span class="s0">'wss:/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar' </span><span class="s3">}), </span><span class="s0">'wss:/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss:'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo' </span><span class="s3">}), </span><span class="s0">'wss://example.com/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar' </span><span class="s3">}), </span><span class="s0">'wss://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss://example.com'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">false </span><span class="s3">}), </span><span class="s0">'ws://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">serialize</span><span class="s3">({ </span><span class="s1">scheme</span><span class="s3">: </span><span class="s0">'wss'</span><span class="s3">, </span><span class="s1">host</span><span class="s3">: </span><span class="s0">'example.com'</span><span class="s3">, </span><span class="s1">resourceName</span><span class="s3">: </span><span class="s0">'/foo?bar'</span><span class="s3">, </span><span class="s1">secure</span><span class="s3">: </span><span class="s2">true </span><span class="s3">}), </span><span class="s0">'wss://example.com/foo?bar'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WSS Equal'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s0">'WSS://ABC.COM:443/chat#one'</span><span class="s3">, </span><span class="s0">'wss://abc.com/chat'</span><span class="s3">), </span><span class="s2">true</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>

  <span class="s1">test</span><span class="s3">(</span><span class="s0">'WSS Normalize'</span><span class="s3">, (</span><span class="s1">t</span><span class="s3">) =&gt; {</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">equal</span><span class="s3">(</span><span class="s1">URI</span><span class="s3">.</span><span class="s1">normalize</span><span class="s3">(</span><span class="s0">'wss://example.com:443/foo#hash'</span><span class="s3">), </span><span class="s0">'wss://example.com/foo'</span><span class="s3">)</span>
    <span class="s1">t</span><span class="s3">.</span><span class="s1">end</span><span class="s3">()</span>
  <span class="s3">})</span>
<span class="s3">}</span>
</pre>
</body>
</html>