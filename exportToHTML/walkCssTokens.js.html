<html>
<head>
<title>walkCssTokens.js</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #7a7e85;}
.s1 { color: #bcbec4;}
.s2 { color: #6aab73;}
.s3 { color: #bcbec4;}
.s4 { color: #5f826b; font-style: italic;}
.s5 { color: #67a37c; font-style: italic;}
.s6 { color: #cf8e6d;}
.s7 { color: #2aacb8;}
.s8 { color: #42c3d4;}
</style>
</head>
<body bgcolor="#1e1f22">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
walkCssTokens.js</font>
</center></td></tr></table>
<pre><span class="s0">/* 
    MIT License http://www.opensource.org/licenses/mit-license.php 
    Author Tobias Koppers @sokra 
*/</span>

<span class="s2">&quot;use strict&quot;</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@typedef </span><span class="s4">{object} CssTokenCallbacks</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number, innerStart: number, innerEnd: number) =&gt; number)=} url</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} comment</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} string</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} leftParenthesis</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} rightParenthesis</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} function</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} colon</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} atKeyword</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} delim</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} identifier</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number, isId: boolean) =&gt; number)=} hash</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} leftCurlyBracket</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} rightCurlyBracket</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} semicolon</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{((input: string, start: number, end: number) =&gt; number)=} comma</span>
 <span class="s4">* </span><span class="s5">@property </span><span class="s4">{(() =&gt; boolean)=} needTerminate</span>
 <span class="s4">*/</span>

<span class="s4">/** </span><span class="s5">@typedef </span><span class="s4">{(input: string, pos: number, callbacks: CssTokenCallbacks) =&gt; number} CharHandler */</span>

<span class="s0">// spec: https://drafts.csswg.org/css-syntax/</span>

<span class="s6">const </span><span class="s1">CC_LINE_FEED </span><span class="s3">= </span><span class="s2">&quot;</span><span class="s6">\n</span><span class="s2">&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_CARRIAGE_RETURN </span><span class="s3">= </span><span class="s2">&quot;</span><span class="s6">\r</span><span class="s2">&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_FORM_FEED </span><span class="s3">= </span><span class="s2">&quot;</span><span class="s6">\f</span><span class="s2">&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_TAB </span><span class="s3">= </span><span class="s2">&quot;</span><span class="s6">\t</span><span class="s2">&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_SPACE </span><span class="s3">= </span><span class="s2">&quot; &quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_SOLIDUS </span><span class="s3">= </span><span class="s2">&quot;/&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_REVERSE_SOLIDUS </span><span class="s3">= </span><span class="s2">&quot;</span><span class="s6">\\</span><span class="s2">&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_ASTERISK </span><span class="s3">= </span><span class="s2">&quot;*&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_LEFT_PARENTHESIS </span><span class="s3">= </span><span class="s2">&quot;(&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_RIGHT_PARENTHESIS </span><span class="s3">= </span><span class="s2">&quot;)&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LEFT_CURLY </span><span class="s3">= </span><span class="s2">&quot;{&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_RIGHT_CURLY </span><span class="s3">= </span><span class="s2">&quot;}&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LEFT_SQUARE </span><span class="s3">= </span><span class="s2">&quot;[&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_RIGHT_SQUARE </span><span class="s3">= </span><span class="s2">&quot;]&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">= </span><span class="s2">'&quot;'</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_APOSTROPHE </span><span class="s3">= </span><span class="s2">&quot;'&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_FULL_STOP </span><span class="s3">= </span><span class="s2">&quot;.&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_COLON </span><span class="s3">= </span><span class="s2">&quot;:&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_SEMICOLON </span><span class="s3">= </span><span class="s2">&quot;;&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_COMMA </span><span class="s3">= </span><span class="s2">&quot;,&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_PERCENTAGE </span><span class="s3">= </span><span class="s2">&quot;%&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_AT_SIGN </span><span class="s3">= </span><span class="s2">&quot;@&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_LOW_LINE </span><span class="s3">= </span><span class="s2">&quot;_&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LOWER_A </span><span class="s3">= </span><span class="s2">&quot;a&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LOWER_F </span><span class="s3">= </span><span class="s2">&quot;f&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LOWER_E </span><span class="s3">= </span><span class="s2">&quot;e&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LOWER_U </span><span class="s3">= </span><span class="s2">&quot;u&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_LOWER_Z </span><span class="s3">= </span><span class="s2">&quot;z&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_UPPER_A </span><span class="s3">= </span><span class="s2">&quot;A&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_UPPER_F </span><span class="s3">= </span><span class="s2">&quot;F&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_UPPER_E </span><span class="s3">= </span><span class="s2">&quot;E&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_UPPER_U </span><span class="s3">= </span><span class="s2">&quot;E&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_UPPER_Z </span><span class="s3">= </span><span class="s2">&quot;Z&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_0 </span><span class="s3">= </span><span class="s2">&quot;0&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_9 </span><span class="s3">= </span><span class="s2">&quot;9&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_NUMBER_SIGN </span><span class="s3">= </span><span class="s2">&quot;#&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_PLUS_SIGN </span><span class="s3">= </span><span class="s2">&quot;+&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_HYPHEN_MINUS </span><span class="s3">= </span><span class="s2">&quot;-&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s6">const </span><span class="s1">CC_LESS_THAN_SIGN </span><span class="s3">= </span><span class="s2">&quot;&lt;&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>
<span class="s6">const </span><span class="s1">CC_GREATER_THAN_SIGN </span><span class="s3">= </span><span class="s2">&quot;&gt;&quot;</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s7">0</span><span class="s3">);</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeSpace </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">_callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Consume as much whitespace as possible.</span>
	<span class="s6">while </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s0">// Return a &lt;whitespace-token&gt;.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s0">// U+000A LINE FEED. Note that U+000D CARRIAGE RETURN and U+000C FORM FEED are not included in this definition,</span>
<span class="s0">// as they are converted to U+000A LINE FEED during preprocessing.</span>
<span class="s0">//</span>
<span class="s0">// Replace any U+000D CARRIAGE RETURN (CR) code points, U+000C FORM FEED (FF) code points, or pairs of U+000D CARRIAGE RETURN (CR) followed by U+000A LINE FEED (LF) in input by a single U+000A LINE FEED (LF) code point.</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if cc is a newline</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isNewline </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt;</span>
	<span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_LINE_FEED </span><span class="s3">|| </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_CARRIAGE_RETURN </span><span class="s3">|| </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_FORM_FEED</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">consumeExtraNewline </span><span class="s3">= (</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_CARRIAGE_RETURN </span><span class="s3">&amp;&amp; </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_LINE_FEED</span><span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if cc is a space (U+0009 CHARACTER TABULATION or U+0020 SPACE)</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isSpace </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt; </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_TAB </span><span class="s3">|| </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_SPACE</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if cc is a whitespace</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isWhiteSpace </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt; </span><span class="s1">_isNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) || </span><span class="s1">_isSpace</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">);</span>

<span class="s4">/**</span>
 <span class="s4">* ident-start code point</span>
 <span class="s4">*</span>
 <span class="s4">* A letter, a non-ASCII code point, or U+005F LOW LINE (_).</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if cc is a start code point of an identifier</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">isIdentStartCodePoint </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt;</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_LOWER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_LOWER_Z</span><span class="s3">) ||</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_UPPER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_UPPER_Z</span><span class="s3">) ||</span>
	<span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_LOW_LINE </span><span class="s3">||</span>
	<span class="s1">cc </span><span class="s3">&gt;= </span><span class="s7">0x80</span><span class="s3">;</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeDelimToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">_callbacks</span><span class="s3">) =&gt;</span>
	<span class="s0">// Return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s1">pos</span><span class="s3">;</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeComments </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume comments from a stream of code points. It returns nothing.</span>
	<span class="s0">// If the next two input code point are U+002F SOLIDUS (/) followed by a U+002A ASTERISK (*),</span>
	<span class="s0">// consume them and all following code points up to and including the first U+002A ASTERISK (*)</span>
	<span class="s0">// followed by a U+002F SOLIDUS (/), or up to an EOF code point.</span>
	<span class="s0">// Return to the start of this step.</span>
	<span class="s6">while </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_SOLIDUS </span><span class="s3">&amp;&amp;</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_ASTERISK</span>
	<span class="s3">) {</span>
		<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s1">pos </span><span class="s3">+= </span><span class="s7">2</span><span class="s3">;</span>

		<span class="s6">for </span><span class="s3">(;;) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
				<span class="s0">// If the preceding paragraph ended by consuming an EOF code point, this is a parse error.</span>
				<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">if </span><span class="s3">(</span>
				<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_ASTERISK </span><span class="s3">&amp;&amp;</span>
				<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_SOLIDUS</span>
			<span class="s3">) {</span>
				<span class="s1">pos </span><span class="s3">+= </span><span class="s7">2</span><span class="s3">;</span>

				<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">comment</span><span class="s3">) {</span>
					<span class="s1">pos </span><span class="s3">= </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">comment</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
				<span class="s3">}</span>

				<span class="s6">break</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if cc is a hex digit</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isHexDigit </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt;</span>
	<span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) ||</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_UPPER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_UPPER_F</span><span class="s3">) ||</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_LOWER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_LOWER_F</span><span class="s3">);</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_consumeAnEscapedCodePoint </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume an escaped code point.</span>
	<span class="s0">// It assumes that the U+005C REVERSE SOLIDUS (\) has already been consumed and that the next input code point has already been verified to be part of a valid escape.</span>
	<span class="s0">// It will return a code point.</span>

	<span class="s0">// Consume the next input code point.</span>
	<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s1">pos</span><span class="s3">++;</span>

	<span class="s0">// EOF</span>
	<span class="s0">// This is a parse error. Return U+FFFD REPLACEMENT CHARACTER (�).</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// hex digit</span>
	<span class="s0">// Consume as many hex digits as possible, but no more than 5.</span>
	<span class="s0">// Note that this means 1-6 hex digits have been consumed in total.</span>
	<span class="s0">// If the next input code point is whitespace, consume it as well.</span>
	<span class="s0">// Interpret the hex digits as a hexadecimal number.</span>
	<span class="s0">// If this number is zero, or is for a surrogate, or is greater than the maximum allowed code point, return U+FFFD REPLACEMENT CHARACTER (�).</span>
	<span class="s0">// Otherwise, return the code point with that value.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_isHexDigit</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
		<span class="s6">for </span><span class="s3">(</span><span class="s6">let </span><span class="s1">i </span><span class="s3">= </span><span class="s7">0</span><span class="s3">; </span><span class="s1">i </span><span class="s3">&lt; </span><span class="s7">5</span><span class="s3">; </span><span class="s1">i</span><span class="s3">++) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">_isHexDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
				<span class="s1">pos</span><span class="s3">++;</span>
			<span class="s3">}</span>
		<span class="s3">}</span>

		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
			<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeExtraNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>

		<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// anything else</span>
	<span class="s0">// Return the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeAStringToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume a string token from a stream of code points.</span>
	<span class="s0">// It returns either a &lt;string-token&gt; or &lt;bad-string-token&gt;.</span>
	<span class="s0">//</span>
	<span class="s0">// This algorithm may be called with an ending code point, which denotes the code point that ends the string.</span>
	<span class="s0">// If an ending code point is not specified, the current input code point is used.</span>
	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>
	<span class="s6">const </span><span class="s1">endingCodePoint </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>

	<span class="s0">// Initially create a &lt;string-token&gt; with its value set to the empty string.</span>

	<span class="s0">// Repeatedly consume the next input code point from the stream:</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s0">// EOF</span>
		<span class="s0">// This is a parse error. Return the &lt;string-token&gt;.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">string </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">string</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s0">// ending code point</span>
		<span class="s0">// Return the &lt;string-token&gt;.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">endingCodePoint</span><span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">string </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">string</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s0">// newline</span>
		<span class="s0">// This is a parse error.</span>
		<span class="s0">// Reconsume the current input code point, create a &lt;bad-string-token&gt;, and return it.</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">_isNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
			<span class="s1">pos</span><span class="s3">--;</span>
			<span class="s0">// bad string</span>
			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s0">// U+005C REVERSE SOLIDUS (\)</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_REVERSE_SOLIDUS</span><span class="s3">) {</span>
			<span class="s0">// If the next input code point is EOF, do nothing.</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s0">// Otherwise, if the next input code point is a newline, consume it.</span>
			<span class="s6">else if </span><span class="s3">(</span><span class="s1">_isNewline</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
				<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
				<span class="s1">pos</span><span class="s3">++;</span>
				<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeExtraNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s0">// Otherwise, (the stream starts with a valid escape) consume an escaped code point and append the returned code point to the &lt;string-token&gt;’s value.</span>
			<span class="s6">else if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
				<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnEscapedCodePoint</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s0">// anything else</span>
		<span class="s0">// Append the current input code point to the &lt;string-token&gt;’s value.</span>
		<span class="s6">else </span><span class="s3">{</span>
			<span class="s0">// Append</span>
		<span class="s3">}</span>
	<span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} q char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} is non-ASCII code point</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">isNonASCIICodePoint </span><span class="s3">= (</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) =&gt;</span>
	<span class="s0">// Simplify</span>
	<span class="s1">cc </span><span class="s3">&gt; </span><span class="s7">0x80</span><span class="s3">;</span>
<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} is letter</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">isLetter </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt;</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_LOWER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_LOWER_Z</span><span class="s3">) ||</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_UPPER_A </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_UPPER_Z</span><span class="s3">);</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} q char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} is identifier start code</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isIdentStartCodePoint </span><span class="s3">= (</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) =&gt;</span>
	<span class="s1">isLetter</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) || </span><span class="s1">isNonASCIICodePoint</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) || </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_LOW_LINE</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} q char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} is identifier code</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isIdentCodePoint </span><span class="s3">= (</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) =&gt;</span>
	<span class="s1">_isIdentStartCodePoint</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">q</span><span class="s3">) || </span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) || </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_HYPHEN_MINUS</span><span class="s3">;</span>
<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} is digit</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isDigit </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt; </span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s1">CC_0 </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s1">CC_9</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} f first code point</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} s second code point</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true if two code points are a valid escape</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_ifTwoCodePointsAreValidEscape </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">f</span><span class="s3">, </span><span class="s1">s</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to check if two code points are a valid escape.</span>
	<span class="s0">// The algorithm described here can be called explicitly with two code points, or can be called with the input stream itself.</span>
	<span class="s0">// In the latter case, the two code points in question are the current input code point and the next input code point, in that order.</span>

	<span class="s0">// Note: This algorithm will not consume any additional code point.</span>
	<span class="s6">const </span><span class="s1">first </span><span class="s3">= </span><span class="s1">f </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">second </span><span class="s3">= </span><span class="s1">s </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s0">// If the first code point is not U+005C REVERSE SOLIDUS (\), return false.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">!== </span><span class="s1">CC_REVERSE_SOLIDUS</span><span class="s3">) </span><span class="s6">return false</span><span class="s3">;</span>
	<span class="s0">// Otherwise, if the second code point is a newline, return false.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_isNewline</span><span class="s3">(</span><span class="s1">second</span><span class="s3">)) </span><span class="s6">return false</span><span class="s3">;</span>
	<span class="s0">// Otherwise, return true.</span>
	<span class="s6">return true</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} f first</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} s second</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} t third</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if input at pos starts an identifier</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">f</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">t</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to check if three code points would start an ident sequence.</span>
	<span class="s0">// The algorithm described here can be called explicitly with three code points, or can be called with the input stream itself.</span>
	<span class="s0">// In the latter case, the three code points in question are the current input code point and the next two input code points, in that order.</span>

	<span class="s0">// Note: This algorithm will not consume any additional code points.</span>

	<span class="s6">const </span><span class="s1">first </span><span class="s3">= </span><span class="s1">f </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">second </span><span class="s3">= </span><span class="s1">s </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">third </span><span class="s3">= </span><span class="s1">t </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">);</span>

	<span class="s0">// Look at the first code point:</span>

	<span class="s0">// U+002D HYPHEN-MINUS</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_HYPHEN_MINUS</span><span class="s3">) {</span>
		<span class="s0">// If the second code point is an ident-start code point or a U+002D HYPHEN-MINUS</span>
		<span class="s0">// or a U+002D HYPHEN-MINUS, or the second and third code points are a valid escape, return true.</span>
		<span class="s6">if </span><span class="s3">(</span>
			<span class="s1">_isIdentStartCodePoint</span><span class="s3">(</span><span class="s1">second</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) ||</span>
			<span class="s1">second </span><span class="s3">=== </span><span class="s1">CC_HYPHEN_MINUS </span><span class="s3">||</span>
			<span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">second</span><span class="s3">, </span><span class="s1">third</span><span class="s3">)</span>
		<span class="s3">) {</span>
			<span class="s6">return true</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s6">return false</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// ident-start code point</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">_isIdentStartCodePoint</span><span class="s3">(</span><span class="s1">first</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">)) {</span>
		<span class="s6">return true</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// U+005C REVERSE SOLIDUS (\)</span>
	<span class="s0">// If the first and second code points are a valid escape, return true. Otherwise, return false.</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_REVERSE_SOLIDUS</span><span class="s3">) {</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">first</span><span class="s3">, </span><span class="s1">second</span><span class="s3">)) {</span>
			<span class="s6">return true</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">return false</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// anything else</span>
	<span class="s0">// Return false.</span>
	<span class="s6">return false</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} f first</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} s second</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} t third</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, if input at pos starts an identifier</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_ifThreeCodePointsWouldStartANumber </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">f</span><span class="s3">, </span><span class="s1">s</span><span class="s3">, </span><span class="s1">t</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to check if three code points would start a number.</span>
	<span class="s0">// The algorithm described here can be called explicitly with three code points, or can be called with the input stream itself.</span>
	<span class="s0">// In the latter case, the three code points in question are the current input code point and the next two input code points, in that order.</span>

	<span class="s0">// Note: This algorithm will not consume any additional code points.</span>

	<span class="s6">const </span><span class="s1">first </span><span class="s3">= </span><span class="s1">f </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">second </span><span class="s3">= </span><span class="s1">s </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">third </span><span class="s3">= </span><span class="s1">t </span><span class="s3">|| </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s0">// Look at the first code point:</span>

	<span class="s0">// U+002B PLUS SIGN (+)</span>
	<span class="s0">// U+002D HYPHEN-MINUS (-)</span>
	<span class="s0">//</span>
	<span class="s0">// If the second code point is a digit, return true.</span>
	<span class="s0">// Otherwise, if the second code point is a U+002E FULL STOP (.) and the third code point is a digit, return true.</span>
	<span class="s0">// Otherwise, return false.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_PLUS_SIGN </span><span class="s3">|| </span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_HYPHEN_MINUS</span><span class="s3">) {</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">second</span><span class="s3">)) {</span>
			<span class="s6">return true</span><span class="s3">;</span>
		<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span><span class="s1">second </span><span class="s3">=== </span><span class="s1">CC_FULL_STOP </span><span class="s3">&amp;&amp; </span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">third</span><span class="s3">)) {</span>
			<span class="s6">return true</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">return false</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// U+002E FULL STOP (.)</span>
	<span class="s0">// If the second code point is a digit, return true. Otherwise, return false.</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_FULL_STOP</span><span class="s3">) {</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">second</span><span class="s3">)) {</span>
			<span class="s6">return true</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">return false</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// digit</span>
	<span class="s0">// Return true.</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">first</span><span class="s3">)) {</span>
		<span class="s6">return true</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// anything else</span>
	<span class="s0">// Return false.</span>
	<span class="s6">return false</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeNumberSign </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// If the next input code point is an ident code point or the next two input code points are a valid escape, then:</span>
	<span class="s0">// - Create a &lt;hash-token&gt;.</span>
	<span class="s0">// - If the next 3 input code points would start an ident sequence, set the &lt;hash-token&gt;’s type flag to &quot;id&quot;.</span>
	<span class="s0">// - Consume an ident sequence, and set the &lt;hash-token&gt;’s value to the returned string.</span>
	<span class="s0">// - Return the &lt;hash-token&gt;.</span>
	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>
	<span class="s6">const </span><span class="s1">first </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">second </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">);</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">_isIdentCodePoint</span><span class="s3">(</span><span class="s1">first</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">) ||</span>
		<span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">first</span><span class="s3">, </span><span class="s1">second</span><span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s6">const </span><span class="s1">third </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">);</span>
		<span class="s6">let </span><span class="s1">isId </span><span class="s3">= </span><span class="s6">false</span><span class="s3">;</span>

		<span class="s6">if </span><span class="s3">(</span>
			<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
				<span class="s1">input</span><span class="s3">,</span>
				<span class="s1">pos</span><span class="s3">,</span>
				<span class="s1">first</span><span class="s3">,</span>
				<span class="s1">second</span><span class="s3">,</span>
				<span class="s1">third</span>
			<span class="s3">)</span>
		<span class="s3">) {</span>
			<span class="s1">isId </span><span class="s3">= </span><span class="s6">true</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">hash </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">hash</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">isId</span><span class="s3">);</span>
		<span class="s3">}</span>

		<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeHyphenMinus </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// If the input stream starts with a number, reconsume the current input code point, consume a numeric token, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifThreeCodePointsWouldStartANumber</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
		<span class="s1">pos</span><span class="s3">--;</span>
		<span class="s6">return </span><span class="s1">consumeANumericToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s0">// Otherwise, if the next 2 input code points are U+002D HYPHEN-MINUS U+003E GREATER-THAN SIGN (-&gt;), consume them and return a &lt;CDC-token&gt;.</span>
	<span class="s6">else if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_HYPHEN_MINUS </span><span class="s3">&amp;&amp;</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_GREATER_THAN_SIGN</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">;</span>
	<span class="s3">}</span>
	<span class="s0">// Otherwise, if the input stream starts with an ident sequence, reconsume the current input code point, consume an ident-like token, and return it.</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
		<span class="s1">pos</span><span class="s3">--;</span>
		<span class="s6">return </span><span class="s1">consumeAnIdentLikeToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeFullStop </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>

	<span class="s0">// If the input stream starts with a number, reconsume the current input code point, consume a numeric token, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifThreeCodePointsWouldStartANumber</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
		<span class="s1">pos</span><span class="s3">--;</span>
		<span class="s6">return </span><span class="s1">consumeANumericToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">delim </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">delim</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumePlusSign </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// If the input stream starts with a number, reconsume the current input code point, consume a numeric token, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifThreeCodePointsWouldStartANumber</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
		<span class="s1">pos</span><span class="s3">--;</span>
		<span class="s6">return </span><span class="s1">consumeANumericToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">_consumeANumber </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume a number from a stream of code points.</span>
	<span class="s0">// It returns a numeric value, and a type which is either &quot;integer&quot; or &quot;number&quot;.</span>

	<span class="s0">// Execute the following steps in order:</span>
	<span class="s0">// Initially set type to &quot;integer&quot;. Let repr be the empty string.</span>

	<span class="s0">// If the next input code point is U+002B PLUS SIGN (+) or U+002D HYPHEN-MINUS (-), consume it and append it to repr.</span>
	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_HYPHEN_MINUS </span><span class="s3">||</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_PLUS_SIGN</span>
	<span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s0">// While the next input code point is a digit, consume it and append it to repr.</span>
	<span class="s6">while </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s0">// If the next 2 input code points are U+002E FULL STOP (.) followed by a digit, then:</span>
	<span class="s0">// 1. Consume the next input code point and append it to number part.</span>
	<span class="s0">// 2. While the next input code point is a digit, consume it and append it to number part.</span>
	<span class="s0">// 3. Set type to &quot;number&quot;.</span>
	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_FULL_STOP </span><span class="s3">&amp;&amp;</span>
		<span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">))</span>
	<span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s6">while </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s0">// If the next 2 or 3 input code points are U+0045 LATIN CAPITAL LETTER E (E) or U+0065 LATIN SMALL LETTER E (e), optionally followed by U+002D HYPHEN-MINUS (-) or U+002B PLUS SIGN (+), followed by a digit, then:</span>
	<span class="s0">// 1. Consume the next input code point.</span>
	<span class="s0">// 2. If the next input code point is &quot;+&quot; or &quot;-&quot;, consume it and append it to exponent part.</span>
	<span class="s0">// 3. While the next input code point is a digit, consume it and append it to exponent part.</span>
	<span class="s0">// 4. Set type to &quot;number&quot;.</span>
	<span class="s6">if </span><span class="s3">(</span>
		<span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_LOWER_E </span><span class="s3">||</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_UPPER_E</span><span class="s3">) &amp;&amp;</span>
		<span class="s3">(((</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_HYPHEN_MINUS </span><span class="s3">||</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_PLUS_SIGN</span><span class="s3">) &amp;&amp;</span>
			<span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">))) ||</span>
			<span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">)))</span>
	<span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s6">if </span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_PLUS_SIGN </span><span class="s3">||</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_HYPHEN_MINUS</span>
		<span class="s3">) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>

		<span class="s6">while </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s0">// Let value be the result of interpreting number part as a base-10 number.</span>

	<span class="s0">// If exponent part is non-empty, interpret it as a base-10 integer, then raise 10 to the power of the result, multiply it by value, and set value to that result.</span>

	<span class="s0">// Return value and type.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeANumericToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume a numeric token from a stream of code points.</span>
	<span class="s0">// It returns either a &lt;number-token&gt;, &lt;percentage-token&gt;, or &lt;dimension-token&gt;.</span>

	<span class="s0">// Consume a number and let number be the result.</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeANumber</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

	<span class="s0">// If the next 3 input code points would start an ident sequence, then:</span>
	<span class="s0">//</span>
	<span class="s0">// - Create a &lt;dimension-token&gt; with the same value and type flag as number, and a unit set initially to the empty string.</span>
	<span class="s0">// - Consume an ident sequence. Set the &lt;dimension-token&gt;’s unit to the returned value.</span>
	<span class="s0">// - Return the &lt;dimension-token&gt;.</span>

	<span class="s6">const </span><span class="s1">first </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">second </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">);</span>
	<span class="s6">const </span><span class="s1">third </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">);</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">,</span>
			<span class="s1">pos</span><span class="s3">,</span>
			<span class="s1">first</span><span class="s3">,</span>
			<span class="s1">second</span><span class="s3">,</span>
			<span class="s1">third</span>
		<span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s0">// Otherwise, if the next input code point is U+0025 PERCENTAGE SIGN (%), consume it.</span>
	<span class="s0">// Create a &lt;percentage-token&gt; with the same value as number, and return it.</span>
	<span class="s6">else if </span><span class="s3">(</span><span class="s1">first </span><span class="s3">=== </span><span class="s1">CC_PERCENTAGE</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, create a &lt;number-token&gt; with the same value and type flag as number, and return it.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeColon </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;colon-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">colon </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">colon</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeLeftParenthesis </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;(-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">leftParenthesis </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">leftParenthesis</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeRightParenthesis </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;)-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">rightParenthesis </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">rightParenthesis</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeLeftSquareBracket </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt;</span>
	<span class="s0">// Return a &lt;]-token&gt;.</span>
	<span class="s1">pos</span><span class="s3">;</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeRightSquareBracket </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt;</span>
	<span class="s0">// Return a &lt;]-token&gt;.</span>
	<span class="s1">pos</span><span class="s3">;</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeLeftCurlyBracket </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;{-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">leftCurlyBracket </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">leftCurlyBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeRightCurlyBracket </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;}-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">rightCurlyBracket </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">rightCurlyBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeSemicolon </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;semicolon-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">semicolon </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">semicolon</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeComma </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// Return a &lt;comma-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">comma </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">comma</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">_consumeAnIdentSequence </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume an ident sequence from a stream of code points.</span>
	<span class="s0">// It returns a string containing the largest name that can be formed from adjacent code points in the stream, starting from the first.</span>

	<span class="s0">// Note: This algorithm does not do the verification of the first few code points that are necessary to ensure the returned code points would constitute an &lt;ident-token&gt;.</span>
	<span class="s0">// If that is the intended use, ensure that the stream starts with an ident sequence before calling this algorithm.</span>

	<span class="s0">// Let result initially be an empty string.</span>

	<span class="s0">// Repeatedly consume the next input code point from the stream:</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s0">// ident code point</span>
		<span class="s0">// Append the code point to result.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isIdentCodePoint</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">)) {</span>
			<span class="s0">// Nothing</span>
		<span class="s3">}</span>
		<span class="s0">// the stream starts with a valid escape</span>
		<span class="s0">// Consume an escaped code point. Append the returned code point to result.</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
			<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnEscapedCodePoint</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s0">// anything else</span>
		<span class="s0">// Reconsume the current input code point. Return result.</span>
		<span class="s6">else </span><span class="s3">{</span>
			<span class="s6">return </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} cc char code</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{boolean} true, when cc is the non-printable code point, otherwise false</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">_isNonPrintableCodePoint </span><span class="s3">= </span><span class="s1">cc </span><span class="s3">=&gt;</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s7">0x00 </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s7">0x08</span><span class="s3">) ||</span>
	<span class="s1">cc </span><span class="s3">=== </span><span class="s7">0x0b </span><span class="s3">||</span>
	<span class="s3">(</span><span class="s1">cc </span><span class="s3">&gt;= </span><span class="s7">0x0e </span><span class="s3">&amp;&amp; </span><span class="s1">cc </span><span class="s3">&lt;= </span><span class="s7">0x1f</span><span class="s3">) ||</span>
	<span class="s1">cc </span><span class="s3">=== </span><span class="s7">0x7f</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">consumeTheRemnantsOfABadUrl </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume the remnants of a bad url from a stream of code points,</span>
	<span class="s0">// &quot;cleaning up&quot; after the tokenizer realizes that it’s in the middle of a &lt;bad-url-token&gt; rather than a &lt;url-token&gt;.</span>
	<span class="s0">// It returns nothing; its sole use is to consume enough of the input stream to reach a recovery point where normal tokenizing can resume.</span>

	<span class="s0">// Repeatedly consume the next input code point from the stream:</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s0">// EOF</span>
		<span class="s0">// Return.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s0">// U+0029 RIGHT PARENTHESIS ())</span>
		<span class="s0">// Return.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_RIGHT_PARENTHESIS</span><span class="s3">) {</span>
			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s0">// the input stream starts with a valid escape</span>
		<span class="s0">// Consume an escaped code point.</span>
		<span class="s0">// This allows an escaped right parenthesis (&quot;\)&quot;) to be encountered without ending the &lt;bad-url-token&gt;.</span>
		<span class="s0">// This is otherwise identical to the &quot;anything else&quot; clause.</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
			<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnEscapedCodePoint</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s0">// anything else</span>
		<span class="s0">// Do nothing.</span>
		<span class="s6">else </span><span class="s3">{</span>
			<span class="s0">// Do nothing.</span>
		<span class="s3">}</span>
	<span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} fnStart start</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{CssTokenCallbacks} callbacks callbacks</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{pos} pos</span>
 <span class="s4">*/</span>
<span class="s6">const </span><span class="s1">consumeAUrlToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">fnStart</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// This section describes how to consume a url token from a stream of code points.</span>
	<span class="s0">// It returns either a &lt;url-token&gt; or a &lt;bad-url-token&gt;.</span>

	<span class="s0">// Note: This algorithm assumes that the initial &quot;url(&quot; has already been consumed.</span>
	<span class="s0">// This algorithm also assumes that it’s being called to consume an &quot;unquoted&quot; value, like url(foo).</span>
	<span class="s0">// A quoted value, like url(&quot;foo&quot;), is parsed as a &lt;function-token&gt;.</span>
	<span class="s0">// Consume an ident-like token automatically handles this distinction; this algorithm shouldn’t be called directly otherwise.</span>

	<span class="s0">// Initially create a &lt;url-token&gt; with its value set to the empty string.</span>

	<span class="s0">// Consume as much whitespace as possible.</span>
	<span class="s6">while </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s6">const </span><span class="s1">contentStart </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

	<span class="s0">// Repeatedly consume the next input code point from the stream:</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s0">// EOF</span>
		<span class="s0">// This is a parse error. Return the &lt;url-token&gt;.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">fnStart</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s0">// U+0029 RIGHT PARENTHESIS ())</span>
		<span class="s0">// Return the &lt;url-token&gt;.</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_RIGHT_PARENTHESIS</span><span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">fnStart</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s0">// whitespace</span>
		<span class="s0">// Consume as much whitespace as possible.</span>
		<span class="s0">// If the next input code point is U+0029 RIGHT PARENTHESIS ()) or EOF, consume it and return the &lt;url-token&gt;</span>
		<span class="s0">// (if EOF was encountered, this is a parse error); otherwise, consume the remnants of a bad url, create a &lt;bad-url-token&gt;, and return it.</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
			<span class="s6">const </span><span class="s1">end </span><span class="s3">= </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>

			<span class="s6">while </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
				<span class="s1">pos</span><span class="s3">++;</span>
			<span class="s3">}</span>

			<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
				<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">fnStart</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">end</span><span class="s3">);</span>
				<span class="s3">}</span>

				<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">if </span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_RIGHT_PARENTHESIS</span><span class="s3">) {</span>
				<span class="s1">pos</span><span class="s3">++;</span>

				<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">url</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">fnStart</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">end</span><span class="s3">);</span>
				<span class="s3">}</span>

				<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s0">// Don't handle bad urls</span>
			<span class="s6">return </span><span class="s1">consumeTheRemnantsOfABadUrl</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s0">// U+0022 QUOTATION MARK (&quot;)</span>
		<span class="s0">// U+0027 APOSTROPHE (')</span>
		<span class="s0">// U+0028 LEFT PARENTHESIS (()</span>
		<span class="s0">// non-printable code point</span>
		<span class="s0">// This is a parse error. Consume the remnants of a bad url, create a &lt;bad-url-token&gt;, and return it.</span>
		<span class="s6">else if </span><span class="s3">(</span>
			<span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">||</span>
			<span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_APOSTROPHE </span><span class="s3">||</span>
			<span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_LEFT_PARENTHESIS </span><span class="s3">||</span>
			<span class="s1">_isNonPrintableCodePoint</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)</span>
		<span class="s3">) {</span>
			<span class="s0">// Don't handle bad urls</span>
			<span class="s6">return </span><span class="s1">consumeTheRemnantsOfABadUrl</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>
		<span class="s0">// // U+005C REVERSE SOLIDUS (\)</span>
		<span class="s0">// // If the stream starts with a valid escape, consume an escaped code point and append the returned code point to the &lt;url-token&gt;’s value.</span>
		<span class="s0">// // Otherwise, this is a parse error. Consume the remnants of a bad url, create a &lt;bad-url-token&gt;, and return it.</span>
		<span class="s6">else if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_REVERSE_SOLIDUS</span><span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
				<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnEscapedCodePoint</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">} </span><span class="s6">else </span><span class="s3">{</span>
				<span class="s0">// Don't handle bad urls</span>
				<span class="s6">return </span><span class="s1">consumeTheRemnantsOfABadUrl</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s3">}</span>
		<span class="s3">}</span>
		<span class="s0">// anything else</span>
		<span class="s0">// Append the current input code point to the &lt;url-token&gt;’s value.</span>
		<span class="s6">else </span><span class="s3">{</span>
			<span class="s0">// Nothing</span>
		<span class="s3">}</span>
	<span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeAnIdentLikeToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s0">// This section describes how to consume an ident-like token from a stream of code points.</span>
	<span class="s0">// It returns an &lt;ident-token&gt;, &lt;function-token&gt;, &lt;url-token&gt;, or &lt;bad-url-token&gt;.</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

	<span class="s0">// If string’s value is an ASCII case-insensitive match for &quot;url&quot;, and the next input code point is U+0028 LEFT PARENTHESIS ((), consume it.</span>
	<span class="s0">// While the next two input code points are whitespace, consume the next input code point.</span>
	<span class="s0">// If the next one or two input code points are U+0022 QUOTATION MARK (&quot;), U+0027 APOSTROPHE ('), or whitespace followed by U+0022 QUOTATION MARK (&quot;) or U+0027 APOSTROPHE ('), then create a &lt;function-token&gt; with its value set to string and return it.</span>
	<span class="s0">// Otherwise, consume a url token, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">).</span><span class="s1">toLowerCase</span><span class="s3">() === </span><span class="s2">&quot;url&quot; </span><span class="s3">&amp;&amp;</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_LEFT_PARENTHESIS</span>
	<span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s6">const </span><span class="s1">end </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

		<span class="s6">while </span><span class="s3">(</span>
			<span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">)) &amp;&amp;</span>
			<span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">))</span>
		<span class="s3">) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>

		<span class="s6">if </span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">||</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_APOSTROPHE </span><span class="s3">||</span>
			<span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">)) &amp;&amp;</span>
				<span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">||</span>
					<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">) === </span><span class="s1">CC_APOSTROPHE</span><span class="s3">))</span>
		<span class="s3">) {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">function </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">function</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>

		<span class="s6">return </span><span class="s1">consumeAUrlToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, if the next input code point is U+0028 LEFT PARENTHESIS ((), consume it.</span>
	<span class="s0">// Create a &lt;function-token&gt; with its value set to string and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_LEFT_PARENTHESIS</span><span class="s3">) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">function </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">function</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>

		<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, create an &lt;ident-token&gt; with its value set to string and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">identifier </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">identifier</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeLessThan </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">_callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// If the next 3 input code points are U+0021 EXCLAMATION MARK U+002D HYPHEN-MINUS U+002D HYPHEN-MINUS (!--), consume them and return a &lt;CDO-token&gt;.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">3</span><span class="s3">) === </span><span class="s2">&quot;!--&quot;</span><span class="s3">) {</span>
		<span class="s6">return </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">3</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeCommercialAt </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>

	<span class="s0">// If the next 3 input code points would start an ident sequence, consume an ident sequence, create an &lt;at-keyword-token&gt; with its value set to the returned value, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">,</span>
			<span class="s1">pos</span><span class="s3">,</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">)</span>
		<span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">atKeyword </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
			<span class="s1">pos </span><span class="s3">= </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">atKeyword</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s3">}</span>

		<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeReverseSolidus </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s0">// If the input stream starts with a valid escape, reconsume the current input code point, consume an ident-like token, and return it.</span>
	<span class="s6">if </span><span class="s3">(</span><span class="s1">_ifTwoCodePointsAreValidEscape</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">)) {</span>
		<span class="s1">pos</span><span class="s3">--;</span>
		<span class="s6">return </span><span class="s1">consumeAnIdentLikeToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>

	<span class="s0">// Otherwise, this is a parse error. Return a &lt;delim-token&gt; with its value set to the current input code point.</span>
	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CharHandler} */</span>
<span class="s6">const </span><span class="s1">consumeAToken </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">) =&gt; {</span>
	<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">- </span><span class="s7">1</span><span class="s3">);</span>

	<span class="s0">// https://drafts.csswg.org/css-syntax/#consume-token</span>
	<span class="s6">switch </span><span class="s3">(</span><span class="s1">cc</span><span class="s3">) {</span>
		<span class="s0">// whitespace</span>
		<span class="s6">case </span><span class="s1">CC_LINE_FEED</span><span class="s3">:</span>
		<span class="s6">case </span><span class="s1">CC_CARRIAGE_RETURN</span><span class="s3">:</span>
		<span class="s6">case </span><span class="s1">CC_FORM_FEED</span><span class="s3">:</span>
		<span class="s6">case </span><span class="s1">CC_TAB</span><span class="s3">:</span>
		<span class="s6">case </span><span class="s1">CC_SPACE</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0022 QUOTATION MARK (&quot;)</span>
		<span class="s6">case </span><span class="s1">CC_QUOTATION_MARK</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeAStringToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0023 NUMBER SIGN (#)</span>
		<span class="s6">case </span><span class="s1">CC_NUMBER_SIGN</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeNumberSign</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0027 APOSTROPHE (')</span>
		<span class="s6">case </span><span class="s1">CC_APOSTROPHE</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeAStringToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0028 LEFT PARENTHESIS (()</span>
		<span class="s6">case </span><span class="s1">CC_LEFT_PARENTHESIS</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeLeftParenthesis</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0029 RIGHT PARENTHESIS ())</span>
		<span class="s6">case </span><span class="s1">CC_RIGHT_PARENTHESIS</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeRightParenthesis</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+002B PLUS SIGN (+)</span>
		<span class="s6">case </span><span class="s1">CC_PLUS_SIGN</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumePlusSign</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+002C COMMA (,)</span>
		<span class="s6">case </span><span class="s1">CC_COMMA</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeComma</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+002D HYPHEN-MINUS (-)</span>
		<span class="s6">case </span><span class="s1">CC_HYPHEN_MINUS</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeHyphenMinus</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+002E FULL STOP (.)</span>
		<span class="s6">case </span><span class="s1">CC_FULL_STOP</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeFullStop</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+003A COLON (:)</span>
		<span class="s6">case </span><span class="s1">CC_COLON</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeColon</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+003B SEMICOLON (;)</span>
		<span class="s6">case </span><span class="s1">CC_SEMICOLON</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeSemicolon</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+003C LESS-THAN SIGN (&lt;)</span>
		<span class="s6">case </span><span class="s1">CC_LESS_THAN_SIGN</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeLessThan</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+0040 COMMERCIAL AT (@)</span>
		<span class="s6">case </span><span class="s1">CC_AT_SIGN</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeCommercialAt</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+005B LEFT SQUARE BRACKET ([)</span>
		<span class="s6">case </span><span class="s1">CC_LEFT_SQUARE</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeLeftSquareBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+005C REVERSE SOLIDUS (\)</span>
		<span class="s6">case </span><span class="s1">CC_REVERSE_SOLIDUS</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeReverseSolidus</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+005D RIGHT SQUARE BRACKET (])</span>
		<span class="s6">case </span><span class="s1">CC_RIGHT_SQUARE</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeRightSquareBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+007B LEFT CURLY BRACKET ({)</span>
		<span class="s6">case </span><span class="s1">CC_LEFT_CURLY</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeLeftCurlyBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s0">// U+007D RIGHT CURLY BRACKET (})</span>
		<span class="s6">case </span><span class="s1">CC_RIGHT_CURLY</span><span class="s3">:</span>
			<span class="s6">return </span><span class="s1">consumeRightCurlyBracket</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
		<span class="s6">default</span><span class="s3">:</span>
			<span class="s0">// digit</span>
			<span class="s0">// Reconsume the current input code point, consume a numeric token, and return it.</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">_isDigit</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
				<span class="s1">pos</span><span class="s3">--;</span>
				<span class="s6">return </span><span class="s1">consumeANumericToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
			<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_LOWER_U </span><span class="s3">|| </span><span class="s1">cc </span><span class="s3">=== </span><span class="s1">CC_UPPER_U</span><span class="s3">) {</span>
				<span class="s0">// If unicode ranges allowed is true and the input stream would start a unicode-range,</span>
				<span class="s0">// reconsume the current input code point, consume a unicode-range token, and return it.</span>
				<span class="s0">// Skip now</span>
				<span class="s0">// if (_ifThreeCodePointsWouldStartAUnicodeRange(input, pos)) {</span>
				<span class="s0">//  pos--;</span>
				<span class="s0">//  return consumeAUnicodeRangeToken(input, pos, callbacks);</span>
				<span class="s0">// }</span>

				<span class="s0">// Otherwise, reconsume the current input code point, consume an ident-like token, and return it.</span>
				<span class="s1">pos</span><span class="s3">--;</span>
				<span class="s6">return </span><span class="s1">consumeAnIdentLikeToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
			<span class="s3">}</span>
			<span class="s0">// ident-start code point</span>
			<span class="s0">// Reconsume the current input code point, consume an ident-like token, and return it.</span>
			<span class="s6">else if </span><span class="s3">(</span><span class="s1">isIdentStartCodePoint</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
				<span class="s1">pos</span><span class="s3">--;</span>
				<span class="s6">return </span><span class="s1">consumeAnIdentLikeToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
			<span class="s3">}</span>

			<span class="s0">// EOF, but we don't have it</span>

			<span class="s0">// anything else</span>
			<span class="s0">// Return a &lt;delim-token&gt; with its value set to the current input code point.</span>
			<span class="s6">return </span><span class="s1">consumeDelimToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>
	<span class="s3">}</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input css</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number=} pos pos</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{CssTokenCallbacks=} callbacks callbacks</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} pos</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">= </span><span class="s7">0</span><span class="s3">, </span><span class="s1">callbacks </span><span class="s3">= {}) =&gt; {</span>
	<span class="s0">// This section describes how to consume a token from a stream of code points. It will return a single token of any type.</span>
	<span class="s6">while </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">&lt; </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
		<span class="s0">// Consume comments.</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s0">// Consume the next input code point.</span>
		<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeAToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">needTerminate </span><span class="s3">&amp;&amp; </span><span class="s1">callbacks</span><span class="s3">.</span><span class="s1">needTerminate</span><span class="s3">()) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">isIdentStartCodePoint </span><span class="s3">= </span><span class="s1">isIdentStartCodePoint</span><span class="s3">;</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position after comments</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatComments </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s6">const </span><span class="s1">originalPos </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {});</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">originalPos </span><span class="s3">=== </span><span class="s1">pos</span><span class="s3">) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position after whitespace</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhitespace </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">while </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
		<span class="s1">pos</span><span class="s3">++;</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position after whitespace and comments</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhitespaceAndComments </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s6">const </span><span class="s1">originalPos </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {});</span>
		<span class="s6">while </span><span class="s3">(</span><span class="s1">_isWhiteSpace</span><span class="s3">(</span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">))) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s3">}</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">originalPos </span><span class="s3">=== </span><span class="s1">pos</span><span class="s3">) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position after whitespace and comments</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatComments </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s6">const </span><span class="s1">originalPos </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {});</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">originalPos </span><span class="s3">=== </span><span class="s1">pos</span><span class="s3">) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{number} position after whitespace</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhiteLine </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s6">for </span><span class="s3">(;;) {</span>
		<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isSpace</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) {</span>
			<span class="s1">pos</span><span class="s3">++;</span>
			<span class="s6">continue</span><span class="s3">;</span>
		<span class="s3">}</span>
		<span class="s6">if </span><span class="s3">(</span><span class="s1">_isNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">)) </span><span class="s1">pos</span><span class="s3">++;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeExtraNewline</span><span class="s3">(</span><span class="s1">cc</span><span class="s3">, </span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>
		<span class="s6">break</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[number, number] | undefined} positions of ident sequence</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">skipCommentsAndEatIdentSequence </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">,</span>
			<span class="s1">pos</span><span class="s3">,</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">)</span>
		<span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s3">[</span><span class="s1">start</span><span class="s3">, </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {})];</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[number, number] | undefined} positions of ident sequence</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatString </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhitespaceAndComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">||</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_APOSTROPHE</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s3">[</span><span class="s1">start</span><span class="s3">, </span><span class="s1">consumeAStringToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">, {})];</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{CssTokenCallbacks} cbs callbacks</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[number, number][]} positions of ident sequence</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatImageSetStrings </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">cbs</span><span class="s3">) =&gt; {</span>
	<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{[number, number][]} */</span>
	<span class="s6">const </span><span class="s1">result </span><span class="s3">= [];</span>

	<span class="s6">let </span><span class="s1">isFirst </span><span class="s3">= </span><span class="s6">true</span><span class="s3">;</span>
	<span class="s6">let </span><span class="s1">needStop </span><span class="s3">= </span><span class="s6">false</span><span class="s3">;</span>
	<span class="s0">// We already in `func(` token</span>
	<span class="s6">let </span><span class="s1">balanced </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>

	<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CssTokenCallbacks} */</span>
	<span class="s6">const </span><span class="s1">callbacks </span><span class="s3">= {</span>
		<span class="s1">...cbs</span><span class="s3">,</span>
		<span class="s1">string</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">isFirst </span><span class="s3">&amp;&amp; </span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">1</span><span class="s3">) {</span>
				<span class="s1">result</span><span class="s3">.</span><span class="s1">push</span><span class="s3">([</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">]);</span>
				<span class="s1">isFirst </span><span class="s3">= </span><span class="s6">false</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">comma</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">_start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">1</span><span class="s3">) {</span>
				<span class="s1">isFirst </span><span class="s3">= </span><span class="s6">true</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">leftParenthesis</span><span class="s3">: (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s1">balanced</span><span class="s3">++;</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s6">function</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s1">balanced</span><span class="s3">++;</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">rightParenthesis</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">_start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s1">balanced</span><span class="s3">--;</span>

			<span class="s6">if </span><span class="s3">(</span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s1">needStop </span><span class="s3">= </span><span class="s6">true</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">};</span>

	<span class="s6">while </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">&lt; </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
		<span class="s0">// Consume comments.</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s0">// Consume the next input code point.</span>
		<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeAToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">needStop</span><span class="s3">) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">result</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{CssTokenCallbacks} cbs callbacks</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[[number, number, number, number] | undefined, [number, number] | undefined, [number, number] | undefined, [number, number] | undefined]} positions of top level tokens</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatImportTokens </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">cbs</span><span class="s3">) =&gt; {</span>
	<span class="s6">const </span><span class="s1">result </span><span class="s3">=</span>
		<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{[[number, number, number, number] | undefined, [number, number] | undefined, [number, number] | undefined, [number, number] | undefined]} */</span>
		<span class="s3">(</span><span class="s6">new </span><span class="s1">Array</span><span class="s3">(</span><span class="s7">4</span><span class="s3">));</span>

	<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{0 | 1 | 2 | undefined} */</span>
	<span class="s6">let </span><span class="s1">scope</span><span class="s3">;</span>
	<span class="s6">let </span><span class="s1">needStop </span><span class="s3">= </span><span class="s6">false</span><span class="s3">;</span>
	<span class="s6">let </span><span class="s1">balanced </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>

	<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{CssTokenCallbacks} */</span>
	<span class="s6">const </span><span class="s1">callbacks </span><span class="s3">= {</span>
		<span class="s1">...cbs</span><span class="s3">,</span>
		<span class="s1">url</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">contentEnd</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0 </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">3</span><span class="s3">] === </span><span class="s1">undefined</span>
			<span class="s3">) {</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">contentStart</span><span class="s3">, </span><span class="s1">contentEnd</span><span class="s3">];</span>
				<span class="s1">scope </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">string</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span>
				<span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0 </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">3</span><span class="s3">] === </span><span class="s1">undefined</span>
			<span class="s3">) {</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">, </span><span class="s1">start </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">, </span><span class="s1">end </span><span class="s3">- </span><span class="s7">1</span><span class="s3">];</span>
				<span class="s1">scope </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
			<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span><span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] !== </span><span class="s1">undefined </span><span class="s3">&amp;&amp; </span><span class="s1">scope </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">][</span><span class="s7">2</span><span class="s3">] = </span><span class="s1">start </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">][</span><span class="s7">3</span><span class="s3">] = </span><span class="s1">end </span><span class="s3">- </span><span class="s7">1</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">leftParenthesis</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">_start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s1">balanced</span><span class="s3">++;</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">rightParenthesis</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">_start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s1">balanced</span><span class="s3">--;</span>

			<span class="s6">if </span><span class="s3">(</span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0 </span><span class="s3">&amp;&amp; </span><span class="s1">scope </span><span class="s3">!== </span><span class="s1">undefined</span><span class="s3">) {</span>
				<span class="s4">/** </span><span class="s5">@type </span><span class="s4">{[number, number]} */</span>
				<span class="s3">(</span><span class="s1">result</span><span class="s3">[</span><span class="s1">scope</span><span class="s3">])[</span><span class="s7">1</span><span class="s3">] = </span><span class="s1">end</span><span class="s3">;</span>
				<span class="s1">scope </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s6">function</span><span class="s3">: (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s6">const </span><span class="s1">name </span><span class="s3">= </span><span class="s1">input</span>
					<span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end </span><span class="s3">- </span><span class="s7">1</span><span class="s3">)</span>
					<span class="s3">.</span><span class="s1">replace</span><span class="s3">(</span><span class="s8">/\\/g</span><span class="s3">, </span><span class="s2">&quot;&quot;</span><span class="s3">)</span>
					<span class="s3">.</span><span class="s1">toLowerCase</span><span class="s3">();</span>

				<span class="s6">if </span><span class="s3">(</span>
					<span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;url&quot; </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">0</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">3</span><span class="s3">] === </span><span class="s1">undefined</span>
				<span class="s3">) {</span>
					<span class="s1">scope </span><span class="s3">= </span><span class="s7">0</span><span class="s3">;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s1">scope</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">, </span><span class="s1">end </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">, </span><span class="s1">end </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">];</span>
				<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span>
					<span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;layer&quot; </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined</span>
				<span class="s3">) {</span>
					<span class="s1">scope </span><span class="s3">= </span><span class="s7">1</span><span class="s3">;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s1">scope</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">];</span>
				<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span><span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;supports&quot; </span><span class="s3">&amp;&amp; </span><span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined</span><span class="s3">) {</span>
					<span class="s1">scope </span><span class="s3">= </span><span class="s7">2</span><span class="s3">;</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s1">scope</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">];</span>
				<span class="s3">} </span><span class="s6">else </span><span class="s3">{</span>
					<span class="s1">scope </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>

			<span class="s1">balanced</span><span class="s3">++;</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">identifier</span><span class="s3">: (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span>
				<span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0 </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] === </span><span class="s1">undefined </span><span class="s3">&amp;&amp;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">2</span><span class="s3">] === </span><span class="s1">undefined</span>
			<span class="s3">) {</span>
				<span class="s6">const </span><span class="s1">name </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">slice</span><span class="s3">(</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">).</span><span class="s1">replace</span><span class="s3">(</span><span class="s8">/\\/g</span><span class="s3">, </span><span class="s2">&quot;&quot;</span><span class="s3">).</span><span class="s1">toLowerCase</span><span class="s3">();</span>

				<span class="s6">if </span><span class="s3">(</span><span class="s1">name </span><span class="s3">=== </span><span class="s2">&quot;layer&quot;</span><span class="s3">) {</span>
					<span class="s1">result</span><span class="s3">[</span><span class="s7">1</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">];</span>
					<span class="s1">scope </span><span class="s3">= </span><span class="s1">undefined</span><span class="s3">;</span>
				<span class="s3">}</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">},</span>
		<span class="s1">semicolon</span><span class="s3">: (</span><span class="s1">_input</span><span class="s3">, </span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">) =&gt; {</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">balanced </span><span class="s3">=== </span><span class="s7">0</span><span class="s3">) {</span>
				<span class="s1">needStop </span><span class="s3">= </span><span class="s6">true</span><span class="s3">;</span>
				<span class="s1">result</span><span class="s3">[</span><span class="s7">3</span><span class="s3">] = [</span><span class="s1">start</span><span class="s3">, </span><span class="s1">end</span><span class="s3">];</span>
			<span class="s3">}</span>

			<span class="s6">return </span><span class="s1">end</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">};</span>

	<span class="s6">while </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">&lt; </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) {</span>
		<span class="s0">// Consume comments.</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s0">// Consume the next input code point.</span>
		<span class="s1">pos</span><span class="s3">++;</span>
		<span class="s1">pos </span><span class="s3">= </span><span class="s1">consumeAToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, </span><span class="s1">callbacks</span><span class="s3">);</span>

		<span class="s6">if </span><span class="s3">(</span><span class="s1">needStop</span><span class="s3">) {</span>
			<span class="s6">break</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">result</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[number, number] | undefined} positions of ident sequence</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatIdentSequence </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhitespaceAndComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">,</span>
			<span class="s1">pos</span><span class="s3">,</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">)</span>
		<span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s3">[</span><span class="s1">start</span><span class="s3">, </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {})];</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} input input</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{number} pos position</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{[number, number, boolean] | undefined} positions of ident sequence or string</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatIdentSequenceOrString </span><span class="s3">= (</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
	<span class="s1">pos </span><span class="s3">= </span><span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatWhitespaceAndComments</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">);</span>

	<span class="s6">const </span><span class="s1">start </span><span class="s3">= </span><span class="s1">pos</span><span class="s3">;</span>

	<span class="s6">if </span><span class="s3">(</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_QUOTATION_MARK </span><span class="s3">||</span>
		<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">) === </span><span class="s1">CC_APOSTROPHE</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s3">[</span><span class="s1">start</span><span class="s3">, </span><span class="s1">consumeAStringToken</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">, {}), </span><span class="s6">false</span><span class="s3">];</span>
	<span class="s3">} </span><span class="s6">else if </span><span class="s3">(</span>
		<span class="s1">_ifThreeCodePointsWouldStartAnIdentSequence</span><span class="s3">(</span>
			<span class="s1">input</span><span class="s3">,</span>
			<span class="s1">pos</span><span class="s3">,</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">1</span><span class="s3">),</span>
			<span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos </span><span class="s3">+ </span><span class="s7">2</span><span class="s3">)</span>
		<span class="s3">)</span>
	<span class="s3">) {</span>
		<span class="s6">return </span><span class="s3">[</span><span class="s1">start</span><span class="s3">, </span><span class="s1">_consumeAnIdentSequence</span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">, {}), </span><span class="s6">true</span><span class="s3">];</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s1">undefined</span><span class="s3">;</span>
<span class="s3">};</span>

<span class="s4">/**</span>
 <span class="s4">* </span><span class="s5">@param </span><span class="s4">{string} chars characters</span>
 <span class="s4">* </span><span class="s5">@returns </span><span class="s4">{(input: string, pos: number) =&gt; number} function to eat characters</span>
 <span class="s4">*/</span>
<span class="s1">module</span><span class="s3">.</span><span class="s1">exports</span><span class="s3">.</span><span class="s1">eatUntil </span><span class="s3">= </span><span class="s1">chars </span><span class="s3">=&gt; {</span>
	<span class="s6">const </span><span class="s1">charCodes </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">({ </span><span class="s1">length</span><span class="s3">: </span><span class="s1">chars</span><span class="s3">.</span><span class="s1">length </span><span class="s3">}, (</span><span class="s1">_</span><span class="s3">, </span><span class="s1">i</span><span class="s3">) =&gt;</span>
		<span class="s1">chars</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">i</span><span class="s3">)</span>
	<span class="s3">);</span>
	<span class="s6">const </span><span class="s1">arr </span><span class="s3">= </span><span class="s1">Array</span><span class="s3">.</span><span class="s1">from</span><span class="s3">(</span>
		<span class="s3">{ </span><span class="s1">length</span><span class="s3">: </span><span class="s1">charCodes</span><span class="s3">.</span><span class="s1">reduce</span><span class="s3">((</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">) =&gt; </span><span class="s1">Math</span><span class="s3">.</span><span class="s1">max</span><span class="s3">(</span><span class="s1">a</span><span class="s3">, </span><span class="s1">b</span><span class="s3">), </span><span class="s7">0</span><span class="s3">) + </span><span class="s7">1 </span><span class="s3">},</span>
		<span class="s3">() =&gt; </span><span class="s6">false</span>
	<span class="s3">);</span>
	<span class="s6">for </span><span class="s3">(</span><span class="s6">const </span><span class="s1">cc of charCodes</span><span class="s3">) {</span>
		<span class="s1">arr</span><span class="s3">[</span><span class="s1">cc</span><span class="s3">] = </span><span class="s6">true</span><span class="s3">;</span>
	<span class="s3">}</span>

	<span class="s6">return </span><span class="s3">(</span><span class="s1">input</span><span class="s3">, </span><span class="s1">pos</span><span class="s3">) =&gt; {</span>
		<span class="s6">for </span><span class="s3">(;;) {</span>
			<span class="s6">const </span><span class="s1">cc </span><span class="s3">= </span><span class="s1">input</span><span class="s3">.</span><span class="s1">charCodeAt</span><span class="s3">(</span><span class="s1">pos</span><span class="s3">);</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">cc </span><span class="s3">&lt; </span><span class="s1">arr</span><span class="s3">.</span><span class="s1">length </span><span class="s3">&amp;&amp; </span><span class="s1">arr</span><span class="s3">[</span><span class="s1">cc</span><span class="s3">]) {</span>
				<span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
			<span class="s3">}</span>
			<span class="s1">pos</span><span class="s3">++;</span>
			<span class="s6">if </span><span class="s3">(</span><span class="s1">pos </span><span class="s3">=== </span><span class="s1">input</span><span class="s3">.</span><span class="s1">length</span><span class="s3">) </span><span class="s6">return </span><span class="s1">pos</span><span class="s3">;</span>
		<span class="s3">}</span>
	<span class="s3">};</span>
<span class="s3">};</span>
</pre>
</body>
</html>